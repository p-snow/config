<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Dotfiles</title>
<meta name="generator" content="Org mode" />
<link rel="stylesheet" type="text/css" href="https://fniessen.github.io/org-html-themes/src/readtheorg_theme/css/htmlize.css"/>
<link rel="stylesheet" type="text/css" href="https://fniessen.github.io/org-html-themes/src/readtheorg_theme/css/readtheorg.css"/>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/src/lib/js/jquery.stickytableheaders.min.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/src/readtheorg_theme/js/readtheorg.js"></script>
</head>
<body>
<div id="content">
<h1 class="title">Dotfiles</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orgc2fe5ce">Personal Information</a>
<ul>
<li><a href="#orgd404a6d">Local Directories</a>
<ul>
<li><a href="#org6eafcf7">home directory</a></li>
<li><a href="#orgdd667bf">document directory</a></li>
<li><a href="#org2c9f979">share directory</a></li>
<li><a href="#org47ce84a">media directory</a></li>
<li><a href="#orgbd79f6a">trash directory</a></li>
<li><a href="#org10c84d5">log file directory</a></li>
</ul>
</li>
<li><a href="#org353b538">Email Settings</a>
<ul>
<li><a href="#org6e2226c">Smtp Server Host (supposed to define 'smtp-host')&#xa0;&#xa0;&#xa0;<span class="tag"><span class="crypt">crypt</span></span></a></li>
<li><a href="#orga242a36">My Email Address (supposed to define 'email')&#xa0;&#xa0;&#xa0;<span class="tag"><span class="crypt">crypt</span></span></a></li>
<li><a href="#org509fdbd">My Login Name</a></li>
<li><a href="#orge9734c3">My Domain Name</a></li>
</ul>
</li>
<li><a href="#org1aba652">Machines</a>
<ul>
<li><a href="#org1ae43c4">Primary Laptop</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org3624534">Linux Distributions</a>
<ul>
<li><a href="#org105bd73">Ubuntu</a>
<ul>
<li><a href="#orgc0dced2">Apt Package Manager</a></li>
</ul>
</li>
<li><a href="#org2f129b7">Linux Mint (Cinnamon DE)</a></li>
<li><a href="#orgb7d5611">GNU Guix</a>
<ul>
<li><a href="#org9087785">Channel definitions</a></li>
<li><a href="#orgda6e4a7">Manifests</a></li>
<li><a href="#orgdb18164">Activating Profiles</a></li>
<li><a href="#orgfbc8ea0">Updating Channels</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgcb06513">System Constituents</a>
<ul>
<li><a href="#orgc3b0aea">Font</a>
<ul>
<li><a href="#orgeb72343">Fontconfig</a></li>
<li><a href="#org50c1220">Font Viewer</a></li>
</ul>
</li>
<li><a href="#orgd1cc88e">Bash</a></li>
<li><a href="#org69409c8">Systemd</a>
<ul>
<li><a href="#orgaf7f441">systemd-tmpfiles</a></li>
</ul>
</li>
<li><a href="#org4b87743">Vixie Cron</a></li>
<li><a href="#orgbc0ccdc">Btrfs</a>
<ul>
<li><a href="#org6b9d070">btrbk</a></li>
<li><a href="#org34e0fe0">snapshots management&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span></a></li>
<li><a href="#org211a156">backup to another device&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span></a></li>
</ul>
</li>
<li><a href="#orgc8dff5d">XDG</a>
<ul>
<li><a href="#orgf1539d3">xdg-mime</a></li>
</ul>
</li>
<li><a href="#org4be56b9">GnuPG (gpg)</a></li>
<li><a href="#orgbd6b587">Key Remappers</a>
<ul>
<li><a href="#orgde6ded6">Xremap</a></li>
<li><a href="#org01e100b">XKB&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span></a></li>
<li><a href="#orgda13e1b">Interception Tools&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span></a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org6e041b6">Application Configurations</a>
<ul>
<li><a href="#gnu-emacs">GNU Emacs</a>
<ul>
<li><a href="#org49bd268">basic configuration</a></li>
<li><a href="#org1bf5744">further extension</a></li>
<li><a href="#org6f9d22f">bespoke org tweaks</a></li>
<li><a href="#org87a4e81">would-be packages</a></li>
</ul>
</li>
<li><a href="#org12504d6">Findutils</a></li>
<li><a href="#org2e4343b">plocate</a></li>
<li><a href="#org3439d83">OpenSSH</a></li>
<li><a href="#orga63bf3f">Git</a>
<ul>
<li><a href="#org7cd1ab6">git ignore</a></li>
<li><a href="#orga189190">git config</a></li>
<li><a href="#org13033ae">git attributes</a></li>
</ul>
</li>
<li><a href="#org8ea5a14">git-annex</a>
<ul>
<li><a href="#orgf2abdfc">sync annex repos</a></li>
</ul>
</li>
<li><a href="#org17e6bea">ghq</a></li>
<li><a href="#orgb2018ef">Pass</a></li>
<li><a href="#org21b4cef">mpv</a></li>
<li><a href="#orge4f310a">unison</a></li>
<li><a href="#org846131c">Aspell</a></li>
<li><a href="#org4392d7f">textlint</a></li>
<li><a href="#orga908b8c">xkeysnail</a></li>
<li><a href="#orgce9fa84">SKK</a>
<ul>
<li><a href="#org25b02f9">derive unique entries in user-jisyo</a></li>
</ul>
</li>
<li><a href="#orgeff24b7">Festival</a></li>
<li><a href="#org83682cf">Open JTalk</a></li>
<li><a href="#orga60e211">Jack</a></li>
<li><a href="#orgf4de07d">XRandR</a></li>
<li><a href="#orgcc8b9b0">C/Migemo</a>
<ul>
<li><a href="#orgc43dca1">C/Migemo in apt&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span></a></li>
<li><a href="#orgdde1e9a">AZIK-compliant C/Migemo&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span></a></li>
</ul>
</li>
<li><a href="#org6431b00">LilyPond</a></li>
<li><a href="#orgdf368b6">Graphviz</a></li>
<li><a href="#org3926de8">Rsync</a>
<ul>
<li><a href="#org454202b">sync server data&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span></a></li>
<li><a href="#org6b4c099">backup script&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span></a></li>
</ul>
</li>
<li><a href="#orgd0cbea4">libvirt</a></li>
<li><a href="#orgc9f4e82">Calibre</a></li>
<li><a href="#org3322ec7">yt-dlp</a></li>
<li><a href="#orgc0c754a">rTorrent</a></li>
<li><a href="#org72df392">Ledger</a></li>
<li><a href="#org1b58fb8">ripgrep-all</a></li>
<li><a href="#orgb11f6fc">Recoll</a>
<ul>
<li><a href="#org98f3371">systemd setting</a></li>
</ul>
</li>
<li><a href="#org5e91351">Enchant</a></li>
<li><a href="#org7ba85ac">Modern alternative command line tools</a></li>
</ul>
</li>
<li><a href="#org0664fee">Development Infrastructures</a>
<ul>
<li><a href="#org0942a03">Python</a></li>
<li><a href="#orgf1a3d5c">Ruby</a></li>
<li><a href="#orgf33f53e">Rust</a></li>
<li><a href="#orgf39a909">Common Lisp</a></li>
<li><a href="#org1470e80">Node.js</a></li>
<li><a href="#orgb7574cb">asdf-vm&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span></a></li>
<li><a href="#orge42e6a5">Language Servers</a>
<ul>
<li><a href="#orgec541ab">Bash Language Server</a></li>
<li><a href="#org93dfac0">Solargraph</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org16f5414">Stuffs for Dedicated Tasks</a>
<ul>
<li><a href="#orgc534fe7">Batch Processing</a>
<ul>
<li><a href="#orgf04cbca">Morning Batch</a></li>
<li><a href="#org69815ad">Weekend Batch</a></li>
<li><a href="#orge9f9473">System Batch</a></li>
</ul>
</li>
<li><a href="#org53f8b24">Transcode Video Files</a>
<ul>
<li><a href="#org10c0258">vp9 transcoding</a></li>
<li><a href="#org2952def">av1 transcoding</a></li>
</ul>
</li>
<li><a href="#org9d7e748">Transcode Audio Files&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span></a></li>
<li><a href="#orgc4d221a">DVD Packing</a></li>
<li><a href="#orgd132532">CD Ripping</a>
<ul>
<li><a href="#orgc098f86">abcde</a></li>
</ul>
</li>
<li><a href="#orgd312e66">Tutorial Video Creation</a>
<ul>
<li><a href="#org1ad72d0">Screenkey</a></li>
</ul>
</li>
<li><a href="#orgbe6d505">Sync Git Repos Automatically</a>
<ul>
<li><a href="#org2858f0e">git-sync&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span></a></li>
</ul>
</li>
<li><a href="#org761ace8">Download media at anywhere in desktop</a></li>
</ul>
</li>
<li><a href="#org2cf351d">Babel Utility Functions</a>
<ul>
<li><a href="#orge3193c8">which path</a></li>
<li><a href="#orgd5442da">Generate hash string</a></li>
<li><a href="#orgd72d785">random number</a></li>
</ul>
</li>
<li><a href="#org43b5de7">Specialized Scripts</a>
<ul>
<li><a href="#org3185e2c">Declutters&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span></a></li>
<li><a href="#org553343f">Database back-up scripts</a></li>
<li><a href="#org1b2ec6e">filetype</a></li>
<li><a href="#org3e5cbe2">mediautil</a></li>
<li><a href="#org61a3040">genalbum</a></li>
<li><a href="#orgd78981c">nhp&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span></a></li>
<li><a href="#org40f4835">sendmail.py</a></li>
<li><a href="#org1203dee">pwsudo</a></li>
<li><a href="#org51aa919">gitsync&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span></a></li>
<li><a href="#org39f9c2d">filetype-cli&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span></a></li>
<li><a href="#org0c9ba8b">strip ruby</a></li>
</ul>
</li>
<li><a href="#orgaad24f0">Local Variables</a></li>
</ul>
</div>
</div>

<div id="outline-container-orgc2fe5ce" class="outline-2">
<h2 id="orgc2fe5ce">Personal Information</h2>
<div class="outline-text-2" id="text-orgc2fe5ce">
</div>
<div id="outline-container-orgd404a6d" class="outline-3">
<h3 id="orgd404a6d">Local Directories</h3>
<div class="outline-text-3" id="text-orgd404a6d">
</div>
<div id="outline-container-org6eafcf7" class="outline-4">
<h4 id="org6eafcf7">home directory</h4>
<div class="outline-text-4" id="text-org6eafcf7">
<div class="org-src-container">
<pre class="src src-shell" id="orgd1e00b3"><span style="font-weight: bold;">echo</span> <span style="font-style: italic;">"${HOME}"</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgdd667bf" class="outline-4">
<h4 id="orgdd667bf">document directory</h4>
<div class="outline-text-4" id="text-orgdd667bf">
<div class="org-src-container">
<pre class="src src-emacs-lisp" id="org90d019e">(<span style="font-weight: bold;">let*</span> ((sep <span style="font-style: italic;">"-"</span>)
       (node (split-string <span style="font-style: italic;">"&lt;&lt;laptop-node()&gt;&gt;"</span> sep)))
  (expand-file-name
   (file-name-concat <span style="font-style: italic;">"~/"</span>
                     (string-join (list (concat (car node) <span style="font-style: italic;">"doc"</span>) (cadr node))
                                  sep)
                     <span style="font-style: italic;">"doc/"</span>)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org2c9f979" class="outline-4">
<h4 id="org2c9f979">share directory</h4>
<div class="outline-text-4" id="text-org2c9f979">
<p>
My share directory is where my variable data stay.
</p>

<div class="org-src-container">
<pre class="src src-shell" id="org4cefba7">realpath <span style="font-style: italic;">"${HOME}/data/share"</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org47ce84a" class="outline-4">
<h4 id="org47ce84a">media directory</h4>
<div class="outline-text-4" id="text-org47ce84a">
<div class="org-src-container">
<pre class="src src-shell" id="org13916a0">realpath <span style="font-style: italic;">"&lt;&lt;home-dir()&gt;&gt;/data/audiovisual"</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgbd79f6a" class="outline-4">
<h4 id="orgbd79f6a">trash directory</h4>
<div class="outline-text-4" id="text-orgbd79f6a">
<div class="org-src-container">
<pre class="src src-shell" id="orgfd6029d"><span style="font-weight: bold;">echo</span> <span style="font-style: italic;">"${XDG_DATA_HOME}/Trash"</span>
</pre>
</div>

<p>
delete file which lives longer than 1 week in trash directory.
</p>

<div class="org-src-container">
<pre class="src src-conf">d &lt;&lt;trash-dir()&gt;&gt;/files 0700 - - 1w
</pre>
</div>

<div class="org-src-container">
<pre class="src src-shell">-e <span style="font-style: italic;">"&lt;&lt;trash-dir()&gt;&gt;"</span> <span style="font-style: italic;">\</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org10c84d5" class="outline-4">
<h4 id="org10c84d5">log file directory</h4>
<div class="outline-text-4" id="text-org10c84d5">
<div class="org-src-container">
<pre class="src src-shell" id="orgac89b34"><span style="font-weight: bold;">echo</span> <span style="font-style: italic;">"${XDG_STATE_HOME}/log"</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org353b538" class="outline-3">
<h3 id="org353b538">Email Settings</h3>
<div class="outline-text-3" id="text-org353b538">
</div>

<div id="outline-container-org6e2226c" class="outline-4">
<h4 id="org6e2226c">Smtp Server Host (supposed to define 'smtp-host')&#xa0;&#xa0;&#xa0;<span class="tag"><span class="crypt">crypt</span></span></h4>
<div class="outline-text-4" id="text-org6e2226c">
<p>
&#x2013;&#x2014;BEGIN PGP MESSAGE&#x2013;&#x2014;
</p>

<p>
hQEMA9uWvE5LJ2ejAQgAgdgJUS0v+ASUy6B5/RsqDdm/3ll8VK3bq+GlNPdPUIca
hO2qmuJfgiwXWmNZtr4wSFLYOEU6l9PjM8lCS+U1dcv18XcX0v3cjIZKb/0EiABl
PLnxdI0Nnkk3RBrWICP1+DLE48rCuJQvdHLzZ8wsVw1Wh4/BizIvY+t7+TxSDKLy
4UissNE9C+lftBL7caIaSUOyeppoQCKUaM4TaRiJU/Yv0QpCZvp6x03dSoTkr10h
l73EhhlkhbwvAUAg8Sb2hX7bAFwR8qp6BC8XkbtZM5u2uqrYUAmXGIYmHWOYSvQZ
hsxj9jzPkt8Y+xIZ//+oXxhN0UFigwGHn5IbIlB2TNJ+AYMlUGxMiv13YoI19N09
aGTmms93QHI7c86kfJNi4bI20kDLOwZThFK3gXEpzVFFT0rD1LOVga3Dqw1VsO0N
EEcaZWs9POlc4rdeF3kn3ZSB0P3J77vidiaIFOh5lNpU/9k7nEmT9QE0K++fpTxs
obm9ZjahsnwNP10Vn2pQ
=rUbc
&#x2013;&#x2014;END PGP MESSAGE&#x2013;&#x2014;
</p>
</div>
</div>

<div id="outline-container-orga242a36" class="outline-4">
<h4 id="orga242a36">My Email Address (supposed to define 'email')&#xa0;&#xa0;&#xa0;<span class="tag"><span class="crypt">crypt</span></span></h4>
<div class="outline-text-4" id="text-orga242a36">
<p>
&#x2013;&#x2014;BEGIN PGP MESSAGE&#x2013;&#x2014;
</p>

<p>
hQEMA9uWvE5LJ2ejAQgAtC7Jd2eChH/yaCKEx5ecJFRpmv0JJlymqJU7Jf2ShbgF
FQeDPbqQaBAyp/vV9RVxeiYV5EsOofTJYhlLvvdiv4zq4NiaaEDjrUblOGWxaEHp
KBMdKLqqLADM9RfvPv2vrofI7FtxAG7PF+wRFeW1vXyKakjhnPA/ydJpDdOIgjzh
HCPmcZnYObSz9pwKPM05Rhfd7eLtOtaWBCxmTLGHhVd9xU0dXJ3eQwO0OeqYns7l
QWq4lQ9Q825aZ7h+hKkamleVuKy8kjrBxnfdsyHGMaPUQlQcTTnNmS50+EmiHh4Z
0I9N+vIhAM6yuz5Y/C4pndMgggFjKYCpmVAnIJLLjdKBASx2bGgpUfmRqdHeOwY5
/3zipNj2QRjif9iZuSNdgthn2Yz0wtZuzwzc+CGib/fqtY+N5Nt36mhydgbac36v
y3bLp9UlGFAAUsqmvw1EP0nmtONIX+9SZDL3B08OV6OdtmmINKNAR/8rkDZN8o0d
5F/lEfK8uU00O1Cwjl6O8YK/
=qchL
&#x2013;&#x2014;END PGP MESSAGE&#x2013;&#x2014;
</p>
</div>
</div>

<div id="outline-container-org509fdbd" class="outline-4">
<h4 id="org509fdbd">My Login Name</h4>
<div class="outline-text-4" id="text-org509fdbd">
<div class="org-src-container">
<pre class="src src-emacs-lisp" id="org1e09bde">user-login-name
</pre>
</div>
</div>
</div>

<div id="outline-container-orge9734c3" class="outline-4">
<h4 id="orge9734c3">My Domain Name</h4>
<div class="outline-text-4" id="text-orge9734c3">
<div class="org-src-container">
<pre class="src src-shell" id="orgc2bcfd3"><span style="font-weight: bold;">echo</span> -n <span style="font-style: italic;">"${EMAIL}"</span> | cut -d<span style="font-style: italic;">'@'</span> -f2
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org1aba652" class="outline-3">
<h3 id="org1aba652">Machines</h3>
<div class="outline-text-3" id="text-org1aba652">
</div>

<div id="outline-container-org1ae43c4" class="outline-4">
<h4 id="org1ae43c4">Primary Laptop</h4>
<div class="outline-text-4" id="text-org1ae43c4">
<div class="org-src-container">
<pre class="src src-shell" id="org86ab2bf">uname -n
</pre>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-org3624534" class="outline-2">
<h2 id="org3624534">Linux Distributions</h2>
<div class="outline-text-2" id="text-org3624534">
</div>
<div id="outline-container-org105bd73" class="outline-3">
<h3 id="org105bd73">Ubuntu</h3>
<div class="outline-text-3" id="text-org105bd73">
<p>
initialization script for a ubuntu account
</p>

<div class="org-src-container">
<pre class="src src-bash">apt-install
npm-install
start-systemd-services

&lt;&lt;ubuntu-setup&gt;&gt;
</pre>
</div>
</div>

<div id="outline-container-orgc0dced2" class="outline-4">
<h4 id="orgc0dced2">Apt Package Manager</h4>
<div class="outline-text-4" id="text-orgc0dced2">
<ul class="org-ul">
<li><p>
apt-managed packages
</p>
<div class="org-src-container">
<pre class="src src-shell">sudo apt-get install -y <span style="font-style: italic;">\</span>
     &lt;&lt;apt-pkg&gt;&gt;
</pre>
</div></li>
<li><p>
update apt packages every weekend
</p>
<div class="org-src-container">
<pre class="src src-shell">apt update &amp;&amp; apt upgrade --yes
</pre>
</div></li>
</ul>
</div>
</div>
</div>

<div id="outline-container-org2f129b7" class="outline-3">
<h3 id="org2f129b7">Linux Mint (Cinnamon DE)</h3>
<div class="outline-text-3" id="text-org2f129b7">
<p>
initialization script for a linuxmint account
</p>

<div class="org-src-container">
<pre class="src src-shell">initialize-ubuntu-desktop

&lt;&lt;linuxmint-setup&gt;&gt;
</pre>
</div>

<ul class="org-ul">
<li><p>
Back-up Cinnamon Desktop Configuration
</p>
<div class="org-src-container">
<pre class="src src-shell">dconf dump /org/cinnamon/ &gt; ~/.config/linuxmint/cinnamon.conf
</pre>
</div>

<p>
To thaw backed up config
</p>
<div class="org-src-container">
<pre class="src src-conf">dconf load /org/cinnamon/ &lt; &lt;&lt;home-dir()&gt;&gt;/.config/linuxmint/cinnamon.conf
</pre>
</div></li>

<li><p>
Commands/Applications that need to use LinuxMint comfortably
</p>
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"xclip"</span>
</pre>
</div></li>
</ul>
</div>
</div>

<div id="outline-container-orgb7d5611" class="outline-3">
<h3 id="orgb7d5611">GNU Guix</h3>
<div class="outline-text-3" id="text-orgb7d5611">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-style: italic;">"https://github.com/SystemCrafters/guix-installer/releases.atom"</span> soft_update)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-shell"><span style="font-weight: bold;">export</span> <span style="font-weight: bold; font-style: italic;">GUIX_EXTRA_PROFILES</span>=$<span style="font-weight: bold; font-style: italic;">HOME</span>/.guix-extra-profiles

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">fill in a variable below like a comment line</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">if you'd like to acticate specific profiles under GUIX_EXTRA_PROFILES</span>
<span style="font-weight: bold; font-style: italic;">ACTIVE_PROFILE_NAMES</span>=()
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">ACTIVE_PROFILE_NAMES=(base emacs)</span>

<span style="font-weight: bold; font-style: italic;">profiles</span>=()
<span style="font-weight: bold;">if</span> [ ${#<span style="font-weight: bold; font-style: italic;">ACTIVE_PROFILE_NAMES</span>[@]} -eq 0 ]; <span style="font-weight: bold;">then</span>
  <span style="font-weight: bold; font-style: italic;">profiles</span>=<span style="font-style: italic;">"${GUIX_EXTRA_PROFILES}/*"</span>
<span style="font-weight: bold;">else</span>
  <span style="font-weight: bold;">for</span> name<span style="font-weight: bold;"> in</span> ${<span style="font-weight: bold; font-style: italic;">ACTIVE_PROFILE_NAMES</span>[@]}; <span style="font-weight: bold;">do</span>
    profiles+=(<span style="font-style: italic;">"${GUIX_EXTRA_PROFILES}/${name}"</span>)
  <span style="font-weight: bold;">done</span>
<span style="font-weight: bold;">fi</span>

<span style="font-weight: bold;">for</span> profile<span style="font-weight: bold;"> in</span> ${<span style="font-weight: bold; font-style: italic;">profiles</span>[@]}; <span style="font-weight: bold;">do</span>
  <span style="font-weight: bold; font-style: italic;">GUIX_PROFILE</span>=<span style="font-style: italic;">"${profile}/$(basename ${profile})"</span>
  <span style="font-weight: bold;">if</span> [ -f ${<span style="font-weight: bold; font-style: italic;">GUIX_PROFILE</span>}/etc/profile ]; <span style="font-weight: bold;">then</span>
    . <span style="font-style: italic;">"${GUIX_PROFILE}"</span>/etc/profile
  <span style="font-weight: bold;">fi</span>
<span style="font-weight: bold;">done</span>

<span style="font-weight: bold;">export</span> <span style="font-weight: bold; font-style: italic;">GUIX_PROFILE</span>=<span style="font-style: italic;">"$HOME/.guix-profile"</span>
. <span style="font-style: italic;">"$GUIX_PROFILE/etc/profile"</span>

<span style="font-weight: bold;">export</span> <span style="font-weight: bold; font-style: italic;">GUIX_PROFILE</span>=<span style="font-style: italic;">"$HOME/.config/guix/current"</span>
. <span style="font-style: italic;">"$GUIX_PROFILE/etc/profile"</span>

<span style="font-weight: bold;">export</span> <span style="font-weight: bold; font-style: italic;">GUIX_LOCPATH</span>=<span style="font-style: italic;">"$HOME/.guix-profile/lib/locale"</span>


<span style="font-weight: bold;">if</span> [ -v GUIX_ENVIRONMENT ]; <span style="font-weight: bold;">then</span>
  <span style="font-weight: bold;">if</span> [[ $<span style="font-weight: bold; font-style: italic;">PS1</span> =~ (.*)<span style="font-style: italic;">"\\$"</span> ]]; <span style="font-weight: bold;">then</span>
    <span style="font-weight: bold; font-style: italic;">PS1</span>=<span style="font-style: italic;">"${BASH_REMATCH[1]} [env]\\\$ "</span>
  <span style="font-weight: bold;">fi</span>
<span style="font-weight: bold;">fi</span>
</pre>
</div>
</div>

<div id="outline-container-org9087785" class="outline-4">
<h4 id="org9087785">Channel definitions</h4>
<div class="outline-text-4" id="text-org9087785">
<div class="org-src-container">
<pre class="src src-scheme">(list (channel
       (name 'nonguix)
       (url <span style="font-style: italic;">"https://gitlab.com/nonguix/nonguix"</span>))
      (channel
       (name 'guix)
       (url <span style="font-style: italic;">"https://git.savannah.gnu.org/git/guix.git"</span>))
      (channel
       (name 'guix-jp)
       (url <span style="font-style: italic;">"https://gitlab.com/guix-jp/channel"</span>)
       (branch <span style="font-style: italic;">"main"</span>))
      (channel
       (name 'p-snow)
       (url <span style="font-style: italic;">"https://github.com/p-snow/guix-channel"</span>)
       (introduction
        (make-channel-introduction
         <span style="font-style: italic;">"3a10227fbc2d5e9744aced43f820a0d3bf64add5"</span>
         (openpgp-fingerprint
          <span style="font-style: italic;">"CF56 FC53 3AD6 6A67 6FDC  1D73 0D2B AF0E 8AEF 0306"</span>)))))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgda6e4a7" class="outline-4">
<h4 id="orgda6e4a7">Manifests</h4>
<div class="outline-text-4" id="text-orgda6e4a7">
</div>
<ul class="org-ul">
<li><a id="org1da1bf2"></a>guix base profile<br />
<div class="outline-text-5" id="text-org1da1bf2">
<div class="org-src-container">
<pre class="src src-shell"><span style="font-weight: bold;">export</span> <span style="font-weight: bold; font-style: italic;">XDG_DATA_DIRS</span>=${<span style="font-weight: bold; font-style: italic;">GUIX_EXTRA_PROFILES</span>}/base/base/share:${<span style="font-weight: bold; font-style: italic;">XDG_DATA_DIRS</span>}
<span style="font-weight: bold;">export</span> <span style="font-weight: bold; font-style: italic;">MANPATH</span>=${<span style="font-weight: bold; font-style: italic;">MANPATH</span>}:${<span style="font-weight: bold; font-style: italic;">GUIX_EXTRA_PROFILES</span>}/base/base/share/man
</pre>
</div>

<div class="org-src-container">
<pre class="src src-scheme">(specifications-&gt;manifest
 '(<span style="font-style: italic;">"coreutils"</span>
   <span style="font-style: italic;">"diffutils"</span>
   <span style="font-style: italic;">"parallel"</span>
   <span style="font-style: italic;">"gawk"</span>
   <span style="font-style: italic;">"sed"</span>
   <span style="font-style: italic;">"tar"</span>
   <span style="font-style: italic;">"zip"</span>
   <span style="font-style: italic;">"unzip"</span>
   <span style="font-style: italic;">"zstd"</span>
   <span style="font-style: italic;">"p7zip"</span>
   <span style="font-style: italic;">"shadow"</span>
   <span style="font-style: italic;">"sshfs"</span>
   <span style="font-style: italic;">"grep"</span>
   <span style="font-style: italic;">"ripgrep"</span>
   <span style="font-style: italic;">"less"</span>
   <span style="font-style: italic;">"pwgen"</span>
   <span style="font-style: italic;">"file"</span>
   <span style="font-style: italic;">"nkf"</span>
   <span style="font-style: italic;">"lsof"</span>
   <span style="font-style: italic;">"tree"</span>
   <span style="font-style: italic;">"poppler"</span>
   <span style="font-style: italic;">"pass-git-helper"</span>
   <span style="font-style: italic;">"stow"</span>
   <span style="font-style: italic;">"pandoc"</span>
   <span style="font-style: italic;">"nss-certs"</span>
   <span style="font-style: italic;">"openssl"</span>
   <span style="font-style: italic;">"glibc"</span>
   <span style="font-style: italic;">"procps"</span>
   <span style="font-style: italic;">"time"</span>
   <span style="font-style: italic;">"htop"</span>
   <span style="font-style: italic;">"net-tools"</span>
   <span style="font-style: italic;">"curl"</span>
   <span style="font-style: italic;">"wget"</span>
   <span style="font-style: italic;">"httrack"</span>
   <span style="font-style: italic;">"ghc-tldr"</span>
   <span style="font-style: italic;">"network-manager"</span>
   <span style="font-style: italic;">"wakelan"</span>
   <span style="font-style: italic;">"speedtest-cli"</span>
   <span style="font-style: italic;">"parted"</span>
   <span style="font-style: italic;">"fdisk"</span>
   <span style="font-style: italic;">"gptfdisk"</span>
   <span style="font-style: italic;">"cryptsetup"</span>
   <span style="font-style: italic;">"smartmontools"</span>
   <span style="font-style: italic;">"ddrescue"</span>
   <span style="font-style: italic;">"sqlite"</span>
   <span style="font-style: italic;">"libarchive"</span>
   <span style="font-style: italic;">"imagemagick"</span>
   <span style="font-style: italic;">"pngquant"</span>
   <span style="font-style: italic;">"ffmpeg"</span>
   <span style="font-style: italic;">"dav1d"</span>
   <span style="font-style: italic;">"jq"</span>
   <span style="font-style: italic;">"pup"</span>
   <span style="font-style: italic;">"htmlq"</span>
   <span style="font-style: italic;">"python-feedparser"</span>
   <span style="font-style: italic;">"util-linux"</span>
   <span style="font-style: italic;">"binutils"</span>
   <span style="font-style: italic;">"make"</span>
   <span style="font-style: italic;">"llvm"</span>
   <span style="font-style: italic;">"cmake"</span>
   <span style="font-style: italic;">"libtool"</span>
   <span style="font-style: italic;">"pkgconf"</span>
   <span style="font-style: italic;">"texinfo"</span>
   <span style="font-style: italic;">"shellcheck"</span>
   <span style="font-style: italic;">"global"</span>
   <span style="font-style: italic;">"perl"</span>
   <span style="font-style: italic;">"pfetch"</span>
   <span style="font-style: italic;">"neofetch"</span>
   <span style="font-weight: bold; text-decoration: underline;">&lt;&lt;guix-base&gt;&gt;</span>))
</pre>
</div>
</div>
</li>

<li><a id="org4159769"></a>guix desktop profile<br />
<div class="outline-text-5" id="text-org4159769">
<div class="org-src-container">
<pre class="src src-shell"><span style="font-weight: bold;">export</span> <span style="font-weight: bold; font-style: italic;">XDG_DATA_DIRS</span>=${<span style="font-weight: bold; font-style: italic;">GUIX_EXTRA_PROFILES</span>}/desktop/desktop/share:${<span style="font-weight: bold; font-style: italic;">XDG_DATA_DIRS</span>}
<span style="font-weight: bold;">export</span> <span style="font-weight: bold; font-style: italic;">MANPATH</span>=${<span style="font-weight: bold; font-style: italic;">MANPATH</span>}:${<span style="font-weight: bold; font-style: italic;">GUIX_EXTRA_PROFILES</span>}/desktop/desktop/share/man
</pre>
</div>

<div class="org-src-container">
<pre class="src src-scheme">(specifications-&gt;manifest
 '(<span style="font-style: italic;">"font-adobe-source-han-sans"</span>
   <span style="font-style: italic;">"pulseaudio"</span>
   <span style="font-style: italic;">"gparted"</span>
   <span style="font-style: italic;">"vlc"</span>
   <span style="font-style: italic;">"gcompris-qt"</span>
   <span style="font-style: italic;">"gnome-disk-utility"</span>
   <span style="font-style: italic;">"wine64"</span>
   <span style="font-style: italic;">"winetricks"</span>
   <span style="font-style: italic;">"kdeconnect"</span>
   <span style="font-style: italic;">"dia"</span>
   <span style="font-style: italic;">"inkscape"</span>
   <span style="font-style: italic;">"krita"</span>
   <span style="font-style: italic;">"shotwell"</span>
   <span style="font-weight: bold; text-decoration: underline;">&lt;&lt;guix-desktop&gt;&gt;</span>))
</pre>
</div>
</div>
</li>

<li><a id="org6d9df30"></a>guix creative profile&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span><br /></li>

<li><a id="org8e02519"></a>guix emacs profile<br />
<div class="outline-text-5" id="text-org8e02519">
<div class="org-src-container">
<pre class="src src-shell"><span style="font-weight: bold;">export</span> <span style="font-weight: bold; font-style: italic;">XDG_DATA_DIRS</span>=${<span style="font-weight: bold; font-style: italic;">GUIX_EXTRA_PROFILES</span>}/emacs/emacs/share:${<span style="font-weight: bold; font-style: italic;">XDG_DATA_DIRS</span>}
<span style="font-weight: bold;">export</span> <span style="font-weight: bold; font-style: italic;">MANPATH</span>=${<span style="font-weight: bold; font-style: italic;">MANPATH</span>}:${<span style="font-weight: bold; font-style: italic;">GUIX_EXTRA_PROFILES</span>}/emacs/emacs/share/man
</pre>
</div>

<div class="org-src-container">
<pre class="src src-scheme">(specifications-&gt;manifest
 '(<span style="font-weight: bold; text-decoration: underline;">&lt;&lt;guix-emacs&gt;&gt;</span>
   <span style="font-style: italic;">"sicp"</span>
   <span style="font-style: italic;">"isync"</span>
   <span style="font-style: italic;">"stunnel"</span>
   <span style="font-style: italic;">"wordnet"</span>
   <span style="font-style: italic;">"emacs-transient"</span>
   <span style="font-style: italic;">"emacs-compat"</span>))
</pre>
</div>
</div>
</li>
</ul>
</div>

<div id="outline-container-orgdb18164" class="outline-4">
<h4 id="orgdb18164">Activating Profiles</h4>
<div class="outline-text-4" id="text-orgdb18164">
<p>
This script accepts a space-separated list of manifest file names (without extension) under the <code>~/.config/guix/manifests</code> folder and then installs those profiles for the first time.  For example:
</p>

<pre class="example">
activate-profiles base emacs
</pre>


<div class="org-src-container">
<pre class="src src-shell"><span style="font-weight: bold; font-style: italic;">GREEN</span>=<span style="font-style: italic;">'\033[1;32m'</span>
<span style="font-weight: bold; font-style: italic;">RED</span>=<span style="font-style: italic;">'\033[1;30m'</span>
<span style="font-weight: bold; font-style: italic;">NC</span>=<span style="font-style: italic;">'\033[0m'</span>
<span style="font-weight: bold; font-style: italic;">GUIX_EXTRA_PROFILES</span>=$<span style="font-weight: bold; font-style: italic;">HOME</span>/.guix-extra-profiles

<span style="font-weight: bold; font-style: italic;">profiles</span>=$<span style="font-weight: bold; font-style: italic;">*</span>
<span style="font-weight: bold;">if</span> [ $<span style="font-weight: bold; font-style: italic;">#</span> -eq 0 ]; <span style="font-weight: bold;">then</span>
  <span style="font-weight: bold; font-style: italic;">profiles</span>=<span style="font-style: italic;">"$HOME/.config/guix/manifests/*.scm"</span>;
<span style="font-weight: bold;">fi</span>

<span style="font-weight: bold;">for</span> profile<span style="font-weight: bold;"> in</span> $<span style="font-weight: bold; font-style: italic;">profiles</span>; <span style="font-weight: bold;">do</span>
  <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Remove the path and file extension, if any</span>
  <span style="font-weight: bold; font-style: italic;">profileName</span>=$(basename $<span style="font-weight: bold; font-style: italic;">profile</span>)
  <span style="font-weight: bold; font-style: italic;">profileName</span>=<span style="font-style: italic;">"${profileName%.*}"</span>
  <span style="font-weight: bold; font-style: italic;">profilePath</span>=<span style="font-style: italic;">"$GUIX_EXTRA_PROFILES/$profileName"</span>
  <span style="font-weight: bold; font-style: italic;">manifestPath</span>=$<span style="font-weight: bold; font-style: italic;">HOME</span>/.config/guix/manifests/$<span style="font-weight: bold; font-style: italic;">profileName</span>.scm

  <span style="font-weight: bold;">if</span> [ -f $<span style="font-weight: bold; font-style: italic;">manifestPath</span> ]; <span style="font-weight: bold;">then</span>
    <span style="font-weight: bold;">echo</span>
    <span style="font-weight: bold;">echo</span> -e <span style="font-style: italic;">"${GREEN}Activating profile:"</span> $<span style="font-weight: bold; font-style: italic;">manifestPath</span> <span style="font-style: italic;">"${NC}"</span>
    <span style="font-weight: bold;">echo</span>

    mkdir -p $<span style="font-weight: bold; font-style: italic;">profilePath</span>
    guix package --manifest=$<span style="font-weight: bold; font-style: italic;">manifestPath</span> --profile=<span style="font-style: italic;">"$profilePath/$profileName"</span>

    <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Source the new profile</span>
    <span style="font-weight: bold; font-style: italic;">GUIX_PROFILE</span>=<span style="font-style: italic;">"$profilePath/$profileName"</span>
    <span style="font-weight: bold;">if</span> [ -f $<span style="font-weight: bold; font-style: italic;">GUIX_PROFILE</span>/etc/profile ]; <span style="font-weight: bold;">then</span>
      . <span style="font-style: italic;">"$GUIX_PROFILE"</span>/etc/profile
    <span style="font-weight: bold;">else</span>
      <span style="font-weight: bold;">echo</span> -e <span style="font-style: italic;">"${RED}Couldn't find profile:"</span> $<span style="font-weight: bold; font-style: italic;">GUIX_PROFILE</span>/etc/profile <span style="font-style: italic;">"${NC}"</span>
    <span style="font-weight: bold;">fi</span>
  <span style="font-weight: bold;">else</span>
    <span style="font-weight: bold;">echo</span> <span style="font-style: italic;">"No profile found at path"</span> $<span style="font-weight: bold; font-style: italic;">profilePath</span>
  <span style="font-weight: bold;">fi</span>
<span style="font-weight: bold;">done</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp" id="org1f0f81e">(activate-profiles <span style="font-style: italic;">"activate-profiles "</span>
                   (completing-read <span style="font-style: italic;">"profiles: "</span>
                                    (mapcar (<span style="font-weight: bold;">lambda</span> (elt)
                                              (string-join elt <span style="font-style: italic;">" "</span>))
                                            (my/combinations
                                             '(<span style="font-style: italic;">"base"</span> <span style="font-style: italic;">"desktop"</span> <span style="font-style: italic;">"emacs"</span>)))))
</pre>
</div>

<ul class="org-ul">
<li><p>
Automating Script
Update packages in base profile at morning
</p>
<div class="org-src-container">
<pre class="src src-shell">update-channels &amp;&amp; activate-profiles base &amp;&amp; guix gc -d 2m -F 20G
</pre>
</div>
<div class="org-src-container">
<pre class="src src-shell">sudo -i guix pull &amp;&amp; systemctl restart guix-daemon.service
</pre>
</div>
<p>
Update packages in desktop and emacs profile every weekend
</p>
<div class="org-src-container">
<pre class="src src-shell">activate-profiles desktop emacs &amp;&amp; guix gc -d 2m -F 20G
</pre>
</div></li>
</ul>
</div>
</div>

<div id="outline-container-orgfbc8ea0" class="outline-4">
<h4 id="orgfbc8ea0">Updating Channels</h4>
<div class="outline-text-4" id="text-orgfbc8ea0">
<p>
This script makes it easy to update all channels to the latest commit based on an original channel file.
</p>

<pre class="example">
update-channels
</pre>


<p>
You can use ~/.config/guix/channels.scm to replicate exact packages on another machine with
</p>

<pre class="example">
guix pull -C ~/.config/guix/channels.scm
</pre>


<div class="org-src-container">
<pre class="src src-shell">guix pull --channels=$<span style="font-weight: bold; font-style: italic;">HOME</span>/.config/guix/base-channels.scm <span style="font-style: italic;">\</span>
  &amp;&amp; guix describe --format=channels &gt; ~/.config/guix/channels.scm
</pre>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-orgcb06513" class="outline-2">
<h2 id="orgcb06513">System Constituents</h2>
<div class="outline-text-2" id="text-orgcb06513">
</div>
<div id="outline-container-orgc3b0aea" class="outline-3">
<h3 id="orgc3b0aea">Font</h3>
<div class="outline-text-3" id="text-orgc3b0aea">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"font-ipa"</span>
<span style="font-style: italic;">"font-ipa-ex"</span>
<span style="font-style: italic;">"font-google-noto"</span>
<span style="font-style: italic;">"font-inconsolata"</span>
<span style="font-style: italic;">"font-iosevka"</span>
</pre>
</div>
</div>

<div id="outline-container-orgeb72343" class="outline-4">
<h4 id="orgeb72343">Fontconfig</h4>
<div class="outline-text-4" id="text-orgeb72343">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"fontconfig"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-xml">&lt;?<span style="font-weight: bold;">xml</span> <span style="font-style: italic;">version='1.0'</span>?&gt;
&lt;!DOCTYPE fontconfig SYSTEM 'fonts.dtd'&gt;
&lt;<span style="font-weight: bold;">fontconfig</span>&gt;
  &lt;<span style="font-weight: bold;">dir</span>&gt;&lt;&lt;<span style="font-weight: bold;">home-dir</span>()&gt;&gt;/.guix-extra-profiles/base/base/share/fonts&lt;/<span style="font-weight: bold;">dir</span>&gt;
&lt;/<span style="font-weight: bold;">fontconfig</span>&gt;
</pre>
</div>

<p>
install available fonts by rescanning font directories
</p>
<div class="org-src-container">
<pre class="src src-conf">fc-cache -rvf
</pre>
</div>
</div>
</div>

<div id="outline-container-org50c1220" class="outline-4">
<h4 id="org50c1220">Font Viewer</h4>
<div class="outline-text-4" id="text-org50c1220">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"gnome-font-viewer"</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgd1cc88e" class="outline-3">
<h3 id="orgd1cc88e">Bash</h3>
<div class="outline-text-3" id="text-orgd1cc88e">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"bash"</span>
</pre>
</div>

<ul class="org-ul">
<li><p>
bash profile
</p>
<div class="org-src-container">
<pre class="src src-shell"><span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">!/usr/bin/</span><span style="font-weight: bold;">env</span><span style="font-weight: bold; font-style: italic;"> bash</span>

<span style="font-weight: bold;">if</span> [ -f ~/.bashrc ]; <span style="font-weight: bold;">then</span>
  source ~/.bashrc
<span style="font-weight: bold;">fi</span>
</pre>
</div></li>
<li><p>
bashrc
</p>
<div class="org-src-container">
<pre class="src src-bash"><span style="font-weight: bold;">if</span> [ -f ~/.bashrc.secret ]; <span style="font-weight: bold;">then</span>
  source ~/.bashrc.secret
<span style="font-weight: bold;">fi</span>

<span style="font-weight: bold;">export</span> <span style="font-weight: bold; font-style: italic;">EMAIL</span>=&lt;&lt;email&gt;&gt;
<span style="font-weight: bold;">export VIEWER=less</span>

<span style="font-weight: bold;">USER_PATHS=(</span>
<span style="font-weight: bold;">  "${HOME}/usr/bin"</span>
<span style="font-weight: bold;">  "${HOME}/.local/bin"</span>
<span style="font-weight: bold;">)</span>
<span style="font-weight: bold;">for path in "${USER_PATHS[@]}"; do</span>
<span style="font-weight: bold;">  if [ -d "${path}" ]; then</span>
<span style="font-weight: bold;">    export PATH="${path}:$PATH"</span>
<span style="font-weight: bold;">  fi</span>
<span style="font-weight: bold;">done</span>

<span style="font-weight: bold;">if [ -e $HOME/.bash_aliases ]; then</span>
<span style="font-weight: bold;">  source $HOME/.bash_aliases</span>
<span style="font-weight: bold;">fi</span>
<span style="font-weight: bold;">if [ -e $HOME/.bash_functions ]; then</span>
<span style="font-weight: bold;">  source $HOME/.bash_functions</span>
<span style="font-weight: bold;">fi</span>

<span style="font-weight: bold;"># prompt</span>
<span style="font-weight: bold;">MACHINE=$(echo $(uname -n) | awk -F . '{print $1}')</span>
<span style="font-weight: bold;">PS1="[\u@${MACHINE}:\\W]\n\$ "</span>

<span style="font-weight: bold;"># function/variable used in libvterm/emacs</span>
<span style="font-weight: bold;">vterm_printf(){</span>
<span style="font-weight: bold;">  if [ -n "$TMUX" ]; then</span>
<span style="font-weight: bold;">    # Tell tmux to pass the escape sequences through</span>
<span style="font-weight: bold;">    # (Source: http://permalink.gmane.org/gmane.comp.terminal-emulators.tmux.user/1324)</span>
<span style="font-weight: bold;">    printf "\ePtmux;\e\e]%s\007\e\\" "$1"</span>
<span style="font-weight: bold;">  elif [ "${TERM%%-*}" = "screen" ]; then</span>
<span style="font-weight: bold;">    # GNU screen (screen, screen-256color, screen-256color-bce)</span>
<span style="font-weight: bold;">    printf "\eP\e]%s\007\e\\" "$1"</span>
<span style="font-weight: bold;">  else</span>
<span style="font-weight: bold;">    printf "\e]%s\e\\" "$1"</span>
<span style="font-weight: bold;">  fi</span>
<span style="font-weight: bold;">}</span>

<span style="font-weight: bold;">vterm_prompt_end(){</span>
<span style="font-weight: bold;">  vterm_printf "51;A$(whoami)@$(hostname):$(pwd)"</span>
<span style="font-weight: bold;">}</span>

<span style="font-weight: bold;">PROMPT_COMMAND='echo -ne "\033]0;${HOSTNAME}:${PWD}\007"'</span>

<span style="font-weight: bold;">case ${TERM} in</span>
<span style="font-weight: bold;">dumb)</span>
<span style="font-weight: bold;">  ;;</span>
<span style="font-weight: bold;">xterm-256color)</span>
<span style="font-weight: bold;">  export LANG=en_US.UTF-8</span>
<span style="font-weight: bold;">  PS1=$PS1'\[$(vterm_prompt_end)\]'</span>
<span style="font-weight: bold;">  ;;</span>
<span style="font-weight: bold;">*)</span>
<span style="font-weight: bold;">  export LANG=ja_JP.UTF-8</span>
<span style="font-weight: bold;">  ;;</span>
<span style="font-weight: bold;">esac</span>

<span style="font-weight: bold;">export WINEARCH=win64</span>
<span style="font-weight: bold;">export WINEPREFIX=~/.wine</span>

<span style="font-weight: bold;">&lt;&lt;bashrc&gt;&gt;</span>
</pre>
</div></li>
<li><p>
aliases
</p>
<div class="org-src-container">
<pre class="src src-shell">alias ..=<span style="font-style: italic;">"cd ../"</span>
alias <span style="font-weight: bold; font-style: italic;">l</span>=<span style="font-style: italic;">"ls -F"</span>
alias <span style="font-weight: bold; font-style: italic;">ll</span>=<span style="font-style: italic;">"l -lh"</span>
alias <span style="font-weight: bold; font-style: italic;">la</span>=<span style="font-style: italic;">"l -a"</span>
alias <span style="font-weight: bold; font-style: italic;">lal</span>=<span style="font-style: italic;">"l -alh"</span>
alias <span style="font-weight: bold; font-style: italic;">lld</span>=<span style="font-style: italic;">"l -ld"</span>
alias <span style="font-weight: bold; font-style: italic;">cp</span>=<span style="font-style: italic;">"cp -i"</span>
alias <span style="font-weight: bold; font-style: italic;">mv</span>=<span style="font-style: italic;">"mv -i"</span>
alias <span style="font-weight: bold; font-style: italic;">rm</span>=<span style="font-style: italic;">"rm -i"</span>
alias <span style="font-weight: bold; font-style: italic;">rmf</span>=<span style="font-style: italic;">"rm -rf"</span>
alias <span style="font-weight: bold; font-style: italic;">mkdir</span>=<span style="font-style: italic;">"mkdir -pv"</span>
alias <span style="font-weight: bold; font-style: italic;">rmdir</span>=<span style="font-style: italic;">"rmdir -v"</span>
alias <span style="font-weight: bold; font-style: italic;">ff</span>=<span style="font-style: italic;">'find . -type f -iname'</span>

alias <span style="font-weight: bold; font-style: italic;">cputemp</span>=<span style="font-style: italic;">'cat /sys/class/thermal/thermal_zone0/temp'</span>
alias <span style="font-weight: bold; font-style: italic;">ipaddr</span>=<span style="font-style: italic;">"hostname -I | cut -f1 -d' '"</span>
</pre>
</div></li>
<li><p>
functions
</p>
<div class="org-src-container">
<pre class="src src-shell"><span style="font-weight: bold;">function</span> <span style="font-weight: bold;">cl</span>() {
  <span style="font-weight: bold; font-style: italic;">DIR</span>=<span style="font-style: italic;">"$*"</span>;
  <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">if no DIR given, go home</span>
  <span style="font-weight: bold;">if</span> [ $<span style="font-weight: bold; font-style: italic;">#</span> -lt 1 ]; <span style="font-weight: bold;">then</span>
    <span style="font-weight: bold; font-style: italic;">DIR</span>=$<span style="font-weight: bold; font-style: italic;">HOME</span>;
  <span style="font-weight: bold;">fi</span>;

  builtin cd <span style="font-style: italic;">"${DIR}"</span> &amp;&amp; <span style="font-style: italic;">\</span>
    <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">use your preferred ls command</span>
    ls -F --color=auto
}

<span style="font-weight: bold;">function</span> <span style="font-weight: bold;">cpuinfo</span> {
  <span style="font-weight: bold; font-style: italic;">cores</span>=$(nproc)
  <span style="font-weight: bold; font-style: italic;">frequency</span>=$(grep MHz /proc/cpuinfo | head -1 | awk -F <span style="font-style: italic;">' '</span> <span style="font-style: italic;">'{print $4" MHz"}'</span>)
  <span style="font-weight: bold; font-style: italic;">model</span>=$(grep <span style="font-style: italic;">"model name"</span> /proc/cpuinfo | head -1 | sed -r <span style="font-style: italic;">'s/^.{13}//'</span>)
  <span style="font-weight: bold;">echo</span> <span style="font-style: italic;">"CPU Model: $model"</span>
  <span style="font-weight: bold;">echo</span> <span style="font-style: italic;">"CPU Cores: $cores"</span>
  <span style="font-weight: bold;">echo</span> <span style="font-style: italic;">"Frequency: $frequency"</span>
}

<span style="font-weight: bold;">function</span> <span style="font-weight: bold;">dual</span>() {
  <span style="font-weight: bold;">if</span> [ $<span style="font-weight: bold; font-style: italic;">#</span> -eq 0 ]; <span style="font-weight: bold;">then</span>
    <span style="font-weight: bold; font-style: italic;">du_arg</span>=<span style="font-style: italic;">"./* ./.[^.]*"</span>
  <span style="font-weight: bold;">else</span>
    <span style="font-weight: bold; font-style: italic;">du_arg</span>=<span style="font-style: italic;">""</span>
    <span style="font-weight: bold;">for</span> v<span style="font-weight: bold;"> in</span> <span style="font-style: italic;">"$@"</span>
    <span style="font-weight: bold;">do</span>
      <span style="font-weight: bold;">if</span> [ -f ${<span style="font-weight: bold; font-style: italic;">v</span>} ]; <span style="font-weight: bold;">then</span>
        <span style="font-weight: bold; font-style: italic;">du_arg</span>=<span style="font-style: italic;">"${du_arg} ${v}"</span>
      <span style="font-weight: bold;">elif</span> [ -d ${<span style="font-weight: bold; font-style: italic;">v</span>} ]; <span style="font-weight: bold;">then</span>
        <span style="font-weight: bold; font-style: italic;">du_arg</span>=<span style="font-style: italic;">"${du_arg} ${v}/* ${v}/.[^.]*"</span>
      <span style="font-weight: bold;">fi</span>
    <span style="font-weight: bold;">done</span>
  <span style="font-weight: bold;">fi</span>

  ionice -c2 -n7 nice -n19 du -scD ${<span style="font-weight: bold; font-style: italic;">du_arg</span>} 2&gt;/dev/null
}
<span style="font-weight: bold;">export</span> -f dual

<span style="font-weight: bold;">function</span> <span style="font-weight: bold;">mkcdir</span>() {
  mkdir -p -- <span style="font-style: italic;">"$1"</span> &amp;&amp; <span style="font-weight: bold;">cd</span> -P -- <span style="font-style: italic;">"$1"</span>
}

<span style="font-weight: bold;">function</span> <span style="font-weight: bold;">rms</span>() {
  <span style="font-weight: bold;">read</span> -p <span style="font-style: italic;">'shred all files - are you sure (y/n) ? '</span> ans
  <span style="font-weight: bold;">test</span> x$<span style="font-weight: bold; font-style: italic;">ans</span> == xy &amp;&amp; (
    <span style="font-weight: bold;">for</span> file<span style="font-weight: bold;"> in</span> <span style="font-style: italic;">"$@"</span>; <span style="font-weight: bold;">do</span>
      <span style="font-weight: bold;">if</span> [ -f <span style="font-style: italic;">"${file}"</span> ]; <span style="font-weight: bold;">then</span>
        shred -uzv <span style="font-style: italic;">"${file}"</span>
      <span style="font-weight: bold;">elif</span> [ -d <span style="font-style: italic;">"${file}"</span> ]; <span style="font-weight: bold;">then</span>
        find <span style="font-style: italic;">"${file}"</span> -type f -exec shred -uzv {} <span style="font-style: italic;">\;</span>
        rm -rf <span style="font-style: italic;">"${file}"</span>
      <span style="font-weight: bold;">fi</span>
    <span style="font-weight: bold;">done</span>
  )
}

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">A simple script to check on system resources</span>
<span style="font-weight: bold;">function</span> <span style="font-weight: bold;">chksys</span>() {
  clear

  <span style="font-weight: bold;">echo</span> <span style="font-style: italic;">"Memory Usage:"</span>
  /usr/bin/free -h

  <span style="font-weight: bold;">echo</span> $<span style="font-style: italic;">'\n'</span>$<span style="font-style: italic;">"Disk Usage:"</span>
  /bin/df -h /dev/sd[a-z][1-9] 2&gt;/dev/null

  <span style="font-weight: bold;">echo</span> $<span style="font-style: italic;">'\n'</span>$<span style="font-style: italic;">"Uptime:"</span>
  /usr/bin/uptime
}
</pre>
</div></li>
<li><p>
profile
</p>
<div class="org-src-container">
<pre class="src src-shell"><span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">~/.profile: executed by the command interpreter for login shells.</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">This file is not read by bash(1), if ~/.bash_profile or ~/.bash_login</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">exists.</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">see /usr/share/doc/bash/examples/startup-files for examples.</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">the files are located in the bash-doc package.</span>

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">the default umask is set in /etc/profile; for setting the umask</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">for ssh logins, install and configure the libpam-umask package.</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">umask 022</span>

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">if running bash</span>
<span style="font-weight: bold;">if</span> [ -n <span style="font-style: italic;">"$BASH_VERSION"</span> ]; <span style="font-weight: bold;">then</span>
  <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">include .bash_profile if it exists</span>
  <span style="font-weight: bold;">if</span> [ -f <span style="font-style: italic;">"$HOME/.bash_profile"</span> ]; <span style="font-weight: bold;">then</span>
    . <span style="font-style: italic;">"$HOME/.bash_profile"</span>
  <span style="font-weight: bold;">fi</span>
<span style="font-weight: bold;">fi</span>

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">set PATH so it includes user's private bin if it exists</span>
<span style="font-weight: bold;">if</span> [ -d <span style="font-style: italic;">"$HOME/bin"</span> ] ; <span style="font-weight: bold;">then</span>
  <span style="font-weight: bold; font-style: italic;">PATH</span>=<span style="font-style: italic;">"$HOME/bin:$PATH"</span>
<span style="font-weight: bold;">fi</span>

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">set PATH so it includes user's private bin if it exists</span>
<span style="font-weight: bold;">if</span> [ -d <span style="font-style: italic;">"$HOME/.local/bin"</span> ] ; <span style="font-weight: bold;">then</span>
  <span style="font-weight: bold; font-style: italic;">PATH</span>=<span style="font-style: italic;">"$HOME/.local/bin:$PATH"</span>
<span style="font-weight: bold;">fi</span>
</pre>
</div></li>
</ul>
</div>
</div>
<div id="outline-container-org69409c8" class="outline-3">
<h3 id="org69409c8">Systemd</h3>
<div class="outline-text-3" id="text-org69409c8">
<div class="org-src-container">
<pre class="src src-shell"><span style="font-weight: bold;">cd</span> ~/.config/systemd/system/ &amp;&amp; <span style="font-style: italic;">\</span>
  <span style="font-weight: bold;">for</span> sys_service<span style="font-weight: bold;"> in</span> $(ls ./*); <span style="font-weight: bold;">do</span>
    sudo cp -f ${<span style="font-weight: bold; font-style: italic;">sys_service</span>} /etc/systemd/system
  <span style="font-weight: bold;">done</span>

&lt;&lt;systemd-service&gt;&gt;
</pre>
</div>
</div>

<div id="outline-container-orgaf7f441" class="outline-4">
<h4 id="orgaf7f441">systemd-tmpfiles</h4>
<div class="outline-text-4" id="text-orgaf7f441">
<p>
<a href="https://www.freedesktop.org/software/systemd/man/systemd-tmpfiles-setup.service.html">systemd-tmpfiles</a> manages file creation and deletion. In this section, all settings focus on user level file cleanup and deletion under /home directory.
</p>

<p>
You may need to enable systemd-tmpfiles service for user
</p>
<pre class="example">
$ cd /usr/lib/systemd/user
$ cp systemd-tmpfiles-* ~/.config/systemd/user/
</pre>

<div class="org-src-container">
<pre class="src src-conf">systemctl --user enable systemd-tmpfiles-setup.service systemd-tmpfiles-clean.timer
</pre>
</div>

<div class="org-src-container">
<pre class="src src-conf">d &lt;&lt;home-dir()&gt;&gt;/tmp 0755 - - 5d
d &lt;&lt;home-dir()&gt;&gt;/Downloads 0755 - - 4w
&lt;&lt;tmpfiles-cleanup&gt;&gt;
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org4b87743" class="outline-3">
<h3 id="org4b87743">Vixie Cron</h3>
<div class="outline-text-3" id="text-org4b87743">
<p>
A script to reinitialize a set of cron jobs
</p>
<div class="org-src-container">
<pre class="src src-bash">crontab &lt;&lt;home-dir()&gt;&gt;/.config/crontab/&lt;&lt;login-name()&gt;&gt;
</pre>
</div>

<div class="org-src-container">
<pre class="src src-conf">cron-reinit.sh
</pre>
</div>

<div class="org-src-container">
<pre class="src src-conf"><span style="font-weight: bold; font-style: italic;">MAILTO</span>=<span style="font-style: italic;">"&lt;&lt;email&gt;&gt;"</span>

<span style="font-weight: bold; font-style: italic;">BIN_DIR</span>=<span style="font-style: italic;">"&lt;&lt;home-dir()&gt;&gt;/bin"</span>
<span style="font-weight: bold; font-style: italic;">LOG_DIR</span>=<span style="font-style: italic;">"&lt;&lt;log-dir()&gt;&gt;"</span>

&lt;&lt;cronjob-user&gt;&gt;
</pre>
</div>
</div>
</div>

<div id="outline-container-orgbc0ccdc" class="outline-3">
<h3 id="orgbc0ccdc">Btrfs</h3>
<div class="outline-text-3" id="text-orgbc0ccdc">
<p>
Btrfs is a CoW (Copy on Write) file system supports snapshot and send/recv mechanism.
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"btrfs-progs"</span>
</pre>
</div>
</div>

<div id="outline-container-org6b9d070" class="outline-4">
<h4 id="org6b9d070">btrbk</h4>
<div class="outline-text-4" id="text-org6b9d070">
<p>
<a href="https://digint.ch/btrbk/doc/btrbk.1.html">Btrbk</a> supports for taking snapshots and backups
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"btrbk"</span>
</pre>
</div>
</div>

<ul class="org-ul">
<li><a id="org8da03ab"></a>btrbk.conf<br />
<div class="outline-text-5" id="text-org8da03ab">
<p>
<a href="https://digint.ch/btrbk/doc/btrbk.conf.5.html">btrbk.conf documentation</a>
</p>

<div class="org-src-container">
<pre class="src src-conf">timestamp_format long
incremental yes

snapshot_preserve_min 6h
snapshot_preserve 36h 3d 2w

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Create snapshots only if the backup disk is attached</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">snapshot_create ondemand</span>

target_preserve_min latest
target_preserve 8w 6m *y

snapshot_dir snapshots
volume /mnt/home
target /mnt/exbak/&lt;&lt;laptop-node()&gt;&gt;
subvolume home
</pre>
</div>
</div>
</li>

<li><a id="org936e44e"></a>snapshot/backup script<br />
<div class="outline-text-5" id="text-org936e44e">
<div class="org-src-container">
<pre class="src src-shell"><span style="font-weight: bold; font-style: italic;">BTRBK_CONF</span>=&lt;&lt;home-dir()&gt;&gt;/.config/btrbk/btrbk.conf

<span style="font-weight: bold;">&lt;&lt;which(filename="btrbk")&gt;&gt; --config "${BTRBK_CONF}" run</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-conf"><span style="font-weight: bold; font-style: italic;">*/15 * * * * &lt;&lt;which(filename</span>=<span style="font-style: italic;">"pwsudo"</span>)&gt;&gt; &lt;&lt;which(filename=<span style="font-style: italic;">"btrbkhome"</span>)&gt;&gt;
</pre>
</div>
</div>
</li>
</ul>
</div>

<div id="outline-container-org34e0fe0" class="outline-4">
<h4 id="org34e0fe0">snapshots management&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span></h4>
</div>

<div id="outline-container-org211a156" class="outline-4">
<h4 id="org211a156">backup to another device&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span></h4>
</div>
</div>
<div id="outline-container-orgc8dff5d" class="outline-3">
<h3 id="orgc8dff5d">XDG</h3>
<div class="outline-text-3" id="text-orgc8dff5d">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"xdg-utils"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-shell" id="org66b8b68"><span style="font-weight: bold;">echo</span> <span style="font-style: italic;">"${XDG_CONFIG_HOME}"</span>
</pre>
</div>
</div>

<div id="outline-container-orgf1539d3" class="outline-4">
<h4 id="orgf1539d3">xdg-mime</h4>
<div class="outline-text-4" id="text-orgf1539d3">
<ul class="org-ul">
<li><p>
ask default application for text/plain
</p>
<pre class="example">
$ xdg-mime query default text/plain
</pre></li>
</ul>

<div class="org-src-container">
<pre class="src src-conf">[<span style="font-weight: bold; text-decoration: underline;">Added Associations</span>]
<span style="font-weight: bold; font-style: italic;">inode/directory</span>=io.github.celluloid_player.Celluloid.desktop;nemo.desktop;

[<span style="font-weight: bold; text-decoration: underline;">Default Applications</span>]
<span style="font-weight: bold; font-style: italic;">inode/directory</span>=nemo.desktop
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org4be56b9" class="outline-3">
<h3 id="org4be56b9">GnuPG (gpg)</h3>
<div class="outline-text-3" id="text-org4be56b9">
<p>
<a href="https://wiki.archlinux.org/title/GnuPG">
GnuPG - ArchWiki</a>
</p>

<p>
I've chosen to use gpg/gpg-agent and pass on Ubuntu system since pass (password-store) spouts a warning saying there's gpg version mismatch persistently.
</p>
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">"gnupg"</span>
</pre>
</div>

<ul class="org-ul">
<li><p>
gpg config
</p>
<div class="org-src-container">
<pre class="src src-conf">with-keygrip
</pre>
</div></li>
<li><p>
gpg-agent config
</p>
<div class="org-src-container">
<pre class="src src-conf"><span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">pinentry-program /usr/bin/pinentry-curses</span>
pinentry-program /usr/bin/pinentry
allow-emacs-pinentry
allow-loopback-pinentry
enable-ssh-support
<span style="font-weight: bold; font-style: italic;">max-cache-ttl &lt;&lt;hours-in-sec(h</span>=700)&gt;&gt;
<span style="font-weight: bold; font-style: italic;">default-cache-ttl &lt;&lt;hours-in-sec(h</span>=700)&gt;&gt;
<span style="font-weight: bold; font-style: italic;">default-cache-ttl-ssh &lt;&lt;hours-in-sec(h</span>=48)&gt;&gt;
</pre>
</div></li>
<li><p>
mandatory config to use pinentry-curses for gpg-agent
</p>

<div class="org-src-container">
<pre class="src src-shell"><span style="font-weight: bold;">export</span> <span style="font-weight: bold; font-style: italic;">GPG_TTY</span>=$(tty)

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Refresh gpg-agent tty in case user switches into an X session</span>
gpg-connect-agent updatestartuptty /bye &gt;/dev/null
</pre>
</div>

<div class="org-src-container">
<pre class="src src-conf">Match host * exec <span style="font-style: italic;">"gpg-connect-agent UPDATESTARTUPTTY /bye"</span>
</pre>
</div></li>
<li><p>
utility
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp" id="org5a498df">(* h 60 60)
</pre>
</div></li>
</ul>
</div>
</div>

<div id="outline-container-orgbd6b587" class="outline-3">
<h3 id="orgbd6b587">Key Remappers</h3>
<div class="outline-text-3" id="text-orgbd6b587">
</div>

<div id="outline-container-orgde6ded6" class="outline-4">
<h4 id="orgde6ded6">Xremap</h4>
<div class="outline-text-4" id="text-orgde6ded6">
<p>
<a href="https://github.com/k0kubun/xremap">Xremap</a> is a key remapper for Wayland/X11. It's astoundingly fast, customizable and easy-to-use.
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"xremap-x11"</span>
</pre>
</div>
</div>

<ul class="org-ul">
<li><a id="org9d263e6"></a>xremap config<br />
<div class="outline-text-5" id="text-org9d263e6">
<div class="org-src-container">
<pre class="src src-yaml" id="org10090f5">modmap:
  - name: CapsCtrlSwap
    remap:
      CapsLock: Ctrl_L
      Ctrl_L: CapsLock
      Ctrl_R: Super_R
  - name: Enter/Quote as Hyper
    remap:
      KEY_ENTER:
        held: Super_L
        alone: KEY_ENTER
        alone_timeout_millis: 500
      KEY_APOSTROPHE:
        held: Super_L
        alone: KEY_APOSTROPHE
  - name: SandS
    remap:
      Space:
        held: Shift_L
        alone: Space
        alone_timeout_millis: 500
  - name: Left/Right Shift to Equal/Minus
    remap:
      Shift_L:
        held: Shift_L
        alone: KEY_EQUAL
        alone_timeout_millis: 300
      Shift_R:
        held: Shift_R
        alone: KEY_MINUS
        alone_timeout_millis: 300
keymap:
  - name: M-u/H-u to C-u
    exact_match: true
    remap:
      M-KEY_U: Ctrl-KEY_U
      Super-KEY_U: Ctrl-KEY_U
  - name: asdf1234
    exact_match: true
    remap:
      C-Super-a: KEY_1
      C-Super-s: KEY_2
      C-Super-d: KEY_3
      C-Super-f: KEY_4
      C-Super-g: KEY_5
      C-Super-h: KEY_6
      C-Super-j: KEY_7
      C-Super-k: KEY_8
      C-Super-l: KEY_9
      C-Super-semicolon: KEY_0
</pre>
</div>

<p>
As of <span class="timestamp-wrapper"><span class="timestamp">[2024-03-29 Fri]</span></span>, the following configuration to propagate Emacs key bindings for all applications except Emacs does not seem to work correctly.
</p>

<div class="org-src-container">
<pre class="src src-yaml" id="orgaf63597"># keymap:
#   - name: Emacs
#     application:
#       not: [emacs.Emacs]
#     remap:
#       # Cursor
#       C-b: { with_mark: left }
#       C-f: { with_mark: right }
#       C-p: { with_mark: up }
#       C-n: { with_mark: down }
#       # Forward/Backward word
#       M-b: { with_mark: C-left }
#       M-f: { with_mark: C-right }
#       # Beginning/End of line
#       C-a: { with_mark: home }
#       C-e: { with_mark: end }
#       # Page up/down
#       M-v: { with_mark: pageup }
#       C-v: { with_mark: pagedown }
#       # Beginning/End of file
#       M-Shift-comma: { with_mark: C-home }
#       M-Shift-dot: { with_mark: C-end }
#       # Newline
#       C-m: enter
#       C-j: enter
#       C-o: [enter, left]
#       # Copy
#       C-w: [C-x, { set_mark: false }]
#       M-w: [C-c, { set_mark: false }]
#       C-y: [C-v, { set_mark: false }]
#       # Delete
#       C-d: [delete, { set_mark: false }]
#       M-d: [C-delete, { set_mark: false }]
#       # Kill line
#       C-k: [Shift-end, C-x, { set_mark: false }]
#       # Kill word backward
#       Alt-backspace: [C-backspace, {set_mark: false}]
#       # set mark next word continuously.
#       C-M-space: [C-Shift-right, {set_mark: true}]
#       # Undo
#       C-slash: [C-z, { set_mark: false }]
#       C-Shift-ro: C-z
#       # Mark
#       C-space: { set_mark: true }
#       # Search
#       C-s: C-f
#       C-r: Shift-F3
#       M-Shift-5: C-h
#       # Cancel
#       C-g: [esc, { set_mark: false }]
#       # C-x YYY
#       # C-x:
#       #   remap:
#       #     # C-x h (select all)
#       #     h: [C-home, C-a, { set_mark: true }]
#       #     # C-x C-f (open)
#       #     C-f: C-o
#       #     # C-x C-s (save)
#       #     C-s: C-s
#       #     # C-x k (kill tab)
#       #     k: C-f4
#       #     # C-x C-c (exit)
#       #     C-c: C-q
#       #     # C-x u (undo)
#       #     u: [C-z, { set_mark: false }]
</pre>
</div>
</div>
</li>

<li><a id="org267654a"></a>xremap systemd service<br />
<div class="outline-text-5" id="text-org267654a">
<div class="org-src-container">
<pre class="src src-conf">sudo systemctl enable xremap
sudo systemctl start xremap
</pre>
</div>

<div class="org-src-container">
<pre class="src src-conf">[<span style="font-weight: bold; text-decoration: underline;">Unit</span>]
<span style="font-weight: bold; font-style: italic;">Description</span>=xremap daemon

[<span style="font-weight: bold; text-decoration: underline;">Service</span>]
<span style="font-weight: bold; font-style: italic;">ExecStart</span>=&lt;&lt;which(filename=<span style="font-style: italic;">"xremap"</span>)&gt;&gt; --watch=device,config &lt;&lt;conf-dir()&gt;&gt;/xremap/config.yml &lt;&lt;conf-dir()&gt;&gt;/xremap/emacs.yml
<span style="font-weight: bold; font-style: italic;">Restart</span>=always
<span style="font-weight: bold; font-style: italic;">Type</span>=simple

[<span style="font-weight: bold; text-decoration: underline;">Install</span>]
<span style="font-weight: bold; font-style: italic;">WantedBy</span>=multi-user.target
</pre>
</div>
</div>
</li>
</ul>
</div>

<div id="outline-container-org01e100b" class="outline-4">
<h4 id="org01e100b">XKB&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span></h4>
</div>

<div id="outline-container-orgda13e1b" class="outline-4">
<h4 id="orgda13e1b">Interception Tools&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span></h4>
</div>
</div>
</div>

<div id="outline-container-org6e041b6" class="outline-2">
<h2 id="org6e041b6">Application Configurations</h2>
<div class="outline-text-2" id="text-org6e041b6">
<div class="org-src-container">
<pre class="src src-emacs-lisp" id="org368066c">(expand-file-name <span style="font-style: italic;">"~/.local/bin"</span>)
</pre>
</div>
</div>

<div id="outline-container-orgdec3da1" class="outline-3">
<h3 id="gnu-emacs">GNU Emacs</h3>
<div class="outline-text-3" id="text-gnu-emacs">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs"</span>
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">"emacs-next"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-shell"><span style="font-weight: bold;">export</span> <span style="font-weight: bold; font-style: italic;">EDITOR</span>=<span style="font-style: italic;">"emacsclient -c -a emacs"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp" id="orgcdeca1f">no-littering-var-directory
</pre>
</div>
</div>

<div id="outline-container-org49bd268" class="outline-4">
<h4 id="org49bd268">basic configuration</h4>
<div class="outline-text-4" id="text-org49bd268">
</div>

<ul class="org-ul">
<li><a id="org64b3336"></a>early-init.el<br />
<div class="outline-text-5" id="text-org64b3336">
<p>
Early init file defines fundamental variables used from both normal Emacs session and batch mode.
</p>
</div>

<ul class="org-ul">
<li><a id="org9697d39"></a>no-littering<br />
<div class="outline-text-6" id="text-org9697d39">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-no-littering"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp" id="orgaa5bd2f">(<span style="font-weight: bold;">when</span> (fboundp 'startup-redirect-eln-cache)
  (startup-redirect-eln-cache
   (convert-standard-filename
    (expand-file-name  <span style="font-style: italic;">"var/eln-cache/"</span> user-emacs-directory))))

(<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">no-littering</span>)
</pre>
</div>
</div>
</li>

<li><a id="org80a5098"></a>package.el<br />
<div class="outline-text-6" id="text-org80a5098">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">package</span>)

(setopt package-user-dir
        (no-littering-expand-var-file-name <span style="font-style: italic;">"elpa"</span>))

(setopt package-archives
        '((<span style="font-style: italic;">"gnu"</span> . <span style="font-style: italic;">"https://elpa.gnu.org/packages/"</span>)
          (<span style="font-style: italic;">"nongnu"</span> . <span style="font-style: italic;">"https://elpa.nongnu.org/nongnu/"</span>)
          (<span style="font-style: italic;">"melpa"</span> . <span style="font-style: italic;">"https://melpa.org/packages/"</span>)))
(setopt package-archive-priorities
        '((<span style="font-style: italic;">"gnu"</span> . 3)
          (<span style="font-style: italic;">"melpa"</span> . 2)
          (<span style="font-style: italic;">"nongnu"</span> . 1)))
(setopt package-enable-at-startup t)
(setopt package-gnupghome-dir
        (no-littering-expand-var-file-name <span style="font-style: italic;">"elpa/gnupg"</span>))

(<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">package-vc</span>)
</pre>
</div>
</div>
</li>

<li><a id="orgc5e028b"></a>load cl-lib<br />
<div class="outline-text-6" id="text-orgc5e028b">
<p>
Use 'cl-lib' rather than 'cl' package since it is <a href="https://www.gnu.org/savannah-checkouts/gnu/emacs/news/NEWS.27.1">officially deprecated</a>.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">cl-lib</span>)
</pre>
</div>
</div>
</li>

<li><a id="org64ff4b4"></a>use-package<br />
<div class="outline-text-6" id="text-org64ff4b4">
<p>
<a href="https://jwiegley.github.io/use-package/">Official manual</a> is handy especially when you look up <a href="https://jwiegley.github.io/use-package/keywords/">Keywords</a>.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">use-package</span>)
(<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">use-package-ensure</span>)

(setopt use-package-compute-statistics t
        use-package-verbose nil)
(<span style="font-weight: bold;">with-eval-after-load</span> 'my-launch-app
  (keymap-set my/invoke-list-command-map (kbd <span style="font-style: italic;">"u"</span>)
              #'use-package-report))
</pre>
</div>

<p>
use-package depends on following packages internally
</p>
</div>

<ul class="org-ul">
<li><a id="orgdd0075d"></a>diminish<br />
<div class="outline-text-7" id="text-orgdd0075d">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-diminish"</span>
</pre>
</div>
</div>
</li>

<li><a id="org36797e3"></a>delight<br />
<div class="outline-text-7" id="text-org36797e3">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-delight"</span>
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="orgd5f1d46"></a>straight.el&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span><br /></li>

<li><a id="orgf5a0fd6"></a>safe local eval forms<br />
<div class="outline-text-6" id="text-orgf5a0fd6">
<p>
Following hook statements are likely written in .dir-locals.el at the top level of git repositories.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(add-to-list 'safe-local-eval-forms
             '(add-hook 'find-file-hook
                        (<span style="font-weight: bold;">lambda</span> () (<span style="font-weight: bold;">setq-local</span> buffer-save-without-query t))))

(add-to-list 'safe-local-eval-forms
             '(remove-hook 'find-file-hook
                           (<span style="font-weight: bold;">lambda</span> () (<span style="font-weight: bold;">setq-local</span> buffer-save-without-query t))))
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="org7567c01"></a>loading sequence<br />
<ul class="org-ul">
<li><a id="orgbc378b5"></a>custom file<br />
<div class="outline-text-6" id="text-orgbc378b5">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(setopt custom-file
        (expand-file-name <span style="font-style: italic;">"custom.el"</span> user-emacs-directory))

(<span style="font-weight: bold;">when</span> (file-readable-p custom-file)
  (load custom-file))
</pre>
</div>
</div>
</li>

<li><a id="org6d48129"></a>init.el<br />
<div class="outline-text-6" id="text-org6d48129">
<p>
init.el devote itself to call for remaining config files.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">push</span> (file-name-concat user-emacs-directory <span style="font-style: italic;">"lisp"</span>) load-path)
(<span style="font-weight: bold;">push</span> (file-name-concat user-emacs-directory <span style="font-style: italic;">"site-lisp"</span>) load-path)

(<span style="font-weight: bold;">let</span> ((load-match <span style="font-style: italic;">"\\.el$"</span>))
  (mapc #'load-file
        (append (directory-files (file-name-concat user-emacs-directory <span style="font-style: italic;">"lisp"</span>) t load-match)
                (directory-files (file-name-concat user-emacs-directory <span style="font-style: italic;">"lisp/tangled"</span>) t load-match))))
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="orga0e2448"></a>Themes<br />
<div class="outline-text-5" id="text-orga0e2448">
<p>
The theme of my choice at present
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">with-eval-after-load</span> 'ef-themes
  (load-theme 'ef-bio <span style="font-weight: bold;">:no-confirm</span>))
</pre>
</div>
</div>

<ul class="org-ul">
<li><a id="orgcf0852d"></a>modus-themes<br />
<div class="outline-text-6" id="text-orgcf0852d">
<p>
I love modus-theme which <a href="https://protesilaos.com/codelog/2019-08-07-emacs-modus-themes/">conforms to WCAG AAA</a>. <a href="https://protesilaos.com/codelog/2022-04-21-modus-themes-colour-theory/">This blog post</a> explains how this package determines colors theoretically and perceptually.
</p>

<p>
Following configuration is for version 4 of modus-themes which takes breaking change from previous major version.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package modus-themes
  <span style="font-weight: bold;">:disabled</span> t
  <span style="font-weight: bold;">:custom</span>
  (modus-themes-to-toggle '(modus-vivendi
                            modus-vivendi-tinted
                            modus-vivendi-deuteranopia))
  (modus-themes-org-blocks 'tinted-background)
  (modus-themes-bold-constructs t)
  <span style="font-weight: bold;">:config</span>
  (customize-set-variable 'modus-themes-common-palette-overrides
                          modus-themes-preset-overrides-faint)
  (bind-keys (<span style="font-style: italic;">"&lt;f6&gt;"</span> . modus-themes-toggle)))
</pre>
</div>
</div>
</li>

<li><a id="org9069305"></a>ef-themes<br />
<div class="outline-text-6" id="text-org9069305">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-ef-themes"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package ef-themes
  <span style="font-weight: bold;">:init</span>
  (<span style="font-weight: bold;">setq</span> ef-bio-palette-overrides
        '((cursor <span style="font-style: italic;">"#ffffff"</span>)))
  <span style="font-weight: bold;">:custom</span>
  (ef-themes-to-toggle ef-themes-dark-themes)
  <span style="font-weight: bold;">:config</span>
  (bind-keys (<span style="font-style: italic;">"&lt;f9&gt;"</span> . ef-themes-toggle)))
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="orgc2ca3bf"></a>Basic Preferences<br />
<div class="outline-text-5" id="text-orgc2ca3bf">
<p>
Settings in this section are influenced a great deal by my personal preference. Please be meticulous when you borrow.
</p>
</div>

<ul class="org-ul">
<li><a id="orgbcffeda"></a>Modifier Keys<br />
<div class="outline-text-6" id="text-orgbcffeda">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">cond</span>
 ((string= window-system <span style="font-style: italic;">"x"</span>)
  (<span style="font-weight: bold;">setf</span> x-meta-keysym 'meta
        x-alt-keysym 'meta
        x-super-keysym 'hyper))
 ((string= window-system <span style="font-style: italic;">"ns"</span>)
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">IME inline patch</span>
  (<span style="font-weight: bold;">setf</span> mac-use-input-method-on-system nil)
  (<span style="font-weight: bold;">setf</span> mac-control-modifier       'control
        mac-command-modifier       'meta
        mac-option-modifier        'super
        mac-right-option-modifier  'alt
        mac-right-control-modifier 'super
        mac-function-modifier      'hyper)))
</pre>
</div>
</div>
</li>

<li><a id="orge398861"></a>Basic Key Bindings<br />
<div class="outline-text-6" id="text-orge398861">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(global-set-key (kbd <span style="font-style: italic;">"M-F"</span>) #'forward-to-word)
(global-set-key (kbd <span style="font-style: italic;">"M-B"</span>) #'backward-to-word)
(global-set-key (kbd <span style="font-style: italic;">"C-c d"</span>) #'duplicate-dwim)
(global-set-key (kbd <span style="font-style: italic;">"C-c j"</span>) #'join-line)
(global-set-key (kbd <span style="font-style: italic;">"C-c M-d"</span>) #'copy-from-above-command)
(global-set-key (kbd <span style="font-style: italic;">"M-z"</span>) #'zap-up-to-char)

(global-set-key (kbd <span style="font-style: italic;">"C-c k"</span>) #'kill-this-buffer)
(global-set-key (kbd <span style="font-style: italic;">"C-x M-r"</span>) #'rename-visited-file)
(global-set-key (kbd <span style="font-style: italic;">"C-M-&lt;delete&gt;"</span>) #'restart-emacs)
(global-set-key (kbd <span style="font-style: italic;">"C-M-S-&lt;delete&gt;"</span>) #'save-buffers-kill-emacs)

(substitute-key-definition 'upcase-region
                           'upcase-dwim
                           global-map)
(substitute-key-definition 'downcase-region
                           'downcase-dwim
                           global-map)
(global-set-key (kbd <span style="font-style: italic;">"C-x C-c"</span>) #'capitalize-dwim)
</pre>
</div>

<ul class="org-ul">
<li><p>
Bind for C-x C-b, use <a href="ibuffer">ibuffer</a> which has more features than <a href="list-buffers">list-buffers</a> based on <a href="https://irreal.org/blog/?p=10329">this advice</a>.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(substitute-key-definition 'list-buffers
                           'ibuffer
                           global-map)
</pre>
</div></li>

<li><p>
bind find-functions and finder commands
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(find-function-setup-keys)

(define-key ctl-x-map <span style="font-style: italic;">"C"</span> 'finder-commentary)
</pre>
</div></li>
</ul>
</div>
</li>

<li><a id="org4c8c573"></a>Unleash Disabled Commands<br />
<div class="outline-text-6" id="text-org4c8c573">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(put 'upcase-region 'disabled nil)
(put 'downcase-region 'disabled nil)
(put 'narrow-to-region 'disabled nil)
(put 'set-goal-column 'disabled nil)
(put 'buffer-save-without-query 'disabled nil)
(put 'scroll-left 'disabled nil)
(put 'scroll-right 'disabled nil)
</pre>
</div>
</div>
</li>

<li><a id="orgb3018a9"></a>Language<br />
<div class="outline-text-6" id="text-orgb3018a9">
<p>
<a href="https://www.gnu.org/software/emacs/manual/html_mono/emacs.html#Language-Environments">emacs#Language Environments</a>
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">language and locale</span>
(set-language-environment <span style="font-style: italic;">"Japanese"</span>)
(<span style="font-weight: bold;">setq</span> system-time-locale <span style="font-style: italic;">"C"</span>)

<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">coding system</span>
(set-default-coding-systems 'utf-8-unix)
(prefer-coding-system 'utf-8-unix)
(set-selection-coding-system 'utf-8-unix)

<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">prefer-coding-system take effect equally to follows</span>
(set-buffer-file-coding-system 'utf-8-unix)
(set-file-name-coding-system 'utf-8-unix)
(set-terminal-coding-system 'utf-8-unix)
(set-keyboard-coding-system 'utf-8-unix)
(<span style="font-weight: bold;">setq</span> locale-coding-system 'utf-8-unix)
</pre>
</div>
</div>
</li>

<li><a id="org4832a64"></a>Fontsets<br />
<div class="outline-text-6" id="text-org4832a64">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(create-fontset-from-ascii-font <span style="font-style: italic;">"IPAGothic"</span> nil <span style="font-style: italic;">"default"</span>)

(create-fontset-from-ascii-font <span style="font-style: italic;">"IPAexMincho"</span> nil <span style="font-style: italic;">"exmincho"</span>)
(set-fontset-font <span style="font-style: italic;">"fontset-exmincho"</span> 'japanese-jisx0208 <span style="font-style: italic;">"IPAexMincho"</span>)

(create-fontset-from-ascii-font <span style="font-style: italic;">"IPAexGothic"</span> nil <span style="font-style: italic;">"exgothic"</span>)
(set-fontset-font <span style="font-style: italic;">"fontset-exgothic"</span> 'japanese-jisx0208 <span style="font-style: italic;">"IPAexGothic"</span>)

(create-fontset-from-ascii-font <span style="font-style: italic;">"IPAMincho"</span> nil <span style="font-style: italic;">"mincho"</span>)
(set-fontset-font <span style="font-style: italic;">"fontset-mincho"</span> 'japanese-jisx0208 <span style="font-style: italic;">"IPAMincho"</span>)
(set-fontset-font <span style="font-style: italic;">"fontset-mincho"</span> 'symbol <span style="font-style: italic;">"IPAMincho"</span>)

(create-fontset-from-ascii-font <span style="font-style: italic;">"Iosevka"</span> nil <span style="font-style: italic;">"code"</span>)
(set-fontset-font <span style="font-style: italic;">"fontset-code"</span> 'latin (font-spec <span style="font-weight: bold;">:family</span> <span style="font-style: italic;">"Iosevka"</span> <span style="font-weight: bold;">:weight</span> 'Light <span style="font-weight: bold;">:width</span> 'Normal))

<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">foreign fonts for all fontsets</span>
(set-fontset-font t 'emoji <span style="font-style: italic;">"Noto Color Emoji"</span>)
(set-fontset-font t 'symbol <span style="font-style: italic;">"Noto Sans CJK JP"</span> nil 'append)
(set-fontset-font t 'symbol <span style="font-style: italic;">"Noto Sans Symbols"</span> nil 'append)
(set-fontset-font t 'symbol <span style="font-style: italic;">"Noto Sans Symbols2"</span> nil 'append)
</pre>
</div>
</div>
</li>

<li><a id="org687c5f2"></a>Faces<br />
<div class="outline-text-6" id="text-org687c5f2">
<p>
Caveat: <a href="https://en.wikipedia.org/wiki/Leber%27s_hereditary_optic_neuropathy">I am visually impaired</a>, so the font size for the default face is extraordinarily large.
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">face name</th>
<th scope="col" class="org-left">font</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">default</td>
<td class="org-left">IPAGothic</td>
</tr>

<tr>
<td class="org-left">fixed-pitch</td>
<td class="org-left">IPAMincho</td>
</tr>

<tr>
<td class="org-left">fixed-pitch-serif</td>
<td class="org-left">Iosevka</td>
</tr>

<tr>
<td class="org-left">variable-pitch</td>
<td class="org-left">IPAExMincho</td>
</tr>

<tr>
<td class="org-left">variable-pitch-text</td>
<td class="org-left">IPAExGothic</td>
</tr>
</tbody>
</table>

<div class="org-src-container">
<pre class="src src-emacs-lisp" id="org175186d">(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my/default-pixel-width</span> 2560 <span style="font-style: italic;">"Default display width in pixel."</span>)
(<span style="font-weight: bold;">defmacro</span> <span style="font-weight: bold;">my/normalized-font-size</span> (original-size)
  <span style="font-style: italic;">"This macro culculates normalized font size for display resolution at runtime.</span>
<span style="font-style: italic;">It tries to proportionate ORIGINAL-SIZE in `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">my/default-pixel-width</span><span style="font-style: italic;">' in the display at runtime."</span>
  `(truncate (* ,original-size (/ (float (x-display-pixel-width))
                                  ,my/default-pixel-width))))

(set-face-attribute 'default
                    nil
                    <span style="font-weight: bold;">:font</span> <span style="font-style: italic;">"fontset-default"</span>
                    <span style="font-weight: bold;">:height</span> (my/normalized-font-size 620))
(set-face-attribute 'fixed-pitch
                    nil
                    <span style="font-weight: bold;">:font</span> <span style="font-style: italic;">"fontset-mincho"</span>)
(set-face-attribute 'fixed-pitch-serif
                    nil
                    <span style="font-weight: bold;">:font</span> <span style="font-style: italic;">"fontset-code"</span>)
(set-face-attribute 'variable-pitch
                    nil
                    <span style="font-weight: bold;">:font</span> <span style="font-style: italic;">"fontset-exmincho"</span>)
(set-face-attribute 'variable-pitch-text
                    nil
                    <span style="font-weight: bold;">:font</span> <span style="font-style: italic;">"fontset-exgothic"</span>)

(use-package face
  <span style="font-weight: bold;">:no-require</span> t
  <span style="font-weight: bold;">:hook</span>
  ((eww-mode mastodon-mode nov-mode mu4e-view-mode elfeed-show-mode)
   . (<span style="font-weight: bold;">lambda</span> ()
       (buffer-face-set (check-face 'variable-pitch-text))
       (text-scale-set 5.0)))
  ((Info-mode help-mode helpful-mode woman-mode devdocs-mode)
   . (<span style="font-weight: bold;">lambda</span> ()
       (buffer-face-set (check-face 'default))
       (text-scale-set 1.3)))
  ((org-mode text-mode mu4e-compose-mode)
   . (<span style="font-weight: bold;">lambda</span> ()
       (buffer-face-set (check-face 'default))))
  ((prog-mode shell-mode term-mode vterm-mode eshell-mode calendar-mode)
   . (<span style="font-weight: bold;">lambda</span> ()
       (buffer-face-set (check-face 'fixed-pitch-serif))
       (text-scale-set -1.2)))
  ((dired-mode mu4e-headers-mode elfeed-search-update)
   . (<span style="font-weight: bold;">lambda</span> ()
       (buffer-face-set (check-face 'fixed-pitch)))))
</pre>
</div>
</div>
</li>

<li><a id="org1b360ed"></a>Performance Tuning<br />
<div class="outline-text-6" id="text-org1b360ed">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">setq</span> auto-window-vscroll nil)
(<span style="font-weight: bold;">setq-default</span> bidi-display-reordering nil)
(<span style="font-weight: bold;">setq</span> bidi-inhibit-bpa t)
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="org90117c8"></a>Custom Variables<br />
<div class="outline-text-5" id="text-org90117c8">
<p>
Entries in this section represnets <a href="https://www.gnu.org/software/emacs/manual/html_mono/emacs.html#Customization-Groups">Customization Groups</a> hierarchy.
</p>
</div>

<ul class="org-ul">
<li><a id="org58d511e"></a>Files<br />
<div class="outline-text-6" id="text-org58d511e">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(setopt create-lockfiles nil
        remote-file-name-inhibit-locks t)
</pre>
</div>
</div>

<ul class="org-ul">
<li><a id="orgcd0769a"></a>Auto Revert<br />
<div class="outline-text-7" id="text-orgcd0769a">
<p>
<a href="https://www.gnu.org/software/emacs/manual/html_mono/emacs.html#Auto-Revert">Auto Revert</a>: Keeping buffers automatically up-to-date.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package autorevert
  <span style="font-weight: bold;">:diminish</span> (global-auto-revert-mode auto-revert-mode)
  <span style="font-weight: bold;">:custom</span>
  (auto-revert-verbose nil)
  (global-auto-revert-non-file-buffers t)
  (auto-revert-interval 3)
  (auto-revert-check-vc-info t)
  (global-auto-revert-mode t))
</pre>
</div>
</div>
</li>

<li><a id="orgfb87d9f"></a>Auto Save<br />
<div class="outline-text-7" id="text-orgfb87d9f">
<p>
<a href="https://www.gnu.org/software/emacs/manual/html_mono/emacs.html#Auto-Save">Auto Save mode</a> saves the file you are editing periodically, whereas <a href="auto-save-visited-mode">auto-save-visited-mode</a> saves all  open buffers in Emacs session.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(setopt auto-save-default t
        auto-save-interval 200
        auto-save-timeout 25
        auto-save-file-name-transforms
        `((<span style="font-style: italic;">".*"</span> ,(no-littering-expand-var-file-name <span style="font-style: italic;">"auto-save/files"</span>) t))
        delete-auto-save-files t
        kill-buffer-delete-auto-save-files t
        auto-save-no-message t)

(setopt auto-save-visited-mode t
        auto-save-visited-interval 10)
(put 'auto-save-visited-mode 'disabled nil)

(setopt delete-by-moving-to-trash t)
(setopt save-some-buffers-default-predicate 'save-some-buffers-root)
</pre>
</div>
</div>
</li>

<li><a id="orga64630f"></a>Uniquify<br />
<div class="outline-text-7" id="text-orga64630f">
<p>
<a href="https://www.gnu.org/software/emacs/manual/html_mono/emacs.html#Uniquify">Uniquify</a> shows buffer name easy to distinguish.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package uniquify
  <span style="font-weight: bold;">:custom</span>
  (uniquify-buffer-name-style 'post-forward))
</pre>
</div>
</div>
</li>

<li><a id="orgd21b190"></a>Recentf<br />
<div class="outline-text-7" id="text-orgd21b190">
<p>
<a href="https://www.gnu.org/software/emacs/manual/html_mono/emacs.html#File-Conveniences">emacs#File Conveniences</a>
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package recentf
  <span style="font-weight: bold;">:defer</span> 30
  <span style="font-weight: bold;">:custom</span>
  (recentf-exclude '(<span style="font-style: italic;">".gz"</span> <span style="font-style: italic;">".xz"</span> <span style="font-style: italic;">".zip"</span> <span style="font-style: italic;">".gpg"</span>))
  (recentf-max-saved-items 500)
  (recentf-auto-cleanup (* 7 60)) <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">clean-up when idle time reaches 7 minutes</span>
  <span style="font-weight: bold;">:config</span>
  (recentf-mode 1))
</pre>
</div>
</div>
</li>

<li><a id="org8b48379"></a>Tramp<br />
<div class="outline-text-7" id="text-org8b48379">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package tramp
  <span style="font-weight: bold;">:defer</span> t
  <span style="font-weight: bold;">:custom</span>
  (tramp-default-method <span style="font-style: italic;">"ssh"</span>)
  <span style="font-weight: bold;">:config</span>
  (add-to-list 'tramp-remote-path 'tramp-own-remote-path)
  (add-to-list 'tramp-remote-path <span style="font-style: italic;">"~/bin"</span>))
</pre>
</div>
</div>
</li>

<li><a id="org1b19a75"></a>Find File<br />
<div class="outline-text-7" id="text-org1b19a75">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(setopt large-file-warning-threshold 30000000)
(setopt revert-buffer-quick-short-answers t)
</pre>
</div>
</div>
</li>

<li><a id="orgec733cc"></a>Backup<br />
<div class="outline-text-7" id="text-orgec733cc">
<p>
I no longer use backup functionality. Even if I reinstate it, backing up by copying must be rational.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(setopt make-backup-files nil
        backup-by-copying t
        backup-directory-alist
        `((<span style="font-style: italic;">"."</span> . ,(no-littering-expand-var-file-name <span style="font-style: italic;">"backup"</span>))))
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="org630872b"></a>Environment<br />
<ul class="org-ul">
<li><a id="orgc5f8a1d"></a>Initialization<br />
<div class="outline-text-7" id="text-orgc5f8a1d">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(setopt initial-scratch-message <span style="font-style: italic;">""</span>)
(setopt inhibit-startup-screen t)
</pre>
</div>
</div>
</li>

<li><a id="orgbec8b26"></a>Frames<br />
<div class="outline-text-7" id="text-orgbec8b26">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(tool-bar-mode -1)
(menu-bar-mode -1)
(scroll-bar-mode -1)
</pre>
</div>
</div>

<ul class="org-ul">
<li><a id="org228619d"></a>Fringe<br />
<div class="outline-text-8" id="text-org228619d">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(set-fringe-mode 15)
(<span style="font-weight: bold;">setq-default</span> indicate-buffer-boundaries 'left)
</pre>
</div>
</div>
</li>

<li><a id="org5e5dbdc"></a>Two Column<br />
<div class="outline-text-8" id="text-org5e5dbdc">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package two-column
  <span style="font-weight: bold;">:commands</span> (2C-two-columns 2C-split 2C-associate-buffer)
  <span style="font-weight: bold;">:custom</span>
  (2C-window-width 25))
</pre>
</div>
</div>
</li>

<li><a id="org15a63d8"></a>Desktop<br />
<div class="outline-text-8" id="text-org15a63d8">
<p>
<a href="https://www.gnu.org/software/emacs/manual/html_mono/emacs.html#Saving-Emacs-Sessions">Info manual for Saving Emacs Sessions</a> describes how to set up desktop-save-mode.
'&#x2013;no-desktop' option for emacs command will disable forcibly desktop-save-mode .
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package desktop
  <span style="font-weight: bold;">:commands</span> (desktop-save)
  <span style="font-weight: bold;">:custom</span>
  (desktop-restore-frames t)
  (desktop-restore-eager 1)
  (desktop-lazy-idle-delay 5)
  <span style="font-weight: bold;">:config</span>
  (desktop-change-dir (expand-file-name <span style="font-style: italic;">"desktop"</span> user-emacs-directory))
  (desktop-save-mode 1))
</pre>
</div>
</div>
</li>

<li><a id="orgba1ee8d"></a>Cursor<br />
<div class="outline-text-8" id="text-orgba1ee8d">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(setopt blink-cursor-blinks 15
        blink-cursor-delay 0.7
        blink-cursor-interval 0.35
        blink-cursor-mode t)
</pre>
</div>
</div>
</li>

<li><a id="orgb337f8e"></a>Scrolling<br />
<div class="outline-text-8" id="text-orgb337f8e">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(setopt fast-but-imprecise-scrolling t)
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="orgc362aac"></a>Display<br />
<div class="outline-text-7" id="text-orgc362aac">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">do not use visual bell</span>
(setopt visible-bell nil)

(setopt text-scale-mode-step 1.0625
        highlight-nonselected-windows t
        truncate-lines t
        x-underline-at-descent-line nil)
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">avoid to break at whitespace in Japanese</span>
(setopt word-wrap-by-category t)
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">suppress curved quotes in docstring (for emacs25)</span>
(setopt text-quoting-style 'straight)
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">resize frame size responding to font size</span>
(setopt global-text-scale-adjust-resizes-frames t)
</pre>
</div>
</div>
</li>

<li><a id="orgd345e34"></a>Windows<br />
<div class="outline-text-7" id="text-orgd345e34">
<p>
<a href="https://www.masteringemacs.org/article/demystifying-emacs-window-manager?utm_source=newsletter&amp;utm_medium=email&amp;utm_campaign=rss">This blog post</a> is must-read when you tweak display-buffer facilities or something related to display settings.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(setopt scroll-step 1
        scroll-conservatively 101
        next-screen-context-lines 2
        scroll-preserve-screen-position t)
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">display buffer</span>
(setopt display-buffer-base-action
        '((display-buffer-same-window
           display-buffer-reuse-window
           display-buffer-reuse-mode-window
           display-buffer-in-previous-window)))

(bind-keys <span style="font-weight: bold;">:map</span> other-window-repeat-map
           (<span style="font-style: italic;">"0"</span> . delete-window)
           (<span style="font-style: italic;">"1"</span> . delete-other-windows))
</pre>
</div>
</div>

<ul class="org-ul">
<li><a id="org5bd0ca1"></a>Winner<br />
<div class="outline-text-8" id="text-org5bd0ca1">
<p>
Triple Escape (M-ESC ESC) has got to reset window layout by tweaking buffer-quit-function.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package winner
  <span style="font-weight: bold;">:bind</span> ((<span style="font-style: italic;">"C-z"</span> . winner-undo)
         (<span style="font-style: italic;">"C-M-z"</span> . winner-redo))
  <span style="font-weight: bold;">:custom</span>
  (winner-mode t)
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">setq</span> buffer-quit-function 'winner-undo))
</pre>
</div>
</div>
</li>

<li><a id="orgdbdf8cb"></a>Windmove<br />
<div class="outline-text-8" id="text-orgdbdf8cb">
<p>
You can now switch windows with your shift key by pressing S-&lt;left&gt;, S-&lt;right&gt;, S-&lt;up&gt;, S-&lt;down&gt;.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package windmove
  <span style="font-weight: bold;">:custom</span>
  (windmove-mode t)
  (windmove-wrap-around t)
  <span style="font-weight: bold;">:config</span>
  (windmove-default-keybindings '(control shift)))
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="orge3c201d"></a>Minibuffer<br />
<div class="outline-text-7" id="text-orge3c201d">
<p>
Formerly, I used to bind C-h to `backward-delete-char' and M-h to `backward-kill-word', which was very comfortable. However, I realized that C-h must be a help key, as many Emacs packages are developed based on the assumption that "C-h is a help key". Having said that, in the minibuffer where a help key does not necessarily play a significant role, I decided to bind C-h to `backward-delete-char'.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(keymap-set minibuffer-mode-map
            <span style="font-style: italic;">"C-h"</span> #'delete-backward-char)
(keymap-set minibuffer-mode-map
            <span style="font-style: italic;">"M-h"</span> #'backward-kill-word)
(keymap-set minibuffer-mode-map <span style="font-style: italic;">"TAB"</span> 'minibuffer-complete)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(setopt history-length 1500)
(setopt history-delete-duplicates t)
(setopt enable-recursive-minibuffers t)
(setopt minibuffer-depth-indicate-mode t)
(setopt read-file-name-completion-ignore-case t)
(setopt read-minibuffer-restore-windows t)
(setopt minibuffer-default-prompt-format <span style="font-style: italic;">" [%s]"</span>)
(setopt completion-cycle-threshold 1)
(setopt completions-detailed t)

(add-hook 'minibuffer-setup-hook 'my/minibuffer-setup-function)
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/minibuffer-setup-function</span> ()
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">disable input method in mini buffer</span>
  (<span style="font-weight: bold;">when</span> current-input-method
    (deactivate-input-method))
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">decrease font size to 90% in minibuffer</span>
  (<span style="font-weight: bold;">setq-local</span> face-remapping-alist '((default <span style="font-weight: bold;">:height</span> 0.9))))
</pre>
</div>
</div>

<ul class="org-ul">
<li><a id="org9d833a5"></a>Savehist<br />
<div class="outline-text-8" id="text-org9d833a5">
<p>
<a href="savehist-mode">savehist-mode</a> saves minibuffer history and additionals.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package savehist
  <span style="font-weight: bold;">:custom</span>
  (savehist-save-minibuffer-history t)
  (savehist-additional-variables '((kill-ring . 1000)
                                   (register-alist . 200)))
  (savehist-autosave-interval 180)
  <span style="font-weight: bold;">:hook</span>
  (after-init . savehist-mode))
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="org2adad7d"></a>Menu<br />
<div class="outline-text-7" id="text-org2adad7d">
<p>
<a href="https://christiantietze.de/posts/2022/12/use-file-open-dialog-for-file-actions/">This blog post</a> demonstrates for emacsers who have disabled file pickers and dialog boxes to adversely use them temporalily.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(setopt use-short-answers t)
(setopt use-file-dialog nil)
</pre>
</div>
</div>
</li>

<li><a id="org484c5ff"></a>Mode Line<br />
<div class="outline-text-7" id="text-org484c5ff">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my/mode-line-buffer-name-length-max</span> 15
  <span style="font-style: italic;">"Fixed length for displaying buffer name in mode line."</span>)

(setopt line-number-mode nil
        column-number-mode nil
        mode-line-compact t)
(setopt
 mode-line-format
 '(<span style="font-style: italic;">"%e"</span>
   mode-line-front-space
   (<span style="font-weight: bold;">:eval</span>
    (<span style="font-weight: bold;">let</span> ((mode-line-buffer-name
           (replace-regexp-in-string <span style="font-style: italic;">" %</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">[[:ascii:]]</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">"</span> <span style="font-style: italic;">" %%\\1"</span>
                                     (truncate-string-to-width
                                      (buffer-name) my/mode-line-buffer-name-length-max nil ? t))))
      (<span style="font-weight: bold;">cond</span>
       (buffer-read-only
        (propertize mode-line-buffer-name 'face 'underline))
       ((buffer-modified-p)
        (propertize mode-line-buffer-name 'face 'warning))
       (mode-line-buffer-name))))
   (<span style="font-weight: bold;">:eval</span>
    (<span style="font-weight: bold;">cond</span>
     ((<span style="font-weight: bold;">and</span> line-number-mode
           column-number-mode)
      mode-line-position-column-line-format)
     (line-number-mode mode-line-position-line-format)
     (column-number-mode mode-line-position-column-format)))
   <span style="font-style: italic;">" "</span>
   global-mode-string))
</pre>
</div>
</div>

<ul class="org-ul">
<li><a id="org824b9f4"></a>Display Time<br />
<div class="outline-text-8" id="text-org824b9f4">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(setopt
 display-time-string-forms
 '((propertize (format-time-string <span style="font-style: italic;">"%H:%M"</span> now) 'face 'mode-line-highlight)))
(setopt display-time-mode t)
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="org1eb5e4a"></a>Mouse<br />
<div class="outline-text-7" id="text-org1eb5e4a">
<p>
Mouse needs to be unobtrusive in my Emacs experience.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package mouse
  <span style="font-weight: bold;">:custom</span>
  (mouse-1-click-follows-link nil)
  (mouse-highlight nil)
  (mouse-wheel-mode nil))

(use-package pixel-scroll
  <span style="font-weight: bold;">:custom</span>
  (pixel-scroll-precision-mode t))
</pre>
</div>
</div>

<ul class="org-ul">
<li><a id="org10bd10b"></a>Tool Tips<br />
<div class="outline-text-8" id="text-org10bd10b">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(tooltip-mode -1)
(<span style="font-weight: bold;">setq</span> x-gtk-use-system-tooltips nil)
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="org7cfff04"></a>Hardware<br />
<div class="outline-text-7" id="text-org7cfff04">
</div>

<ul class="org-ul">
<li><a id="org5f8816d"></a>Battery<br />
<div class="outline-text-8" id="text-org5f8816d">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package battery
  <span style="font-weight: bold;">:after</span> my-launch-app
  <span style="font-weight: bold;">:bind</span> (<span style="font-weight: bold;">:map</span> my/launch-app-map
              (<span style="font-style: italic;">"b"</span> . battery)))
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="orgccfa025"></a>Installation<br />
<div class="outline-text-7" id="text-orgccfa025">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package tutorial
  <span style="font-weight: bold;">:commands</span> help-with-tutorial
  <span style="font-weight: bold;">:preface</span>
  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/tutorial--saved-dir</span> ()
    (locate-user-emacs-file
     (no-littering-expand-var-file-name <span style="font-style: italic;">"tutorial/"</span>)
     (expand-file-name <span style="font-style: italic;">"tutorial/"</span> user-emacs-directory)))
  <span style="font-weight: bold;">:config</span>
  (advice-add #'tutorial--saved-dir <span style="font-weight: bold;">:override</span>
              #'my/tutorial--saved-dir))
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="orga9a2ce4"></a>Convenience<br />
<div class="outline-text-6" id="text-orga9a2ce4">
<p>
subword-mode enables to recognize 'RSS' and 'Feed' are separate words in 'RSSFeed'
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(repeat-mode 1)
(global-subword-mode 1)
</pre>
</div>
</div>

<ul class="org-ul">
<li><a id="orgf26a259"></a>Abbreviations<br />
<div class="outline-text-7" id="text-orgf26a259">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package abbrev
  <span style="font-weight: bold;">:diminish</span> abbrev-mode
  <span style="font-weight: bold;">:custom</span>
  (save-abbrevs t)
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">setq-default</span> abbrev-mode 1)
  (quietly-read-abbrev-file))
</pre>
</div>
</div>
</li>

<li><a id="orgdcd4449"></a>Hippie Expand<br />
<div class="outline-text-7" id="text-orgdcd4449">
<p>
<a href="https://www.masteringemacs.org/article/text-expansion-hippie-expand">As this blog post mentions</a>, Hippie Expansion is superior to dabbrev, skeleton and company in the field of auto typing.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package hippie-exp
  <span style="font-weight: bold;">:bind</span> ([remap dabbrev-expand] . hippie-expand))
</pre>
</div>
</div>
</li>

<li><a id="org94a4d5d"></a>Hl Line<br />
<div class="outline-text-7" id="text-org94a4d5d">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package hl-line
  <span style="font-weight: bold;">:hook</span> (vterm-mode . (<span style="font-weight: bold;">lambda</span> () (hl-line-mode -1)))
  <span style="font-weight: bold;">:config</span>
  (hl-line-mode 1))
</pre>
</div>
</div>
</li>

<li><a id="org1c38eaa"></a>Visual Line<br />
<div class="outline-text-7" id="text-org1c38eaa">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package visual-line
  <span style="font-weight: bold;">:no-require</span> t
  <span style="font-weight: bold;">:after</span> adaptive-wrap
  <span style="font-weight: bold;">:hook</span>
  ((feed-show-mode eww-after-render help-mode helpful-mode Info-mode woman-mode
                   mu4e-view-mode nov-mode devdocs-mode)
   . visual-line-mode)
  ((feed-show-mode eww-after-render help-mode helpful-mode Info-mode woman-mode
                   mu4e-view-mode nov-mode devdocs-mode)
   . adaptive-wrap-prefix-mode)
  <span style="font-weight: bold;">:custom</span>
  (global-visual-line-mode nil))
</pre>
</div>
</div>
</li>

<li><a id="orgb544ec0"></a>Whitespace<br />
<div class="outline-text-7" id="text-orgb544ec0">
<p>
<a href="https://www.gnu.org/software/emacs/manual/html_mono/emacs.html#Useless-Whitespace">emacs#Useless Whitespace</a>
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package whitespace
  <span style="font-weight: bold;">:diminish</span> ((global-whitespace-mode . <span style="font-style: italic;">"Ws"</span>)
             (whitespace-mode . <span style="font-style: italic;">"ws"</span>))
  <span style="font-weight: bold;">:hook</span>
  ((org-mode prog-mode dired-mode) . whitespace-mode)
  (eww-mode . whitespace-turn-off)
  (before-save . delete-trailing-whitespace)
  <span style="font-weight: bold;">:custom</span>
  (whitespace-style
   '(face trailing tabs tab-mark spaces space-mark empty missing-newline-at-eof))
  (whitespace-action '(cleanup auto-cleanup))
  (whitespace-space-regexp <span style="font-style: italic;">"</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">\x3000+</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">"</span>)
  (whitespace-trailing-regexp <span style="font-style: italic;">"</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">[ \t\u00A0]+</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">$"</span>)
  (whitespace-display-mappings
   '((space-mark ?\x3000 [?\u2423])
     (tab-mark   ?\t   [?\u00BB ?\t])))
  (global-whitespace-mode nil))
</pre>
</div>
</div>
</li>

<li><a id="orgd921ed6"></a>So Long<br />
<div class="outline-text-7" id="text-orgd921ed6">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(setopt global-so-long-mode t)
</pre>
</div>
</div>
</li>

<li><a id="org6675e8c"></a>Tab Bar<br />
<div class="outline-text-7" id="text-org6675e8c">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package tab-bar
  <span style="font-weight: bold;">:disabled</span> t
  <span style="font-weight: bold;">:bind</span> (<span style="font-weight: bold;">:map</span> ctl-x-map
              (<span style="font-style: italic;">"t"</span> . tab-prefix-map)
              <span style="font-weight: bold;">:map</span> tab-bar-map
              (<span style="font-style: italic;">"M-["</span> . tab-bar-history-back)
              (<span style="font-style: italic;">"M-]"</span> . tab-bar-history-forward))
  <span style="font-weight: bold;">:custom</span>
  (tab-bar-mode t)
  (tab-bar-show 2)
  (tab-bar-history-mode t)
  (tab-bar-tab-hints t))
</pre>
</div>
</div>
</li>

<li><a id="org0d62797"></a>Ffap<br />
<div class="outline-text-7" id="text-org0d62797">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">ffap</span>)

(ffap-bindings)
</pre>
</div>
</div>
</li>

<li><a id="org1f81cfb"></a>Kmacro<br />
<div class="outline-text-7" id="text-org1f81cfb">
<p>
The power of keyboard macro is more than repeating editing commands. <a href="https://masteringemacs.org/article/keyboard-macros-are-misunderstood">This post explains fluently</a>.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">kmacro</span>)

(<span style="font-weight: bold;">defalias</span> '<span style="font-weight: bold;">kmacro-insert-macro</span> 'insert-kbd-macro)
(define-key kmacro-keymap (kbd <span style="font-style: italic;">"I"</span>) #'kmacro-insert-macro)
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="orgb0559db"></a>Editing<br />
<div class="outline-text-6" id="text-orgb0559db">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">the point will be at the beginning of duplicated lines</span>
(setopt duplicate-line-final-position 1)
</pre>
</div>
</div>

<ul class="org-ul">
<li><a id="org1857da4"></a>Indent<br />
<div class="outline-text-7" id="text-org1857da4">
<p>
See also [BROKEN LINK: id:4a58219c-74dd-4135-b56d-876b0db2cd83]
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(setopt tab-always-indent 'complete
        indent-tabs-mode nil
        tab-first-completion 'word-or-paren-or-punct)
</pre>
</div>
</div>
</li>

<li><a id="org4804cfb"></a>Electricity<br />
<div class="outline-text-7" id="text-org4804cfb">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(setopt electric-indent-mode nil)
</pre>
</div>
</div>
</li>

<li><a id="orgac62bf4"></a>Fill<br />
<div class="outline-text-7" id="text-orgac62bf4">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(setopt fill-column 80
        sentence-end-double-space nil)
</pre>
</div>
</div>
</li>

<li><a id="org5f120a6"></a>Killing<br />
<div class="outline-text-7" id="text-org5f120a6">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(setopt yank-pop-change-selection t)
(setopt delete-active-region 'kill)
(setopt kill-do-not-save-duplicates nil)
(setopt kill-whole-line nil)
</pre>
</div>
</div>
</li>

<li><a id="orgc186681"></a>Undo<br />
<div class="outline-text-7" id="text-orgc186681">
<p>
The older undo step which exceeds <a href="undo-limit">undo-limit</a> in byte is eliminated at garbage collection.
The oldest undo step, if undo info exceeds <a href="undo-strong-limit">undo-strong-limit</a> in total, is removed instantaneously.
No more new undo step than <a href="undo-outer-limit">undo-outer-limit</a> could not be registered.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(setopt undo-limit 320000
        undo-strong-limit 480000
        undo-outer-limit 48000000
        undo-no-redo t)
</pre>
</div>
</div>
</li>

<li><a id="org7f67d94"></a>Matching<br />
<ul class="org-ul">
<li><a id="org775eeff"></a>Isearch<br />
<div class="outline-text-8" id="text-org775eeff">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package isearch
  <span style="font-weight: bold;">:custom</span>
  (isearch-allow-motion t)
  (isearch-lazy-count t)
  (isearch-lax-whitespace t)
  (isearch-regexp-lax-whitespace t)
  (search-whitespace-regexp <span style="font-style: italic;">".*"</span>)
  <span style="font-weight: bold;">:config</span>
  (bind-keys <span style="font-weight: bold;">:map</span> isearch-mode-map
             (<span style="font-style: italic;">"C-j"</span> . isearch-exit)))
</pre>
</div>
</div>
</li>

<li><a id="org19a920f"></a>Bookmark<br />
<div class="outline-text-8" id="text-org19a920f">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package bookmark
  <span style="font-weight: bold;">:bind</span> (<span style="font-style: italic;">"C-x 5 B"</span> . bookmark-jump-other-frame)
  <span style="font-weight: bold;">:custom</span>
  (bookmark-save-flag 1)
  (bookmark-menu-confirm-deletion t)
  (bookmark-watch-bookmark-file 'silent))
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="org1dd2a21"></a>Paragraph<br />
<div class="outline-text-7" id="text-org1dd2a21">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(setopt bidi-paragraph-direction 'left-to-right)
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="orgdb7556f"></a>Multimedia<br />
<ul class="org-ul">
<li><a id="org50e5cf3"></a>Image<br />
<div class="outline-text-7" id="text-org50e5cf3">
<p>
<a href="https://xenodium.com/emacs-viewing-webp-images/">This post</a> teaches me how to enable converting external formats (i.e. webp) to internal ones.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package image
  <span style="font-weight: bold;">:custom</span>
  (image-use-external-converter t))
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="org1eb1c1d"></a>Programming<br />
<div class="outline-text-6" id="text-org1eb1c1d">
</div>

<ul class="org-ul">
<li><a id="orgae50540"></a>Tools<br />
<div class="outline-text-7" id="text-orgae50540">
</div>

<ul class="org-ul">
<li><a id="org75d5759"></a>Xref<br />
<div class="outline-text-8" id="text-org75d5759">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package xref
  <span style="font-weight: bold;">:custom</span>
  (xref-show-definitions-function 'xref-show-definitions-completing-read))
</pre>
</div>
</div>
</li>

<li><a id="org1a08bc8"></a>Ediff<br />
<div class="outline-text-8" id="text-org1a08bc8">
</div>

<ul class="org-ul">
<li><a id="orgaa8c3ab"></a>Ediff Window<br />
<div class="outline-text-9" id="text-orgaa8c3ab">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package ediff
  <span style="font-weight: bold;">:commands</span> ediff-files
  <span style="font-weight: bold;">:custom</span>
  (ediff-window-setup-function 'ediff-setup-windows-plain)
  (ediff-split-window-function 'split-window-horizontally))
</pre>
</div>
</div>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>

<li><a id="org5bc81cd"></a>Development<br />
<ul class="org-ul">
<li><a id="org926aeda"></a>Internal<br />
<ul class="org-ul">
<li><a id="org687ea9f"></a>Storage Allocation<br />
<div class="outline-text-8" id="text-org687ea9f">
<p>
If GC time at Emacs init is problematic, checking <a href="gcs-done">gcs-done</a> and <a href="gc-elapsed">gc-elapsed</a> may help you. Increasing gc-cons-* variables would minimize Emacs init time, but this also cause each GC time which may noticeable as freeze.
<a href="https://emacsconf.org/2023/talks/gc/">
This presentation</a> advise to increase gc-cons-threshold to 20-80Mb if you have Emacs with slow startup, and to increase consult&#x2013;gc-percentage to 0.2-1.0 if you have slow and frequent GC.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">setq</span> gc-cons-threshold (* 30 gc-cons-threshold)
      gc-cons-percentage 0.3)
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="org90e27ec"></a>Lisp<br />
<ul class="org-ul">
<li><a id="org737eed6"></a>Shortdoc<br />
<div class="outline-text-8" id="text-org737eed6">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package shortdoc
  <span style="font-weight: bold;">:bind</span> (<span style="font-style: italic;">"&lt;help&gt; D"</span> . shortdoc-display-group))
</pre>
</div>
</div>
</li>

<li><a id="org12f3a84"></a>Re Builder<br />
<div class="outline-text-8" id="text-org12f3a84">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package re-builder
  <span style="font-weight: bold;">:custom</span>
  (reb-re-syntax 'string))
</pre>
</div>
</div>
</li>

<li><a id="orgfba1971"></a>Comp<br />
<div class="outline-text-8" id="text-orgfba1971">
<p>
For <a href="https://www.gnu.org/software/emacs/manual/html_mono/elisp.html#Native-Compilation">native compilation feature</a> introduced at Emacs 28.1.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package comp
  <span style="font-weight: bold;">:custom</span>
  (native-comp-async-report-warnings-errors 'silent)
  (native-comp-async-query-on-exit t)
  (native-comp-verbose 1))
</pre>
</div>
</div>
</li>

<li><a id="org45659ba"></a>Eldoc<br />
<div class="outline-text-8" id="text-org45659ba">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package eldoc
  <span style="font-weight: bold;">:preface</span>
  (<span style="font-weight: bold;">setq</span> eldoc-documentation-strategy 'eldoc-documentation-compose-eagerly)
  <span style="font-weight: bold;">:custom</span>
  (eldoc-echo-area-prefer-doc-buffer 'maybe)
  <span style="font-weight: bold;">:config</span>
  (eldoc-add-command-completions <span style="font-style: italic;">"paredit-"</span>))
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="orgd33a2e5"></a>Debug<br />
<div class="outline-text-7" id="text-orgd33a2e5">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(setopt message-log-max 10000)
</pre>
</div>
</div>
</li>

<li><a id="orgda62fcf"></a>Development<br />
<div class="outline-text-7" id="text-orgda62fcf">
</div>

<ul class="org-ul">
<li><a id="org13cf86b"></a>Extensions<br />
<div class="outline-text-8" id="text-org13cf86b">
</div>

<ul class="org-ul">
<li><a id="org8128418"></a>Transient<br />
<div class="outline-text-9" id="text-org8128418">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-transient"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp" id="org48a6e0c">(use-package transient
  <span style="font-weight: bold;">:custom</span>
  (transient-save-history t)
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">:config</span>
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(mapc (lambda (face) (set-face-attribute face nil</span>
  <span style="font-weight: bold; font-style: italic;">;;                                      </span><span style="font-weight: bold; font-style: italic;">:font "fontset-code"</span>
  <span style="font-weight: bold; font-style: italic;">;;                                      </span><span style="font-weight: bold; font-style: italic;">:height (my/normalized-font-size 420)))</span>
  <span style="font-weight: bold; font-style: italic;">;;       </span><span style="font-weight: bold; font-style: italic;">(seq-filter (lambda (face) (string-match-p "transient-.+" (symbol-name face)))</span>
  <span style="font-weight: bold; font-style: italic;">;;                   </span><span style="font-weight: bold; font-style: italic;">(face-list)))</span>
  )
</pre>
</div>
</div>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>

<li><a id="orge247b17"></a>Help<br />
<div class="outline-text-6" id="text-orge247b17">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(setopt help-enable-variable-value-editing t)
(setopt help-enable-symbol-autoload t)
(setopt describe-bindings-outline t)
</pre>
</div>
</div>
</li>

<li><a id="org6ad5322"></a>Data<br />
<ul class="org-ul">
<li><a id="orgdad7674"></a>Save Place<br />
<div class="outline-text-7" id="text-orgdad7674">
<p>
File-related tweaks including <a href="https://www.gnu.org/software/emacs/manual/html_mono/emacs.html#Customize-Save">Customizing Saving of Files</a>.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">saveplace</span>)

(setopt save-place-abbreviate-file-names t
        save-place-version-control t
        save-place-mode t)
</pre>
</div>
</div>
</li>

<li><a id="org8d1ebaa"></a>Compression<br />
<div class="outline-text-7" id="text-org8d1ebaa">
<ul class="org-ul">
<li><p>
Jka Compr (auto compression mode)
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(setopt auto-compression-mode t)
</pre>
</div></li>
</ul>
</div>
</li>

<li><a id="org3f76033"></a>Tar<br />
<div class="outline-text-7" id="text-org3f76033">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">tar-mode</span>)
</pre>
</div>
</div>
</li>

<li><a id="orgb2784bf"></a>Archive<br />
<div class="outline-text-7" id="text-orgb2784bf">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">archive-mode</span>)
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="org0cade0a"></a>Editing Basics<br />
<div class="outline-text-6" id="text-org0cade0a">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(setopt set-mark-command-repeat-pop t
        mark-ring-max 64
        next-line-add-newlines nil
        cycle-spacing-actions '(delete-all-space just-one-space restore))

<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">delsel</span>
<span style="font-weight: bold; font-style: italic;">;;; </span><span style="font-weight: bold; font-style: italic;">inserting Replacing the string in the region with the typed character</span>
<span style="font-weight: bold; font-style: italic;">;;; </span><span style="font-weight: bold; font-style: italic;">instead of simply inserting it.</span>
(setopt delete-selection-mode t)

<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">files</span>
(setopt mode-require-final-newline 'visit-save
        enable-remote-dir-locals t)
(<span style="font-weight: bold;">setq</span> delete-auto-save-files t)
</pre>
</div>
</div>
</li>

<li><a id="org3d89ca3"></a>External<br />
<ul class="org-ul">
<li><a id="org991d922"></a>EasyPG<br />
<div class="outline-text-7" id="text-org991d922">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package epg
  <span style="font-weight: bold;">:defer</span> t
  <span style="font-weight: bold;">:custom</span>
  (epg-pinentry-mode 'loopback))
</pre>
</div>
</div>

<ul class="org-ul">
<li><a id="org610ce48"></a>Epa (EasyPG Assistant)<br />
<div class="outline-text-8" id="text-org610ce48">
<p>
<a href="https://www.gnu.org/software/emacs/manual/html_mono/epa.html#Top">EasyPG Assistant (epa)</a> enables users to manage their GnuPG keys and exert encryption/sign with them.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package epa
  <span style="font-weight: bold;">:bind</span> ((<span style="font-style: italic;">"C-x : l"</span> . epa-list-keys)
         (<span style="font-style: italic;">"C-x : L"</span> . epa-list-secret-keys)
         <span style="font-weight: bold;">:map</span> dired-mode-map
         (<span style="font-style: italic;">": E"</span> . my/epa-dired-do-encrypt-armor))
  <span style="font-weight: bold;">:preface</span>
  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/epa-dired-do-encrypt-armor</span> ()
    <span style="font-style: italic;">"Encrypt mark files in ASCII armored format."</span>
    (<span style="font-weight: bold;">interactive</span>)
    (<span style="font-weight: bold;">let</span> ((epa-armor t))
      (epa-dired-do-encrypt)))
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">setq</span> epa-file-encrypt-to <span style="font-style: italic;">"&lt;&lt;email&gt;&gt;"</span>))
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="orge0f5ffe"></a>Server<br />
<div class="outline-text-7" id="text-orge0f5ffe">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package server
  <span style="font-weight: bold;">:hook</span> (after-init . (<span style="font-weight: bold;">lambda</span> () (<span style="font-weight: bold;">unless</span> (server-running-p)
                               (server-start))))
  <span style="font-weight: bold;">:custom</span>
  (server-name <span style="font-style: italic;">"server-&lt;&lt;hash-string(seed="</span>server<span style="font-style: italic;">", len=6)&gt;&gt;"</span>)
  (server-client-instructions t))
</pre>
</div>
</div>
</li>

<li><a id="org937ccb4"></a>Processes<br />
<ul class="org-ul">
<li><a id="orgf467a0d"></a>Proced<br />
<div class="outline-text-8" id="text-orgf467a0d">
<p>
<a href="https://www.masteringemacs.org/article/displaying-interacting-processes-proced">This blog post</a> explains how to use proced, process monitoring package for emacs.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package proced
  <span style="font-weight: bold;">:commands</span> proced
  <span style="font-weight: bold;">:custom</span>
  (proced-auto-update-flag t)
  (proced-auto-update-interval 3)
  (proced-show-remote-processes t)
  (proced-show-remote-processes t))
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="org65a5549"></a>Browse Url<br />
<div class="outline-text-7" id="text-org65a5549">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package browse-url
  <span style="font-weight: bold;">:init</span>
  (global-set-key (kbd <span style="font-style: italic;">"C-c C-o"</span>) #'browse-url-at-point)
  <span style="font-weight: bold;">:custom</span>
  (browse-url-new-window-flag t)
  (browse-url-browser-function 'eww-browse-url)
  (browse-url-secondary-browser-function 'browse-url-firefox))
</pre>
</div>
</div>

<ul class="org-ul">
<li><a id="orgfe1ce9d"></a>Webjump<br />
<div class="outline-text-8" id="text-orgfe1ce9d">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package webjump
  <span style="font-weight: bold;">:commands</span> webjump
  <span style="font-weight: bold;">:custom</span>
  (webjump-use-internal-browser t))
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="orga8094ac"></a>locate<br />
<div class="outline-text-7" id="text-orga8094ac">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package locate
  <span style="font-weight: bold;">:commands</span> locate
  <span style="font-weight: bold;">:custom</span>
  (locate-command <span style="font-style: italic;">"plocate"</span>)
  (locate-make-command-line #'my/plocate-make-command-line)
  (locate-fcodes-file <span style="font-style: italic;">"&lt;&lt;plocate-db()&gt;&gt;"</span>)
  (locate-update-path (expand-file-name <span style="font-style: italic;">"~/"</span>)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/plocate-make-command-line</span> (search-string)
  (list locate-command <span style="font-style: italic;">"-d"</span> <span style="font-style: italic;">"&lt;&lt;plocate-db()&gt;&gt;"</span> <span style="font-style: italic;">"--ignore-case"</span> <span style="font-style: italic;">"--existing"</span> <span style="font-style: italic;">"--regexp"</span> search-string))
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="org443a301"></a>Applications<br />
<ul class="org-ul">
<li><a id="org2295133"></a>Mail<br />
<div class="outline-text-7" id="text-org2295133">
</div>

<ul class="org-ul">
<li><a id="org1210f36"></a>Smtpmail<br />
<div class="outline-text-8" id="text-org1210f36">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package smtpmail
  <span style="font-weight: bold;">:after</span> mu4e
  <span style="font-weight: bold;">:init</span>
  (<span style="font-weight: bold;">setq</span> smtpmail-default-smtp-server <span style="font-style: italic;">"&lt;&lt;smtp-host&gt;&gt;"</span>)
  <span style="font-weight: bold;">:custom</span>
  (smtpmail-smtp-service 465)
  (smtpmail-smtp-user user-mail-address)
  (smtpmail-stream-type 'ssl)
  (smtpmail-mail-address user-mail-address))
</pre>
</div>
</div>
</li>

<li><a id="org1f02625"></a>Message<br />
<div class="outline-text-8" id="text-org1f02625">
</div>

<ul class="org-ul">
<li><a id="org8ac2e48"></a>Message Mail<br />
<div class="outline-text-9" id="text-org8ac2e48">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package message
  <span style="font-weight: bold;">:after</span> (dired mu4e)
  <span style="font-weight: bold;">:custom</span>
  (message-send-mail-function 'smtpmail-send-it))
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="org9202b2b"></a>Mime Security<br />
<div class="outline-text-8" id="text-org9202b2b">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package mm-encode
  <span style="font-weight: bold;">:after</span> mu4e
  <span style="font-weight: bold;">:custom</span>
  (mm-sign-option nil))

(use-package mml-sec
  <span style="font-weight: bold;">:after</span> (mu4e dired)
  <span style="font-weight: bold;">:custom</span>
  (mml-secure-openpgp-sign-with-sender t)
  (mml-default-sign-method 'pgpmime))
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="org76ee312"></a>Ispell/FlySpell<br />
<div class="outline-text-7" id="text-org76ee312">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package ispell
  <span style="font-weight: bold;">:if</span> (executable-find <span style="font-style: italic;">"aspell"</span>)
  <span style="font-weight: bold;">:custom</span>
  (ispell-program-name <span style="font-style: italic;">"aspell"</span>)
  <span style="font-weight: bold;">:config</span>
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">avoid checking for Japanese characters</span>
  (add-to-list 'ispell-skip-region-alist '(<span style="font-style: italic;">"[</span><span style="font-style: italic;">^</span><span style="font-style: italic;">\000-\377]+"</span>))
  (<span style="font-weight: bold;">setq-default</span> ispell-extra-args '(<span style="font-style: italic;">"--sug-mode=ultra"</span>
                                    <span style="font-style: italic;">"--lang=en_US"</span>))
  (<span style="font-weight: bold;">let</span> ((arg <span style="font-style: italic;">"--camel-case"</span>))
    (<span style="font-weight: bold;">and</span> (string-match-p arg
                         (shell-command-to-string (concat ispell-program-name <span style="font-style: italic;">" --help"</span>)))
         (<span style="font-weight: bold;">push</span> arg ispell-extra-args))))

(use-package flyspell
  <span style="font-weight: bold;">:after</span> ispell
  <span style="font-weight: bold;">:hook</span> ((text-mode . (<span style="font-weight: bold;">lambda</span> ()
                        (<span style="font-weight: bold;">unless</span> (derived-mode-p 'org-mode)
                          (flyspell-mode 1))))
         (prog-mode . flyspell-prog-mode))
  <span style="font-weight: bold;">:preface</span> (<span style="font-weight: bold;">setq</span> flyspell-mode-map nil)
  <span style="font-weight: bold;">:bind</span> (<span style="font-weight: bold;">:map</span> flyspell-mode-map
              <span style="font-weight: bold;">:prefix</span> <span style="font-style: italic;">"C-$"</span>
              <span style="font-weight: bold;">:prefix-map</span> my/flyspell-mode-map
              <span style="font-weight: bold;">:prefix-docstring</span> <span style="font-style: italic;">"Keymap for Flyspell"</span>
              (<span style="font-style: italic;">"n"</span> . flyspell-goto-next-error)
              (<span style="font-style: italic;">"C-$"</span> . flyspell-auto-correct-word)
              (<span style="font-style: italic;">"C-"</span> . flyspell-auto-correct-previous-word)
              (<span style="font-style: italic;">"$"</span> . flyspell-correct-word-before-point))
  <span style="font-weight: bold;">:custom</span>
  (flyspell-issue-message-flag nil))
</pre>
</div>
</div>
</li>

<li><a id="org9fada6e"></a>News<br />
<ul class="org-ul">
<li><a id="org7f875ad"></a>Gnus<br />
<ul class="org-ul">
<li><a id="org440845d"></a>Auth Source<br />
<div class="outline-text-9" id="text-org440845d">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package auth-source
  <span style="font-weight: bold;">:custom</span>
  (auth-source-gpg-encrypt-to `(,user-mail-address))
  <span style="font-weight: bold;">:config</span>
  (add-to-list 'auth-sources <span style="font-style: italic;">"~/.netrc.gpg"</span>))

(use-package auth-source-pass
  <span style="font-weight: bold;">:config</span>
  (auth-source-pass-enable))
</pre>
</div>
</div>
</li>
</ul>
</li>
</ul>
</li>

<li><a id="orgb51da01"></a>Calc (The GNU Emacs Calculator)<br />
<div class="outline-text-7" id="text-orgb51da01">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package calc
  <span style="font-weight: bold;">:bind</span> (<span style="font-style: italic;">"&lt;f7&gt;"</span> . calc)
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">setf</span> calc-display-trail nil))
</pre>
</div>
</div>
</li>
<li><a id="orgdd0045a"></a>Calendar<br />
<div class="outline-text-7" id="text-orgdd0045a">
<p>
<a href="https://github.com/emacs-jp/japanese-holidays/releases.atom">japanese-holidays</a>
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package calendar
  <span style="font-weight: bold;">:commands</span> calendar
  <span style="font-weight: bold;">:ensure</span> japanese-holidays
  <span style="font-weight: bold;">:hook</span>
  ((calendar-today-visible calendar-today-invisible) . japanese-holiday-mark-weekend)
  (calendar-today-visible . calendar-mark-today)
  (calendar-move . my/japanese-holiday-show)
  <span style="font-weight: bold;">:custom</span>
  (calendar-left-margin 0)
  (calendar-right-margin 0)
  (calendar-intermonth-spacing 1)
  (calendar-mark-holidays-flag t)
  (japanese-holiday-weekend '(0 6))
  (japanese-holiday-weekend-marker
   '(holiday nil nil nil nil nil japanese-holiday-saturday))
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">japanese-holidays</span>)
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">add 'holiday-general-holidays to calendar-holidays</span>
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">if you want holidays in the U.S. to be counted as your holidays.</span>
  (<span style="font-weight: bold;">setf</span> calendar-holidays
        (append japanese-holidays holiday-local-holidays holiday-other-holidays))
  (bind-keys <span style="font-weight: bold;">:map</span> calendar-mode-map
             (<span style="font-style: italic;">"v"</span> . my/calendar-show-items)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/japanese-holiday-show</span> (<span style="font-weight: bold; text-decoration: underline;">&amp;rest</span> _args)
  <span style="font-style: italic;">"Show holiday information in mini buffer if date on which the cursor is any holidays."</span>
  (<span style="font-weight: bold;">let*</span> ((date (calendar-cursor-to-date t))
         (calendar-date-display-form '((format <span style="font-style: italic;">"%s&#24180; %s&#26376; %s&#26085;&#65288;%s&#65289;"</span> year month day dayname)))
         (date-string (calendar-date-string date))
         (holiday-list (calendar-check-holidays date)))
    (<span style="font-weight: bold;">when</span> holiday-list
      (message <span style="font-style: italic;">"%s: %s"</span> date-string (mapconcat #'identity holiday-list <span style="font-style: italic;">"; "</span>)))))
</pre>
</div>
</div>

<ul class="org-ul">
<li><a id="orgde6f14c"></a>Midnight<br />
<div class="outline-text-8" id="text-orgde6f14c">
<div class="org-src-container">
<pre class="src src-emacs-lisp" id="org9f68bb7">(use-package midnight
  <span style="font-weight: bold;">:defer</span> t
  <span style="font-weight: bold;">:custom</span>
  (midnight-mode t)
  (midnight-delay <span style="font-style: italic;">"&lt;&lt;morning-hour&gt;&gt;:00"</span>))
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="org3161246"></a>Package<br />
<div class="outline-text-7" id="text-org3161246">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package package
  <span style="font-weight: bold;">:custom</span>
  (package-native-compile t)
  (package-install-upgrade-built-in t)
  (package-quickstart t)
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">with-eval-after-load</span> 'my-launch-app
    (keymap-set my/invoke-list-command-map (kbd <span style="font-style: italic;">"p"</span>)
                #'list-packages)))
</pre>
</div>
</div>
</li>

<li><a id="org7c992f5"></a>Eglot<br />
<div class="outline-text-7" id="text-org7c992f5">
<p>
<a href="https://github.com/joaotavora/eglot">Eglot</a>
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package eglot
  <span style="font-weight: bold;">:hook</span> ((sh-mode ruby-mode python-mode graphviz-dot-mode) . eglot-ensure)
  <span style="font-weight: bold;">:custom</span>
  (eglot-extend-to-xref t))
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="orge480b26"></a>Text<br />
<ul class="org-ul">
<li><a id="org52c9774"></a>View<br />
<div class="outline-text-7" id="text-org52c9774">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package view
  <span style="font-weight: bold;">:diminish</span> view-mode <span style="font-style: italic;">"vw"</span>)
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="org32f894d"></a>Hypermedia<br />
<div class="outline-text-6" id="text-org32f894d">
</div>
<ul class="org-ul">
<li><a id="org9ebfd0d"></a>Dictionary<br />
<div class="outline-text-7" id="text-org9ebfd0d">
<div class="org-src-container">
<pre class="src src-shell">dictd dict <span style="font-style: italic;">\</span>
      dict-gcide dict-wn <span style="font-style: italic;">\</span>
      dict-jargon dict-foldoc dict-vera <span style="font-style: italic;">\</span>
      dict-freedict-eng-jpn dict-freedict-jpn-eng
</pre>
</div>

<div class="org-src-container">
<pre class="src src-conf">sudo systemctl start dictd
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(use-package dictionary
  <span style="font-weight: bold;">:commands</span> (dictionary-search dictionary-lookup-definition)
  <span style="font-weight: bold;">:custom</span>
  (dictionary-use-single-buffer t)
  (dictionary-server nil)
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">setq</span> switch-to-buffer-obey-display-actions t)
  (add-to-list 'display-buffer-alist
               '(<span style="font-style: italic;">"^\\*Dictionary\\*"</span>
                 display-buffer-in-tab)))
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="org3079494"></a>Communication<br />
<div class="outline-text-6" id="text-org3079494">
</div>

<ul class="org-ul">
<li><a id="org02eff05"></a>Net Utils<br />
<div class="outline-text-7" id="text-org02eff05">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package net-utils
  <span style="font-weight: bold;">:after</span> my-launch-app
  <span style="font-weight: bold;">:bind</span> (<span style="font-weight: bold;">:map</span> my/launch-app-map
              (<span style="font-style: italic;">"n d"</span> . run-dig)
              (<span style="font-style: italic;">"n i"</span> . ifconfig)
              (<span style="font-style: italic;">"n w"</span> . iwconfig)
              (<span style="font-style: italic;">"n p"</span> . ping)))
</pre>
</div>
</div>
</li>
</ul>
</li>
</ul>
</li>

<li><a id="org9ae0da0"></a>Input Methods<br />
<ul class="org-ul">
<li><a id="org59f6e05"></a>ddskk<br />
<div class="outline-text-6" id="text-org59f6e05">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-ddskk"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-style: italic;">"https://github.com/skk-dev/ddskk/releases.atom"</span> soft_update)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp" id="org23a547c">(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">skk-dir</span> (expand-file-name <span style="font-style: italic;">"skk"</span> <span style="font-style: italic;">"&lt;&lt;share-dir()&gt;&gt;"</span>))

(use-package skk
  <span style="font-weight: bold;">:defer</span> t
  <span style="font-weight: bold;">:init</span>
  (setopt default-input-method <span style="font-style: italic;">"japanese-skk"</span>)
  (<span style="font-weight: bold;">defface</span> <span style="font-weight: bold; font-style: italic;">skk-candidate</span> `((t . (<span style="font-weight: bold;">:font</span> <span style="font-style: italic;">"fontset-default"</span>
                                       <span style="font-weight: bold;">:height</span> ,(my/normalized-font-size 860))))
    <span style="font-style: italic;">"Default face for ddskk candidates."</span>
    <span style="font-weight: bold;">:group</span> 'skk-dcomp)
  (<span style="font-weight: bold;">setq</span> skk-get-jisyo-directory <span style="font-style: italic;">"&lt;&lt;skk-jisyo-path()&gt;&gt;"</span>)
  <span style="font-weight: bold;">:custom</span>
  (skk-user-directory (no-littering-expand-etc-file-name <span style="font-style: italic;">"ddskk"</span>))
  (skk-init-file (expand-file-name <span style="font-style: italic;">"ddskk-init.el"</span> skk-user-directory))
  (skk-byte-compile-init-file t)
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">cursor color</span>
  (skk-use-color-cursor t)
  (skk-cursor-hiragana-color <span style="font-style: italic;">"orange"</span>)
  (skk-cursor-katakana-color <span style="font-style: italic;">"OrangeRed3"</span>)
  (skk-cursor-latin-color <span style="font-style: italic;">"DodgerBlue3"</span>)
  (skk-cursor-jisx0201-color <span style="font-style: italic;">"purple3"</span>)
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">mode line string</span>
  (skk-latin-mode-string <span style="font-style: italic;">"A"</span>)
  (skk-hiragana-mode-string <span style="font-style: italic;">"&#12354;"</span>)
  (skk-katakana-mode-string <span style="font-style: italic;">"&#12450;"</span>)
  (skk-jisx0201-mode-string <span style="font-style: italic;">"&#65393;"</span>)
  (skk-jisx0208-latin-mode-string <span style="font-style: italic;">"&#65313;"</span>)
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">AZIK</span>
  (skk-use-azik t)
  (skk-azik-keyboard-type 'us101)
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">conversion</span>
  (skk-egg-like-newline t)
  (skk-henkan-strict-okuri-precedence t)
  (skk-check-okurigana-on-touroku t)
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">annotation</span>
  (skk-show-annotation t)
  (skk-annotation-delay 0.3)
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">how candidates behave</span>
  (skk-show-candidates-always-pop-to-buffer t)
  (skk-henkan-number-to-display-candidates 10)
  (skk-show-candidates-nth-henkan-char 3)
  (skk-henkan-show-candidates-keys
   '(?1 ?2 ?3 ?4 ?5 ?6 ?7 ?8 ?9 ?0))
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">set face for candidates list</span>
  (skk-treat-candidate-appearance-function
   (<span style="font-weight: bold;">lambda</span> (candidate listing-p)
     (<span style="font-weight: bold;">cond</span>
      ((string-match <span style="font-style: italic;">";"</span> candidate)
       (put-text-property 0 (match-beginning 0)
                          'face 'skk-candidate
                          candidate)
       (put-text-property (match-beginning 0)
                          (length candidate) 'face 'shadow candidate))
      (t
       (put-text-property 0 (length candidate)
                          'face 'skk-candidate
                          candidate)))
     candidate))
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">bind C-q for hankaku-kana input mode</span>
  (skk-use-jisx0201-input-method t)
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">dynamic conversion</span>
  (skk-dcomp-activate nil)
  (skk-dcomp-multiple-activate nil)
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">config file</span>
  (skk-record-file (expand-file-name <span style="font-style: italic;">"record"</span> skk-dir))
  (skk-emacs-id-file (expand-file-name <span style="font-style: italic;">"emacs-id"</span> skk-dir))
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">jisyo</span>
  (skk-share-private-jisyo t)
  (skk-compare-jisyo-size-when-saving t)
  (skk-save-jisyo-instantly t)
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">jisyo file/directory</span>
  (skk-jisyo `(,(no-littering-expand-var-file-name <span style="font-style: italic;">"ddskk/jisyo.txt"</span>) . utf-8))
  (skk-backup-jisyo (expand-file-name <span style="font-style: italic;">"jisyo.bak"</span> skk-dir))
  (skk-large-jisyo (expand-file-name <span style="font-style: italic;">"SKK-JISYO.L"</span> skk-get-jisyo-directory))
  (skk-itaiji-jisyo (expand-file-name <span style="font-style: italic;">"SKK-JISYO.itaiji"</span> skk-get-jisyo-directory))
  (skk-extra-jisyo-file-list
   (seq-remove (<span style="font-weight: bold;">lambda</span> (dic)
                 (seq-some (<span style="font-weight: bold;">lambda</span> (suffix)
                             (string-suffix-p (symbol-name suffix) dic))
                           '(L itaiji tar)))
               (append (file-expand-wildcards (expand-file-name <span style="font-style: italic;">"SKK-JISYO.*"</span> skk-get-jisyo-directory))
                       (file-expand-wildcards (expand-file-name <span style="font-style: italic;">"open-jisyo/SKK-JISYO.*"</span> skk-dir)))))
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">jisyo server</span>
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(skk-server-host "localhost")</span>
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(skk-server-portnum 1178)</span>
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(skk-server-inhibit-startup-server t)</span>
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">study</span>
  (skk-study-file (expand-file-name <span style="font-style: italic;">"study"</span> skk-dir))
  (skk-study-backup-file (expand-file-name <span style="font-style: italic;">"study.bak"</span> skk-dir))
  <span style="font-weight: bold;">:config</span>
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">ward off activating skk-auto-fill-mode inadvertently</span>
  (bind-keys (<span style="font-style: italic;">"C-x j"</span> . skk-mode)))
</pre>
</div>

<ul class="org-ul">
<li>ddskk init file</li>
</ul>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">-*- mode:emacs-lisp; -*-</span>
(<span style="font-weight: bold;">setq</span> skk-rom-kana-rule-list
      (append skk-rom-kana-rule-list
              '((<span style="font-style: italic;">"!"</span> nil skk-purge-from-jisyo)
                (<span style="font-style: italic;">"xka"</span> nil (<span style="font-style: italic;">"&#12533;"</span> . <span style="font-style: italic;">"&#12533;"</span>))
                (<span style="font-style: italic;">"xke"</span> nil (<span style="font-style: italic;">"&#12534;"</span> . <span style="font-style: italic;">"&#12534;"</span>))
                (<span style="font-style: italic;">"n"</span> nil nil)
                (<span style="font-style: italic;">"nn"</span> nil (<span style="font-style: italic;">"&#12490;&#12494;"</span> . <span style="font-style: italic;">"&#12394;&#12398;"</span>))
                (<span style="font-style: italic;">"nm"</span> nil (<span style="font-style: italic;">"&#12494;&#12511;"</span> . <span style="font-style: italic;">"&#12398;&#12415;"</span>))
                (<span style="font-style: italic;">"ks"</span> nil (<span style="font-style: italic;">"&#12467;&#12477;"</span> . <span style="font-style: italic;">"&#12371;&#12381;"</span>))
                (<span style="font-style: italic;">"kna"</span> nil (<span style="font-style: italic;">"&#12459;&#12490;"</span> . <span style="font-style: italic;">"&#12363;&#12394;"</span>))
                (<span style="font-style: italic;">"kno"</span> nil (<span style="font-style: italic;">"&#12467;&#12494;"</span> . <span style="font-style: italic;">"&#12371;&#12398;"</span>))
                (<span style="font-style: italic;">"ym"</span> nil (<span style="font-style: italic;">"&#12516;&#12510;"</span> . <span style="font-style: italic;">"&#12420;&#12414;"</span>))
                (<span style="font-style: italic;">"yk"</span> nil (<span style="font-style: italic;">"&#12518;&#12461;"</span> . <span style="font-style: italic;">"&#12422;&#12365;"</span>))
                (<span style="font-style: italic;">"tga"</span> nil (<span style="font-style: italic;">"&#12479;&#12460;"</span> . <span style="font-style: italic;">"&#12383;&#12364;"</span>))
                (<span style="font-style: italic;">"vj"</span> nil (<span style="font-style: italic;">"&#12532;&#12531;"</span> . <span style="font-style: italic;">"&#12406;&#12435;"</span>))
                (<span style="font-style: italic;">"hm"</span> nil (<span style="font-style: italic;">"&#12495;&#12510;"</span> . <span style="font-style: italic;">"&#12399;&#12414;"</span>))
                <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">followings are for preventing from changing to zenkaku eisu mode by pressing 'L'</span>
                (<span style="font-style: italic;">"bL"</span> nil (<span style="font-style: italic;">"&#12508;&#12531;"</span> . <span style="font-style: italic;">"&#12412;&#12435;"</span>))
                (<span style="font-style: italic;">"byL"</span> nil (<span style="font-style: italic;">"&#12499;&#12519;&#12531;"</span> . <span style="font-style: italic;">"&#12403;&#12423;&#12435;"</span>))
                (<span style="font-style: italic;">"cL"</span> nil (<span style="font-style: italic;">"&#12481;&#12519;&#12531;"</span> . <span style="font-style: italic;">"&#12385;&#12423;&#12435;"</span>))
                (<span style="font-style: italic;">"dL"</span> nil (<span style="font-style: italic;">"&#12489;&#12531;"</span> . <span style="font-style: italic;">"&#12393;&#12435;"</span>))
                (<span style="font-style: italic;">"fL"</span> nil (<span style="font-style: italic;">"&#12501;&#12457;&#12531;"</span> . <span style="font-style: italic;">"&#12405;&#12361;&#12435;"</span>))
                (<span style="font-style: italic;">"gL"</span> nil (<span style="font-style: italic;">"&#12468;&#12531;"</span> . <span style="font-style: italic;">"&#12372;&#12435;"</span>))
                (<span style="font-style: italic;">"gyL"</span> nil (<span style="font-style: italic;">"&#12462;&#12519;&#12531;"</span> . <span style="font-style: italic;">"&#12366;&#12423;&#12435;"</span>))
                (<span style="font-style: italic;">"hL"</span> nil (<span style="font-style: italic;">"&#12507;&#12531;"</span> . <span style="font-style: italic;">"&#12411;&#12435;"</span>))
                (<span style="font-style: italic;">"hgL"</span> nil (<span style="font-style: italic;">"&#12498;&#12519;&#12531;"</span> . <span style="font-style: italic;">"&#12402;&#12423;&#12435;"</span>))
                (<span style="font-style: italic;">"hyL"</span> nil (<span style="font-style: italic;">"&#12498;&#12519;&#12531;"</span> . <span style="font-style: italic;">"&#12402;&#12423;&#12435;"</span>))
                (<span style="font-style: italic;">"jL"</span> nil (<span style="font-style: italic;">"&#12472;&#12519;&#12531;"</span> . <span style="font-style: italic;">"&#12376;&#12423;&#12435;"</span>))
                (<span style="font-style: italic;">"kL"</span> nil (<span style="font-style: italic;">"&#12467;&#12531;"</span> . <span style="font-style: italic;">"&#12371;&#12435;"</span>))
                (<span style="font-style: italic;">"kgL"</span> nil (<span style="font-style: italic;">"&#12461;&#12519;&#12531;"</span> . <span style="font-style: italic;">"&#12365;&#12423;&#12435;"</span>))
                (<span style="font-style: italic;">"kyL"</span> nil (<span style="font-style: italic;">"&#12461;&#12519;&#12531;"</span> . <span style="font-style: italic;">"&#12365;&#12423;&#12435;"</span>))
                (<span style="font-style: italic;">"mL"</span> nil (<span style="font-style: italic;">"&#12514;&#12531;"</span> . <span style="font-style: italic;">"&#12418;&#12435;"</span>))
                (<span style="font-style: italic;">"mgL"</span> nil (<span style="font-style: italic;">"&#12511;&#12519;&#12531;"</span> . <span style="font-style: italic;">"&#12415;&#12423;&#12435;"</span>))
                (<span style="font-style: italic;">"myL"</span> nil (<span style="font-style: italic;">"&#12511;&#12519;&#12531;"</span> . <span style="font-style: italic;">"&#12415;&#12423;&#12435;"</span>))
                (<span style="font-style: italic;">"nL"</span> nil (<span style="font-style: italic;">"&#12494;&#12531;"</span> . <span style="font-style: italic;">"&#12398;&#12435;"</span>))
                (<span style="font-style: italic;">"ngL"</span> nil (<span style="font-style: italic;">"&#12491;&#12519;&#12531;"</span> . <span style="font-style: italic;">"&#12395;&#12423;&#12435;"</span>))
                (<span style="font-style: italic;">"nyL"</span> nil (<span style="font-style: italic;">"&#12491;&#12519;&#12531;"</span> . <span style="font-style: italic;">"&#12395;&#12423;&#12435;"</span>))
                (<span style="font-style: italic;">"pL"</span> nil (<span style="font-style: italic;">"&#12509;&#12531;"</span> . <span style="font-style: italic;">"&#12413;&#12435;"</span>))
                (<span style="font-style: italic;">"pgL"</span> nil (<span style="font-style: italic;">"&#12500;&#12519;&#12531;"</span> . <span style="font-style: italic;">"&#12404;&#12423;&#12435;"</span>))
                (<span style="font-style: italic;">"pyL"</span> nil (<span style="font-style: italic;">"&#12500;&#12519;&#12531;"</span> . <span style="font-style: italic;">"&#12404;&#12423;&#12435;"</span>))
                (<span style="font-style: italic;">"rL"</span> nil (<span style="font-style: italic;">"&#12525;&#12531;"</span> . <span style="font-style: italic;">"&#12429;&#12435;"</span>))
                (<span style="font-style: italic;">"ryL"</span> nil (<span style="font-style: italic;">"&#12522;&#12519;&#12531;"</span> . <span style="font-style: italic;">"&#12426;&#12423;&#12435;"</span>))
                (<span style="font-style: italic;">"sL"</span> nil (<span style="font-style: italic;">"&#12477;&#12531;"</span> . <span style="font-style: italic;">"&#12381;&#12435;"</span>))
                (<span style="font-style: italic;">"syL"</span> nil (<span style="font-style: italic;">"&#12471;&#12519;&#12531;"</span> . <span style="font-style: italic;">"&#12375;&#12423;&#12435;"</span>))
                (<span style="font-style: italic;">"tL"</span> nil (<span style="font-style: italic;">"&#12488;&#12531;"</span> . <span style="font-style: italic;">"&#12392;&#12435;"</span>))
                (<span style="font-style: italic;">"tyL"</span> nil (<span style="font-style: italic;">"&#12481;&#12519;&#12531;"</span> . <span style="font-style: italic;">"&#12385;&#12423;&#12435;"</span>))
                (<span style="font-style: italic;">"vL"</span> nil (<span style="font-style: italic;">"&#12532;&#12457;&#12531;"</span> . <span style="font-style: italic;">"&#12358;&#12443;&#12361;&#12435;"</span>))
                (<span style="font-style: italic;">"wL"</span> nil (<span style="font-style: italic;">"&#12454;&#12457;&#12531;"</span> . <span style="font-style: italic;">"&#12358;&#12361;&#12435;"</span>))
                (<span style="font-style: italic;">"xL"</span> nil (<span style="font-style: italic;">"&#12471;&#12519;&#12531;"</span> . <span style="font-style: italic;">"&#12375;&#12423;&#12435;"</span>))
                (<span style="font-style: italic;">"xxL"</span> nil (<span style="font-style: italic;">"&#8594;"</span> . <span style="font-style: italic;">"&#8594;"</span>))
                (<span style="font-style: italic;">"yL"</span> nil (<span style="font-style: italic;">"&#12520;&#12531;"</span> . <span style="font-style: italic;">"&#12424;&#12435;"</span>))
                (<span style="font-style: italic;">"zL"</span> nil (<span style="font-style: italic;">"&#12478;&#12531;"</span> . <span style="font-style: italic;">"&#12382;&#12435;"</span>))
                (<span style="font-style: italic;">"zyL"</span> nil (<span style="font-style: italic;">"&#12472;&#12519;&#12531;"</span> . <span style="font-style: italic;">"&#12376;&#12423;&#12435;"</span>)))))

(add-hook 'skk-azik-load-hook
          (<span style="font-weight: bold;">lambda</span> ()
            (<span style="font-weight: bold;">dolist</span> (key '(<span style="font-style: italic;">"kA"</span> <span style="font-style: italic;">"kE"</span> <span style="font-style: italic;">"tU"</span> <span style="font-style: italic;">"wA"</span>))
              (<span style="font-weight: bold;">setq</span> skk-rom-kana-rule-list
                    (skk-del-alist key skk-rom-kana-rule-list)))))
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="org7e4daad"></a>Dired<br />
<div class="outline-text-5" id="text-org7e4daad">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package dired
  <span style="font-weight: bold;">:bind</span> (<span style="font-weight: bold;">:map</span> dired-mode-map
              (<span style="font-style: italic;">"C-j"</span> . dired-find-file)
              (<span style="font-style: italic;">"^"</span> . dired-up-directory)
              (<span style="font-style: italic;">"("</span> . dired-hide-details-mode)
              (<span style="font-style: italic;">")"</span> . dired-hide-details-mode)
              (<span style="font-style: italic;">"E"</span> . dired-create-empty-file)
              (<span style="font-style: italic;">"Y"</span> . dired-do-relsymlink)
              (<span style="font-style: italic;">"e"</span> . wdired-change-to-wdired-mode)
              (<span style="font-style: italic;">"RET"</span> . dired-open-file)
              (<span style="font-style: italic;">"C-c C-o"</span> . dired-open-file)
              (<span style="font-style: italic;">"C-c C-s"</span> . my/dired-share))
  <span style="font-weight: bold;">:hook</span> (dired-mode . dired-hide-details-mode)
  <span style="font-weight: bold;">:custom</span>
  (dired-kill-when-opening-new-dired-buffer t)
  (dired-do-revert-buffer t)
  (dired-auto-revert-buffer t)
  (dired-copy-dereference t)
  (dired-recursive-copies 'always)
  (dired-recursive-deletes 'top)
  (dired-listing-switches <span style="font-style: italic;">"-ahgG --time-style=long-iso --group-directories-first"</span>)
  (dired-dwim-target 'dired-dwim-target-next)
  (dired-hide-details-hide-information-lines nil)
  (dired-hide-details-hide-symlink-targets nil)
  (dired-compress-file-default-suffix <span style="font-style: italic;">".zst"</span>)
  (dired-compress-directory-default-suffix <span style="font-style: italic;">".7z"</span>)
  (dired-isearch-filenames t)
  (dired-open-use-nohup t)
  (dired-open-query-before-exit nil)
  (completion-ignored-extensions nil)
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">with-eval-after-load</span> 'open-file
    (<span style="font-weight: bold;">setq</span> dired-guess-shell-alist-user
          `((,(regexp-opt (append my/open-file-media-extensions
                                  my/open-file-compressed-media-extensions)
                          <span style="font-style: italic;">"\\.</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">"</span>)
             <span style="font-style: italic;">"mpv"</span>)
            (,(regexp-quote <span style="font-style: italic;">".kdenlive"</span>) <span style="font-style: italic;">"kdenlive"</span>)
            (,(regexp-quote <span style="font-style: italic;">".xcf"</span>) <span style="font-style: italic;">"gimp"</span>))))
  (advice-add #'dired-do-delete <span style="font-weight: bold;">:around</span> #'my/advice-dired-control-deletion)
  (advice-add #'dired-do-flagged-delete <span style="font-weight: bold;">:around</span> #'my/advice-dired-control-deletion)
  (put 'dired-find-alternate-file 'disabled nil))

(use-package dired-x
  <span style="font-weight: bold;">:after</span> dired
  <span style="font-weight: bold;">:config</span>
  (lambda-key dired-mode-map <span style="font-style: italic;">"."</span>
              (<span style="font-weight: bold;">lambda</span> ()
                <span style="font-style: italic;">"Toggle hiding dotfiles whose name starts with '.'"</span>
                (<span style="font-weight: bold;">interactive</span>)
                (<span style="font-weight: bold;">let</span> ((dired-omit-files (<span style="font-weight: bold;">rx</span> (seq string-start
                                                 (<span style="font-weight: bold;">or</span> <span style="font-style: italic;">"."</span> <span style="font-style: italic;">".."</span>
                                                     (seq <span style="font-style: italic;">"."</span> (+? graph)))
                                                 string-end))))
                  (call-interactively #'dired-omit-mode)))))

(use-package dired-aux
  <span style="font-weight: bold;">:after</span> dired
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">setq</span> dired-compress-files-alist
        (append dired-compress-files-alist
                '((<span style="font-style: italic;">"\\.tar\\.7z\\'"</span> . <span style="font-style: italic;">"tar cf - %i | 7z a -si %o"</span>)
                  (<span style="font-style: italic;">"\\.7z\\'"</span> . <span style="font-style: italic;">"7z a %o %i"</span>))))
  (add-to-list 'dired-compress-file-suffixes
               '(<span style="font-style: italic;">"\\.tar\\.7z\\'"</span> <span style="font-style: italic;">""</span> <span style="font-style: italic;">"7z x -so %i | tar xf -"</span>)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/advice-dired-control-deletion</span> (oldfun <span style="font-weight: bold; text-decoration: underline;">&amp;rest</span> r)
  <span style="font-style: italic;">"Enable file deleting functions to control deleting procedure</span>
<span style="font-style: italic;">whether files are going to be in trash box."</span>
  (<span style="font-weight: bold;">let</span> ((delete-by-moving-to-trash
         (<span style="font-weight: bold;">if</span> (equal current-prefix-arg '(4))
             nil t)))
    (apply oldfun (cdr r))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/dired-share</span> ()
  <span style="font-style: italic;">"Share file with remote device via KDE Connect."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">let</span> ((files (dired-get-marked-files nil nil)))
    (mapc (<span style="font-weight: bold;">lambda</span> (file)
            (shell-command
             (mapconcat 'identity
                        (list <span style="font-style: italic;">"kdeconnect-cli"</span> <span style="font-style: italic;">"-d"</span> <span style="font-style: italic;">"a30587ededf4c2d2"</span>
                              <span style="font-style: italic;">"--share"</span> (shell-quote-argument
                                         file)) <span style="font-style: italic;">" "</span>)))
          files)))
</pre>
</div>
</div>
<ul class="org-ul">
<li><a id="org122f6b5"></a>dired-rsync<br />
<div class="outline-text-6" id="text-org122f6b5">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-dired-rsync"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package dired-rsync
  <span style="font-weight: bold;">:after</span> dired
  <span style="font-weight: bold;">:bind</span> (<span style="font-weight: bold;">:map</span> dired-mode-map
              (<span style="font-style: italic;">"C-c C-r"</span> . dired-rsync))
  <span style="font-weight: bold;">:custom</span>
  (dired-rsync-options <span style="font-style: italic;">"-auz --info=progress2"</span>))
</pre>
</div>
</div>
</li>

<li><a id="org460fadd"></a>dired-single&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span><br /></li>

<li><a id="org4133a1e"></a>dired-hacks<br />
<div class="outline-text-6" id="text-org4133a1e">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-dired-hacks"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">dired-open</span>)

(use-package dired-subtree
  <span style="font-weight: bold;">:after</span> dired
  <span style="font-weight: bold;">:bind</span> (<span style="font-weight: bold;">:map</span> dired-mode-map
              (<span style="font-style: italic;">"TAB"</span> . dired-subtree-cycle)))

(use-package dired-narrow
  <span style="font-weight: bold;">:after</span> dired
  <span style="font-weight: bold;">:bind</span>
  (<span style="font-weight: bold;">:map</span> dired-mode-map
        (<span style="font-style: italic;">"z"</span> . dired-narrow))
  (<span style="font-weight: bold;">:map</span> dired-narrow-map
        (<span style="font-style: italic;">"C-j"</span> . exit-minibuffer)))
</pre>
</div>
</div>
</li>

<li><a id="org01900aa"></a>dired-hide-dotfiles&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span><br /></li>

<li><a id="orgadd8125"></a>find-dired<br />
<div class="outline-text-6" id="text-orgadd8125">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package find-dired
  <span style="font-weight: bold;">:bind</span> (<span style="font-weight: bold;">:prefix</span> <span style="font-style: italic;">"M-s d"</span>
                 <span style="font-weight: bold;">:prefix-map</span> my/find-dired-map
                 <span style="font-weight: bold;">:prefix-docstring</span> <span style="font-style: italic;">"Keymap for FInd Dired"</span>
                 (<span style="font-style: italic;">"f"</span> . find-dired)
                 (<span style="font-style: italic;">"F"</span> . find-lisp-find-dired)
                 (<span style="font-style: italic;">"g"</span> . find-grep-dired)
                 (<span style="font-style: italic;">"n"</span> . find-name-dired)
                 (<span style="font-style: italic;">"d"</span> . find-lisp-find-dired-subdirectories)
                 (<span style="font-style: italic;">"!"</span> . find-dired-with-command))
  <span style="font-weight: bold;">:custom</span>
  (find-grep-options <span style="font-style: italic;">"-n -H --no-heading -q"</span>)
  (find-ls-option '(<span style="font-style: italic;">"-print0 | xargs -0 ls -ldN"</span> . <span style="font-style: italic;">"-ldN"</span>)))
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="org2c48cfb"></a>EWW<br />
<div class="outline-text-5" id="text-org2c48cfb">
<div class="org-src-container">
<pre class="src src-emacs-lisp" id="org6a96787">(no-littering-expand-var-file-name <span style="font-style: italic;">"eww/org"</span>)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-conf">d &lt;&lt;eww-org-dir()&gt;&gt; 0755 - - 3d
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">with-eval-after-load</span> 'shr
  (setopt shr-width 10000)
  (setopt shr-use-fonts nil)
  (setopt shr-image-animate t)
  (setopt shr-use-colors nil)
  (setopt shr-max-image-proportion 0.4)
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">never use cookies</span>
  (setopt shr-cookie-policy nil))
</pre>
</div>

<p>
The EWW bookmark functionality is an original implementation, separate from the emacs bookmark facility. Although <a href="https://lists.gnu.org/archive/html/emacs-devel/2020-10/msg01651.html">adoption of the facility has been considered</a>, a possible solution to count EWW bookmarks in the source of consult-buffer is showcased at <a href="https://github.com/minad/consult/issues/347">here</a>.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp" id="orga8f5cde">(use-package eww
  <span style="font-weight: bold;">:commands</span> eww
  <span style="font-weight: bold;">:after</span> my-launch-app
  <span style="font-weight: bold;">:bind</span> (<span style="font-weight: bold;">:map</span> my/invoke-list-command-map
              (<span style="font-style: italic;">"B"</span> . eww-list-bookmarks)
              <span style="font-weight: bold;">:map</span> my/launch-app-map
              (<span style="font-style: italic;">"W"</span> . eww-switch-to-buffer))
  <span style="font-weight: bold;">:custom</span>
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">set enough large column number to prevent from inserting line break</span>
  (eww-header-line-format nil)
  (eww-browse-url-new-window-is-tab nil)
  (eww-auto-rename-buffer 'title)
  (eww-buffer-name-length 20)
  <span style="font-weight: bold;">:config</span>
  (bind-keys <span style="font-weight: bold;">:map</span> eww-mode-map
             (<span style="font-style: italic;">"C"</span> . eww-set-character-encoding)
             (<span style="font-style: italic;">"C-j"</span> . eww-follow-link)
             (<span style="font-style: italic;">"T"</span> . eww-goto-title-heading)
             (<span style="font-style: italic;">"L"</span> . my/eww-goto-heading)
             (<span style="font-style: italic;">"O"</span> . my/eww-view-in-org)
             <span style="font-weight: bold;">:map</span> eww-bookmark-mode-map
             (<span style="font-style: italic;">"C-j"</span> . eww-bookmark-browse))
  (<span style="font-weight: bold;">with-eval-after-load</span> 'consult
    (<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">consult--source-eww</span>
      (list <span style="font-weight: bold;">:name</span>     <span style="font-style: italic;">"Eww"</span>
            <span style="font-weight: bold;">:narrow</span>   ?w
            <span style="font-weight: bold;">:action</span>   (<span style="font-weight: bold;">lambda</span> (bm)
                        (eww-browse-url (get-text-property 0 'url bm)))
            <span style="font-weight: bold;">:items</span>    (<span style="font-weight: bold;">lambda</span> ()
                        (eww-read-bookmarks)
                        (mapcar (<span style="font-weight: bold;">lambda</span> (bm)
                                  (propertize
                                   (format <span style="font-style: italic;">"%s (%s)"</span>
                                           (plist-get bm <span style="font-weight: bold;">:url</span>)
                                           (plist-get bm <span style="font-weight: bold;">:title</span>))
                                   'url (plist-get bm <span style="font-weight: bold;">:url</span>)))
                                eww-bookmarks))))
    (add-to-list 'consult-buffer-sources 'consult--source-eww 'append)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/eww-view-in-org</span> ()
  <span style="font-style: italic;">"Convert current html page into one org file and show it.</span>

<span style="font-style: italic;">This is handy if you would like to check a page index comfortably."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">let</span> ((source (plist-get eww-data <span style="font-weight: bold;">:source</span>))
        (src-html (make-temp-file <span style="font-style: italic;">"source-"</span>))
        (dst-org (no-littering-expand-var-file-name
                  (format <span style="font-style: italic;">"&lt;&lt;eww-org-dir()&gt;&gt;/%s.org"</span> (org-id-uuid))))
        (coding-system-for-write 'utf-8-unix)
        (org-startup-folded t))
    (<span style="font-weight: bold;">with-temp-buffer</span>
      (insert source)
      (make-directory
       (file-name-directory (directory-file-name dst-org)) t)
      (write-region (point-min) (point-max) src-html nil)
      (call-process-shell-command (format <span style="font-style: italic;">"pandoc %s -f html -t org -o %s"</span>
                                          (shell-quote-argument src-html)
                                          (shell-quote-argument dst-org)))
      (delete-file src-html))
    (find-file dst-org t)
    (goto-char (point-min))
    (org-ctrl-c-tab)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">eww-headings-dom</span> ()
  <span style="font-style: italic;">"Return heading list as a dom from xml."</span>
  (<span style="font-weight: bold;">let</span> ((source (plist-get eww-data <span style="font-weight: bold;">:source</span>))
        (dom nil))
    (<span style="font-weight: bold;">with-temp-buffer</span>
      (<span style="font-weight: bold;">let</span> ((source-file (make-temp-file <span style="font-style: italic;">"source-"</span>))
            (coding-system-for-write 'utf-8-unix))
        (insert source)
        (write-region (point-min) (point-max) source-file nil)
        (erase-buffer)
        (call-process <span style="font-style: italic;">"extract_headings"</span> source-file t)
        (delete-file source-file)
        (libxml-parse-xml-region (point-min) (point-max))))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">eww-goto-title-heading</span> ()
  <span style="font-style: italic;">"Set point to a line which contaings the possible heading."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">when-let*</span> ((headings-dom (eww-headings-dom))
              (possible-heading (cl-reduce (<span style="font-weight: bold;">lambda</span> (node-a node-b)
                                             (<span style="font-weight: bold;">if</span> (not (<span style="font-weight: bold;">bound-and-true-p</span> node-a))
                                                 (<span style="font-weight: bold;">if</span> (not (<span style="font-weight: bold;">bound-and-true-p</span> node-b))
                                                     nil
                                                   node-b)
                                               (<span style="font-weight: bold;">if</span> (&gt;= (string-to-number (<span style="font-weight: bold;">dom-attr</span> node-a 'proximity))
                                                       (string-to-number (<span style="font-weight: bold;">dom-attr</span> node-b 'proximity)))
                                                   node-a node-b)))
                                           (dom-children headings-dom)
                                           <span style="font-weight: bold;">:initial-value</span> nil))
              (possible-text (dom-text possible-heading))
              (match-pos (<span style="font-weight: bold;">or</span> (re-search-forward (format <span style="font-style: italic;">"^*?[[:blank:]]*%s[[:blank:]]*$"</span> (regexp-quote possible-text)) nil t 1)
                             (re-search-backward (format <span style="font-style: italic;">"^*?[[:blank:]]*%s[[:blank:]]*$"</span> (regexp-quote possible-text)) nil t 1))))
    (beginning-of-line)
    (recenter-top-bottom 0)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/eww-goto-heading</span> ()
  <span style="font-style: italic;">"Go to selected heading line."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">setq</span> lexical-binding t)
  (<span style="font-weight: bold;">when-let*</span> ((headings-root (eww-headings-dom))
              (cur-buf (current-buffer))
              (heading (completing-read
                        <span style="font-style: italic;">"Heading : "</span>
                        (mapcar (<span style="font-weight: bold;">lambda</span> (heading-node)
                                  (<span style="font-weight: bold;">when-let*</span> ((heading (dom-text heading-node))
                                              (tag (symbol-name (dom-tag heading-node)))
                                              (match-pos (string-match <span style="font-style: italic;">"h</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">[1-6]\\{1\\}</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">"</span> tag))
                                              (indent (- (string-to-number (match-string 1 tag)) 1)))
                                    (format <span style="font-style: italic;">"%s%s"</span>
                                            (apply 'concat (make-list indent <span style="font-style: italic;">"  "</span>))
                                            heading)))
                                (dom-children headings-root))))
              (match (string-match <span style="font-style: italic;">"</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(?:</span><span style="font-style: italic;">  </span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">*</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">.*</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">"</span> heading))
              (heading (match-string 1 heading))
              (match-pos (<span style="font-weight: bold;">or</span> (re-search-forward (build-regex heading) nil t 1)
                             (re-search-backward (build-regex heading) nil t 1))))
    (<span style="font-weight: bold;">with-current-buffer</span> cur-buf
      (switch-to-buffer cur-buf)
      (beginning-of-line)
      (recenter-top-bottom 0))))

(<span style="font-weight: bold;">defmacro</span> <span style="font-weight: bold;">build-regex</span> (str)
  <span style="font-style: italic;">"Return a regexp representation for `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">STR</span><span style="font-style: italic;">'."</span>
  `(format <span style="font-style: italic;">"^[[:blank:]SVG Image]*%s[[:blank:]]*$"</span>
           ,str))
</pre>
</div>
</div>

<ul class="org-ul">
<li><a id="org3841c01"></a>extract<sub>headings</sub><br />
<div class="outline-text-6" id="text-org3841c01">
<div class="org-src-container">
<pre class="src src-python"><span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">This script extract most probable page heading.</span>

<span style="font-weight: bold;">import</span> sys
<span style="font-weight: bold;">import</span> lxml.html <span style="font-weight: bold;">as</span> html
<span style="font-weight: bold;">from</span> lxml <span style="font-weight: bold;">import</span> etree
<span style="font-weight: bold;">import</span> difflib

<span style="font-weight: bold;">if</span> <span style="font-weight: bold;">len</span>(sys.argv) == 1:
    <span style="font-weight: bold; font-style: italic;">INPUT_STR</span> = sys.stdin.read()
    <span style="font-weight: bold; font-style: italic;">ROOT</span> = html.fromstring(INPUT_STR).getroottree()
<span style="font-weight: bold;">else</span>:
    sys.<span style="font-weight: bold; text-decoration: underline;">exit</span>(1)

<span style="font-weight: bold; font-style: italic;">OUT_ROOT</span> = etree.Element(<span style="font-style: italic;">"headings"</span>)

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">extract title text</span>
<span style="font-weight: bold; font-style: italic;">title</span> = <span style="font-style: italic;">''</span>
<span style="font-weight: bold; font-style: italic;">title_text_arr</span> = ROOT.xpath(<span style="font-style: italic;">'//title[1]//text()'</span>)
<span style="font-weight: bold;">if</span> <span style="font-weight: bold;">len</span>(title_text_arr):
    <span style="font-weight: bold; font-style: italic;">title</span> = title_text_arr[0]
    OUT_ROOT.<span style="font-weight: bold;">set</span>(<span style="font-style: italic;">"title"</span>, title.strip())

<span style="font-weight: bold; font-style: italic;">htag_text_arr</span> = ROOT.xpath(<span style="font-style: italic;">'//*[self::h1 or self::h2 or self::h3 or self::h4 or self::h5 or self::h6]'</span>)
<span style="font-weight: bold;">for</span> i <span style="font-weight: bold;">in</span> <span style="font-weight: bold;">range</span>(<span style="font-weight: bold;">len</span>(htag_text_arr)):
    <span style="font-weight: bold; font-style: italic;">text</span> = <span style="font-style: italic;">''</span>
    <span style="font-weight: bold; font-style: italic;">texts</span> = htag_text_arr[i].xpath(<span style="font-style: italic;">'.//text()'</span>)
    <span style="font-weight: bold;">if</span> <span style="font-weight: bold;">len</span>(texts) == 1:
        <span style="font-weight: bold; font-style: italic;">text</span> = texts[0].strip()
    <span style="font-weight: bold;">elif</span> <span style="font-weight: bold;">len</span>(texts) &gt; 1:
        <span style="font-weight: bold; font-style: italic;">text</span> = <span style="font-style: italic;">''</span>.join(<span style="font-weight: bold;">map</span>(<span style="font-weight: bold;">str</span>.strip, texts))
    <span style="font-weight: bold;">else</span>:
        <span style="font-weight: bold;">continue</span>
    <span style="font-weight: bold; font-style: italic;">proximity</span> = difflib.SequenceMatcher(<span style="font-weight: bold; text-decoration: underline;">None</span>, title, text).ratio()
    <span style="font-weight: bold; font-style: italic;">heading</span> = etree.Element(htag_text_arr[i].tag)
    <span style="font-weight: bold; font-style: italic;">heading.text</span> = text
    heading.<span style="font-weight: bold;">set</span>(<span style="font-style: italic;">'proximity'</span>, <span style="font-weight: bold;">str</span>(proximity))
    OUT_ROOT.append(heading)

<span style="font-weight: bold; font-style: italic;">out_root_str</span> = etree.tostring(OUT_ROOT, encoding=<span style="font-style: italic;">'utf-8'</span>, method=<span style="font-style: italic;">'xml'</span>, pretty_print=<span style="font-weight: bold; text-decoration: underline;">True</span>)
<span style="font-weight: bold;">if</span> <span style="font-weight: bold;">type</span>(out_root_str) <span style="font-weight: bold;">is</span> <span style="font-weight: bold;">bytes</span>:
    <span style="font-weight: bold; font-style: italic;">out_root_str</span> = out_root_str.decode()
    <span style="font-weight: bold;">print</span>(out_root_str)
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="org07c79c1"></a>Info<br />
<div class="outline-text-5" id="text-org07c79c1">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package info
  <span style="font-weight: bold;">:custom</span>
  (Info-use-header-line nil)
  <span style="font-weight: bold;">:config</span>
  (bind-keys <span style="font-weight: bold;">:map</span> Info-mode-map (<span style="font-style: italic;">"a"</span> . info-apropos)))
</pre>
</div>
</div>
</li>

<li><a id="org4349f9e"></a>Magit<br />
<div class="outline-text-5" id="text-org4349f9e">
<p>
<a href="https://github.com/magit/magit">Magit</a> is git front end for emacs which is outstandingly powerful.
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-magit"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package magit
  <span style="font-weight: bold;">:commands</span> (magit magit-status)
  <span style="font-weight: bold;">:bind</span> (<span style="font-style: italic;">"C-x M"</span> . magit-status)
  <span style="font-weight: bold;">:config</span>
  (bind-keys <span style="font-weight: bold;">:map</span> magit-status-mode-map
             (<span style="font-style: italic;">"/"</span> . magit-file-checkout)
             (<span style="font-style: italic;">";"</span> . magit-list-repositories)))
</pre>
</div>
</div>

<ul class="org-ul">
<li><a id="orgb3aa8ee"></a>Magit Essentials<br />
<div class="outline-text-6" id="text-orgb3aa8ee">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package magit-repos
  <span style="font-weight: bold;">:after</span> magit
  <span style="font-weight: bold;">:custom</span>
  (magit-repository-directories '((<span style="font-style: italic;">"~/git"</span> . 1))))
</pre>
</div>
</div>
</li>

<li><a id="orgef24e03"></a>Magit Revision<br />
<div class="outline-text-6" id="text-orgef24e03">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package magit-diff
  <span style="font-weight: bold;">:after</span> magit
  <span style="font-weight: bold;">:custom</span>
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">%GG denotes signature key info botained by --show-signature option in git log command</span>
  (magit-revision-headers-format
   (mapconcat #'identity
              (list <span style="font-style: italic;">"Author:     %aN &lt;%aE&gt;"</span>
                    <span style="font-style: italic;">"AuthorDate: %ad"</span>
                    <span style="font-style: italic;">"Commit:     %cN &lt;%cE&gt;"</span>
                    <span style="font-style: italic;">"CommitDate: %cd"</span>
                    <span style="font-style: italic;">"%GG"</span>)
              <span style="font-style: italic;">"\n"</span>)))
</pre>
</div>
</div>
</li>

<li><a id="org4201da8"></a>Magit Log<br />
<div class="outline-text-6" id="text-org4201da8">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package magit-log
  <span style="font-weight: bold;">:after</span> magit
  <span style="font-weight: bold;">:custom</span>
  (magit-log-show-refname-after-summary t))
</pre>
</div>
</div>
</li>

<li><a id="orgd33e616"></a>Magit Wip<br />
<div class="outline-text-6" id="text-orgd33e616">
<p>
The following excerpt is important when trying finer control for git-wip-*-mode.
</p>
<ul class="org-ul">
<li><p>
<a href="magit-wip-mode">magit-wip-mode</a>
</p>
<blockquote>
<p>
For historic reasons this mode is implemented on top of four
other 'magit-wip-*' modes, which can also be used individually,
if you want finer control over when the wip refs are updated;
but that is discouraged.
</p>
</blockquote></li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package magit-wip
  <span style="font-weight: bold;">:after</span> magit
  <span style="font-weight: bold;">:custom</span>
  (magit-wip-merge-branch t)
  <span style="font-weight: bold;">:config</span>
  (magit-wip-after-save-mode 1))
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="orgccc2ef9"></a>Mu4e<br />
<div class="outline-text-5" id="text-orgccc2ef9">
<p>
You might need to <a href="https://www.djcbsoftware.nl/code/mu/mu4e/Initializing-the-message-store.html">issue 'mu init' command</a> before initial usage or after upgrading. The command would presumably looks like the following:
</p>
<pre class="example">
mu init --maildir=~/data/share/mail --muhome=~/data/share/mu --my-address=jim@example.com --my-address=bob@example.com
</pre>


<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"mu"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package mu4e
  <span style="font-weight: bold;">:defer</span> t
  <span style="font-weight: bold;">:hook</span> (after-init . (<span style="font-weight: bold;">lambda</span> ()
                        (mu4e t)
                        (mu4e-update-mail-and-index t)))
  <span style="font-weight: bold;">:delight</span>
  (mu4e-main-mode    <span style="font-style: italic;">" MU"</span>)
  (mu4e-headers-mode <span style="font-style: italic;">" MU"</span>)
  (mu4e-view-mode    <span style="font-style: italic;">" MU"</span>)
  (mu4e-compose-mode <span style="font-style: italic;">" MU"</span>)
  <span style="font-weight: bold;">:custom</span>
  (mail-user-agent 'mu4e-user-agent)
  (mu4e-hide-index-messages t)
  (mu4e-context-policy 'pick-first)
  (mu4e-compose-context-policy 'ask)
  (mu4e-update-interval 300)
  (mu4e-split-view 'single-window)
  (mu4e-headers-date-format <span style="font-style: italic;">"%y%m%d"</span>)
  (mu4e-headers-time-format <span style="font-style: italic;">" %R"</span>)
  (mu4e-headers-fields
   '((<span style="font-weight: bold;">:human-date</span> . 6)
     (<span style="font-weight: bold;">:flags</span>      . 3)
     (<span style="font-weight: bold;">:from</span>       . 16)
     (<span style="font-weight: bold;">:subject</span>)))
  (mu4e-search-results-limit 2000)
  (mu4e-headers-advance-after-mark t)
  (mu4e-change-filenames-when-moving t)
  (mu4e-view-show-images t)
  (mu4e-html2text-command (<span style="font-weight: bold;">lambda</span> (msg)
                            (plist-put msg <span style="font-weight: bold;">:body-html</span>
                                       (<span style="font-weight: bold;">with-temp-buffer</span>
                                         (insert (<span style="font-weight: bold;">or</span> (mu4e-message-field msg <span style="font-weight: bold;">:body-html</span>) <span style="font-style: italic;">""</span>))
                                         (shell-command-on-region (point-min) (point-max) <span style="font-style: italic;">"nkf -w -Lu"</span> (current-buffer) t)
                                         (<span style="font-weight: bold;">or</span> (buffer-string) <span style="font-style: italic;">""</span>)))
                            (mu4e-shr2text msg)))
  <span style="font-weight: bold;">:config</span>
  (bind-keys <span style="font-weight: bold;">:map</span> mu4e-headers-mode-map
             (<span style="font-style: italic;">"C-j"</span> . mu4e-headers-view-message)
             <span style="font-weight: bold;">:map</span> mu4e-view-mode-map
             (<span style="font-style: italic;">"C-j"</span> . push-button)
             (<span style="font-style: italic;">"C-c C-a"</span> . mu4e-view-attachment-action)
             <span style="font-weight: bold;">:map</span> mu4e-compose-mode-map
             (<span style="font-style: italic;">"C-x C-o"</span> . org-mu4e-compose-org-mode))
  (add-to-list 'mu4e-view-actions
               '(<span style="font-style: italic;">"external browser"</span> . mu4e-action-view-in-browser) t)
  (add-to-list 'mu4e-view-actions
               '(<span style="font-style: italic;">"XWidget View"</span> . mu4e-action-view-with-xwidget) t)
  (<span style="font-weight: bold;">when</span> (fboundp 'imagemagick-register-types)
    (imagemagick-register-types)))
</pre>
</div>
</div>

<ul class="org-ul">
<li><a id="org083a041"></a>mu4e-alert&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span><br /></li>

<li><a id="org41bc4c1"></a>additional tweaks<br />
<div class="outline-text-6" id="text-org41bc4c1">
<ul class="org-ul">
<li><p>
file attachment in dired (<a href="https://www.djcbsoftware.nl/code/mu/mu4e/Dired.html">source</a>)
</p>
<pre class="example">
gnus-dired-attach (C-c RET C-a)
</pre>


<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package gnus-dired
  <span style="font-weight: bold;">:after</span> mu4e-compose
  <span style="font-weight: bold;">:hook</span>
  (dired-mode . turn-on-gnus-dired-mode)
  <span style="font-weight: bold;">:custom</span>
  (gnus-dired-mail-mode 'mu4e-user-agent))
</pre>
</div></li>

<li><p>
use contact info from org-contacts
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">with-eval-after-load</span> 'mu4e
  (add-to-list 'mu4e-headers-actions
               '(<span style="font-style: italic;">"Contact to add"</span> . mu4e-action-add-org-contact) t)
  (add-to-list 'mu4e-view-actions
               '(<span style="font-style: italic;">"Contact to add"</span> . mu4e-action-add-org-contact) t)
  (<span style="font-weight: bold;">with-eval-after-load</span> 'org-contacts
    (<span style="font-weight: bold;">setq</span> mu4e-org-contacts-file (car org-contacts-files))))
</pre>
</div></li>
</ul>
</div>
</li>
</ul>
</li>

<li><a id="org49b4194"></a>Elfeed<br />
<div class="outline-text-5" id="text-org49b4194">
<p>
<a href="https://github.com/skeeto/elfeed">Elfeed</a> is a powerful RSS feed reader with tag capability that is one of core software in my input workflow.
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-elfeed"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-style: italic;">"https://github.com/skeeto/elfeed/releases.atom"</span> soft_update)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp" id="org19698b9">(use-package elfeed
  <span style="font-weight: bold;">:delight</span>
  (elfeed-show-mode   <span style="font-style: italic;">" EF"</span>)
  (elfeed-search-mode <span style="font-style: italic;">" EF"</span>)
  <span style="font-weight: bold;">:commands</span> elfeed
  <span style="font-weight: bold;">:init</span>
  (<span style="font-weight: bold;">defface</span> <span style="font-weight: bold; font-style: italic;">elfeed-search-unchecked-title-face</span>
    nil
    <span style="font-style: italic;">"Face used in search mode for unchecked entry titles."</span>
    <span style="font-weight: bold;">:group</span> 'elfeed)
  (<span style="font-weight: bold;">defface</span> <span style="font-weight: bold; font-style: italic;">elfeed-search-checked-title-face</span>
    nil
    <span style="font-style: italic;">"Face used in search mode for checked entry titles."</span>
    <span style="font-weight: bold;">:group</span> 'elfeed)
  <span style="font-weight: bold;">:custom-face</span>
  (elfeed-search-title-face ((t (<span style="font-weight: bold;">:foreground</span> <span style="font-style: italic;">"#4D4D4D"</span>))))
  (elfeed-search-unchecked-title-face ((t (<span style="font-weight: bold;">:foreground</span> <span style="font-style: italic;">"cornflowerblue"</span>))))
  (elfeed-search-checked-title-face ((t (<span style="font-weight: bold;">:foreground</span> <span style="font-style: italic;">"darkblue"</span>))))
  <span style="font-weight: bold;">:custom</span>
  (elfeed-use-curl t)
  (elfeed-search-date-format '(<span style="font-style: italic;">"%Y%m%d"</span> 8 <span style="font-weight: bold;">:left</span>))
  (elfeed-search-title-min-width 100)
  (elfeed-search-title-max-width 120)
  (elfeed-search-trailing-width 160)
  (elfeed-sort-order 'ascending)
  (elfeed-enclosure-default-dir <span style="font-style: italic;">"~/Downloads/"</span>)
  (elfeed-save-multiple-enclosures-without-asking t)
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">defalias</span> '<span style="font-weight: bold;">elfeed-search-tag-all-unchecked</span>
    (elfeed-expose #'elfeed-search-tag-all 'unchecked)
    <span style="font-style: italic;">"Add the `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">unchecked</span><span style="font-style: italic;">' tag to all selected entries."</span>)
  (<span style="font-weight: bold;">defalias</span> '<span style="font-weight: bold;">elfeed-search-untag-all-unchecked</span>
    (elfeed-expose #'elfeed-search-untag-all 'unchecked)
    <span style="font-style: italic;">"Remove the `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">unchecked</span><span style="font-style: italic;">' tag from all selected entries."</span>)
  (<span style="font-weight: bold;">defalias</span> '<span style="font-weight: bold;">elfeed-search-tag-all-checked</span>
    (elfeed-expose #'elfeed-search-tag-all 'checked)
    <span style="font-style: italic;">"Add the `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">checked</span><span style="font-style: italic;">' tag to all selected entries."</span>)
  (<span style="font-weight: bold;">defalias</span> '<span style="font-weight: bold;">elfeed-search-untag-all-checked</span>
    (elfeed-expose #'elfeed-search-untag-all 'checked)
    <span style="font-style: italic;">"Remove the `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">checked</span><span style="font-style: italic;">' tag from all selected entries."</span>)
  (bind-keys <span style="font-weight: bold;">:map</span> elfeed-search-mode-map
             (<span style="font-style: italic;">"C-j"</span> . elfeed-search-show-entry)
             (<span style="font-style: italic;">"M-RET"</span> . elfeed-search-open-url)
             (<span style="font-style: italic;">"C-c C-o"</span> . elfeed-search-open-url)
             (<span style="font-style: italic;">"f"</span> . scroll-up-line)
             (<span style="font-style: italic;">"e"</span> . scroll-down-line)
             (<span style="font-style: italic;">"q"</span> . elfeed-kill-buffer)
             (<span style="font-style: italic;">"Q"</span> . quit-window)
             (<span style="font-style: italic;">"x"</span> . elfeed-search-update--force)
             (<span style="font-style: italic;">"c"</span> . (<span style="font-weight: bold;">lambda</span> () (<span style="font-weight: bold;">interactive</span>)
                      (elfeed-search-untag-all-unread)
                      (<span style="font-weight: bold;">unless</span> (use-region-p) (forward-line -1))
                      (elfeed-search-tag-all-unchecked)))
             (<span style="font-style: italic;">"C"</span> . elfeed-search-untag-all-unchecked)
             (<span style="font-style: italic;">"r"</span> . (<span style="font-weight: bold;">lambda</span> () (<span style="font-weight: bold;">interactive</span>)
                      (elfeed-search-untag-all-unread)
                      (<span style="font-weight: bold;">unless</span> (use-region-p) (forward-line -1))
                      (elfeed-search-untag-all-unchecked)
                      (<span style="font-weight: bold;">unless</span> (use-region-p) (forward-line -1))
                      (elfeed-search-tag-all-checked)
                      (<span style="font-weight: bold;">unless</span> (use-region-p) (forward-line -1))
                      (elfeed-search-tag-all (intern (format-time-string <span style="font-style: italic;">"%Y%m%d"</span>)))))
             (<span style="font-style: italic;">"R"</span> . elfeed-search-untag-all-checked)
             (<span style="font-style: italic;">"d"</span> . elfeed-search-untag-all-unread)
             (<span style="font-style: italic;">"Y"</span> . elfeed-search-download-media)
             (<span style="font-style: italic;">"_"</span> . elfeed-search-show-media-duration))
  (add-to-list 'elfeed-search-face-alist '(unchecked elfeed-search-unchecked-title-face))
  (add-to-list 'elfeed-search-face-alist '(checked elfeed-search-checked-title-face)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">elfeed-search-open-url</span> ()
  <span style="font-style: italic;">"Visit the current entry in your browser using 'eww-browse-url'."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (elfeed-search-untag-all-unchecked)
  (<span style="font-weight: bold;">unless</span> (use-region-p) (forward-line -1))
  (elfeed-search-tag-all-checked)
  (<span style="font-weight: bold;">unless</span> (use-region-p) (forward-line -1))
  (elfeed-search-tag-all (intern (format-time-string <span style="font-style: italic;">"%Y%m%d"</span>)))
  (<span style="font-weight: bold;">unless</span> (use-region-p) (forward-line -1))
  (elfeed-search-browse-url))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">elfeed-search-download-media</span> ()
  <span style="font-style: italic;">"Downlaod video file."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">let</span> ((entries (elfeed-search-selected)))
    (<span style="font-weight: bold;">cl-loop</span> for entry in entries
             when (<span style="font-weight: bold;">or</span> (caar (elfeed-entry-enclosures entry))
                      (elfeed-entry-link entry))
             do (<span style="font-weight: bold;">let</span> ((title (elfeed-entry-title entry)))
                  (yt-dlp-dispatch-dwim it title)
                  (dispatch-execute-macro)))
    (mapc #'elfeed-search-update-entry entries)
    (<span style="font-weight: bold;">unless</span> (<span style="font-weight: bold;">or</span> elfeed-search-remain-on-entry (use-region-p))
      (forward-line))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">elfeed-search-show-media-duration</span> ()
  <span style="font-style: italic;">"Show duration of media attached to current entry."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">let*</span> ((entry (elfeed-search-selected <span style="font-weight: bold;">:single</span>))
         (url (<span style="font-weight: bold;">or</span> (caar (elfeed-entry-enclosures entry))
                  (elfeed-entry-link entry))))
    (<span style="font-weight: bold;">let</span> ((my/execute-command-function '(shell-command-to-string string-trim princ)))
      (yt-dlp-dispatch-dwim url nil t)
      (dispatch-execute-macro))))
</pre>
</div>
</div>

<ul class="org-ul">
<li><a id="org2a35029"></a>elfeed-score<br />
<div class="outline-text-6" id="text-org2a35029">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-elfeed-score"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package elfeed-score
  <span style="font-weight: bold;">:after</span> elfeed
  <span style="font-weight: bold;">:custom</span>
  (elfeed-score-score-format '(<span style="font-style: italic;">"%d "</span> 3 <span style="font-weight: bold;">:right</span>))
  (elfeed-score-rule-stats-file
   (no-littering-expand-var-file-name <span style="font-style: italic;">"elfeed/score/stats.el"</span>))
  <span style="font-weight: bold;">:config</span>
  (elfeed-score-enable)
  (<span style="font-weight: bold;">setq</span> elfeed-search-sort-function #'my/elfeed-score-sort-descending)
  (<span style="font-weight: bold;">setq</span> elfeed-search-print-entry-function #'my/elfeed-score-search-print-entry)
  (define-key elfeed-search-mode-map <span style="font-style: italic;">"="</span> elfeed-score-map)
  (bind-keys <span style="font-weight: bold;">:map</span> elfeed-search-mode-map
             (<span style="font-style: italic;">"C-c ="</span> . my/elfeed-score-apply))
  <span style="font-weight: bold;">:preface</span>
  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/elfeed-score-apply</span> ()
    <span style="font-style: italic;">"Apply score rule from user managed score file."</span>
    (<span style="font-weight: bold;">interactive</span>)
    (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">featurep</span> '<span style="font-weight: bold; text-decoration: underline;">elfeed-score</span>)
      (elfeed-score-load-score-file elfeed-score-serde-score-file)
      (<span style="font-weight: bold;">when</span> (eq major-mode 'elfeed-search-mode)
        (elfeed-score-score-search))
      (elfeed-score-serde-write-score-file elfeed-score-serde-score-file)))
  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/elfeed-score-sort-descending</span> (a b)
    <span style="font-style: italic;">"Return non-nil if A should sort after B."</span>
    (<span style="font-weight: bold;">let</span> ((a-score (elfeed-score-scoring-get-score-from-entry a))
          (b-score (elfeed-score-scoring-get-score-from-entry b)))
      (<span style="font-weight: bold;">if</span> (&lt; a-score b-score)
          t
        (<span style="font-weight: bold;">let</span> ((a-date (elfeed-entry-date a))
              (b-date (elfeed-entry-date b)))
          (<span style="font-weight: bold;">and</span> (eq a-score b-score) (&lt; a-date b-date))))))
  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/elfeed-score-search-print-entry</span> (entry)
    <span style="font-style: italic;">"Print ENTRY to the buffer with my style."</span>
    (<span style="font-weight: bold;">let*</span> ((date (elfeed-search-format-date (elfeed-entry-date entry)))
           (title (<span style="font-weight: bold;">or</span> (elfeed-meta entry <span style="font-weight: bold;">:title</span>) (elfeed-entry-title entry) <span style="font-style: italic;">""</span>))
           (title-faces (elfeed-search--faces (elfeed-entry-tags entry)))
           (feed (elfeed-entry-feed entry))
           (feed-title
            (<span style="font-weight: bold;">when</span> feed
              (<span style="font-weight: bold;">or</span> (elfeed-meta feed <span style="font-weight: bold;">:title</span>) (elfeed-feed-title feed))))
           (tags (mapcar #'symbol-name (elfeed-entry-tags entry)))
           (tags-str (mapconcat
                      (<span style="font-weight: bold;">lambda</span> (s) (propertize s 'face 'elfeed-search-tag-face))
                      tags <span style="font-style: italic;">","</span>))
           (title-width (- (window-width) 10 elfeed-search-trailing-width))
           (title-column (elfeed-format-column
                          title (elfeed-clamp
                                 elfeed-search-title-min-width
                                 title-width
                                 elfeed-search-title-max-width)
                          <span style="font-weight: bold;">:left</span>))
           (score
            (elfeed-score-format-score
             (elfeed-score-scoring-get-score-from-entry entry))))
      (insert score)
      (<span style="font-weight: bold;">when</span> feed-title
        (insert (propertize (elfeed-format-column feed-title 6 <span style="font-weight: bold;">:left</span>)
                            'face 'elfeed-search-feed-face) <span style="font-style: italic;">" "</span>))
      (insert (propertize title-column 'face title-faces 'kbd-help title) <span style="font-style: italic;">" "</span>)
      (insert (propertize date 'face 'elfeed-search-date-face) <span style="font-style: italic;">" "</span>)
      (<span style="font-weight: bold;">when</span> tags
        (insert <span style="font-style: italic;">"("</span> tags-str <span style="font-style: italic;">")"</span>)))))
</pre>
</div>
</div>
</li>

<li><a id="org01ba1d2"></a>elfeed-org<br />
<div class="outline-text-6" id="text-org01ba1d2">
<p>
<a href="https://github.com/remyhonig/elfeed-org">elfeed-org</a> allow me to express feeds for elfeed in org file.
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-elfeed-org"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package elfeed-org
  <span style="font-weight: bold;">:after</span> (elfeed org denote)
  <span style="font-weight: bold;">:custom</span>
  (rmh-elfeed-org-ignore-tag <span style="font-style: italic;">"ARCHIVE"</span>)
  (rmh-elfeed-org-auto-ignore-invalid-feeds nil)
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">with-eval-after-load</span> 'denote
    (<span style="font-weight: bold;">setq</span> rmh-elfeed-org-files
          (list (denote-get-path-by-id <span style="font-style: italic;">"20230605T173315"</span>)))
    (elfeed-org)))
</pre>
</div>

<p>
Packages managed by other than guix (i.e. straight.el or apt) are encouraged to register feed since updating information channel is desirable to exist.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(advice-add #'rmh-elfeed-org-process
            <span style="font-weight: bold;">:after</span> #'my/elfeed-org-add-feeds)

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/elfeed-org-add-feeds</span> (rmh-elfeed-org-files rmh-elfeed-org-tree-id)
  <span style="font-style: italic;">"Add feeds in addition to feeds in `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">rmh-elfeed-org-files</span><span style="font-style: italic;">'.</span>

<span style="font-style: italic;">This function needs to be invoked after `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">rmh-elfeed-org-process</span><span style="font-style: italic;">' which clear all feeds."</span>
  (<span style="font-weight: bold;">setf</span> elfeed-feeds
        (append elfeed-feeds
                '(<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">s-exps for feeds will be inserted here</span>
                  &lt;&lt;elfeed-feeds&gt;&gt;))))
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="org1f1f706"></a>Terminal Emulators<br />
<div class="outline-text-5" id="text-org1f1f706">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">setf</span> shell-command-switch <span style="font-style: italic;">"-c"</span>)
(setopt shell-command-prompt-show-cwd t)

(shell-command-with-editor-mode 1)
</pre>
</div>
</div>

<ul class="org-ul">
<li><a id="org8478420"></a>shell<br />
<div class="outline-text-6" id="text-org8478420">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package shell
  <span style="font-weight: bold;">:delight</span> <span style="font-style: italic;">" SM"</span>
  <span style="font-weight: bold;">:commands</span> (shell)
  <span style="font-weight: bold;">:custom</span>
  (shell-has-auto-cd t)
  <span style="font-weight: bold;">:config</span>
  (bind-keys <span style="font-weight: bold;">:map</span> shell-mode-map
             (<span style="font-style: italic;">"C-j"</span> . comint-send-input)))
</pre>
</div>
</div>
</li>

<li><a id="orga352a20"></a>term<br />
<div class="outline-text-6" id="text-orga352a20">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package term
  <span style="font-weight: bold;">:disabled</span> t
  <span style="font-weight: bold;">:delight</span>
  (term-mode <span style="font-style: italic;">" TR"</span>)
  <span style="font-weight: bold;">:config</span>
  (bind-keys <span style="font-weight: bold;">:map</span> term-mode-map
             (<span style="font-style: italic;">"C-j"</span> . term-send-input)))
</pre>
</div>
</div>
</li>

<li><a id="orgdf43007"></a>vterm<br />
<div class="outline-text-6" id="text-orgdf43007">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-vterm"</span>
<span style="font-style: italic;">"emacs-multi-vterm"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-style: italic;">"https://github.com/akermu/emacs-libvterm/releases.atom"</span> soft_update)
(<span style="font-style: italic;">"https://github.com/suonlight/multi-vterm/releases.atom"</span> soft_update)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package vterm
  <span style="font-weight: bold;">:commands</span> (vterm multi-vterm multi-vterm-next)
  <span style="font-weight: bold;">:bind</span> (<span style="font-weight: bold;">:map</span> vterm-mode-map
              (<span style="font-style: italic;">"C-c M-n"</span> . multi-vterm-next)
              (<span style="font-style: italic;">"C-c M-p"</span> . multi-vterm-prev))
  <span style="font-weight: bold;">:delight</span> <span style="font-style: italic;">" VT"</span>
  <span style="font-weight: bold;">:diminish</span> ((vterm-copy-mode . <span style="font-style: italic;">"vc"</span>))
  <span style="font-weight: bold;">:custom</span>
  (vterm-min-window-width 55)
  (vterm-buffer-name-string <span style="font-style: italic;">"vterm %s"</span>)
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">multi-vterm</span>)
  (bind-keys <span style="font-weight: bold;">:map</span> vterm-mode-map
             (<span style="font-style: italic;">"C-h"</span> . vterm-send-backspace)
             (<span style="font-style: italic;">"M-h"</span> . vterm-send-meta-backspace)
             (<span style="font-style: italic;">"C-y"</span> . vterm-yank)
             (<span style="font-style: italic;">"M-y"</span> . vterm-yank-pop)
             (<span style="font-style: italic;">"M-l"</span> . nil)
             <span style="font-weight: bold;">:map</span> vterm-copy-mode-map
             (<span style="font-style: italic;">"C-j"</span> . vterm-copy-mode-done))
  (advice-add 'consult-yank-from-kill-ring <span style="font-weight: bold;">:around</span> #'advice/vterm-yank-pop))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/multi-vterm</span> (<span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> arg)
  <span style="font-style: italic;">"Switch between existing vterm buffers.</span>

<span style="font-style: italic;">Spawn a new vterm buffer if there's no available vterm buffer.</span>
<span style="font-style: italic;">If command prefix ARG is simgle `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">C-u</span><span style="font-style: italic;">', spawn a vterm buffer forcibly regardless of condition."</span>
  (<span style="font-weight: bold;">interactive</span> <span style="font-style: italic;">"P"</span>)
  (<span style="font-weight: bold;">if</span> (equal arg '(4))
      (multi-vterm)
    (multi-vterm-next)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">advice/vterm-yank-pop</span> (orig-fun <span style="font-weight: bold; text-decoration: underline;">&amp;rest</span> args)
  (<span style="font-weight: bold;">if</span> (eq major-mode 'vterm-mode)
      (<span style="font-weight: bold;">let</span> ((inhibit-read-only t)
            (yank-undo-function (<span style="font-weight: bold;">lambda</span> (_start _end) (vterm-undo))))
        (<span style="font-weight: bold;">cl-letf</span> (((symbol-function 'insert-for-yank)
                   (<span style="font-weight: bold;">lambda</span> (str) (vterm-send-string str t))))
          (apply orig-fun args)))
    (apply orig-fun args)))
</pre>
</div>
</div>
</li>

<li><a id="org6762019"></a>eshell<br />
<div class="outline-text-6" id="text-org6762019">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package eshell
  <span style="font-weight: bold;">:delight</span> <span style="font-style: italic;">" ES"</span>
  <span style="font-weight: bold;">:hook</span>
  (eshell-kill . eshell-command-alert)
  <span style="font-weight: bold;">:custom</span>
  (eshell-prompt-function
   #'(lambda ()
       (format <span style="font-style: italic;">"[%s]\n%s"</span>
               (eshell/basename (eshell/pwd))
               (<span style="font-weight: bold;">if</span> (= (user-uid) 0) <span style="font-style: italic;">"# "</span> <span style="font-style: italic;">"$ "</span>))))
  (eshell-prompt-regexp <span style="font-style: italic;">"[#$] "</span>)
  (eshell-visual-subcommands '((<span style="font-style: italic;">"git"</span> <span style="font-style: italic;">"log"</span> <span style="font-style: italic;">"diff"</span> <span style="font-style: italic;">"show"</span>)))
  (eshell-scroll-to-bottom-on-input 'this)
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">setq</span> eshell-path-env (getenv <span style="font-style: italic;">"PATH"</span>)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">eshell-command-alert</span> (process status)
  <span style="font-style: italic;">"Send `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">alert</span><span style="font-style: italic;">' with severity based on STATUS when PROCESS finished."</span>
  (<span style="font-weight: bold;">let*</span> ((cmd (process-command process))
         (buffer (process-buffer process))
         (msg (format <span style="font-style: italic;">"%s: %s"</span> (mapconcat 'identity cmd <span style="font-style: italic;">" "</span>)  status)))
    (<span style="font-weight: bold;">if</span> (string-prefix-p <span style="font-style: italic;">"finished"</span> status)
        (alert msg <span style="font-weight: bold;">:buffer</span> buffer <span style="font-weight: bold;">:severity</span>  'normal)
      (alert msg <span style="font-weight: bold;">:buffer</span> buffer <span style="font-weight: bold;">:severity</span> 'urgent))))
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="org7c521db"></a>Org Mode<br />
<div class="outline-text-5" id="text-org7c521db">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-org"</span>
<span style="font-style: italic;">"tree-sitter-org"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-style: italic;">"https://updates.orgmode.org/feed/releases"</span> soft_update)
</pre>
</div>

<p>
Basic settings for built-in Org features. Similar to [BROKEN LINK: id:587bc395-6321-4f59-97e6-6f0b62518b20], all entries obey customize group hierarchy for Org mode.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package org
  <span style="font-weight: bold;">:mode</span> (<span style="font-style: italic;">"\\.org$"</span> . org-mode)
  <span style="font-weight: bold;">:init</span>
  (<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my/org-initialized</span> nil
    <span style="font-style: italic;">"Indicator showing whether any org file had opened."</span>)
  (<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my/org-mode-init-hook</span> nil
    <span style="font-style: italic;">"One-off hook run when first org file open."</span>)
  (<span style="font-weight: bold;">setq</span> org-directory <span style="font-style: italic;">"~/org"</span>)
  <span style="font-weight: bold;">:hook</span>
  (org-mode . (<span style="font-weight: bold;">lambda</span> ()
                (<span style="font-weight: bold;">unless</span> my/org-initialized
                  (<span style="font-weight: bold;">setq</span> my/org-initialized t)
                  (run-hooks 'my/org-mode-init-hook)
                  (<span style="font-weight: bold;">provide</span> '<span style="font-weight: bold; text-decoration: underline;">my/org-mode-init</span>))))
  <span style="font-weight: bold;">:config</span>
  (bind-keys <span style="font-weight: bold;">:map</span> org-mode-map
             (<span style="font-style: italic;">"C-c F"</span> . org-next-block)
             (<span style="font-style: italic;">"C-c B"</span> . org-previous-block)))

(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my/org-todo-keyword--urgent</span> <span style="font-style: italic;">"UG"</span>
  <span style="font-style: italic;">"TODO keyword acronym standing for 'UrGent'"</span>)
(put 'my/org-todo-keyword--urgent 'char ?u)
(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my/org-todo-keyword--todo</span> <span style="font-style: italic;">"TD"</span>
  <span style="font-style: italic;">"TODO keyword acronym standing for 'ToDo'"</span>)
(put 'my/org-todo-keyword--todo 'char ?t)
(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my/org-todo-keyword--next</span> <span style="font-style: italic;">"NX"</span>
  <span style="font-style: italic;">"TODO keyword acronym standing for 'NeXt"</span>)
(put 'my/org-todo-keyword--next 'char ?n)
(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my/org-todo-keyword--in-action</span> <span style="font-style: italic;">"IA"</span>
  <span style="font-style: italic;">"TODO keyword acronym standing for 'In Action"</span>)
(put 'my/org-todo-keyword--in-action 'char ?i)
(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my/org-todo-keyword--someday</span> <span style="font-style: italic;">"OH"</span>
  <span style="font-style: italic;">"TODO keyword acronym standing for 'On Hold'"</span>)
(put 'my/org-todo-keyword--someday 'char ?h)
(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my/org-done-keyword--done</span> <span style="font-style: italic;">"DN"</span>
  <span style="font-style: italic;">"DONE keyword acronym standing for 'DoNe'"</span>)
(put 'my/org-done-keyword--done 'char ?d)
(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my/org-done-keyword--cancel</span> <span style="font-style: italic;">"CX"</span>
  <span style="font-style: italic;">"DONE keyword acronym standing for 'Cancel'"</span>)
(put 'my/org-done-keyword--cancel 'char ?x)
(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my/org-done-keyword--pending</span> <span style="font-style: italic;">"LG"</span>
  <span style="font-style: italic;">"DONE keyword acronym standing for 'Let Go'"</span>)
(put 'my/org-done-keyword--pending 'char ?l)

(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my/org-project-tag</span> <span style="font-style: italic;">"project"</span> <span style="font-style: italic;">"A tag for projects"</span>)
</pre>
</div>
</div>

<ul class="org-ul">
<li><a id="orga2f3e22"></a>org mode keymap<br />
<div class="outline-text-6" id="text-orga2f3e22">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">with-eval-after-load</span> 'org
  (<span style="font-weight: bold;">let</span> ((map org-mode-map))
    (define-key map (kbd <span style="font-style: italic;">"C-j"</span>) #'org-return)
    (define-key map (kbd <span style="font-style: italic;">"C-M-j"</span>) #'org-return-indent)
    (define-key map (kbd <span style="font-style: italic;">"M-j"</span>) #'org-meta-return)
    (define-key map (kbd <span style="font-style: italic;">"C-S-p"</span>) #'org-previous-item)
    (define-key map (kbd <span style="font-style: italic;">"C-S-n"</span>) #'org-next-item)
    (define-key map (kbd <span style="font-style: italic;">"C-S-u"</span>) #'org-up-element)
    (define-key map (kbd <span style="font-style: italic;">"C-M-d"</span>) #'org-down-element)
    (define-key map (kbd <span style="font-style: italic;">"C-&lt;"</span>) #'org-previous-link)
    (define-key map (kbd <span style="font-style: italic;">"C-&gt;"</span>) #'org-next-link)
    (define-key map (kbd <span style="font-style: italic;">"C-c @"</span>) #'org-mark-element)
    (define-key map (kbd <span style="font-style: italic;">"C-c C-SPC"</span>) #'org-mark-subtree)
    (define-key map (kbd <span style="font-style: italic;">"C-c C-a"</span>) nil)
    (define-key map (kbd <span style="font-style: italic;">"C-,"</span>) nil)
    (define-key map (kbd <span style="font-style: italic;">"M-h"</span>) nil)))
</pre>
</div>
</div>
</li>

<li><a id="org0760581"></a>org core feature setup<br />
<div class="outline-text-6" id="text-org0760581">
</div>
<ul class="org-ul">
<li><a id="org47c432b"></a>Org Agenda<br />
<div class="outline-text-7" id="text-org47c432b">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package org
  <span style="font-weight: bold;">:no-require</span> t
  <span style="font-weight: bold;">:defer</span> t
  <span style="font-weight: bold;">:init</span>
  (<span style="font-weight: bold;">setq</span> org-agenda-files
        (list (file-name-as-directory
               (expand-file-name
                (file-name-concat org-directory <span style="font-style: italic;">"agenda"</span>)))))
  <span style="font-weight: bold;">:custom</span>
  (org-agenda-inhibit-startup t))

(use-package org-agenda
  <span style="font-weight: bold;">:commands</span> org-agenda
  <span style="font-weight: bold;">:init</span>
  (<span style="font-weight: bold;">with-eval-after-load</span> 'my-org-global-map
    (keymap-set my/org-global-map <span style="font-style: italic;">"a"</span>
                'org-agenda))
  <span style="font-weight: bold;">:hook</span>
  (org-agenda-mode . (<span style="font-weight: bold;">lambda</span> ()
                       <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">TODO: this can be rewritten with `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">display-buffer</span><span style="font-weight: bold; font-style: italic;">'</span>
                       (delete-other-windows)
                       (org-agenda-to-appt t '((category <span style="font-style: italic;">"appt"</span>)))))
  <span style="font-weight: bold;">:custom</span>
  (org-agenda-use-tag-inheritance nil)
  <span style="font-weight: bold;">:config</span>
  (bind-keys <span style="font-weight: bold;">:map</span> org-agenda-mode-map
             (<span style="font-style: italic;">"C-j"</span> . org-agenda-switch-to)
             (<span style="font-style: italic;">"M"</span> . org-agenda-month-view)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">org-agenda-cmp-latest-clock-log</span> (a b)
  <span style="font-style: italic;">"Compare two org entry A and B in terms of clock log.</span>

<span style="font-style: italic;">This function can be used as `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">org-agenda-cmp-user-defined</span><span style="font-style: italic;">' in `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">org-agenda-sorting-strategy</span><span style="font-style: italic;">'."</span>
  (<span style="font-weight: bold;">let*</span> ((marker-a (get-text-property 1 'org-marker a))
         (time-a (org-get-latest-clock-log-time marker-a))
         (marker-b (get-text-property 1 'org-marker b))
         (time-b (org-get-latest-clock-log-time marker-b)))
    (<span style="font-weight: bold;">if</span> (time-less-p time-a time-b) -1 +1)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">org-clock-sum-all</span> ()
  <span style="font-style: italic;">"Sum the times for all agenda files."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">save-excursion</span>
    (mapc (<span style="font-weight: bold;">lambda</span> (file)
            (<span style="font-weight: bold;">with-current-buffer</span> (<span style="font-weight: bold;">or</span> (org-find-base-buffer-visiting file)
                                     (find-file-noselect file))
              (org-clock-sum)
              (org-clock-sum-today)))
          (org-agenda-files))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">org-get-latest-clock-log-time</span> (pom)
  <span style="font-style: italic;">"Get the latest clock log time stamp in org entry at POM as a time object.</span>

<span style="font-style: italic;">If entry at POM has no clock log time stamp, this function returns 0."</span>
  (<span style="font-weight: bold;">org-with-point-at</span> pom
    (<span style="font-weight: bold;">save-excursion</span>
      (<span style="font-weight: bold;">setq</span> end-of-subtree (org-end-of-subtree))
      (<span style="font-weight: bold;">setq</span> latest-time 0)
      (org-back-to-heading t)
      (org-show-all)
      (<span style="font-weight: bold;">while</span> (re-search-forward org-drawer-regexp end-of-subtree t)
        (<span style="font-weight: bold;">when</span> (string= (match-string 1) (org-clock-drawer-name))
          (<span style="font-weight: bold;">while</span> (<span style="font-weight: bold;">progn</span>
                   (forward-line 1)
                   (<span style="font-weight: bold;">when</span> (org-match-line (concat <span style="font-style: italic;">"^[ \t]*"</span> org-clock-string <span style="font-style: italic;">"[ \t]*"</span> org-tsr-regexp-both))
                     (<span style="font-weight: bold;">setq</span> match-ts
                           (<span style="font-weight: bold;">if</span> (match-string 3)
                               (match-string 3) (match-string 1)))
                     (<span style="font-weight: bold;">when</span> (time-less-p latest-time
                                        (apply 'encode-time (parse-time-string match-ts)))
                       (<span style="font-weight: bold;">setq</span> latest-time (apply 'encode-time (parse-time-string match-ts)))))
                   (not (org-match-line org-clock-drawer-end-re))))))))
  latest-time)
</pre>
</div>
</div>

<ul class="org-ul">
<li><a id="orgc3c34d0"></a>Org Agenda Custom Commands<br />
<div class="outline-text-8" id="text-orgc3c34d0">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">with-eval-after-load</span> 'org-agenda
  (setopt org-stuck-projects `(,(concat <span style="font-style: italic;">"+"</span> my/org-project-tag)
                               (,my/org-todo-keyword--todo ,my/org-todo-keyword--next ,my/org-todo-keyword--in-action)
                               nil <span style="font-style: italic;">""</span>))
  (<span style="font-weight: bold;">setq</span> org-agenda-custom-commands
        `((<span style="font-style: italic;">"a"</span> <span style="font-style: italic;">"Week-agenda"</span>
           agenda <span style="font-style: italic;">""</span>
           ((org-agenda-skip-function #'my/org-agenda-skip-on-hold-task)))
          (<span style="font-style: italic;">"l"</span> <span style="font-style: italic;">"Log entries in a week"</span>
           agenda <span style="font-style: italic;">""</span>
           ((org-agenda-span (<span style="font-weight: bold;">if</span> (equal current-prefix-arg '(4))
                                 'day 'week))
            (org-agenda-start-with-log-mode t)
            (org-agenda-start-with-clockreport-mode t)
            (org-agenda-include-inactive-timestamps nil)
            (org-agenda-include-diary t)
            (org-agenda-sorting-strategy
             '(time-up
               deadline-up
               todo-state-up
               priority-down))))
          (<span style="font-style: italic;">"L"</span> <span style="font-style: italic;">"Log entry timeline on today with default org-agenda-prefix-format"</span>
           agenda <span style="font-style: italic;">""</span>
           ((org-agenda-prefix-format (eval (car (get 'org-agenda-prefix-format 'standard-value))))
            (org-agenda-span (<span style="font-weight: bold;">if</span> (equal current-prefix-arg '(4))
                                 'day 'week))
            (org-agenda-start-with-clockreport-mode t)
            (org-agenda-start-with-log-mode t)
            (org-agenda-include-inactive-timestamps nil)
            (org-agenda-include-diary t)
            (org-agenda-sorting-strategy
             '(time-up
               deadline-up
               todo-state-up
               priority-down))))
          <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">KEEP IN MIND</span>
          <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">invoking `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">org-clock-sum-all</span><span style="font-weight: bold; font-style: italic;">' is required before showing effort table</span>
          (<span style="font-style: italic;">"e"</span> . <span style="font-style: italic;">"Effort table"</span>)
          (<span style="font-style: italic;">"ei"</span> <span style="font-style: italic;">"today"</span>
           ((org-ql-search-block `(<span style="font-weight: bold;">or</span> (todo ,my/org-todo-keyword--urgent)
                                      (todo ,my/org-todo-keyword--in-action)
                                      (<span style="font-weight: bold;">and</span> (clocked <span style="font-weight: bold;">:on</span> today)
                                           (<span style="font-weight: bold;">or</span> (todo) (done))
                                           (not (habit))
                                           (not (tags <span style="font-style: italic;">"web"</span>))))
                                 ((org-ql-block-header <span style="font-style: italic;">"Today's task"</span>))))
           ((org-agenda-overriding-header <span style="font-style: italic;">"Today's Task"</span>)
            (org-overriding-columns-format <span style="font-style: italic;">"%26ITEM(Task) %Effort(Effort){:} %CLOCKSUM_T(Today){:} %CLOCKSUM(Total)"</span>)
            (org-agenda-view-columns-initially t)
            (org-agenda-sorting-strategy '(todo-state-up priority-down deadline-up))))
          (<span style="font-style: italic;">"eg"</span> <span style="font-style: italic;">"this week"</span>
           ((org-ql-search-block `(<span style="font-weight: bold;">or</span> (todo ,my/org-todo-keyword--urgent)
                                      (todo ,my/org-todo-keyword--next)
                                      (todo ,my/org-todo-keyword--in-action))
                                 ((org-ql-block-header <span style="font-style: italic;">"This Week's task"</span>))))
           ((org-agenda-overriding-header <span style="font-style: italic;">"This Week's Task"</span>)
            (org-overriding-columns-format <span style="font-style: italic;">"%26ITEM(Task) %Effort(Effort){:} %CLOCKSUM_T(Today){:} %CLOCKSUM(Total)"</span>)
            (org-agenda-view-columns-initially t)
            (org-agenda-sorting-strategy '(todo-state-up priority-down deadline-up))))
          (<span style="font-style: italic;">"ed"</span> <span style="font-style: italic;">"done task"</span>
           ((org-ql-search-block `(<span style="font-weight: bold;">or</span> (todo ,my/org-done-keyword--done)
                                      (todo ,my/org-done-keyword--cancel)
                                      (todo ,my/org-done-keyword--pending))
                                 ((org-ql-block-header <span style="font-style: italic;">"Done task"</span>))))
           ((org-agenda-overriding-header <span style="font-style: italic;">"Done Task"</span>)
            (org-overriding-columns-format <span style="font-style: italic;">"%26ITEM(Task) %Effort(Effort){:} %CLOCKSUM(Total){:}"</span>)
            (org-agenda-view-columns-initially t)
            (org-agenda-sorting-strategy '(todo-state-up priority-down deadline-up))))
          (<span style="font-style: italic;">"i"</span> <span style="font-style: italic;">"Today's agenda"</span>
           ((todo <span style="font-style: italic;">"Today's agenda"</span>
                  ((org-agenda-sorting-strategy '(priority-up))))
            (org-ql-search-block `(<span style="font-weight: bold;">or</span> (todo ,my/org-todo-keyword--urgent)
                                      (todo ,my/org-todo-keyword--in-action))
                                 ((org-ql-block-header <span style="font-style: italic;">"Today's task"</span>)))
            (org-ql-search-block `(<span style="font-weight: bold;">and</span> (planning <span style="font-weight: bold;">:on</span> today)
                                       (not (todo ,my/org-todo-keyword--in-action
                                                  ,my/org-done-keyword--done
                                                  ,my/org-done-keyword--cancel
                                                  ,my/org-done-keyword--pending))
                                       (not (tags <span style="font-style: italic;">"web"</span>))
                                       (not (habit))
                                       (not (todo ,my/org-todo-keyword--someday)))
                                 ((org-ql-block-header <span style="font-style: italic;">"Scheduled/Deadlined on today"</span>)))
            (org-ql-search-block `(<span style="font-weight: bold;">and</span> (habit)
                                       (<span style="font-weight: bold;">or</span> (todo ,my/org-todo-keyword--todo)
                                           (todo ,my/org-todo-keyword--next))
                                       (scheduled <span style="font-weight: bold;">:to</span> today)
                                       (not (tags <span style="font-style: italic;">"bad_habit"</span>))
                                       (not (tags-inherited <span style="font-style: italic;">"ARCHIVE"</span>)))
                                 ((org-ql-block-header <span style="font-style: italic;">"Habits to take"</span>)))
            (org-ql-search-block `(<span style="font-weight: bold;">and</span> (ts-active <span style="font-weight: bold;">:on</span> today)
                                       (not (<span style="font-weight: bold;">or</span> (todo ,my/org-todo-keyword--in-action)
                                                (habit) (done)))
                                       (not (todo ,my/org-todo-keyword--someday)))
                                 ((org-ql-block-header <span style="font-style: italic;">"Today's common event"</span>)))
            (org-ql-search-block '(<span style="font-weight: bold;">and</span> (done)
                                       (closed <span style="font-weight: bold;">:on</span> today))
                                 ((org-ql-block-header <span style="font-style: italic;">"Completed tasks on today"</span>)))
            (org-ql-search-block '(<span style="font-weight: bold;">and</span> (habit)
                                       (last-repeat 0))
                                 ((org-ql-block-header <span style="font-style: italic;">"Completed habits on today"</span>))))
           ((org-agenda-sorting-strategy
             '(todo-state-up priority-down deadline-up))))
          (<span style="font-style: italic;">"n"</span> <span style="font-style: italic;">"This Week's agenda"</span>
           ((org-ql-search-block `(heading ,(format-time-string <span style="font-style: italic;">"%G-W%V"</span>))
                                 ((org-agenda-files `(,(file-name-concat org-directory <span style="font-style: italic;">"archive"</span> (format-time-string <span style="font-style: italic;">"archive_%Y.org"</span>))))
                                  (org-ql-block-header <span style="font-style: italic;">"This week in datetree archive"</span>)))
            (org-ql-search-block `(<span style="font-weight: bold;">or</span> (todo ,my/org-todo-keyword--next))
                                 ((org-ql-block-header <span style="font-style: italic;">"This week's tasks"</span>)))
            (org-ql-search-block `(<span style="font-weight: bold;">or</span> (todo ,my/org-todo-keyword--urgent)
                                      (todo ,my/org-todo-keyword--in-action))
                                 ((org-ql-block-header <span style="font-style: italic;">"Today's tasks"</span>)))
            (org-ql-search-block `(<span style="font-weight: bold;">and</span> (planning <span style="font-weight: bold;">:from</span> 0 <span style="font-weight: bold;">:to</span> 6)
                                       (not (todo ,my/org-todo-keyword--in-action
                                                  ,my/org-done-keyword--done
                                                  ,my/org-done-keyword--cancel
                                                  ,my/org-done-keyword--pending))
                                       (not (tags <span style="font-style: italic;">"web"</span>))
                                       (not (todo ,my/org-todo-keyword--someday))
                                       (not (habit)))
                                 ((org-ql-block-header <span style="font-style: italic;">"Scheduled/Deadlined this week"</span>)))
            (org-ql-search-block `(<span style="font-weight: bold;">and</span> (<span style="font-weight: bold;">and</span> (ts-active <span style="font-weight: bold;">:from</span> 0 <span style="font-weight: bold;">:to</span> 6)
                                            (not (deadline))
                                            (not (scheduled))
                                            (not (closed)))
                                       (not (<span style="font-weight: bold;">or</span> (todo ,my/org-todo-keyword--next
                                                      ,my/org-todo-keyword--in-action)
                                                (done))))
                                 ((org-ql-block-header <span style="font-style: italic;">"This week's common event"</span>))))
           ((org-agenda-sorting-strategy
             '(todo-state-up priority-down deadline-up))))
          (<span style="font-style: italic;">"t"</span> <span style="font-style: italic;">"All tasks"</span>
           ((org-ql-search-block `(todo ,my/org-todo-keyword--urgent)
                                 ((org-ql-block-header <span style="font-style: italic;">"Urgent task"</span>)))
            (org-ql-search-block `(todo ,my/org-todo-keyword--in-action)
                                 ((org-ql-block-header <span style="font-style: italic;">"Today's task"</span>)))
            (org-ql-search-block `(todo ,my/org-todo-keyword--next)
                                 ((org-ql-block-header <span style="font-style: italic;">"This week's task"</span>)))
            (org-ql-search-block `(<span style="font-weight: bold;">and</span> (todo ,my/org-todo-keyword--todo)
                                       (not (habit)))
                                 ((org-ql-block-header <span style="font-style: italic;">"Remaining task"</span>)))))
          (<span style="font-style: italic;">"d"</span> <span style="font-style: italic;">"Done tasks"</span>
           ((org-ql-search-block `(<span style="font-weight: bold;">and</span> (<span style="font-weight: bold;">or</span> (done)
                                           (<span style="font-weight: bold;">and</span> (todo ,my/org-todo-keyword--someday)
                                                (not (path ,(expand-file-name <span style="font-style: italic;">"agenda/on-holds.org"</span> org-directory)))))
                                       (not (tags <span style="font-style: italic;">"project"</span>)))
                                 ((org-ql-block-header <span style="font-style: italic;">"Done/Canceled/Pending task"</span>)))))
          (<span style="font-style: italic;">"p"</span> <span style="font-style: italic;">"Projects"</span> tags ,(concat <span style="font-style: italic;">"+"</span> my/org-project-tag))
          (<span style="font-style: italic;">"h"</span> <span style="font-style: italic;">"Habits in consistency graph"</span>
           agenda <span style="font-style: italic;">""</span>
           ((org-agenda-span 'day)
            (org-agenda-use-time-grid nil)
            (org-agenda-prefix-format '((agenda . <span style="font-style: italic;">""</span>)))
            (org-habit-show-all-today t)
            (org-agenda-sorting-strategy '(scheduled-up))
            <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">display habits only</span>
            (org-agenda-skip-function
             (<span style="font-weight: bold;">lambda</span> ()
               (<span style="font-weight: bold;">and</span> (<span style="font-weight: bold;">save-excursion</span>
                      (not (org-is-habit-p)))
                    (<span style="font-weight: bold;">progn</span> (outline-next-heading) (point)))))))
          (<span style="font-style: italic;">"H"</span> <span style="font-style: italic;">"show all habits"</span>
           ((org-ql-search-block '(habit)
                                 ((org-ql-block-header <span style="font-style: italic;">"All Habits"</span>))))
           ((org-agenda-sorting-strategy '(scheduled-up)))))))
</pre>
</div>
</div>
</li>

<li><a id="orgdebffd7"></a>Org Agenda Daily/Weekly<br />
<div class="outline-text-8" id="text-orgdebffd7">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">with-eval-after-load</span> 'org-agenda
  (setopt org-agenda-start-on-weekday 1)
  (setopt org-agenda-skip-deadline-if-done t)
  (setopt org-agenda-include-diary t)
  (setopt org-agenda-dim-blocked-tasks nil))
</pre>
</div>
</div>
</li>

<li><a id="orgd1a0100"></a>Org Agenda Line Format<br />
<div class="outline-text-8" id="text-orgd1a0100">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">with-eval-after-load</span> 'org-agenda
  (<span style="font-weight: bold;">setq</span> org-agenda-prefix-format '((agenda   . <span style="font-style: italic;">"%?-12t% s"</span>)
                                   (timeline . <span style="font-style: italic;">"  %s"</span>)
                                   (todo     . <span style="font-style: italic;">" "</span>)
                                   (tags     . <span style="font-style: italic;">" "</span>)
                                   (search   . <span style="font-style: italic;">" "</span>))))
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="org3425511"></a>Org Capture<br />
<div class="outline-text-7" id="text-org3425511">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package org-capture
  <span style="font-weight: bold;">:after</span> (org my-org-global-map)
  <span style="font-weight: bold;">:bind</span> (<span style="font-weight: bold;">:map</span> my/org-global-map
              (<span style="font-style: italic;">"c"</span> . org-capture))
  <span style="font-weight: bold;">:hook</span>
  (org-capture-mode . delete-other-windows)
  <span style="font-weight: bold;">:custom</span>
  (org-reverse-note-order nil)
  (org-capture-bookmark nil)
  (org-capture-templates
   `((<span style="font-style: italic;">"e"</span> <span style="font-style: italic;">"Entry"</span>
      entry (id <span style="font-style: italic;">"58e12e3e-da50-4089-9d22-565986637121"</span>)
      ,(concat <span style="font-style: italic;">"* [heading]\n%a\n"</span>
               <span style="font-style: italic;">"%(and (length&gt; \"%i\" 0)</span>
<span style="font-style: italic;">(format \"#+begin_</span><span style="font-weight: bold; font-style: italic;">\</span><span style="font-style: italic;">%1$s\n</span><span style="font-weight: bold; font-style: italic;">\</span><span style="font-style: italic;">%2$s#+end_%1$s\n\"</span>
<span style="font-style: italic;">\"text\"</span>
<span style="font-style: italic;">(replace-regexp-in-string \"^*\" \",*\" \"%i\")))"</span>))
     (<span style="font-style: italic;">"t"</span> <span style="font-style: italic;">"Task"</span>
      entry (id <span style="font-style: italic;">"58e12e3e-da50-4089-9d22-565986637121"</span>)
      ,(format <span style="font-style: italic;">"* %s %%?\n"</span>
               my/org-todo-keyword--todo))
     (<span style="font-style: italic;">"p"</span> <span style="font-style: italic;">"Project"</span>
      entry (id <span style="font-style: italic;">"58e12e3e-da50-4089-9d22-565986637121"</span>)
      <span style="font-style: italic;">"* %? [/] :project:\n#+CALL: project-tasks(id=\"\")"</span>
      <span style="font-weight: bold;">:jump-to-captured</span> t)
     (<span style="font-style: italic;">"M"</span> <span style="font-style: italic;">"Append memo to clocking task"</span>
      item (clock)
      <span style="font-style: italic;">"- %i%?"</span>))))
</pre>
</div>
</div>
</li>

<li><a id="org03cc463"></a>Org Startup<br />
<div class="outline-text-7" id="text-org03cc463">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(setopt org-startup-folded t)
(setopt org-startup-truncated t)
(setopt org-startup-with-inline-images t)
(setopt org-cycle-hide-drawer-startup t)

<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">allow _{}/^{} format for sub/super script</span>
(setopt org-use-sub-superscripts '{})
</pre>
</div>
</div>
</li>

<li><a id="orgdc3cafb"></a>Org TODO<br />
<div class="outline-text-7" id="text-orgdc3cafb">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(setopt org-enforce-todo-dependencies t)
(setopt org-todo-keywords
        `((sequence ,(format <span style="font-style: italic;">"%s(%c)"</span> my/org-todo-keyword--todo
                             (get 'my/org-todo-keyword--todo 'char))
                    ,(format <span style="font-style: italic;">"%s(%c)"</span> my/org-todo-keyword--urgent
                             (get 'my/org-todo-keyword--urgent 'char))
                    ,(format <span style="font-style: italic;">"%s(%c)"</span> my/org-todo-keyword--next
                             (get 'my/org-todo-keyword--next 'char))
                    ,(format <span style="font-style: italic;">"%s(%c)"</span> my/org-todo-keyword--in-action
                             (get 'my/org-todo-keyword--in-action 'char))
                    ,(format <span style="font-style: italic;">"%s(%c!/!)"</span> my/org-todo-keyword--someday
                             (get 'my/org-todo-keyword--someday 'char))
                    <span style="font-style: italic;">"|"</span>
                    ,(format <span style="font-style: italic;">"%s(%c!/@)"</span> my/org-done-keyword--done
                             (get 'my/org-done-keyword--done 'char))
                    ,(format <span style="font-style: italic;">"%s(%c!/@)"</span> my/org-done-keyword--cancel
                             (get 'my/org-done-keyword--cancel 'char))
                    ,(format <span style="font-style: italic;">"%s(%c!/@)"</span> my/org-done-keyword--pending
                             (get 'my/org-done-keyword--pending 'char)))))
(setopt org-todo-keyword-faces
        `((,my/org-todo-keyword--urgent    . <span style="font-style: italic;">"red1"</span>)
          (,my/org-todo-keyword--todo      . <span style="font-style: italic;">"DeepPink1"</span>)
          (,my/org-todo-keyword--next      . <span style="font-style: italic;">"green1"</span>)
          (,my/org-todo-keyword--in-action . <span style="font-style: italic;">"DodgerBlue1"</span>)
          (,my/org-todo-keyword--someday   . <span style="font-style: italic;">"SpringGreen"</span>)
          (,my/org-done-keyword--done      . <span style="font-style: italic;">"gray30"</span>)
          (,my/org-done-keyword--cancel    . <span style="font-style: italic;">"dark gray"</span>)
          (,my/org-done-keyword--pending   . <span style="font-style: italic;">"sea green"</span>)))
(setopt org-log-into-drawer t
        org-log-states-order-reversed t
        org-log-note-clock-out nil
        org-log-done 'time
        org-log-refile 'time
        org-log-reschedule nil
        org-log-redeadline 'time
        org-closed-keep-when-no-todo nil)
</pre>
</div>
</div>
</li>

<li><a id="org158d9bf"></a>Org Structure<br />
<div class="outline-text-7" id="text-org158d9bf">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package org-indent
  <span style="font-weight: bold;">:after</span> org
  <span style="font-weight: bold;">:bind</span> (<span style="font-weight: bold;">:map</span> org-mode-map
              (<span style="font-style: italic;">"C-c C-M-i"</span> . org-indent-mode))
  <span style="font-weight: bold;">:hook</span> (org-mode . org-indent-mode)
  <span style="font-weight: bold;">:custom</span>
  (org-startup-indented t)
  (org-bookmark-names-plist nil)
  (org-insert-heading-respect-content t)
  (org-M-RET-may-split-line '((default . nil))))

(use-package org-keys
  <span style="font-weight: bold;">:after</span> org
  <span style="font-weight: bold;">:custom</span>
  (org-use-speed-commands
   (<span style="font-weight: bold;">lambda</span> () (<span style="font-weight: bold;">and</span> (looking-at org-outline-regexp) (looking-back <span style="font-style: italic;">"^</span><span style="font-weight: bold; font-style: italic;">\</span><span style="font-style: italic;">**"</span>))))
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">cl-labels</span> ((os-set (key command)
                (assoc-delete-all key org-speed-commands)
                (add-to-list 'org-speed-commands
                             (cons key command)
                             t)))
    (add-to-list 'org-speed-commands '(<span style="font-style: italic;">"Additional"</span>) t)
    (os-set <span style="font-style: italic;">"k"</span> nil)                    <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">prevent from inadvertent org tree loss</span>
    (os-set <span style="font-style: italic;">"j"</span> #'org-insert-heading)
    (os-set <span style="font-style: italic;">"P"</span> #'org-set-property)
    (os-set <span style="font-style: italic;">"C"</span> #'org-clone-subtree-with-time-shift)
    (os-set <span style="font-style: italic;">"s"</span> #'org-schedule)
    (os-set <span style="font-style: italic;">"d"</span> #'org-deadline)
    (os-set <span style="font-style: italic;">"N"</span> #'org-toggle-narrow-to-subtree)
    (os-set <span style="font-style: italic;">"$"</span> #'org-archive-subtree)
    (os-set <span style="font-style: italic;">"'"</span> #'ignore)))
</pre>
</div>
</div>

<ul class="org-ul">
<li><a id="org1a9154b"></a>Org Edit Structure<br />
<div class="outline-text-8" id="text-org1a9154b">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package org-src
  <span style="font-weight: bold;">:after</span> org
  <span style="font-weight: bold;">:hook</span> (org-src-mode . (<span style="font-weight: bold;">lambda</span> ()
                          (<span style="font-weight: bold;">setq-local</span> auto-save-visited-mode nil)
                          (<span style="font-weight: bold;">setq-local</span> buffer-save-without-query t)
                          (<span style="font-weight: bold;">when</span> (eq major-mode 'text-mode)
                            (visual-line-mode 1))))
  <span style="font-weight: bold;">:custom</span>
  (org-special-ctrl-a/e t)
  (org-src-window-setup 'current-window)
  (org-edit-src-content-indentation 0)
  (org-edit-src-turn-on-auto-save nil)
  (org-edit-src-auto-save-idle-delay 30)
  (org-edit-src-persistent-message nil)
  (org-src-ask-before-returning-to-edit-buffer nil)
  (org-special-ctrl-k t)
  (org-ctrl-k-protect-subtree t)
  <span style="font-weight: bold;">:config</span>
  (mapc (<span style="font-weight: bold;">lambda</span> (temp-cons)
          (<span style="font-weight: bold;">if-let</span> ((place (assoc (car temp-cons) org-structure-template-alist)))
              (<span style="font-weight: bold;">setf</span> (cdr (assoc (car temp-cons) org-structure-template-alist)) (cdr temp-cons))
            (add-to-list 'org-structure-template-alist temp-cons t)))
        '((<span style="font-style: italic;">"sh"</span> . <span style="font-style: italic;">"src shell"</span>)
          (<span style="font-style: italic;">"tx"</span> . <span style="font-style: italic;">"src text"</span>)
          (<span style="font-style: italic;">"el"</span> . <span style="font-style: italic;">"src emacs-lisp"</span>)
          (<span style="font-style: italic;">"py"</span> . <span style="font-style: italic;">"src python"</span>)))
  (<span style="font-weight: bold;">setq</span> org-src-lang-modes
        (append org-src-lang-modes
                '((<span style="font-style: italic;">"json"</span> . json-ts)
                  (<span style="font-style: italic;">"dot"</span>  . graphviz-dot)
                  (<span style="font-style: italic;">"yaml"</span> . yaml-ts))))
  (advice-add #'org-edit-src-save
              <span style="font-weight: bold;">:before</span>
              (<span style="font-weight: bold;">lambda</span> (<span style="font-weight: bold; text-decoration: underline;">&amp;rest</span> _)
                (delete-trailing-whitespace))))
</pre>
</div>
</div>
</li>

<li><a id="org5a437a7"></a>Org Plain lists<br />
<div class="outline-text-8" id="text-org5a437a7">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(setopt org-list-demote-modify-bullet
        '((<span style="font-style: italic;">"-"</span> . <span style="font-style: italic;">"+"</span>) (<span style="font-style: italic;">"+"</span> . <span style="font-style: italic;">"-"</span>) (<span style="font-style: italic;">"*"</span> . <span style="font-style: italic;">"-"</span>)
          (<span style="font-style: italic;">"1."</span> . <span style="font-style: italic;">"1)"</span>) (<span style="font-style: italic;">"1)"</span> . <span style="font-style: italic;">"1."</span>) (<span style="font-style: italic;">"*"</span> . <span style="font-style: italic;">"1."</span>))
        org-cycle-include-plain-lists 'integrate
        org-list-use-circular-motion t
        org-list-allow-alphabetical t)
</pre>
</div>
</div>
</li>

<li><a id="org3af49b3"></a>Org Archive<br />
<div class="outline-text-8" id="text-org3af49b3">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package org-archive
  <span style="font-weight: bold;">:defer</span> t
  <span style="font-weight: bold;">:custom</span>
  (org-archive-default-command 'org-toggle-archive-tag))

(setopt org-cycle-open-archived-trees t)
</pre>
</div>
</div>
</li>

<li><a id="org29b4b93"></a>Org Inline Tasks<br />
<div class="outline-text-8" id="text-org29b4b93">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package org-inlinetask
  <span style="font-weight: bold;">:commands</span> (org-inlinetask-insert-task
             org-inlinetask-promote
             org-inlinetask-demote)
  <span style="font-weight: bold;">:custom</span>
  (org-inlinetask-default-state my/org-todo-keyword--todo)
  (org-inlinetask-min-level 10))
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="org5ce6406"></a>Org Tags<br />
<div class="outline-text-7" id="text-org5ce6406">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">with-eval-after-load</span> 'org
  (setopt org-use-tag-inheritance org-archive-tag
          org-tags-column -57
          org-tags-sort-function #'org-string-collate-greaterp))
</pre>
</div>
</div>
</li>

<li><a id="org5b0c1c5"></a>Org Properties<br />
<div class="outline-text-7" id="text-org5b0c1c5">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(setopt org-use-property-inheritance <span style="font-style: italic;">"TIMELIMIT.*"</span>
        org-highest-priority ?A
        org-lowest-priority ?Z
        org-default-priority ?E
        org-global-properties
        '((<span style="font-style: italic;">"Effort_ALL"</span>. <span style="font-style: italic;">"0 0:10 0:20 0:30 1:00 1:30 2:00 3:00 4:00 6:00 8:00"</span>)))
</pre>
</div>
</div>
</li>

<li><a id="orgc1d05d8"></a>Org Refile<br />
<div class="outline-text-7" id="text-orgc1d05d8">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package org-refile
  <span style="font-weight: bold;">:after</span> (org denote)
  <span style="font-weight: bold;">:commands</span> (org-refile)
  <span style="font-weight: bold;">:custom</span>
  (org-refile-targets
   `((org-agenda-files <span style="font-weight: bold;">:tag</span> . ,my/org-project-tag)
     (org-agenda-files <span style="font-weight: bold;">:tag</span> . <span style="font-style: italic;">"refile"</span>)
     (,(cl-remove-if-not (<span style="font-weight: bold;">lambda</span> (f)
                           (member <span style="font-style: italic;">"refile"</span>
                                   (denote-extract-keywords-from-path f)))
                         (denote-all-files))
      <span style="font-weight: bold;">:tag</span> . <span style="font-style: italic;">"refile"</span>))))
</pre>
</div>
</div>
</li>

<li><a id="org443924c"></a>Org Time<br />
<div class="outline-text-7" id="text-org443924c">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(setopt org-time-stamp-custom-formats
        '(<span style="font-style: italic;">"&lt;%m-%d %a&gt;"</span> . <span style="font-style: italic;">"&lt;%H:%M&gt;"</span>))
</pre>
</div>
</div>

<ul class="org-ul">
<li><a id="org88f58b5"></a>Org Progress<br />
<ul class="org-ul">
<li><a id="org1a321e8"></a>Org Habit<br />
<div class="outline-text-9" id="text-org1a321e8">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package org-habit
  <span style="font-weight: bold;">:after</span> my/org-mode-init
  <span style="font-weight: bold;">:custom</span>
  (org-habit-graph-column 32)
  (org-habit-preceding-days 14)
  (org-habit-following-days 21)
  (org-habit-show-habits-only-for-today t))
</pre>
</div>
</div>
</li>

<li><a id="org4c12d5d"></a>Org Clock<br />
<div class="outline-text-9" id="text-org4c12d5d">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package org-clock
  <span style="font-weight: bold;">:after</span> (org my-org-global-map)
  <span style="font-weight: bold;">:custom</span>
  (org-clock-into-drawer <span style="font-style: italic;">"CLOCK"</span>)
  (org-clock-out-when-done t)
  (org-clock-out-remove-zero-time-clocks t)
  (org-clock-persist t)
  (org-clock-persist-query-resume nil)
  (org-clock-string-limit 20)
  (org-clock-continuously t)
  (org-clock-ask-before-exiting nil)
  <span style="font-weight: bold;">:config</span>
  (org-clock-persistence-insinuate)
  (bind-keys <span style="font-weight: bold;">:map</span> my/org-global-map
             (<span style="font-style: italic;">"j"</span> . org-clock-goto)
             (<span style="font-style: italic;">"I"</span> . org-clock-in)
             (<span style="font-style: italic;">"O"</span> . org-clock-out)
             (<span style="font-style: italic;">"X"</span> . org-clock-cancel))
  (<span style="font-weight: bold;">with-eval-after-load</span> 'org-keys
    (<span style="font-weight: bold;">dolist</span> (elt '((<span style="font-style: italic;">"Clock Commands"</span>)
                   (<span style="font-style: italic;">"I"</span> . org-clock-in)
                   (<span style="font-style: italic;">"O"</span> . org-clock-out)
                   (<span style="font-style: italic;">"x"</span> . nil)
                   (<span style="font-style: italic;">"X"</span> . org-clock-cancel)))
      (add-to-list 'org-speed-commands elt t))))
</pre>
</div>
</div>
</li>
</ul>
</li>
</ul>
</li>

<li><a id="orga452149"></a>Org Appearance<br />
<div class="outline-text-7" id="text-orga452149">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(setopt org-hide-leading-stars t
        org-hide-emphasis-markers t
        org-pretty-entities t
        org-image-actual-width 100
        org-display-remote-inline-images 'cache)
</pre>
</div>
</div>
</li>

<li><a id="org465e2b2"></a>Babel<br />
<div class="outline-text-7" id="text-org465e2b2">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"plantuml"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp" id="org5986bca">(use-package ob-core
  <span style="font-weight: bold;">:after</span> org
  <span style="font-weight: bold;">:hook</span> (org-babel-after-execute . org-display-inline-images)
  <span style="font-weight: bold;">:init</span>
  (<span style="font-weight: bold;">cond</span>
   ((string= system-type <span style="font-style: italic;">"gnu/linux"</span>)
    (<span style="font-weight: bold;">setq</span> org-plantuml-jar-path (expand-file-name <span style="font-style: italic;">"plantuml.jar"</span> <span style="font-style: italic;">"~/.guix-profile/share/java"</span>)))
   ((string= system-type <span style="font-style: italic;">"darwin"</span>)
    (<span style="font-weight: bold;">setq</span> org-plantuml-jar-path <span style="font-style: italic;">"/usr/local/Cellar/plantuml/8041/plantuml.8041.jar"</span>)))
  <span style="font-weight: bold;">:custom</span>
  (org-babel-load-languages '((emacs-lisp . t)
                              (lisp       . t)
                              (C          . t)
                              (java       . t)
                              (R          . t)
                              (shell      . t)
                              (ruby       . t)
                              (python     . t)
                              (scheme     . t)
                              (lua        . t)
                              (ledger     . t)
                              (gnuplot    . t)
                              (dot        . t)
                              (plantuml   . t)
                              (lilypond   . t))))

&lt;&lt;babel-conf&gt;&gt;
</pre>
</div>
</div>

<ul class="org-ul">
<li><a id="orga1b5f7c"></a>Org Babel Tangle<br />
<div class="outline-text-8" id="text-orga1b5f7c">
<p>
org-babel-tangle-default-file-mode does not seems to be in effect. I set org-babel-default-header-args:&lt;lang&gt; instead as a wordaround.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package ob-tangle
  <span style="font-weight: bold;">:after</span> ob-core
  <span style="font-weight: bold;">:custom</span>
  (org-babel-tangle-default-file-mode (identity #o444)))
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="orgcbd06f2"></a>Org ID<br />
<div class="outline-text-7" id="text-orgcbd06f2">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package org-id
  <span style="font-weight: bold;">:after</span> org
  <span style="font-weight: bold;">:bind</span> (<span style="font-weight: bold;">:map</span> org-mode-map
              (<span style="font-style: italic;">"C-c i"</span> . org-id-copy))
  <span style="font-weight: bold;">:custom</span>
  (org-id-track-globally t)
  (org-id-link-to-org-use-id 'create-if-interactive))
</pre>
</div>
</div>
</li>

<li><a id="orgbd7b29b"></a>Org Crypt<br />
<div class="outline-text-7" id="text-orgbd7b29b">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package org-crypt
  <span style="font-weight: bold;">:after</span> my/org-mode-init
  <span style="font-weight: bold;">:custom</span>
  (org-crypt-key user-mail-address)
  <span style="font-weight: bold;">:config</span>
  (bind-keys <span style="font-weight: bold;">:map</span> org-mode-map
             (<span style="font-style: italic;">"C-c M-: e"</span> . org-encrypt-entry)
             (<span style="font-style: italic;">"C-c M-: E"</span> . org-encrypt-entries)
             (<span style="font-style: italic;">"C-c M-: d"</span> . org-decrypt-entry)
             (<span style="font-style: italic;">"C-c M-: D"</span> . org-decrypt-entries))
  (org-crypt-use-before-save-magic)
  (add-to-list 'org-tags-exclude-from-inheritance
               org-crypt-tag-matcher))
</pre>
</div>
</div>
</li>

<li><a id="org32a4a7a"></a>Org Attach&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span><br /></li>

<li><a id="org4aac1d3"></a>Org Link<br />
<div class="outline-text-7" id="text-org4aac1d3">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package ol
  <span style="font-weight: bold;">:after</span> (my-org-global-map my/org-mode-init)
  <span style="font-weight: bold;">:bind</span> (<span style="font-weight: bold;">:map</span> my/org-global-map
              (<span style="font-style: italic;">"s"</span> . org-store-link))
  <span style="font-weight: bold;">:config</span>
  (org-link-set-parameters <span style="font-style: italic;">"src"</span> <span style="font-weight: bold;">:follow</span> #'org-babel-ref-resolve))
</pre>
</div>
</div>

<ul class="org-ul">
<li><a id="org1c20042"></a>Org Follow Link<br />
<div class="outline-text-8" id="text-org1c20042">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">with-eval-after-load</span> 'ol
  (<span style="font-weight: bold;">setf</span> (alist-get 'file org-link-frame-setup) 'find-file)
  (setopt org-link-elisp-confirm-function nil))

(<span style="font-weight: bold;">with-eval-after-load</span> 'org-keys
  (setopt org-return-follows-link t))
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="org5f58b1d"></a>Org Export<br />
<ul class="org-ul">
<li><a id="org1b55377"></a>Org Export General<br />
<div class="outline-text-8" id="text-org1b55377">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package ox
  <span style="font-weight: bold;">:commands</span> org-export-dispatch
  <span style="font-weight: bold;">:custom</span>
  (org-export-with-smart-quotes t)
  (org-export-with-emphasize t)
  (org-export-with-special-strings t)
  (org-export-with-fixed-width t)
  (org-export-with-timestamps t)
  (org-export-preserve-breaks nil)
  (org-export-with-sub-superscripts nil)
  (org-export-with-archived-trees 'headline)
  (org-export-with-author nil)
  (org-export-with-broken-links 'mark)
  (org-export-with-clocks nil)
  (org-export-with-creator nil)
  (org-export-with-drawers '(not <span style="font-style: italic;">"LOGBOOK"</span>))
  (org-export-with-date nil)
  (org-export-with-entities t)
  (org-export-with-email nil)
  (org-export-with-footnotes t)
  (org-export-headline-levels 5)
  (org-export-with-inlinetasks t)
  (org-export-with-section-numbers nil)
  (org-export-with-planning nil)
  (org-export-with-priority nil)
  (org-export-with-properties nil)
  (org-export-with-statistics-cookies t)
  (org-export-with-tags nil)
  (org-export-with-tasks t)
  (org-export-with-latex t)
  (org-export-time-stamp-file nil)
  (org-export-with-title t)
  (org-export-with-toc nil)
  (org-export-with-todo-keywords nil)
  (org-export-with-tables t)
  (org-export-default-language <span style="font-style: italic;">"ja"</span>)
  (org-export-dispatch-use-expert-ui nil))
</pre>
</div>
</div>
</li>

<li><a id="org806b15a"></a>Org Export HTML<br />
<div class="outline-text-8" id="text-org806b15a">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package ox-html
  <span style="font-weight: bold;">:commands</span> (org-html-export-as-html
             org-html-export-to-html)
  <span style="font-weight: bold;">:custom</span>
  (org-html-preamble t)
  (org-html-postamble 'auto)
  (org-html-with-latex t)
  (org-html-container-element <span style="font-style: italic;">"div"</span>)
  (org-html-doctype <span style="font-style: italic;">"xhtml-strict"</span>))
</pre>
</div>
</div>
</li>

<li><a id="org93780de"></a>Org Export LaTeX<br />
<div class="outline-text-8" id="text-org93780de">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package ox-latex
  <span style="font-weight: bold;">:commands</span> (org-latex-export-as-latex
             org-latex-export-to-latex
             org-latex-export-to-pdf)
  <span style="font-weight: bold;">:custom</span>
  (org-latex-pdf-process '(<span style="font-style: italic;">"platex %f"</span>
                           <span style="font-style: italic;">"platex %f"</span>
                           <span style="font-style: italic;">"bibtex %b"</span>
                           <span style="font-style: italic;">"platex %f"</span>
                           <span style="font-style: italic;">"platex %f"</span>
                           <span style="font-style: italic;">"dvipdfmx %b.dvi"</span>))
  (org-latex-default-class <span style="font-style: italic;">"jsarticle"</span>)
  <span style="font-weight: bold;">:config</span>
  (add-to-list 'org-latex-classes
               '(<span style="font-style: italic;">"jsarticle"</span>
                 <span style="font-style: italic;">"\\documentclass[dvipdfmx,12pt]{jsarticle}"</span>
                 (<span style="font-style: italic;">"\\section{%s}"</span> . <span style="font-style: italic;">"\\section*{%s}"</span>)
                 (<span style="font-style: italic;">"\\subsection{%s}"</span> . <span style="font-style: italic;">"\\subsection*{%s}"</span>)
                 (<span style="font-style: italic;">"\\subsubsection{%s}"</span> . <span style="font-style: italic;">"\\subsubsection*{%s}"</span>)
                 (<span style="font-style: italic;">"\\paragraph{%s}"</span> . <span style="font-style: italic;">"\\paragraph*{%s}"</span>)
                 (<span style="font-style: italic;">"\\subparagraph{%s}"</span> . <span style="font-style: italic;">"\\subparagraph*{%s}"</span>)))
  (add-to-list 'org-latex-classes
               `(<span style="font-style: italic;">"beamer"</span>
                 <span style="font-style: italic;">"\\documentclass[presentation,dvipdfmx,18pt]{beamer}\n"</span>
                 (<span style="font-style: italic;">"\\section{%s}"</span> . <span style="font-style: italic;">"\\section*{%s}"</span>)
                 (<span style="font-style: italic;">"\\subsection{%s}"</span> . <span style="font-style: italic;">"\\subsection*{%s}"</span>)
                 (<span style="font-style: italic;">"\\subsubsection{%s}"</span> . <span style="font-style: italic;">"\\subsubsection*{%s}"</span>))))
</pre>
</div>
</div>
</li>
</ul>
</li>
</ul>
</li>

<li><a id="orgda50f91"></a>org 3rd-party packages<br />
<div class="outline-text-6" id="text-orgda50f91">
</div>
<ul class="org-ul">
<li><a id="org30b96dd"></a>org-ai&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span><br /></li>

<li><a id="orgdbdc4b1"></a>org-modern<br />
<div class="outline-text-7" id="text-orgdbdc4b1">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-org-modern"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package org-modern
  <span style="font-weight: bold;">:after</span> org
  <span style="font-weight: bold;">:commands</span> org-modern-mode)
</pre>
</div>
</div>
</li>

<li><a id="org86d866a"></a>org-transclusion<br />
<div class="outline-text-7" id="text-org86d866a">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-org-transclusion"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package org-transclusion
  <span style="font-weight: bold;">:after</span> org
  <span style="font-weight: bold;">:bind</span> (<span style="font-weight: bold;">:map</span> my/org-global-map
              (<span style="font-style: italic;">"t a"</span> . org-transclusion-add)
              (<span style="font-style: italic;">"t A"</span> . org-transclusion-add-all)
              (<span style="font-style: italic;">"t n"</span> . org-transclusion-make-from-link)
              (<span style="font-style: italic;">"t t"</span> . org-transclusion-activate)))
</pre>
</div>
</div>
</li>

<li><a id="orgb738843"></a>org-edna<br />
<div class="outline-text-7" id="text-orgb738843">
<p>
<a href="https://www.nongnu.org/org-edna-el/">Org Edna</a> allows to org entries to be blockers and action triggers, which is very intresting feature especially for managing successive set of tasks or any correlated tasks.
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-org-edna"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package org-edna
  <span style="font-weight: bold;">:after</span> org
  <span style="font-weight: bold;">:custom</span>
  (org-edna-mode t))
</pre>
</div>
</div>
</li>

<li><a id="org42f39a4"></a>org-drill<br />
<div class="outline-text-7" id="text-org42f39a4">
<p>
<a href="https://gitlab.com/phillord/org-drill">org-drill</a> helps me to learn english words and phrases. <a href="https://youtu.be/SGzdFtN_NqE">This video</a> introduces how I use org-drill.
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-org-drill"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-style: italic;">"https://gitlab.com/phillord/org-drill/-/tags?format=atom"</span> soft_update)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package org-drill
  <span style="font-weight: bold;">:after</span> org
  <span style="font-weight: bold;">:commands</span> (org-drill org-drill-tree)
  <span style="font-weight: bold;">:init</span>
  (bind-keys <span style="font-weight: bold;">:map</span> org-mode-map
             (<span style="font-style: italic;">"C-c D"</span> . org-drill-tree))
  <span style="font-weight: bold;">:custom</span>
  (org-drill-spaced-repetition-algorithm 'sm5))
</pre>
</div>
</div>
</li>

<li><a id="org65a81b1"></a>org-ql<br />
<div class="outline-text-7" id="text-org65a81b1">
<p>
<a href="https://github.com/alphapapa/org-ql">Org QL</a> enables me to issue queries to search org entries with either SQL-like format or plain search strings.
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-org-ql"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package org-ql
  <span style="font-weight: bold;">:after</span> (org my-org-global-map)
  <span style="font-weight: bold;">:bind</span> (<span style="font-weight: bold;">:map</span> my/org-global-map
              (<span style="font-style: italic;">"q q"</span> . org-ql-search)
              (<span style="font-style: italic;">"q v"</span> . org-ql-view)
              (<span style="font-style: italic;">"q f f"</span> . org-ql-find)
              (<span style="font-style: italic;">"q f F"</span> . org-ql-find-in-org-directory)
              (<span style="font-style: italic;">"q f a"</span> . org-ql-find-in-agenda)
              (<span style="font-style: italic;">"q f n"</span> . my/org-ql-find-in-notes)
              (<span style="font-style: italic;">"q /"</span> . org-ql-sparse-tree))
  <span style="font-weight: bold;">:preface</span>
  (<span style="font-weight: bold;">with-eval-after-load</span> 'denote
    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/org-ql-find-in-notes</span> ()
      <span style="font-style: italic;">"Call 'org-ql-find' on 'denote-all-files'."</span>
      (<span style="font-weight: bold;">interactive</span>)
      (org-ql-find (denote-all-files))))
  <span style="font-weight: bold;">:custom</span>
  (org-ql-search-directories-files-regexp <span style="font-style: italic;">"\\.org</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(?:</span><span style="font-style: italic;">\\.gpg</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">?$"</span>)
  (org-ql-search-directories-files-recursive t)
  <span style="font-weight: bold;">:preface</span>
  (<span style="font-weight: bold;">defconst</span> <span style="font-weight: bold; font-style: italic;">org-last-repeat-time-regexp</span>
    <span style="font-style: italic;">"</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(?:</span><span style="font-style: italic;">:LAST_REPEAT: *\\[</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">[</span><span style="font-style: italic;">^</span><span style="font-style: italic;">]]+</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">]</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">"</span>
    <span style="font-style: italic;">"Matches the LAST_REPEAT property together with a time stamp."</span>)
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">org-ql-search</span>)
  (org-ql-defpred last-repeat (<span style="font-weight: bold; text-decoration: underline;">&amp;key</span> from to _on)
    <span style="font-style: italic;">"Return non-nil if current entry was repeated in given period.</span>
<span style="font-style: italic;">Without arguments, return non-nil if entry has LAST_REPEAT property."</span>
    <span style="font-weight: bold;">:normalizers</span> ((`(,predicate-names ,(<span style="font-weight: bold;">and</span> num-days (pred numberp)))
                   (<span style="font-weight: bold;">let*</span> ((from-day (* -1 num-days))
                          (rest (list <span style="font-weight: bold;">:from</span> from-day)))
                     (org-ql--normalize-from-to-on
                       `(last-repeat <span style="font-weight: bold;">:from</span> ,from))))
                  (`(,predicate-names . ,rest)
                   (org-ql--normalize-from-to-on
                     `(last-repeat <span style="font-weight: bold;">:from</span> ,from <span style="font-weight: bold;">:to</span> ,to))))
    <span style="font-weight: bold;">:preambles</span> ((`(,predicate-names . ,_)
                 <span style="font-weight: bold; font-style: italic;">;;  </span><span style="font-weight: bold; font-style: italic;">Predicate still needs testing.</span>
                 (list <span style="font-weight: bold;">:regexp</span> org-last-repeat-time-regexp <span style="font-weight: bold;">:query</span> query)))
    <span style="font-weight: bold;">:body</span>
    (org-ql--predicate-ts <span style="font-weight: bold;">:from</span> from <span style="font-weight: bold;">:to</span> to <span style="font-weight: bold;">:regexp</span> org-last-repeat-time-regexp <span style="font-weight: bold;">:match-group</span> 1))
  (org-ql-defpred (tags-expanded expanded-tags tags-x xtags) (<span style="font-weight: bold; text-decoration: underline;">&amp;rest</span> tags)
    <span style="font-style: italic;">"Return non-nil if current heading has one or more of TAGS.</span>
<span style="font-style: italic;">If TAGS contains a group tag, all tags in the group is used to match.</span>
<span style="font-style: italic;">Both inherited and local tags is tested."</span>
    <span style="font-weight: bold;">:normalizers</span> ((`(,predicate-names . ,tags)
                   `(tags-expanded ,@tags)))
    <span style="font-weight: bold;">:body</span> (apply #'org-ql--predicate-tags
                 (seq-uniq (--mapcat (org-tags-expand it t)
                                     tags))))
  (org-ql-defpred (category-inherited) (<span style="font-weight: bold; text-decoration: underline;">&amp;rest</span> categories)
    <span style="font-style: italic;">"Return non-nil if current heading has CATEGORY.</span>
<span style="font-style: italic;">Ancestors are looked up If current heading has no CATEGORY."</span>
    <span style="font-weight: bold;">:body</span> (<span style="font-weight: bold;">when-let</span> ((category (<span style="font-weight: bold;">or</span> (org-get-category (point))
                                   (org-entry-get (point) <span style="font-style: italic;">"CATEGORY"</span> t))))
            (<span style="font-weight: bold;">cl-typecase</span> categories
              (null t)
              (otherwise (member category categories)))))
  (<span style="font-weight: bold;">with-eval-after-load</span> 'org-expiry
    (org-ql-defpred expired ()
      <span style="font-style: italic;">"Return non-nil if the entry is expired."</span>
      <span style="font-weight: bold;">:body</span> (org-expiry-expired-p))))

(use-package org-ql-view
  <span style="font-weight: bold;">:after</span> (org-ql org-agenda)
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">push</span> `(<span style="font-style: italic;">"Tasks on Web/Book"</span>
          <span style="font-weight: bold;">:buffers-files</span> org-agenda-files
          <span style="font-weight: bold;">:query</span> (<span style="font-weight: bold;">and</span> (<span style="font-weight: bold;">or</span> (tags <span style="font-style: italic;">"web"</span>)
                          (tags <span style="font-style: italic;">"book"</span>))
                      (not (<span style="font-weight: bold;">or</span> (done) (todo ,my/org-todo-keyword--someday))))
          <span style="font-weight: bold;">:super-groups</span> ((<span style="font-weight: bold;">:auto-tags</span>))
          <span style="font-weight: bold;">:sort</span> (priority date))
        org-ql-views)
  (<span style="font-weight: bold;">push</span> `(<span style="font-style: italic;">"Habits"</span>
          <span style="font-weight: bold;">:buffers-files</span> org-agenda-files
          <span style="font-weight: bold;">:query</span> (habit)
          <span style="font-weight: bold;">:sort</span> (todo scheduled))
        org-ql-views))
</pre>
</div>
</div>
</li>

<li><a id="orgd94122a"></a>org-contacts<br />
<div class="outline-text-7" id="text-orgd94122a">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-org-contacts"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package org-contacts
  <span style="font-weight: bold;">:after</span> (org denote)
  <span style="font-weight: bold;">:commands</span> (org-contacts-anniversaries)
  <span style="font-weight: bold;">:init</span>
  (<span style="font-weight: bold;">setq</span> org-contacts-files
        (list (denote-get-path-by-id <span style="font-style: italic;">"20230605T173003"</span>))))
</pre>
</div>
</div>
</li>

<li><a id="org6f1482a"></a>org-ml&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span><br /></li>

<li><a id="org259a932"></a>org-roam&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span><br /></li>
<li><a id="org21f2438"></a>org-mime<br />
<div class="outline-text-7" id="text-org21f2438">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-org-mime"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package org-mime
  <span style="font-weight: bold;">:after</span> org
  <span style="font-weight: bold;">:commands</span> (org-mime-org-subtree-htmlize)
  <span style="font-weight: bold;">:bind</span> (<span style="font-weight: bold;">:map</span> org-mode-map
              (<span style="font-style: italic;">"C-c M-M"</span> . org-mime-org-subtree-htmlize))
  <span style="font-weight: bold;">:custom</span>
  (org-mime-use-property-inheritance t)
  (org-mime-export-ascii t))
</pre>
</div>
</div>
</li>

<li><a id="org9a3928e"></a>org-web-tools<br />
<div class="outline-text-7" id="text-org9a3928e">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-org-web-tools"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package org-web-tools
  <span style="font-weight: bold;">:bind</span> ((<span style="font-style: italic;">"C-c C-;"</span> . org-web-tools-insert-link-for-url)))
</pre>
</div>
</div>
</li>

<li><a id="org5066b34"></a>org-volume&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span><br /></li>

<li><a id="org092d465"></a>org-clock-convenience<br />
<div class="outline-text-7" id="text-org092d465">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-style: italic;">"https://github.com/dfeich/org-clock-convenience/releases.atom"</span> soft_update)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package org-clock-convenience
  <span style="font-weight: bold;">:ensure</span> t
  <span style="font-weight: bold;">:after</span> org-agenda
  <span style="font-weight: bold;">:bind</span>
  (<span style="font-weight: bold;">:map</span> org-agenda-mode-map
        (<span style="font-style: italic;">"@"</span>   . org-clock-convenience-fill-gap)
        (<span style="font-style: italic;">"C-@"</span> . org-clock-convenience-fill-gap-both)))
</pre>
</div>
</div>
</li>

<li><a id="org339eba5"></a>org-reveal<br />
<div class="outline-text-7" id="text-org339eba5">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-org-reveal"</span>
</pre>
</div>
</div>
</li>

<li><a id="org3821ec8"></a>org-expiry<br />
<div class="outline-text-7" id="text-org3821ec8">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-org-contrib"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package org-expiry
  <span style="font-weight: bold;">:after</span> my/org-mode-init
  <span style="font-weight: bold;">:custom</span>
  (org-expiry-inactive-timestamps t)
  (org-expiry-handler-function 'org-expiry-archive-subtree)
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">with-eval-after-load</span> 'org-capture
    (add-hook 'org-capture-prepare-finalize-hook
              #'org-expiry-insert-created))
  (org-expiry-insinuate))
</pre>
</div>
</div>
</li>

<li><a id="org3eee31e"></a>ob-async&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span><br /></li>

<li><a id="orgdb3902d"></a>ob-lilypond&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span><br /></li>

<li><a id="orgfd451cb"></a>ox-hugo<br />
<div class="outline-text-7" id="text-orgfd451cb">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-ox-hugo"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package ox-hugo
  <span style="font-weight: bold;">:after</span> ox)
</pre>
</div>
</div>
</li>

<li><a id="org9147779"></a>org-web-track<br />
<div class="outline-text-7" id="text-org9147779">
<p>
<a href="my/org-web-track-update-all-and-notify">org-web-track-update-all-and-notify</a> seems not to suit midnight-hook.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package org-web-track
  <span style="font-weight: bold;">:after</span> (my/org-mode-init my-org-global-map)
  <span style="font-weight: bold;">:load-path</span> (<span style="font-style: italic;">"~/data/ghq/github.com/p-snow/org-web-track"</span>)
  <span style="font-weight: bold;">:bind</span> (<span style="font-weight: bold;">:map</span> my/org-global-map
              (<span style="font-style: italic;">"T q"</span> . my/org-web-track-ql-view)
              (<span style="font-style: italic;">"T c"</span> . org-web-track-columns)
              (<span style="font-style: italic;">"T a"</span> . org-web-track-agenda-columns)
              (<span style="font-style: italic;">"T n"</span> . org-web-track-setup-entry)
              (<span style="font-style: italic;">"T u"</span> . org-web-track-update-entry)
              (<span style="font-style: italic;">"T U"</span> . org-web-track-update-files)
              (<span style="font-style: italic;">"T i"</span> . org-web-track-insert-log-table))
  <span style="font-weight: bold;">:preface</span>
  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/org-web-track-ql-view</span> ()
    <span style="font-style: italic;">"Open Org Agenda view with tracking items which hold TRACK_URL property."</span>
    (<span style="font-weight: bold;">interactive</span>)
    (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">org-web-track</span> nil t)
    (<span style="font-weight: bold;">with-current-buffer</span> (get-buffer-create <span style="font-style: italic;">"Org Web Track"</span>)
      (org-agenda-mode)
      (<span style="font-weight: bold;">setq-local</span> org-overriding-columns-format org-web-track-columns-format
                  org-agenda-view-columns-initially t)
      (<span style="font-weight: bold;">setq</span> org-columns-modify-value-for-display-function
            'org-web-track-display-values)
      (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">org-ql</span> nil t)
        (org-ql-search org-web-track-files
                       `(property ,org-web-track-url)
                       <span style="font-weight: bold;">:super-groups</span> '((<span style="font-weight: bold;">:tag</span> <span style="font-style: italic;">"book"</span>) (<span style="font-weight: bold;">:tag</span> <span style="font-style: italic;">"food"</span>)
                                       (<span style="font-weight: bold;">:tag</span> <span style="font-style: italic;">"tool"</span>) (<span style="font-weight: bold;">:tag</span> <span style="font-style: italic;">"supply"</span>))
                       <span style="font-weight: bold;">:buffer</span> (current-buffer)))))
  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/org-web-track-update-all-and-notify</span> ()
    <span style="font-style: italic;">"Update all web tracking items in `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">org-web-track-files</span><span style="font-style: italic;">'</span>
<span style="font-style: italic;"> and send an email if any of them has changed its value."</span>
    (<span style="font-weight: bold;">let*</span> ((org-log-into-drawer t)
           (message-kill-buffer-on-exit t)
           (mail-msg (mapconcat
                      (<span style="font-weight: bold;">lambda</span> (chg)
                        (<span style="font-weight: bold;">org-with-point-at</span> chg
                          (<span style="font-weight: bold;">let</span> ((org-trust-scanner-tags t))
                            (format <span style="font-style: italic;">"%s\n\t%s\n"</span>
                                    (substring-no-properties
                                     (org-get-heading t t t t))
                                    (org-web-track-current-changes nil <span style="font-style: italic;">"%p =&gt; %c"</span> <span style="font-style: italic;">" | "</span>)))))
                      (org-web-track-update-files))))
      (<span style="font-weight: bold;">unless</span> (string-blank-p mail-msg)
        <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">you need to set SMTP info to smtpmail-xxx variables</span>
        (message-mail user-mail-address <span style="font-style: italic;">"Web Tracking Notification"</span>)
        (message-goto-body)
        (insert mail-msg)
        (message-send-and-exit))))
  <span style="font-weight: bold;">:custom</span>
  (org-web-track-selectors-alist
   `((,(<span style="font-weight: bold;">rx</span> <span style="font-style: italic;">"www.amazon.co.jp"</span> (+ anychar) <span style="font-style: italic;">"-ebook"</span>)
      <span style="font-style: italic;">"pup 'span[id=\"priceblock_ourprice\"],span[id=\"kindle-price\"],span[class=\"a-text-price\"],span[class=\"a-offscreen\"] json{}' </span><span style="font-weight: bold; font-style: italic;">\</span><span style="font-style: italic;">| jq -re '.[0].text'"</span>)
     (,(regexp-quote <span style="font-style: italic;">"www.amazon.co.jp/product-reviews"</span>)
      ([.a-size-base.a-color-secondary] <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">num of stars</span>
       [.a-size-medium.a-color-base])) <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">rating</span>
     (,(regexp-quote <span style="font-style: italic;">"www.amazon.co.jp"</span>)
      ([.a-price.aok-align-center &gt; .a-offscreen]
       [div:availability span])) <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">availability</span>
     (,(regexp-quote <span style="font-style: italic;">"www.yodobashi.com/product"</span>)
      [<span style="font-weight: bold;">:js_scl_unitPrice</span>])
     (,(regexp-quote <span style="font-style: italic;">"kakaku.com/item"</span>)
      [.priceTxt])
     (,(regexp-quote <span style="font-style: italic;">"store.steampowered.com"</span>)
      (<span style="font-weight: bold;">lambda</span> (dom)
        (<span style="font-weight: bold;">when-let</span> ((products (dom-search dom (<span style="font-weight: bold;">lambda</span> (node) (string-prefix-p <span style="font-style: italic;">"game_area_purchase_game"</span>
                                                                         (<span style="font-weight: bold;">dom-attr</span> node 'class))))))
          (dom-text (<span style="font-weight: bold;">or</span> (dom-by-class (car products) <span style="font-style: italic;">"game_purchase_price"</span>)
                        (dom-by-class (car products) <span style="font-style: italic;">"discount_final_price"</span>))))))
     (,(regexp-quote <span style="font-style: italic;">"www.googleapis.com/youtube/v3/channels"</span>)
      (<span style="font-weight: bold;">lambda</span> (json)
        (assoc-default 'subscriberCount
                       (assoc-default 'statistics (aref (cdr (assoc 'items json))
                                                        0)))))
     (,(regexp-quote <span style="font-style: italic;">"www.googleapis.com/youtube/v3/videos"</span>)
      (<span style="font-weight: bold;">lambda</span> (json)
        (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">dash</span> nil t)
          (<span style="font-weight: bold;">let</span> ((stat (-&gt;&gt; json
                           (assoc-default 'items)
                           (mapcar #'identity)
                           (nth 0)
                           (assoc-default 'statistics))))
            (list (assoc-default 'likeCount stat)
                  (assoc-default 'commentCount stat))))))
     (,(regexp-quote <span style="font-style: italic;">"openexchangerates.org/api/latest"</span>)
      (<span style="font-weight: bold;">lambda</span> (json)
        (number-to-string
         (assoc-default 'JPY
                        (assoc-default 'rates json))))
      (<span style="font-weight: bold;">lambda</span> (rate) (format <span style="font-style: italic;">"%.3f"</span> (string-to-number rate))))
     (,(regexp-quote <span style="font-style: italic;">"map.kaldi.co.jp/kaldi"</span>)
      <span style="font-style: italic;">"pup 'div[class=\"shop_bnr news\"] ul li text{}' | xargs echo -n"</span>)
     (,(regexp-quote <span style="font-style: italic;">"www.seijoishii.com"</span>)
      [.price &gt; .total])))
  (org-agenda-bulk-custom-functions
   '((?U org-web-track-agenda-update)))
  (org-web-track-item-column-width 16)
  (org-web-track-update-column-width 30)
  (org-web-track-files
   (<span style="font-weight: bold;">lambda</span> ()
     (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">denote</span> nil t)
       (<span style="font-weight: bold;">let</span> ((denote-directory (expand-file-name <span style="font-style: italic;">"~/org/notes"</span>))
             (org-agenda-files '(<span style="font-style: italic;">"~/org/agenda/"</span>)))
         (append (org-agenda-files)
                 (cl-remove-if-not (<span style="font-weight: bold;">lambda</span> (f)
                                     (member <span style="font-style: italic;">"track"</span>
                                             (denote-extract-keywords-from-path f)))
                                   (denote-all-files))))))))
</pre>
</div>
</div>

<ul class="org-ul">
<li><a id="org7fb4517"></a>batch tracking<br />
<div class="outline-text-8" id="text-org7fb4517">
<div class="org-src-container">
<pre class="src src-shell"><span style="font-weight: bold;">export</span> <span style="font-weight: bold; font-style: italic;">DISPLAY</span>=:0 &amp;&amp; <span style="font-style: italic;">\</span>
  emacs -Q --batch <span style="font-style: italic;">\</span>
        -l $<span style="font-weight: bold; font-style: italic;">XDG_CONFIG_HOME</span>/emacs/early-init.el <span style="font-style: italic;">\</span>
        -l $<span style="font-weight: bold; font-style: italic;">XDG_CONFIG_HOME</span>/emacs/lisp/my-org-web-track.el <span style="font-style: italic;">\</span>
        -l $<span style="font-weight: bold; font-style: italic;">XDG_CONFIG_HOME</span>/emacs/lisp/batch/org-web-track-mail.el <span style="font-style: italic;">\</span>
        -f my/org-web-track-mail
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">provide</span> '<span style="font-weight: bold; text-decoration: underline;">my/org-mode-init</span>)
(define-keymap <span style="font-weight: bold;">:prefix</span> 'my/org-global-map)
(<span style="font-weight: bold;">provide</span> '<span style="font-weight: bold; text-decoration: underline;">my-org-global-map</span>)

(setopt message-send-mail-function 'smtpmail-send-it
        smtpmail-smtp-server <span style="font-style: italic;">"&lt;&lt;smtp-host&gt;&gt;"</span>
        smtpmail-smtp-service 465
        smtpmail-smtp-user user-mail-address
        smtpmail-stream-type 'ssl
        smtpmail-mail-address user-mail-address
        message-send-mail-function 'smtpmail-send-it)

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/org-web-track-mail</span> ()
  <span style="font-style: italic;">"Update `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">org-web-track</span><span style="font-style: italic;">' items along with sending email and immediate exit."</span>
  (my/org-web-track-update-all-and-notify)
  (org-save-all-org-buffers)
  (save-buffers-kill-emacs t))
</pre>
</div>
</div>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>

<li><a id="orgf5c7f7a"></a>Completion<br />
<ul class="org-ul">
<li><a id="org3439e3e"></a>vertico<br />
<div class="outline-text-6" id="text-org3439e3e">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-vertico"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-style: italic;">"https://github.com/minad/vertico/releases.atom"</span> soft_update)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package vertico
  <span style="font-weight: bold;">:bind</span> (<span style="font-weight: bold;">:map</span> vertico-map
              (<span style="font-style: italic;">"C-j"</span> . exit-minibuffer)
              (<span style="font-style: italic;">"RET"</span> . vertico-directory-enter)
              (<span style="font-style: italic;">"C-h"</span> . vertico-directory-delete-char)
              (<span style="font-style: italic;">"M-h"</span> . vertico-directory-delete-word)
              (<span style="font-style: italic;">"M-q"</span> . vertico-quick-insert)
              (<span style="font-style: italic;">"C-q"</span> . vertico-quick-exit))
  <span style="font-weight: bold;">:hook</span>
  ((minibuffer-setup . vertico-repeat-save)
   <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">enable to write "~/" or "/" whatever path being input in minibuffer</span>
   (rfn-eshadow-update-overlay . vertico-directory-tidy))
  <span style="font-weight: bold;">:custom</span>
  (vertico-cycle t)
  (vertico-scroll-margin 0)
  (vertico-count 11)
  (vertico-resize 'grow-only)
  <span style="font-weight: bold;">:config</span>
  (bind-keys (<span style="font-style: italic;">"M-R"</span> . vertico-repeat))
  (vertico-mode 1))

(use-package vertico-multiform
  <span style="font-weight: bold;">:after</span> vertico
  <span style="font-weight: bold;">:bind</span> (<span style="font-weight: bold;">:map</span> vertico-map
              (<span style="font-style: italic;">"M-G"</span> . vertico-multiform-grid))
  <span style="font-weight: bold;">:config</span>
  (vertico-multiform-mode 1))
</pre>
</div>
</div>
</li>

<li><a id="orgdcb0830"></a>consult<br />
<div class="outline-text-6" id="text-orgdcb0830">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-consult"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-style: italic;">"https://github.com/minad/consult/releases.atom"</span> soft_update)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package consult
  <span style="font-weight: bold;">:after</span> my-org-global-map
  <span style="font-weight: bold;">:bind</span> ((<span style="font-style: italic;">"C-;"</span> . consult-buffer)
         (<span style="font-style: italic;">"C-c m"</span> . consult-mode-command)
         (<span style="font-style: italic;">"C-c r"</span> . consult-recent-file)
         (<span style="font-style: italic;">"C-c h"</span> . consult-outline)
         (<span style="font-style: italic;">"C-x M-:"</span> . consult-complex-command)
         (<span style="font-style: italic;">"M-y"</span> . consult-yank-pop)
         (<span style="font-style: italic;">"C-M-y"</span> . consult-yank-from-kill-ring)
         (<span style="font-style: italic;">"M-g M-g"</span> . consult-goto-line)
         (<span style="font-style: italic;">"M-g m"</span> . consult-mark)
         (<span style="font-style: italic;">"M-g M"</span> . consult-global-mark)
         (<span style="font-style: italic;">"M-g i"</span> . consult-imenu)
         (<span style="font-style: italic;">"M-g I"</span> . consult-imenu-multi)
         (<span style="font-style: italic;">"C-x r j"</span> . consult-register)
         (<span style="font-style: italic;">"M-s e"</span> . consult-isearch-history)
         (<span style="font-style: italic;">"M-s \\"</span> . consult-locate)
         (<span style="font-style: italic;">"M-s f"</span> . consult-find)
         (<span style="font-style: italic;">"M-s g"</span> . consult-grep)
         (<span style="font-style: italic;">"M-s G"</span> . consult-git-grep)
         (<span style="font-style: italic;">"M-s r"</span> . consult-ripgrep)
         (<span style="font-style: italic;">"M-s l"</span> . consult-line)
         (<span style="font-style: italic;">"H-s"</span> . consult-line)
         (<span style="font-style: italic;">"M-s L"</span> . consult-line-multi)
         (<span style="font-style: italic;">"M-s m"</span> . consult-multi-occur)
         (<span style="font-style: italic;">"M-s k"</span> . consult-keep-lines)
         (<span style="font-style: italic;">"M-s u"</span> . consult-focus-lines)
         (<span style="font-style: italic;">"M-s i"</span> . consult-info)
         (<span style="font-style: italic;">"C-x M-#"</span> . consult-theme)
         <span style="font-weight: bold;">:map</span> my/org-global-map
         (<span style="font-style: italic;">"h"</span> . consult-org-agenda)
         <span style="font-weight: bold;">:map</span> isearch-mode-map
         (<span style="font-style: italic;">"C-M-n"</span> . consult-isearch-history)
         (<span style="font-style: italic;">"M-l"</span> . consult-line)
         (<span style="font-style: italic;">"M-L"</span> . consult-line-multi)
         <span style="font-weight: bold;">:map</span> minibuffer-local-map
         (<span style="font-style: italic;">"C-M-n"</span> . consult-history)
         <span style="font-weight: bold;">:map</span> text-mode-map
         (<span style="font-style: italic;">"C-M-i"</span> . completion-at-point)
         <span style="font-weight: bold;">:map</span> org-mode-map
         (<span style="font-style: italic;">"C-M-i"</span> . completion-at-point))
  <span style="font-weight: bold;">:custom</span>
  (consult-narrow-key <span style="font-style: italic;">"&lt;"</span>)
  (consult-widen-key <span style="font-style: italic;">"&gt;"</span>)
  (consult-line-start-from-top t)
  (consult-project-root-function #'project-root-function)
  (consult-locate-args <span style="font-style: italic;">"plocate -d &lt;&lt;plocate-db()&gt;&gt; --ignore-case --existing --regexp"</span>)
  <span style="font-weight: bold;">:init</span>
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">use consult for completion unless Corfu is active</span>
  (<span style="font-weight: bold;">setq</span> completion-in-region-function
        (<span style="font-weight: bold;">lambda</span> (<span style="font-weight: bold; text-decoration: underline;">&amp;rest</span> args)
          (apply (<span style="font-weight: bold;">if</span> vertico-mode
                     #'consult-completion-in-region
                   #'completion--in-region)
                 args)))
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">with-eval-after-load</span> 'org
    (bind-keys <span style="font-weight: bold;">:map</span> org-mode-map
               (<span style="font-style: italic;">"C-c H"</span> . consult-org-heading))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">project-root-function</span> ()
  (<span style="font-weight: bold;">when-let</span> (project (project-current))
    (car (project-roots project))))
</pre>
</div>
</div>

<ul class="org-ul">
<li><a id="orgb0df22f"></a>consult-dir<br />
<div class="outline-text-7" id="text-orgb0df22f">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-consult-dir"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package consult-dir
  <span style="font-weight: bold;">:after</span> consult
  <span style="font-weight: bold;">:bind</span> (<span style="font-style: italic;">"H-d"</span> . consult-dir))
</pre>
</div>
</div>
</li>

<li><a id="orgb47901b"></a>affe<br />
<div class="outline-text-7" id="text-orgb47901b">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package affe
  <span style="font-weight: bold;">:ensure</span> t
  <span style="font-weight: bold;">:bind</span> ((<span style="font-style: italic;">"M-s a f"</span> . affe-find)
         (<span style="font-style: italic;">"M-s a g"</span> . affe-grep)))
</pre>
</div>
</div>
</li>

<li><a id="org3535b58"></a>consult-ghq<br />
<div class="outline-text-7" id="text-org3535b58">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package consult-ghq
  <span style="font-weight: bold;">:ensure</span> t
  <span style="font-weight: bold;">:defer</span> t
  <span style="font-weight: bold;">:after</span> consult
  <span style="font-weight: bold;">:bind</span> ((<span style="font-style: italic;">"C-x g f"</span> . consult-ghq-find)
         (<span style="font-style: italic;">"C-x g g"</span> . consult-ghq-grep)))
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="org820adc1"></a>embark<br />
<div class="outline-text-6" id="text-org820adc1">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-embark"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-style: italic;">"https://github.com/oantolin/embark/releases.atom"</span> soft_update)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package embark
  <span style="font-weight: bold;">:bind</span> ((<span style="font-style: italic;">"C-."</span> . embark-act)
         (<span style="font-style: italic;">"M-."</span> . embark-dwim)
         (<span style="font-style: italic;">"&lt;help&gt; B"</span> . embark-bindings)
         <span style="font-weight: bold;">:map</span> embark-file-map
         (<span style="font-style: italic;">"b"</span> . browse-url))
  <span style="font-weight: bold;">:init</span>
  (<span style="font-weight: bold;">setq</span> prefix-help-command #'embark-prefix-help-command) <span style="font-weight: bold; font-style: italic;">;</span>
  <span style="font-weight: bold;">:custom</span>
  (embark-mixed-indicator-delay 3)
  <span style="font-weight: bold;">:hook</span>
  (embark-collect-mode . consult-preview-at-point-mode)
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">embark-consult</span>)
  (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">embark-org</span>)
  (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">avy-embark-collect</span>)
  (<span style="font-weight: bold;">push</span> 'embark--allow-edit
        (alist-get 'shell-command-on-region embark-target-injection-hooks)))
</pre>
</div>
</div>
</li>

<li><a id="org2a9f749"></a>marginalia<br />
<div class="outline-text-6" id="text-org2a9f749">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-marginalia"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-style: italic;">"https://github.com/minad/marginalia/releases.atom"</span> soft_update)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package marginalia
  <span style="font-weight: bold;">:after</span> vertico
  <span style="font-weight: bold;">:config</span>
  (marginalia-mode 1))
</pre>
</div>
</div>
</li>

<li><a id="org693b6d5"></a>orderless<br />
<div class="outline-text-6" id="text-org693b6d5">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-orderless"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-style: italic;">"https://github.com/oantolin/orderless/releases.atom"</span> soft_update)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package orderless
  <span style="font-weight: bold;">:custom</span> (completion-styles '(orderless)))
</pre>
</div>
</div>

<ul class="org-ul">
<li><a id="orgd33a631"></a>support for migemo in orderless<br />
<div class="outline-text-7" id="text-orgd33a631">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">orderless-migemo</span> (component)
  (<span style="font-weight: bold;">let</span> ((pattern (migemo-get-pattern component)))
    (<span style="font-weight: bold;">condition-case</span> nil
        (<span style="font-weight: bold;">progn</span> (string-match-p pattern <span style="font-style: italic;">""</span>) pattern)
      (invalid-regexp nil))))

(orderless-define-completion-style orderless-default-style
  (orderless-matching-styles '(orderless-literal
                               orderless-regexp)))

(orderless-define-completion-style orderless-migemo-style
  (orderless-matching-styles '(orderless-literal
                               orderless-regexp
                               orderless-migemo)))

(<span style="font-weight: bold;">setq</span> orderless-matching-styles '(orderless-literal orderless-regexp orderless-migemo))

<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Uncomment this clause if you prefer to apply rules for completion categories selectively</span>
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(setq completion-category-overrides</span>
<span style="font-weight: bold; font-style: italic;">;;       </span><span style="font-weight: bold; font-style: italic;">'((command (styles orderless-default-style))</span>
<span style="font-weight: bold; font-style: italic;">;;         </span><span style="font-weight: bold; font-style: italic;">(file (styles orderless-migemo-style))</span>
<span style="font-weight: bold; font-style: italic;">;;         </span><span style="font-weight: bold; font-style: italic;">(project-file (styles orderless-migemo-style))</span>
<span style="font-weight: bold; font-style: italic;">;;         </span><span style="font-weight: bold; font-style: italic;">(buffer (styles orderless-migemo-style))</span>
<span style="font-weight: bold; font-style: italic;">;;         </span><span style="font-weight: bold; font-style: italic;">(symbol (styles orderless-default-style))</span>
<span style="font-weight: bold; font-style: italic;">;;         </span><span style="font-weight: bold; font-style: italic;">(multi-category (styles orderless-migemo-style))</span>
<span style="font-weight: bold; font-style: italic;">;;         </span><span style="font-weight: bold; font-style: italic;">(org-heading (styles orderless-migemo-style))</span>
<span style="font-weight: bold; font-style: italic;">;;         </span><span style="font-weight: bold; font-style: italic;">(consult-location (styles orderless-migemo-style))</span>
<span style="font-weight: bold; font-style: italic;">;;         </span><span style="font-weight: bold; font-style: italic;">(org-roam-node (styles orderless-migemo-style))</span>
<span style="font-weight: bold; font-style: italic;">;;         </span><span style="font-weight: bold; font-style: italic;">(unicode-name (styles orderless-migemo-style))</span>
<span style="font-weight: bold; font-style: italic;">;;         </span><span style="font-weight: bold; font-style: italic;">(variable (styles orderless-default-style))))</span>
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="org57e8c39"></a>corfu<br />
<div class="outline-text-6" id="text-org57e8c39">
<p>
Though I prefer vertico more for completion interface, <a href="https://github.com/minad/consult">consult manual</a> says Vertico can't be used with Eglot or lsp-mode. So I decided to use Corfu only in prog-mode.
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-corfu"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package corfu
  <span style="font-weight: bold;">:hook</span> ((prog-mode shell-mode eshell-mode) . corfu-mode)
  <span style="font-weight: bold;">:custom</span>
  (corfu-cycle t)
  (corfu-auto t)
  (corfu-preselect-first t))
</pre>
</div>
</div>
</li>

<li><a id="org4c3011a"></a>cape<br />
<div class="outline-text-6" id="text-org4c3011a">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-cape"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package cape
  <span style="font-weight: bold;">:bind</span> (<span style="font-weight: bold;">:map</span> ctl-x-map
              <span style="font-weight: bold;">:prefix</span> <span style="font-style: italic;">"C-M-i"</span>
              <span style="font-weight: bold;">:prefix-map</span> my/cape-map
              <span style="font-weight: bold;">:prefix-docstring</span> <span style="font-style: italic;">"Keymap for cape commands."</span>
              (<span style="font-style: italic;">"C-M-i"</span> . completion-at-point)
              (<span style="font-style: italic;">"d"</span> . cape-dabbrev)
              (<span style="font-style: italic;">"h"</span> . cape-history)
              (<span style="font-style: italic;">"f"</span> . cape-file)
              (<span style="font-style: italic;">"k"</span> . cape-keyword)
              (<span style="font-style: italic;">"s"</span> . cape-symbol)
              (<span style="font-style: italic;">"a"</span> . cape-abbrev)
              (<span style="font-style: italic;">"l"</span> . cape-line)
              (<span style="font-style: italic;">"w"</span> . cape-dict)
              (<span style="font-style: italic;">"\\"</span> . cape-tex)
              (<span style="font-style: italic;">"_"</span> . cape-tex)
              (<span style="font-style: italic;">"^"</span> . cape-tex)
              (<span style="font-style: italic;">"&amp;"</span> . cape-sgml)
              (<span style="font-style: italic;">"r"</span> . cape-rfc1345))
  <span style="font-weight: bold;">:hook</span>
  (text-mode . (<span style="font-weight: bold;">lambda</span> ()
                 (<span style="font-weight: bold;">setq-local</span> completion-at-point-functions
                             (append completion-at-point-functions
                                     '(cape-dabbrev
                                       cape-file
                                       cape-symbol
                                       cape-dict)))))
  (prog-mode . (<span style="font-weight: bold;">lambda</span> ()
                 (<span style="font-weight: bold;">setq-local</span> completion-at-point-functions
                             (append completion-at-point-functions
                                     '(cape-dabbrev
                                       cape-file
                                       cape-symbol
                                       cape-keyword
                                       cape-history))))))
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="org7fadba3"></a>text-mode and its derivatives<br />
<ul class="org-ul">
<li><a id="orgbdc0bbb"></a>nxml-mode<br />
<div class="outline-text-6" id="text-orgbdc0bbb">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package nxml-mode
  <span style="font-weight: bold;">:delight</span> (nxml-mode <span style="font-style: italic;">" XM"</span>)
  <span style="font-weight: bold;">:mode</span> ((<span style="font-style: italic;">"</span><span style="font-weight: bold; font-style: italic;">\</span><span style="font-style: italic;">.xml$"</span>   . nxml-mode)
         (<span style="font-style: italic;">"</span><span style="font-weight: bold; font-style: italic;">\</span><span style="font-style: italic;">.xsl$"</span>   . nxml-mode)
         (<span style="font-style: italic;">"</span><span style="font-weight: bold; font-style: italic;">\</span><span style="font-style: italic;">.xhtml$"</span> . nxml-mode)
         (<span style="font-style: italic;">"</span><span style="font-weight: bold; font-style: italic;">\</span><span style="font-style: italic;">.page$"</span>  . nxml-mode)
         (<span style="font-style: italic;">"</span><span style="font-weight: bold; font-style: italic;">\</span><span style="font-style: italic;">.plist$"</span> . nxml-mode))
  <span style="font-weight: bold;">:hook</span> (nxml-mode . my/prog-mode-hook-function)
  <span style="font-weight: bold;">:custom</span>
  (nxml-child-indent 2)
  (nxml-attribute-indent 2)
  (nxml-slash-auto-complete-flag t)
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">setq-local</span> tab-width 2)
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">pattern in hideshow mode for nxml mode</span>
  (add-to-list 'hs-special-modes-alist
               (list 'nxml-mode
                     <span style="font-style: italic;">"&lt;!--</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">|</span><span style="font-style: italic;">&lt;[</span><span style="font-style: italic;">^</span><span style="font-style: italic;">/&gt;]*[</span><span style="font-style: italic;">^</span><span style="font-style: italic;">/]&gt;"</span>
                     <span style="font-style: italic;">"--&gt;</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">|</span><span style="font-style: italic;">&lt;/[</span><span style="font-style: italic;">^</span><span style="font-style: italic;">/&gt;]*[</span><span style="font-style: italic;">^</span><span style="font-style: italic;">/]&gt;"</span>
                     <span style="font-style: italic;">"&lt;!--"</span>
                     'nxml-forward-element
                     nil)))
</pre>
</div>
</div>
</li>

<li><a id="org251bd6d"></a>toml-mode<br />
<div class="outline-text-6" id="text-org251bd6d">
<p>
language grammar for toml
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(toml <span style="font-style: italic;">"https://github.com/tree-sitter/tree-sitter-toml"</span>)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(toml-mode . toml-ts-mode)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package toml
  <span style="font-weight: bold;">:mode</span> <span style="font-style: italic;">"\\.toml$"</span>)
</pre>
</div>
</div>
</li>

<li><a id="orgc2f062d"></a>yaml-mode<br />
<div class="outline-text-6" id="text-orgc2f062d">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(yaml <span style="font-style: italic;">"https://github.com/ikatyang/tree-sitter-yaml"</span>)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(yaml-mode . yaml-ts-mode)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(yaml-ts-mode . combobulate-mode)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package yaml
  <span style="font-weight: bold;">:mode</span> <span style="font-style: italic;">"\\.ya?ml$"</span>)
</pre>
</div>
</div>
</li>

<li><a id="org8e480ed"></a>json-mode<br />
<div class="outline-text-6" id="text-org8e480ed">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"tree-sitter-json"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(json-mode . json-ts-mode)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package json
  <span style="font-weight: bold;">:mode</span> <span style="font-style: italic;">"\\.json$"</span>)
</pre>
</div>
</div>
</li>

<li><a id="org54da070"></a>markdown-mode<br />
<div class="outline-text-6" id="text-org54da070">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"markdown"</span>
<span style="font-style: italic;">"tree-sitter-markdown"</span>
<span style="font-style: italic;">"emacs-markdown-mode"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package markdown-mode
  <span style="font-weight: bold;">:mode</span> <span style="font-style: italic;">"\\.md$"</span>)
</pre>
</div>
</div>
</li>

<li><a id="org91a7c79"></a>tex-mode<br />
<div class="outline-text-6" id="text-org91a7c79">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package tex-mode
  <span style="font-weight: bold;">:mode</span> (<span style="font-style: italic;">"\\.tex$"</span> . latex-mode)
  <span style="font-weight: bold;">:hook</span> ((tex-mode . (<span style="font-weight: bold;">lambda</span> () (<span style="font-weight: bold;">setq</span> ispell-parser 'tex))))
  <span style="font-weight: bold;">:config</span>
  (my/add-dash-docsets-hook 'latex-mode-hook '(<span style="font-style: italic;">"LaTeX"</span>)))
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="orgf0fefcc"></a>prog-mode and its derivatives<br />
<div class="outline-text-5" id="text-orgf0fefcc">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(add-hook 'prog-mode-hook
          #'my/prog-mode-hook-function)

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/prog-mode-hook-function</span> ()
  (hl-line-mode -1)
  (hs-minor-mode -1)
  (display-fill-column-indicator-mode 1)
  (prettify-symbols-mode 1))
</pre>
</div>
</div>

<ul class="org-ul">
<li><a id="org5d260f7"></a>sh-mode<br />
<div class="outline-text-6" id="text-org5d260f7">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"tree-sitter-bash"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package sh-script
  <span style="font-weight: bold;">:delight</span> <span style="font-style: italic;">" SH"</span>
  <span style="font-weight: bold;">:commands</span> sh-mode
  <span style="font-weight: bold;">:mode</span> (<span style="font-style: italic;">"\\.sh$"</span> . sh-mode)
  <span style="font-weight: bold;">:custom</span>
  (sh-basic-offset 2)
  (sh-indent-after-if '+)
  (sh-indent-for-case-label 0)
  (sh-indent-for-case-alt '+)
  <span style="font-weight: bold;">:config</span>
  (my/add-dash-docsets-hook 'sh-mode-hook '(<span style="font-style: italic;">"Bash"</span>)))
</pre>
</div>
</div>
</li>

<li><a id="orga574831"></a>emacs-lisp-mode<br />
<div class="outline-text-6" id="text-orga574831">
<p>
I'm in the trial of pp-eval-last-sexp instead of eval-last-sexp adviced from <a href="https://karthinks.com/software/an-elisp-editing-tip/">this blog post</a>
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(elisp <span style="font-style: italic;">"https://github.com/Wilfred/tree-sitter-elisp"</span>)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package elisp-mode
  <span style="font-weight: bold;">:mode</span> (<span style="font-style: italic;">"\\.eld?$"</span> . emacs-lisp-mode)
  <span style="font-weight: bold;">:commands</span> emacs-lisp-mode
  <span style="font-weight: bold;">:hook</span> (emacs-lisp-mode . (<span style="font-weight: bold;">lambda</span> ()
                             (<span style="font-weight: bold;">setq-local</span> devdocs-current-docs '(<span style="font-style: italic;">"elisp"</span>))
                             (<span style="font-weight: bold;">push</span> '(<span style="font-style: italic;">"lambda"</span> . ?&#955;) prettify-symbols-alist)
                             (<span style="font-weight: bold;">setq-local</span> tab-width 8)
                             (eldoc-mode 1)))
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">eldoc</span>)
  (substitute-key-definition 'eval-last-sexp
                             'pp-eval-last-sexp
                             global-map)
  (my/add-dash-docsets-hook 'emacs-lisp-mode-hook
                            '(<span style="font-style: italic;">"Emacs Lisp"</span>)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/elisp-mode-eval-buffer</span> ()
  (<span style="font-weight: bold;">interactive</span>)
  (message <span style="font-style: italic;">"Evaluated buffer"</span>)
  (eval-buffer))

(define-key emacs-lisp-mode-map (kbd <span style="font-style: italic;">"C-c C-c"</span>) #'my/elisp-mode-eval-buffer)
(define-key lisp-interaction-mode-map (kbd <span style="font-style: italic;">"C-c C-c"</span>) #'my/elisp-mode-eval-buffer)
</pre>
</div>
</div>
</li>

<li><a id="orgadf002a"></a>lisp-mode<br />
<div class="outline-text-6" id="text-orgadf002a">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package lisp-mode
  <span style="font-weight: bold;">:mode</span> <span style="font-style: italic;">"\\.lisp$"</span>
  <span style="font-weight: bold;">:config</span>
  (my/add-dash-docsets-hook 'lisp-mode-hook
                            '(<span style="font-style: italic;">"Common Lisp"</span>)))
</pre>
</div>
</div>

<ul class="org-ul">
<li><a id="orgb750280"></a>sly<br />
<div class="outline-text-7" id="text-orgb750280">
<p>
<a href="https://github.com/joaotavora/sly#start-of-content">Sly</a>, a fork of <a href="https://slime.common-lisp.dev/">Slime</a>.
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-sly"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package sly
  <span style="font-weight: bold;">:custom</span>
  (inferior-lisp-program <span style="font-style: italic;">"&lt;&lt;which(filename="</span>sbcl<span style="font-style: italic;">")&gt;&gt;"</span>)
  (sly-auto-start 'ask)
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">with-eval-after-load</span> 'ob-lisp
    (setopt org-babel-lisp-eval-fn 'sly-eval)))
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="org39ec5ad"></a>scheme-mode<br />
<div class="outline-text-6" id="text-org39ec5ad">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"tree-sitter-scheme"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package scheme
  <span style="font-weight: bold;">:mode</span> ((<span style="font-style: italic;">"\\.guix-channel"</span> . scheme-mode)
         (<span style="font-style: italic;">"\\.guix-authorizations"</span> . scheme-mode)))
</pre>
</div>
</div>
</li>

<li><a id="org32431b0"></a>c-mode<br />
<div class="outline-text-6" id="text-org32431b0">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"tree-sitter-c"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package cc-mode
  <span style="font-weight: bold;">:defer</span> 10
  <span style="font-weight: bold;">:custom</span>
  (c-tab-always-indent t)
  (c-auto-align-backslashes nil)
  (c-echo-syntactic-information-p t)
  (c-default-style <span style="font-style: italic;">"my/c-style"</span>)
  <span style="font-weight: bold;">:config</span>
  (my/add-dash-docsets-hook 'c-mode-common-hook
                            '(<span style="font-style: italic;">"C"</span>))
  (c-toggle-auto-newline 1)
  (c-add-style <span style="font-style: italic;">"my/c-style"</span>
               '((c-basic-offset . 4)
                 (c-comment-only-line-offset . 0)
                 (c-hanging-braces-alist
                  . ((brace-if-brace before after)
                     (substatement-open before after)))
                 (c-hanging-colons-alist
                  . ((case-label after)))
                 (c-cleanup-list
                  . (brace-else-brace
                     brace-elseif-brace
                     empty-defun-braces
                     defun-close-semi
                     list-close-comma
                     scope-operator))
                 (c-offsets-alist
                  . ((arglist-intro . +)
                     (arglist-cont-nonempty . c-lineup-arglist)))))
  (c-add-style <span style="font-style: italic;">"my/objc-style"</span>
               '((c-basic-offset . 2)
                 (c-comment-only-line-offset . 0)
                 (c-hanging-braces-alist
                  . ((brace-if-brace before after)
                     (substatement-open before after)))
                 (c-hanging-colons-alist
                  . ((case-label after)))
                 (c-cleanup-list
                  . (brace-else-brace
                     brace-elseif-brace
                     empty-defun-braces
                     defun-close-semi
                     list-close-comma
                     scope-operator))
                 (c-offsets-alist
                  . ((arglist-intro . +)
                     (arglist-cont-nonempty . c-lineup-arglist))))))
</pre>
</div>
</div>
</li>

<li><a id="org5442f80"></a>rustic<br />
<div class="outline-text-6" id="text-org5442f80">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-rustic"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package rustic
  <span style="font-weight: bold;">:mode</span> (<span style="font-style: italic;">"\\.rs$"</span> . rustic-mode)
  <span style="font-weight: bold;">:custom</span>
  (rustic-lsp-client <span style="font-style: italic;">"eglot"</span>)
  <span style="font-weight: bold;">:config</span>
  (my/add-dash-docsets-hook 'rustic-mode-hook
                            '(<span style="font-style: italic;">"Rust"</span>)))
</pre>
</div>
</div>
</li>

<li><a id="org4913147"></a>python-mode<br />
<div class="outline-text-6" id="text-org4913147">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"tree-sitter-python"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(python-mode . python-ts-mode)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(python-ts-mode . combobulate-mode)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package python
  <span style="font-weight: bold;">:mode</span> <span style="font-style: italic;">"\\.py\\'"</span>
  <span style="font-weight: bold;">:interpreter</span> <span style="font-style: italic;">"python"</span>
  <span style="font-weight: bold;">:hook</span>
  ((python-mode inferior-python-mode) .
   (<span style="font-weight: bold;">lambda</span> ()
     (<span style="font-weight: bold;">setq-local</span> flycheck-checker 'python-pylint)
     (<span style="font-weight: bold;">setq-local</span> devdocs-current-docs '(<span style="font-style: italic;">"python~3.9"</span>))))
  <span style="font-weight: bold;">:config</span>
  (my/add-dash-docsets-hook 'python-mode-hook
                            '(<span style="font-style: italic;">"Python 3"</span> <span style="font-style: italic;">"NumPy"</span> <span style="font-style: italic;">"Matplotlib"</span>))
  (my/add-dash-docsets-hook 'inferior-python-mode-hook
                            '(<span style="font-style: italic;">"Python 3"</span>)))

(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">python-mode-initialized</span> nil)

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-python-mode-hook</span> ()
  (<span style="font-weight: bold;">setq-local</span> flycheck-checker 'python-pylint)
  (jedi:setup)
  (jedi-mode 1)
  (<span style="font-weight: bold;">unless</span> python-mode-initialized
    (<span style="font-weight: bold;">setq</span> python-mode-initialized t)
    (info-lookup-add-help
     <span style="font-weight: bold;">:mode</span> 'python-mode
     <span style="font-weight: bold;">:regexp</span> <span style="font-style: italic;">"[a-zA-Z_0-9.]+"</span>
     <span style="font-weight: bold;">:doc-spec</span>
     '((<span style="font-style: italic;">"(python)Python Module Index"</span> )
       (<span style="font-style: italic;">"(python)Index"</span>
        (<span style="font-weight: bold;">lambda</span>
          (item)
          (<span style="font-weight: bold;">cond</span>
           ((string-match
             <span style="font-style: italic;">"</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">[A-Za-z0-9_]+</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">() (in module </span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">[A-Za-z0-9_.]+</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">)"</span> item)
            (format <span style="font-style: italic;">"%s.%s"</span> (match-string 2 item)
                    (match-string 1 item))))))))))
</pre>
</div>
</div>

<ul class="org-ul">
<li><a id="orgc30f28e"></a>emacs-project<br />
<div class="outline-text-7" id="text-orgc30f28e">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-company-jedi"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package company-jedi
  <span style="font-weight: bold;">:after</span> python
  <span style="font-weight: bold;">:hook</span> (python-mode . my/python-mode-hook)
  <span style="font-weight: bold;">:custom</span>
  (jedi:tooltip-method nil)
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/python-mode-hook</span> ()
    (add-to-list 'company-backends 'company-jedi)))
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="orgea1997b"></a>ruby-mode<br />
<div class="outline-text-6" id="text-orgea1997b">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"tree-sitter-ruby"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(ruby-mode . ruby-ts-mode)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package ruby
  <span style="font-weight: bold;">:mode</span> ((<span style="font-style: italic;">"\\.rb$"</span>   . ruby-mode)
         (<span style="font-style: italic;">"Capfile$"</span> . ruby-mode)
         (<span style="font-style: italic;">"Gemfile$"</span> . ruby-mode))
  <span style="font-weight: bold;">:interpreter</span> ((<span style="font-style: italic;">"ruby"</span>    . ruby-mode)
                (<span style="font-style: italic;">"rbx"</span>     . ruby-mode)
                (<span style="font-style: italic;">"jruby"</span>   . ruby-mode))
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">setq</span> ruby-indent-level 2)
  (<span style="font-weight: bold;">setq</span> ruby-insert-encoding-magic-comment nil)
  (add-hook 'ruby-mode-hook
            '(lambda ()
               (<span style="font-weight: bold;">setq-local</span> flycheck-checker 'ruby-rubocop)
               (<span style="font-weight: bold;">setq-local</span> devdocs-current-docs '(<span style="font-style: italic;">"ruby~3.2"</span>))))
  (add-to-list 'hs-special-modes-alist
               `(ruby-mode
                 ,(<span style="font-weight: bold;">rx</span> (<span style="font-weight: bold;">or</span> <span style="font-style: italic;">"def"</span> <span style="font-style: italic;">"class"</span> <span style="font-style: italic;">"module"</span> <span style="font-style: italic;">"do"</span> <span style="font-style: italic;">"if"</span> <span style="font-style: italic;">"{"</span> <span style="font-style: italic;">"["</span>)) <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">Block start</span>
                 ,(<span style="font-weight: bold;">rx</span> (<span style="font-weight: bold;">or</span> <span style="font-style: italic;">"}"</span> <span style="font-style: italic;">"]"</span> <span style="font-style: italic;">"end"</span>))                       <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">Block end</span>
                 ,(<span style="font-weight: bold;">rx</span> (<span style="font-weight: bold;">or</span> <span style="font-style: italic;">"#"</span> <span style="font-style: italic;">"=begin"</span>))                        <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">Comment start</span>
                 ruby-forward-sexp nil))
  (my/add-dash-docsets-hook 'ruby-mode-hook '(<span style="font-style: italic;">"Ruby"</span>)))
</pre>
</div>
</div>

<ul class="org-ul">
<li><a id="orgab8d8f2"></a>inf-ruby<br />
<div class="outline-text-7" id="text-orgab8d8f2">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-inf-ruby"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package inf-ruby
  <span style="font-weight: bold;">:after</span> ruby
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">setq</span> inf-ruby-default-implementation <span style="font-style: italic;">"pry"</span>)
  (add-to-list 'inf-ruby-implementations '(<span style="font-style: italic;">"pry"</span> . <span style="font-style: italic;">"pry"</span>))
  (<span style="font-weight: bold;">setq</span> inf-ruby-eval-binding <span style="font-style: italic;">"Pry.toplevel_binding"</span>)
  (<span style="font-weight: bold;">setq</span> inf-ruby-first-prompt-pattern <span style="font-style: italic;">"^\\[[0-9]+\\] pry</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">(.*)</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">&gt; *"</span>)
  (<span style="font-weight: bold;">setq</span> inf-ruby-prompt-pattern <span style="font-style: italic;">"^\\[[0-9]+\\] pry</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">(.*)</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">[&gt;*\"'] *"</span>))
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="orgf5530c3"></a>lua-mode<br />
<div class="outline-text-6" id="text-orgf5530c3">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(add-to-list 'auto-mode-alist '(<span style="font-style: italic;">"\\.lua\\'"</span> . lua-mode))
</pre>
</div>
</div>
</li>

<li><a id="org0258210"></a>perl-mode<br />
<div class="outline-text-6" id="text-org0258210">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package perl-mode
  <span style="font-weight: bold;">:delight</span> <span style="font-style: italic;">" PL"</span>)
</pre>
</div>
</div>
</li>

<li><a id="org77babdc"></a>web-mode<br />
<div class="outline-text-6" id="text-org77babdc">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-web-mode"</span>
<span style="font-style: italic;">"tree-sitter-html"</span>
<span style="font-style: italic;">"tree-sitter-css"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package web-mode
  <span style="font-weight: bold;">:delight</span> <span style="font-style: italic;">" WB"</span>
  <span style="font-weight: bold;">:mode</span> ((<span style="font-style: italic;">"\\.phtml$"</span>     . web-mode)
         (<span style="font-style: italic;">"\\.tpl\\.php$"</span> . web-mode)
         (<span style="font-style: italic;">"\\.jsp$"</span>       . web-mode)
         (<span style="font-style: italic;">"\\.as[cp]x$"</span>   . web-mode)
         (<span style="font-style: italic;">"\\.erb$"</span>       . web-mode)
         (<span style="font-style: italic;">"\\.html?$"</span>     . web-mode))
  <span style="font-weight: bold;">:custom</span>
  (web-mode-attr-indent-offset        2)
  (web-mode-attr-value-indent-offset  2)
  (web-mode-code-indent-offset        2)
  (web-mode-css-offset                2)
  (web-mode-markup-indent-offset      2)
  (web-mode-sql-indent-offset         2)
  (web-mode-block-padding             2)
  (web-mode-script-padding            2)
  <span style="font-weight: bold;">:config</span>
  (my/add-dash-docsets-hook 'web-mode-hook '(<span style="font-style: italic;">"HTML"</span>)))
</pre>
</div>
</div>
</li>

<li><a id="org8c5987a"></a>css-mode<br />
<div class="outline-text-6" id="text-org8c5987a">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">with-eval-after-load</span> 'css-mode
  (setopt css-indent-offset 2)
  (my/add-dash-docsets-hook 'css-mode-hook '(<span style="font-style: italic;">"CSS"</span>)))
</pre>
</div>
</div>
</li>

<li><a id="orgf6fce0a"></a>js2-mode<br />
<div class="outline-text-6" id="text-orgf6fce0a">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-js2-mode"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(js2-mode . js-ts-mode)
(css-mode . css-ts-mode)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package js2-mode
  <span style="font-weight: bold;">:delight</span> <span style="font-style: italic;">" J2"</span>
  <span style="font-weight: bold;">:mode</span> ((<span style="font-style: italic;">"\\.js</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">on</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">?\\'"</span> . js2-mode)
         (<span style="font-style: italic;">"\\.eslintrc\\'"</span>    . js2-mode))
  <span style="font-weight: bold;">:hook</span> (js2-mode . (<span style="font-weight: bold;">lambda</span> ()
                      (<span style="font-weight: bold;">setq-local</span> flycheck-checker 'javascript-eslint)
                      (<span style="font-weight: bold;">setq-local</span> flycheck-disabled-checkers '(javascript-jshint javascript-jscs))))
  <span style="font-weight: bold;">:custom</span>
  (flycheck-javascript-eslint-executable <span style="font-style: italic;">"eslint"</span>)
  (my/add-dash-docsets-hook 'js2-mode-hook '(<span style="font-style: italic;">"JavaScript"</span>)))

(use-package js
  <span style="font-weight: bold;">:defer</span> 10
  <span style="font-weight: bold;">:delight</span> <span style="font-style: italic;">" JS"</span>
  <span style="font-weight: bold;">:custom</span>
  (js-indent-level 2))
</pre>
</div>
</div>
</li>

<li><a id="org0ced864"></a>make<br />
<div class="outline-text-6" id="text-org0ced864">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(cmake <span style="font-style: italic;">"https://github.com/uyha/tree-sitter-cmake"</span>)
(make <span style="font-style: italic;">"https://github.com/alemuller/tree-sitter-make"</span>)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(cmake-mode . cmake-ts-mode)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package cmake
  <span style="font-weight: bold;">:mode</span> ((<span style="font-style: italic;">"\\.mk$"</span> . cmake-mode)
         (<span style="font-style: italic;">"^Makefile$"</span> . cmake-mode)))
</pre>
</div>
</div>
</li>

<li><a id="org1df46e3"></a>sql-mode<br />
<div class="outline-text-6" id="text-org1df46e3">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package sql
  <span style="font-weight: bold;">:delight</span> <span style="font-style: italic;">" SQ"</span>
  <span style="font-weight: bold;">:commands</span> (sql-mode)
  <span style="font-weight: bold;">:mode</span> ((<span style="font-style: italic;">"\\.sql$"</span> . sql-mode))
  <span style="font-weight: bold;">:bind</span> (<span style="font-weight: bold;">:map</span> sql-interactive-mode-map
              (<span style="font-style: italic;">"C-j"</span> . comint-send-input))
  <span style="font-weight: bold;">:hook</span> (sql-mode . (<span style="font-weight: bold;">lambda</span> ()
                      (<span style="font-weight: bold;">setq-local</span> flycheck-checker 'sql-sqlint))))
</pre>
</div>
</div>
</li>

<li><a id="orgd7a84a4"></a>plantuml-mode<br />
<div class="outline-text-6" id="text-orgd7a84a4">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-plantuml-mode"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package plantuml
  <span style="font-weight: bold;">:mode</span> <span style="font-style: italic;">"\\.plu$"</span>
  <span style="font-weight: bold;">:custom</span>
  (plantuml-jar-path <span style="font-style: italic;">"~/.guix-extra-profiles/emacs/emacs/share/java/plantuml.jar"</span>)
  (plantuml-exec-mode 'jar)
  <span style="font-weight: bold;">:config</span>
  (my/add-dash-docsets-hook 'plantuml-mode-hook '(<span style="font-style: italic;">"PlantUML"</span>)))
</pre>
</div>
</div>
</li>

<li><a id="org91eb387"></a>conf<br />
<div class="outline-text-6" id="text-org91eb387">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package conf-mode
  <span style="font-weight: bold;">:delight</span> <span style="font-style: italic;">" CF"</span>)
</pre>
</div>
</div>
</li>

<li><a id="org574c1f4"></a>generic-x<br />
<div class="outline-text-6" id="text-org574c1f4">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package generic-x
  <span style="font-weight: bold;">:mode</span> ((<span style="font-style: italic;">"\\.conf$"</span>     . apache-conf-generic-mode)
         (<span style="font-style: italic;">"\\.htaccess$"</span> . apache-conf-generic-mode)))
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="orgc8138e6"></a>special-mode derivatives<br />
<div class="outline-text-5" id="text-orgc8138e6">
</div>

<ul class="org-ul">
<li><a id="org28b4f3f"></a>special mode<br />
<div class="outline-text-6" id="text-org28b4f3f">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(define-key special-mode-map (kbd <span style="font-style: italic;">"C-j"</span>) #'push-button)
</pre>
</div>
</div>
</li>

<li><a id="org38980a4"></a>help<br />
<div class="outline-text-6" id="text-org38980a4">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">with-eval-after-load</span> 'help
  (keymap-set help-map <span style="font-style: italic;">"C-?"</span> #'help-for-help)
  (keymap-set help-map <span style="font-style: italic;">"c"</span> #'describe-face)
  (keymap-set help-map <span style="font-style: italic;">"K"</span> #'describe-keymap))
</pre>
</div>
</div>
</li>

<li><a id="org2f2d104"></a>woman<br />
<div class="outline-text-6" id="text-org2f2d104">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(autoload #'woman <span style="font-style: italic;">"woman"</span> nil t)
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="org71cc2cb"></a>Programming<br />
<ul class="org-ul">
<li><a id="org5dd72d1"></a>sMerge<br />
<div class="outline-text-6" id="text-org5dd72d1">
<p>
sMerge can be used to solve merging problems. The code below kicks off sMerge if there is a collision sign.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(autoload 'smerge-mode <span style="font-style: italic;">"smerge-mode"</span> nil t)

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/try-smerge</span> ()
  (<span style="font-weight: bold;">save-excursion</span>
    (goto-char (point-min))
    (<span style="font-weight: bold;">when</span> (re-search-forward <span style="font-style: italic;">"^&lt;&lt;&lt;&lt;&lt;&lt;&lt; "</span> nil t)
      (smerge-mode 1))))
(add-hook 'find-file-hook 'my/try-smerge t)
</pre>
</div>
</div>
</li>

<li><a id="orgef412d4"></a>Next Error<br />
<div class="outline-text-6" id="text-orgef412d4">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(setopt next-error-message-highlight t)
</pre>
</div>
</div>
</li>

<li><a id="org81ba212"></a>Hideshow<br />
<div class="outline-text-6" id="text-org81ba212">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package hideshow
  <span style="font-weight: bold;">:diminish</span> <span style="font-style: italic;">"hs"</span>
  <span style="font-weight: bold;">:bind</span> ((<span style="font-style: italic;">"C-c TAB"</span> . hs-toggle-hiding)))
</pre>
</div>
</div>
</li>

<li><a id="orga0d127f"></a>imenu<br />
<div class="outline-text-6" id="text-orga0d127f">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package imenu
  <span style="font-weight: bold;">:custom</span>
  (imenu-auto-rescan t))
</pre>
</div>
</div>
</li>
<li><a id="org20fc255"></a>compile<br />
<div class="outline-text-6" id="text-org20fc255">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package compile
  <span style="font-weight: bold;">:bind</span> (<span style="font-weight: bold;">:map</span> compilation-mode-map
              (<span style="font-style: italic;">"C-j"</span> . compile-goto-error)))
</pre>
</div>
</div>
</li>

<li><a id="org7e5149e"></a>grep<br />
<div class="outline-text-6" id="text-org7e5149e">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package grep
  <span style="font-weight: bold;">:custom</span>
  (grep-program <span style="font-style: italic;">"rg"</span>)
  <span style="font-weight: bold;">:config</span>
  (bind-keys <span style="font-weight: bold;">:map</span> grep-mode-map
             (<span style="font-style: italic;">"C-j"</span> . compile-goto-error)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/grep-ripgrep-all</span> ()
  <span style="font-style: italic;">"Grep many kind of files like pdf, epub and more."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">let</span> ((grep-find-command '(<span style="font-style: italic;">"rga --with-filename --no-heading --line-number --color never -e '' ./* ./**/*"</span> . 66)))
    (call-interactively 'grep-find)))

(global-set-key (kbd <span style="font-style: italic;">"M-s R"</span>) 'my/grep-ripgrep-all)
</pre>
</div>
</div>
</li>

<li><a id="org4622f6b"></a>executable<br />
<div class="outline-text-6" id="text-org4622f6b">
<p>
<a href="https://emacsredux.com/blog/2021/09/29/make-script-files-executable-automatically/">The post</a> says it is useful to set executable bit if the saved file seems to be script.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">with-eval-after-load</span> 'executable
  (add-hook 'after-save-hook
            'executable-make-buffer-file-executable-if-script-p))
</pre>
</div>
</div>
</li>

<li><a id="org7672a72"></a>Paren Showing<br />
<div class="outline-text-6" id="text-org7672a72">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package paren
  <span style="font-weight: bold;">:hook</span> (prog-mode . show-paren-local-mode)
  <span style="font-weight: bold;">:custom</span>
  (show-paren-style 'mixed)
  (show-paren-delay 0.2)
  (show-paren-mode nil)
  (show-paren-context-when-offscreen t))
</pre>
</div>
</div>
</li>

<li><a id="org007a454"></a>project<br />
<div class="outline-text-6" id="text-org007a454">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package project
  <span style="font-weight: bold;">:custom</span>
  (project-kill-buffers-display-buffer-list t)
  <span style="font-weight: bold;">:config</span>
  (add-to-list 'project-switch-commands
               '(project-dired <span style="font-style: italic;">"Dired root"</span>))
  (<span style="font-weight: bold;">with-eval-after-load</span> 'magit
    (bind-keys <span style="font-weight: bold;">:map</span> project-prefix-map
               (<span style="font-style: italic;">"M"</span> . magit-project-status))
    (add-to-list 'project-switch-commands
                 '(magit-project-status <span style="font-style: italic;">"Magit"</span>))))
</pre>
</div>
</div>
</li>

<li><a id="org728ef77"></a>log-view<br />
<div class="outline-text-6" id="text-org728ef77">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package log-view
  <span style="font-weight: bold;">:delight</span>
  (log-view-mode <span style="font-style: italic;">" LV"</span>)
  <span style="font-weight: bold;">:mode</span> (<span style="font-style: italic;">"\\.log$"</span> . log-view-mode)
  <span style="font-weight: bold;">:hook</span> ((log-view-mode . my/prog-mode-hook-function )
         (log-view-mode . auto-revert-tail-mode)))
</pre>
</div>
</div>
</li>

<li><a id="org472abab"></a>vc (version control)<br />
<div class="outline-text-6" id="text-org472abab">
</div>
</li>
<li><a id="orgd5e5b88"></a>vc-hooks<br />
<div class="outline-text-6" id="text-orgd5e5b88">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package vc-hooks
  <span style="font-weight: bold;">:custom</span>
  (vc-follow-symlinks t))
</pre>
</div>
</div>
</li>
</ul>
</li>
<li><a id="org0e748fb"></a>Tree Sitter<br />
<div class="outline-text-5" id="text-org0e748fb">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"tree-sitter"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package treesit
  <span style="font-weight: bold;">:preface</span>
  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/setup-install-grammars</span> ()
    <span style="font-style: italic;">"Install Tree-sitter grammars if they are absent."</span>
    (<span style="font-weight: bold;">interactive</span>)
    (<span style="font-weight: bold;">dolist</span> (grammar
             '(&lt;&lt;treesit-language-source&gt;&gt;))
      (add-to-list 'treesit-language-source-alist grammar)
      (<span style="font-weight: bold;">unless</span> (treesit-language-available-p (car grammar))
        (treesit-install-language-grammar (car grammar)))))
  <span style="font-weight: bold;">:config</span>
  (my/setup-install-grammars))
</pre>
</div>
</div>

<ul class="org-ul">
<li><a id="org5d1ed73"></a>combobulate<br />
<div class="outline-text-6" id="text-org5d1ed73">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package combobulate
  <span style="font-weight: bold;">:disabled</span> t
  <span style="font-weight: bold;">:after</span> treesit
  <span style="font-weight: bold;">:preface</span>
  (<span style="font-weight: bold;">setq</span> combobulate-key-prefix <span style="font-style: italic;">"C-c o"</span>)
  <span style="font-weight: bold;">:hook</span> (&lt;&lt;combobulate-hook&gt;&gt;)
  <span style="font-weight: bold;">:load-path</span> (<span style="font-style: italic;">"~/.emacs.d/site-elisp/combobulate/"</span>))
</pre>
</div>
</div>
</li>

<li><a id="org0bb4acf"></a>major mode remapping<br />
<div class="outline-text-6" id="text-org0bb4acf">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">setq</span> major-mode-remap-alist
      '(&lt;&lt;major-mode-remap-rule&gt;&gt;))
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="org247cf20"></a>Elisp Package Development<br />
<div class="outline-text-5" id="text-org247cf20">
</div>

<ul class="org-ul">
<li><a id="org108c8b3"></a>Eldev<br />
<div class="outline-text-6" id="text-org108c8b3">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-eldev"</span>
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="org7f32164"></a>Blogging<br />
<div class="outline-text-5" id="text-org7f32164">
<p>
This subtree holds resources for <a href="https://p-snow.org/">my blog</a>.
</p>
</div>

<ul class="org-ul">
<li><a id="orgbe8e291"></a>org-static-blog<br />
<div class="outline-text-6" id="text-orgbe8e291">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-org-static-blog"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package org-static-blog
  <span style="font-weight: bold;">:defer</span> t
  <span style="font-weight: bold;">:after</span> org
  <span style="font-weight: bold;">:init</span>
  (<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my/blog-directory</span> (expand-file-name <span style="font-style: italic;">"~/org/dotlife"</span>))
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">setq</span> org-static-blog-publish-directory
        (file-name-concat my/blog-directory <span style="font-style: italic;">"public"</span>)
        org-static-blog-posts-directory
        (file-name-concat my/blog-directory <span style="font-style: italic;">"content/posts"</span>)
        org-static-blog-drafts-directory
        (file-name-concat my/blog-directory <span style="font-style: italic;">"content/posts"</span>)))
</pre>
</div>
</div>
</li>

<li><a id="org54841a0"></a>templates for blogging<br />
<div class="outline-text-6" id="text-org54841a0">
<div class="org-src-container">
<pre class="src src-emacs-lisp" id="org577ac3b">(blog-post-filename (format-time-string <span style="font-style: italic;">"%Y%m%d-%H%M.org"</span>))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp" id="orgeec2b96">(blog-post-skeleton <span style="font-style: italic;">"#+title:"</span> n
                    <span style="font-style: italic;">"#+date:"</span> n
                    <span style="font-style: italic;">"#+description:"</span> n
                    <span style="font-style: italic;">"#+filetags:"</span> n n
                    <span style="font-style: italic;">"#+SETUPFILE: content/header"</span>)
(blog-post-macro-preview <span style="font-style: italic;">"{{{preview-begin}}}"</span> n
                         <span style="font-style: italic;">"{{{preview-end}}}"</span>)
(blog-post-macro-accordion (p <span style="font-style: italic;">"Summary: "</span> summary t)
                           (format <span style="font-style: italic;">"{{{accordion-begin(%s)}}}"</span> summary) n
                           <span style="font-style: italic;">"{{{accordion-end}}}"</span>)
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="org46ca9c6"></a>Journaling<br />
<div class="outline-text-5" id="text-org46ca9c6">
</div>

<ul class="org-ul">
<li><a id="orgd58a20c"></a>journal entry template<br />
<div class="outline-text-6" id="text-orgd58a20c">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(journal <span style="font-style: italic;">"- diary"</span> n&gt;
         <span style="font-style: italic;">"#+begin_src text"</span> n&gt; <span style="font-style: italic;">"#+end_src"</span> n
         <span style="font-style: italic;">"- clocktable"</span> n&gt;
         <span style="font-style: italic;">"#+begin: clocktable-by-tag :maxlevel 3 :wstart 1 "</span>
         <span style="font-style: italic;">":block "</span> (p <span style="font-style: italic;">"year"</span>) <span style="font-style: italic;">"-"</span> (p <span style="font-style: italic;">"month"</span>) <span style="font-style: italic;">"-"</span> (p <span style="font-style: italic;">"day"</span>) n&gt;
         <span style="font-style: italic;">"#+end:"</span> n
         <span style="font-style: italic;">"- agenda"</span> n&gt;
         <span style="font-style: italic;">"#+begin_example"</span> n
         (p <span style="font-style: italic;">"agenda"</span>) n&gt;
         <span style="font-style: italic;">"#+end_example"</span>)
</pre>
</div>
</div>
</li>

<li><a id="org5c7e6ce"></a>week subtree template<br />
<div class="outline-text-6" id="text-org5c7e6ce">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(nw &amp; <span style="font-style: italic;">"- mission [/]"</span> n
    <span style="font-style: italic;">"- clocktable"</span> n&gt;
    <span style="font-style: italic;">"#+begin: clocktable-by-tag :maxlevel 3 "</span>
    <span style="font-style: italic;">":block "</span> (p <span style="font-style: italic;">"year"</span>) <span style="font-style: italic;">"-W"</span> (p <span style="font-style: italic;">"isoweek"</span>) <span style="font-style: italic;">" :wstart 1"</span> n&gt;
    <span style="font-style: italic;">"#+end:"</span> n
    <span style="font-style: italic;">"- meta-projects"</span> n&gt;
    <span style="font-style: italic;">"#+begin: clocktable :maxlevel 3 :scope agenda "</span>
    <span style="font-style: italic;">":block "</span> (p <span style="font-style: italic;">"year"</span>) <span style="font-style: italic;">"-W"</span> (p <span style="font-style: italic;">"isoweek"</span>)
    <span style="font-style: italic;">" :wstart 1 :narrow 40! :tcolumns 3 :formula %"</span> n&gt;
    <span style="font-style: italic;">"#+end:"</span>)
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="org66970cf"></a>sundry 3rd-party packages<br />
<div class="outline-text-5" id="text-org66970cf">
<p>
Packages below are out of categories above. Packages which have ARCHIVE tag is no longer in use. Keywords which package gives in its description are set to tag.
</p>
</div>

<ul class="org-ul">
<li><a id="orgaf6918b"></a>git-modes<br />
<div class="outline-text-6" id="text-orgaf6918b">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-git-modes"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package git-modes)
</pre>
</div>
</div>
</li>

<li><a id="org8901f4c"></a>git-annex<br />
<div class="outline-text-6" id="text-org8901f4c">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-git-annex"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-style: italic;">"https://github.com/jwiegley/git-annex-el/releases.atom"</span> soft_update)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package git-annex
  <span style="font-weight: bold;">:after</span> dired
  <span style="font-weight: bold;">:custom-face</span>
  (git-annex-dired-annexed-available ((t (<span style="font-weight: bold;">:foreground</span> <span style="font-style: italic;">"green yellow"</span>))))
  (git-annex-dired-annexed-unavailable ((t (<span style="font-weight: bold;">:foreground</span> <span style="font-style: italic;">"red3"</span>)))))
</pre>
</div>
</div>
</li>

<li><a id="orgbdf168b"></a>magit-annex&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span><br /></li>

<li><a id="org59ad170"></a>orgit<br />
<div class="outline-text-6" id="text-org59ad170">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-orgit"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package orgit
  <span style="font-weight: bold;">:after</span> my/org-mode-init
  <span style="font-weight: bold;">:custom</span>
  (orgit-remote <span style="font-style: italic;">"github"</span>))
</pre>
</div>
</div>
</li>

<li><a id="org4767848"></a>suggest<br />
<div class="outline-text-6" id="text-org4767848">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-suggest"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package suggest
  <span style="font-weight: bold;">:commands</span> suggest
  <span style="font-weight: bold;">:custom</span>
  (suggest-insert-example-on-start nil))
</pre>
</div>
</div>
</li>

<li><a id="org91069cc"></a>mastodon<br />
<div class="outline-text-6" id="text-org91069cc">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-mastodon"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package mastodon
  <span style="font-weight: bold;">:after</span> my-launch-app
  <span style="font-weight: bold;">:bind</span> (<span style="font-weight: bold;">:map</span> my/launch-app-map
              (<span style="font-style: italic;">"@"</span> . mastodon))
  <span style="font-weight: bold;">:hook</span> (mastodon-mode . visual-line-mode)
  <span style="font-weight: bold;">:custom</span>
  (mastodon-active-user <span style="font-style: italic;">"p_snow"</span>)
  (mastodon-instance-url <span style="font-style: italic;">"https://emacs.ch"</span>)
  (mastodon-client--token-file
   (no-littering-expand-var-file-name <span style="font-style: italic;">"mastodon.plstore"</span>))
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">mastodon-views</span>))
</pre>
</div>
</div>
</li>

<li><a id="org02ea905"></a>bookmark+&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span><br /></li>

<li><a id="org82b4b5d"></a>chatgpt-shell<br />
<div class="outline-text-6" id="text-org82b4b5d">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-chatgpt-shell"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package chatgpt-shell
  <span style="font-weight: bold;">:after</span> engine-mode
  <span style="font-weight: bold;">:defer</span> 7
  <span style="font-weight: bold;">:preface</span>
  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/chatgpt-shell-dwim</span> ()
    <span style="font-style: italic;">"docstring"</span>
    (<span style="font-weight: bold;">interactive</span>)
    (<span style="font-weight: bold;">if</span> (use-region-p)
        (chatgpt-shell-prompt-compose)
      (chatgpt-shell)))
  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/openai-key</span> ()
    <span style="font-style: italic;">"Return my openai key."</span>
    (<span style="font-weight: bold;">or</span> (cdr (assoc <span style="font-style: italic;">"API key"</span> (auth-source-pass-parse-entry <span style="font-style: italic;">"openai.com"</span>)))
        (<span style="font-weight: bold;">let</span> ((sec (plist-get (car (auth-source-search <span style="font-weight: bold;">:host</span> <span style="font-style: italic;">"openai.com"</span>)) <span style="font-weight: bold;">:secret</span>)))
          (<span style="font-weight: bold;">if</span> (functionp sec)
              (funcall sec) sec))))
  <span style="font-weight: bold;">:bind</span> (<span style="font-weight: bold;">:map</span> engine-mode-prefixed-map
              (<span style="font-style: italic;">"c c"</span> . my/chatgpt-shell-dwim)
              (<span style="font-style: italic;">"c C"</span> . chatgpt-shell-prompt)
              (<span style="font-style: italic;">"c e"</span> . chatgpt-shell-explain-code)
              (<span style="font-style: italic;">"c d"</span> . chatgpt-shell-describe-code)
              (<span style="font-style: italic;">"c p"</span> . chatgpt-shell-proofread-region)
              (<span style="font-style: italic;">"c g"</span> . chatgpt-shell-write-git-commit)
              (<span style="font-style: italic;">"c u"</span> . chatgpt-shell-generate-unit-test)
              (<span style="font-style: italic;">"c i"</span> . (<span style="font-weight: bold;">lambda</span> (<span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> lang)
                         <span style="font-style: italic;">"Ask ChatGPT to interpret into Japanese or some other language if LANG is non-nil."</span>
                         (<span style="font-weight: bold;">interactive</span> <span style="font-style: italic;">"P"</span>)
                         (chatgpt-shell-send-region-with-header
                          (format <span style="font-style: italic;">"Please help me interpret the following sentence into %s:"</span>
                                  (<span style="font-weight: bold;">if</span> (equal lang '(4))
                                      (completing-read <span style="font-style: italic;">"Langauage: "</span> '(<span style="font-style: italic;">"Japanese"</span> <span style="font-style: italic;">"English"</span> <span style="font-style: italic;">"German"</span>))
                                    <span style="font-style: italic;">"Japanese"</span>)))))
              <span style="font-weight: bold;">:map</span> chatgpt-shell-mode-map
              (<span style="font-style: italic;">"C-M-g"</span> . chatgpt-shell-clear-buffer))
  <span style="font-weight: bold;">:custom</span>
  (chatgpt-shell-openai-key 'my/openai-key)
  (chatgpt-shell-system-prompt 3)
  (chatgpt-shell-model-temperature 0.6))

(use-package ob-chatgpt-shell
  <span style="font-weight: bold;">:after</span> (chatgpt-shell ob-core)
  <span style="font-weight: bold;">:config</span>
  (ob-chatgpt-shell-setup)
  (add-to-list 'org-structure-template-alist
               '(<span style="font-style: italic;">"ch"</span> . <span style="font-style: italic;">"src chatgpt-shell"</span>)
               t))

(use-package dall-e-shell
  <span style="font-weight: bold;">:commands</span> dall-e-shell
  <span style="font-weight: bold;">:custom</span>
  (dall-e-shell-openai-key 'my/openai-key))
</pre>
</div>
</div>
</li>

<li><a id="org1b65c63"></a>async<br />
<div class="outline-text-6" id="text-org1b65c63">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-async"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package dired-async
  <span style="font-weight: bold;">:after</span> dired
  <span style="font-weight: bold;">:config</span>
  (dired-async-mode 1))

(use-package async-bytecomp
  <span style="font-weight: bold;">:custom</span>
  (async-bytecomp-package-mode t))
</pre>
</div>
</div>
</li>

<li><a id="orgaef51f6"></a>visible-mark&#xa0;&#xa0;&#xa0;<span class="tag"><span class="marking">marking</span>&#xa0;<span class="faces">faces</span>&#xa0;<span class="color">color</span></span><br />
<div class="outline-text-6" id="text-orgaef51f6">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package visible-mark
  <span style="font-weight: bold;">:ensure</span> t
  <span style="font-weight: bold;">:config</span>
  (global-visible-mark-mode 1))
</pre>
</div>
</div>
</li>

<li><a id="orgea8dc6f"></a>ement&#xa0;&#xa0;&#xa0;<span class="tag"><span class="comm">comm</span></span><br />
<div class="outline-text-6" id="text-orgea8dc6f">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-ement"</span>
</pre>
</div>
</div>
</li>

<li><a id="org056cac8"></a>ligature&#xa0;&#xa0;&#xa0;<span class="tag"><span class="extensions">extensions</span>&#xa0;<span class="data">data</span></span><br />
<div class="outline-text-6" id="text-org056cac8">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-ligature"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package ligature
  <span style="font-weight: bold;">:hook</span> (prog-mode . ligature-mode)
  <span style="font-weight: bold;">:config</span>
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">ligatures below are supported by `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">Iosevka</span><span style="font-weight: bold; font-style: italic;">' font</span>
  (ligature-set-ligatures 'prog-mode
                          '(<span style="font-style: italic;">"-&lt;&lt;"</span> <span style="font-style: italic;">"-&lt;"</span> <span style="font-style: italic;">"-&lt;-"</span> <span style="font-style: italic;">"&lt;--"</span> <span style="font-style: italic;">"&lt;---"</span> <span style="font-style: italic;">"&lt;&lt;-"</span> <span style="font-style: italic;">"&lt;-"</span> <span style="font-style: italic;">"-&gt;"</span> <span style="font-style: italic;">"-&gt;&gt;"</span> <span style="font-style: italic;">"--&gt;"</span> <span style="font-style: italic;">"---&gt;"</span> <span style="font-style: italic;">"-&gt;-"</span> <span style="font-style: italic;">"&gt;-"</span> <span style="font-style: italic;">"&gt;&gt;-"</span>
                            <span style="font-style: italic;">"=&lt;&lt;"</span> <span style="font-style: italic;">"=&lt;"</span> <span style="font-style: italic;">"=&lt;="</span> <span style="font-style: italic;">"&lt;=="</span> <span style="font-style: italic;">"&lt;==="</span> <span style="font-style: italic;">"&lt;&lt;="</span> <span style="font-style: italic;">"&lt;="</span> <span style="font-style: italic;">"=&gt;"</span> <span style="font-style: italic;">"=&gt;&gt;"</span> <span style="font-style: italic;">"==&gt;"</span> <span style="font-style: italic;">"===&gt;"</span> <span style="font-style: italic;">"=&gt;="</span> <span style="font-style: italic;">"&gt;="</span> <span style="font-style: italic;">"&gt;&gt;="</span>
                            <span style="font-style: italic;">"&lt;-&gt;"</span> <span style="font-style: italic;">"&lt;--&gt;"</span> <span style="font-style: italic;">"&lt;---&gt;"</span> <span style="font-style: italic;">"&lt;----&gt;"</span> <span style="font-style: italic;">"&lt;=&gt;"</span> <span style="font-style: italic;">"&lt;==&gt;"</span> <span style="font-style: italic;">"&lt;===&gt;"</span> <span style="font-style: italic;">"&lt;====&gt;"</span> <span style="font-style: italic;">"::"</span> <span style="font-style: italic;">":::"</span> <span style="font-style: italic;">"__"</span>
                            <span style="font-style: italic;">"&lt;~~"</span> <span style="font-style: italic;">"&lt;/"</span> <span style="font-style: italic;">"&lt;/&gt;"</span> <span style="font-style: italic;">"/&gt;"</span> <span style="font-style: italic;">"~~&gt;"</span> <span style="font-style: italic;">"=="</span> <span style="font-style: italic;">"!="</span> <span style="font-style: italic;">"/="</span> <span style="font-style: italic;">"~="</span> <span style="font-style: italic;">"&lt;&gt;"</span> <span style="font-style: italic;">"==="</span> <span style="font-style: italic;">"!=="</span> <span style="font-style: italic;">"!==="</span> <span style="font-style: italic;">"=/="</span> <span style="font-style: italic;">"=!="</span>
                            <span style="font-style: italic;">"&lt;:"</span> <span style="font-style: italic;">":="</span> <span style="font-style: italic;">"*="</span> <span style="font-style: italic;">"*+"</span> <span style="font-style: italic;">"&lt;*"</span> <span style="font-style: italic;">"&lt;*&gt;"</span> <span style="font-style: italic;">"*&gt;"</span> <span style="font-style: italic;">"&lt;|"</span> <span style="font-style: italic;">"&lt;|&gt;"</span> <span style="font-style: italic;">"|&gt;"</span> <span style="font-style: italic;">"&lt;."</span> <span style="font-style: italic;">"&lt;.&gt;"</span> <span style="font-style: italic;">".&gt;"</span> <span style="font-style: italic;">"+*"</span> <span style="font-style: italic;">"=*"</span> <span style="font-style: italic;">"=:"</span> <span style="font-style: italic;">":&gt;"</span>
                            <span style="font-style: italic;">"(*"</span> <span style="font-style: italic;">"*)"</span> <span style="font-style: italic;">"/*"</span> <span style="font-style: italic;">"*/"</span> <span style="font-style: italic;">"[|"</span> <span style="font-style: italic;">"|]"</span> <span style="font-style: italic;">"{|"</span> <span style="font-style: italic;">"|}"</span> <span style="font-style: italic;">"++"</span> <span style="font-style: italic;">"+++"</span> <span style="font-style: italic;">"\\/"</span> <span style="font-style: italic;">"/\\"</span> <span style="font-style: italic;">"|-"</span> <span style="font-style: italic;">"-|"</span> <span style="font-style: italic;">"&lt;!--"</span> <span style="font-style: italic;">"&lt;!---"</span>)))
</pre>
</div>
</div>
</li>

<li><a id="org355cce0"></a>meow&#xa0;&#xa0;&#xa0;<span class="tag"><span class="modal_editing">modal_editing</span>&#xa0;<span class="convenience">convenience</span>&#xa0;<span class="ARCHIVE">ARCHIVE</span></span><br /></li>

<li><a id="orgcef3160"></a>enlive&#xa0;&#xa0;&#xa0;<span class="tag"><span class="selector">selector</span>&#xa0;<span class="query">query</span>&#xa0;<span class="css">css</span></span><br />
<div class="outline-text-6" id="text-orgcef3160">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-enlive"</span>
</pre>
</div>
</div>
</li>

<li><a id="orgbb0a785"></a>gptel&#xa0;&#xa0;&#xa0;<span class="tag"><span class="convenience">convenience</span></span><br />
<div class="outline-text-6" id="text-orgbb0a785">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-gptel"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package gptel
  <span style="font-weight: bold;">:after</span> engine-mode
  <span style="font-weight: bold;">:bind</span> (<span style="font-weight: bold;">:map</span> engine-mode-prefixed-map
              (<span style="font-style: italic;">"C"</span> . gptel))
  <span style="font-weight: bold;">:custom</span>
  (gptel-api-key <span style="font-style: italic;">"&lt;&lt;openai-api-key()&gt;&gt;"</span>)
  (gptel-max-tokens 500)
  (gptel-model <span style="font-style: italic;">"gpt-3.5-turbo"</span>)
  (gptel-default-mode 'org-mode))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp" id="orgee9eb5f">(auth-source-pass-get <span style="font-style: italic;">"API key"</span> <span style="font-style: italic;">"openai.com"</span>)
</pre>
</div>
</div>
</li>

<li><a id="org9d78762"></a>engine-mode<br />
<div class="outline-text-6" id="text-org9d78762">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-engine-mode"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp" id="org75ad099">(use-package engine-mode
  <span style="font-weight: bold;">:preface</span>
  (<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">engine/minibuffer-history</span> nil
    <span style="font-style: italic;">"Minibuffer history for `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">engine-mode</span><span style="font-style: italic;">'."</span>)
  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">engine--history-search-term</span> (engine-name)
    <span style="font-style: italic;">"Prompt the user for a search term for ENGINE-NAME.</span>
<span style="font-style: italic;">Default to the symbol at point."</span>
    (<span style="font-weight: bold;">let</span> ((current-word (<span style="font-weight: bold;">or</span> (thing-at-point 'symbol 'no-properties) <span style="font-style: italic;">""</span>)))
      (read-string (engine--search-prompt engine-name current-word)
                   nil 'engine/minibuffer-history current-word)))
  <span style="font-weight: bold;">:config</span>
  (advice-add 'engine--prompted-search-term <span style="font-weight: bold;">:override</span>
              'engine--history-search-term)
  (engine/set-keymap-prefix (kbd <span style="font-style: italic;">"H-q"</span>))
  (engine-mode 1)
  (defengine google
    <span style="font-style: italic;">"https://www.google.com/search?ie=utf-8&amp;oe=utf-8&amp;q=%s"</span>
    <span style="font-weight: bold;">:keybinding</span> <span style="font-style: italic;">"g"</span>)
  (defengine google-images
    <span style="font-style: italic;">"https://www.google.com/images?hl=en&amp;source=hp&amp;biw=1440&amp;bih=795&amp;gbv=2&amp;aq=f&amp;aqi=&amp;aql=&amp;oq=&amp;q=%s"</span>
    <span style="font-weight: bold;">:keybinding</span> <span style="font-style: italic;">"i"</span>)
  (defengine duckduckgo
    <span style="font-style: italic;">"https://duckduckgo.com/?q=%s"</span>
    <span style="font-weight: bold;">:keybinding</span> <span style="font-style: italic;">"d"</span>)
  (defengine youtube
    <span style="font-style: italic;">"https://www.youtube.com/results?aq=f&amp;oq=&amp;search_query=%s"</span>
    <span style="font-weight: bold;">:keybinding</span> <span style="font-style: italic;">"y"</span>)
  (defengine github
    <span style="font-style: italic;">"https://github.com/search?ref=simplesearch&amp;q=%s"</span>
    <span style="font-weight: bold;">:keybinding</span> <span style="font-style: italic;">"h"</span>)
  (defengine amazon
    <span style="font-style: italic;">"https://www.amazon.co.jp/gp/search/?field-keywords=%s"</span>
    <span style="font-weight: bold;">:keybinding</span> <span style="font-style: italic;">"a"</span>)
  (defengine melpa
    <span style="font-style: italic;">"https://melpa.org/#/?q=%s"</span>
    <span style="font-weight: bold;">:keybinding</span> <span style="font-style: italic;">"m"</span>)
  (defengine eijiro
    <span style="font-style: italic;">"https://eow.alc.co.jp/search?q=%s"</span>
    <span style="font-weight: bold;">:keybinding</span> <span style="font-style: italic;">"e"</span>)
  (defengine weblio
    <span style="font-style: italic;">"https://www.weblio.jp/content/%s"</span>
    <span style="font-weight: bold;">:keybinding</span> <span style="font-style: italic;">"l"</span>)
  (defengine wikipedia-ja
    <span style="font-style: italic;">"https://ja.wikipedia.org/wiki/%s"</span>
    <span style="font-weight: bold;">:keybinding</span> <span style="font-style: italic;">"w"</span>)
  (defengine wikipedia
    <span style="font-style: italic;">"https://en.wikipedia.org/wiki/%s"</span>
    <span style="font-weight: bold;">:keybinding</span> <span style="font-style: italic;">"W"</span>))
</pre>
</div>
</div>
</li>

<li><a id="orgf60e3fb"></a>tmr&#xa0;&#xa0;&#xa0;<span class="tag"><span class="timer">timer</span>&#xa0;<span class="convenience">convenience</span></span><br />
<div class="outline-text-6" id="text-orgf60e3fb">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-tmr"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package tmr
  <span style="font-weight: bold;">:after</span> my-launch-app
  <span style="font-weight: bold;">:bind</span> ((<span style="font-style: italic;">"C-x M-t t"</span>   . tmr)
         (<span style="font-style: italic;">"C-x M-t M-t"</span> . tmr)
         (<span style="font-style: italic;">"C-x M-t x"</span>   . tmr-cancel)
         (<span style="font-style: italic;">"C-x M-t k"</span>   . tmr-remove)
         (<span style="font-style: italic;">"C-x M-t s"</span>   . tmr-reschedule)
         (<span style="font-style: italic;">"C-x M-t l"</span>   . tmr-tabulated-view)
         <span style="font-weight: bold;">:map</span> my/launch-app-map
         (<span style="font-style: italic;">"t"</span> . tmr)))
</pre>
</div>
</div>
</li>

<li><a id="org91372f6"></a>beframe<br />
<div class="outline-text-6" id="text-org91372f6">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-beframe"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package beframe
  <span style="font-weight: bold;">:ensure</span> t
  <span style="font-weight: bold;">:bind</span> ((<span style="font-style: italic;">"C-x B"</span> . beframe-switch-buffer)
         (<span style="font-style: italic;">"C-x C-b"</span> . beframe-buffer-menu))
  <span style="font-weight: bold;">:custom</span>
  (beframe-global-buffers '(<span style="font-style: italic;">"*Messages*"</span> <span style="font-style: italic;">"*Backtrace*"</span>))
  (beframe-create-frame-scratch-buffer nil)
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">with-eval-after-load</span> 'consult
    (<span style="font-weight: bold;">defface</span> <span style="font-weight: bold; font-style: italic;">beframe-buffer</span>
      '((t <span style="font-weight: bold;">:inherit</span> font-lock-string-face))
      <span style="font-style: italic;">"Face for `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">consult</span><span style="font-style: italic;">' framed buffers."</span>)
    (<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">beframe--consult-source</span>
      `( <span style="font-weight: bold;">:name</span>     <span style="font-style: italic;">"Frame-specific buffers (current frame)"</span>
         <span style="font-weight: bold;">:narrow</span>   ?F
         <span style="font-weight: bold;">:category</span> buffer
         <span style="font-weight: bold;">:face</span>     beframe-buffer
         <span style="font-weight: bold;">:history</span>  beframe-history
         <span style="font-weight: bold;">:items</span>    ,#'beframe--buffer-names
         <span style="font-weight: bold;">:action</span>   ,#'switch-to-buffer
         <span style="font-weight: bold;">:state</span>    ,#'consult--buffer-state))
    (add-to-list 'consult-buffer-sources 'beframe--consult-source))
  (beframe-mode 1))
</pre>
</div>
</div>
</li>

<li><a id="org006a3a6"></a>free-keys&#xa0;&#xa0;&#xa0;<span class="tag"><span class="convenience">convenience</span></span><br />
<div class="outline-text-6" id="text-org006a3a6">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-free-keys"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package free-keys
  <span style="font-weight: bold;">:after</span> my-launch-app
  <span style="font-weight: bold;">:bind</span> (<span style="font-weight: bold;">:map</span> my/launch-app-map
              (<span style="font-style: italic;">"f"</span> . free-keys))
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">setq</span> free-keys-modifiers (append free-keys-modifiers
                                    '(<span style="font-style: italic;">"H"</span>))))
</pre>
</div>
</div>
</li>

<li><a id="orgab33f9e"></a>consult-recoll&#xa0;&#xa0;&#xa0;<span class="tag"><span class="docs">docs</span>&#xa0;<span class="convenience">convenience</span></span><br />
<div class="outline-text-6" id="text-orgab33f9e">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package consult-recoll
  <span style="font-weight: bold;">:ensure</span> t
  <span style="font-weight: bold;">:after</span> consult
  <span style="font-weight: bold;">:bind</span> (<span style="font-style: italic;">"M-s c"</span> . consult-recoll)
  <span style="font-weight: bold;">:preface</span>
  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/consult-recoll--html</span> (file)
    (<span style="font-weight: bold;">let</span> ((mime (mailcap-extension-to-mime (file-name-extension file))))
      (<span style="font-weight: bold;">cond</span>
       ((string= mime (regexp-quote <span style="font-style: italic;">"application/epub+zip"</span>))
        (my/open-epub-as-html file))
       (t (eww-open-file file)))))
  <span style="font-weight: bold;">:custom</span>
  (consult-recoll-open-fns
   '((<span style="font-style: italic;">"text/html"</span> . my/consult-recoll--html)
     (<span style="font-style: italic;">"application/pdf"</span> . my/open-pdf-as-html))))
</pre>
</div>
</div>
</li>

<li><a id="org1e74fd5"></a>detached&#xa0;&#xa0;&#xa0;<span class="tag"><span class="processes">processes</span>&#xa0;<span class="convenience">convenience</span></span><br />
<div class="outline-text-6" id="text-org1e74fd5">
<p>
How to use detached.el
</p>
<ul class="org-ul">
<li>in vterm
<ol class="org-ol">
<li>create a session with S-RET(detached-vterm-send-input)</li>
<li>detach from the session with C-c C-d(detached-detach-key)</li>
<li>attach to the session with C-RET(detached-vterm-attach)</li>
</ol></li>
<li>with shell-command
<ul class="org-ul">
<li>invoke/call detached-shell-command</li>
</ul></li>
</ul>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"dtach"</span>
<span style="font-style: italic;">"emacs-detached"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package detached
  <span style="font-weight: bold;">:init</span>
  (detached-init)
  (<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my/detached-bury-buffer</span> nil)
  <span style="font-weight: bold;">:bind</span>
  (([remap async-shell-command] . detached-shell-command)
   ([remap compile] . detached-compile)
   ([remap recompile] . detached-compile-recompile))
  <span style="font-weight: bold;">:custom</span>
  (detached-shell-command-initial-input nil)
  (detached-terminal-data-command system-type)
  (detached-terminal-data-command system-type)
  <span style="font-weight: bold;">:config</span>
  (add-to-list 'display-buffer-alist
               `((<span style="font-weight: bold;">lambda</span> (buffer-or-name arg)
                   (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">and</span> (string-match-p
                               (regexp-opt (list detached--shell-command-buffer))
                               (<span style="font-weight: bold;">cond</span>
                                ((stringp buffer-or-name) buffer-or-name)
                                ((bufferp buffer-or-name) (buffer-name buffer-or-name))))
                              my/detached-bury-buffer)
                     (<span style="font-weight: bold;">setq</span> my/detached-bury-buffer nil)
                     t))
                 (display-buffer-reuse-window)
                 (body-function
                  . (<span style="font-weight: bold;">lambda</span> (window) (<span style="font-weight: bold;">interactive</span>)
                      (bury-buffer))))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/org-link--open-shell-detached</span> (path _)
  <span style="font-style: italic;">"Open a \"shell\" type.</span>

<span style="font-style: italic;">PATH is the command to execute with `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">detached-shell-command</span><span style="font-style: italic;">'."</span>
  (<span style="font-weight: bold;">if</span> (<span style="font-weight: bold;">or</span> (<span style="font-weight: bold;">and</span> (org-string-nw-p org-link-shell-skip-confirm-regexp)
               (string-match-p org-link-shell-skip-confirm-regexp path))
          (not org-link-shell-confirm-function)
          (funcall org-link-shell-confirm-function
                   (format <span style="font-style: italic;">"Execute %s in shell? "</span>
                           (org-add-props path nil 'face 'org-warning))))
      (<span style="font-weight: bold;">progn</span>
        (message <span style="font-style: italic;">"Executing %s"</span> path)
        (detached-shell-command path))
    (<span style="font-weight: bold;">user-error</span> <span style="font-style: italic;">"Abort"</span>)))

(<span style="font-weight: bold;">with-eval-after-load</span> 'ol
  (org-link-set-parameters <span style="font-style: italic;">"shell"</span> <span style="font-weight: bold;">:follow</span> #'my/org-link--open-shell-detached))

(use-package detached-list
  <span style="font-weight: bold;">:after</span> my-launch-app
  <span style="font-weight: bold;">:bind</span> (<span style="font-weight: bold;">:map</span> my/invoke-list-command-map
              (<span style="font-style: italic;">"d"</span> . detached-list-sessions))
  <span style="font-weight: bold;">:config</span>
  (bind-keys <span style="font-weight: bold;">:map</span> detached-list-mode-map
             (<span style="font-style: italic;">"C-m"</span> . detached-list-open-session)
             (<span style="font-style: italic;">"C-j"</span> . detached-list-open-session)))
</pre>
</div>
</div>
</li>

<li><a id="orgb01152b"></a>emacs-guix&#xa0;&#xa0;&#xa0;<span class="tag"><span class="tools">tools</span></span><br />
<div class="outline-text-6" id="text-orgb01152b">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-guix"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package guix
  <span style="font-weight: bold;">:commands</span> guix
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">with-eval-after-load</span> 'my-launch-app
    (bind-keys <span style="font-weight: bold;">:map</span> my/launch-app-map
               (<span style="font-style: italic;">"x"</span> . guix))))
</pre>
</div>
</div>
</li>

<li><a id="org554601c"></a>pcre2el<br />
<div class="outline-text-6" id="text-org554601c">
<p>
<a href="https://github.com/joddie/pcre2el">pcre2el</a> is not only the converter between PCRE, emacs lisp style regexp and RX representation. It support re-builder as a conversion environment. Great!
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-pcre2el"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package pcre2el)
</pre>
</div>
</div>
</li>

<li><a id="org772d683"></a>iedit&#xa0;&#xa0;&#xa0;<span class="tag"><span class="simultaneous">simultaneous</span>&#xa0;<span class="region">region</span>&#xa0;<span class="refactoring">refactoring</span>&#xa0;<span class="occurrence">occurrence</span></span><br />
<div class="outline-text-6" id="text-org772d683">
<p>
<a href="https://github.com/victorhge/iedit">IEdit</a> is not only replacement for M-%/C-M-% but it highlights symbol occurences to change. <a href="https://www.masteringemacs.org/article/iedit-interactive-multi-occurrence-editing-in-your-buffer">This advise</a> would be useful for anyone who needs dedicated command to replace symbols in defun.
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-iedit"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package iedit
  <span style="font-weight: bold;">:bind</span> (<span style="font-style: italic;">"C-\""</span> . iedit-mode)
  <span style="font-weight: bold;">:custom</span>
  (iedit-toggle-key-default (kbd <span style="font-style: italic;">"C-\""</span>))
  (iedit-auto-narrow t))
</pre>
</div>
</div>
</li>

<li><a id="orgf92b373"></a>ledger-mode / flycheck-ledger&#xa0;&#xa0;&#xa0;<span class="tag"><span class="tools">tools</span>&#xa0;<span class="languages">languages</span>&#xa0;<span class="convenience">convenience</span></span><br />
<div class="outline-text-6" id="text-orgf92b373">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-ledger-mode"</span>
<span style="font-style: italic;">"emacs-flycheck-ledger"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package ledger-mode
  <span style="font-weight: bold;">:bind</span> (<span style="font-weight: bold;">:map</span> ledger-mode-map
              (<span style="font-style: italic;">"C-c C-y"</span> . ledger-copy-transaction-at-point))
  <span style="font-weight: bold;">:custom</span>
  (ledger-reconcile-default-commodity <span style="font-style: italic;">"\\"</span>)
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">flycheck-ledger</span>)
  (<span style="font-weight: bold;">with-eval-after-load</span> 'ob-core
    (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">ob-ledger</span>)))
</pre>
</div>
</div>
</li>

<li><a id="org27000ad"></a>mentor&#xa0;&#xa0;&#xa0;<span class="tag"><span class="processes">processes</span>&#xa0;<span class="comm">comm</span>&#xa0;<span class="bittorrent">bittorrent</span></span><br />
<div class="outline-text-6" id="text-org27000ad">
<p>
<a href="https://github.com/skangas/mentor">mentor</a> is a [BROKEN LINK: id:bdc987ad-419b-4f36-922d-de75207d85c0] client for emacs.
</p>

<p>
Typical file downloading workflow:
</p>
<ol class="org-ol">
<li>start mentor: M-x mentor</li>
<li>add magnet link (URL or torrent file path): M-x mentor-download-load-magnet-link-or-url (l)</li>
<li>view downloaded file in dired: M-x mentor-dired-jump (v)</li>
<li>shutdown mentor: M-x mentor-shutdown (Q)</li>
</ol>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-mentor"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package mentor
  <span style="font-weight: bold;">:commands</span> mentor
  <span style="font-weight: bold;">:custom</span>
  (mentor-rtorrent-download-directory <span style="font-style: italic;">"&lt;&lt;torrent-dir()&gt;&gt;"</span>)
  (mentor-rtorrent-keep-session t)
  (mentor-rtorrent-external-rpc <span style="font-style: italic;">"&lt;&lt;rtorrent-sock()&gt;&gt;"</span>))
</pre>
</div>
</div>
</li>

<li><a id="orgbc7bd7d"></a>geiser&#xa0;&#xa0;&#xa0;<span class="tag"><span class="scheme">scheme</span>&#xa0;<span class="languages">languages</span>&#xa0;<span class="geiser">geiser</span></span><br />
<div class="outline-text-6" id="text-orgbc7bd7d">
<p>
<a href="guix.html#The-Perfect-Setup">guix#The Perfect Setup</a>
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"guile"</span>
<span style="font-style: italic;">"emacs-geiser"</span>
<span style="font-style: italic;">"emacs-geiser-guile"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package geiser-guile
  <span style="font-weight: bold;">:commands</span> (scheme-mode)
  <span style="font-weight: bold;">:config</span>
  (add-to-list 'geiser-guile-load-path
               (file-name-concat <span style="font-style: italic;">"&lt;&lt;ghq-root()&gt;&gt;"</span> <span style="font-style: italic;">"git.savannah.gnu.org/git/guix"</span>))
  (<span style="font-weight: bold;">with-eval-after-load</span> 'yasnippet
    (add-to-list 'yas-snippet-dirs
                 (file-name-concat <span style="font-style: italic;">"&lt;&lt;ghq-root()&gt;&gt;"</span> <span style="font-style: italic;">"git.savannah.gnu.org/git/guix/etc/snippets/yas"</span>)
                 t))
  (load-file (file-name-concat <span style="font-style: italic;">"&lt;&lt;ghq-root()&gt;&gt;"</span> <span style="font-style: italic;">"git.savannah.gnu.org/git/guix/etc/copyright.el"</span>)))
</pre>
</div>
</div>
</li>

<li><a id="org05d99be"></a>consult-dash&#xa0;&#xa0;&#xa0;<span class="tag"><span class="docs">docs</span>&#xa0;<span class="dash">dash</span>&#xa0;<span class="consult">consult</span></span><br />
<div class="outline-text-6" id="text-org05d99be">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-dash-docs"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package dash-docs
  <span style="font-weight: bold;">:custom</span>
  (dash-docs-docsets-path
   (file-name-concat <span style="font-style: italic;">"&lt;&lt;share-dir()&gt;&gt;"</span> <span style="font-style: italic;">"dash/docsets"</span>)))

(add-to-list 'load-path
             (expand-file-name <span style="font-style: italic;">"elpa/consult-dash-20220621.226"</span> user-emacs-directory))

(use-package consult-dash
  <span style="font-weight: bold;">:after</span> dash-docs
  <span style="font-weight: bold;">:bind</span> (<span style="font-style: italic;">"M-s M-d"</span> . consult-dash))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defmacro</span> <span style="font-weight: bold;">my/add-dash-docsets-hook</span> (hook docsets)
  `(add-hook ,hook
             (<span style="font-weight: bold;">lambda</span> ()
               (<span style="font-weight: bold;">when</span> (functionp 'consult-dash)
                 (<span style="font-weight: bold;">setq-local</span> consult-dash-docsets ,docsets)))))
</pre>
</div>
</div>
</li>

<li><a id="org827d323"></a>denote<br />
<div class="outline-text-6" id="text-org827d323">
<p>
<a href="https://protesilaos.com/emacs/denote">Denote</a> leverages note taking in org mode by providing file naming scheme and backlink capability.
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-denote"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package denote
  <span style="font-weight: bold;">:after</span> my/org-mode-init
  <span style="font-weight: bold;">:custom</span>
  (denote-directory (expand-file-name <span style="font-style: italic;">"~/org/notes"</span>))
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">denote-org-dblock</span>)
  (<span style="font-weight: bold;">with-eval-after-load</span> 'org-capture
    (<span style="font-weight: bold;">setq</span> denote-org-capture-specifiers <span style="font-style: italic;">"%l\n%i\n%?"</span>)
    (add-to-list 'org-capture-templates
                 '(<span style="font-style: italic;">"n"</span> <span style="font-style: italic;">"New note (with denote.el)"</span> plain
                   (file denote-last-path)
                   #'denote-org-capture
                   <span style="font-weight: bold;">:no-save</span> t
                   <span style="font-weight: bold;">:immediate-finish</span> nil
                   <span style="font-weight: bold;">:kill-buffer</span> t
                   <span style="font-weight: bold;">:jump-to-captured</span> t))))
</pre>
</div>
</div>
</li>

<li><a id="orgffa34ba"></a>denote-menu<br />
<div class="outline-text-6" id="text-orgffa34ba">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-denote-menu"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp" id="org0e28e21">(use-package denote-menu
  <span style="font-weight: bold;">:after</span> denote
  <span style="font-weight: bold;">:custom</span>
  (denote-menu-date-column-width 12)
  (denote-menu-title-column-width 32)
  (denote-menu-show-file-type nil))
</pre>
</div>
</div>
</li>

<li><a id="orgd336296"></a>tree-sitter&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span><br /></li>

<li><a id="org29ce4d4"></a>xr&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span><br /></li>

<li><a id="org5607b03"></a>Whole Line Or Region&#xa0;&#xa0;&#xa0;<span class="tag"><span class="wp">wp</span>&#xa0;<span class="convenience">convenience</span></span><br />
<div class="outline-text-6" id="text-org5607b03">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-style: italic;">"https://github.com/purcell/whole-line-or-region/releases.atom"</span> soft_update)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package whole-line-or-region
  <span style="font-weight: bold;">:ensure</span> t
  <span style="font-weight: bold;">:config</span>
  (whole-line-or-region-global-mode 1))
</pre>
</div>
</div>
</li>

<li><a id="org0e31efd"></a>projectile&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span>&#xa0;<span class="ignore">ignore</span></span><br /></li>

<li><a id="org285041c"></a>counsel-projectile&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span>&#xa0;<span class="ignore">ignore</span></span><br /></li>
<li><a id="org827374d"></a>ag.el&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span>&#xa0;<span class="ignore">ignore</span></span><br /></li>

<li><a id="org074a025"></a>ripgrep.el&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span>&#xa0;<span class="ignore">ignore</span></span><br /></li>

<li><a id="org927d7ab"></a>wgrep&#xa0;&#xa0;&#xa0;<span class="tag"><span class="grep">grep</span>&#xa0;<span class="extensions">extensions</span>&#xa0;<span class="edit">edit</span></span><br />
<div class="outline-text-6" id="text-org927d7ab">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-wgrep"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package wgrep
  <span style="font-weight: bold;">:custom</span>
  (wgrep-auto-save-buffer t)
  (wgrep-enable-key <span style="font-style: italic;">"e"</span>))
</pre>
</div>
</div>
</li>

<li><a id="orgc273ff5"></a>dumb-jump&#xa0;&#xa0;&#xa0;<span class="tag"><span class="programming">programming</span></span><br />
<div class="outline-text-6" id="text-orgc273ff5">
<p>
<a href="https://github.com/jacktasia/dumb-jump">dumb-jump</a> is "jump to definition" package without tagging.
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-dumb-jump"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package dumb-jump
  <span style="font-weight: bold;">:hook</span> (prog-mode . (<span style="font-weight: bold;">lambda</span> ()
                       (add-to-list 'xref-backend-functions
                                    #'dumb-jump-xref-activate
                                    t)))
  <span style="font-weight: bold;">:config</span>
  (bind-keys (<span style="font-style: italic;">"M-g o"</span> . dumb-jump-go-other-window)
             (<span style="font-style: italic;">"M-g j"</span> . dumb-jump-go)
             (<span style="font-style: italic;">"M-g x"</span> . dumb-jump-go-prefer-external)
             (<span style="font-style: italic;">"M-g z"</span> . dumb-jump-go-prefer-external-other-window)
             (<span style="font-style: italic;">"M-g /"</span> . dumb-jump-back)
             (<span style="font-style: italic;">"M-g l"</span> . dumb-jump-quick-look)))
</pre>
</div>
</div>
</li>

<li><a id="orgdb5d2af"></a>visual-regexp&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span><br /></li>

<li><a id="orgb963da8"></a>avy&#xa0;&#xa0;&#xa0;<span class="tag"><span class="point">point</span>&#xa0;<span class="location">location</span></span><br />
<div class="outline-text-6" id="text-orgb963da8">
<p>
<a href="https://karthinks.com/software/avy-can-do-anything/">This post</a> tell me how we can concoct efficient editing workflow with avy.
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-avy"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package avy
  <span style="font-weight: bold;">:preface</span>
  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">avy-action-embark</span> (pt)
    (<span style="font-weight: bold;">unwind-protect</span>
        (<span style="font-weight: bold;">save-excursion</span>
          (goto-char pt)
          (embark-act))
      (select-window
       (cdr (ring-ref avy-ring 0))))
    t)
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">setf</span> (alist-get ?. avy-dispatch-alist) 'avy-action-embark)
  (bind-keys (<span style="font-style: italic;">"M-g g"</span> . avy-goto-line)
             (<span style="font-style: italic;">"H-g"</span> . avy-goto-line)))
</pre>
</div>
</div>

<ul class="org-ul">
<li><a id="org4366cc9"></a>avy-migemo<br />
<div class="outline-text-7" id="text-org4366cc9">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package avy-migemo
  <span style="font-weight: bold;">:ensure</span> t
  <span style="font-weight: bold;">:after</span> migemo
  <span style="font-weight: bold;">:bind</span> ((<span style="font-style: italic;">"M-g M-a"</span> . avy-migemo-goto-char-timer)
         (<span style="font-style: italic;">"M-g a"</span> . avy-migemo-goto-char-timer)
         (<span style="font-style: italic;">"H-a"</span> . avy-migemo-goto-char-timer)
         <span style="font-weight: bold;">:map</span> isearch-mode-map
         (<span style="font-style: italic;">"M-a"</span> . avy-migemo-isearch)))
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="org71343aa"></a>paredit&#xa0;&#xa0;&#xa0;<span class="tag"><span class="lisp">lisp</span></span><br />
<div class="outline-text-6" id="text-org71343aa">
<p>
Handy commands
</p>
<ul class="org-ul">
<li>press '(' to insert '()' pair</li>
<li>C-&lt;left/right&gt; to barf and slurp s-expressions</li>
<li>call paredit-splice-sexp to strip embracing parenthes</li>
<li>press M-&lt;up&gt; or M-r to delete upper sexp except pointing one</li>
<li>DEL, C-d, C-k act like originals but care for parenthes</li>
<li>press DEL to remedy unbalanced parenthes</li>
<li>press C-q ( to insert ( char manually</li>
</ul>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-paredit"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package paredit
  <span style="font-weight: bold;">:bind</span> (<span style="font-weight: bold;">:map</span> paredit-mode-map
              (<span style="font-style: italic;">"&lt;backspace&gt;"</span> . paredit-backward-delete)
              (<span style="font-style: italic;">"C-M-g"</span> .  paredit-splice-sexp)
              (<span style="font-style: italic;">"M-s"</span> . nil)
              (<span style="font-style: italic;">"C-M-;"</span> . paredit-comment-dwim)
              (<span style="font-style: italic;">"M-;"</span> . nil))
  <span style="font-weight: bold;">:hook</span> (((emacs-lisp-mode lisp-mode scheme-mode) . enable-paredit-mode)))
</pre>
</div>

<ul class="org-ul">
<li><p>
workaround
Thanks to <a href="https://andreyorst.gitlab.io/posts/2021-09-30-why-is-paredit-is-so-un-emacsy/">this blog post</a>, a couple of commands in paredit.el are fixed with transient-mark-mode
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my/paredit-delete-region-functions</span>
  '(paredit-forward-delete
    paredit-backward-delete)
  <span style="font-style: italic;">"List of `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">paredit-mode</span><span style="font-style: italic;">' functions that should support tmm region deletion."</span>)

(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my/paredit-kill-region-functions</span>
  '(paredit-forward-kill-word
    paredit-backward-kill-word)
  <span style="font-style: italic;">"List of `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">paredit-mode</span><span style="font-style: italic;">' functions that should support tmm region killing."</span>)

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/paredit-fix-transient-mark-mode</span> (orig-fn <span style="font-weight: bold; text-decoration: underline;">&amp;rest</span> args)
  <span style="font-style: italic;">"Allow deleting/killing a region if expression is balanced."</span>
  (<span style="font-weight: bold;">if</span> (<span style="font-weight: bold;">and</span> transient-mark-mode
           mark-active)
      (<span style="font-weight: bold;">cond</span> ((memq this-command my/paredit-delete-region-functions)
             (paredit-delete-region (region-beginning) (region-end)))
            ((memq this-command my/paredit-kill-region-functions)
             (paredit-kill-region (region-beginning) (region-end)))
            (t (apply orig-fn args)))
    (apply orig-fn args)))

(<span style="font-weight: bold;">dolist</span> (fun (append my/paredit-delete-region-functions
                     my/paredit-kill-region-functions))
  (advice-add fun <span style="font-weight: bold;">:around</span> #'my/paredit-fix-transient-mark-mode))
</pre>
</div></li>
</ul>
</div>
</li>

<li><a id="org68f3efb"></a>lsp-mode&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span><br /></li>

<li><a id="org95bc2b1"></a>company-mode&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span><br /></li>

<li><a id="orgf76794f"></a>flycheck&#xa0;&#xa0;&#xa0;<span class="tag"><span class="tools">tools</span>&#xa0;<span class="languages">languages</span>&#xa0;<span class="convenience">convenience</span></span><br />
<div class="outline-text-6" id="text-orgf76794f">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-flycheck"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package flycheck
  <span style="font-weight: bold;">:diminish</span>
  <span style="font-weight: bold;">:hook</span> (prog-mode . flycheck-mode-on-safe)
  <span style="font-weight: bold;">:custom</span>
  (global-flycheck-mode t)
  (flycheck-check-syntax-automatically
   '(save new-line idle-change))
  (flycheck-display-errors-delay 10.0)
  (flycheck-checker-error-threshold 1000)
  (flycheck-textlint-config <span style="font-style: italic;">".textlintrc"</span>)
  <span style="font-weight: bold;">:config</span>
  (add-hook 'flycheck-mode-hook
            (<span style="font-weight: bold;">lambda</span> ()
              (<span style="font-weight: bold;">if</span> (my/ascii-string-p (buffer-string))
                  (<span style="font-weight: bold;">setq</span> flycheck-textlint-config <span style="font-style: italic;">".textlintrc"</span>)
                (<span style="font-weight: bold;">setq</span> flycheck-textlint-config <span style="font-style: italic;">".config/textlint/textlintrc_ja"</span>))))
  (add-to-list 'display-buffer-alist
               `(,flycheck-error-message-buffer
                 . (display-buffer-reuse-window
                    display-buffer-in-previous-window
                    display-buffer-pop-up-window
                    . ((window-height . 5))))))
</pre>
</div>
</div>
</li>

<li><a id="org9edee8e"></a>twittering-mode&#xa0;&#xa0;&#xa0;<span class="tag"><span class="web">web</span>&#xa0;<span class="twitter">twitter</span>&#xa0;<span class="ARCHIVE">ARCHIVE</span></span><br /></li>

<li><a id="orgbc47a7e"></a>comment-dwim-2&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span><br /></li>

<li><a id="orgbc38716"></a>undo-tree&#xa0;&#xa0;&#xa0;<span class="tag"><span class="undo">undo</span>&#xa0;<span class="tree">tree</span>&#xa0;<span class="redo">redo</span>&#xa0;<span class="history">history</span>&#xa0;<span class="files">files</span>&#xa0;<span class="convenience">convenience</span></span><br />
<div class="outline-text-6" id="text-orgbc38716">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-undo-tree"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp" id="orga1de134">(no-littering-expand-var-file-name <span style="font-style: italic;">"undo-tree"</span>)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-conf">d &lt;&lt;undo-tree-hist-dir()&gt;&gt; 0755 - - 3w
</pre>
</div>

<div class="org-src-container">
<pre class="src src-shell">-e <span style="font-style: italic;">"&lt;&lt;undo-tree-hist-dir()&gt;&gt;"</span> <span style="font-style: italic;">\</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package undo-tree
  <span style="font-weight: bold;">:diminish</span> undo-tree-mode
  <span style="font-weight: bold;">:init</span>
  (<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">undo-tree-excludes</span> '(<span style="font-style: italic;">"/gnu/store"</span>))
  <span style="font-weight: bold;">:custom</span>
  (global-undo-tree-mode t)
  (undo-tree-auto-save-history nil)
  (undo-tree-enable-undo-in-region t)
  (undo-tree-limit 320000)
  (undo-tree-strong-limit 480000)
  (undo-tree-outer-limit 64000000)
  <span style="font-weight: bold;">:config</span>
  (bind-keys <span style="font-weight: bold;">:map</span> undo-tree-map
             (<span style="font-style: italic;">"M-_"</span> . nil))
  (add-to-list 'undo-tree-history-directory-alist
               '(<span style="font-style: italic;">"."</span> . <span style="font-style: italic;">"&lt;&lt;undo-tree-hist-dir()&gt;&gt;"</span>))
  (add-to-list 'display-buffer-alist
               `(,undo-tree-visualizer-buffer-name . (display-buffer-in-side-window
                                                      . ((side . right)
                                                         (window-width . 15))))))
</pre>
</div>
</div>
</li>

<li><a id="orgfe54ca4"></a>quickrun&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span><br /></li>

<li><a id="org02a962d"></a>expand-region<br />
<div class="outline-text-6" id="text-org02a962d">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-expand-region"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package expand-region
  <span style="font-weight: bold;">:bind</span> ((<span style="font-style: italic;">"C-,"</span>   . er/expand-region)
         (<span style="font-style: italic;">"C-M-,"</span> . er/contract-region))
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">push</span> 'er/mark-outside-pairs er/try-expand-list))
</pre>
</div>
</div>
</li>

<li><a id="org8d33d8c"></a>helpful<br />
<div class="outline-text-6" id="text-org8d33d8c">
<p>
helpful-mode displays more sources compared to help-mode, including callers, debugging information, and source code.
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-helpful"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package helpful
  <span style="font-weight: bold;">:after</span> help
  <span style="font-weight: bold;">:bind</span> (<span style="font-weight: bold;">:map</span> help-map
              (<span style="font-style: italic;">"C-u a"</span> . helpful-callable)
              (<span style="font-style: italic;">"C-u f"</span> . helpful-function)
              (<span style="font-style: italic;">"C-u s"</span> . helpful-symbol)
              (<span style="font-style: italic;">"C-u x"</span> . helpful-command)
              (<span style="font-style: italic;">"C-u v"</span> . helpful-variable)
              (<span style="font-style: italic;">"C-u k"</span> . helpful-key)
              (<span style="font-style: italic;">"C-u m"</span> . helpful-macro)))
</pre>
</div>
</div>
</li>

<li><a id="org4643aa1"></a>define-word&#xa0;&#xa0;&#xa0;<span class="tag"><span class="dictionary">dictionary</span>&#xa0;<span class="convenience">convenience</span></span><br />
<div class="outline-text-6" id="text-org4643aa1">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-style: italic;">"https://github.com/abo-abo/define-word/releases.atom"</span> soft_update)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package define-word
  <span style="font-weight: bold;">:ensure</span> t
  <span style="font-weight: bold;">:defer</span> t
  <span style="font-weight: bold;">:bind</span> (<span style="font-weight: bold;">:map</span> engine-mode-prefixed-map
              (<span style="font-style: italic;">"n"</span> . my/define-word))
  <span style="font-weight: bold;">:preface</span>
  (<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my/define-word-minibuffer-history</span> nil)
  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/define-word</span> ()
    <span style="font-style: italic;">"Invoke `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">define-word</span><span style="font-style: italic;">' with dedicated minibuffer history."</span>
    (<span style="font-weight: bold;">interactive</span>)
    (<span style="font-weight: bold;">let</span> ((word (<span style="font-weight: bold;">if</span> (use-region-p)
                    (buffer-substring-no-properties
                     (region-beginning)
                     (region-end))
                  (read-string <span style="font-style: italic;">"Word: "</span> nil 'my/define-word-minibuffer-history
                               (word-at-point t)))))
      (define-word word define-word-default-service)))
  <span style="font-weight: bold;">:custom</span>
  (define-word-displayfn-alist
   '((wordnik . my/define-word--display-in-buffer)
     (openthesaurus . my/define-word--display-in-buffer)
     (webster . my/define-word--display-in-buffer)))
  (define-word-default-service 'wordnik)
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">setf</span> (cdr (assoc 'wordnik define-word-services))
        '(<span style="font-style: italic;">"http://wordnik.com/words/%s"</span> my/define-word--parse-wordnik-all))
  (<span style="font-weight: bold;">push</span> '(<span style="font-style: italic;">"&lt;b&gt;</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">.*?</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">&lt;/b&gt;"</span> bold)
        define-word--tag-faces)
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">fix issue #31 temporally</span>
  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/define-word--fix-31</span> (define-word-orig <span style="font-weight: bold; text-decoration: underline;">&amp;rest</span> args)
    <span style="font-style: italic;">"Fix `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">define-word</span><span style="font-style: italic;">' backends that require a user agent (like wordnik)."</span>
    (<span style="font-weight: bold;">let</span> ((url-request-extra-headers
           '((<span style="font-style: italic;">"User-Agent"</span> .
              <span style="font-style: italic;">"Mozilla/5.0 (Macintosh; Intel Mac OS X 11_5_2) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/93.0.4577.63 Safari/537.36"</span>))))
      (apply define-word-orig args)))
  (advice-add #'define-word <span style="font-weight: bold;">:around</span> #'my/define-word--fix-31))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/define-word--display-in-buffer</span> (definition)
  <span style="font-style: italic;">"docstring"</span>
  (<span style="font-weight: bold;">let*</span> ((buf-name <span style="font-style: italic;">"*DEFINE WORD*"</span>)
         (buffer (get-buffer-create buf-name))
         (display-buffer-alist
          `((,buf-name
             (display-buffer-same-window)))))
    (<span style="font-weight: bold;">with-current-buffer</span> buffer
      (read-only-mode -1)
      (erase-buffer)
      (insert definition)
      (goto-char (point-min))
      (<span style="font-weight: bold;">save-excursion</span> (xml-parse-string))
      (read-only-mode 1))
    (display-buffer buffer)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/define-word--parse-wordnik-example</span> ()
  (<span style="font-weight: bold;">save-excursion</span>
    (<span style="font-weight: bold;">let</span> (beg
          results
          (define-word-limit 10))
      (re-search-forward <span style="font-style: italic;">"&lt;h2&gt;Examples"</span> nil t)
      (<span style="font-weight: bold;">save-excursion</span>
        (<span style="font-weight: bold;">setq</span> beg (re-search-forward <span style="font-style: italic;">"&lt;div class=\"relatedWords-module\"&gt;"</span> nil t)))
      (<span style="font-weight: bold;">while</span> (re-search-forward <span style="font-style: italic;">"&lt;p class=\"text\"&gt;</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">.*</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">&lt;/p&gt;"</span> beg t)
        (<span style="font-weight: bold;">push</span> <span style="font-style: italic;">"---"</span> results)
        (<span style="font-weight: bold;">push</span> (match-string 1) results))
      (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">setq</span> results (nreverse results))
        (define-word--convert-html-tag-to-face (define-word--join-results results))))))

(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my/define-word-part-map-alist</span> '((<span style="font-style: italic;">"adjective"</span> <span style="font-style: italic;">"adj."</span>)
                                        (<span style="font-style: italic;">"adverb"</span> <span style="font-style: italic;">"adv."</span>)
                                        (<span style="font-style: italic;">"intransitive verb"</span> <span style="font-style: italic;">"v.i."</span>)
                                        (<span style="font-style: italic;">"transitive verb"</span> <span style="font-style: italic;">"v.t."</span>)))


(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/define-word--parse-wordnik</span> ()
  (<span style="font-weight: bold;">let</span> ((str (define-word--parse-wordnik)))
    (<span style="font-weight: bold;">with-temp-buffer</span>
      (insert str)
      (mapc (<span style="font-weight: bold;">lambda</span> (abbrev-map)
              (goto-char (point-min))
              (<span style="font-weight: bold;">while</span> (re-search-forward (format <span style="font-style: italic;">"</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">%s</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">"</span> (car abbrev-map)) nil t)
                (<span style="font-weight: bold;">let</span> ((match (match-string 1)))
                  (replace-match
                   (propertize (cadr abbrev-map) 'face (text-properties-at (point)))))))
            my/define-word-part-map-alist)
      (buffer-string))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/define-word--parse-wordnik-related-word</span> ()
  <span style="font-style: italic;">"docstring"</span>
  (<span style="font-weight: bold;">save-excursion</span>
    (<span style="font-weight: bold;">save-match-data</span>
      (seq-reduce
       (<span style="font-weight: bold;">lambda</span> (accum group)
         (<span style="font-weight: bold;">let</span> (results
               (define-word-limit 20))
           (<span style="font-weight: bold;">if</span> (re-search-forward (format <span style="font-style: italic;">"&lt;h3&gt;%s"</span> group) nil t)
               (<span style="font-weight: bold;">progn</span> (<span style="font-weight: bold;">save-excursion</span>
                        (<span style="font-weight: bold;">setq</span> beg (re-search-forward <span style="font-style: italic;">"&lt;div class=\"related-group-header clearfix\"&gt;"</span> nil t)))
                      (<span style="font-weight: bold;">push</span> (concat group <span style="font-style: italic;">":"</span>) results)
                      (<span style="font-weight: bold;">while</span> (re-search-forward <span style="font-style: italic;">"&lt;span data-definition-for=\"</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">[</span><span style="font-style: italic;">^</span><span style="font-style: italic;">\"]*</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">\""</span> beg t)
                        (<span style="font-weight: bold;">push</span> (concat <span style="font-style: italic;">"- "</span> (match-string 1)) results)
                        (re-search-forward <span style="font-style: italic;">"&lt;/span&gt;"</span>))
                      (concat (<span style="font-weight: bold;">when</span> accum (concat accum <span style="font-style: italic;">"\n\n"</span>))
                              (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">setq</span> results (nreverse results))
                                (define-word--convert-html-tag-to-face (define-word--join-results results)))))
             accum)))
       '(<span style="font-style: italic;">"antonym"</span> <span style="font-style: italic;">"equivalents"</span> <span style="font-style: italic;">"hypernyms"</span> <span style="font-style: italic;">"hyponyms"</span> <span style="font-style: italic;">"same context"</span>)
       nil))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/define-word--parse-wordnik-all</span> ()
  <span style="font-style: italic;">""</span>
  (<span style="font-weight: bold;">let*</span> ((def (funcall #'my/define-word--parse-wordnik))
         (rel (funcall #'my/define-word--parse-wordnik-related-word))
         (exp (funcall #'my/define-word--parse-wordnik-example)))
    (concat <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">"Definitions:\n" (funcall #'define-word--parse-wordnik) "\n\n"</span>
     (<span style="font-weight: bold;">when</span> def (format <span style="font-style: italic;">"Definitions:\n%s\n\n"</span> def))
     (<span style="font-weight: bold;">when</span> rel (format <span style="font-style: italic;">"%s\n\n"</span> rel))
     (<span style="font-weight: bold;">when</span> exp (format <span style="font-style: italic;">"Examples:\n%s\n"</span> exp)))))
</pre>
</div>
</div>
</li>

<li><a id="org84841fe"></a>synosaurus<br />
<div class="outline-text-6" id="text-org84841fe">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-synosaurus"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package synosaurus
  <span style="font-weight: bold;">:bind</span> (<span style="font-weight: bold;">:map</span> engine-mode-prefixed-map
              (<span style="font-style: italic;">"s"</span> . synosaurus-lookup))
  <span style="font-weight: bold;">:custom</span>
  (synosaurus-choose-method 'default))
</pre>
</div>
</div>
</li>

<li><a id="org384c112"></a>exec-path-from-shell&#xa0;&#xa0;&#xa0;<span class="tag"><span class="unix">unix</span>&#xa0;<span class="environment">environment</span></span><br />
<div class="outline-text-6" id="text-org384c112">
<p>
A GNU Emacs library to ensure environment variables inside Emacs look the same as in the user's shell.
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-exec-path-from-shell"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package exec-path-from-shell
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">when</span> (memq window-system '(mac))
    (exec-path-from-shell-initialize)))
</pre>
</div>
</div>
</li>

<li><a id="org4dfb270"></a>migemo.el<br />
<div class="outline-text-6" id="text-org4dfb270">
<p>
migemo allows me to search incrementally Japanese words using roma-ji expression.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-style: italic;">"https://github.com/emacs-jp/migemo/releases.atom"</span> soft_update)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package migemo
  <span style="font-weight: bold;">:ensure</span> t
  <span style="font-weight: bold;">:ensure-system-package</span> cmigemo
  <span style="font-weight: bold;">:custom</span>
  (migemo-command <span style="font-style: italic;">"cmigemo"</span>)
  (migemo-options '(<span style="font-style: italic;">"-q"</span> <span style="font-style: italic;">"--emacs"</span>))
  (migemo-directory
   (file-name-concat <span style="font-style: italic;">"&lt;&lt;migemo-dict-path()&gt;&gt;"</span> <span style="font-style: italic;">"utf-8"</span>))
  (migemo-dictionary
   (file-name-concat <span style="font-style: italic;">"&lt;&lt;migemo-dict-path()&gt;&gt;"</span> <span style="font-style: italic;">"utf-8/migemo-dict"</span>))
  (migemo-user-dictionary nil)
  (migemo-coding-system 'utf-8-unix)
  (migemo-regex-dictionary nil)
  <span style="font-weight: bold;">:config</span>
  (migemo-init))
</pre>
</div>
</div>

<ul class="org-ul">
<li><a id="orgf3b7311"></a>ivy-migemo&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span>&#xa0;<span class="ignore">ignore</span></span><br /></li>
</ul>
</li>

<li><a id="org63ff880"></a>jaword<br />
<div class="outline-text-6" id="text-org63ff880">
<p>
Jaword.elはbackward-wordやforward-wordを日本語に対応させる機能を提供します。これらのコマンドはデフォルトではひらがな・カタカナ・漢字の境界を単語の区切りとするのに対し、jaword.elを使用するとより正確に日本語の単語単位での移動が可能です。
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-style: italic;">"https://github.com/zk-phi/jaword/releases.atom"</span> soft_update)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package jaword
  <span style="font-weight: bold;">:ensure</span> t
  <span style="font-weight: bold;">:custom</span>
  (jaword-enable-subword t)
  <span style="font-weight: bold;">:hook</span> ((skk-mode
          . (<span style="font-weight: bold;">lambda</span> ()
              (jaword-mode 1)))
         (input-method-activate
          . (<span style="font-weight: bold;">lambda</span> ()
              (<span style="font-weight: bold;">when</span> (string= current-input-method <span style="font-style: italic;">"japanese-skk"</span>)
                (jaword-mode 1))))
         (input-method-deactivate
          . (<span style="font-weight: bold;">lambda</span> ()
              (<span style="font-weight: bold;">when</span> (string= current-input-method <span style="font-style: italic;">"japanese-skk"</span>)
                (jaword-mode -1))))))
</pre>
</div>
</div>
</li>

<li><a id="org7569145"></a>hungry-delete&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span><br /></li>

<li><a id="orgb97be11"></a>aggressive-indent-mode&#xa0;&#xa0;&#xa0;<span class="tag"><span class="tools">tools</span>&#xa0;<span class="maint">maint</span>&#xa0;<span class="lisp">lisp</span>&#xa0;<span class="indent">indent</span></span><br />
<div class="outline-text-6" id="text-orgb97be11">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-aggressive-indent"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package aggressive-indent
  <span style="font-weight: bold;">:diminish</span> (aggressive-indent-mode . <span style="font-style: italic;">"ai"</span>)
  <span style="font-weight: bold;">:hook</span> (emacs-lisp-mode . aggressive-indent-mode))
</pre>
</div>
</div>
</li>
<li><a id="org7b39f7a"></a>adaptive-wrap<br />
<div class="outline-text-6" id="text-org7b39f7a">
<p>
adaptive-wrap and visual-line-mode are active in a bundle in a bunch of major modes.
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-adaptive-wrap"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package adaptive-wrap)
</pre>
</div>
</div>
</li>

<li><a id="org6fa049c"></a>restart-emacs&#xa0;&#xa0;&#xa0;<span class="tag"><span class="convenience">convenience</span>&#xa0;<span class="ARCHIVE">ARCHIVE</span></span><br /></li>

<li><a id="org204e204"></a>pangu-spacing&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span><br /></li>
<li><a id="orga5b897a"></a>which-key&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span><br /></li>
<li><a id="org02246e9"></a>hydra&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span><br /></li>

<li><a id="org1a609b7"></a>pass&#xa0;&#xa0;&#xa0;<span class="tag"><span class="store">store</span>&#xa0;<span class="password">password</span>&#xa0;<span class="password">password</span>&#xa0;<span class="keychain">keychain</span></span><br />
<div class="outline-text-6" id="text-org1a609b7">
<p>
Major mode for manupulating password store file.
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-pass"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package pass
  <span style="font-weight: bold;">:commands</span> pass
  <span style="font-weight: bold;">:bind</span> (<span style="font-weight: bold;">:map</span> pass-mode-map
              (<span style="font-style: italic;">"C-j"</span> . pass-view)))
</pre>
</div>
</div>
</li>

<li><a id="orgbdc904d"></a>password-store&#xa0;&#xa0;&#xa0;<span class="tag"><span class="tools">tools</span>&#xa0;<span class="store">store</span>&#xa0;<span class="password">password</span>&#xa0;<span class="password">password</span>&#xa0;<span class="pass">pass</span></span><br />
<div class="outline-text-6" id="text-orgbdc904d">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-password-store"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package password-store
  <span style="font-weight: bold;">:custom</span>
  (password-store-time-before-clipboard-restore 25))
</pre>
</div>
</div>
</li>

<li><a id="orgb3f0496"></a>nov.el&#xa0;&#xa0;&#xa0;<span class="tag"><span class="multimedia">multimedia</span>&#xa0;<span class="hypermedia">hypermedia</span>&#xa0;<span class="epub">epub</span></span><br />
<div class="outline-text-6" id="text-orgb3f0496">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-nov-el"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package nov
  <span style="font-weight: bold;">:mode</span> (<span style="font-style: italic;">"\\.epub$"</span> . nov-mode)
  <span style="font-weight: bold;">:hook</span> (nov-mode . nov-abbreviate-file-name)
  <span style="font-weight: bold;">:custom</span>
  (nov-variable-pitch nil)
  (nov-text-width t)
  <span style="font-weight: bold;">:config</span>
  (bind-keys <span style="font-weight: bold;">:map</span> nov-mode-map
             (<span style="font-style: italic;">"C-j"</span> . nov-browse-url)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">nov-abbreviate-file-name</span> ()
  <span style="font-style: italic;">"Shorten `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">nov-file-name</span><span style="font-style: italic;">' using `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">directory-abbrev-alist</span><span style="font-style: italic;">'."</span>
  (<span style="font-weight: bold;">setq</span> nov-file-name (abbreviate-file-name nov-file-name)))
</pre>
</div>
</div>
</li>

<li><a id="org7a77a20"></a>yasnippet&#xa0;&#xa0;&#xa0;<span class="tag"><span class="emulation">emulation</span>&#xa0;<span class="convenience">convenience</span></span><br />
<div class="outline-text-6" id="text-org7a77a20">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-yasnippet"</span>
<span style="font-style: italic;">"emacs-yasnippet-snippets"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package yasnippet
  <span style="font-weight: bold;">:disabled</span> t
  <span style="font-weight: bold;">:bind</span> (<span style="font-weight: bold;">:prefix</span> <span style="font-style: italic;">"C-c y"</span>
                 <span style="font-weight: bold;">:prefix-map</span> my/yas-map
                 <span style="font-weight: bold;">:prefix-docstring</span> <span style="font-style: italic;">"Keymap for YASnippet family."</span>
                 (<span style="font-style: italic;">"v"</span> . yas-visit-snippet-file)
                 (<span style="font-style: italic;">"n"</span> . yas-new-snippet)
                 (<span style="font-style: italic;">"i"</span> . yas-insert-snippet)
                 (<span style="font-style: italic;">"TAB"</span> . yas-insert-snippet))
  <span style="font-weight: bold;">:hook</span>
  ((prog-mode text-mode) . yas-minor-mode)
  (after-init . yas-reload-all)
  <span style="font-weight: bold;">:custom</span>
  (yas-triggers-in-field t)
  (yas-wrap-around-region t)
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">yasnippet-snippets</span>))
</pre>
</div>
</div>
</li>

<li><a id="orgeef5797"></a>auto-yasnippet<br />
<div class="outline-text-6" id="text-orgeef5797">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-auto-yasnippet"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package auto-yasnippet
  <span style="font-weight: bold;">:disabled</span> t
  <span style="font-weight: bold;">:after</span> yasnippet
  <span style="font-weight: bold;">:config</span>
  (bind-keys <span style="font-weight: bold;">:map</span> my/yas-map
             (<span style="font-style: italic;">"a"</span>   . aya-create)
             (<span style="font-style: italic;">"A"</span>   . aya-expand)
             (<span style="font-style: italic;">"C-s"</span> . aya-persist-snippet)))
</pre>
</div>
</div>
</li>

<li><a id="org6319237"></a>yankpad&#xa0;&#xa0;&#xa0;<span class="tag"><span class="convenience">convenience</span>&#xa0;<span class="abbrev">abbrev</span>&#xa0;<span class="ARCHIVE">ARCHIVE</span></span><br /></li>

<li><a id="orgb9a754d"></a>pdf-tools&#xa0;&#xa0;&#xa0;<span class="tag"><span class="multimedia">multimedia</span>&#xa0;<span class="files">files</span>&#xa0;<span class="ARCHIVE">ARCHIVE</span></span><br /></li>

<li><a id="orgad9b9b8"></a>rainbow-mode&#xa0;&#xa0;&#xa0;<span class="tag"><span class="faces">faces</span></span><br />
<div class="outline-text-6" id="text-orgad9b9b8">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-rainbow-mode"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package rainbow-mode
  <span style="font-weight: bold;">:diminish</span>
  (rainbow-mode . <span style="font-style: italic;">"rb"</span>)
  <span style="font-weight: bold;">:hook</span>
  ((css-mode scss-mode php-mode html-mode) . rainbow-mode)
  <span style="font-weight: bold;">:custom</span>
  (rainbow-html-colors t)
  (rainbow-x-colors t)
  (rainbow-latex-colors t)
  (rainbow-ansi-colors t))
</pre>
</div>
</div>
</li>
<li><a id="org21dc3fe"></a>alert&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notification">notification</span>&#xa0;<span class="message">message</span>&#xa0;<span class="emacs">emacs</span></span><br />
<div class="outline-text-6" id="text-org21dc3fe">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-alert"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package alert
  <span style="font-weight: bold;">:config</span>
  (set-face-background 'alert-saved-fringe-face nil)
  (alert-add-rule <span style="font-weight: bold;">:status</span> '(buried)
                  <span style="font-weight: bold;">:mode</span>   'mu4e-alert
                  <span style="font-weight: bold;">:style</span>  'fringe)
  (alert-add-rule <span style="font-weight: bold;">:status</span> '(buried)
                  <span style="font-weight: bold;">:mode</span>   'dired-mode
                  <span style="font-weight: bold;">:style</span>  'fringe)
  (alert-add-rule <span style="font-weight: bold;">:status</span> '(buried)
                  <span style="font-weight: bold;">:mode</span>   'org-mode
                  <span style="font-weight: bold;">:style</span>  'libnotify))
</pre>
</div>
</div>
</li>

<li><a id="orgc7caa5c"></a>ts&#xa0;&#xa0;&#xa0;<span class="tag"><span class="lisp">lisp</span>&#xa0;<span class="calendar">calendar</span></span><br />
<div class="outline-text-6" id="text-orgc7caa5c">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-ts"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package ts)
</pre>
</div>
</div>
</li>

<li><a id="org2e411dc"></a>app-launcher<br />
<div class="outline-text-6" id="text-org2e411dc">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-app-launcher"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package app-launcher
  <span style="font-weight: bold;">:after</span> my-launch-app
  <span style="font-weight: bold;">:bind</span> (<span style="font-weight: bold;">:map</span> my/launch-app-map
              (<span style="font-style: italic;">"a"</span> . app-launcher-run-app)))
</pre>
</div>
</div>
</li>

<li><a id="org8a45450"></a>tldr&#xa0;&#xa0;&#xa0;<span class="tag"><span class="tools">tools</span>&#xa0;<span class="docs">docs</span></span><br />
<div class="outline-text-6" id="text-org8a45450">
<p>
I ran into a problem with downloading TL;DR document. I forcibly download, uncompress and locate that to `tldr-directory-path'.
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-tldr"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package tldr
  <span style="font-weight: bold;">:commands</span> tldr
  <span style="font-weight: bold;">:custom</span>
  (tldr-use-word-at-point t))
</pre>
</div>
</div>
</li>

<li><a id="org9396fd7"></a>burly&#xa0;&#xa0;&#xa0;<span class="tag"><span class="convenience">convenience</span></span><br />
<div class="outline-text-6" id="text-org9396fd7">
<p>
<a href="https://github.com/alphapapa/burly.el">Burly.el</a> is capable of saving and opening Emacs frames and windows by describing them as URL which can be stored in bookmark. You can use Burly as a lightweight workspace tool.
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-burly"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">burly</span>)
</pre>
</div>
</div>
</li>
<li><a id="orga620b26"></a>tempel&#xa0;&#xa0;&#xa0;<span class="tag"><span class="wp">wp</span>&#xa0;<span class="tools">tools</span>&#xa0;<span class="languages">languages</span>&#xa0;<span class="abbrev">abbrev</span></span><br />
<div class="outline-text-6" id="text-orga620b26">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-tempel"</span>
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">"emacs-tempel-collection"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp" id="orgca4a9ab">(use-package tempel
  <span style="font-weight: bold;">:bind</span> ((<span style="font-style: italic;">"M-+"</span> . tempel-complete) <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Alternative tempel-expand</span>
         (<span style="font-style: italic;">"M-_"</span> . tempel-insert))
  <span style="font-weight: bold;">:hook</span>
  ((conf-mode prog-mode text-mode minibuffer-mode) . tempel-setup-capf)
  (mu4e-compose-mode . tempel-abbrev-mode)
  <span style="font-weight: bold;">:preface</span>
  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">tempel-setup-capf</span> ()
    (<span style="font-weight: bold;">setq-local</span> completion-at-point-functions
                (cons #'tempel-expand
                      completion-at-point-functions)))
  <span style="font-weight: bold;">:custom</span>
  (tempel-path (list (no-littering-expand-var-file-name <span style="font-style: italic;">"tempel/templates/*.eld"</span>)
                     (no-littering-expand-var-file-name <span style="font-style: italic;">"tempel/templates/*/*.eld"</span>)))
  <span style="font-weight: bold;">:config</span>
  (bind-keys <span style="font-weight: bold;">:map</span> tempel-map
             (<span style="font-style: italic;">"TAB"</span> . tempel-next)
             (<span style="font-style: italic;">"M-TAB"</span> . tempel-previous)
             (<span style="font-style: italic;">"C-&gt;"</span> . tempel-next)
             (<span style="font-style: italic;">"C-&lt;"</span> . tempel-previous))
  (<span style="font-weight: bold;">with-eval-after-load</span> 'cape
    (bind-keys <span style="font-weight: bold;">:map</span> my/cape-map
               (<span style="font-style: italic;">"t"</span> . tempel-expand))))

(use-package tempel-collection
  <span style="font-weight: bold;">:ensure</span> t
  <span style="font-weight: bold;">:after</span> tempel)
</pre>
</div>
</div>
</li>
<li><a id="org660a963"></a>literate calc mode&#xa0;&#xa0;&#xa0;<span class="tag"><span class="tools">tools</span>&#xa0;<span class="languages">languages</span>&#xa0;<span class="calc">calc</span></span><br />
<div class="outline-text-6" id="text-org660a963">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-literate-calc-mode"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package literate-calc-mode
  <span style="font-weight: bold;">:bind</span> (<span style="font-style: italic;">"C-c M-="</span> . literate-calc-mode))
</pre>
</div>
</div>
</li>

<li><a id="org44ae5f3"></a>git-link<br />
<div class="outline-text-6" id="text-org44ae5f3">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-git-link"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package git-link)
</pre>
</div>
</div>
</li>

<li><a id="org6bf3916"></a>jinx<br />
<div class="outline-text-6" id="text-org6bf3916">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-jinx"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package jinx
  <span style="font-weight: bold;">:bind</span> ((<span style="font-style: italic;">"M-$"</span> . jinx-correct)
         (<span style="font-style: italic;">"C-M-$"</span> . jinx-languages))
  <span style="font-weight: bold;">:hook</span> (org-src-mode . (<span style="font-weight: bold;">lambda</span> ()
                          (<span style="font-weight: bold;">when</span> (derived-mode-p 'text-mode)
                            (jinx-mode 1))))
  <span style="font-weight: bold;">:config</span>
  (bind-keys <span style="font-weight: bold;">:map</span> jinx-mode-map
             (<span style="font-style: italic;">"M-n"</span> . jinx-next)
             (<span style="font-style: italic;">"M-p"</span> . jinx-previous)))
</pre>
</div>
</div>
</li>
<li><a id="org58d2214"></a>simple-httpd<br />
<div class="outline-text-6" id="text-org58d2214">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-simple-httpd"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package simple-httpd
  <span style="font-weight: bold;">:commands</span> (httpd-start httpd-serve-directory))
</pre>
</div>
</div>
</li>

<li><a id="orgdc08e68"></a>logos<br />
<div class="outline-text-6" id="text-orgdc08e68">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-logos"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp" id="orgaab25ce">(use-package logos
  <span style="font-weight: bold;">:bind</span> ((<span style="font-style: italic;">"H-;"</span> . logos-focus-mode)
         (<span style="font-style: italic;">"H-n"</span> . logos-narrow-dwim)
         <span style="font-weight: bold;">:map</span> logos-focus-mode-map
         <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">for left hand</span>
         (<span style="font-style: italic;">"f"</span> . scroll-up-line)
         (<span style="font-style: italic;">"e"</span> . scroll-down-line)
         (<span style="font-style: italic;">"SPC"</span> . my/forward-paragraph)
         (<span style="font-style: italic;">"E"</span> . my/backward-paragraph))
  <span style="font-weight: bold;">:hook</span> ((help-mode helpful-mode Info-mode eww-mode nov-mode mu4e-view-mode
                    woman-mode mastodon-mode Custom-mode devdocs-mode)
         . logos-focus-mode)
  <span style="font-weight: bold;">:custom</span>
  (logos-scroll-lock nil)
  (logos-variable-pitch nil)
  (logos-hide-cursor nil)
  (logos-hide-mode-line t)
  (logos-hide-buffer-boundaries t)
  (logos-buffer-read-only t)
  (logos-olivetti nil)
  (logos-hide-fringe t)
  <span style="font-weight: bold;">:preface</span>
  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/forward-paragraph</span> ()
    (<span style="font-weight: bold;">interactive</span>)
    (forward-paragraph 2)
    (backward-paragraph 1)
    (forward-line 1)
    (recenter-top-bottom 0))
  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/backward-paragraph</span> ()
    (<span style="font-weight: bold;">interactive</span>)
    (backward-paragraph 2)
    (forward-paragraph 1)
    (backward-paragraph 1)
    (forward-line 1)
    (recenter-top-bottom 0)))
</pre>
</div>
</div>
</li>

<li><a id="org4f0c540"></a>editorconfig<br />
<div class="outline-text-6" id="text-org4f0c540">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-editorconfig"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package editorconfig)
</pre>
</div>
</div>
</li>

<li><a id="org4737528"></a>elisp-demos<br />
<div class="outline-text-6" id="text-org4737528">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-elisp-demos"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package elisp-demos
  <span style="font-weight: bold;">:bind</span> (<span style="font-weight: bold;">:map</span> help-map
              (<span style="font-style: italic;">"O"</span> . elisp-demos-find-demo))
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">helpful</span>)
  (bind-keys <span style="font-weight: bold;">:map</span> helpful-mode-map
             (<span style="font-style: italic;">"O"</span> . elisp-demos-for-helpful)))
</pre>
</div>
</div>
</li>

<li><a id="org32ee19c"></a>yeetube<br />
<div class="outline-text-6" id="text-org32ee19c">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-yeetube"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp" id="orge608b20">(use-package yeetube
  <span style="font-weight: bold;">:after</span> engine-mode
  <span style="font-weight: bold;">:bind</span> (<span style="font-weight: bold;">:map</span> engine-mode-prefixed-map
              (<span style="font-style: italic;">"Y"</span> . yeetube-search))
  <span style="font-weight: bold;">:custom</span>
  (yeetube-download-directory <span style="font-style: italic;">"&lt;&lt;media-dir()&gt;&gt;"</span>)
  (yeetube-default-sort-column <span style="font-style: italic;">"Date"</span>)
  <span style="font-weight: bold;">:config</span>
  (keymap-set yeetube-mode-map <span style="font-style: italic;">"Y"</span>
              (<span style="font-weight: bold;">lambda</span> () (<span style="font-weight: bold;">interactive</span>)
                <span style="font-style: italic;">"Dwonload a video at point using `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">yt-dlp-dispatch-dwim</span><span style="font-style: italic;">'"</span>
                (yt-dlp-dispatch-dwim (yeetube-get-url))))
  (keymap-set yeetube-mode-map <span style="font-style: italic;">"P"</span>
              (<span style="font-weight: bold;">lambda</span> () (<span style="font-weight: bold;">interactive</span>)
                <span style="font-style: italic;">"Play a video at point using `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">yt-dlp-dispatch-dwim</span><span style="font-style: italic;">'"</span>
                (yt-dlp-dispatch-dwim (yeetube-get-url) nil nil t)
                (dispatch-execute-macro))))
</pre>
</div>
</div>
</li>

<li><a id="org31e00a5"></a>consult-notes&#xa0;&#xa0;&#xa0;<span class="tag"><span class="wp">wp</span>&#xa0;<span class="convenience">convenience</span>&#xa0;<span class="ARCHIVE">ARCHIVE</span></span><br /></li>

<li><a id="orgec972a1"></a>gnuplot<br />
<div class="outline-text-6" id="text-orgec972a1">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"gnuplot"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-gnuplot"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package gnuplot
  <span style="font-weight: bold;">:hook</span>
  (gnuplot-mode . (<span style="font-weight: bold;">lambda</span> ()
                    (<span style="font-weight: bold;">setq-local</span> devdocs-current-docs '(<span style="font-style: italic;">"gnuplot"</span>)))))
</pre>
</div>
</div>
</li>

<li><a id="orgb685cf8"></a>treesit-auto<br />
<div class="outline-text-6" id="text-orgb685cf8">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package treesit-auto
  <span style="font-weight: bold;">:ensure</span> t
  <span style="font-weight: bold;">:config</span>
  (treesit-auto-add-to-auto-mode-alist 'all))
</pre>
</div>
</div>
</li>

<li><a id="org0ce9acb"></a>devdocs<br />
<div class="outline-text-6" id="text-org0ce9acb">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-devdocs"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package devdocs
  <span style="font-weight: bold;">:bind</span> (<span style="font-weight: bold;">:map</span> help-map
              (<span style="font-style: italic;">"M-d"</span> . devdocs-lookup)))
</pre>
</div>
</div>
</li>

<li><a id="orgec22b77"></a>unfill<br />
<div class="outline-text-6" id="text-orgec22b77">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-unfill"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package unfill
  <span style="font-weight: bold;">:bind</span> (<span style="font-style: italic;">"M-Q"</span> . unfill-toggle))
</pre>
</div>
</div>
</li>
</ul>
</li>
</ul>
</div>

<div id="outline-container-org1bf5744" class="outline-4">
<h4 id="org1bf5744">further extension</h4>
<div class="outline-text-4" id="text-org1bf5744">
</div>

<ul class="org-ul">
<li><a id="orgdad94aa"></a>utility macros/functions<br />
<div class="outline-text-5" id="text-orgdad94aa">
</div>

<ul class="org-ul">
<li><a id="org168f175"></a>lambda key<br />
<div class="outline-text-6" id="text-org168f175">
<p>
<a href="https://www.emacswiki.org/emacs/DocumentingKeyBindingToLambda">lambda-key</a> is nice idea to remedy lambda bindings with define-key.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">lambda-key</span> (keymap key def)
  <span style="font-style: italic;">"Wrap`</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">define-key</span><span style="font-style: italic;">' to provide documentation."</span>
  (set 'sym (make-symbol (documentation def)))
  (fset sym def)
  (keymap-set keymap key sym))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp" id="org3cbe9fa">(lambda-key <span style="font-style: italic;">"(lambda-key "</span> (p <span style="font-style: italic;">"keymap"</span>) <span style="font-style: italic;">" \""</span> (p <span style="font-style: italic;">"key"</span>) <span style="font-style: italic;">"\""</span> n&gt;
            <span style="font-style: italic;">"(lambda () \""</span> (p <span style="font-style: italic;">"desc"</span>) <span style="font-style: italic;">"\""</span> n&gt; <span style="font-style: italic;">"(interactive)"</span> n&gt;
            p <span style="font-style: italic;">"))"</span>)
</pre>
</div>
</div>
</li>

<li><a id="org129d5eb"></a>computational<br />
<div class="outline-text-6" id="text-org129d5eb">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/combinations</span> (list)
  <span style="font-style: italic;">"Return all combinations for all elements in LIST."</span>
  (<span style="font-weight: bold;">if</span> (null list)
      (list nil)
    (<span style="font-weight: bold;">let</span> ((rest-combs (my/combinations (cdr list))))
      (append (mapcar (<span style="font-weight: bold;">lambda</span> (combination) (cons (car list) combination))
                      rest-combs)
              rest-combs))))
</pre>
</div>
</div>
</li>

<li><a id="orgc08e147"></a>copy line number in kill ring<br />
<div class="outline-text-6" id="text-orgc08e147">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/copy-line-number</span> ()
  <span style="font-style: italic;">"Copy the line number of current point into the kill ring."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">let</span> ((line-number (number-to-string (line-number-at-pos))))
    (message <span style="font-style: italic;">"Line number: %s"</span> line-number)
    (kill-new line-number)))
(global-set-key (kbd <span style="font-style: italic;">"C-M-S-w"</span>) 'my/copy-line-number)
</pre>
</div>
</div>
</li>

<li><a id="org0794790"></a>expand shorthand time string<br />
<div class="outline-text-6" id="text-org0794790">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/expand-shorthand-time</span> (time-string)
  <span style="font-style: italic;">"Expand shorthand expressions in TIME-STRING."</span>
  (<span style="font-weight: bold;">let</span> ((case-fold-search nil))
    (<span style="font-weight: bold;">rx-let</span> ((follow-digit (char)
                           (: (group (+ digit)) (* space) char
                              (group (<span style="font-weight: bold;">or</span> eol (not alpha))))))
      (seq-reduce (<span style="font-weight: bold;">lambda</span> (result element)
                    (replace-regexp-in-string (car element) (cadr element) result))
                  `((,(<span style="font-weight: bold;">rx</span> (follow-digit <span style="font-style: italic;">"y"</span>)) <span style="font-style: italic;">"\\1year\\2"</span>)
                    (,(<span style="font-weight: bold;">rx</span> (follow-digit <span style="font-style: italic;">"M"</span>)) <span style="font-style: italic;">"\\1month\\2"</span>)
                    (,(<span style="font-weight: bold;">rx</span> (follow-digit <span style="font-style: italic;">"w"</span>)) <span style="font-style: italic;">"\\1week\\2"</span>)
                    (,(<span style="font-weight: bold;">rx</span> (follow-digit <span style="font-style: italic;">"d"</span>)) <span style="font-style: italic;">"\\1day\\2"</span>)
                    (,(<span style="font-weight: bold;">rx</span> (follow-digit <span style="font-style: italic;">"h"</span>)) <span style="font-style: italic;">"\\1hour\\2"</span>)
                    (,(<span style="font-weight: bold;">rx</span> (follow-digit <span style="font-style: italic;">"m"</span>)) <span style="font-style: italic;">"\\1minute\\2"</span>)
                    (,(<span style="font-weight: bold;">rx</span> (follow-digit <span style="font-style: italic;">"s"</span>)) <span style="font-style: italic;">"\\1second\\2"</span>))
                  time-string))))
</pre>
</div>

<p>
unit test
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">ert-deftest</span> <span style="font-weight: bold;">test/expand-shorthand-time</span> ()
  <span style="font-style: italic;">"Tests the output string of `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">my/expand-shorthand-time</span><span style="font-style: italic;">'."</span>
  (should (string= (my/expand-shorthand-time <span style="font-style: italic;">"1m"</span>)
                   <span style="font-style: italic;">"1minute"</span>))
  (should (string= (my/expand-shorthand-time <span style="font-style: italic;">"1m 20s"</span>)
                   <span style="font-style: italic;">"1minute 20second"</span>))
  (should (string= (my/expand-shorthand-time <span style="font-style: italic;">" 2h10m "</span>)
                   <span style="font-style: italic;">" 2hour10minute "</span>)))
</pre>
</div>
</div>
</li>

<li><a id="org10ebfd0"></a>org link at point map<br />
<div class="outline-text-6" id="text-org10ebfd0">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">org-link-at-point-map</span> (<span style="font-weight: bold;">function</span>)
  <span style="font-style: italic;">"Call `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">FUNCTION</span><span style="font-style: italic;">' with url and title obtained from org-link at point."</span>
  (<span style="font-weight: bold;">let*</span> ((context (org-element-lineage
                   (org-element-context)
                   '(link)
                   t))
         (type (org-element-property <span style="font-weight: bold;">:type</span> context))
         (path (org-element-property <span style="font-weight: bold;">:path</span> context))
         (desc (<span style="font-weight: bold;">when-let</span> ((begin (org-element-property <span style="font-weight: bold;">:contents-begin</span> context))
                          (end (org-element-property <span style="font-weight: bold;">:contents-end</span> context)))
                 (buffer-substring begin end))))
    (<span style="font-weight: bold;">cond</span>
     ((string-match-p <span style="font-style: italic;">"https?"</span> type)
      (funcall function (org-link-unescape (concat type <span style="font-style: italic;">":"</span> path)) desc))
     ((string-match-p <span style="font-style: italic;">"elfeed"</span> type)
      (<span style="font-weight: bold;">save-excursion</span>
        (org-open-at-point)
        (<span style="font-weight: bold;">when</span> (eq major-mode 'elfeed-show-mode)
          (<span style="font-weight: bold;">when-let</span> ((url (<span style="font-weight: bold;">or</span> (caar (elfeed-entry-enclosures elfeed-show-entry))
                              (elfeed-entry-link elfeed-show-entry)))
                     (title (elfeed-entry-title elfeed-show-entry)))
            (funcall function url title))
          (quit-window)))))))
</pre>
</div>
</div>
</li>

<li><a id="org445b2cb"></a>play sound<br />
<div class="outline-text-6" id="text-org445b2cb">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"mpg321"</span>
<span style="font-style: italic;">"vorbis-tools"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/play-sound</span> (sound-file <span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> background-p)
  <span style="font-style: italic;">"Play SOUND-FILE.</span>

<span style="font-style: italic;">The job is executed in the background if BACKGROUND-P is non-nil."</span>
  (call-process-shell-command
   (concat
    (mapconcat #'shell-quote-argument
               (list (<span style="font-weight: bold;">cond</span>
                      ((string-suffix-p <span style="font-style: italic;">".mp3"</span> sound-file)
                       <span style="font-style: italic;">"mpg321"</span>)
                      ((string-suffix-p <span style="font-style: italic;">".oga"</span> sound-file)
                       <span style="font-style: italic;">"ogg123"</span>)
                      (t
                       <span style="font-style: italic;">"mpv --no-config"</span>))
                     sound-file)
               <span style="font-style: italic;">" "</span>)
    (<span style="font-weight: bold;">when</span> background-p <span style="font-style: italic;">"&amp;"</span>))))
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="orgb1d2147"></a>patches and workarounds<br />
<div class="outline-text-5" id="text-orgb1d2147">
</div>

<ul class="org-ul">
<li><a id="org2b0fb2d"></a>disable external IME (fcitx)<br />
<div class="outline-text-6" id="text-org2b0fb2d">
<p>
As of 28.1, Emacs won't steal keyboard focus at startup which means we can use external input methods. But I'm confortable with shutting out external IM, fcitx in my case. Restarting fcitx makes my desire come true.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(add-hook 'emacs-startup-hook
          (<span style="font-weight: bold;">lambda</span> ()
            (call-process-shell-command <span style="font-style: italic;">"fcitx -r"</span>)))
</pre>
</div>
</div>
</li>

<li><a id="org03561d6"></a>ddskk corsor color malfunction in Emacs 28 and later<br />
<div class="outline-text-6" id="text-org03561d6">
<p>
<a href="https://github.com/skk-dev/ddskk/issues/190">Cursor colour no longer changes to match hiragana/katakana mode. · Issue #190 · skk-dev/ddskk · GitHub</a>
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">facemenu</span>)
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="org7a51ce6"></a>repeat maps<br />
<div class="outline-text-5" id="text-org7a51ce6">
</div>

<ul class="org-ul">
<li><a id="orgfdb8490"></a>dired subdir repeat map<br />
<div class="outline-text-6" id="text-orgfdb8490">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">with-eval-after-load</span> 'dired
  (defvar-keymap my/dired-subdir-map
    <span style="font-weight: bold;">:doc</span> <span style="font-style: italic;">"Keymap to repeat commands on dired-subdir."</span>
    <span style="font-weight: bold;">:repeat</span> (<span style="font-weight: bold;">:enter</span> (dired-next-subdir
                     dired-prev-subdir
                     dired-goto-subdir)
                    <span style="font-weight: bold;">:exit</span> (dired-kill-subdir
                           dired-open-subdir))
    <span style="font-style: italic;">"n"</span> #'dired-next-subdir
    <span style="font-style: italic;">"p"</span> #'dired-prev-subdir
    <span style="font-style: italic;">"k"</span> #'dired-kill-subdir
    <span style="font-style: italic;">"g"</span> #'dired-goto-subdir
    <span style="font-style: italic;">"TAB"</span> #'dired-hide-subdir
    <span style="font-style: italic;">"RET"</span> #'dired-open-subdir))
</pre>
</div>
</div>
</li>

<li><a id="orga0ac1c8"></a>visual cycling repeat map<br />
<div class="outline-text-6" id="text-orga0ac1c8">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package emacs
  <span style="font-weight: bold;">:no-require</span> t
  <span style="font-weight: bold;">:bind-keymap</span>
  (<span style="font-style: italic;">"H-c"</span> . my/cycle-visual-repeat-map)
  <span style="font-weight: bold;">:preface</span>
  (defvar-keymap my/cycle-visual-repeat-map
    <span style="font-weight: bold;">:doc</span> <span style="font-style: italic;">"Keymap to repeat toggle/cycling appearance.  Used in `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">repeat-mode</span><span style="font-style: italic;">'."</span>
    <span style="font-weight: bold;">:repeat</span> t
    <span style="font-style: italic;">"#"</span> #'display-line-numbers-mode
    <span style="font-style: italic;">"SPC"</span> #'cycle-spacing
    <span style="font-style: italic;">"V"</span> #'visual-line-mode
    <span style="font-style: italic;">"F"</span> #'toggle-frame-fullscreen
    <span style="font-style: italic;">"P"</span> #'variable-pitch-mode
    <span style="font-style: italic;">"L"</span> #'line-number-mode
    <span style="font-style: italic;">"C"</span> #'column-number-mode
    <span style="font-style: italic;">"R"</span> #'rainbow-mode
    <span style="font-style: italic;">"TAB"</span> #'adaptive-wrap-prefix-mode
    <span style="font-style: italic;">"+"</span> #'text-scale-adjust
    <span style="font-style: italic;">"-"</span> #'text-scale-adjust
    <span style="font-style: italic;">"0"</span> (<span style="font-weight: bold;">lambda</span> () <span style="font-style: italic;">"Set text scale to default level."</span> (<span style="font-weight: bold;">interactive</span>)
          (text-scale-set 0))))
</pre>
</div>
</div>
</li>

<li><a id="orgd0e20d5"></a>frame repeat map<br />
<div class="outline-text-6" id="text-orgd0e20d5">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(defvar-keymap my/frame-repeat-map
  <span style="font-weight: bold;">:doc</span> <span style="font-style: italic;">"Keymap to repeat frame commands.  Used in `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">repeat-mode</span><span style="font-style: italic;">'."</span>
  <span style="font-weight: bold;">:repeat</span> (<span style="font-weight: bold;">:enter</span> (other-frame))
  <span style="font-style: italic;">"o"</span> #'other-frame
  <span style="font-style: italic;">"0"</span> #'delete-frame
  <span style="font-style: italic;">"1"</span> #'delete-other-frames
  <span style="font-style: italic;">"2"</span> #'make-frame-command
  <span style="font-style: italic;">"5"</span> #'other-frame-prefix
  <span style="font-style: italic;">"B"</span> #'bookmark-jump-other-frame
  <span style="font-style: italic;">"p"</span> #'project-other-frame-command
  <span style="font-style: italic;">"D"</span> #'dired-other-frame
  <span style="font-style: italic;">"m"</span> #'compose-mail-other-frame)
</pre>
</div>
</div>
</li>

<li><a id="org16c2817"></a>delete repeat map<br />
<div class="outline-text-6" id="text-org16c2817">
<p>
Suport successive deletion with C-h/M-h
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/delete-char-dwim</span> ()
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">if</span> (eq major-mode 'org-mode)
      (org-delete-char 1)
    (delete-char 1)))
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/delete-backward-char-dwim</span> ()
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">if</span> (eq major-mode 'org-mode)
      (org-delete-backward-char 1)
    (delete-backward-char 1)))
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/kill-word-dwim</span> ()
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">if</span> jaword-mode
      (jaword-kill 1)
    (kill-word 1)))
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/backward-kill-word-dwim</span> ()
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">if</span> jaword-mode
      (jaword-kill -1)
    (backward-kill-word 1)))

(defvar-keymap my/delete-repeat-map
  <span style="font-weight: bold;">:doc</span> <span style="font-style: italic;">"Keymap to repeat deletion commands.  Used in `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">repeat-mode</span><span style="font-style: italic;">'."</span>
  <span style="font-weight: bold;">:repeat</span> (<span style="font-weight: bold;">:enter</span> (delete-char
                   org-delete-char
                   kill-word
                   jaword-kill
                   my/delete-char-dwim
                   my/delete-backward-char-dwim
                   my/kill-word-dwim
                   my/backward-kill-word-dwim))
  <span style="font-style: italic;">"C-d"</span> #'my/delete-char-dwim
  <span style="font-style: italic;">"C-h"</span> #'my/delete-backward-char-dwim
  <span style="font-style: italic;">"M-d"</span> #'my/kill-word-dwim
  <span style="font-style: italic;">"M-h"</span> #'my/backward-kill-word-dwim)
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="org7794012"></a>tailored commands/functions<br />
<div class="outline-text-5" id="text-org7794012">
</div>

<ul class="org-ul">
<li><a id="orgce003e5"></a>update elfeed feeds automatically<br />
<div class="outline-text-6" id="text-orgce003e5">
<p>
elfeed-update will run at morning everyday
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/elfeed-update</span> ()
  <span style="font-style: italic;">"Update Elfeed feeds."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (elfeed)
  (elfeed-db-compact)
  (elfeed-update)
  (<span style="font-weight: bold;">when</span> (eq major-mode 'elfeed-search-mode)
    (elfeed-kill-buffer)))

(<span style="font-weight: bold;">with-eval-after-load</span> 'midnight
  (add-hook 'midnight-hook #'my/elfeed-update))
</pre>
</div>
</div>
</li>

<li><a id="org74c2988"></a>frame maximization<br />
<div class="outline-text-6" id="text-org74c2988">
<p>
Every frame will be spawn in maximized and initial frame will be full screen at Emacs start-up time.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package frame
  <span style="font-weight: bold;">:if</span> (member (window-system) '(x ns w32))
  <span style="font-weight: bold;">:init</span>
  (add-to-list 'after-make-frame-functions
               (<span style="font-weight: bold;">lambda</span> (frame) (set-frame-parameter frame 'fullscreen 'maximized)))
  <span style="font-weight: bold;">:hook</span>
  (after-init . (<span style="font-weight: bold;">lambda</span> () (set-frame-parameter nil 'fullscreen 'fullboth))))
</pre>
</div>
</div>
</li>

<li><a id="org5f30252"></a>prune old .eln files at shut down&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span><br /></li>

<li><a id="org35e27d1"></a>operate the number at point<br />
<div class="outline-text-6" id="text-org35e27d1">
<p>
<a href="https://www.emacswiki.org/emacs/IncrementNumber">EmacsWiki: Increment Number</a>
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defmacro</span> <span style="font-weight: bold;">my/operate-number</span> (operation)
  `(<span style="font-weight: bold;">save-excursion</span>
     (<span style="font-weight: bold;">save-restriction</span>
       (<span style="font-weight: bold;">when</span> (use-region-p)
         (narrow-to-region (region-beginning) (region-end)))
       (skip-chars-backward <span style="font-style: italic;">"0-9"</span>)
       (skip-chars-forward <span style="font-style: italic;">"0"</span>)
       (<span style="font-weight: bold;">or</span> (looking-at <span style="font-style: italic;">"[0-9]+"</span>)
           (<span style="font-weight: bold;">error</span> <span style="font-style: italic;">"No number at point"</span>))
       (replace-match (number-to-string
                       (apply ,operation (list (string-to-number (match-string 0)))))))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/increment-number-at-point</span> ()
  <span style="font-style: italic;">"Increment the number at point.</span>

<span style="font-style: italic;">If there is a region which embrace a number, that number will be</span>
<span style="font-style: italic;">incremented instead."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (my/operate-number #'1+))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/decrement-number-at-point</span> ()
  <span style="font-style: italic;">"Decrement the number at point.</span>

<span style="font-style: italic;">If there is a region which embrace a number, that number will be</span>
<span style="font-style: italic;">decremented instead."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (my/operate-number #'1-))

(global-set-key (kbd <span style="font-style: italic;">"C-x &lt;up&gt;"</span>) #'my/increment-number-at-point)
(global-set-key (kbd <span style="font-style: italic;">"C-x &lt;down&gt;"</span>) #'my/decrement-number-at-point)
(defvar-keymap my/operate-number-repeat-map
  <span style="font-weight: bold;">:doc</span> <span style="font-style: italic;">"Keymap to repeat operating a number."</span>
  <span style="font-weight: bold;">:repeat</span> (<span style="font-weight: bold;">:enter</span> (my/increment-number-at-point
                   my/decrement-number-at-point))
  <span style="font-style: italic;">"&lt;up&gt;"</span> #'my/increment-number-at-point
  <span style="font-style: italic;">"&lt;down&gt;"</span> #'my/decrement-number-at-point)
</pre>
</div>
</div>
</li>

<li><a id="orgfc21ecd"></a>edit local file as root (sudo)<br />
<div class="outline-text-6" id="text-orgfc21ecd">
<p>
my/sudo-edit-local-file is inspired by <a href="https://emacsredux.com/blog/2013/04/21/edit-files-as-root/">this thisblog post</a>.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/sudo-edit-local-file</span> ()
  <span style="font-style: italic;">"Reopen the current buffer file with root privileges."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">when</span> (file-exists-p buffer-file-name)
    (find-alternate-file
     (concat <span style="font-style: italic;">"/sudo:root@localhost:"</span>
             buffer-file-name))))

(global-set-key (kbd <span style="font-style: italic;">"C-x C-#"</span>) #'my/sudo-edit-local-file)
</pre>
</div>
</div>
</li>

<li><a id="org071b837"></a>power management<br />
<div class="outline-text-6" id="text-org071b837">
<p>
Shut down emacs automatically when remaining power of laptop PC lower than <a href="battery-load-low">battery-load-low</a>
to avoid accidental data loss.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">battery</span>)

(run-with-timer 60 60 #'kill-emacs-auto)

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">kill-emacs-auto</span> ()
  <span style="font-style: italic;">"Kill Emacs if remaining machine power lower than `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">battery-load-low</span><span style="font-style: italic;">'."</span>
  (<span style="font-weight: bold;">when-let*</span> ((data (<span style="font-weight: bold;">and</span> battery-status-function (funcall battery-status-function)))
              (percentage (car (read-from-string (cdr (assq ?p data)))))
              (power (cdr (assq ?L data))))
    (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">and</span> (numberp percentage)
               (&lt; percentage battery-load-low)
               (stringp power)
               (string= power <span style="font-style: italic;">"BAT"</span>))
      (save-buffers-kill-emacs t))))
</pre>
</div>
</div>
</li>

<li><a id="org9388351"></a>lazy viewing&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span><br /></li>

<li><a id="orge6b345a"></a>lookup functions&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span><br /></li>

<li><a id="org2dd5f01"></a>tldr<br />
<div class="outline-text-6" id="text-org2dd5f01">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/tldr</span> (command)
  <span style="font-style: italic;">"Show the output of tldr for COMMAND in a dedicated buffer."</span>
  (<span style="font-weight: bold;">interactive</span> (list (read-string <span style="font-style: italic;">"Coomand: "</span>)))
  (<span style="font-weight: bold;">let*</span> ((buf-name <span style="font-style: italic;">"*TL;DR*"</span>)
         (buffer (get-buffer-create buf-name)))
    (<span style="font-weight: bold;">with-current-buffer</span> buffer
      (read-only-mode -1)
      (erase-buffer)
      (insert (shell-command-to-string (format <span style="font-style: italic;">"tldr %s"</span>
                                               (shell-quote-argument command))))
      (ansi-color-apply-on-region (point-min) (point-max))
      (goto-char (point-min))
      (read-only-mode 1))
    (display-buffer buffer '((display-buffer-pop-up-window)
                             . ((window-height . 8))))
    (switch-to-buffer-other-window buffer)))
</pre>
</div>
</div>
</li>

<li><a id="org9605b98"></a>download media file&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span><br /></li>

<li><a id="org5595832"></a>text to speech<br />
<div class="outline-text-6" id="text-org5595832">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defcustom</span> <span style="font-weight: bold; font-style: italic;">my/say-maximum-duration</span> 30
  <span style="font-style: italic;">"Maximum speech duration in second for `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">my/say</span><span style="font-style: italic;">'."</span>)
(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my/say--timer</span> nil <span style="font-style: italic;">"Timer used to cancel speech process."</span>)
(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my/say--open-jtalk-process</span> <span style="font-style: italic;">"Say&lt;Open-JTalk&gt;"</span>
  <span style="font-style: italic;">"Fixed name for a process running Open JTalk."</span>)

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/say</span> (string)
  <span style="font-style: italic;">"Say out `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">STRING</span><span style="font-style: italic;">'.</span>

<span style="font-style: italic;">If an argument is given as `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">STRING</span><span style="font-style: italic;">', speech that text. Otherwise the buffer text</span>
<span style="font-style: italic;"> is spoken unless region is active.</span>

<span style="font-style: italic;">As of now, English and Japanese are supported for speech. Spoken language is</span>
<span style="font-style: italic;"> determined by a string, specifically a string entirely consists of ASCII</span>
<span style="font-style: italic;"> characters is identified as English. Otherwise the string is spoken in Japanese."</span>
  (<span style="font-weight: bold;">interactive</span> (list (<span style="font-weight: bold;">if</span> (region-active-p)
                         (buffer-substring (region-beginning) (region-end))
                       (buffer-string))))
  (<span style="font-weight: bold;">when-let</span> ((fest (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">festival</span> nil t))
             (my/say-lang 'en))
    (<span style="font-weight: bold;">if</span> (string-match-p
         (format <span style="font-style: italic;">"\\`[%s]+\\'"</span> <span style="font-style: italic;">"[:ascii:]&#8217;&#8220;&#8221;&#8211;"</span>) string)
        <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">festival-say-string is unusable if region is active</span>
        (<span style="font-weight: bold;">if</span> (region-active-p)
            (festival-say-region (region-beginning) (region-end))
          (festival-say-string string))
      (my/say--open-jtalk string)
      (<span style="font-weight: bold;">setq</span> my/say-lang 'ja))
    (<span style="font-weight: bold;">setq</span> my/say--timer
          (<span style="font-weight: bold;">cond</span>
           ((eq my/say-lang 'en)
            (run-with-timer my/say-maximum-duration nil
                            (<span style="font-weight: bold;">lambda</span> ()
                              (festival-kill-process)
                              (<span style="font-weight: bold;">setq</span> my/say--timer nil))))
           ((eq my/say-lang 'ja)
            (run-with-timer my/say-maximum-duration nil
                            (<span style="font-weight: bold;">lambda</span> ()
                              (<span style="font-weight: bold;">and</span> (get-process my/say--open-jtalk-process)
                                   (interrupt-process my/say--open-jtalk-process))
                              (<span style="font-weight: bold;">setq</span> my/say--timer nil))))))))
(<span style="font-weight: bold;">with-eval-after-load</span> 'engine-mode
  (keymap-set engine-mode-prefixed-map (kbd <span style="font-style: italic;">"\""</span>)
              #'my/say))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/say-cancel</span> ()
  <span style="font-style: italic;">"Cancel speech process that has started by `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">my/say</span><span style="font-style: italic;">'."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">and</span> (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">festival</span> nil t)
       my/say--timer
       (<span style="font-weight: bold;">progn</span> (cancel-timer my/say--timer)
              (<span style="font-weight: bold;">setq</span> my/say--timer nil)))
  (<span style="font-weight: bold;">if</span> (<span style="font-weight: bold;">and</span> festival-process
           (string= (process-status festival-process)
                    <span style="font-style: italic;">"run"</span>))
      (festival-kill-process)
    (<span style="font-weight: bold;">and</span> (get-process my/say--open-jtalk-process)
         (interrupt-process my/say--open-jtalk-process))))
(global-set-key (kbd <span style="font-style: italic;">"C-x C-\""</span>) #'my/say-cancel)
(<span style="font-weight: bold;">with-eval-after-load</span> 'embark
  (define-key embark-region-map <span style="font-style: italic;">"\""</span> #'my/say))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/say--open-jtalk</span> (text)
  <span style="font-style: italic;">"Speech TEXT in Japanese using Open JTalk."</span>
  (start-process-shell-command
   my/say--open-jtalk-process nil
   (format <span style="font-style: italic;">"echo %s | open_jtalk -x /var/lib/mecab/dic/open-jtalk/naist-jdic -m &lt;&lt;hts-voice-dir()&gt;&gt;/Voice/mei/mei_angry.htsvoice -ow /tmp/a.wav &amp;&amp; aplay /tmp/a.wav"</span>
           (replace-regexp-in-string <span style="font-style: italic;">"[\t\r\n\v\f]+"</span> <span style="font-style: italic;">" "</span> text))))
</pre>
</div>
</div>

<ul class="org-ul">
<li><a id="org7547a05"></a>jsay&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span><br /></li>

<li><a id="orgcd379c8"></a>esay&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span><br /></li>
</ul>
</li>

<li><a id="org043baa2"></a>wrap up launch app commands in single keymap<br />
<div class="outline-text-6" id="text-org043baa2">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(global-set-key (kbd <span style="font-style: italic;">"H-j"</span>)
                (define-keymap
                  <span style="font-weight: bold;">:prefix</span> 'my/launch-app-map
                  <span style="font-style: italic;">"e"</span> #'eshell
                  <span style="font-style: italic;">"v"</span> #'my/multi-vterm
                  <span style="font-style: italic;">"d"</span> #'dired-jump
                  <span style="font-style: italic;">"w"</span> #'eww
                  <span style="font-style: italic;">"m"</span> #'mu4e
                  <span style="font-style: italic;">"p"</span> #'proced
                  <span style="font-style: italic;">"P"</span> #'list-processes
                  <span style="font-style: italic;">"?"</span> #'woman
                  <span style="font-style: italic;">"l"</span> (define-keymap
                        <span style="font-weight: bold;">:prefix</span> 'my/invoke-list-command-map)))

(<span style="font-weight: bold;">provide</span> '<span style="font-weight: bold; text-decoration: underline;">my-launch-app</span>)
</pre>
</div>
</div>
</li>

<li><a id="orgfb5a505"></a>show the day in calendar<br />
<div class="outline-text-6" id="text-orgfb5a505">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/calendar-show-items</span> ()
  <span style="font-style: italic;">"Show items on the day pointed in calendar view."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">let*</span> ((calendar-date-display-form calendar-iso-date-display-form)
         (date (calendar-date-string (calendar-cursor-to-date)))
         (d (parse-time-string date))
         (year (decoded-time-year d))
         (files (file-expand-wildcards (file-name-concat org-directory <span style="font-style: italic;">"archive"</span> <span style="font-style: italic;">"archive_*.org"</span>)))
         (buffer-name-prefix <span style="font-style: italic;">"=="</span>)
         (buffer-name (concat buffer-name-prefix date))
         (display-buffer-alist
          `((,buffer-name-prefix
             (display-buffer-reuse-mode-window
              display-buffer-pop-up-window)))))
    (org-ql-search files `(<span style="font-weight: bold;">and</span> (<span style="font-weight: bold;">or</span> (parent (heading ,date))
                                   (ts-a <span style="font-weight: bold;">:on</span> ,date))
                               (not (tags <span style="font-style: italic;">"web"</span> <span style="font-style: italic;">"drill"</span>)))
      <span style="font-weight: bold;">:buffer</span> buffer-name)
    (other-window 1)))
</pre>
</div>
</div>
</li>

<li><a id="org63033bc"></a>replace regexp with re-builder and query-replace-regexp trick<br />
<div class="outline-text-6" id="text-org63033bc">
<p>
Great idea using re-builder when query-replace-regexp borrowed from <a href="https://karthinks.com/software/bridging-islands-in-emacs-1/">this post</a>.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my/re-builder-positions</span> nil
  <span style="font-style: italic;">"Store point and region bounds before calling re-builder"</span>)

(advice-add 're-builder
            <span style="font-weight: bold;">:before</span>
            (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/re-builder-save-state</span> (<span style="font-weight: bold; text-decoration: underline;">&amp;rest</span> _)
              <span style="font-style: italic;">"Save into `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">my/re-builder-positions</span><span style="font-style: italic;">' the point and region</span>
<span style="font-style: italic;">positions before calling `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">re-builder</span><span style="font-style: italic;">'."</span>
              (<span style="font-weight: bold;">setq</span> my/re-builder-positions
                    (cons (point)
                          (<span style="font-weight: bold;">when</span> (region-active-p)
                            (list (region-beginning)
                                  (region-end)))))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">reb-replace-regexp</span> (<span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> delimited)
  <span style="font-style: italic;">"Run `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">query-replace-regexp</span><span style="font-style: italic;">' with the contents of re-builder. With</span>
<span style="font-style: italic;">non-nil optional argument DELIMITED, only replace matches</span>
<span style="font-style: italic;">surrounded by word boundaries."</span>
  (<span style="font-weight: bold;">interactive</span> <span style="font-style: italic;">"P"</span>)
  (reb-update-regexp)
  (<span style="font-weight: bold;">let*</span> ((re (reb-cook-regexp (reb-read-regexp)))
         (replacement (query-replace-read-to
                       re
                       (concat <span style="font-style: italic;">"Query replace"</span>
                               (<span style="font-weight: bold;">if</span> current-prefix-arg
                                   (<span style="font-weight: bold;">if</span> (eq current-prefix-arg '-) <span style="font-style: italic;">" backward"</span> <span style="font-style: italic;">" word"</span>)
                                 <span style="font-style: italic;">""</span>)
                               <span style="font-style: italic;">" regexp"</span>
                               (<span style="font-weight: bold;">if</span> (<span style="font-weight: bold;">with-selected-window</span> reb-target-window
                                     (region-active-p)) <span style="font-style: italic;">" in region"</span> <span style="font-style: italic;">""</span>))
                       t))
         (pnt (car my/re-builder-positions))
         (beg (cadr my/re-builder-positions))
         (end (caddr my/re-builder-positions)))
    (<span style="font-weight: bold;">with-selected-window</span> reb-target-window
      (goto-char pnt) <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">replace with (goto-char (match-beginning 0)) if you want</span>
                                        <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">to control where in the buffer the replacement starts</span>
                                        <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">with re-builder</span>
      (<span style="font-weight: bold;">setq</span> my/re-builder-positions nil)
      (reb-quit)
      (query-replace-regexp re replacement delimited beg end))))

(define-key reb-mode-map (kbd <span style="font-style: italic;">"RET"</span>) #'reb-replace-regexp)
(define-key reb-lisp-mode-map (kbd <span style="font-style: italic;">"RET"</span>) #'reb-replace-regexp)
(global-set-key (kbd <span style="font-style: italic;">"C-%"</span>) #'re-builder)
</pre>
</div>
</div>
</li>

<li><a id="org7d999ac"></a>mark and open a file in one go in Dired<br />
<div class="outline-text-6" id="text-org7d999ac">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/dired-mark-and-open-file</span> ()
  <span style="font-style: italic;">"Mark file and open it in one go."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">save-excursion</span>
    (dired-mark 1))
  (dired-open-file))

(<span style="font-weight: bold;">with-eval-after-load</span> 'dired
  (keymap-set dired-mode-map <span style="font-style: italic;">"M-RET"</span>
              #'my/dired-mark-and-open-file))
</pre>
</div>
</div>
</li>

<li><a id="orge9e28af"></a>open space<br />
<div class="outline-text-6" id="text-orge9e28af">
<p>
Like C-o (M-x open-line), it is useful open single space ahead of point.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/open-space</span> ()
  <span style="font-style: italic;">"Insert single space ahead of point."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (insert <span style="font-style: italic;">" "</span>)
  (backward-char 1))
(keymap-global-set <span style="font-style: italic;">"M-o"</span> 'my/open-space)
</pre>
</div>
</div>
</li>

<li><a id="orgbc104a6"></a>miscellaneous functions/commands<br />
<div class="outline-text-6" id="text-orgbc104a6">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/insert-time-stamp</span> ()
  <span style="font-style: italic;">"Insert time stamp with preferred format."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (insert
   (completing-read <span style="font-style: italic;">"Format: "</span>
                    (mapcar #'format-time-string
                            '(<span style="font-style: italic;">"%Y%m%d"</span> <span style="font-style: italic;">"%Y-%m-%d"</span> <span style="font-style: italic;">"%Y-%m-%d %H:%M:%S"</span>)))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/drag-line-backward</span> ()
  <span style="font-style: italic;">"Drag up current line for one."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (transpose-lines 1)
  (previous-line 2))
(global-set-key (kbd <span style="font-style: italic;">"M-S-&lt;up&gt;"</span>) 'my/drag-line-backward)

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/drag-line-forward</span> ()
  <span style="font-style: italic;">"Drag down current line for one."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (next-line 1)
  (transpose-lines 1)
  (previous-line 1))
(global-set-key (kbd <span style="font-style: italic;">"M-S-&lt;down&gt;"</span>) 'my/drag-line-forward)

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/comment-box</span> (b e)
  <span style="font-style: italic;">"Draw a box comment around the region but arrange for the region</span>
<span style="font-style: italic;">  to extend to at least the fill column. Place the point after the</span>
<span style="font-style: italic;">  comment box."</span>
  (<span style="font-weight: bold;">interactive</span> <span style="font-style: italic;">"r"</span>)
  (<span style="font-weight: bold;">let</span> ((e (copy-marker e t)))
    (goto-char b)
    (end-of-line)
    (insert-char ?  (- fill-column (current-column)))
    (comment-box b e 1)
    (goto-char e)
    (set-marker e nil)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/ascii-string-p</span> (string)
  <span style="font-style: italic;">"Return non-nil if `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">STRING</span><span style="font-style: italic;">' seems to be made of ASCII."</span>
  (<span style="font-weight: bold;">if</span> (length&gt; string 0)
      (string-match-p
       (format <span style="font-style: italic;">"\\`[%s]+\\'"</span> <span style="font-style: italic;">"[:ascii:]&#8217;&#8220;&#8221;&#8211;"</span>)
       string)
    t))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/file-name-legitimate</span> (filename)
  <span style="font-style: italic;">"Substitute legitimate file name for `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">FILENAME</span><span style="font-style: italic;">' so as not to have any special charactors."</span>
  (seq-reduce (<span style="font-weight: bold;">lambda</span> (takeover replace)
                (replace-regexp-in-string
                 (car replace) (cdr replace) takeover))
              '((<span style="font-style: italic;">"/"</span> . <span style="font-style: italic;">"&#65295;"</span>)
                (<span style="font-style: italic;">"\""</span> . <span style="font-style: italic;">"&#10078;"</span>)
                (<span style="font-style: italic;">"'"</span> . <span style="font-style: italic;">"&#10076;"</span>))
              filename))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/kansuji-to-number</span> (kansuuji-string)
  <span style="font-style: italic;">"Translate Japanese Kansuuji(&#28450;&#25968;&#23383;) KANSUUJI-STRING to number."</span>
  (<span style="font-weight: bold;">let*</span> ((kanji-digits '(?&#19968; ?&#20108; ?&#19977; ?&#22235; ?&#20116; ?&#20845; ?&#19971; ?&#20843; ?&#20061;))
         (kanji-units '((?&#21313; . 10) (?&#30334; . 100) (?&#21315; . 1000)))
         (rs (cl-reduce (<span style="font-weight: bold;">lambda</span> (kansuji val)
                          (<span style="font-weight: bold;">let</span> ((digit (cl-position kansuji kanji-digits))
                                (unit (cdr (assoc kansuji kanji-units))))
                            (<span style="font-weight: bold;">if</span> (&gt; (cdr val) 0)
                                (cons (+ (car val) (* (cdr val)
                                                      (1+ (<span style="font-weight: bold;">or</span> digit 0))))
                                      (<span style="font-weight: bold;">or</span> unit 0))
                              (<span style="font-weight: bold;">cond</span>
                               (digit (cons (+ (1+ digit) (car val)) 0))
                               (unit (cons (car val) unit))))))
                        kansuuji-string
                        <span style="font-weight: bold;">:from-end</span> t <span style="font-weight: bold;">:initial-value</span> (cons 0 0))))
    (+ (car rs) (cdr rs))))
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="orgba0c0c0"></a>literate configuration (this file)<br />
<div class="outline-text-5" id="text-orgba0c0c0">
<p>
Configuration files are generated by tangling org source blocks whenever this file is saved defined in <a href=".dir-locals.el">.dir-locals.el</a>. Following code suppresses confirmation at file saving.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/compile-default-command</span> ()
  <span style="font-style: italic;">"Compile `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">compile-command</span><span style="font-style: italic;">'."</span>
  (<span style="font-weight: bold;">let</span> ((default-directory (project-root (project-current t)))
        (compilation-buffer-name-function
         (<span style="font-weight: bold;">or</span> project-compilation-buffer-name-function
             compilation-buffer-name-function)))
    (funcall #'compile compile-command))
  (quit-window))

(add-to-list 'safe-local-eval-forms
             '(add-hook 'after-save-hook
                        #'my/compile-default-command nil t))
</pre>
</div>
</div>

<ul class="org-ul">
<li><a id="org735a2d2"></a>Variables for tangling<br />
<div class="outline-text-6" id="text-org735a2d2">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">setq</span> tangle/home <span style="font-style: italic;">"~/dotfiles/"</span>)
(<span style="font-weight: bold;">setq</span> tangle/user-emacs-directory (file-name-concat tangle/home <span style="font-style: italic;">".config/emacs"</span>))
(<span style="font-weight: bold;">setq</span> tangle/emacs-sitelisp-dir
      (expand-file-name <span style="font-style: italic;">"site-lisp"</span> tangle/user-emacs-directory))
(<span style="font-weight: bold;">setq</span> tangle/emacs-config-dir
      (expand-file-name <span style="font-style: italic;">"lisp"</span> tangle/user-emacs-directory))
(<span style="font-weight: bold;">setq</span> tangle/emacs-etc-dir
      (expand-file-name <span style="font-style: italic;">"etc"</span> tangle/user-emacs-directory))
(<span style="font-weight: bold;">setq</span> tangle/emacs-var-dir
      (expand-file-name <span style="font-style: italic;">"var"</span> tangle/user-emacs-directory))
(<span style="font-weight: bold;">setq</span> tangle/local-bin-dir
      (expand-file-name <span style="font-style: italic;">".local/bin/"</span> tangle/home))
</pre>
</div>
</div>
</li>

<li><a id="org280f3df"></a>Common Babel Config<br />
<div class="outline-text-6" id="text-org280f3df">
<p>
I'd share this babel config between literate configuration and main Emacs session.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">with-eval-after-load</span> 'ob-core
  (<span style="font-weight: bold;">setq</span> org-babel-noweb-error-all-langs t)
  (setopt org-babel-python-command (executable-find <span style="font-style: italic;">"python3"</span>))
  (setopt org-babel-ruby-command (executable-find <span style="font-style: italic;">"ruby"</span>))
  (setopt org-confirm-babel-evaluate nil)
  (setopt org-babel-load-languages '((shell      . t)
                                     (emacs-lisp . t)
                                     (python     . t)))
  (<span style="font-weight: bold;">setf</span> org-babel-default-header-args
        (append org-babel-default-header-args
                '((<span style="font-weight: bold;">:mkdirp</span> . t)
                  (<span style="font-weight: bold;">:comments</span> . <span style="font-style: italic;">"link"</span>)))))

(<span style="font-weight: bold;">with-eval-after-load</span> 'ob-shell
  (add-to-list 'org-babel-default-header-args:shell
               '(<span style="font-weight: bold;">:shebang</span> . <span style="font-style: italic;">"#!/bin/sh"</span>))
  (add-to-list 'org-babel-default-header-args:shell
               `(<span style="font-weight: bold;">:tangle-mode</span> . ,(identity #o555)))
  (add-to-list 'org-babel-default-header-args:bash
               `(<span style="font-weight: bold;">:tangle-mode</span> . ,(identity #o555)))
  (add-to-list 'org-babel-default-header-args:bash
               '(<span style="font-weight: bold;">:shebang</span> . <span style="font-style: italic;">"#!/usr/bin/env bash\nset -euo pipefail\n"</span>)))

(<span style="font-weight: bold;">with-eval-after-load</span> 'ob-emacs-lisp
  (add-to-list 'org-babel-default-header-args:emacs-lisp
               `(<span style="font-weight: bold;">:tangle-mode</span> . ,(identity #o444))))

(<span style="font-weight: bold;">with-eval-after-load</span> 'ob-python
  (<span style="font-weight: bold;">setf</span> org-babel-default-header-args:python
        (append org-babel-default-header-args:python
                `((<span style="font-weight: bold;">:tangle-mode</span> . ,(identity #o555))
                  (<span style="font-weight: bold;">:shebang</span> . <span style="font-style: italic;">"#!/usr/bin/env python3"</span>)))))

(<span style="font-weight: bold;">with-eval-after-load</span> 'ob-ruby
  (<span style="font-weight: bold;">setf</span> org-babel-default-header-args:ruby
        (append org-babel-default-header-args:ruby
                `((<span style="font-weight: bold;">:tangle-mode</span> . ,(identity #o555))
                  (<span style="font-weight: bold;">:shebang</span> . <span style="font-style: italic;">"#!/usr/bin/env ruby"</span>)))))
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="org10b71f6"></a>custom RX definitions<br />
<div class="outline-text-5" id="text-org10b71f6">
<p>
My RX function 'parened' evaluates 'parened-rx' with reb-target-buffer's syntax table since  working buffer with RX in re-builder is reb-lisp-mode which does not hold same syntax table with target-buffer.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">parened-rx</span> (paren-open-char element)
  `(seq ,paren-open-char
        (group ,element)
        ,(matching-paren paren-open-char)))

(<span style="font-weight: bold;">rx-define</span> parened (paren-open-char element)
  (eval (<span style="font-weight: bold;">with-syntax-table</span> (<span style="font-weight: bold;">cond</span>
                            ((derived-mode-p 'reb-lisp-mode)
                             (<span style="font-weight: bold;">with-current-buffer</span> reb-target-buffer (syntax-table)))
                            ((derived-mode-p 'minibuffer-mode)
                             (<span style="font-weight: bold;">with-current-buffer</span> (other-buffer nil t) (syntax-table)))
                            (t (syntax-table)))
          (parened-rx paren-open-char 'element))))
</pre>
</div>
</div>
</li>

<li><a id="org0ddacb5"></a>dispatch-dwim commands<br />
<div class="outline-text-5" id="text-org0ddacb5">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">dispatch-dwim</span>)

<span style="font-weight: bold; font-style: italic;">;;; </span><span style="font-weight: bold; font-style: italic;">Misc</span>

(<span style="font-weight: bold;">defalias</span> '<span style="font-weight: bold;">dispatch-execute-macro</span> (kmacro <span style="font-style: italic;">"x"</span>))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">dispatch-dwim-select</span> ()
  <span style="font-style: italic;">"Execute dispatch-*-dwim command."</span>
  (<span style="font-weight: bold;">declare</span> (interactive-only command-execute))
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">let</span> ((read-extended-command-predicate
         (<span style="font-weight: bold;">lambda</span> (sym buf)
           (string-match-p (<span style="font-weight: bold;">rx</span> <span style="font-style: italic;">"dispatch-dwim"</span> eos)
                           (symbol-name sym)))))
    (execute-extended-command current-prefix-arg)))
(keymap-global-set <span style="font-style: italic;">"H-D"</span> 'dispatch-dwim-select)
</pre>
</div>
</div>

<ul class="org-ul">
<li><a id="orgddaead2"></a>mpv command<br />
<div class="outline-text-6" id="text-orgddaead2">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(transient-define-prefix mpv-dispatch-dwim (<span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> file no-resume start end)
  <span style="font-style: italic;">""</span>
  <span style="font-weight: bold;">:man-page</span> <span style="font-style: italic;">"mpv"</span>
  [(<span style="font-style: italic;">"-R"</span> <span style="font-style: italic;">"noresume"</span> <span style="font-style: italic;">"--no-resume-playback"</span>
    <span style="font-weight: bold;">:init-value</span> (<span style="font-weight: bold;">lambda</span> (obj) (<span style="font-weight: bold;">oset</span> obj value (<span style="font-weight: bold;">if</span> no-resume <span style="font-style: italic;">"--no-resume-playback"</span> nil))))
   (<span style="font-style: italic;">"-s"</span> <span style="font-style: italic;">"start"</span> <span style="font-style: italic;">"--start="</span> <span style="font-weight: bold;">:prompt</span> <span style="font-style: italic;">"start: "</span>
    <span style="font-weight: bold;">:init-value</span> (<span style="font-weight: bold;">lambda</span> (obj) (<span style="font-weight: bold;">oset</span> obj value start)))
   (<span style="font-style: italic;">"-e"</span> <span style="font-style: italic;">"end"</span> <span style="font-style: italic;">"--end="</span> <span style="font-weight: bold;">:prompt</span> <span style="font-style: italic;">"end: "</span>
    <span style="font-weight: bold;">:init-value</span> (<span style="font-weight: bold;">lambda</span> (obj) (<span style="font-weight: bold;">oset</span> obj value end)))]
  [(dispatch-dwim-execute
    <span style="font-weight: bold;">:command-format</span>
    (format <span style="font-style: italic;">"mpv %%a %s"</span>
            (plist-get (<span style="font-weight: bold;">oref</span> transient-current-prefix scope) 'file)))]
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">setq</span> my/detached-bury-buffer t)
  (transient-setup 'mpv-dispatch-dwim nil nil
                   <span style="font-weight: bold;">:scope</span> (plist-put nil 'file (dispatch-command-dwim/determine-file file))))

(<span style="font-weight: bold;">with-eval-after-load</span> 'embark
  (mapc (<span style="font-weight: bold;">lambda</span> (map)
          (lambda-key map <span style="font-style: italic;">"P"</span>
                      (<span style="font-weight: bold;">lambda</span> (file)
                        <span style="font-style: italic;">"play media FILE"</span>
                        (mpv-dispatch-dwim file t))))
        (list embark-file-map embark-url-map))
  (<span style="font-weight: bold;">with-eval-after-load</span> 'org
    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/flink-path</span> (flink)
      (<span style="font-weight: bold;">let*</span> ((exp-link (org-link-expand-abbrev flink)))
        (string-trim-right
         (string-trim-left exp-link <span style="font-style: italic;">"file:"</span>)
         <span style="font-style: italic;">"::.+$"</span>)))
    (mapc (<span style="font-weight: bold;">lambda</span> (map)
            (lambda-key map <span style="font-style: italic;">"P"</span>
                        (<span style="font-weight: bold;">lambda</span> (link)
                          <span style="font-style: italic;">"play media file written in org LINK"</span>
                          (mpv-dispatch-dwim (my/flink-path link) t))))
          (list embark-org-link-map))
    (mapc
     (<span style="font-weight: bold;">lambda</span> (map)
       (lambda-key map <span style="font-style: italic;">"P"</span>
                   (<span style="font-weight: bold;">lambda</span> (list)
                     <span style="font-style: italic;">"play media in LIST"</span>
                     (mpv-dispatch-dwim (mapcar (<span style="font-weight: bold;">lambda</span> (item)
                                                  (<span style="font-weight: bold;">when</span> (string-match org-link-any-re (car item))
                                                    (my/flink-path (match-string-no-properties 2 (car item)))))
                                                (cdr (org-list-to-lisp list)))
                                        t))))
     (list embark-org-plain-list-map))))
</pre>
</div>
</div>
</li>

<li><a id="org0d3a90e"></a>ffmpeg-opus command<br />
<div class="outline-text-6" id="text-org0d3a90e">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(transient-define-prefix ffmpeg-opus-dispatch-dwim (<span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> file)
  <span style="font-style: italic;">""</span>
  [(<span style="font-style: italic;">"-b"</span> <span style="font-style: italic;">"bitrate"</span> <span style="font-style: italic;">"-b:a "</span> <span style="font-weight: bold;">:prompt</span> <span style="font-style: italic;">"bitrate: "</span> <span style="font-weight: bold;">:class</span> transient-option
    <span style="font-weight: bold;">:init-value</span> (<span style="font-weight: bold;">lambda</span> (obj) (<span style="font-weight: bold;">oset</span> obj value <span style="font-style: italic;">"64k"</span>)))
   (<span style="font-style: italic;">"-t"</span> <span style="font-style: italic;">"tempo"</span> <span style="font-style: italic;">"-filter:a atempo="</span> <span style="font-weight: bold;">:prompt</span> <span style="font-style: italic;">"tempo (floating number): "</span>)]
  [(dispatch-dwim-execute
    <span style="font-weight: bold;">:command-format</span>
    (format <span style="font-style: italic;">"parallel ffmpeg -i '{}' -c:a libopus -ac 2 %%a '{.}'.opus ::: %s"</span>
            (plist-get (<span style="font-weight: bold;">oref</span> transient-current-prefix scope) 'file)))]
  (<span style="font-weight: bold;">interactive</span>)
  (transient-setup 'ffmpeg-opus-dispatch-dwim nil nil
                   <span style="font-weight: bold;">:scope</span> (plist-put nil 'file (dispatch-command-dwim/determine-file file))))
</pre>
</div>
</div>
</li>

<li><a id="org37c81f3"></a>ffmpeg-vp9 command<br />
<div class="outline-text-6" id="text-org37c81f3">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(transient-define-prefix ffmpeg-vp9-dispatch-dwim (<span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> file)
  <span style="font-style: italic;">""</span>
  [(<span style="font-style: italic;">"-B"</span> <span style="font-style: italic;">"audio bitrate"</span> <span style="font-style: italic;">"-b:a "</span> <span style="font-weight: bold;">:prompt</span> <span style="font-style: italic;">"Audio bitrate: "</span> <span style="font-weight: bold;">:class</span> transient-option
    <span style="font-weight: bold;">:init-value</span> (<span style="font-weight: bold;">lambda</span> (obj) (<span style="font-weight: bold;">oset</span> obj value <span style="font-style: italic;">"128k"</span>)))
   (<span style="font-style: italic;">"-c"</span> <span style="font-style: italic;">"crf"</span> <span style="font-style: italic;">"-crf "</span> <span style="font-weight: bold;">:prompt</span> <span style="font-style: italic;">"CRF value: "</span> <span style="font-weight: bold;">:class</span> transient-option
    <span style="font-weight: bold;">:init-value</span> (<span style="font-weight: bold;">lambda</span> (obj) (<span style="font-weight: bold;">oset</span> obj value <span style="font-style: italic;">"28"</span>)))
   (<span style="font-style: italic;">"-ss"</span> <span style="font-style: italic;">"seek start"</span> <span style="font-style: italic;">"-ss "</span> <span style="font-weight: bold;">:prompt</span> <span style="font-style: italic;">"Time to start seeking: "</span> <span style="font-weight: bold;">:class</span> transient-option)
   (<span style="font-style: italic;">"-to"</span> <span style="font-style: italic;">"seek stop"</span> <span style="font-style: italic;">"-to "</span> <span style="font-weight: bold;">:prompt</span> <span style="font-style: italic;">"Time to stop seeking: "</span> <span style="font-weight: bold;">:class</span> transient-option)]
  [(dispatch-dwim-execute
    <span style="font-weight: bold;">:command-format</span>
    (format <span style="font-style: italic;">"ffmpeg -i %5$s %1$s %2$s /dev/null &amp;&amp; ffmpeg %%S -i %5$s %1$s %3$s %4$s %5$s_out.webm"</span>
            <span style="font-style: italic;">"-c:v libvpx-vp9 -cpu-used 4 -threads 3 -row-mt 1 -speed 1 -b:v 0 %c"</span>
            <span style="font-style: italic;">"-pass 1 -an -f null"</span>
            <span style="font-style: italic;">"-pass 2 -map_metadata 0"</span>
            <span style="font-style: italic;">"-c:a libopus %b -ac 2"</span>
            (plist-get (<span style="font-weight: bold;">oref</span> transient-current-prefix scope) 'file))
    <span style="font-weight: bold;">:command-format-spec</span> ((?b . (dispatch-shell-command--key-vals '(<span style="font-style: italic;">"-B"</span>)))
                          (?c . (dispatch-shell-command--key-vals '(<span style="font-style: italic;">"-c"</span>)))
                          (?S . (dispatch-shell-command--key-vals '(<span style="font-style: italic;">"-ss"</span> <span style="font-style: italic;">"-to"</span>)))))]
  (<span style="font-weight: bold;">interactive</span>)
  (transient-setup 'ffmpeg-vp9-dispatch-dwim nil nil
                   <span style="font-weight: bold;">:scope</span> (plist-put nil 'file (dispatch-command-dwim/determine-file file))))
</pre>
</div>
</div>
</li>

<li><a id="orgf6dbbd1"></a>rtcwake complex command<br />
<div class="outline-text-6" id="text-orgf6dbbd1">
<div class="org-src-container">
<pre class="src src-emacs-lisp" id="org7e2cfe5">(transient-define-prefix sleep-dispatch-dwim (<span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> number)
  <span style="font-style: italic;">""</span>
  <span style="font-weight: bold;">:man-page</span> <span style="font-style: italic;">"sleep"</span>
  [(<span style="font-style: italic;">"-b"</span> <span style="font-style: italic;">"time before sleep"</span> <span style="font-style: italic;">""</span> <span style="font-weight: bold;">:prompt</span> <span style="font-style: italic;">"amount of time [s/m/h/d]: "</span>
    <span style="font-weight: bold;">:class</span> transient-option <span style="font-weight: bold;">:always-read</span> t <span style="font-weight: bold;">:allow-empty</span> nil
    <span style="font-weight: bold;">:init-value</span> (<span style="font-weight: bold;">lambda</span> (obj) (<span style="font-weight: bold;">oset</span> obj value (<span style="font-weight: bold;">or</span> number <span style="font-style: italic;">"0"</span>))))]
  [(dispatch-dwim-execute
    <span style="font-weight: bold;">:command-format</span> <span style="font-style: italic;">"sleep %a"</span>)]
  (<span style="font-weight: bold;">interactive</span>)
  (transient-setup 'sleep-dispatch-dwim))

(transient-define-prefix option-dispatch-dwim (<span style="font-weight: bold; text-decoration: underline;">&amp;rest</span> options)
  <span style="font-style: italic;">""</span>
  [(<span style="font-style: italic;">"o"</span> <span style="font-style: italic;">"option"</span> <span style="font-style: italic;">""</span>
    <span style="font-weight: bold;">:class</span> transient-option
    <span style="font-weight: bold;">:init-value</span> (<span style="font-weight: bold;">lambda</span> (obj)
                  (<span style="font-weight: bold;">oset</span> obj choices options)
                  (<span style="font-weight: bold;">oset</span> obj value (car (<span style="font-weight: bold;">oref</span> obj choices)))))]
  [(dispatch-dwim-execute)]
  (<span style="font-weight: bold;">interactive</span>)
  (transient-setup 'option-dispatch-dwim))

(transient-define-prefix rtcwake-dispatch-dwim (<span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> number)
  <span style="font-style: italic;">""</span>
  <span style="font-weight: bold;">:man-page</span> <span style="font-style: italic;">"rtcwake"</span>
  [(<span style="font-style: italic;">"-t"</span> <span style="font-style: italic;">"wake-up time"</span> <span style="font-style: italic;">"--date "</span> <span style="font-weight: bold;">:prompt</span> <span style="font-style: italic;">"Wake-up time: "</span> <span style="font-weight: bold;">:class</span> transient-option
    <span style="font-weight: bold;">:allow-empty</span> nil <span style="font-weight: bold;">:reader</span> my/transient-read-time <span style="font-weight: bold;">:always-read</span> t
    <span style="font-weight: bold;">:init-value</span> (<span style="font-weight: bold;">lambda</span> (obj) (<span style="font-weight: bold;">oset</span> obj value (my/transient-read-time nil <span style="font-style: italic;">"+7h"</span> nil))))]
  [(<span style="font-style: italic;">"("</span> <span style="font-style: italic;">"preceding sleep"</span> dispatch-dwim-fraction-command
    <span style="font-weight: bold;">:prefix</span> sleep-dispatch-dwim <span style="font-weight: bold;">:prefix-arg</span> (<span style="font-style: italic;">"30m"</span>) <span style="font-weight: bold;">:priority</span> 20
    <span style="font-weight: bold;">:default</span> <span style="font-style: italic;">"sleep 30m"</span>)
   (<span style="font-style: italic;">")"</span> <span style="font-style: italic;">"following command"</span> dispatch-dwim-fraction-command
    <span style="font-weight: bold;">:prefix</span> option-dispatch-dwim <span style="font-weight: bold;">:prefix-arg</span> (<span style="font-style: italic;">"morning.sh"</span> <span style="font-style: italic;">"which system.sh | xargs pwsudo; morning.sh; weekend.sh"</span>)
    <span style="font-weight: bold;">:priority</span> 90 <span style="font-weight: bold;">:default</span> <span style="font-style: italic;">"morning.sh"</span>)
   (dispatch-dwim-execute
    <span style="font-weight: bold;">:command-format</span> <span style="font-style: italic;">"pwsudo rtcwake -l -m mem -v %d"</span>
    <span style="font-weight: bold;">:command-format-spec</span> ((?d . (dispatch-shell-command--key-vals '(<span style="font-style: italic;">"-t"</span>)))))])

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/transient-read-time</span> (prompt default-time history)
  <span style="font-style: italic;">"Read time using date command."</span>
  (<span style="font-weight: bold;">or</span> (seq-some (<span style="font-weight: bold;">lambda</span> (d)
                  (<span style="font-weight: bold;">let*</span> ((time-str (string-trim
                                    (shell-command-to-string
                                     (format <span style="font-style: italic;">"date +'%%Y-%%m-%%d %%H:%%M' -d '%s'"</span>
                                             (my/expand-shorthand-time d)))))
                         (time-ts (<span style="font-weight: bold;">or</span> (<span style="font-weight: bold;">and</span> (string-prefix-p <span style="font-style: italic;">"date: invalid date"</span>
                                                            time-str)
                                           (message <span style="font-style: italic;">"Invalid time"</span>))
                                      (encode-time (parse-time-string time-str)))))
                    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Ask the user if the specified time is designated as either past or beyond 12 hours</span>
                    (<span style="font-weight: bold;">if</span> (<span style="font-weight: bold;">and</span> (<span style="font-weight: bold;">or</span> (time-less-p time-ts (current-time))
                                 (time-less-p (time-add nil (seconds-to-time (* 12 60 60)))
                                              time-ts))
                             (not (y-or-n-p (format <span style="font-style: italic;">"Is %s right?: "</span> time-str))))
                        (car (symbol-value history))
                      (format <span style="font-style: italic;">"'%s'"</span> time-str))))
                (delq nil (list (<span style="font-weight: bold;">and</span> prompt (read-string prompt)) default-time)))
      <span style="font-style: italic;">""</span>))
</pre>
</div>
</div>
</li>

<li><a id="org416affb"></a>pandoc command<br />
<div class="outline-text-6" id="text-org416affb">
<div class="org-src-container">
<pre class="src src-emacs-lisp" id="orgb5d59d1">(transient-define-prefix pandoc-dispatch-dwim (<span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> file)
  <span style="font-style: italic;">""</span>
  [(my/pandoc-to)]
  [(dispatch-dwim-execute
    <span style="font-weight: bold;">:command-format</span>
    (format <span style="font-style: italic;">"parallel pandoc %%a '{}' ::: %s"</span>
            (plist-get (<span style="font-weight: bold;">oref</span> transient-current-prefix scope) 'file)))]
  (<span style="font-weight: bold;">interactive</span>)
  (transient-setup 'pandoc-dispatch-dwim nil nil
                   <span style="font-weight: bold;">:scope</span> (plist-put nil 'file (dispatch-command-dwim/determine-file file))))

(<span style="font-weight: bold;">defclass</span> <span style="font-weight: bold; text-decoration: underline;">my/transient-option</span> (transient-option)
  ())

(transient-define-infix my/pandoc-to ()
  <span style="font-weight: bold;">:class</span> my/transient-option
  <span style="font-weight: bold;">:transient</span> t
  <span style="font-weight: bold;">:prompt</span> <span style="font-style: italic;">"To format: "</span>
  <span style="font-weight: bold;">:key</span> <span style="font-style: italic;">"-t"</span>
  <span style="font-weight: bold;">:description</span> <span style="font-style: italic;">"To Format"</span>
  <span style="font-weight: bold;">:argument</span> <span style="font-style: italic;">"--to="</span>
  <span style="font-weight: bold;">:allow-empty</span> nil
  <span style="font-weight: bold;">:always-read</span> t
  <span style="font-weight: bold;">:init-value</span> (<span style="font-weight: bold;">lambda</span> (obj) (<span style="font-weight: bold;">oset</span> obj value (car (<span style="font-weight: bold;">oref</span> obj choices))))
  <span style="font-weight: bold;">:choices</span> '(<span style="font-style: italic;">"org"</span> <span style="font-style: italic;">"pdf"</span> <span style="font-style: italic;">"epub"</span> <span style="font-style: italic;">"rst"</span> <span style="font-style: italic;">"texinfo"</span> <span style="font-style: italic;">"odt"</span> <span style="font-style: italic;">"docx"</span>))

(<span style="font-weight: bold;">cl-defmethod</span> <span style="font-weight: bold;">transient-infix-value</span> ((obj my/transient-option))
  <span style="font-style: italic;">""</span>
  (<span style="font-weight: bold;">let</span> ((fmt (<span style="font-weight: bold;">oref</span> obj value)))
    (concat (format <span style="font-style: italic;">"-o '{.}'.%s"</span> fmt)
            (<span style="font-weight: bold;">when</span> (string= fmt <span style="font-style: italic;">"pdf"</span>)
              <span style="font-style: italic;">" --pdf-engine weasyprint"</span>))))
</pre>
</div>
</div>
</li>

<li><a id="org762cf10"></a>yt-dlp command<br />
<div class="outline-text-6" id="text-org762cf10">
<div class="org-src-container">
<pre class="src src-emacs-lisp" id="org2e245ad">(transient-define-prefix yt-dlp-dispatch-dwim (<span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> url output duration-p play-p)
  <span style="font-style: italic;">""</span>
  <span style="font-weight: bold;">:man-page</span> <span style="font-style: italic;">"yt-dlp"</span>
  [(<span style="font-style: italic;">"-P"</span> <span style="font-style: italic;">"download path"</span> <span style="font-style: italic;">"--paths "</span>
    <span style="font-weight: bold;">:class</span> transient-option
    <span style="font-weight: bold;">:reader</span> transient-read-existing-directory
    <span style="font-weight: bold;">:init-value</span> (<span style="font-weight: bold;">lambda</span> (obj) (<span style="font-weight: bold;">oset</span> obj value <span style="font-style: italic;">"&lt;&lt;media-dir()&gt;&gt;"</span>)))
   (<span style="font-style: italic;">"-a"</span> <span style="font-style: italic;">"audio"</span> <span style="font-style: italic;">"-x --embed-thumbnail"</span>)
   (<span style="font-style: italic;">"-d"</span> <span style="font-style: italic;">"duration"</span> <span style="font-style: italic;">"--get-duration --no-warnings"</span>
    <span style="font-weight: bold;">:init-value</span> (<span style="font-weight: bold;">lambda</span> (obj) (<span style="font-weight: bold;">oset</span> obj value (<span style="font-weight: bold;">and</span> duration-p (<span style="font-weight: bold;">oref</span> obj argument)))))
   (<span style="font-style: italic;">"-p"</span> <span style="font-style: italic;">"play"</span> <span style="font-style: italic;">"--exec 'mpv --no-pause {}</span><span style="font-weight: bold; font-style: italic;">\</span><span style="font-style: italic;">; rm {}'"</span>
    <span style="font-weight: bold;">:init-value</span> (<span style="font-weight: bold;">lambda</span> (obj) (<span style="font-weight: bold;">oset</span> obj value (<span style="font-weight: bold;">and</span> play-p (<span style="font-weight: bold;">oref</span> obj argument)))))
   (<span style="font-style: italic;">"-f"</span> <span style="font-style: italic;">"format"</span> <span style="font-style: italic;">"--format "</span>
    <span style="font-weight: bold;">:class</span> transient-option
    <span style="font-weight: bold;">:init-value</span> (<span style="font-weight: bold;">lambda</span> (obj) (<span style="font-weight: bold;">oset</span> obj value <span style="font-style: italic;">"'bestvideo*+bestaudio/best'"</span>)))
   (<span style="font-style: italic;">"-S"</span> <span style="font-style: italic;">"format sort"</span> <span style="font-style: italic;">"--format-sort "</span>
    <span style="font-weight: bold;">:class</span> transient-option
    <span style="font-weight: bold;">:init-value</span> (<span style="font-weight: bold;">lambda</span> (obj) (<span style="font-weight: bold;">oset</span> obj value <span style="font-style: italic;">"'filesize:2G'"</span>)))
   (<span style="font-style: italic;">"-o"</span> <span style="font-style: italic;">"output"</span> <span style="font-style: italic;">"--output "</span>
    <span style="font-weight: bold;">:class</span> transient-option <span style="font-weight: bold;">:reader</span> dispatch-dwim-read-yt-dlp-output
    <span style="font-weight: bold;">:prompt</span> <span style="font-style: italic;">"Output file name without extension: "</span>
    <span style="font-weight: bold;">:init-value</span>
    (<span style="font-weight: bold;">lambda</span> (obj) (<span style="font-weight: bold;">oset</span> obj value
                    (<span style="font-weight: bold;">and</span> output (shell-quote-argument
                                 (format <span style="font-style: italic;">"%s.%%</span><span style="font-weight: bold; font-style: italic;">\</span><span style="font-style: italic;">(ext</span><span style="font-weight: bold; font-style: italic;">\</span><span style="font-style: italic;">)s"</span>
                                         (my/file-name-legitimate output)))))))]
  [(dispatch-dwim-execute
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">embed url to :command-format may cause unexpected glitch</span>
    <span style="font-weight: bold;">:command-format</span>
    <span style="font-style: italic;">"yt-dlp --embed-chapters --live-from-start %a %u"</span>
    <span style="font-weight: bold;">:command-format-spec</span> ((?u . (plist-get (<span style="font-weight: bold;">oref</span> transient-current-prefix scope) 'url))))]
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">setq</span> my/detached-bury-buffer t)
  (transient-setup 'yt-dlp-dispatch-dwim nil nil
                   <span style="font-weight: bold;">:scope</span> (plist-put nil 'url
                                     (dispatch-dwim--determine-url url))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">dispatch-dwim-read-yt-dlp-output</span> (prompt _default _history)
  <span style="font-style: italic;">""</span>
  (shell-quote-argument
   (format <span style="font-style: italic;">"%s.%%</span><span style="font-weight: bold; font-style: italic;">\</span><span style="font-style: italic;">(ext</span><span style="font-weight: bold; font-style: italic;">\</span><span style="font-style: italic;">)s"</span>
           (my/file-name-legitimate (read-string prompt)))))

(<span style="font-weight: bold;">with-eval-after-load</span> 'embark
  (mapc (<span style="font-weight: bold;">lambda</span> (map)
          (lambda-key map <span style="font-style: italic;">"Y"</span>
                      (<span style="font-weight: bold;">lambda</span> (thing)
                        <span style="font-style: italic;">"download media file"</span>
                        (<span style="font-weight: bold;">let</span> ((url (<span style="font-weight: bold;">pcase</span> thing
                                     ((<span style="font-weight: bold;">and</span> (pred (<span style="font-weight: bold;">lambda</span> (s) (string-match org-link-any-re s))) ol)
                                      (<span style="font-weight: bold;">or</span> (match-string-no-properties 0 ol)
                                          (match-string-no-properties 2 ol)))
                                     ((<span style="font-weight: bold;">and</span> (pred (<span style="font-weight: bold;">lambda</span> (s) (string-match ffap-url-at-point s))) u)
                                      (match-string-no-properties 0 u)))))
                          (yt-dlp-dispatch-dwim url)
                          (dispatch-execute-macro)))))
        (list embark-kill-ring-map embark-url-map
              embark-org-link-map)))
</pre>
</div>
</div>
</li>

<li><a id="org9d69041"></a>du command<br />
<div class="outline-text-6" id="text-org9d69041">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(transient-define-prefix du-dispatch-dwim (<span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> file)
  <span style="font-style: italic;">"Dispatch du command."</span>
  <span style="font-weight: bold;">:man-page</span> <span style="font-style: italic;">"du"</span>
  [(<span style="font-style: italic;">"-s"</span> <span style="font-style: italic;">"summarize"</span> <span style="font-style: italic;">"--summarize"</span>
    <span style="font-weight: bold;">:init-value</span> (<span style="font-weight: bold;">lambda</span> (obj) (<span style="font-weight: bold;">oset</span> obj value <span style="font-style: italic;">"--summarize"</span>)))
   (<span style="font-style: italic;">"-c"</span> <span style="font-style: italic;">"add total"</span> <span style="font-style: italic;">"--total"</span>
    <span style="font-weight: bold;">:init-value</span> (<span style="font-weight: bold;">lambda</span> (obj) (<span style="font-weight: bold;">oset</span> obj value <span style="font-style: italic;">"--total"</span>)))
   (<span style="font-style: italic;">"-D"</span> <span style="font-style: italic;">"deref symlinks"</span> <span style="font-style: italic;">"--dereference-args"</span>
    <span style="font-weight: bold;">:init-value</span> (<span style="font-weight: bold;">lambda</span> (obj) (<span style="font-weight: bold;">oset</span> obj value <span style="font-style: italic;">"--dereference-args"</span>)))
   (<span style="font-style: italic;">"-h"</span> <span style="font-style: italic;">"human readable"</span> <span style="font-style: italic;">"--human-readable"</span>
    <span style="font-weight: bold;">:init-value</span> (<span style="font-weight: bold;">lambda</span> (obj) (<span style="font-weight: bold;">oset</span> obj value <span style="font-style: italic;">"--human-readable"</span>)))]
  [(dispatch-dwim-execute
    <span style="font-weight: bold;">:command-format</span>
    (format <span style="font-style: italic;">"ionice -c2 -n7 nice -n19 du %%a %s"</span>
            (plist-get (<span style="font-weight: bold;">oref</span> transient-current-prefix scope) 'file)))]
  (<span style="font-weight: bold;">interactive</span>)
  (transient-setup 'du-dispatch-dwim nil nil
                   <span style="font-weight: bold;">:scope</span> (plist-put nil 'file (dispatch-command-dwim/determine-file file))))
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="orgf22df39"></a>TempEL templates for modes<br />
<div class="outline-text-5" id="text-orgf22df39">
<div class="org-src-container">
<pre class="src src-emacs-lisp" id="orgbc4d4b6">(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/region-string-trans-buffer</span> ()
  <span style="font-style: italic;">"Return region string in some buffer where region is active."</span>
  (cl-some (<span style="font-weight: bold;">lambda</span> (buf)
             (<span style="font-weight: bold;">with-current-buffer</span> buf
               (<span style="font-weight: bold;">when</span> (region-active-p)
                 (buffer-substring-no-properties (region-beginning)
                                                 (region-end)))))
           (list (current-buffer) (other-buffer nil t))))
</pre>
</div>
</div>

<ul class="org-ul">
<li><a id="org5cd9b76"></a>fundamental-mode templates<br />
<div class="outline-text-6" id="text-org5cd9b76">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(timestamp (my/insert-time-stamp))
</pre>
</div>
</div>
</li>

<li><a id="org114be27"></a>text-mode templates<br />
<div class="outline-text-6" id="text-org114be27">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(gma <span style="font-style: italic;">"update on "</span> (my/insert-time-stamp))
</pre>
</div>
</div>
</li>

<li><a id="org5c37d9e"></a>org-mode templates<br />
<div class="outline-text-6" id="text-org5c37d9e">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(call &amp; <span style="font-style: italic;">"#+CALL: "</span> (p <span style="font-style: italic;">"name"</span> name) <span style="font-style: italic;">"("</span> (s var) <span style="font-style: italic;">"=\""</span> (s value) <span style="font-style: italic;">"\")"</span>)
(name &amp; <span style="font-style: italic;">"#+NAME: "</span> (p <span style="font-style: italic;">"name"</span> name))
(/ <span style="font-style: italic;">"[/]"</span> (org-update-statistics-cookies nil))
(tsm p <span style="font-style: italic;">" :: "</span> (<span style="font-weight: bold;">with-temp-buffer</span> (org-insert-time-stamp (current-time) t t)))

&lt;&lt;org-template&gt;&gt;
</pre>
</div>
</div>
</li>

<li><a id="org6eb2496"></a>minibuffer-mode templates<br />
<div class="outline-text-6" id="text-org6eb2496">
<div class="org-src-container">
<pre class="src src-emacs-lisp">&lt;&lt;minibuffer-mode-template&gt;&gt;

(guix-search <span style="font-style: italic;">"guix search "</span> (p (my/region-string-trans-buffer)))
(version (p <span style="font-style: italic;">"command"</span>) <span style="font-style: italic;">" --version"</span>)
(curly-bracket-japanese-regexp
 (<span style="font-weight: bold;">rx</span> (parened ?&#65371; (+ (<span style="font-weight: bold;">or</span> <span style="font-style: italic;">" "</span>
                         (category japanese-hiragana-two-byte)))))))
</pre>
</div>
</div>
</li>

<li><a id="org8cf366e"></a>emacs-lisp-mode templates<br />
<div class="outline-text-6" id="text-org8cf366e">
<div class="org-src-container">
<pre class="src src-emacs-lisp">&lt;&lt;emacs-lisp-mode-template&gt;&gt;

(<span style="font-weight: bold;">require</span> <span style="font-style: italic;">"(require '"</span> (p <span style="font-style: italic;">"feature"</span>) <span style="font-style: italic;">")"</span>)
(<span style="font-weight: bold;">lambda</span> <span style="font-style: italic;">"(lambda () "</span> n&gt;
  (p <span style="font-style: italic;">"docstring: "</span> doc-str t)
  (<span style="font-weight: bold;">when</span> (length&gt; doc-str 0)
    (format <span style="font-style: italic;">"\"%s\"\n"</span> doc-str))
  &gt; p <span style="font-style: italic;">")"</span>)
(<span style="font-weight: bold;">interactive</span> <span style="font-style: italic;">"(interactive"</span>
             (p <span style="font-style: italic;">"code: "</span> code t)
             (<span style="font-weight: bold;">when</span> (length&gt; code 0)
               (format <span style="font-style: italic;">" \"%s\""</span> code))
             <span style="font-style: italic;">")"</span>)
(bind-keys <span style="font-style: italic;">"(bind-keys "</span> (p (format <span style="font-style: italic;">":map "</span>))
           <span style="font-style: italic;">"(\""</span> p <span style="font-style: italic;">"\" . "</span> p <span style="font-style: italic;">"))"</span>)
</pre>
</div>
</div>
</li>

<li><a id="org2993ac6"></a>sh-base-mode templates<br />
<div class="outline-text-6" id="text-org2993ac6">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(rf <span style="font-style: italic;">"${"</span> p <span style="font-style: italic;">"}"</span>)
(<span style="font-weight: bold;">function</span> <span style="font-style: italic;">"function "</span> (p <span style="font-style: italic;">"name"</span>) <span style="font-style: italic;">" {"</span> n&gt; p n <span style="font-style: italic;">"}"</span>)
</pre>
</div>
</div>
</li>

<li><a id="org7920f82"></a>mu4e-compose-mode<br />
<div class="outline-text-6" id="text-org7920f82">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(&#12424;&#12429; <span style="font-style: italic;">"&#12424;&#12429;&#12375;&#12367;&#12362;&#39000;&#12356;&#12356;&#12383;&#12375;&#12414;&#12377;&#12290;"</span>)
(&#12356;&#12376;&#12423;&#12358; <span style="font-style: italic;">"&#20197;&#19978;&#12289;&#12424;&#12429;&#12375;&#12367;&#12362;&#39000;&#12356;&#12356;&#12383;&#12375;&#12414;&#12377;&#12290;"</span>)
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="org1254d1e"></a>elisp code from outside of Emacs<br />
<div class="outline-text-5" id="text-org1254d1e">
<p>
This section mainly for elisp code associated with some other programs.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">&lt;&lt;elisp-code&gt;&gt;
</pre>
</div>
</div>
</li>

<li><a id="org48215f3"></a>obsolete features&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span><br /></li>
</ul>
</div>

<div id="outline-container-org6f9d22f" class="outline-4">
<h4 id="org6f9d22f">bespoke org tweaks</h4>
<div class="outline-text-4" id="text-org6f9d22f">
</div>

<ul class="org-ul">
<li><a id="org44f663d"></a>keymap for global org commands<br />
<div class="outline-text-5" id="text-org44f663d">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(global-set-key (kbd <span style="font-style: italic;">"H-o"</span>)
                (define-keymap
                  <span style="font-weight: bold;">:prefix</span> 'my/org-global-map
                  <span style="font-style: italic;">"o"</span> #'org-open-at-point
                  <span style="font-style: italic;">"C-s"</span> #'org-save-all-org-buffers
                  <span style="font-style: italic;">"J"</span> #'org-babel-tangle-jump-to-org
                  <span style="font-style: italic;">"i"</span> #'org-info-find-node
                  <span style="font-style: italic;">"m"</span> #'org-mark-ring-goto
                  <span style="font-style: italic;">"@"</span> #'org-previous-link))

(<span style="font-weight: bold;">provide</span> '<span style="font-weight: bold; text-decoration: underline;">my-org-global-map</span>)
</pre>
</div>
</div>
</li>

<li><a id="org777ebc5"></a>remove empty clock log unless manually clocked out&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span><br /></li>

<li><a id="orgdd925b3"></a>embark keymaps for consult-org-heading and consult-location<br />
<div class="outline-text-5" id="text-orgdd925b3">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/embark-org-clock-in-with-opening-thing</span> (target)
  <span style="font-style: italic;">"Clock in and open thing for TARGET at once.</span>

<span style="font-style: italic;">If TARGET is an agenda item and `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">other-window-for-scrolling</span><span style="font-style: italic;">' is</span>
<span style="font-style: italic;">displaying an org mode buffer, then that is the source window.</span>
<span style="font-style: italic;">If TARGET is a minibuffer completion candidate, then the source</span>
<span style="font-style: italic;">window is the window selected before the command that opened the</span>
<span style="font-style: italic;">minibuffer ran."</span>
  (embark-org--in-source-window
   target
   (<span style="font-weight: bold;">lambda</span> (marker)
     (<span style="font-weight: bold;">org-with-point-at</span> marker
       (org-clock-in)
       (org-open-at-point)))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/embark-org-clock-supersede</span> (target)
  <span style="font-style: italic;">"Cancel the current clocking then clock in TARGET so as to fill out the gap time."</span>
  (embark-org--in-source-window
   target
   (<span style="font-weight: bold;">lambda</span> (marker)
     (<span style="font-weight: bold;">org-with-point-at</span> marker
       (my/org-clock-supersede)))))

(<span style="font-weight: bold;">with-eval-after-load</span> 'embark
  (cl-mapc (<span style="font-weight: bold;">lambda</span> (key-def)
             (keymap-set embark-org-heading-map
                         (car key-def) (cdr key-def)))
           '((<span style="font-style: italic;">"M-I"</span> . my/embark-org-clock-in-with-opening-thing)
             (<span style="font-style: italic;">"V"</span> . my/embark-org-clock-supersede))))
</pre>
</div>
</div>
</li>

<li><a id="org6defcaf"></a>org move repeat map<br />
<div class="outline-text-5" id="text-org6defcaf">
<p>
<a href="my/org-move-repeat-map">my/org-move-repeat-map</a> allows to move around org elements and blocks with ease.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(defvar-keymap my/org-move-repeat-map
  <span style="font-weight: bold;">:doc</span> <span style="font-style: italic;">"Keymap to repeat moving commands in `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">org-mode</span><span style="font-style: italic;">'.  Used in `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">repeat-mode</span><span style="font-style: italic;">'."</span>
  <span style="font-weight: bold;">:repeat</span> t
  <span style="font-style: italic;">"n"</span> #'org-next-item
  <span style="font-style: italic;">"p"</span> #'org-previous-item
  <span style="font-style: italic;">"u"</span> #'org-up-element
  <span style="font-style: italic;">"d"</span> #'org-down-element
  <span style="font-style: italic;">"f"</span> #'org-forward-element
  <span style="font-style: italic;">"b"</span> #'org-backward-element
  <span style="font-style: italic;">"&gt;"</span> #'org-next-link
  <span style="font-style: italic;">"&lt;"</span> #'org-previous-link
  <span style="font-style: italic;">"F"</span> #'org-next-block
  <span style="font-style: italic;">"B"</span> #'org-previous-block
  <span style="font-style: italic;">"M-f"</span> #'org-next-block
  <span style="font-style: italic;">"M-b"</span> #'org-previous-block
  <span style="font-style: italic;">"M-n"</span> #'org-babel-next-src-block
  <span style="font-style: italic;">"M-p"</span> #'org-babel-previous-src-block)
</pre>
</div>
</div>
</li>

<li><a id="orgf940602"></a>show org entries pointing to the current (backlink)<br />
<div class="outline-text-5" id="text-orgf940602">
<p>
These commands show back links even in [BROKEN LINK: id:d5bd559a-2cab-4495-993b-f7a21637f0ea] files.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/org-backlink-entry</span> ()
  <span style="font-style: italic;">"Show all entries that point to the entry at point."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">let</span> ((id (org-entry-get (point) <span style="font-style: italic;">"ID"</span>))
        (heading (org-get-heading t t t t)))
    (org-ql-search
      (directory-files-recursively org-directory <span style="font-style: italic;">"\\.org$"</span> t
                                   (<span style="font-weight: bold;">lambda</span> (subdir)
                                     (member (file-relative-name subdir org-directory)
                                             '(<span style="font-style: italic;">"agenda"</span> <span style="font-style: italic;">"notes"</span>))))
      `(link ,(<span style="font-weight: bold;">or</span> id heading))
      <span style="font-weight: bold;">:super-groups</span> '((<span style="font-weight: bold;">:auto-parent</span>)))))
(global-set-key (kbd <span style="font-style: italic;">"C-c b b"</span>) #'my/org-backlink-entry)

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/org-backlink-by-tag</span> ()
  <span style="font-style: italic;">"Show all entries that share tag with the entry at point."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">let*</span> ((org-use-tag-inheritance
          (<span style="font-weight: bold;">if</span> (denote-file-is-note-p (buffer-file-name))
              t nil))
         (tags (org-get-tags)))
    (org-ql-search
      (directory-files-recursively org-directory <span style="font-style: italic;">"\\.org$"</span> t
                                   (<span style="font-weight: bold;">lambda</span> (subdir)
                                     (member (file-relative-name subdir org-directory)
                                             '(<span style="font-style: italic;">"agenda"</span> <span style="font-style: italic;">"notes"</span>))))
      `(tags ,@tags)
      <span style="font-weight: bold;">:super-groups</span> '((<span style="font-weight: bold;">:auto-tags</span>)))))
(global-set-key (kbd <span style="font-style: italic;">"C-c b t"</span>) #'my/org-backlink-by-tag)
</pre>
</div>
</div>
</li>

<li><a id="org9d5e599"></a>set timer at clocking in<br />
<div class="outline-text-5" id="text-org9d5e599">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">with-eval-after-load</span> 'org-clock
  (add-hook 'org-clock-in-prepare-hook
            #'my/org-clock-in-set-timer))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/org-clock-in-set-timer</span> ()
  <span style="font-style: italic;">"Start count down timer for a clocked in entry.</span>

<span style="font-style: italic;">If the entry has ATTENTION_SPAN property, use it for `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">org-timer-default-timer</span><span style="font-style: italic;">'.</span>
<span style="font-style: italic;">Otherwise count down time is Effort property value.</span>
<span style="font-style: italic;">In neither case, count down time is 25 min which is suggested in the Pomodoro-technique."</span>
  (<span style="font-weight: bold;">let*</span> ((todo (org-get-todo-state))
         (attention-span (org-entry-get (point) <span style="font-style: italic;">"ATTENTION_SPAN"</span> 'selective))
         (effort (org-entry-get (point) <span style="font-style: italic;">"Effort"</span> 'selective))
         (countdown-time (<span style="font-weight: bold;">or</span> attention-span
                             (<span style="font-weight: bold;">and</span> todo <span style="font-style: italic;">"25"</span>)))
         (org-timer-default-timer countdown-time))
    (<span style="font-weight: bold;">and</span> countdown-time
         (org-timer-set-timer '(16)))))
</pre>
</div>
</div>
</li>

<li><a id="org503b402"></a>stop timer at clocking out<br />
<div class="outline-text-5" id="text-org503b402">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">with-eval-after-load</span> 'org-clock
  (<span style="font-weight: bold;">dolist</span> (hook '(org-clock-out-hook org-clock-cancel-hook))
    (add-hook hook
              (<span style="font-weight: bold;">lambda</span> ()
                (<span style="font-weight: bold;">and</span> (<span style="font-weight: bold;">bound-and-true-p</span>  org-timer-countdown-timer)
                     (org-timer-stop))))))
</pre>
</div>
</div>
</li>

<li><a id="org8043ad9"></a>supersede clocking task<br />
<div class="outline-text-5" id="text-org8043ad9">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/org-clock-supersede</span> ()
  <span style="font-style: italic;">"Supersede clocking task with the task at point."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">let</span> ((org-clock-continuously t))
    (<span style="font-weight: bold;">save-excursion</span>
      (<span style="font-weight: bold;">and</span> (<span style="font-weight: bold;">bound-and-true-p</span> org-clock-current-task)
           (org-clock-cancel)))
    (org-clock-in)))

(<span style="font-weight: bold;">with-eval-after-load</span> 'org-keys
  (<span style="font-weight: bold;">with-eval-after-load</span> 'my-org-global-map
    (bind-keys <span style="font-weight: bold;">:map</span> my/org-global-map
               (<span style="font-style: italic;">"V"</span> . my/org-clock-supersede))
    (<span style="font-weight: bold;">setf</span> (map-elt org-speed-commands <span style="font-style: italic;">"V"</span>) #'my/org-clock-supersede)))
</pre>
</div>
</div>
</li>

<li><a id="org9129564"></a>notify the completion of the timer with an alarm<br />
<div class="outline-text-5" id="text-org9129564">
<div class="org-src-container">
<pre class="src src-shell">pactl list sinks | grep <span style="font-style: italic;">'^[[:space:]]Volume:'</span> | head -n $(($<span style="font-weight: bold; font-style: italic;">SINK</span> + 1 )) | tail -n 1 | sed -e <span style="font-style: italic;">'s,.* \([0-9][0-9]*\)%.*,\1,'</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">with-eval-after-load</span> 'org-timer
  (add-hook 'org-timer-done-hook
            'my/org-task-timer-finish))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/org-task-timer-finish</span> ()
  <span style="font-style: italic;">"Notify task timer by appropriate means."</span>
  (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">and</span> (org-clocking-p)
             org-clock-marker)
    (<span style="font-weight: bold;">let</span> ((alert (org-entry-get org-clock-marker
                                <span style="font-style: italic;">"ALERT"</span>)))
      (<span style="font-weight: bold;">and</span> (stringp alert)
           (string= alert <span style="font-style: italic;">"alarm"</span>)
           (alert <span style="font-style: italic;">"Timer Done!"</span> <span style="font-weight: bold;">:style</span> 'alarm))
      (alert <span style="font-style: italic;">"Timer Done!"</span> <span style="font-weight: bold;">:style</span> 'fringe <span style="font-weight: bold;">:mode</span> 'org-mode <span style="font-weight: bold;">:buffer</span> (org-clocking-buffer) <span style="font-weight: bold;">:severity</span> 'trivial))))

(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">alarm-sound</span> <span style="font-style: italic;">"/usr/share/sounds/freedesktop/stereo/complete.oga"</span>)

(<span style="font-weight: bold;">with-eval-after-load</span> 'alert
  (alert-define-style 'alarm
                      <span style="font-weight: bold;">:title</span> <span style="font-style: italic;">"alarm"</span>
                      <span style="font-weight: bold;">:notifier</span>
                      (<span style="font-weight: bold;">lambda</span> (info)
                        (my/play-sound alarm-sound t))))
</pre>
</div>
</div>
</li>

<li><a id="orga476542"></a>org-scrap (jotting down in org)<br />
<div class="outline-text-5" id="text-orga476542">
<p>
Memo file (memo.org) is useful for jotting down fragmented pieces of text, code and more.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">with-eval-after-load</span> 'org
  (<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my/org-capture-scrap-file</span>
    (file-name-concat org-directory <span style="font-style: italic;">"sandbox/scrap.org"</span>)
    <span style="font-style: italic;">"File for jotting down with `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">org-capture</span><span style="font-style: italic;">'."</span>)
  (<span style="font-weight: bold;">with-eval-after-load</span> 'org-capture
    (add-to-list 'org-capture-templates
                 `(<span style="font-style: italic;">"j"</span> <span style="font-style: italic;">"Jot down"</span>
                   entry (file ,my/org-capture-scrap-file)
                   <span style="font-style: italic;">"* %U\n#+begin_src %^{Lnaguage|text}\n%(my/org-capture-filter-scrap \"%i\")\n#+end_src"</span>
                   <span style="font-weight: bold;">:jump-to-captured</span> t
                   <span style="font-weight: bold;">:immediate-finish</span> t)
                 t)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/org-capture-filter-scrap</span> (<span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> str)
  <span style="font-style: italic;">"Replace semantic representation in `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">org-mode</span><span style="font-style: italic;">' with plain string in STR."</span>
  (<span style="font-weight: bold;">cond</span>
   ((stringp str)
    (replace-regexp-in-string <span style="font-style: italic;">"^</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">*+ </span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">"</span> <span style="font-style: italic;">",\\1"</span> str))
   (t <span style="font-style: italic;">""</span>)))
</pre>
</div>
</div>
</li>

<li><a id="org5a09ac4"></a>reset org element contextually<br />
<div class="outline-text-5" id="text-org5a09ac4">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">with-eval-after-load</span> 'org
  (bind-keys <span style="font-weight: bold;">:map</span> org-mode-map
             (<span style="font-style: italic;">"C-c SPC"</span> . my/org-reset-dwim)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/org-reset-dwim</span> ()
  <span style="font-style: italic;">"Exert reset procedure depending on org element at point."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">cond</span>
   ((org-at-table-p) (org-table-blank-field))
   ((org-in-subtree-not-table-p)
    (<span style="font-weight: bold;">org-save-outline-visibility</span> t
      (org-reset-checkbox-state-subtree)))))
</pre>
</div>
</div>
</li>

<li><a id="orgf7d2849"></a>copy arbitrary org property to kill ring<br />
<div class="outline-text-5" id="text-orgf7d2849">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">with-eval-after-load</span> 'org
  (bind-keys <span style="font-weight: bold;">:map</span> org-mode-map
             (<span style="font-style: italic;">"C-c W"</span> . my/org-entry-kill)))

(<span style="font-weight: bold;">with-eval-after-load</span> 'org-keys
  (add-to-list 'org-speed-commands
               '(<span style="font-style: italic;">"W"</span> . my/org-entry-kill)
               t))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/org-entry-kill</span> ()
  <span style="font-style: italic;">"Prompt user to select property to append to the kill ring.</span>

<span style="font-style: italic;">If property's value matches $(...) format, ... is interpreted as shell command and execute it."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">let*</span> ((properties (org-entry-properties))
         (prop-key-to-copy
          (completing-read <span style="font-style: italic;">"Property name: "</span>
                           (mapcar #'(lambda (var) (car var)) properties))))
    (<span style="font-weight: bold;">when</span> (stringp prop-key-to-copy)
      (<span style="font-weight: bold;">let*</span> ((prop-value (cdr (assoc prop-key-to-copy properties)))
             (str-to-copy
              (<span style="font-weight: bold;">cond</span>
               ((string-match <span style="font-style: italic;">"$(</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">.+</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">)"</span> prop-value)
                (shell-command-to-string (match-string 1 prop-value)))
               (t prop-value))))
        (kill-new str-to-copy)))))
</pre>
</div>
</div>
</li>

<li><a id="org7dddcf1"></a>lob ingest all named source blocks<br />
<div class="outline-text-5" id="text-org7dddcf1">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">with-eval-after-load</span> 'org
  (bind-keys <span style="font-weight: bold;">:map</span> my/org-global-map
             (<span style="font-style: italic;">"b i"</span> . my/org-babel-lob-ingest-all))

  (<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my/org-babel-lob-ingest-files</span>
    (seq-reduce (<span style="font-weight: bold;">lambda</span> (org-files dir)
                  (append org-files
                          (directory-files (expand-file-name dir org-directory) <span style="font-style: italic;">"</span><span style="font-weight: bold; font-style: italic;">\</span><span style="font-style: italic;">.org$"</span>)))
                '(<span style="font-style: italic;">"agenda"</span> <span style="font-style: italic;">"notes"</span>)
                nil)
    <span style="font-style: italic;">"A list of org files which is used in `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">my/org-babel-lob-ingest-all</span><span style="font-style: italic;">'."</span>)

  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/org-babel-lob-ingest-all</span> ()
    <span style="font-style: italic;">"Add all named soruce blocks in cpecified files."</span>
    (<span style="font-weight: bold;">interactive</span>)
    (<span style="font-weight: bold;">dolist</span> (org-file my/org-babel-lob-ingest-files)
      (org-babel-lob-ingest org-file))))
</pre>
</div>
</div>
</li>

<li><a id="org5993f9a"></a>browse org subtree<br />
<div class="outline-text-5" id="text-org5993f9a">
<div class="org-src-container">
<pre class="src src-conf">d &lt;&lt;emacs-var-dir()&gt;&gt;/org/subtree-view 0755 - - 3d
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">with-eval-after-load</span> 'org
  (bind-keys <span style="font-weight: bold;">:map</span> org-mode-map
             (<span style="font-style: italic;">"C-c C-!"</span> . my/org-subtree-view-in-browser))
  (add-to-list 'org-speed-commands
               '(<span style="font-style: italic;">"!"</span> . my/org-subtree-view-in-browser)
               t))

(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my/org-subtree-view-directory</span>
  (no-littering-expand-var-file-name <span style="font-style: italic;">"org/subtree-view"</span>)
  <span style="font-style: italic;">"A directory where generated html files are located in `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">my/org-subtree-view-in-browser</span><span style="font-style: italic;">'."</span>)

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/org-subtree-view-in-browser</span> ()
  <span style="font-style: italic;">"Display org subtree at point as HTML.</span>

<span style="font-style: italic;">If cursor points before first heading, all org sub-trees in the buffer will be</span>
<span style="font-style: italic;">displayed instead."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">let*</span> ((heading (org-get-heading t t t t))
         (org-export-show-temporary-export-buffer nil)
         (export-buf-name <span style="font-style: italic;">"*Org HTML Export*"</span>)
         (org-export-with-broken-links 'mark)
         (org-export-babel-evaluate t)
         (org-export-preserve-breaks t)
         (id (org-id-get))
         (uuid (downcase (<span style="font-weight: bold;">if</span> id id (org-id-uuid))))
         (html-file (format <span style="font-style: italic;">"%s/%s.html"</span> my/org-subtree-view-directory uuid)))
    (org-html-export-as-html nil (not (org-before-first-heading-p)) nil)
    (<span style="font-weight: bold;">with-current-buffer</span> export-buf-name
      (write-file html-file))
    (browse-url-of-file html-file)))
</pre>
</div>
</div>
</li>

<li><a id="org65a8b05"></a>alter org heading<br />
<div class="outline-text-5" id="text-org65a8b05">
<p>
<a href="https://www.p-snow.org/posts/20231121_1858/">I wrote a blog post</a> for this topic.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">with-eval-after-load</span> 'org
  (bind-keys <span style="font-weight: bold;">:map</span> org-mode-map
             (<span style="font-style: italic;">"C-c C-% h"</span> . my/org-change-heading)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/org-change-heading</span> ()
  <span style="font-style: italic;">"CHange the heading of the entry at `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">point</span><span style="font-style: italic;">'.</span>

<span style="font-style: italic;">The previous name will be stored along with the execution date."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">let*</span> ((old-heading (org-get-heading t t t t))
         (new-heading (read-string <span style="font-style: italic;">"Heading: "</span> old-heading)))
    (<span style="font-weight: bold;">save-excursion</span>
      (org-back-to-heading t)
      (replace-string old-heading new-heading nil
                      (line-beginning-position) (line-end-position))
      (org-align-tags))
    (org-add-log-setup 'state new-heading old-heading 'state)))
</pre>
</div>
</div>
</li>

<li><a id="org4ee38c0"></a>download media files in org&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span><br /></li>

<li><a id="orga7a3446"></a>manage on-hold tasks<br />
<div class="outline-text-5" id="text-orga7a3446">
<ul class="org-ul">
<li><p>
task lifecycle
</p>
<div class="org-src-container">
<pre class="src src-dot">digraph{
<span style="font-style: italic;">"web browsing"</span> [shape = hexagon];
<span style="font-style: italic;">"web browsing"</span> -&gt; task [label = <span style="font-style: italic;">"read later"</span>];
elfeed [shape = hexagon];
elfeed -&gt; task [label = <span style="font-style: italic;">"watch later"</span>];
<span style="font-style: italic;">"web browsing"</span> -&gt; someday [label = <span style="font-style: italic;">"read someday"</span>];
task -&gt; someday [label = <span style="font-style: italic;">"expired"</span>];
someday -&gt; task [label = <span style="font-style: italic;">"drill (active)"</span>];
task -&gt; pending [label = <span style="font-style: italic;">"abandoned"</span>];
subgraph cluster_0 {
someday -&gt; someday [label = <span style="font-style: italic;">"drill (inactive)"</span>];
pending;
label = <span style="font-style: italic;">"somedays.org"</span>;
}
}
</pre>
</div></li>
</ul>
</div>

<ul class="org-ul">
<li><a id="org5682a5b"></a>review on-hold tasks<br />
<div class="outline-text-6" id="text-org5682a5b">
<p>
On-hold tasks are encouraged to review and they prohibited to appear in agenda views.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/org-on-hold-task-review</span> (resume-p)
  <span style="font-style: italic;">"Start or resume (if RESUME-P is non-nil) a session for reviewing tasks."</span>
  (<span style="font-weight: bold;">interactive</span> <span style="font-style: italic;">"P"</span>)
  (<span style="font-weight: bold;">progn</span>
    (org-id-goto <span style="font-style: italic;">"58da20ee-97a9-4463-96b8-6ebb1084b9b7"</span>)
    (<span style="font-weight: bold;">let</span> ((org-drill-scope 'tree)
          (org-drill-question-tag my/org-review-tag)
          (org-drill-maximum-items-per-session 40)
          (org-drill-hide-item-headings-p nil)
          <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">drill session regulations</span>
          (org-drill-maximum-duration 12)
          (org-drill-maximum-items-per-session 30)
          (org-drill-item-count-includes-failed-items-p t)
          <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Spaced repetition algorithm</span>
          (org-drill-spaced-repetition-algorithm 'sm5)
          (org-drill-sm5-initial-interval 14.0)
          <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Random variation of repetition intervals</span>
          (org-drill-add-random-noise-to-intervals-p t)
          <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Adjusting item difficulty globally</span>
          (org-drill-learn-fraction 0.37)
          (org-startup-indented nil))
      (<span style="font-weight: bold;">and</span> (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">cl</span> nil t)
           (org-drill nil (format <span style="font-style: italic;">"TODO=\"%s\""</span> my/org-todo-keyword--someday)
                      resume-p)))))
</pre>
</div>
</div>
</li>

<li><a id="org7d77f1e"></a>skip showing on-hold tasks in agenda view<br />
<div class="outline-text-6" id="text-org7d77f1e">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my/org-review-tag</span> <span style="font-style: italic;">"review"</span>
  <span style="font-style: italic;">"Tag name set for tasks which is encourged to review."</span>)

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/org-agenda-skip-on-hold-task</span> ()
  <span style="font-style: italic;">"Skip entries which hold schedule time and review tag in agenda view."</span>
  (<span style="font-weight: bold;">let</span> ((tags (org-get-tags)))
    (<span style="font-weight: bold;">if</span> (<span style="font-weight: bold;">and</span> (member my/org-review-tag (org-get-tags))
             (org-get-scheduled-time (point)))
        (<span style="font-weight: bold;">progn</span> (outline-next-heading) (point))
      nil)))

<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(with-eval-after-load 'org-agenda</span>
<span style="font-weight: bold; font-style: italic;">;;   </span><span style="font-weight: bold; font-style: italic;">(setopt org-agenda-skip-function-global</span>
<span style="font-weight: bold; font-style: italic;">;;           </span><span style="font-weight: bold; font-style: italic;">'my/org-agenda-skip-on-hold-task))</span>
</pre>
</div>
</div>
</li>

<li><a id="orgbe42a76"></a>show on-hold/leg-go task list<br />
<div class="outline-text-6" id="text-orgbe42a76">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">with-eval-after-load</span> 'org-ql-view
  (<span style="font-weight: bold;">push</span> `(<span style="font-style: italic;">"On-Hold tasks"</span>
          <span style="font-weight: bold;">:buffers-files</span> ,(list (file-name-concat org-directory
                                                  <span style="font-style: italic;">"agenda/on-holds.org"</span>))
          <span style="font-weight: bold;">:query</span> (todo ,my/org-todo-keyword--someday)
          <span style="font-weight: bold;">:super-groups</span> ((<span style="font-weight: bold;">:auto-property</span> <span style="font-style: italic;">"ARCHIVE_OLPATH"</span>))
          <span style="font-weight: bold;">:sort</span> (priority date))
        org-ql-views)
  (<span style="font-weight: bold;">push</span> `(<span style="font-style: italic;">"Review: on-hold tasks"</span>
          <span style="font-weight: bold;">:buffers-files</span> ,(list (file-name-concat org-directory
                                                  <span style="font-style: italic;">"agenda/on-holds.org"</span>))
          <span style="font-weight: bold;">:query</span> (todo ,my/org-todo-keyword--someday)
          <span style="font-weight: bold;">:sort</span> (scheduled))
        org-ql-views)
  (<span style="font-weight: bold;">push</span> `(<span style="font-style: italic;">"Let-go tasks"</span>
          <span style="font-weight: bold;">:buffers-files</span> ,(org-agenda-files)
          <span style="font-weight: bold;">:query</span> (todo ,my/org-done-keyword--pending)
          <span style="font-weight: bold;">:super-groups</span> ((<span style="font-weight: bold;">:auto-property</span> <span style="font-style: italic;">"ARCHIVE_OLPATH"</span>))
          <span style="font-weight: bold;">:sort</span> (scheduled priority date))
        org-ql-views))
</pre>
</div>
</div>
</li>

<li><a id="orgbde343d"></a>immediate re-refile on-hold task<br />
<div class="outline-text-6" id="text-orgbde343d">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">with-eval-after-load</span> 'org-refile
  (add-hook 'org-after-refile-insert-hook
            #'my/org-archive-suspended-task))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/org-archive-suspended-task</span> ()
  <span style="font-style: italic;">"Archive this entry to the file for suspended tasks if the TODO state fits the bill."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">when</span> (member (org-entry-get nil <span style="font-style: italic;">"TODO"</span>)
                `(,my/org-todo-keyword--someday ,my/org-done-keyword--pending))
    (org-archive-subtree)))
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="orgcee780c"></a>send org subtree via email<br />
<div class="outline-text-5" id="text-orgcee780c">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">with-eval-after-load</span> 'org-keys
  (bind-keys <span style="font-weight: bold;">:map</span> org-mode-map
             (<span style="font-style: italic;">"C-c M"</span> . my/org-subtree-send-email))
  (add-to-list 'org-speed-commands
               '(<span style="font-style: italic;">"M"</span> . my/org-subtree-send-email)
               t))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/org-subtree-send-email</span> ()
  <span style="font-style: italic;">"Send an email containing the contents of the subtree at the entry at point."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">org-save-outline-visibility</span> t
    (<span style="font-weight: bold;">save-excursion</span>
      (org-fold-show-all)
      (<span style="font-weight: bold;">let*</span> ((heading (org-get-heading t t t t))
             (org-export-with-toc nil)
             (org-export-with-author nil)
             (org-export-show-temporary-export-buffer nil)
             (message-kill-buffer-on-exit t)
             (exp-buf (org-ascii-export-as-ascii nil t t t)))
        (message-mail (cdr (assoc <span style="font-style: italic;">"username"</span> (auth-source-pass-parse-entry <span style="font-style: italic;">"www.zoho.com"</span>)))
                      heading)
        (message-goto-body)
        (insert (<span style="font-weight: bold;">with-current-buffer</span> exp-buf (buffer-string)))
        (message-send-and-exit)))))
</pre>
</div>
</div>
</li>
<li><a id="orgf575f6e"></a>clean up after the task has chenged to DONE<br />
<div class="outline-text-5" id="text-orgf575f6e">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">with-eval-after-load</span> 'org
  (add-hook 'org-after-todo-state-change-hook
            #'my/org-todo-cleanup-when-done))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/org-todo-cleanup-when-done</span> ()
  <span style="font-style: italic;">"Exert several procedure when the state of the task has chnaged to DONE.</span>

<span style="font-style: italic;">Including:</span>
<span style="font-style: italic;">- Remove priority</span>
<span style="font-style: italic;">- Reset DONE state if the task is non-repeated habit</span>
<span style="font-style: italic;">- Close the project of the task"</span>
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">when the entry has any org-done-keywords</span>
  (<span style="font-weight: bold;">when</span> (member org-state
                `(,my/org-done-keyword--done ,my/org-done-keyword--cancel ,my/org-done-keyword--pending))
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">remove priority if exists</span>
    (<span style="font-weight: bold;">and</span> <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">the entry has been set any priority</span>
     (/= 21000 (<span style="font-weight: bold;">save-excursion</span>
                 (<span style="font-weight: bold;">save-match-data</span>
                   (beginning-of-line)
                   (<span style="font-weight: bold;">and</span> (looking-at org-heading-regexp)
                        (org-get-priority (match-string 0))))))
     (org-priority 'remove))
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">reset done state if the task is non-repeated habit</span>
    (<span style="font-weight: bold;">and</span> (org-is-habit-p)
         (not (org-get-scheduled-time (point)))
         (org-todo <span style="font-style: italic;">""</span>))
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">close the project</span>
    (<span style="font-weight: bold;">save-excursion</span>
      (org-back-to-heading t)
      (org-speed-move-safe 'outline-up-heading)
      (<span style="font-weight: bold;">and</span> (member my/org-project-tag (org-get-tags))
           (org-todo my/org-done-keyword--done)))))
</pre>
</div>
</div>
</li>

<li><a id="orgfd14c93"></a>flush old clock logs and state changes<br />
<div class="outline-text-5" id="text-orgfd14c93">
<p>
The hook functions, which is commented out, provoke malfunction failing to create todo state change logs which is necessary for habit graph.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp" id="orgfaa189d">(<span style="font-weight: bold;">with-eval-after-load</span> 'midnight
  (add-hook 'midnight-hook
            (<span style="font-weight: bold;">lambda</span> ()
              (org-map-entries (<span style="font-weight: bold;">lambda</span> () (<span style="font-weight: bold;">when</span> (org-is-habit-p)
                                        (revert-buffer t t t)
                                        (my/org-flush-blobs)
                                        (basic-save-buffer)))
                               nil
                               'agenda))))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp" id="org6948136">(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my/org-flush-blobs-old-timestamp-in-day</span> 90
  <span style="font-style: italic;">"Flush blobs with timestamps that are earlier than this number of days."</span>)

(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my/org-flush-blobs-clock-log</span> t
  <span style="font-style: italic;">"Whether `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">my/org-flush-blobs</span><span style="font-style: italic;">' flushes old clock logs."</span>)

(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my/org-flush-blobs-state-change</span> t
  <span style="font-style: italic;">"Whether `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">my/org-flush-blobs</span><span style="font-style: italic;">' flushes old todo state changes."</span>)

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/org-flush-blobs</span> ()
  <span style="font-style: italic;">"Flush old blob."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">org-save-outline-visibility</span> t
    (org-show-all)
    (<span style="font-weight: bold;">save-excursion</span>
      (<span style="font-weight: bold;">let</span> ((case-fold-search t)
            (next-heading (<span style="font-weight: bold;">save-excursion</span>
                            (org-next-visible-heading 1)
                            (point-marker))))
        (mapc (<span style="font-weight: bold;">lambda</span> (re)
                (org-back-to-heading t)
                (while-let ((ts-time (<span style="font-weight: bold;">and</span> (re-search-forward re (marker-position next-heading) t)
                                          (encode-time (parse-time-string (match-string 1))))))
                  (<span style="font-weight: bold;">when</span> (time-less-p ts-time
                                     (time-subtract (current-time) (days-to-time my/org-flush-blobs-old-timestamp-in-day)))
                    (kill-whole-line))))
              (append (<span style="font-weight: bold;">and</span> my/org-flush-blobs-clock-log
                           (list org-tr-regexp-both))
                      (<span style="font-weight: bold;">and</span> my/org-flush-blobs-state-change
                           (list (concat (<span style="font-weight: bold;">rx</span> <span style="font-style: italic;">"- State "</span> <span style="font-style: italic;">"\""</span> (&gt;= 1 upper) <span style="font-style: italic;">"\""</span> (+ space)
                                             <span style="font-style: italic;">"from "</span> (opt <span style="font-style: italic;">"\""</span> (&gt;= 1 upper) <span style="font-style: italic;">"\""</span>) (+ space))
                                         org-ts-regexp-inactive)))))
        (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">featurep</span> '<span style="font-weight: bold; text-decoration: underline;">org-clock</span>)
          (org-clock-remove-empty-clock-drawer))))))
</pre>
</div>
</div>

<ul class="org-ul">
<li><a id="org8a288fd"></a>batch blob flushing&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span><br /></li>
</ul>
</li>

<li><a id="org8bfb255"></a>pad non-clocking time with break task<br />
<div class="outline-text-5" id="text-org8bfb255">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">with-eval-after-load</span> 'org-clock
  (add-hook 'org-clock-out-hook #'my/org-clock-in-break-time))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/org-clock-in-break-time</span> ()
  <span style="font-style: italic;">"Clock in the 'Break' task automatically as to pat non-clocking time."</span>
  (<span style="font-weight: bold;">let</span> ((break-task-id <span style="font-style: italic;">"d49d97de-58ec-4e41-b58c-491a9e216e1c"</span>))
    (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">and</span> (not org-clock-clocking-in)
               (not (string= (<span style="font-weight: bold;">or</span> (<span style="font-weight: bold;">save-excursion</span>
                                   (org-clock-goto)
                                   (org-id-get))
                                 <span style="font-style: italic;">""</span>)
                             break-task-id)))
      (<span style="font-weight: bold;">org-with-point-at</span> (org-id-find break-task-id t)
        (org-clock-in)))))
</pre>
</div>
</div>
</li>

<li><a id="org06cc91e"></a>show week number from the timestamp at point<br />
<div class="outline-text-5" id="text-org06cc91e">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/org-iso-week-at-point</span> ()
  <span style="font-style: italic;">"Display ISO 8601 week number correspoinds to time stamp at point."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">when-let</span> ((ts-bound (org-in-regexp (org-re-timestamp 'all)))
             (ts (buffer-substring (car ts-bound) (cdr ts-bound))))
    (message <span style="font-style: italic;">"W%s"</span> (format-time-string <span style="font-style: italic;">"%V"</span> (org-read-date nil t ts nil)))))
</pre>
</div>
</div>
</li>

<li><a id="orgf98e301"></a>show outline path for the entry at point<br />
<div class="outline-text-5" id="text-orgf98e301">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/org-show-outline-path</span> ()
  <span style="font-style: italic;">"Show sparse tree for the entry at point to represent outline path."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">save-excursion</span>
    (<span style="font-weight: bold;">cl-labels</span> ((lookup-parent ()
                  (<span style="font-weight: bold;">let*</span> ((heading-raw (substring-no-properties
                                       (org-get-heading t t t t)))
                         (heading (<span style="font-weight: bold;">if</span> (string-match org-link-bracket-re heading-raw)
                                      (match-string 2 heading-raw)
                                    heading-raw))
                         (h-li (list heading)))
                    (<span style="font-weight: bold;">if</span> (org-up-heading-safe)
                        (append (lookup-parent) h-li)
                      h-li))))
      (org-ql-sparse-tree (format <span style="font-style: italic;">"(olps %s)"</span>
                                  (mapconcat (<span style="font-weight: bold;">lambda</span> (str) (format <span style="font-style: italic;">"\"%s\""</span> str))
                                             (lookup-parent)
                                             <span style="font-style: italic;">" "</span>))))))

(<span style="font-weight: bold;">with-eval-after-load</span> 'my/org-mode-init
  (keymap-set org-mode-map <span style="font-style: italic;">"C-c M-/"</span>
              #'my/org-show-outline-path))
</pre>
</div>
</div>
</li>

<li><a id="org861db8c"></a>use ISO week tree instead of Y/M/D tree<br />
<div class="outline-text-5" id="text-org861db8c">
<p>
Following code is also responsible for deterministic archive location.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">with-eval-after-load</span> 'org-archive
  (advice-add #'org-archive-subtree <span style="font-weight: bold;">:around</span>
              #'my/org-archive-subtree--iso-datetree))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/org-archive-subtree--iso-datetree</span> (oldfun <span style="font-weight: bold; text-decoration: underline;">&amp;rest</span> r)
  <span style="font-style: italic;">"Move the current subtree to the archive.</span>

<span style="font-style: italic;">If archiving location is datetree, it supposed to be iso week tree."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">when</span> (member (org-get-todo-state)
                `(,my/org-todo-keyword--urgent ,my/org-todo-keyword--todo ,my/org-todo-keyword--next ,my/org-todo-keyword--in-action))
    (org-todo my/org-done-keyword--cancel))
  (<span style="font-weight: bold;">when</span> (string= (org-get-todo-state)
                 my/org-todo-keyword--someday)
    (org-toggle-tag my/org-review-tag 'on))
  (<span style="font-weight: bold;">let*</span> ((todo-state (org-get-todo-state))
         (closed-time (org-entry-get nil <span style="font-style: italic;">"CLOSED"</span> t))
         (org-archive-location
          (<span style="font-weight: bold;">cond</span>
           ((member todo-state
                    `(nil ,my/org-done-keyword--done ,my/org-done-keyword--cancel))
            (format <span style="font-style: italic;">"%s::datetree/"</span>
                    (file-name-concat org-directory <span style="font-style: italic;">"archive"</span>
                                      (format <span style="font-style: italic;">"archive_%s.org"</span>
                                              (<span style="font-weight: bold;">if</span> closed-time
                                                  (nth 5
                                                       (parse-time-string
                                                        (substring closed-time 1 -1)))
                                                (format-time-string <span style="font-style: italic;">"%Y"</span>))))))
           ((string= todo-state my/org-todo-keyword--someday)
            (format <span style="font-style: italic;">"%s::* on-hold tasks"</span>
                    (expand-file-name <span style="font-style: italic;">"agenda/on-holds.org"</span> org-directory)))
           ((string= todo-state my/org-done-keyword--pending)
            (format <span style="font-style: italic;">"%s::* let go tasks"</span>
                    (expand-file-name <span style="font-style: italic;">"archive/agenda/let-goes.org"</span> org-directory))))))
    (<span style="font-weight: bold;">when</span> (stringp org-archive-location)
      (<span style="font-weight: bold;">and</span> (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">org-relate</span> nil t)
           (org-relate-interrelate))
      (advice-add #'org-datetree-find-date-create <span style="font-weight: bold;">:override</span>
                  #'org-datetree-find-iso-week-create)
      (apply oldfun r)
      (advice-remove #'org-datetree-find-date-create
                     #'org-datetree-find-iso-week-create))))

(<span style="font-weight: bold;">with-eval-after-load</span> 'org-agenda
  (define-key org-agenda-mode-map (kbd <span style="font-style: italic;">"C"</span>) #'my/org-archive-find--iso-datetree))

(<span style="font-weight: bold;">with-eval-after-load</span> 'calendar
  (define-key calendar-mode-map (kbd <span style="font-style: italic;">"C"</span>) #'my/org-archive-find--iso-datetree))

<span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/org-archive-find--iso-datetree</span> (date)
  <span style="font-style: italic;">"Find and visit the location of DATE in archivee file.</span>

<span style="font-style: italic;">DATE must be a string representing the date to find and parsable with `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">format-time-string</span><span style="font-style: italic;">'.</span>

<span style="font-style: italic;">If called interactively, it prompt the user to select the date to find."</span>
  (<span style="font-weight: bold;">interactive</span>
   (<span style="font-weight: bold;">cond</span>
    ((eq major-mode 'calendar-mode)
     (list (calendar-date-string (calendar-cursor-to-date))))
    ((eq major-mode 'org-agenda-mode)
     (<span style="font-weight: bold;">let*</span> ((day (<span style="font-weight: bold;">or</span> (get-text-property (min (1- (point-max)) (point)) 'day)
                     (<span style="font-weight: bold;">user-error</span> <span style="font-style: italic;">"Don't know which date to open in calendar"</span>)))
            (date (calendar-gregorian-from-absolute day)))
       (list (calendar-date-string date))))
    (t (<span style="font-weight: bold;">let</span> ((date-select (org-read-date)))
         (list date-select)))))
  (<span style="font-weight: bold;">let*</span> ((d (parse-time-string date))
         (day (decoded-time-day d))
         (month (decoded-time-month d))
         (year (decoded-time-year d)))
    (find-file (file-name-concat org-directory <span style="font-style: italic;">"archive"</span> (format <span style="font-style: italic;">"archive_%d.org"</span> year)))
    (org-datetree-find-iso-week-create `(,month ,day ,year))))

(<span style="font-weight: bold;">with-eval-after-load</span> 'my-org-global-map
  (bind-keys <span style="font-weight: bold;">:map</span> my/org-global-map
             (<span style="font-style: italic;">"D"</span> . my/org-archive-find--iso-datetree)))
</pre>
</div>
</div>
</li>

<li><a id="org873b928"></a>search org entry under 'default-directory'<br />
<div class="outline-text-5" id="text-org873b928">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defmacro</span> <span style="font-weight: bold;">with-org-files-under</span> (<span style="font-weight: bold; text-decoration: underline;">&amp;rest</span> body)
  <span style="font-style: italic;">"Eval `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">BODY</span><span style="font-style: italic;">' with providing org file list from `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">default-directory</span><span style="font-style: italic;">'."</span>
  (<span style="font-weight: bold;">declare</span> (indent defun))
  `(<span style="font-weight: bold;">let</span> ((org-files (directory-files-recursively
                     default-directory
                     <span style="font-style: italic;">"</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(?:</span><span style="font-style: italic;">\\.org</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(?:</span><span style="font-style: italic;">\\.gpg</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">?$</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">"</span>)))
     ,@body))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/consult-org-heading-under</span> ()
  <span style="font-style: italic;">"Invoke `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">consult-org-heading</span><span style="font-style: italic;">' with all org files under `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">default-directory</span><span style="font-style: italic;">'."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (with-org-files-under
    (<span style="font-weight: bold;">let</span> ((org-agenda-files org-files))
      (consult-org-agenda))))

(<span style="font-weight: bold;">with-eval-after-load</span> 'embark
  (keymap-set embark-file-map <span style="font-style: italic;">"H"</span>
              (<span style="font-weight: bold;">lambda</span> (dir) (<span style="font-weight: bold;">interactive</span> <span style="font-style: italic;">"sDir: "</span>)
                (<span style="font-weight: bold;">let</span> ((default-directory dir))
                  (my/consult-org-heading-under)))))

(<span style="font-weight: bold;">with-eval-after-load</span> 'my-org-global-map
  (keymap-set my/org-global-map <span style="font-style: italic;">"H"</span>
              #'my/consult-org-heading-under))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/org-ql-search-under</span> ()
  <span style="font-style: italic;">"Invoke `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">org-ql-search</span><span style="font-style: italic;">' with all org files under `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">default-directory</span><span style="font-style: italic;">'."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (with-org-files-under
    (<span style="font-weight: bold;">let</span> ((org-agenda-files org-files)
          (query (read-string <span style="font-style: italic;">"Query: "</span>)))
      (org-ql-search (org-agenda-files) query))))

(<span style="font-weight: bold;">with-eval-after-load</span> 'embark
  (keymap-set embark-file-map <span style="font-style: italic;">"Q"</span>
              (<span style="font-weight: bold;">lambda</span> (dir) (<span style="font-weight: bold;">interactive</span> <span style="font-style: italic;">"sDir: "</span>)
                (<span style="font-weight: bold;">let</span> ((default-directory dir))
                  (my/org-ql-search-under)))))

(<span style="font-weight: bold;">with-eval-after-load</span> 'my-org-global-map
  (keymap-set my/org-global-map <span style="font-style: italic;">"q Q"</span>
              #'my/org-ql-search-under))
</pre>
</div>
</div>
</li>

<li><a id="org2ad88cd"></a>read well-used org files insidiously<br />
<div class="outline-text-5" id="text-org2ad88cd">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package read-org-agenda-files
  <span style="font-weight: bold;">:no-require</span> t
  <span style="font-weight: bold;">:after</span> org
  <span style="font-weight: bold;">:config</span>
  (run-with-idle-timer (* 30) nil
                       (<span style="font-weight: bold;">lambda</span> ()
                         <span style="font-style: italic;">"Read org agenda files."</span>
                         (mapc #'find-file-noselect
                               (org-agenda-files)))))

(use-package read-large-org-file
  <span style="font-weight: bold;">:no-require</span> t
  <span style="font-weight: bold;">:after</span> (org denote)
  <span style="font-weight: bold;">:config</span>
  (run-with-idle-timer (* 3 60) nil
                       (<span style="font-weight: bold;">lambda</span> ()
                         <span style="font-style: italic;">"Read large org files."</span>
                         (mapc #'find-file-noselect
                               (list (denote-get-path-by-id <span style="font-style: italic;">"20230605T170959"</span>)
                                     (file-name-concat org-directory (format-time-string <span style="font-style: italic;">"archive/archive_%Y.org"</span>)))))))
</pre>
</div>
</div>
</li>
</ul>
</div>

<div id="outline-container-org87a4e81" class="outline-4">
<h4 id="org87a4e81">would-be packages</h4>
<div class="outline-text-4" id="text-org87a4e81">
</div>
<ul class="org-ul">
<li><a id="org468621a"></a>lfile (custom org link type)<br />
<div class="outline-text-5" id="text-org468621a">
<p>
lfile is an extended org link type for files in local machine. It is inspired by <a href="https://karl-voit.at/2022/02/10/lfile/">Kerl Voit's implementation</a>.
It is implemented using abbrev mechanism since functionality of file: link type such as inline image or exporting can be easily imparted.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">lfile</span>)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">ol</span>)
(<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">org-element</span>)

(<span style="font-weight: bold;">with-eval-after-load</span> 'ol
  (add-to-list 'org-link-abbrev-alist
               '(<span style="font-style: italic;">"lfile"</span> . <span style="font-style: italic;">"file:%(lfile-locate)"</span>)
               t)
  (add-to-list 'org-link-abbrev-alist
               '(<span style="font-style: italic;">"lfile+emacs"</span> . <span style="font-style: italic;">"file+emacs:%(lfile-locate)"</span>)
               t)
  (add-to-list 'org-link-abbrev-alist
               '(<span style="font-style: italic;">"lfile+sys"</span> . <span style="font-style: italic;">"file+sys:%(lfile-locate)"</span>)
               t))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">lfile-locate</span> (tag)
  <span style="font-style: italic;">"Return a path found using TAG with locate program."</span>
  (<span style="font-weight: bold;">let*</span> ((match-idx (string-match <span style="font-style: italic;">"^</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">[</span><span style="font-style: italic;">^</span><span style="font-style: italic;">:]*</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">::?</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">.*</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">?$"</span> tag))
         (link (<span style="font-weight: bold;">if</span> match-idx (match-string 1 tag) tag)))
    (concat (string-trim
             (shell-command-to-string
              (concat (format <span style="font-style: italic;">"plocate -d &lt;&lt;plocate-db()&gt;&gt; -e \"%s\" 2&gt;/dev/null"</span>
                              (shell-quote-argument link))
                      <span style="font-style: italic;">" | head --lines=1"</span>)))
            (<span style="font-weight: bold;">when</span> match-idx (match-string 2 tag)))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">lfile-store-link</span> ()
  <span style="font-style: italic;">"Store a lfile link.</span>

<span style="font-style: italic;">Prefix argument does matter in this function call.</span>
<span style="font-style: italic;">If `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">C-u</span><span style="font-style: italic;">' prefix is given, file: link type will be used instead."</span>
  (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">and</span> (derived-mode-p 'dired-mode)
             (string-match-p
              (format <span style="font-style: italic;">"^%s"</span> (expand-file-name <span style="font-style: italic;">"~"</span>))
              (dired-current-directory nil)))
    (<span style="font-weight: bold;">let</span> ((path (dired-get-filename nil t)))
      (<span style="font-weight: bold;">if</span> (equal current-prefix-arg '(4))
          (org-link-store-props
           <span style="font-weight: bold;">:type</span> <span style="font-style: italic;">"file"</span>
           <span style="font-weight: bold;">:link</span> (concat <span style="font-style: italic;">"file:"</span> (abbreviate-file-name
                                  (expand-file-name path))))
        (org-link-store-props
         <span style="font-weight: bold;">:type</span> <span style="font-style: italic;">"lfile"</span>
         <span style="font-weight: bold;">:link</span> (concat <span style="font-style: italic;">"lfile:"</span> (file-name-nondirectory path)))))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">lfile-abbrev</span> (raw-link <span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> path-conv-fn)
  <span style="font-style: italic;">"Return an abbreviated lfile link from RAW-LINK.</span>

<span style="font-style: italic;">RAW-LINK is supposed to be a file link type with a path and the path is</span>
<span style="font-style: italic;">converted by `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">file-name-nondirectory</span><span style="font-style: italic;">' unless PATH-CONV-FN is supplied."</span>
  (<span style="font-weight: bold;">let*</span> ((link (<span style="font-weight: bold;">with-temp-buffer</span>
                 (<span style="font-weight: bold;">let</span> ((org-inhibit-startup nil))
                   (insert raw-link)
                   (org-mode)
                   (goto-char (point-min))
                   (org-element-link-parser))))
         (type (org-element-property <span style="font-weight: bold;">:type</span> link))
         (path (org-element-property <span style="font-weight: bold;">:path</span> link))
         (abbrev-link (<span style="font-weight: bold;">cond</span>
                       ((string= type <span style="font-style: italic;">"file"</span>)
                        (format <span style="font-style: italic;">"%s:%s"</span>
                                <span style="font-style: italic;">"lfile"</span>
                                (<span style="font-weight: bold;">if</span> (functionp path-conv-fn)
                                    (funcall path-conv-fn path)
                                  (file-name-nondirectory path))))
                       ((stringp type)
                        raw-link)
                       (t nil))))
    abbrev-link))

(<span style="font-weight: bold;">with-eval-after-load</span> 'org
  (org-link-set-parameters <span style="font-style: italic;">"lfile"</span>
                           <span style="font-weight: bold;">:store</span> #'lfile-store-link))

(<span style="font-weight: bold;">provide</span> '<span style="font-weight: bold; text-decoration: underline;">lfile</span>)
</pre>
</div>
</div>

<ul class="org-ul">
<li><a id="orgb437c35"></a>lfile (legacy)&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span><br /></li>
</ul>
</li>

<li><a id="org400aeaa"></a>open-file<br />
<div class="outline-text-5" id="text-org400aeaa">
<p>
Open-file is a feature that allows you to specify the application to open a file based on its type.
</p>

<p>
By default, PDF and EPUB files are opened in EWW after converted into HTML. Videos and audio files are played in MPV media player.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp" id="org2d7e1a2">(no-littering-expand-var-file-name <span style="font-style: italic;">"open-file"</span>)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-conf">d &lt;&lt;open-file-dir()&gt;&gt; 0755 - - 14d
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">open-file</span>)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp" id="org7d1125e"><span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">general functions</span>

(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my/open-file-dir</span>
  (no-littering-expand-var-file-name <span style="font-style: italic;">"open-file"</span>)
  <span style="font-style: italic;">"Directory where html file is converted into."</span>)

(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my/open-file-media-player</span> <span style="font-style: italic;">"mpv"</span>
  <span style="font-style: italic;">"Media player used to play media file in open-file."</span>)

(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my/open-file-media-extensions</span>
  '(<span style="font-style: italic;">"mpg"</span> <span style="font-style: italic;">"mpeg"</span> <span style="font-style: italic;">"mp3"</span> <span style="font-style: italic;">"mp4"</span> <span style="font-style: italic;">"m4v"</span> <span style="font-style: italic;">"m4a"</span>
    <span style="font-style: italic;">"avi"</span> <span style="font-style: italic;">"wmv"</span> <span style="font-style: italic;">"wav"</span> <span style="font-style: italic;">"mov"</span> <span style="font-style: italic;">"flv"</span> <span style="font-style: italic;">"mkv"</span> <span style="font-style: italic;">"mka"</span> <span style="font-style: italic;">"webm"</span> <span style="font-style: italic;">"3gp"</span>
    <span style="font-style: italic;">"flac"</span> <span style="font-style: italic;">"ogv"</span> <span style="font-style: italic;">"oga"</span> <span style="font-style: italic;">"ogx"</span> <span style="font-style: italic;">"ogg"</span> <span style="font-style: italic;">"spx"</span> <span style="font-style: italic;">"opus"</span>
    <span style="font-style: italic;">"xbm"</span> <span style="font-style: italic;">"pbm"</span> <span style="font-style: italic;">"pgm"</span> <span style="font-style: italic;">"ppm"</span> <span style="font-style: italic;">"pnm"</span> <span style="font-style: italic;">"png"</span> <span style="font-style: italic;">"gif"</span> <span style="font-style: italic;">"bmp"</span> <span style="font-style: italic;">"tif"</span> <span style="font-style: italic;">"jpeg"</span> <span style="font-style: italic;">"jpg"</span> <span style="font-style: italic;">"webp"</span>)
  <span style="font-style: italic;">"Extensions files which can play with media player must have."</span>)

(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my/open-file-compressed-media-extensions</span>
  '(<span style="font-style: italic;">"tar.gz"</span> <span style="font-style: italic;">"tgz"</span> <span style="font-style: italic;">"tar.xz"</span> <span style="font-style: italic;">"txz"</span> <span style="font-style: italic;">"zip"</span> <span style="font-style: italic;">"7z"</span>)
  <span style="font-style: italic;">"Extensions compressed files which can play with media player must have."</span>)

<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">TODO: This could be achieved by command builder</span>
(<span style="font-weight: bold;">defmacro</span> <span style="font-weight: bold;">my/open-file-as-html</span> (file convert-cmd)
  `(<span style="font-weight: bold;">let*</span> ((cap-command (<span style="font-weight: bold;">if</span> (string-match-p url-handler-regexp ,file)
                           <span style="font-style: italic;">"curl"</span>
                         (<span style="font-weight: bold;">if</span> (string-suffix-p <span style="font-style: italic;">".gpg"</span> ,file)
                             <span style="font-style: italic;">"gpg -d"</span>
                           <span style="font-style: italic;">"cat"</span>)))
          (dir-name
           (seq-reduce (<span style="font-weight: bold;">lambda</span> (str rep)
                         (string-replace (car rep) (cdr rep) str))
                       '((<span style="font-style: italic;">"/"</span> . <span style="font-style: italic;">"!"</span>)
                         (<span style="font-style: italic;">"~"</span> . <span style="font-style: italic;">"`"</span>))
                       ,file))
          (dirname-html
           (expand-file-name
            dir-name
            my/open-file-dir))
          (filename-html
           (concat (file-name-as-directory dirname-html)
                   <span style="font-style: italic;">"index.html"</span>))
          (command ,convert-cmd))
     (<span style="font-weight: bold;">unless</span> (file-exists-p filename-html)
       (make-directory dirname-html t)
       (call-process-shell-command command))
     (browse-url filename-html)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/open-pdf-as-html</span> (pdf)
  <span style="font-style: italic;">"Open PDF in `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">eww</span><span style="font-style: italic;">' after the process of convertion into html."</span>
  (my/open-file-as-html
   (expand-file-name pdf)
   (format <span style="font-style: italic;">"%1$s %2$s 2&gt;/dev/null | pdftohtml -p -s -noframes -nomerge -nodrm - %3$s"</span>
           cap-command
           (shell-quote-argument (expand-file-name pdf))
           (shell-quote-argument filename-html))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/open-epub-as-html</span> (epub)
  <span style="font-style: italic;">"Open EPUB in `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">eww</span><span style="font-style: italic;">' after the process of convertion into html."</span>
  (<span style="font-weight: bold;">let</span> ((exp-epub (<span style="font-weight: bold;">if</span> (file-exists-p epub)
                      (expand-file-name epub)
                    epub)))
    (my/open-file-as-html
     exp-epub
     (format <span style="font-style: italic;">"%1$s %2$s 2&gt;/dev/null | pandoc --from=epub --to=html --extract-media=%3$s - | strip_ruby &gt; %4$s"</span>
             cap-command
             (shell-quote-argument exp-epub)
             (shell-quote-argument dirname-html)
             (shell-quote-argument filename-html)))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/open-media</span> (media <span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> query)
  <span style="font-style: italic;">"Open MEDIA file in media player with respecting QUERY.</span>

<span style="font-style: italic;">QUERY must comply to RFC 822 format, which holds attribute/value pairs."</span>
  (<span style="font-weight: bold;">let</span> ((ask-file (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">or</span> (file-directory-p media)
                            (string-match-p (eval `(<span style="font-weight: bold;">rx</span> (<span style="font-weight: bold;">or</span> ,@my/open-file-compressed-media-extensions)))
                                            media))
                    (file-name-nondirectory media))))
    (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">or</span> (not ask-file)
              (<span style="font-weight: bold;">and</span> ask-file
                   (y-or-n-p (format <span style="font-style: italic;">"Play %s?: "</span> ask-file))))
      (apply 'funcall-interactively
             'mpv-dispatch-dwim media nil
             (<span style="font-weight: bold;">and</span> (stringp query)
                  (<span style="font-weight: bold;">let</span> ((start) (end))
                    (mapc (<span style="font-weight: bold;">lambda</span> (cons-cell)
                            (<span style="font-weight: bold;">pcase</span> cons-cell
                              (`(,val <span style="font-style: italic;">""</span>) (<span style="font-weight: bold;">setq</span> start val))
                              (`(,(<span style="font-weight: bold;">or</span> <span style="font-style: italic;">"s"</span> <span style="font-style: italic;">"start"</span>) . (,val)) (<span style="font-weight: bold;">setq</span> start val))
                              (`(,(<span style="font-weight: bold;">or</span> <span style="font-style: italic;">"e"</span> <span style="font-style: italic;">"end"</span>) . (,val)) (<span style="font-weight: bold;">setq</span> end val))))
                          (url-parse-query-string query))
                    `(,start ,end))
                  )))))

<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">==============================================</span>
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">browse-url handling</span>

(<span style="font-weight: bold;">with-eval-after-load</span> 'browse-url
  (setopt browse-url-handlers
          `(((<span style="font-weight: bold;">lambda</span> (url) (equal current-prefix-arg '(16)))
             . browse-url-firefox)
            ((<span style="font-weight: bold;">lambda</span> (url) (equal current-prefix-arg '(4)))
             . browse-url-emacs)
            (<span style="font-style: italic;">"\\.html\\'"</span>
             . (<span style="font-weight: bold;">lambda</span> (url <span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> same-window)
                 (<span style="font-weight: bold;">cond</span>
                  ((file-exists-p url) (eww-open-file url))
                  ((string-match-p url-handler-regexp url)
                   (browse-web url)))))
            (<span style="font-style: italic;">"\\.pdf</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">\\.gpg</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">?\\'"</span> . (<span style="font-weight: bold;">lambda</span> (url <span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> same-window)
                                          (my/open-pdf-as-html url)))
            (<span style="font-style: italic;">"\\.epub\\'"</span> . (<span style="font-weight: bold;">lambda</span> (url <span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> same-window)
                              (my/open-epub-as-html url)))
            (,(eval `(<span style="font-weight: bold;">rx</span> <span style="font-style: italic;">"."</span> (<span style="font-weight: bold;">or</span> ,@my/open-file-media-extensions
                                 ,@my/open-file-compressed-media-extensions)
                         (opt <span style="font-style: italic;">".gpg"</span>)))
             . my/open-media))))

<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">==============================================</span>
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">org-open handling</span>

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/org-open-html</span> (file-path link-string)
  <span style="font-style: italic;">"Open a html file at FILE-PATH via org-open command."</span>
  (browse-url file-path)
  (<span style="font-weight: bold;">when-let</span> ((search (my/org-link-search link-string)))
    (org-link-search search)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/org-open-pdf</span> (file-path link-string)
  <span style="font-style: italic;">"Open a pdf file at FILE-PATH via org-open command."</span>
  (my/open-pdf-as-html file-path)
  (<span style="font-weight: bold;">when-let</span> ((search (my/org-link-search link-string)))
    (org-link-search search)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/org-open-epub</span> (file-path link-string)
  <span style="font-style: italic;">"Open an epub file at FILE-PATH via org-open command."</span>
  (my/open-epub-as-html file-path)
  (<span style="font-weight: bold;">when-let</span> ((search (my/org-link-search link-string)))
    (org-link-search search)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/org-open-media</span> (file-path link-string)
  <span style="font-style: italic;">"Open a media file at FILE-PATH via org-open command."</span>
  (my/open-media file-path
                 (my/org-link-search link-string)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/org-link-search</span> (link-string)
  (<span style="font-weight: bold;">and</span> (stringp link-string)
       (string-match <span style="font-style: italic;">"::</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">.*</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">\\'"</span> link-string)
       (match-string 1 link-string)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/org-execute-file-search-line-number</span> (s)
  <span style="font-style: italic;">"A search function responsible for line number inside of S."</span>
  (<span style="font-weight: bold;">and</span> (string-match (<span style="font-weight: bold;">rx</span> bos
                         (opt <span style="font-style: italic;">"l="</span>)
                         (group-n 1
                           (opt (<span style="font-weight: bold;">or</span> ?- ?+))
                           (1+ digit))
                         eos)
                     s)
       (goto-line (string-to-number (match-string 1 s)))))

(add-hook 'org-execute-file-search-functions
          'my/org-execute-file-search-line-number)

(<span style="font-weight: bold;">with-eval-after-load</span> 'org
  (setopt org-file-apps
          `((<span style="font-style: italic;">"\\.html\\'"</span> . my/org-open-html)
            (<span style="font-style: italic;">"\\.pdf</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">\\.gpg</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">?\\'"</span> . my/org-open-pdf)
            (<span style="font-style: italic;">"\\.epub\\'"</span> . my/org-open-epub)
            (,(eval `(<span style="font-weight: bold;">rx</span> <span style="font-style: italic;">"."</span> (<span style="font-weight: bold;">or</span> ,@my/open-file-media-extensions
                                 ,@my/open-file-compressed-media-extensions)
                         (opt <span style="font-style: italic;">".gpg"</span>) string-end))
             . my/org-open-media)
            (auto-mode . emacs)
            (directory . my/org-open-media)
            (system . browse-url-default-browser))))

<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">==============================================</span>
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">dired-open handling</span>

(<span style="font-weight: bold;">with-eval-after-load</span> 'dired-open
  (<span style="font-weight: bold;">setq</span> dired-open-functions '(dired-open-call-function-by-extension
                               dired-open-by-extension
                               dired-open-subdir)
        dired-open-extensions-elisp `((<span style="font-style: italic;">"pdf"</span> . my/open-pdf-as-html)
                                      (<span style="font-style: italic;">"epub"</span> . my/open-epub-as-html)
                                      ,@(mapcar (<span style="font-weight: bold;">lambda</span> (ext)
                                                  (cons ext 'my/open-media))
                                                my/open-file-media-extensions))
        dired-open-find-file-function 'my/dired-find-file))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/dired-find-file</span> ()
  <span style="font-style: italic;">"A function for `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">dired-open-find-file-function</span><span style="font-style: italic;">' dealing with</span>
<span style="font-style: italic;">a `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">dired-open-file</span><span style="font-style: italic;">' call with `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">C-u</span><span style="font-style: italic;">' or `C-u C-u'."</span>
  (<span style="font-weight: bold;">let</span> ((file-for-visit (dired-get-file-for-visit)))
    (<span style="font-weight: bold;">cond</span>
     ((equal current-prefix-arg '(16))
      (browse-url-default-browser file-for-visit))
     ((equal current-prefix-arg '(4))
      (dired--find-possibly-alternative-file file-for-visit))
     ((string-match-p (eval `(<span style="font-weight: bold;">rx</span> (<span style="font-weight: bold;">or</span> ,@my/open-file-compressed-media-extensions)))
                      file-for-visit)
      (my/open-media file-for-visit))
     (t (dired-find-file)))))

(<span style="font-weight: bold;">provide</span> '<span style="font-weight: bold; text-decoration: underline;">open-file</span>)
</pre>
</div>

<ul class="org-ul">
<li><p>
get original file name from converted html file
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/open-file-original-file</span> (html)
  <span style="font-style: italic;">"Revert HTML file into original file name."</span>
  (<span style="font-weight: bold;">interactive</span> (list (<span style="font-weight: bold;">if</span> (use-region-p)
                         (buffer-substring (use-region-beginning)
                                           (use-region-end))
                       (read-string <span style="font-style: italic;">"HTML: "</span>))))
  (<span style="font-weight: bold;">when-let*</span> ((regex (<span style="font-weight: bold;">rx</span> (group-n 1 (opt (<span style="font-weight: bold;">or</span> <span style="font-style: italic;">"file://"</span> <span style="font-style: italic;">"file:~"</span>)))
                         (1+ (: <span style="font-style: italic;">"/"</span> (1+ nonl)))
                         (group-n 2 (1+ (: <span style="font-style: italic;">"!"</span> (1+ (: nonl)))))
                         <span style="font-style: italic;">"/index.html"</span>))
              (index (string-match regex html))
              (rep (concat (<span style="font-weight: bold;">and</span> (cl-some (<span style="font-weight: bold;">lambda</span> (cand)
                                           (string= cand (match-string 1 html)))
                                         '(<span style="font-style: italic;">"file://"</span> <span style="font-style: italic;">"file:~"</span>))
                                <span style="font-style: italic;">"lfile:"</span>)
                           (substring (match-string 2 html) 1))))
    (<span style="font-weight: bold;">if</span> (use-region-p)
        (replace-string-in-region html rep)
      (princ (replace-regexp-in-string regex rep html)))))
</pre>
</div></li>
</ul>
</div>
</li>

<li><a id="orgf1246b8"></a>org-password-store<br />
<div class="outline-text-5" id="text-orgf1246b8">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package org-password-store
  <span style="font-weight: bold;">:after</span> org
  <span style="font-weight: bold;">:bind</span> (<span style="font-weight: bold;">:map</span> org-mode-map
              (<span style="font-style: italic;">"C-c p c c"</span> . my/password-store-copy)
              (<span style="font-style: italic;">"C-c p c f"</span> . my/password-store-copy-field)
              (<span style="font-style: italic;">"C-c p s"</span> . my/password-store-show-field)
              (<span style="font-style: italic;">"C-c p w"</span> . my/password-store-url)
              (<span style="font-style: italic;">"C-c p l"</span> . my/password-store-web-login)
              (<span style="font-style: italic;">"C-c p n"</span> . my/password-store-create)
              (<span style="font-style: italic;">"C-c p e"</span> . my/password-store-edit)
              (<span style="font-style: italic;">"C-c p v"</span> . my/password-store-edit)
              (<span style="font-style: italic;">"C-c p k"</span> . my/password-store-remove)))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">password-store</span>)

(<span style="font-weight: bold;">defcustom</span> <span style="font-weight: bold; font-style: italic;">my/org-password-store-property</span> <span style="font-style: italic;">"PASSWORD_STORE"</span>
  <span style="font-style: italic;">"Property used in my/password-store feature to get password-store entry name attached to current org entry."</span>)

(<span style="font-weight: bold;">defmacro</span> <span style="font-weight: bold;">with-password-store-entry</span> (entry <span style="font-weight: bold; text-decoration: underline;">&amp;rest</span> body)
  <span style="font-style: italic;">"Eval BODY that can refer password-store ENTRY."</span>
  (<span style="font-weight: bold;">declare</span> (indent defun))
  `(<span style="font-weight: bold;">let</span> ((entry (<span style="font-weight: bold;">or</span> ,entry
                    (<span style="font-weight: bold;">when</span> (derived-mode-p 'org-mode) (org-entry-get (point) my/org-password-store-property))
                    (password-store--completing-read t))))
     ,@body))

(<span style="font-weight: bold;">defmacro</span> <span style="font-weight: bold;">with-password-store-entry-field</span> (entry field <span style="font-weight: bold; text-decoration: underline;">&amp;rest</span> body)
  <span style="font-style: italic;">"Eval BODY which can refer password-store ENTRY and FIELD..</span>

<span style="font-style: italic;">Plus, OBDY can refer value of FIELD named field-value."</span>
  (<span style="font-weight: bold;">declare</span> (indent defun))
  `(<span style="font-weight: bold;">let*</span> ((entry (<span style="font-weight: bold;">or</span> ,entry
                     (<span style="font-weight: bold;">when</span> (derived-mode-p 'org-mode) (org-entry-get (point) my/org-password-store-property))
                     (password-store--completing-read t)))
          (field (<span style="font-weight: bold;">or</span> ,field
                     (password-store-read-field entry)))
          (field-value (password-store-get-field entry
                                                 (<span style="font-weight: bold;">or</span> (<span style="font-weight: bold;">and</span> (string= field <span style="font-style: italic;">"secret"</span>)
                                                          'secret)
                                                     (<span style="font-weight: bold;">and</span> (stringp field)
                                                          field)))))
     ,@body))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/password-store-copy</span> ()
  <span style="font-style: italic;">"Add the secret to system clipboard and the username to primary `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">x-selection</span><span style="font-style: italic;">'.</span>

<span style="font-style: italic;">`</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">password-store-copy</span><span style="font-style: italic;">' is responsible for managing the kill ring."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (with-password-store-entry-field nil <span style="font-style: italic;">"username"</span>
                                   (password-store-copy entry)
                                   (gui-set-selection 'PRIMARY
                                                      (<span style="font-weight: bold;">or</span> (password-store-get-field entry <span style="font-style: italic;">"username"</span>)
                                                          (password-store-get-field entry <span style="font-style: italic;">"email"</span>)
                                                          (nth 1 (password-store-parse-entry entry))))
                                   (message <span style="font-style: italic;">"USERNAME =&gt; X-SEL, SECRET =&gt; CLIPBOARD"</span>)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/password-store-copy-field</span> ()
  <span style="font-style: italic;">"Add field for entry into the kill ring.</span>

<span style="font-style: italic;">entry and field is determined by appropriate manner."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (with-password-store-entry-field nil nil
                                   (password-store-copy-field entry field)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/password-store-url</span> (<span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> arg)
  <span style="font-style: italic;">"Browse url stored in entry by appropriate manner determined by ARG."</span>
  (<span style="font-weight: bold;">interactive</span> <span style="font-style: italic;">"P"</span>)
  (with-password-store-entry-field nil <span style="font-style: italic;">"url"</span>
                                   (browse-url field-value)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/password-store-show-field</span> ()
  <span style="font-style: italic;">"Show a field value in the minibuffer.</span>

<span style="font-style: italic;">Password-store entry and field used to derive this value are from org property</span>
<span style="font-style: italic;">or selected by user."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (with-password-store-entry-field nil nil
                                   (message <span style="font-style: italic;">"%s: %s"</span> field field-value)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/password-store-create</span> ()
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">let*</span> ((input (read-string <span style="font-style: italic;">"Entry-name or URL: "</span>))
         (domain (<span style="font-weight: bold;">when</span> (string-match-p browse-url-button-regexp input)
                   (string-trim-right
                    (shell-command-to-string (format <span style="font-style: italic;">"echo %s | awk -F[/:] '{print $4}'"</span>
                                                     (shell-quote-argument input)))))))
    (with-password-store-entry (<span style="font-weight: bold;">cond</span>
                                ((&gt; (length domain) 0) domain)
                                (input))
                               (<span style="font-weight: bold;">when</span> (derived-mode-p 'org-mode)
                                 (org-entry-put (point) my/org-password-store-property entry))
                               (password-store-edit entry))))

<span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/password-store-edit</span> ()
  (<span style="font-weight: bold;">interactive</span>)
  (with-password-store-entry nil
                             (password-store-edit entry)))

<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">TODO: make my/password-store-insert as soon after</span>
<span style="font-weight: bold; font-style: italic;">;;     </span><span style="font-weight: bold; font-style: italic;">: password-store--run-insert has been implemented</span>

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/password-store-remove</span> ()
  (<span style="font-weight: bold;">interactive</span>)
  (with-password-store-entry nil
                             (password-store-remove entry)
                             (<span style="font-weight: bold;">when</span> (derived-mode-p 'org-mode)
                               (org-entry-delete (point) my/org-password-store-property))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/password-store-web-login</span> ()
  <span style="font-style: italic;">"Open url for the entry at point.</span>

<span style="font-style: italic;">Additionally the username and the secret are saved in X selection and clipboard respectively."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (my/password-store-copy)
  (funcall-interactively #'my/password-store-url '(16)))

(advice-add #'password-store-clear <span style="font-weight: bold;">:before</span> #'my/password-store-clear)

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/password-store-clear</span> (<span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> field)
  <span style="font-style: italic;">"Overwrite clipboard data so that password once saved in clipboard is deleted</span>
<span style="font-style: italic;"> for security risk.</span>

<span style="font-style: italic;">FIELD originally for messaging is ignored in this function."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">when</span> password-store-kill-ring-pointer
    (kill-new <span style="font-style: italic;">""</span>)
    (setcar kill-ring-yank-pointer <span style="font-style: italic;">""</span>)))

(<span style="font-weight: bold;">provide</span> '<span style="font-weight: bold; text-decoration: underline;">org-password-store</span>)
</pre>
</div>
</div>
</li>

<li><a id="orgdc24677"></a>text-mail&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span><br /></li>

<li><a id="orgdcbe757"></a>learning english words/phrases<br />
<div class="outline-text-5" id="text-orgdcbe757">
<p>
My workflow for acquiring English words is:
</p>
<ol class="org-ol">
<li>Capture a word which come across in the article I'm reading with my/org-english-capture
<ul class="org-ul">
<li>Captured words will be appended to my English word list</li>
</ul></li>
<li>Review my English word list with my/org-english-drill everyday
<ul class="org-ul">
<li>Org-drill ask questions to level up my vocabulary</li>
</ul></li>
</ol>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package org-drill-english
  <span style="font-weight: bold;">:bind</span> (<span style="font-weight: bold;">:map</span> my/org-global-map
              (<span style="font-style: italic;">"e e"</span> . my/org-english-capture)
              (<span style="font-style: italic;">"e d"</span> . my/org-english-drill)
              (<span style="font-style: italic;">"e r"</span> . my/org-english-drill-resume)
              (<span style="font-style: italic;">"e c"</span> . my/cloze-deletion-replace)
              (<span style="font-style: italic;">"e q"</span> . my/org-english-search)
              <span style="font-weight: bold;">:map</span> engine-mode-prefixed-map
              (<span style="font-style: italic;">"j"</span> . my/english-japanese-translate)
              (<span style="font-style: italic;">"p"</span> . my/english-pronunciation))
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">with-eval-after-load</span> 'denote
    (<span style="font-weight: bold;">setq</span> my/org-english-file (denote-get-path-by-id <span style="font-style: italic;">"20230605T170959"</span>))))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">-*- lexical-binding: t -*-</span>

(<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">define-word</span>)
(<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">org</span>)
(<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">org-drill</span>)
(<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">cl</span>)
(<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">request</span>)
(<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">logos</span>)

(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my/org-english-file</span> <span style="font-style: italic;">"~/documents/english.org"</span>
  <span style="font-style: italic;">"A file where all english words to learn locate."</span>)

(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my/org-english-word</span> nil
  <span style="font-style: italic;">"An english word to capture."</span>)

(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my/org-english-match-entry</span> nil
  <span style="font-style: italic;">"An org entry which matches search word."</span>)

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/org-english-capture</span> (word)
  <span style="font-style: italic;">"Capture an english WORD as a `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">org-mode</span><span style="font-style: italic;">' entry suitable for org-drill.</span>

<span style="font-style: italic;">Capture URL or file currently visiting as well as a sentence at point."</span>
  (<span style="font-weight: bold;">interactive</span> (list (<span style="font-weight: bold;">if</span> (use-region-p)
                         (buffer-substring (region-beginning) (region-end))
                       (read-string <span style="font-style: italic;">"Phrase: "</span>))))
  (<span style="font-weight: bold;">setq</span> org-english-word (downcase word))
  (<span style="font-weight: bold;">setq</span> my/org-english-match-entry nil)
  (<span style="font-weight: bold;">let*</span> ((sentence-end-double-space nil)
         (my/org-english-match-entry (org-ql-select
                                      `(,my/org-english-file)
                                      `(<span style="font-weight: bold;">and</span> (heading-regexp
                                             ,(eval `(<span style="font-weight: bold;">rx</span> word-start
                                                         ,org-english-word
                                                         word-end)))
                                            (tags <span style="font-style: italic;">"drill"</span>))
                                      <span style="font-weight: bold;">:action</span> 'element-with-markers))
         (sentence (replace-regexp-in-string word
                                             (my/cloze-deletion word)
                                             (<span style="font-weight: bold;">or</span> (sentence-at-point) <span style="font-style: italic;">""</span>))))
    (kill-new (<span style="font-weight: bold;">if</span> (stringp sentence) sentence <span style="font-style: italic;">""</span>))
    (<span style="font-weight: bold;">cond</span>
     (my/org-english-match-entry (org-capture nil <span style="font-style: italic;">"!1"</span>))
     (t (org-capture nil <span style="font-style: italic;">"!0"</span>)))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/cloze-deletion</span> (word)
  <span style="font-style: italic;">"Build cloze deletion string from WORD."</span>
  (seq-reduce (<span style="font-weight: bold;">lambda</span> (string chunk)
                (replace-regexp-in-string chunk (format <span style="font-style: italic;">"[%s||%c]"</span> chunk (string-to-char chunk))
                                          string))
              (split-string word <span style="font-style: italic;">"[ -]+"</span>)
              word))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/cloze-deletion-replace</span> (word start end)
  <span style="font-style: italic;">"Convert WORD into cloze deletion.</span>
<span style="font-style: italic;">OWRD can be determined a string between START and END.</span>

<span style="font-style: italic;">When called Interactively, WORD is either a word at point or a string in region."</span>
  (<span style="font-weight: bold;">interactive</span> (<span style="font-weight: bold;">cond</span>
                ((region-active-p)
                 `(,(buffer-substring (region-beginning) (region-end))
                   ,(region-beginning)
                   ,(region-end)))
                (t
                 (<span style="font-weight: bold;">let</span> ((bounds (bounds-of-thing-at-point 'word)))
                   `(,(thing-at-point 'word)
                     ,(car bounds)
                     ,(cdr bounds))))))
  (replace-string word
                  (my/cloze-deletion word)
                  nil
                  start
                  end))

(<span style="font-weight: bold;">with-eval-after-load</span> 'org-ql-view
  (<span style="font-weight: bold;">push</span> `(<span style="font-style: italic;">"English words to learn"</span>
          <span style="font-weight: bold;">:buffers-files</span> ,(list my/org-english-file)
          <span style="font-weight: bold;">:query</span> (<span style="font-weight: bold;">and</span> (tags <span style="font-style: italic;">"drill"</span>)
                      (tags <span style="font-style: italic;">"fd_en"</span>))
          <span style="font-weight: bold;">:sort</span> (scheduled date))
        org-ql-views))

(<span style="font-weight: bold;">with-eval-after-load</span> 'org-capture
  (add-to-list 'org-capture-templates
               '(<span style="font-style: italic;">"!0"</span> <span style="font-style: italic;">"drill entry for english word"</span>
                 entry (id <span style="font-style: italic;">"de0983a7-9d1a-4ef8-b882-148c401e862d"</span>)
                 <span style="font-style: italic;">"* %i :drill:fd_en:</span>
<span style="font-style: italic;">[%(my/english-japanese-translate org-english-word t) %(my/english-pronunciation org-english-word t)]</span>
<span style="font-style: italic;">%(my/org-english-insert-english-translation)</span>
<span style="font-style: italic;">- %a</span>
<span style="font-style: italic;">  %c"</span>))
  (add-to-list 'org-capture-templates
               '(<span style="font-style: italic;">"!1"</span> <span style="font-style: italic;">"drill entry for english word"</span>
                 item (<span style="font-weight: bold;">function</span> my/org-english-goto-match)
                 <span style="font-style: italic;">"- %a</span>
<span style="font-style: italic;">  %c"</span>)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/org-english-goto-match</span> ()
  <span style="font-style: italic;">"Goto function for org-capture-template designed to insert an edditional example</span>
<span style="font-style: italic;">to existing english word entry."</span>
  (org-goto-marker-or-bmk
   (plist-get (cadar my/org-english-match-entry) <span style="font-weight: bold;">:org-marker</span>)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/org-english-insert-english-translation</span> ()
  <span style="font-style: italic;">"Insert English translation into org capture entry."</span>
  (<span style="font-weight: bold;">let*</span> ((url (format <span style="font-style: italic;">"http://wordnik.com/words/%s"</span> (downcase org-english-word)))
         (buffer (url-retrieve-synchronously url t t))
         (vertico-sort-function nil))
    (<span style="font-weight: bold;">with-temp-buffer</span>
      (url-insert-buffer-contents buffer url)
      (completing-read <span style="font-style: italic;">"match"</span> (split-string (funcall 'my/define-word--parse-wordnik) <span style="font-style: italic;">"\n"</span>)))))

(advice-add #'my/org-english-insert-english-translation <span style="font-weight: bold;">:around</span> #'my/define-word--fix-31)

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/english-japanese-translate</span> (word <span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> sync)
  <span style="font-style: italic;">"Search Japanese translation for WORD and add it to kill ring.</span>

<span style="font-style: italic;">SYNC handles whether network access procedure is synchronous.</span>
<span style="font-style: italic;">Return translation result as a string If SYNC is non-nil.</span>
<span style="font-style: italic;">If called interactively, display results and add them to kill ring."</span>
  (<span style="font-weight: bold;">interactive</span> `(,(<span style="font-weight: bold;">or</span> (<span style="font-weight: bold;">when</span> (region-active-p)
                        (buffer-substring (region-beginning) (region-end)))
                      (read-string <span style="font-style: italic;">"Word: "</span> nil 'my/define-word-minibuffer-history))))
  (<span style="font-weight: bold;">let</span> ((intr-p (interactive-p))
        trans)
    (request
      (concat <span style="font-style: italic;">"https://ejje.weblio.jp/content/"</span> (downcase word))
      <span style="font-weight: bold;">:sync</span> sync
      <span style="font-weight: bold;">:timeout</span> 60
      <span style="font-weight: bold;">:parser</span>
      (<span style="font-weight: bold;">lambda</span> ()
        (<span style="font-weight: bold;">let</span> ((str (buffer-string)))
          (<span style="font-weight: bold;">with-temp-buffer</span>
            (insert str)
            (shr-render-region (point-min) (point-max))
            (buffer-substring-no-properties (point-min) (point-max)))))
      <span style="font-weight: bold;">:success</span>
      (<span style="font-weight: bold;">cl-function</span>
       (<span style="font-weight: bold;">lambda</span> (<span style="font-weight: bold; text-decoration: underline;">&amp;key</span> data <span style="font-weight: bold; text-decoration: underline;">&amp;allow-other-keys</span>)
         (<span style="font-weight: bold;">and</span> (string-match
               (<span style="font-weight: bold;">rx</span> (seq <span style="font-style: italic;">"&#24847;&#21619;&#12539;&#23550;&#35379; "</span>
                        (group-n 1 (+ (<span style="font-weight: bold;">or</span> (category base)
                                          (category combining-diacritic)
                                          (category latin)
                                          (category japanese-katakana-two-byte)
                                          (category korean)
                                          (category greek))))))
               data)
              (<span style="font-weight: bold;">setq</span> trans (string-trim (match-string 1 data)))
              (<span style="font-weight: bold;">when</span> intr-p (kill-new (princ trans)))))))
    trans))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/english-pronunciation</span> (word <span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> sync)
  <span style="font-style: italic;">"Search pronunciation information for WORD and add it to kill ring.</span>

<span style="font-style: italic;">SYNC handles whether network access procedure is synchronous.</span>
<span style="font-style: italic;">Return search infromation as a string If SYNC is non-nil.</span>
<span style="font-style: italic;">Display information and add it to kill ring if called interactively."</span>
  (<span style="font-weight: bold;">interactive</span> `(,(<span style="font-weight: bold;">or</span> (<span style="font-weight: bold;">when</span> (region-active-p)
                        (buffer-substring (region-beginning) (region-end)))
                      (read-string <span style="font-style: italic;">"Word: "</span> nil 'my/define-word-minibuffer-history))))
  (<span style="font-weight: bold;">let</span> ((intr-p (interactive-p))
        pron)
    (request
      (concat <span style="font-style: italic;">"https://eow.alc.co.jp/search?q="</span> (string-replace <span style="font-style: italic;">" "</span> <span style="font-style: italic;">"+"</span> (downcase word)))
      <span style="font-weight: bold;">:sync</span> sync
      <span style="font-weight: bold;">:timeout</span> 10
      <span style="font-weight: bold;">:parser</span>
      (<span style="font-weight: bold;">lambda</span> ()
        (<span style="font-weight: bold;">let</span> ((str (buffer-string)))
          (<span style="font-weight: bold;">with-temp-buffer</span>
            (insert str)
            (shr-render-region (point-min) (point-max))
            (buffer-substring-no-properties (point-min) (point-max)))))
      <span style="font-weight: bold;">:success</span>
      (<span style="font-weight: bold;">cl-function</span>
       (<span style="font-weight: bold;">lambda</span> (<span style="font-weight: bold; text-decoration: underline;">&amp;key</span> data <span style="font-weight: bold; text-decoration: underline;">&amp;allow-other-keys</span>)
         (<span style="font-weight: bold;">and</span> (string-match
               (<span style="font-weight: bold;">rx</span> (seq (opt <span style="font-style: italic;">"&#12304;&#12524;&#12505;&#12523;&#12305;"</span> (** 1 2 digit) <span style="font-style: italic;">"&#12289;"</span>)
                        <span style="font-style: italic;">"&#12304;&#30330;&#38899;"</span> (opt <span style="font-style: italic;">"&#65281;"</span>) <span style="font-style: italic;">"&#12305;"</span>
                        (+ (<span style="font-weight: bold;">or</span> (category combining-diacritic)
                               (category latin)
                               (category japanese-katakana-two-byte)
                               (category korean)
                               (category greek)))
                        <span style="font-style: italic;">"&#12289;"</span>
                        (? (<span style="font-weight: bold;">or</span> (seq <span style="font-style: italic;">"&#12304;&#65312;&#12305;"</span> (opt <span style="font-style: italic;">"[US]"</span>)
                                    (+ (<span style="font-weight: bold;">or</span> (category japanese-katakana-two-byte)
                                           <span style="font-style: italic;">"&#65288;"</span> <span style="font-style: italic;">"&#65289;"</span>))
                                    (? <span style="font-style: italic;">"&#12289;"</span>))
                               (seq (+ any) <span style="font-style: italic;">"*"</span>)))))
               data)
              (<span style="font-weight: bold;">setq</span> pron (replace-regexp-in-string
                          <span style="font-style: italic;">"\\[</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">.\\{2\\}</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">\\]"</span> <span style="font-style: italic;">"&#12304;\\1&#12305;"</span>
                          (string-trim-right (match-string 0 data)
                                             <span style="font-style: italic;">"&#12289;"</span>)))
              (<span style="font-weight: bold;">when</span> intr-p (kill-new (princ pron)))))))
    pron))

(<span style="font-weight: bold;">defmacro</span> <span style="font-weight: bold;">with-org-drill-english-config</span> (<span style="font-weight: bold; text-decoration: underline;">&amp;rest</span> body)
  <span style="font-style: italic;">"Evaluate BODY with config for Org-Drill for english words review."</span>
  `(<span style="font-weight: bold;">progn</span>
     (org-id-goto <span style="font-style: italic;">"de0983a7-9d1a-4ef8-b882-148c401e862d"</span>)
     (<span style="font-weight: bold;">let</span> (<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">imperative settings</span>
           (org-drill-scope 'tree)
           (org-drill-question-tag <span style="font-style: italic;">"drill"</span>)
           (org-drill-hide-item-headings-p t)
           <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">drill session regulations</span>
           (org-drill-maximum-duration 25)
           (org-drill-maximum-items-per-session 50)
           <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Definition of old and overdue items</span>
           (org-drill-overdue-interval-factor 1.4) <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">more permissive for overdue than 1.2 (default)</span>
           (org-drill-days-before-old 15)
           <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Spaced repetition algorithm</span>
           (org-drill-spaced-repetition-algorithm 'sm5)
           (org-drill-sm5-initial-interval 7.0) <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">initial step is 7 day</span>
           <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Random variation of repetition intervals</span>
           (org-drill-add-random-noise-to-intervals-p t)
           <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Adjustment for early or late review of items</span>
           (org-drill-adjust-intervals-for-early-and-late-repetitions-p t)
           <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Adjusting item difficulty globally</span>
           (org-drill-learn-fraction 0.43) <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">intend not to reschedule drastically forward in 10th+ interval</span>
           (org-startup-indented nil)
           (logos-hide-cursor t)
           (logos-hide-mode-line t)
           (logos-hide-buffer-boundaries t)
           (logos-buffer-read-only nil)
           (logos-olivetti nil)
           (logos-hide-fringe t))
       (org-indent-mode -1)
       (visual-line-mode 1)
       (text-scale-set -1)
       (logos-focus-mode 1)
       ,@body)
     (save-buffer)
     (org-indent-mode 1)
     (text-scale-set 0)
     (visual-line-mode -1)
     (logos-focus-mode -1)))

<span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/org-english-drill</span> ()
  <span style="font-style: italic;">"Invoke Org-Drill for English word review."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (with-org-drill-english-config (org-drill)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/org-english-drill-resume</span> ()
  <span style="font-style: italic;">"Resume Org-Drill session for english word review."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (with-org-drill-english-config (org-drill-resume)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/org-english-list-undrilled</span> ()
  <span style="font-style: italic;">"List english words which haven't been tested before in level ascending order."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">with-current-buffer</span> (find-file-noselect my/org-english-file)
    (org-ql-search my/org-english-file
      '(<span style="font-weight: bold;">and</span> (tags <span style="font-style: italic;">"drill"</span>)
            (tags <span style="font-style: italic;">"fd_en"</span>)
            (not (property <span style="font-style: italic;">"DRILL_LAST_REVIEWED"</span>)))
      <span style="font-weight: bold;">:sort</span> 'my/org-ql--english-level&lt;)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/org-english-search</span> (word)
  <span style="font-style: italic;">"Look up WORD in my archive files using `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">org-ql-search</span><span style="font-style: italic;">'."</span>
  (<span style="font-weight: bold;">interactive</span> (list (<span style="font-weight: bold;">if</span> (use-region-p)
                         (buffer-substring (region-beginning) (region-end))
                       (read-string <span style="font-style: italic;">"Word: "</span>))))
  (org-ql-search
    my/org-english-file
    `(heading-regexp ,(eval `(<span style="font-weight: bold;">rx</span> word-start
                                 ,(downcase word)
                                 word-end)))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/org-english-level</span> (word)
  <span style="font-style: italic;">"Return difficulty level of `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">WORD</span><span style="font-style: italic;">' in number."</span>
  (<span style="font-weight: bold;">cl-labels</span> ((parse-level (text)
                (<span style="font-weight: bold;">if</span> (string-match
                     (<span style="font-weight: bold;">rx</span> (seq <span style="font-style: italic;">"&#12304;&#12524;&#12505;&#12523;&#12305;"</span>
                              (group-n 1 (repeat 1 2 digit))))
                     text)
                    (match-string 1 text)
                  nil)))
    (<span style="font-weight: bold;">let</span> ((local-str (<span style="font-weight: bold;">with-current-buffer</span> (find-file-noselect my/org-english-file)
                       (<span style="font-weight: bold;">let</span> ((headline (org-ql-select
                                         `(,my/org-english-file)
                                         `(<span style="font-weight: bold;">and</span> (heading-regexp ,(eval `(<span style="font-weight: bold;">rx</span> word-start
                                                                           ,(downcase word)
                                                                           word-end)))
                                               (tags <span style="font-style: italic;">"drill"</span>))
                                         <span style="font-weight: bold;">:action</span> 'element-with-markers)))
                         (<span style="font-weight: bold;">org-with-point-at</span> (plist-get (cadar headline) <span style="font-weight: bold;">:org-marker</span>)
                           (org-get-entry))))))
      (string-to-number (<span style="font-weight: bold;">or</span> (<span style="font-weight: bold;">and</span> local-str
                                 (parse-level local-str))
                            <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">CAVEAT: getting level from web costs a lot</span>
                            <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(when-let ((remote-str (my/english-pronunciation word)))</span>
                            <span style="font-weight: bold; font-style: italic;">;;   </span><span style="font-weight: bold; font-style: italic;">(parse-level remote-str))</span>
                            <span style="font-style: italic;">"99"</span>)))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/org-ql--english-level&lt;</span> (a b)
  <span style="font-style: italic;">"Return non-nil if A's difficulty level is higher than B's.</span>
<span style="font-style: italic;">A and B are Org headline elements."</span>
  (<span style="font-weight: bold;">cl-macrolet</span> ((level (item)
                  `(my/org-english-level
                    (org-element-property <span style="font-weight: bold;">:raw-value</span> ,item))))
    (<span style="font-weight: bold;">let</span> ((a-level (level a))
          (b-level (level b)))
      (<span style="font-weight: bold;">cond</span> ((<span style="font-weight: bold;">and</span> (numberp a-level) (numberp b-level))
             (&lt; a-level b-level))
            (a-level t)
            (b-level nil)))))

(<span style="font-weight: bold;">provide</span> '<span style="font-weight: bold; text-decoration: underline;">org-drill-english</span>)
</pre>
</div>

<p>
Call <a href="(call-interactively #'ert)">ERT</a> with test-org-english-pron to test this code.
</p>

<p>
test code
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">ert</span>)

(<span style="font-weight: bold;">ert-deftest</span> <span style="font-weight: bold;">test-org-english-pron</span> ()
  <span style="font-style: italic;">"Tests the output string of `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">my/org-english-insert-japanese-pronunciation</span><span style="font-style: italic;">'."</span>
  (should (string= (my/org-english-insert-japanese-pronunciation <span style="font-style: italic;">"rife"</span>)
                   <span style="font-style: italic;">"&#12304;&#12524;&#12505;&#12523;&#12305;11&#12289;&#12304;&#30330;&#38899;&#12305;ra&#769;if&#12289;&#12304;&#65312;&#12305;&#12521;&#12452;&#12501;"</span>))
  (should (string= (my/org-english-insert-japanese-pronunciation <span style="font-style: italic;">"congregate"</span>)
                   <span style="font-style: italic;">"&#12304;&#12524;&#12505;&#12523;&#12305;12&#12289;&#12304;&#30330;&#38899;&#65281;&#12305;&#12304;US&#12305;&#12298;&#21205;&#12299;k&#593;&#769;ngr&#601;ge&#768;it &#12298;&#24418;&#12299;k&#593;&#769;&#331;gr&#601;git &#65372; &#12304;UK&#12305;&#12298;&#21205;&#12299;k&#596;&#769;&#331;grige&#768;it &#12298;&#24418;&#12299;k&#596;&#769;&#331;grigit"</span>))
  (should (string= (my/org-english-insert-japanese-pronunciation <span style="font-style: italic;">"unleash"</span>)
                   <span style="font-style: italic;">"&#12304;&#12524;&#12505;&#12523;&#12305;9&#12289;&#12304;&#30330;&#38899;&#12305;&#652;&#768;nli&#769;&#720;&#643;&#12289;&#12304;&#65312;&#12305;&#12450;&#12531;&#12522;&#12540;&#12471;&#12517;"</span>))
  (should (string= (my/org-english-insert-japanese-pronunciation <span style="font-style: italic;">"homage"</span>)
                   <span style="font-style: italic;">"&#12304;&#12524;&#12505;&#12523;&#12305;11&#12289;&#12304;&#30330;&#38899;&#12305;&#12304;US&#12305; h&#593;&#769;mid&#658; &#65372; &#12304;UK&#12305; h&#596;&#769;mid&#658;&#12289;&#12304;&#65312;&#12305;&#12304;US&#12305;&#12495;&#12511;&#12472;&#12289;&#12304;UK&#12305;&#12507;&#12511;&#12472;"</span>))
  (should (string= (my/org-english-insert-japanese-pronunciation <span style="font-style: italic;">"interstitial"</span>)
                   <span style="font-style: italic;">"&#12304;&#30330;&#38899;&#12305;i&#768;nt&#601;rsti&#769;&#643;&#601;l&#12289;&#12304;&#65312;&#12305;&#12452;&#12531;&#12479;&#65288;&#12540;&#65289;&#12473;&#12486;&#12451;&#12471;&#12515;&#12523;"</span>))
  (should (string= (my/org-english-insert-japanese-pronunciation <span style="font-style: italic;">"veterinarian"</span>)
                   <span style="font-style: italic;">"&#12304;&#12524;&#12505;&#12523;&#12305;12&#12289;&#12304;&#30330;&#38899;&#12305;ve&#768;t&#601;r&#601;n&#8051;&#601;ri&#601;n&#12289;&#12304;&#65312;&#12305;&#12532;&#12455;&#12488;&#12521;&#12493;&#12450;&#12522;&#12450;&#12531;"</span>))
  (should (string= (my/org-english-insert-japanese-pronunciation <span style="font-style: italic;">"warehouse"</span>)
                   <span style="font-style: italic;">"&#12304;&#12524;&#12505;&#12523;&#12305;8&#12289;&#12304;&#30330;&#38899;&#65281;&#12305;&#12298;&#21205;&#12299;w&#8051;&#601;rha&#768;uz &#12298;&#21517;&#12299;w&#8051;&#601;rha&#768;us&#12289;&#12304;&#65312;&#12305;&#12454;&#12455;&#12450;&#12495;&#12454;&#12473;&#12289;&#12454;&#12456;&#12450;&#12495;&#12454;&#12473;"</span>))
  (should (string= (my/org-english-insert-japanese-pronunciation <span style="font-style: italic;">"lambaste"</span>)
                   <span style="font-style: italic;">""</span>))
  (should (string= (my/org-english-insert-japanese-pronunciation <span style="font-style: italic;">"in a nutshell"</span>)
                   <span style="font-style: italic;">""</span>))
  (should (string= (my/org-english-insert-japanese-pronunciation <span style="font-style: italic;">"traverse"</span>)
                   <span style="font-style: italic;">"&#12304;&#12524;&#12505;&#12523;&#12305;8&#12289;&#12304;&#30330;&#38899;&#65281;&#12305;&#12298;&#21517;&#12539;&#24418;&#12299;tr&#230;&#769;v&#601;&#720;rs &#12298;&#21205;&#12299;tr&#601;v&#652;&#769;rs&#12289;&#12304;&#65312;&#12305;&#12488;&#12453;&#12521;&#12532;&#12449;&#12540;&#12473;&#12289;&#12488;&#12521;&#12496;&#12540;&#12473;"</span>)))
</pre>
</div>
</div>
</li>

<li><a id="orgea37a65"></a>org-relate<br />
<div class="outline-text-5" id="text-orgea37a65">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">thingatpt</span>)
(<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">org-ql-search</span>)

(<span style="font-weight: bold;">defconst</span> <span style="font-weight: bold; font-style: italic;">org-relate-property</span> <span style="font-style: italic;">"PARENT"</span>
  <span style="font-style: italic;">"Property name for child nodes to look up parent node."</span>)
(<span style="font-weight: bold;">defcustom</span> <span style="font-weight: bold; font-style: italic;">org-relate-parent-tag-list</span>
  `(,my/org-project-tag <span style="font-style: italic;">"refile"</span>)
  <span style="font-style: italic;">"A list of tags all parent nodes must have one of them."</span>)
(<span style="font-weight: bold;">defcustom</span> <span style="font-weight: bold; font-style: italic;">org-relate-target-files</span>
  (directory-files-recursively org-directory <span style="font-style: italic;">"\\.org$"</span>)
  <span style="font-style: italic;">"A list of target files to search relation nodes."</span>)

(<span style="font-weight: bold;">with-eval-after-load</span> 'org
  (bind-key <span style="font-style: italic;">"C-c %"</span> #'org-relate-search
            org-mode-map))

(<span style="font-weight: bold;">with-eval-after-load</span> 'org-keys
  (<span style="font-weight: bold;">setf</span> (map-elt org-speed-commands <span style="font-style: italic;">"%"</span>) #'org-relate-search)
  (<span style="font-weight: bold;">setf</span> (map-elt org-speed-commands <span style="font-style: italic;">"&amp;"</span>) #'org-relate-interrelate)
  (<span style="font-weight: bold;">push</span> '(<span style="font-style: italic;">"Org-Relate Operation"</span>) org-speed-commands))

(<span style="font-weight: bold;">with-eval-after-load</span> 'org-agenda
  (bind-keys <span style="font-weight: bold;">:map</span> org-agenda-mode-map
             (<span style="font-style: italic;">"&amp;"</span> . org-agenda-relation-interrelate)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">org-relate-search</span> ()
  <span style="font-style: italic;">"Search for entries related to the entry at point.</span>

<span style="font-style: italic;">User who would like to search for parent and children of that, namely siblings,</span>
<span style="font-style: italic;"> must press 'p'.</span>
<span style="font-style: italic;">User who would like to search for children of this entry must press 'c'.</span>
<span style="font-style: italic;">User who would like to search for friends either pointing to this entry</span>
<span style="font-style: italic;"> or pointed from this entry must be press 'f'.</span>
<span style="font-style: italic;">User who would like to search for all listed above must press 'a'."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">let*</span> ((org-super-agenda-properties-inherit nil)
         (char (read-char-from-minibuffer <span style="font-style: italic;">"Target: [a]ll [p]arent [c]hild [f]riend"</span>))
         (queries (seq-remove 'null
                              (<span style="font-weight: bold;">cond</span>
                               ((equal char ?a) (list (org-relate--search-parent-org-ql-query)
                                                      (org-relate--search-children-org-ql-query)
                                                      (org-relate--search-friends-refer-org-ql-query)
                                                      (org-relate--search-friends-referred-org-ql-query)
                                                      (org-relate--search-siblings-org-ql-query)))
                               ((equal char ?p) (list (org-relate--search-parent-org-ql-query)
                                                      (org-relate--search-siblings-org-ql-query)))
                               ((equal char ?c) (list (org-relate--search-children-org-ql-query)))
                               ((equal char ?f) (list (org-relate--search-friends-refer-org-ql-query)
                                                      (org-relate--search-friends-referred-org-ql-query)))))))
    (<span style="font-weight: bold;">if</span> queries
        (org-ql-search org-relate-target-files
          (seq-reduce (<span style="font-weight: bold;">lambda</span> (accum elem)
                        (<span style="font-weight: bold;">push</span> elem (cdr (last accum)))
                        accum)
                      (mapcar 'car queries)
                      '(<span style="font-weight: bold;">or</span>))
          <span style="font-weight: bold;">:super-groups</span> (mapcar 'cdr queries))
      (message <span style="font-style: italic;">"No query found"</span>))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">org-relate--search-children-org-ql-query</span> ()
  (<span style="font-weight: bold;">when-let*</span> ((id (org-id-get))
              (rel-prop-link (format <span style="font-style: italic;">"[[id:%s]]"</span> id)))
    `((<span style="font-weight: bold;">or</span> (property ,org-relate-property ,id)
          (property ,org-relate-property ,rel-prop-link)) <span style="font-weight: bold;">.</span>
          (<span style="font-weight: bold;">:name</span> <span style="font-style: italic;">"Children"</span> <span style="font-weight: bold;">:auto-property</span> ,org-relate-property))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">org-relate--search-parent-org-ql-query</span> ()
  (<span style="font-weight: bold;">if-let*</span> ((prop-ref (org-entry-get (point) org-relate-property))
            (index (string-match (format <span style="font-style: italic;">"</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">%s</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">"</span> thing-at-point-uuid-regexp) prop-ref))
            (parent-id (match-string 0 prop-ref)))
      `((property <span style="font-style: italic;">"ID"</span> ,parent-id) .
        (<span style="font-weight: bold;">:name</span> <span style="font-style: italic;">"Parent"</span> <span style="font-weight: bold;">:auto-property</span> <span style="font-style: italic;">"ID"</span>))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">org-relate--search-siblings-org-ql-query</span> ()
  (<span style="font-weight: bold;">if-let*</span> ((prop-ref (org-entry-get (point) org-relate-property))
            (index (string-match (format <span style="font-style: italic;">"</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">%s</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">"</span> thing-at-point-uuid-regexp) prop-ref))
            (parent-id (match-string 0 prop-ref))
            (parent-id-link (format <span style="font-style: italic;">"[[id:%s]]"</span> parent-id)))
      `((<span style="font-weight: bold;">or</span> (property ,org-relate-property ,parent-id)
            (property ,org-relate-property ,parent-id-link)) <span style="font-weight: bold;">.</span>
            (<span style="font-weight: bold;">:name</span> <span style="font-style: italic;">"Siblings"</span> <span style="font-weight: bold;">:auto-property</span> ,org-relate-property))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">org-relate--search-friends-refer-org-ql-query</span> ()
  (<span style="font-weight: bold;">when-let*</span> ((id (org-id-get))
              (ref-re (format <span style="font-style: italic;">"\\[\\[</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">id:%s\\</span><span style="font-style: italic;">].*\\]"</span> id)))
    `((regexp ,ref-re) .
      (<span style="font-weight: bold;">:name</span> <span style="font-style: italic;">"Friends pointing to this entry"</span> <span style="font-weight: bold;">:regexp</span> ,ref-re))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">org-relate--search-friends-referred-org-ql-query</span> ()
  (<span style="font-weight: bold;">let*</span> ((id-link-re (format <span style="font-style: italic;">"\\[\\[id:</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">%s</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">\\].*\\]"</span> thing-at-point-uuid-regexp))
         (end (<span style="font-weight: bold;">or</span> (<span style="font-weight: bold;">save-excursion</span>
                    (outline-next-heading))
                  (point-max))))
    (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">save-excursion</span>
            (re-search-forward id-link-re end t))
      `((property <span style="font-style: italic;">"ID"</span> ,(match-string 1)) .
        (<span style="font-weight: bold;">:name</span> <span style="font-style: italic;">"Friends to whom this entry is pointing"</span> <span style="font-weight: bold;">:auto-property</span> (<span style="font-style: italic;">"ID"</span> ,(match-string 1)))))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">org-relate-interrelate</span> ()
  <span style="font-style: italic;">"Make parent-child relationship by inserting property.</span>

<span style="font-style: italic;">This command must be called in parent node which should have one of `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">org-relate-parent-tag-list</span><span style="font-style: italic;">'."</span>
  (<span style="font-weight: bold;">interactive</span>)
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">relate the entry at point and its children if the entry has some of `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">org-relate-parent-tag-list</span><span style="font-weight: bold; font-style: italic;">'</span>
  (<span style="font-weight: bold;">save-excursion</span>
    (org-back-to-heading)
    (<span style="font-weight: bold;">when</span> (cl-some (<span style="font-weight: bold;">lambda</span> (parent-tag)
                     (member parent-tag (org-get-tags)))
                   org-relate-parent-tag-list)
      (<span style="font-weight: bold;">let*</span> ((ref-id (org-id-get-create))
             (ent-link (format <span style="font-style: italic;">"[[id:%s]]"</span> ref-id)))
        (<span style="font-weight: bold;">and</span> (org-goto-first-child)
             (<span style="font-weight: bold;">cl-labels</span> ((set-ref-id-to-siblings
                           (ref-link)
                           (org-set-property org-relate-property
                                             ref-link)
                           (<span style="font-weight: bold;">and</span> (org-goto-sibling)
                                (set-ref-id-to-siblings ref-link))))
               (set-ref-id-to-siblings ent-link))))))
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">relate the entry at point and a parent if the parent has some of `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">org-relate-parent-tag-list</span><span style="font-weight: bold; font-style: italic;">'</span>
  (<span style="font-weight: bold;">let</span> (parent-link)
    (<span style="font-weight: bold;">save-excursion</span>
      (org-up-heading-safe)
      (<span style="font-weight: bold;">when</span> (seq-some (<span style="font-weight: bold;">lambda</span> (parent-tag)
                        (member parent-tag (org-get-tags)))
                      org-relate-parent-tag-list)
        (<span style="font-weight: bold;">setq</span> parent-link (format <span style="font-style: italic;">"[[id:%s]]"</span> (org-id-get-create)))))
    (<span style="font-weight: bold;">and</span> parent-link
         (org-set-property org-relate-property
                           parent-link))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">org-agenda-relation-interrelate</span> ()
  <span style="font-style: italic;">"Invoke `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">org-relate-interrelate</span><span style="font-style: italic;">' in agenda view."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (org-agenda-check-no-diary)
  (<span style="font-weight: bold;">let*</span> ((hdmarker (<span style="font-weight: bold;">or</span> (org-get-at-bol 'org-hd-marker)
                       (org-agenda-error)))
         (buffer (marker-buffer hdmarker))
         (pos (marker-position hdmarker))
         (inhibit-read-only t)
         newhead)
    (<span style="font-weight: bold;">org-with-remote-undo</span> buffer
      (<span style="font-weight: bold;">with-current-buffer</span> buffer
        (widen)
        (goto-char pos)
        (org-show-context 'agenda)
        (call-interactively 'org-relate-interrelate)
        (end-of-line 1)
        (<span style="font-weight: bold;">setq</span> newhead (org-get-heading))))))

(<span style="font-weight: bold;">provide</span> '<span style="font-weight: bold; text-decoration: underline;">org-relate</span>)
</pre>
</div>
</div>
</li>

<li><a id="org4b66184"></a>org-clocktable-by-tag<br />
<div class="outline-text-5" id="text-org4b66184">
<p>
Provide a function to Build a clock table summing up time by tag.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">with-eval-after-load</span> 'org
  (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">org-clocktable-by-tag</span>))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">org-table</span>)
(<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">org-clock</span>)

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">clocktable-by-tag/shift-cell</span> (n)
  (<span style="font-weight: bold;">let</span> ((str <span style="font-style: italic;">""</span>))
    (<span style="font-weight: bold;">dotimes</span> (i n)
      (<span style="font-weight: bold;">setq</span> str (concat str <span style="font-style: italic;">"| "</span>)))
    str))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">clocktable-by-tag/insert-tag</span> (params)
  (<span style="font-weight: bold;">let</span> ((match (plist-get params <span style="font-weight: bold;">:match</span>)))
    (insert <span style="font-style: italic;">"|--\n"</span>)
    (insert (format <span style="font-style: italic;">"| %s | *Tag time* |\n"</span> match))
    (<span style="font-weight: bold;">let</span> ((total 0))
      (mapcar
       (<span style="font-weight: bold;">lambda</span> (file)
         (<span style="font-weight: bold;">let</span> ((clock-data (<span style="font-weight: bold;">with-current-buffer</span> (find-file-noselect file)
                             (org-clock-get-table-data (buffer-name) params))))
           (<span style="font-weight: bold;">when</span> (&gt; (nth 1 clock-data) 0)
             (<span style="font-weight: bold;">setq</span> total (+ total (nth 1 clock-data)))
             (insert (format <span style="font-style: italic;">"| | File *%s* | %.2f |\n"</span>
                             (file-name-nondirectory file)
                             (/ (nth 1 clock-data) 60.0)))
             (<span style="font-weight: bold;">dolist</span> (entry (nth 2 clock-data))
               (insert (format <span style="font-style: italic;">"| | . %s%s | %s %.2f |\n"</span>
                               (org-clocktable-indent-string (nth 0 entry))
                               (replace-regexp-in-string <span style="font-style: italic;">"|"</span> <span style="font-style: italic;">"\\vert</span><span style="font-weight: bold; font-style: italic;">\</span><span style="font-style: italic;">{</span><span style="font-weight: bold; font-style: italic;">\</span><span style="font-style: italic;">}"</span> (nth 1 entry) nil t)
                               (clocktable-by-tag/shift-cell (nth 0 entry))
                               (/ (nth 4 entry) 60.0)))))))
       (org-agenda-files))
      (<span style="font-weight: bold;">if</span> (= total 0)
          (<span style="font-weight: bold;">save-excursion</span>
            (re-search-backward <span style="font-style: italic;">"*Tag time*"</span>)
            (forward-line -1)
            (<span style="font-weight: bold;">dotimes</span> (i 2)
              (org-table-kill-row)))
        (<span style="font-weight: bold;">save-excursion</span>
          (re-search-backward <span style="font-style: italic;">"*Tag time*"</span>)
          (org-table-next-field)
          (org-table-blank-field)
          (insert (format <span style="font-style: italic;">"*%.2f*"</span> (/ total 60.0))))))
    (org-table-align)))

<span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">org-dblock-write:clocktable-by-tag</span> (params)
  (funcall indent-line-function)
  (insert <span style="font-style: italic;">"| Tag | Headline | Time (h) |\n"</span>)
  (insert <span style="font-style: italic;">"|     |          | &lt;r&gt;  |\n"</span>)
  (<span style="font-weight: bold;">let</span> ((matches
         (org-global-tags-completion-table)))
    (mapcar (<span style="font-weight: bold;">lambda</span> (match)
              (<span style="font-weight: bold;">let</span> ((match-str (car match))
                    (case-fold-search nil))
                (<span style="font-weight: bold;">when</span> (string-match-p <span style="font-style: italic;">"^AC_"</span> match-str)
                  (<span style="font-weight: bold;">setq</span> params (plist-put params <span style="font-weight: bold;">:match</span> match-str))
                  (clocktable-by-tag/insert-tag params))))
            matches)))

(<span style="font-weight: bold;">provide</span> '<span style="font-weight: bold; text-decoration: underline;">org-clocktable-by-tag</span>)
</pre>
</div>
</div>
</li>

<li><a id="org105d2f6"></a>weather<br />
<div class="outline-text-5" id="text-org105d2f6">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#27671;&#35937;&#24193;&#37197;&#20449;&#12398;&#22825;&#27671;&#24773;&#22577;&#12434;&#21152;&#24037;&#12375;&#12390;&#34920;&#31034;</span>

(<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">request</span>)
(<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">cl-lib</span>)

(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">weather-areas</span>
  '(((url . <span style="font-style: italic;">"http://www.drk7.jp/weather/xml/14.xml"</span>)
     (pref . <span style="font-style: italic;">"&#31070;&#22856;&#24029;&#30476;"</span>)
     (area . <span style="font-style: italic;">"&#35199;&#37096;"</span>))
    ((url . <span style="font-style: italic;">"http://www.drk7.jp/weather/xml/22.xml"</span>)
     (pref . <span style="font-style: italic;">"&#38745;&#23713;&#30476;"</span>)
     (area . <span style="font-style: italic;">"&#20013;&#37096;"</span>))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">weather-area-show</span> (weather-area-alist weather-buffer)
  (lexical-let ((url (assoc-default 'url weather-area-alist))
                (pref (assoc-default 'pref weather-area-alist))
                (area (assoc-default 'area weather-area-alist))
                (buffer weather-buffer))
    (request
      url
      <span style="font-weight: bold;">:parser</span>
      (<span style="font-weight: bold;">lambda</span> ()
        (<span style="font-weight: bold;">let</span> ((xml-string (string-as-multibyte (string-as-unibyte (buffer-string)))))
          (<span style="font-weight: bold;">with-temp-buffer</span>
            (erase-buffer)
            (insert xml-string)
            (libxml-parse-xml-region (point-min) (point-max)))))
      <span style="font-weight: bold;">:success</span>
      (<span style="font-weight: bold;">cl-function</span>
       (<span style="font-weight: bold;">lambda</span> (<span style="font-weight: bold; text-decoration: underline;">&amp;key</span> data <span style="font-weight: bold; text-decoration: underline;">&amp;allow-other-keys</span>)
         (<span style="font-weight: bold;">when</span> data
           (<span style="font-weight: bold;">with-current-buffer</span> buffer
             (insert (format <span style="font-style: italic;">"%s %s\n"</span> pref area))
             (mapcar
              (<span style="font-weight: bold;">lambda</span> (info-node)
                (insert
                 (format <span style="font-style: italic;">"%s %s %s %s\n"</span>
                         (<span style="font-weight: bold;">dom-attr</span> info-node 'date)
                         (apply (<span style="font-weight: bold;">lambda</span> (max-temp-node min-temp-node)
                                  (format <span style="font-style: italic;">"%2d/%2d&#8451;"</span>
                                          (string-to-number (dom-text min-temp-node))
                                          (string-to-number (dom-text max-temp-node))))
                                (dom-by-tag (dom-child-by-tag info-node 'temperature) 'range))
                         (apply (<span style="font-weight: bold;">lambda</span> (node-1 node-2 node-3 node-4)
                                  (format <span style="font-style: italic;">"%2d-%2d-%2d-%2d&#65285;"</span>
                                          (string-to-number (dom-text node-1))
                                          (string-to-number (dom-text node-2))
                                          (string-to-number (dom-text node-3))
                                          (string-to-number (dom-text node-4))))
                                (dom-by-tag (dom-child-by-tag info-node 'rainfallchance) 'period))
                         (dom-text (dom-child-by-tag info-node 'weather)))))
              (dom-by-tag (dom-by-id data area) 'info))
             (insert <span style="font-style: italic;">"\n"</span>))))))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">weather</span> ()
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">let</span> ((buffer (get-buffer-create <span style="font-style: italic;">"weather"</span>)))
    (mapcar (<span style="font-weight: bold;">lambda</span> (weather-area)
              (weather-area-show weather-area buffer))
            weather-areas)
    (switch-to-buffer buffer)))

(<span style="font-weight: bold;">provide</span> '<span style="font-weight: bold; text-decoration: underline;">weather</span>)
</pre>
</div>
</div>
</li>

<li><a id="orgdccc159"></a>dispatch-dwim<br />
<div class="outline-text-5" id="text-orgdccc159">
<div class="org-src-container">
<pre class="src src-emacs-lisp" id="orgc7004d6"><span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">-*- lexical-binding: t -*-</span>

(<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">transient</span>)
(<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">detached</span>)

<span style="font-weight: bold; font-style: italic;">;;; </span><span style="font-weight: bold; font-style: italic;">Variables</span>

(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">dispatch-dwim--precedings-followings</span> nil)
(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">dispatch-dwim--overriding-method</span> nil)

(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">dispatch-dwim--default-method</span> 'detached-shell-command)

(add-hook 'transient-exit-hook
          (<span style="font-weight: bold;">lambda</span> () (<span style="font-weight: bold;">unless</span> transient--stack
                   (<span style="font-weight: bold;">setq</span> dispatch-dwim--precedings-followings nil
                         dispatch-dwim--overriding-method nil))))

<span style="font-weight: bold; font-style: italic;">;;; </span><span style="font-weight: bold; font-style: italic;">Classes &amp; Objects</span>

(<span style="font-weight: bold;">defclass</span> <span style="font-weight: bold; text-decoration: underline;">dispatch-shell-command</span> (transient-suffix)
  ((command-format <span style="font-weight: bold;">:initarg</span> <span style="font-weight: bold;">:command-format</span> <span style="font-weight: bold;">:initform</span> <span style="font-style: italic;">"%a"</span>)
   (command-format-spec <span style="font-weight: bold;">:initarg</span> <span style="font-weight: bold;">:command-format-spec</span> <span style="font-weight: bold;">:initform</span> nil)
   (dispatch-method <span style="font-weight: bold;">:initarg</span> <span style="font-weight: bold;">:dispatch-method</span>)))

(<span style="font-weight: bold;">cl-defmethod</span> <span style="font-weight: bold;">transient-init-value</span> ((obj dispatch-shell-command))
  (<span style="font-weight: bold;">unless</span> (slot-boundp obj <span style="font-weight: bold;">:command-format</span>)
    (<span style="font-weight: bold;">oset</span> obj command-format <span style="font-style: italic;">"%a"</span>))
  (<span style="font-weight: bold;">oset</span> obj dispatch-method
        (<span style="font-weight: bold;">cond</span>
         ((<span style="font-weight: bold;">and</span> transient--stack
               dispatch-dwim--overriding-method))
         ((eq major-mode 'minibuffer-mode)
          'insert)
         (t dispatch-dwim--default-method))))

(transient-define-suffix dispatch-dwim-execute ()
  <span style="font-weight: bold;">:class</span> dispatch-shell-command
  <span style="font-weight: bold;">:transient</span> 'transient--do-return
  <span style="font-weight: bold;">:key</span> <span style="font-style: italic;">"x"</span> <span style="font-weight: bold;">:description</span> <span style="font-style: italic;">"execute"</span>
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">let*</span> ((cur-obj (transient-suffix-object))
         (command-format-spec (<span style="font-weight: bold;">and</span> (slot-boundp cur-obj <span style="font-weight: bold;">:command-format-spec</span>)
                                   (<span style="font-weight: bold;">oref</span> cur-obj command-format-spec)))
         (main-comm (format-spec
                     (eval (<span style="font-weight: bold;">oref</span> cur-obj command-format))
                     (append
                      `((?a . ,(string-join (transient-get-value) <span style="font-style: italic;">" "</span>)))
                      (<span style="font-weight: bold;">when</span> command-format-spec
                        (mapcar (<span style="font-weight: bold;">lambda</span> (key-val) (cons (car key-val) (eval (cdr key-val))))
                                command-format-spec)))))
         (comm (mapconcat (<span style="font-weight: bold;">lambda</span> (elm) (cadr elm))
                          (sort (append dispatch-dwim--precedings-followings
                                        `((<span style="font-style: italic;">"@"</span> ,main-comm 50)))
                                (<span style="font-weight: bold;">lambda</span> (a b) (&lt; (nth 2 a) (nth 2 b))))
                          <span style="font-style: italic;">"; "</span>)))
    (apply (<span style="font-weight: bold;">oref</span> cur-obj dispatch-method)
           `(,(<span style="font-weight: bold;">if</span> transient--stack
                  main-comm comm)))
    (<span style="font-weight: bold;">unless</span> transient--stack
      (<span style="font-weight: bold;">setq</span> dispatch-dwim--precedings-followings nil))))

(<span style="font-weight: bold;">defclass</span> <span style="font-weight: bold; text-decoration: underline;">dispatch-dwim-stack-suffix</span> (transient-suffix)
  ((prefix <span style="font-weight: bold;">:initarg</span> <span style="font-weight: bold;">:prefix</span>)
   (prefix-arg <span style="font-weight: bold;">:initarg</span> <span style="font-weight: bold;">:prefix-arg</span> <span style="font-weight: bold;">:initform</span> nil)
   (priority <span style="font-weight: bold;">:initarg</span> <span style="font-weight: bold;">:priority</span> <span style="font-weight: bold;">:initform</span> 0)
   (default <span style="font-weight: bold;">:initarg</span> <span style="font-weight: bold;">:default</span>)
   (format <span style="font-weight: bold;">:initform</span> <span style="font-style: italic;">" %k %d (%v)"</span>)))

(transient-define-suffix dispatch-dwim-fraction-command ()
  <span style="font-weight: bold;">:class</span> dispatch-dwim-stack-suffix
  <span style="font-weight: bold;">:transient</span> 'transient--do-recurse
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">let</span> ((cur-obj (transient-suffix-object)))
    (<span style="font-weight: bold;">setq</span> dispatch-dwim--overriding-method
          (<span style="font-weight: bold;">lambda</span> (shell-command)
            (<span style="font-weight: bold;">setf</span> (alist-get (<span style="font-weight: bold;">oref</span> cur-obj key) dispatch-dwim--precedings-followings)
                  (list shell-command
                        (<span style="font-weight: bold;">oref</span> cur-obj priority)))))
    (apply (<span style="font-weight: bold;">oref</span> cur-obj prefix)
           (<span style="font-weight: bold;">oref</span> cur-obj prefix-arg))))

(<span style="font-weight: bold;">cl-defmethod</span> <span style="font-weight: bold;">transient-init-value</span> ((obj dispatch-dwim-stack-suffix))
  (<span style="font-weight: bold;">when</span> (slot-boundp obj <span style="font-weight: bold;">:default</span>)
    (<span style="font-weight: bold;">setf</span> (alist-get (<span style="font-weight: bold;">oref</span> obj key) dispatch-dwim--precedings-followings)
          (list (<span style="font-weight: bold;">oref</span> obj default)
                (<span style="font-weight: bold;">oref</span> obj priority)))))

(<span style="font-weight: bold;">cl-defmethod</span> <span style="font-weight: bold;">transient-format-value</span> ((obj dispatch-dwim-stack-suffix))
  (<span style="font-weight: bold;">if-let</span> ((comm (assoc (<span style="font-weight: bold;">oref</span> obj key)
                        dispatch-dwim--precedings-followings)))
      (propertize (cadr comm)
                  'face 'transient-argument)
    <span style="font-style: italic;">""</span>))

(<span style="font-weight: bold;">cl-defmethod</span> <span style="font-weight: bold;">transient-format</span> ((obj dispatch-dwim-stack-suffix))
  (format-spec (<span style="font-weight: bold;">oref</span> obj format)
               `((?k . ,(transient-format-key obj))
                 (?d . ,(transient-format-description obj))
                 (?v . ,(transient-format-value obj)))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">dispatch-shell-command--key-vals</span> (keys)
  (mapconcat 'transient-infix-value
             (seq-filter (<span style="font-weight: bold;">lambda</span> (obj) (<span style="font-weight: bold;">and</span> (member (<span style="font-weight: bold;">oref</span> obj key) keys) obj))
                         (transient-suffixes (<span style="font-weight: bold;">oref</span> transient-current-prefix command)))
             <span style="font-style: italic;">" "</span>))

<span style="font-weight: bold; font-style: italic;">;;; </span><span style="font-weight: bold; font-style: italic;">Functions</span>

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">dispatch-command-dwim/determine-file</span> (<span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> file)
  <span style="font-style: italic;">""</span>
  (<span style="font-weight: bold;">cl-labels</span> ((read-file ()
                (read-file-name <span style="font-style: italic;">"File: "</span>)))
    (apply (<span style="font-weight: bold;">or</span> (<span style="font-weight: bold;">and</span> file
                    `(dispatch-dwim--paths-string ,file))
               (<span style="font-weight: bold;">cond</span>
                ((derived-mode-p 'dired-mode)
                 `(dispatch-dwim--paths-string ,(dired-get-marked-files)))
                ((derived-mode-p 'minibuffer-mode)
                 (<span style="font-weight: bold;">cond</span>
                  ((equal minibuffer-history-variable 'dired-shell-command-history)
                   '(identity <span style="font-style: italic;">"`?`"</span>))
                  ((<span style="font-weight: bold;">or</span> (member minibuffer-history-variable
                               '(detached-shell-command-history
                                 shell-command-history)))
                   (<span style="font-weight: bold;">with-current-buffer</span> (other-buffer nil t)
                     `(dispatch-dwim--paths-string
                       ,(<span style="font-weight: bold;">if</span> (derived-mode-p 'dired-mode)
                            (<span style="font-weight: bold;">or</span> (dired-get-marked-files) (read-file))
                          (read-file)))))))
                (t `(dispatch-dwim--paths-string
                     ,(<span style="font-weight: bold;">or</span> (ffap-file-at-point)
                          (read-file)))))))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">dispatch-dwim--determine-url</span> (<span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> url)
  <span style="font-style: italic;">"Determine the URL to which the dwim commands refer in relation to the context."</span>
  (format <span style="font-style: italic;">"'%s'"</span> (<span style="font-weight: bold;">or</span> url
                     (thing-at-point-url-at-point)
                     (<span style="font-weight: bold;">and</span> (derived-mode-p 'eww-mode)
                          (shr-url-at-point nil))
                     (read-string <span style="font-style: italic;">"URL: "</span>))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">dispatch-dwim--paths-string</span> (arg)
  (<span style="font-weight: bold;">pcase</span> arg
    ((<span style="font-weight: bold;">and</span> (pred stringp) (pred file-exists-p) str)
     (shell-quote-argument (expand-file-name str)))
    ((<span style="font-weight: bold;">and</span> (pred stringp) (pred (string-match-p ffap-url-regexp)) (app (match-string 1) str))
     (dispatch-dwim--determine-url str))
    ((<span style="font-weight: bold;">and</span> (pred listp) li) (mapconcat #'dispatch-dwim--paths-string li <span style="font-style: italic;">" "</span>))))

(<span style="font-weight: bold;">provide</span> '<span style="font-weight: bold; text-decoration: underline;">dispatch-dwim</span>)
</pre>
</div>
</div>
</li>
</ul>
</div>
</div>

<div id="outline-container-org12504d6" class="outline-3">
<h3 id="org12504d6">Findutils</h3>
<div class="outline-text-3" id="text-org12504d6">
<p>
<a href="https://www.gnu.org/software/findutils/">GNU Findutils</a> offers following commands
</p>
<ul class="org-ul">
<li>find</li>
<li>locate</li>
<li>updatedb</li>
<li>xargs</li>
</ul>

<p>
'locate' is GNU implementation of mlocate. I prefer '[BROKEN LINK: id:c56e19dd-d3b1-4595-be74-0ff7c6558bc8]', which is fast than mlocate, for indexed file searching,
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"findutils"</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org2e4343b" class="outline-3">
<h3 id="org2e4343b">plocate</h3>
<div class="outline-text-3" id="text-org2e4343b">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"plocate"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp" id="org445aed8">(file-name-concat <span style="font-style: italic;">"&lt;&lt;share-dir()&gt;&gt;"</span> <span style="font-style: italic;">"plocate/plocate.db"</span>)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-shell"><span style="font-weight: bold;">export</span> <span style="font-weight: bold; font-style: italic;">LOCATE_PATH</span>=&lt;&lt;plocate-db()&gt;&gt;
</pre>
</div>

<div class="org-src-container">
<pre class="src src-bash">. ~/.bashrc

mkdir -p $(dirname &lt;&lt;plocate-db()&gt;&gt;) &amp;&amp; <span style="font-style: italic;">\</span>
  $<span style="font-weight: bold; font-style: italic;">GUIX_EXTRA_PROFILES</span>/base/base/sbin/updatedb -l 0 -U &lt;&lt;home-dir()&gt;&gt; -e &lt;&lt;open-file-dir()&gt;&gt; -o &lt;&lt;plocate-db()&gt;&gt; <span style="font-style: italic;">\</span>
                                               &lt;&lt;updatedb-opt&gt;&gt;
</pre>
</div>

<div class="org-src-container">
<pre class="src src-conf"><span style="font-weight: bold; font-style: italic;">*/20 * * * * &lt;&lt;which(filename</span>=<span style="font-style: italic;">"bash"</span>)&gt;&gt; -ci <span style="font-style: italic;">"updatedb-home"</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org3439d83" class="outline-3">
<h3 id="org3439d83">OpenSSH</h3>
<div class="outline-text-3" id="text-org3439d83">
<p>
<a href="https://www.openssh.com/">OpenSSH</a> is client and server side of ssh implementation.
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"openssh"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-conf">Include config.d/*

Compression yes
</pre>
</div>
</div>
</div>

<div id="outline-container-orga63bf3f" class="outline-3">
<h3 id="orga63bf3f">Git</h3>
<div class="outline-text-3" id="text-orga63bf3f">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"git"</span>
</pre>
</div>
</div>

<div id="outline-container-org7cd1ab6" class="outline-4">
<h4 id="org7cd1ab6">git ignore</h4>
<div class="outline-text-4" id="text-org7cd1ab6">
<div class="org-src-container">
<pre class="src src-conf"><span style="font-weight: bold; font-style: italic;">#</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">~/.gitignote</span>
<span style="font-weight: bold; font-style: italic;">#</span>
<span style="font-weight: bold; font-style: italic;">## </span><span style="font-weight: bold; font-style: italic;">Compiled object files ##</span>
*.slo
*.lo
*.o
*.obj

<span style="font-weight: bold; font-style: italic;">## </span><span style="font-weight: bold; font-style: italic;">Compiled Dynamic libraries ##</span>
*.so
*.dylib
*.dll

<span style="font-weight: bold; font-style: italic;">## </span><span style="font-weight: bold; font-style: italic;">Compiled Static libraries ##</span>
*.lai
*.la
*.a
*.lib

<span style="font-weight: bold; font-style: italic;">## </span><span style="font-weight: bold; font-style: italic;">Executables ##</span>
*.out
*.app

<span style="font-weight: bold; font-style: italic;">## </span><span style="font-weight: bold; font-style: italic;">Windows ##</span>
Thumbs.db
ehthumbs.db
Desktop.ini
$RECYCLE.BIN/
*.cab
*.msm
*.msp

<span style="font-weight: bold; font-style: italic;">## </span><span style="font-weight: bold; font-style: italic;">Mac ##</span>
.DS_Store
.AppleDouble
.LSOverride
.Spotlight-V100
.Trashes
._*

<span style="font-weight: bold; font-style: italic;">## </span><span style="font-weight: bold; font-style: italic;">Linux ##</span>
locate.db

<span style="font-weight: bold; font-style: italic;">## </span><span style="font-weight: bold; font-style: italic;">version control system ##</span>
.git/
.hg/
.svn/

<span style="font-weight: bold; font-style: italic;">## </span><span style="font-weight: bold; font-style: italic;">backup,log ##</span>
*~
~*
*.swp
.swp.*
*.tmp
*.bak
*.old
*.log
.cache/
*.autosave

<span style="font-weight: bold; font-style: italic;">## </span><span style="font-weight: bold; font-style: italic;">Emacs ##</span>
*.elc

<span style="font-weight: bold; font-style: italic;">## </span><span style="font-weight: bold; font-style: italic;">Vim ##</span>
*.un~
Session.vim
.netrwhist

<span style="font-weight: bold; font-style: italic;">## </span><span style="font-weight: bold; font-style: italic;">GNU GLOBAL ##</span>
GPATH
GRTAGS
GTAGS

<span style="font-weight: bold; font-style: italic;">## </span><span style="font-weight: bold; font-style: italic;">netbeans ##</span>
nbproject/
<span style="font-weight: bold; font-style: italic;">## </span><span style="font-weight: bold; font-style: italic;">intellij idea ##</span>
.idea/
<span style="font-weight: bold; font-style: italic;">## </span><span style="font-weight: bold; font-style: italic;">eclipse ##</span>
.settings/
.project
.classpath
.buildpath
<span style="font-weight: bold; font-style: italic;">## </span><span style="font-weight: bold; font-style: italic;">XCode ##</span>
*.xcodeproj/*

<span style="font-weight: bold; font-style: italic;">## </span><span style="font-weight: bold; font-style: italic;">Build dir ##</span>
build/
</pre>
</div>
</div>
</div>

<div id="outline-container-orga189190" class="outline-4">
<h4 id="orga189190">git config</h4>
<div class="outline-text-4" id="text-orga189190">
<p>
<a href="https://magit.vc/manual/magit/How-to-show-diffs-for-gpg_002dencrypted-files_003f.html">This page</a> show you how to get diffs of gpg files in Magit.
</p>

<div class="org-src-container">
<pre class="src src-gitconfig">[core]
	excludesfile = &lt;&lt;home-dir()&gt;&gt;/.config/git/info/ignore
	attributesfile = &lt;&lt;home-dir()&gt;&gt;/.config/git/info/attributes
	editor = emacs
	symlinks = true
	# Unicode
	precomposeunicode = true
	quotepath = true
	autocrlf = false
[push]
	# simple,matching,upstream,current
	default = simple
[color]
	ui = auto
	status = auto
	diff = auto
	branch = auto
	interactive = auto
	grep = auto
[diff]
	patience = true
[diff "gpg"]
	textconv = gpg --no-tty --decrypt
[diff "common-lisp"]
	xfuncname="^\\((def\\S+\\s+\\S+)"
[diff "elisp"]
	xfuncname="^\\((((def\\S+)|use-package)\\s+\\S+)"
[diff "org"]
	xfuncname="^\\*+ +(.*)$"
[help]
	autocorrect = 0
[alias]
	co = checkout
	ca = commit -a -v
	ce = commit -v --amend
	st = status --branch --short
	si = status --ignored --short
	branches = branch -a
	remotes = remote -v
	tags = tag -l
	lg = log --graph --all --decorate --abbrev-commit --branches --date=short --pretty=format:\"%C(red)%h%C(reset) %C(green)[%ad]%C(reset) %s %C(cyan)@%an%C(reset) %C(yellow)%d%C(reset)\"
	fp = fetch --prune
	di = diff
	dh = diff --histogram
	dw = diff --word-diff
	dc = diff --cached
	wc = whatchanged
[user]
	email = 6841207+p-snow@users.noreply.github.com
	name = p-snow
	signingkey = BDAF62D24445EFD3
[commit]
	gpgsign = true
[credential]
	helper = &lt;&lt;which(filename="pass-git-helper")&gt;&gt; -m &lt;&lt;home-dir()&gt;&gt;/.config/pass-git-helper/git-pass-mapping.ini
	&lt;&lt;git-config&gt;&gt;
</pre>
</div>
</div>
</div>
<div id="outline-container-org13033ae" class="outline-4">
<h4 id="org13033ae">git attributes</h4>
<div class="outline-text-4" id="text-org13033ae">
<div class="org-src-container">
<pre class="src src-gitattributes">*.c diff=cpp
*.h diff=cpp
*.cpp diff=cpp
*.hpp diff=cpp
*.cs diff=csharp
*.m diff=objc
*.java diff=java
*.html diff=html
*.xml diff=html
*.pl diff=perl
*.pm diff=perl
*.t diff=perl
*.php diff=php
*.ptml diff=php
*.py diff=python
*.rb diff=ruby
*.js diff=java
*.csv encoding=cp932
*.json diff=json
*.gpg filter=gpg diff=gpg
*.org diff=org
*.lisp diff=common-lisp
*.el diff=elisp
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org8ea5a14" class="outline-3">
<h3 id="org8ea5a14">git-annex</h3>
<div class="outline-text-3" id="text-org8ea5a14">
<p>
<a href="https://git-annex.branchable.com/git-annex/">git-annex</a> aims to manage large files based on git system. It is alse designed to manage copies of binary in distributed repositories. <a href="https://git-annex.branchable.com/walkthrough/">walkthrough</a> offers handy instruction.
</p>

<p>
<a href="https://git-lfs.github.com/">Git-LFS</a> is alse designed to manage large files. <a href="https://lwn.net/Articles/774125/">This article</a> compares Git-LFS and git-annex precisely.
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"git-annex"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-style: italic;">"https://git-annex.branchable.com/news/index.rss"</span> soft_update)
(<span style="font-style: italic;">"https://git-annex.branchable.com/devblog/index.rss"</span> soft_update)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-gitconfig">[annex]
	youtube-dl-command = yt-dlp
	synccontent = false
[annex.security]
	allowed-ip-addresses = all
[safe]
	directory = /mnt/ns01/doc
</pre>
</div>
</div>

<div id="outline-container-orgf2abdfc" class="outline-4">
<h4 id="orgf2abdfc">sync annex repos</h4>
<div class="outline-text-4" id="text-orgf2abdfc">
<div class="org-src-container">
<pre class="src src-conf"><span style="font-weight: bold; font-style: italic;">40 */4 * * * &lt;&lt;which(filename</span>=<span style="font-style: italic;">"sync-annex-doc"</span>)&gt;&gt; 2&gt;&amp;1 | tee &lt;&lt;log-dir()&gt;&gt;/sync-git-annex.log
</pre>
</div>

<div class="org-src-container">
<pre class="src src-shell"><span style="font-weight: bold; font-style: italic;">GIT</span>=&lt;&lt;which(<span style="font-weight: bold; font-style: italic;">filename</span>=<span style="font-style: italic;">"git"</span>)&gt;&gt;
<span style="font-weight: bold;">ANNEX=&lt;&lt;which(filename="git-annex")&gt;&gt;</span>

<span style="font-weight: bold;">(cd /mnt/exdoc/doc/ 2&gt;/dev/null &amp;&amp; $GIT rev-parse --is-inside-work-tree 2&gt;/dev/null &amp;&amp; $ANNEX sync &amp;&amp; $ANNEX get)</span>
<span style="font-weight: bold;">(cd /mnt/vt-m/doc/ 2&gt;/dev/null &amp;&amp; $GIT rev-parse --is-inside-work-tree 2&gt;/dev/null &amp;&amp; $ANNEX sync &amp;&amp; $ANNEX get)</span>
<span style="font-weight: bold;">(cd /mnt/vt-h/doc/ 2&gt;/dev/null &amp;&amp; $GIT rev-parse --is-inside-work-tree 2&gt;/dev/null &amp;&amp; $ANNEX sync &amp;&amp; $ANNEX get)</span>
<span style="font-weight: bold;">(cd /mnt/vt-j/doc/ 2&gt;/dev/null &amp;&amp; $GIT rev-parse --is-inside-work-tree 2&gt;/dev/null &amp;&amp; $ANNEX sync &amp;&amp; $ANNEX get)</span>
<span style="font-weight: bold;">(cd &lt;&lt;doc-dir()&gt;&gt; 2&gt;/dev/null &amp;&amp; $GIT rev-parse --is-inside-work-tree 2&gt;/dev/null &amp;&amp; $ANNEX sync)</span>

<span style="font-weight: bold;">(cd /mnt/exdoc/doc/ 2&gt;/dev/null &amp;&amp; $GIT rev-parse --is-inside-work-tree 2&gt;/dev/null &amp;&amp; $ANNEX sync)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org17e6bea" class="outline-3">
<h3 id="org17e6bea">ghq</h3>
<div class="outline-text-3" id="text-org17e6bea">
<p>
<a href="https://github.com/x-motemen/ghq">ghq</a> is management system for remote git repositories.
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"ghq"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-shell" id="org7071e00"><span style="font-weight: bold;">echo</span> ~/data/ghq
</pre>
</div>

<div class="org-src-container">
<pre class="src src-gitconfig">[ghq]
	root = &lt;&lt;ghq-root()&gt;&gt;
</pre>
</div>

<div class="org-src-container">
<pre class="src src-conf">[<span style="font-weight: bold; text-decoration: underline;">github.com*</span>]
<span style="font-weight: bold; font-style: italic;">username_extractor</span>=specific_line
<span style="font-weight: bold; font-style: italic;">line_username</span>=2
<span style="font-weight: bold; font-style: italic;">target</span>=github.com
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">username_extractor=entry_name</span>
</pre>
</div>

<ul class="org-ul">
<li><p>
make some projects invisible from plocate command
</p>
<div class="org-src-container">
<pre class="src src-shell" id="org5dc5c69">ghq list --full-path p-snow/dotfiles
</pre>
</div>

<div class="org-src-container">
<pre class="src src-shell">-e <span style="font-style: italic;">"&lt;&lt;ghq-invisible-projects()&gt;&gt;"</span> <span style="font-style: italic;">\</span>
</pre>
</div></li>
</ul>
</div>
</div>

<div id="outline-container-orgb2018ef" class="outline-3">
<h3 id="orgb2018ef">Pass</h3>
<div class="outline-text-3" id="text-orgb2018ef">
<p>
<a href="https://www.passwordstore.org/">Pass</a> is a simple password manager.
</p>

<p>
I've chosen to use gpg/gpg-agent and pass on Ubuntu system since pass (password-store) spouts a warning saying there's gpg version mismatch persistently.
</p>
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">"password-store"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-conf">[<span style="font-weight: bold; text-decoration: underline;">github.com*</span>]
<span style="font-weight: bold; font-style: italic;">username_extractor</span>=specific_line
<span style="font-weight: bold; font-style: italic;">line_username</span>=2
<span style="font-weight: bold; font-style: italic;">target</span>=github.com
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">username_extractor=entry_name</span>
</pre>
</div>

<ul class="org-ul">
<li><p>
additional environment variables
</p>
<div class="org-src-container">
<pre class="src src-shell"><span style="font-weight: bold;">export</span> <span style="font-weight: bold; font-style: italic;">PASSWORD_STORE_CLIP_TIME</span>=25
</pre>
</div></li>
</ul>
</div>
</div>
<div id="outline-container-org21b4cef" class="outline-3">
<h3 id="org21b4cef">mpv</h3>
<div class="outline-text-3" id="text-org21b4cef">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">"mpv-libarchive"</span>
</pre>
</div>

<ul class="org-ul">
<li><p>
mpv.conf
</p>
<div class="org-src-container">
<pre class="src src-conf"><span style="font-weight: bold; font-style: italic;">##################</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">video settings #</span>
<span style="font-weight: bold; font-style: italic;">##################</span>

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Start in fullscreen mode by default.</span>
<span style="font-weight: bold; font-style: italic;">fs</span>=yes


<span style="font-weight: bold; font-style: italic;">###########</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">General #</span>
<span style="font-weight: bold; font-style: italic;">###########</span>

save-position-on-quit
no-border                               <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">no window title bar</span>
msg-module                              <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">prepend module name to log messages</span>
msg-color                               <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">color log messages on terminal</span>
term-osd-bar                            <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">display a progress bar on the terminal</span>
use-filedir-conf                        <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">look for additional config files in the directory of the opened file</span>
pause                                   <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">no autoplay</span>
<span style="font-weight: bold; font-style: italic;">force-window</span>=immediate
keep-open                               <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">keep the player open when a file's end is reached</span>
<span style="font-weight: bold; font-style: italic;">autofit-larger</span>=100%x95%                 <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">resize window in case it's larger than W%xH% of the screen</span>
cursor-autohide-fs-only                 <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">don't autohide the cursor in window mode, only fullscreen</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">input-media-keys=no                     # enable/disable OSX media keys</span>
<span style="font-weight: bold; font-style: italic;">cursor-autohide</span>=1000                    <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">autohide the curser after 1s</span>

<span style="font-weight: bold; font-style: italic;">screenshot-format</span>=png
<span style="font-weight: bold; font-style: italic;">screenshot-png-compression</span>=8
<span style="font-weight: bold; font-style: italic;">screenshot-template</span>=<span style="font-style: italic;">'~/Desktop/%F (%P) %n'</span>

<span style="font-weight: bold; font-style: italic;">hls-bitrate</span>=max                         <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">use max quality for HLS streams</span>


<span style="font-weight: bold; font-style: italic;">#########</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Cache #</span>
<span style="font-weight: bold; font-style: italic;">#########</span>

<span style="font-weight: bold; font-style: italic;">cache</span>=yes
<span style="font-weight: bold; font-style: italic;">cache-secs</span>=10                           <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">how many seconds of audio/video to prefetch if the cache is active</span>


<span style="font-weight: bold; font-style: italic;">#############</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">OSD / OSC #</span>
<span style="font-weight: bold; font-style: italic;">#############</span>

<span style="font-weight: bold; font-style: italic;">osd-level</span>=1                             <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">enable osd and display --osd-status-msg on interaction</span>
<span style="font-weight: bold; font-style: italic;">osd-duration</span>=2500                       <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">hide the osd after x ms</span>
<span style="font-weight: bold; font-style: italic;">osd-status-msg</span>=<span style="font-style: italic;">'${time-pos} / ${duration}${?percent-pos: (${percent-pos}%)}${?frame-drop-count:${!frame-drop-count==0: Dropped: ${frame-drop-count}}}\n${?chapter:Chapter: ${chapter}}'</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">osd-status-msg='${=time-pos}'         # show raw position</span>

<span style="font-weight: bold; font-style: italic;">osd-font</span>=<span style="font-style: italic;">'Source Sans Pro'</span>
<span style="font-weight: bold; font-style: italic;">osd-font-size</span>=64
<span style="font-weight: bold; font-style: italic;">osd-color</span>=<span style="font-style: italic;">'#CCFFFFFF'</span>                   <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">ARGB format</span>
<span style="font-weight: bold; font-style: italic;">osd-border-color</span>=<span style="font-style: italic;">'#DD322640'</span>            <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">ARGB format</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">osd-shadow-offset=1                    # pixel width for osd text and progress bar</span>
<span style="font-weight: bold; font-style: italic;">osd-bar-align-y</span>=0                       <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">progress bar y alignment (-1 top, 0 centered, 1 bottom)</span>
<span style="font-weight: bold; font-style: italic;">osd-border-size</span>=2                       <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">size for osd text and progress bar</span>
<span style="font-weight: bold; font-style: italic;">osd-bar-h</span>=2                             <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">height of osd bar as a fractional percentage of your screen height</span>
<span style="font-weight: bold; font-style: italic;">osd-bar-w</span>=60                            <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">width of " " "</span>


<span style="font-weight: bold; font-style: italic;">#############</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Subtitles #</span>
<span style="font-weight: bold; font-style: italic;">#############</span>

sub-use-margins
sub-ass-force-margins

demuxer-mkv-subtitle-preroll            <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">try to correctly show embedded subs when seeking</span>
<span style="font-weight: bold; font-style: italic;">sub-auto</span>=fuzzy                          <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">external subs don't have to match the file name exactly to autoload</span>
<span style="font-weight: bold; font-style: italic;">embeddedfonts</span>=yes                       <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">use embedded fonts for SSA/ASS subs</span>
<span style="font-weight: bold; font-style: italic;">sub-fix-timing</span>=no                       <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">do not try to fix gaps (which might make it worse in some cases)</span>
<span style="font-weight: bold; font-style: italic;">sub-ass-force-style</span>=Kerning=yes         <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">allows you to override style parameters of ASS scripts</span>

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">the following options only apply to subtitles without own styling (i.e. not ASS but e.g. SRT)</span>
<span style="font-weight: bold; font-style: italic;">sub-font</span>=<span style="font-style: italic;">"Source Sans Pro Semibold"</span>
<span style="font-weight: bold; font-style: italic;">sub-font-size</span>=36
<span style="font-weight: bold; font-style: italic;">sub-color</span>=<span style="font-style: italic;">"#FFFFFFFF"</span>
<span style="font-weight: bold; font-style: italic;">sub-border-color</span>=<span style="font-style: italic;">"#FF262626"</span>
<span style="font-weight: bold; font-style: italic;">sub-border-size</span>=3.2
<span style="font-weight: bold; font-style: italic;">sub-shadow-offset</span>=1
<span style="font-weight: bold; font-style: italic;">sub-shadow-color</span>=<span style="font-style: italic;">"#33000000"</span>
<span style="font-weight: bold; font-style: italic;">sub-spacing</span>=0.5


<span style="font-weight: bold; font-style: italic;">#############</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Languages #</span>
<span style="font-weight: bold; font-style: italic;">#############</span>

<span style="font-weight: bold; font-style: italic;">slang</span>=enm,en,eng,de,deu,ger             <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">automatically select these subtitles (decreasing priority)</span>
<span style="font-weight: bold; font-style: italic;">alang</span>=ja,jp,jpn,en,eng,de,deu,ger       <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">automatically select these audio tracks (decreasing priority)</span>

<span style="font-weight: bold; font-style: italic;">#########</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Image #</span>
<span style="font-weight: bold; font-style: italic;">#########</span>

<span style="font-weight: bold; font-style: italic;">image-display-duration</span>=4

<span style="font-weight: bold; font-style: italic;">#########</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Audio #</span>
<span style="font-weight: bold; font-style: italic;">#########</span>

<span style="font-weight: bold; font-style: italic;">audio-file-auto</span>=fuzzy                   <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">external audio doesn't has to match the file name exactly to autoload</span>
<span style="font-weight: bold; font-style: italic;">audio-pitch-correction</span>=yes              <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">automatically insert scaletempo when playing with higher speed</span>
<span style="font-weight: bold; font-style: italic;">volume-max</span>=200                          <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">maximum volume in %, everything above 100 results in amplification</span>
<span style="font-weight: bold; font-style: italic;">volume</span>=100                              <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">default volume, 100 = unchanged</span>


<span style="font-weight: bold; font-style: italic;">################</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Video Output #</span>
<span style="font-weight: bold; font-style: italic;">################</span>

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Active VOs (and some other options) are set conditionally</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">See here for more information: https://github.com/wm4/mpv-scripts/blob/master/auto-profiles.lua</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">The script was modified to import functions from scripts/auto-profiles-functions.lua</span>

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Defaults for all profiles</span>
<span style="font-weight: bold; font-style: italic;">tscale</span>=catmull_rom                      <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">sharp: oversample &lt;-&gt; linear (triangle) &lt;-&gt; catmull_rom &lt;-&gt; mitchell &lt;-&gt; gaussian &lt;-&gt; bicubic : smooth</span>
<span style="font-weight: bold; font-style: italic;">opengl-early-flush</span>=no
<span style="font-weight: bold; font-style: italic;">opengl-pbo</span>=yes


[<span style="font-weight: bold; text-decoration: underline;">high-quality</span>]
<span style="font-weight: bold; font-style: italic;">profile-desc</span>=cond:is_desktop() and get(<span style="font-style: italic;">'width'</span>, math.huge) &lt; 3840
<span style="font-weight: bold; font-style: italic;">scale</span>=ewa_lanczossharp
<span style="font-weight: bold; font-style: italic;">cscale</span>=ewa_lanczossoft
<span style="font-weight: bold; font-style: italic;">dscale</span>=mitchell
<span style="font-weight: bold; font-style: italic;">scale-antiring</span>=0.7
<span style="font-weight: bold; font-style: italic;">cscale-antiring</span>=0.7
<span style="font-weight: bold; font-style: italic;">dither-depth</span>=auto
<span style="font-weight: bold; font-style: italic;">correct-downscaling</span>=yes
<span style="font-weight: bold; font-style: italic;">sigmoid-upscaling</span>=yes
<span style="font-weight: bold; font-style: italic;">deband</span>=yes
<span style="font-weight: bold; font-style: italic;">hwdec</span>=no

[<span style="font-weight: bold; text-decoration: underline;">mid-quality</span>]
<span style="font-weight: bold; font-style: italic;">profile-desc</span>=cond:(is_laptop() and not on_battery() and get(<span style="font-style: italic;">'width'</span>, math.huge) &lt; 1920) or (is_desktop() and get(<span style="font-style: italic;">'width'</span>, math.huge) &gt;= 3840)
<span style="font-weight: bold; font-style: italic;">scale</span>=spline36
<span style="font-weight: bold; font-style: italic;">cscale</span>=bilinear
<span style="font-weight: bold; font-style: italic;">dscale</span>=mitchell
<span style="font-weight: bold; font-style: italic;">scale-antiring</span>=1.0
<span style="font-weight: bold; font-style: italic;">cscale-antiring</span>=1.0
<span style="font-weight: bold; font-style: italic;">dither-depth</span>=auto
<span style="font-weight: bold; font-style: italic;">correct-downscaling</span>=yes
<span style="font-weight: bold; font-style: italic;">sigmoid-upscaling</span>=yes
<span style="font-weight: bold; font-style: italic;">deband</span>=yes
<span style="font-weight: bold; font-style: italic;">hwdec</span>=no

[<span style="font-weight: bold; text-decoration: underline;">low-quality</span>]
<span style="font-weight: bold; font-style: italic;">profile-desc</span>=cond:is_laptop() and (on_battery() or get(<span style="font-style: italic;">'width'</span>, math.huge) &gt;= 1920)
<span style="font-weight: bold; font-style: italic;">scale</span>=bilinear
<span style="font-weight: bold; font-style: italic;">cscale</span>=bilinear
<span style="font-weight: bold; font-style: italic;">dscale</span>=bilinear
<span style="font-weight: bold; font-style: italic;">scale-antiring</span>=0.0
<span style="font-weight: bold; font-style: italic;">cscale-antiring</span>=0.0
<span style="font-weight: bold; font-style: italic;">dither-depth</span>=no
<span style="font-weight: bold; font-style: italic;">correct-downscaling</span>=no
<span style="font-weight: bold; font-style: italic;">sigmoid-upscaling</span>=no
<span style="font-weight: bold; font-style: italic;">deband</span>=no
<span style="font-weight: bold; font-style: italic;">hwdec</span>=auto

[<span style="font-weight: bold; text-decoration: underline;">60FPS</span>]
<span style="font-weight: bold; font-style: italic;">profile-desc</span>=cond:is_laptop() and get(<span style="font-style: italic;">'container-fps'</span>, 0) &gt;= 59
<span style="font-weight: bold; font-style: italic;">scale</span>=bilinear
<span style="font-weight: bold; font-style: italic;">cscale</span>=bilinear

[<span style="font-weight: bold; text-decoration: underline;">4K</span>]
<span style="font-weight: bold; font-style: italic;">profile-desc</span>=cond:get(<span style="font-style: italic;">'width'</span>, -math.huge) &gt;= 3840
<span style="font-weight: bold; font-style: italic;">vd-lavc-threads</span>=32

[<span style="font-weight: bold; text-decoration: underline;">4K-inverted</span>]
<span style="font-weight: bold; font-style: italic;">profile-desc</span>=cond:get(<span style="font-style: italic;">'width'</span>, -math.huge) &lt; 3840
<span style="font-weight: bold; font-style: italic;">vd-lavc-threads</span>=0


[<span style="font-weight: bold; text-decoration: underline;">default</span>]


<span style="font-weight: bold; font-style: italic;">###################################</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Protocol Specific Configuration #</span>
<span style="font-weight: bold; font-style: italic;">###################################</span>

[<span style="font-weight: bold; text-decoration: underline;">protocol.https</span>]
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">cache=yes</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">cache-default=500000                    # size in KB</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">cache-backbuffer=250000                 # size in KB</span>
<span style="font-weight: bold; font-style: italic;">cache-secs</span>=100                          <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">how many seconds of audio/video to prefetch</span>
<span style="font-weight: bold; font-style: italic;">user-agent</span>=<span style="font-style: italic;">'Mozilla/5.0 (Macintosh; Intel Mac OS X 10.11; rv:47.0) Gecko/20100101 Firefox/47.0'</span>

[<span style="font-weight: bold; text-decoration: underline;">protocol.http</span>]
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">cache=yes</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">cache-default=500000                    # size in KB</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">cache-backbuffer=250000                 # size in KB</span>
<span style="font-weight: bold; font-style: italic;">cache-secs</span>=100                          <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">how many seconds of audio/video to prefetch</span>
<span style="font-weight: bold; font-style: italic;">user-agent</span>=<span style="font-style: italic;">'Mozilla/5.0 (Macintosh; Intel Mac OS X 10.11; rv:47.0) Gecko/20100101 Firefox/47.0'</span>

[<span style="font-weight: bold; text-decoration: underline;">extension.gif</span>]
<span style="font-weight: bold; font-style: italic;">cache</span>=no
no-pause
<span style="font-weight: bold; font-style: italic;">loop-file</span>=yes

[<span style="font-weight: bold; text-decoration: underline;">extension.webm</span>]
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">cache=no</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">no-pause</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">loop-file=yes</span>
</pre>
</div></li>
<li><p>
input.conf
</p>
<div class="org-src-container">
<pre class="src src-conf"><span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">mpv keybindings</span>
<span style="font-weight: bold; font-style: italic;">#</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Location of user-defined bindings: ~/.config/mpv/input.conf</span>
<span style="font-weight: bold; font-style: italic;">#</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Lines starting with # are comments. Use SHARP to assign the # key.</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Copy this file and uncomment and edit the bindings you want to change.</span>
<span style="font-weight: bold; font-style: italic;">#</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">List of commands and further details: DOCS/man/input.rst</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">List of special keys: --input-keylist</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Keybindings testing mode: mpv --input-test --force-window --idle</span>
<span style="font-weight: bold; font-style: italic;">#</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Use 'ignore' to unbind a key fully (e.g. 'ctrl+a ignore').</span>
<span style="font-weight: bold; font-style: italic;">#</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Strings need to be quoted and escaped:</span>
<span style="font-weight: bold; font-style: italic;">#   </span><span style="font-weight: bold; font-style: italic;">KEY show-text "This is a single backslash: \\ and a quote: \" !"</span>
<span style="font-weight: bold; font-style: italic;">#</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">You can use modifier-key combinations like Shift+Left or Ctrl+Alt+x with</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">the modifiers Shift, Ctrl, Alt and Meta (may not work on the terminal).</span>
<span style="font-weight: bold; font-style: italic;">#</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">The default keybindings are hardcoded into the mpv binary.</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">You can disable them completely with: --no-input-default-bindings</span>

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Developer note:</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">On compilation, this file is baked into the mpv binary, and all lines are</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">uncommented (unless '#' is followed by a space) - thus this file defines the</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">default key bindings.</span>

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">If this is enabled, treat all the following bindings as default.</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">default-bindings start</span>

<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">MOUSE_BTN0 ignore                      # don't do anything</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">MOUSE_BTN0_DBL cycle fullscreen        # toggle fullscreen on/off</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">MOUSE_BTN2 cycle pause                 # toggle pause on/off</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">MOUSE_BTN3 seek 10</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">MOUSE_BTN4 seek -10</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">MOUSE_BTN5 add volume -2</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">MOUSE_BTN6 add volume 2</span>

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Mouse wheels, touchpad or other input devices that have axes</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">if the input devices supports precise scrolling it will also scale the</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">numeric value accordingly</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">AXIS_UP    seek 10</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">AXIS_DOWN  seek -10</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">AXIS_LEFT  seek 5</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">AXIS_RIGHT seek -5</span>

<span style="font-weight: bold; font-style: italic;">## </span><span style="font-weight: bold; font-style: italic;">Seek units are in seconds, but note that these are limited by keyframes</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">RIGHT seek  5</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">LEFT  seek -5</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">UP    seek  60</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">DOWN  seek -60</span>
RIGHT  seek  5
LEFT   seek -5
UP     seek -60
DOWN   seek  60
Ctrl+f seek  3
Ctrl+b seek -3
Ctrl+p seek -60
Ctrl+n seek  60
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Do smaller, always exact (non-keyframe-limited), seeks with shift.</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Don't show them on the OSD (no-osd).</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">Shift+RIGHT no-osd seek  1 exact</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">Shift+LEFT  no-osd seek -1 exact</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">Shift+UP    no-osd seek  5 exact</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">Shift+DOWN  no-osd seek -5 exact</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Skip to previous/next subtitle (subject to some restrictions; see manpage)</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">Ctrl+LEFT   no-osd sub-seek -1</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">Ctrl+RIGHT  no-osd sub-seek  1</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">PGUP add chapter 1                     # skip to next chapter</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">PGDWN add chapter -1                   # skip to previous chapter</span>
PGUP add chapter -1                     <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">skip to next chapter</span>
PGDWN add chapter 1                     <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">skip to previous chapter</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">Shift+PGUP seek 600</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">Shift+PGDWN seek -600</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">[ multiply speed 0.9091                # scale playback speed</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">] multiply speed 1.1</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">{ multiply speed 0.5</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">} multiply speed 2.0</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">BS set speed 1.0                       # reset speed to normal</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">q quit</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">Q quit-watch-later</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">q {encode} quit 4</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">ESC set fullscreen no</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">ESC {encode} quit 4</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">p cycle pause                          # toggle pause/playback mode</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">. frame-step                           # advance one frame and pause</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">, frame-back-step                      # go back by one frame and pause</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">SPACE cycle pause</span>
? playlist-shuffle                      <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">skip to random file</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">&gt; playlist-next                        # skip to next file</span>
ENTER playlist-next                     <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">skip to next file</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">&lt; playlist-prev                        # skip to previous file</span>
Shift+ENTER playlist-prev               <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">skip to next file</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">O no-osd cycle-values osd-level 3 1    # cycle through OSD mode</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">o show-progress</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">P show-progress</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">I show-text "${filename}"              # display filename in osd</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">z add sub-delay -0.1                   # subtract 100 ms delay from subs</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">x add sub-delay +0.1                   # add</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">ctrl++ add audio-delay 0.100           # this changes audio/video sync</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">ctrl+- add audio-delay -0.100</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">9 add volume -2</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">/ add volume -2</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">0 add volume 2</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">* add volume 2</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">m cycle mute</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">1 add contrast -1</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">2 add contrast 1</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">3 add brightness -1</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">4 add brightness 1</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">5 add gamma -1</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">6 add gamma 1</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">7 add saturation -1</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">8 add saturation 1</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">Alt+0 set window-scale 0.5</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">Alt+1 set window-scale 1.0</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">Alt+2 set window-scale 2.0</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">toggle deinterlacer (automatically inserts or removes required filter)</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">d cycle deinterlace</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">r add sub-pos -1                       # move subtitles up</span>
r cycle_values video-rotate 90 180 270 0
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">t add sub-pos +1                       #                down</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">v cycle sub-visibility</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">stretch SSA/ASS subtitles with anamorphic videos to match historical</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">V cycle sub-ass-vsfilter-aspect-compat</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">switch between applying no style overrides to SSA/ASS subtitles, and</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">overriding them almost completely with the normal subtitle style</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">u cycle-values sub-ass-style-override "force" "no"</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">j cycle sub                            # cycle through subtitles</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">J cycle sub down                       # ...backwards</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">SHARP cycle audio                      # switch audio streams</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">_ cycle video</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">T cycle ontop                          # toggle video window ontop of other windows</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">f cycle fullscreen                     # toggle fullscreen</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">s async screenshot                     # take a screenshot</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">S async screenshot video               # ...without subtitles</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">Ctrl+s async screenshot window         # ...with subtitles and OSD, and scaled</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">Alt+s screenshot each-frame            # automatically screenshot every frame</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">w add panscan -0.1                     # zoom out with -panscan 0 -fs</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">e add panscan +0.1                     #      in</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">cycle video aspect ratios; "-1" is the container aspect</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">A cycle-values video-aspect "16:9" "4:3" "2.35:1" "-1"</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">POWER quit</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">PLAY cycle pause</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">PAUSE cycle pause</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">PLAYPAUSE cycle pause</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">STOP quit</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">FORWARD seek 60</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">REWIND seek -60</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">NEXT playlist-next</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">PREV playlist-prev</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">VOLUME_UP add volume 2</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">VOLUME_DOWN add volume -2</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">MUTE cycle mute</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">CLOSE_WIN quit</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">CLOSE_WIN {encode} quit 4</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">E cycle edition                        # next edition</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">l ab-loop                              # Set/clear A-B loop points</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">L cycle-values loop-file "inf" "no"    # toggle infinite looping</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">ctrl+c quit 4</span>

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Apple Remote section</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">AR_PLAY cycle pause</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">AR_PLAY_HOLD quit</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">AR_CENTER cycle pause</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">AR_CENTER_HOLD quit</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">AR_NEXT seek 10</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">AR_NEXT_HOLD seek 120</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">AR_PREV seek -10</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">AR_PREV_HOLD seek -120</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">AR_MENU show-progress</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">AR_MENU_HOLD cycle mute</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">AR_VUP add volume 2</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">AR_VUP_HOLD add chapter 1</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">AR_VDOWN add volume -2</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">AR_VDOWN_HOLD add chapter -1</span>

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">For tv://</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">h cycle tv-channel -1                  # previous channel</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">k cycle tv-channel +1                  # next channel</span>

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">For dvb://</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">H cycle dvb-channel-name -1            # previous channel</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">K cycle dvb-channel-name +1            # next channel</span>

<span style="font-weight: bold; font-style: italic;">#</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Legacy bindings (may or may not be removed in the future)</span>
<span style="font-weight: bold; font-style: italic;">#</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">! add chapter -1                       # skip to previous chapter</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">@ add chapter 1                        #         next</span>

<span style="font-weight: bold; font-style: italic;">#</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Not assigned by default</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">(not an exhaustive list of unbound commands)</span>
<span style="font-weight: bold; font-style: italic;">#</span>

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">? add sub-scale +0.1                  # increase subtitle font size</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">? add sub-scale -0.1                  # decrease subtitle font size</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">? sub-step -1                         # immediately display next subtitle</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">? sub-step +1                         #                     previous</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">? cycle angle                         # switch DVD/Bluray angle</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">? add balance -0.1                    # adjust audio balance in favor of left</span>
Z add balance -0.1                    <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">adjust audio balance in favor of left</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">? add balance 0.1                     #                                  right</span>
X add balance 0.1                     <span style="font-weight: bold; font-style: italic;">#                                  </span><span style="font-weight: bold; font-style: italic;">right</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">? cycle sub-forced-only               # toggle DVD forced subs</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">? cycle program                       # cycle transport stream programs</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">? stop                                # stop playback (quit or enter idle mode)</span>
</pre>
</div></li>
<li><p>
scripts
</p>
<div class="org-src-container">
<pre class="src src-lua">local utils = require "mp.utils"

del_list = {}

function contains_item(l, i)
   for k, v in pairs(l) do
      if v == i then
         mp.osd_message("undeleting current file")
         l[k] = nil
         return true
      end
   end
   mp.osd_message("deleting current file")
   return false
end

function mark_delete()
   local work_dir = mp.get_property_native("working-directory")
   local file_path = mp.get_property_native("path")
   local s = file_path:find(work_dir, 0, true)
   local final_path
   if s and s == 0 then
      final_path = file_path
   else
      final_path = utils.join_path(work_dir, file_path)
   end
   if not contains_item(del_list, final_path) then
      table.insert(del_list, final_path)
   end
end

function delete(e)
   if e.reason == "quit" then
      for i, v in pairs(del_list) do
         print("deleting: "..v)
         os.remove(v)
      end
   end
end

mp.add_key_binding("ctrl+DEL", "delete_file", mark_delete)
mp.register_event("end-file", delete)
</pre>
</div></li>
</ul>
</div>
</div>

<div id="outline-container-orge4f310a" class="outline-3">
<h3 id="orge4f310a">unison</h3>
<div class="outline-text-3" id="text-orge4f310a">
<ul class="org-ul">
<li><p>
music directory syncing
</p>
<div class="org-src-container">
<pre class="src src-conf"><span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Roots of the synchronization</span>
<span style="font-weight: bold; font-style: italic;">root</span> = &lt;&lt;home-dir()&gt;&gt;/mnt/ruizu/Music
<span style="font-weight: bold; font-style: italic;">root</span> = &lt;&lt;home-dir()&gt;&gt;/Audio

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Paths to synchronize</span>
<span style="font-weight: bold; font-style: italic;">path</span> = .

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Ruizu's file system is FAT</span>
<span style="font-weight: bold; font-style: italic;">fat</span> = true

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Overwrite by newer file on confliction</span>
<span style="font-weight: bold; font-style: italic;">prefer</span> = newer

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Show nothing</span>
<span style="font-weight: bold; font-style: italic;">silent</span> = true
<span style="font-weight: bold; font-style: italic;">confirmbigdel</span> = false

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Do fast checking</span>
<span style="font-weight: bold; font-style: italic;">fastcheck</span> = true

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Log settings</span>
<span style="font-weight: bold; font-style: italic;">log</span> = true
<span style="font-weight: bold; font-style: italic;">logfile</span> = &lt;&lt;home-dir()&gt;&gt;/.local/state/log/log/unison/music.log

</pre>
</div></li>
<li><p>
doc directory backup
</p>
<div class="org-src-container">
<pre class="src src-conf"><span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Roots of the synchronization</span>
<span style="font-weight: bold; font-style: italic;">root</span> = &lt;&lt;home-dir()&gt;&gt;/mnt/ns01
<span style="font-weight: bold; font-style: italic;">root</span> = &lt;&lt;home-dir()&gt;&gt;

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Paths to synchronize</span>
<span style="font-weight: bold; font-style: italic;">path</span> = doc

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Overwrite by newer file on confliction</span>
<span style="font-weight: bold; font-style: italic;">prefer</span> = newer

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Use this command for displaying diffs</span>
<span style="font-weight: bold; font-style: italic;">diff</span> = diff -y -W 79 --suppress-common-lines

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Write down synchronization activity on log file rather than show in stdout</span>
<span style="font-weight: bold; font-style: italic;">auto</span> = true
<span style="font-weight: bold; font-style: italic;">confirmbigdel</span> = false
<span style="font-weight: bold; font-style: italic;">silent</span> = true
<span style="font-weight: bold; font-style: italic;">log</span> = true
<span style="font-weight: bold; font-style: italic;">logfile</span> = &lt;&lt;home-dir()&gt;&gt;/.local/state/log/unison/doc.log

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Use inode number to verify identity rather than ckeck whole byte sequence</span>
<span style="font-weight: bold; font-style: italic;">fastcheck</span> = true

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Abort if device is not mounted</span>
<span style="font-weight: bold; font-style: italic;">mountpoint</span> = doc
</pre>
</div></li>
</ul>
</div>
</div>
<div id="outline-container-org846131c" class="outline-3">
<h3 id="org846131c">Aspell</h3>
<div class="outline-text-3" id="text-org846131c">
<p>
aspell - interactive spell checker
</p>
<div class="org-src-container">
<pre class="src src-conf">lang en_US
</pre>
</div>
</div>
</div>
<div id="outline-container-org4392d7f" class="outline-3">
<h3 id="org4392d7f">textlint</h3>
<div class="outline-text-3" id="text-org4392d7f">
<div class="org-src-container">
<pre class="src src-conf">install-textlint
</pre>
</div>

<div class="org-src-container">
<pre class="src src-shell">textlint @textlint/ast-node-types textlint-rule-preset-ja-spacing textlint-rule-preset-ja-technical-writing textlint-rule-spellcheck-tech-word textlint-rule-ginger textlint-rule-write-good textlint-rule-prh textlint-filter-rule-node-types textlint-plugin-org traverse
</pre>
</div>

<ul class="org-ul">
<li><p>
config for English
</p>
<div class="org-src-container">
<pre class="src src-json">{
  "rules": {
    "ginger": true,
    "write-good": true,
  }
}
</pre>
</div></li>

<li><p>
config for Japanese
</p>
<div class="org-src-container">
<pre class="src src-json">{
  "rules": {
    "preset-ja-technical-writing": {
      "no-exclamation-question-mark": false,
      "sentence-length": {
        "max": 200
      }
    },
    "spellcheck-tech-word": true,
    "textlint-rule-ginger": {
      "skipPatterns": [
        "`(.*)`"
      ]
    },
    "textlint-rule-write-good": true,
    "preset-ja-spacing": true
  }
}
</pre>
</div></li>
</ul>
</div>
</div>

<div id="outline-container-orga908b8c" class="outline-3">
<h3 id="orga908b8c">xkeysnail</h3>
<div class="outline-text-3" id="text-orga908b8c">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"xkeysnail"</span>
</pre>
</div>

<ul class="org-ul">
<li><p>
config.py
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">-*- coding: utf-8 -*-</span>

<span style="font-weight: bold;">import</span> re
<span style="font-weight: bold;">from</span> xkeysnail.transform <span style="font-weight: bold;">import</span> *

define_multipurpose_modmap({
    <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">SandS</span>
    Key.SPACE: [Key.SPACE, Key.LEFT_SHIFT],

    <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Enter is enter when pressed and released. Control when held down.</span>
    Key.ENTER: [Key.ENTER, Key.RIGHT_CTRL],

    Key.LEFT_SHIFT: [Key.EQUAL, Key.LEFT_SHIFT],
    Key.RIGHT_SHIFT: [Key.MINUS, Key.RIGHT_SHIFT],
})

define_modmap({
    Key.LEFT_CTRL: Key.CAPSLOCK,
    Key.CAPSLOCK: Key.LEFT_CTRL,
    Key.SYSRQ: Key.RIGHT_META,
})

define_keymap(<span style="font-weight: bold; text-decoration: underline;">None</span>, {
    K(<span style="font-style: italic;">"C-Shift-a"</span>): K(<span style="font-style: italic;">"KEY_1"</span>),
    K(<span style="font-style: italic;">"C-Shift-s"</span>): K(<span style="font-style: italic;">"KEY_2"</span>),
    K(<span style="font-style: italic;">"C-Shift-d"</span>): K(<span style="font-style: italic;">"KEY_3"</span>),
    K(<span style="font-style: italic;">"C-Shift-f"</span>): K(<span style="font-style: italic;">"KEY_4"</span>),
    K(<span style="font-style: italic;">"C-Shift-g"</span>): K(<span style="font-style: italic;">"KEY_5"</span>),
    K(<span style="font-style: italic;">"C-Shift-h"</span>): K(<span style="font-style: italic;">"KEY_6"</span>),
    K(<span style="font-style: italic;">"C-Shift-j"</span>): K(<span style="font-style: italic;">"KEY_7"</span>),
    K(<span style="font-style: italic;">"C-Shift-k"</span>): K(<span style="font-style: italic;">"KEY_8"</span>),
    K(<span style="font-style: italic;">"C-Shift-l"</span>): K(<span style="font-style: italic;">"KEY_9"</span>),
    K(<span style="font-style: italic;">"C-Shift-semicolon"</span>): K(<span style="font-style: italic;">"KEY_0"</span>),
})


<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;"># [Conditional modmap] Change modifier keys in certain applications</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">define_conditional_modmap(re.compile(r'Emacs'), {</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;">Key.RIGHT_CTRL: Key.ESC,</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">})</span>

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;"># [Multipurpose modmap] Give a key two meanings. A normal key when pressed and</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;"># released, and a modifier key when held down with another key. See Xcape,</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;"># Carabiner and caps2esc for ideas and concept.</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">define_multipurpose_modmap(</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;"># Enter is enter when pressed and released. Control when held down.</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;">{Key.ENTER: [Key.ENTER, Key.RIGHT_CTRL]}</span>

<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;"># Capslock is escape when pressed and released. Control when held down.</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;"># {Key.CAPSLOCK: [Key.ESC, Key.LEFT_CTRL]</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;"># To use this example, you can't remap capslock with define_modmap.</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">)</span>


<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;"># Keybindings for Firefox/Chrome</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">define_keymap(re.compile("Firefox|Google-chrome"), {</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;"># Ctrl+Alt+j/k to switch next/previous tab</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;">K("C-M-j"): K("C-TAB"),</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;">K("C-M-k"): K("C-Shift-TAB"),</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;"># Type C-j to focus to the content</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;">K("C-j"): K("C-f6"),</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;"># very naive "Edit in editor" feature (just an example)</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;">K("C-o"): [K("C-a"), K("C-c"), launch(["gedit"]), sleep(0.5), K("C-v")]</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">}, "Firefox and Chrome")</span>

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;"># Keybindings for Zeal https://github.com/zealdocs/zeal/</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">define_keymap(re.compile("Zeal"), {</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;"># Ctrl+s to focus search area</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;">K("C-s"): K("C-k"),</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">}, "Zeal")</span>

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;"># Emacs-like keybindings in non-Emacs applications</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">define_keymap(lambda wm_class: wm_class not in ("Emacs", "URxvt"), {</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;"># Cursor</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;">K("C-b"): with_mark(K("left")),</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;">K("C-f"): with_mark(K("right")),</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;">K("C-p"): with_mark(K("up")),</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;">K("C-n"): with_mark(K("down")),</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;">K("C-h"): with_mark(K("backspace")),</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;"># Forward/Backward word</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;">K("M-b"): with_mark(K("C-left")),</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;">K("M-f"): with_mark(K("C-right")),</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;"># Beginning/End of line</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;">K("C-a"): with_mark(K("home")),</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;">K("C-e"): with_mark(K("end")),</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;"># Page up/down</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;">K("M-v"): with_mark(K("page_up")),</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;">K("C-v"): with_mark(K("page_down")),</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;"># Beginning/End of file</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;">K("M-Shift-comma"): with_mark(K("C-home")),</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;">K("M-Shift-dot"): with_mark(K("C-end")),</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;"># Newline</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;">K("C-m"): K("enter"),</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;">K("C-j"): K("enter"),</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;">K("C-o"): [K("enter"), K("left")],</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;"># Copy</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;">K("C-w"): [K("C-x"), set_mark(False)],</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;">K("M-w"): [K("C-c"), set_mark(False)],</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;">K("C-y"): [K("C-v"), set_mark(False)],</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;"># Delete</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;">K("C-d"): [K("delete"), set_mark(False)],</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;">K("M-d"): [K("C-delete"), set_mark(False)],</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;"># Kill line</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;">K("C-k"): [K("Shift-end"), K("C-x"), set_mark(False)],</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;"># Undo</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;">K("C-slash"): [K("C-z"), set_mark(False)],</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;">K("C-Shift-ro"): K("C-z"),</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;"># Mark</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;">K("C-space"): set_mark(True),</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;">K("C-M-space"): with_or_set_mark(K("C-right")),</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;"># Search</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;">K("C-s"): K("F3"),</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;">K("C-r"): K("Shift-F3"),</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;">K("M-Shift-key_5"): K("C-h"),</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;"># Cancel</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;">K("C-g"): [K("esc"), set_mark(False)],</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;"># Escape</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;">K("C-q"): escape_next_key,</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;"># C-x YYY</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;">K("C-x"): {</span>
<span style="font-weight: bold; font-style: italic;">#         </span><span style="font-weight: bold; font-style: italic;"># C-x h (select all)</span>
<span style="font-weight: bold; font-style: italic;">#         </span><span style="font-weight: bold; font-style: italic;">K("h"): [K("C-home"), K("C-a"), set_mark(True)],</span>
<span style="font-weight: bold; font-style: italic;">#         </span><span style="font-weight: bold; font-style: italic;"># C-x C-f (open)</span>
<span style="font-weight: bold; font-style: italic;">#         </span><span style="font-weight: bold; font-style: italic;">K("C-f"): K("C-o"),</span>
<span style="font-weight: bold; font-style: italic;">#         </span><span style="font-weight: bold; font-style: italic;"># C-x C-s (save)</span>
<span style="font-weight: bold; font-style: italic;">#         </span><span style="font-weight: bold; font-style: italic;">K("C-s"): K("C-s"),</span>
<span style="font-weight: bold; font-style: italic;">#         </span><span style="font-weight: bold; font-style: italic;"># C-x k (kill tab)</span>
<span style="font-weight: bold; font-style: italic;">#         </span><span style="font-weight: bold; font-style: italic;">K("k"): K("C-f4"),</span>
<span style="font-weight: bold; font-style: italic;">#         </span><span style="font-weight: bold; font-style: italic;"># C-x C-c (exit)</span>
<span style="font-weight: bold; font-style: italic;">#         </span><span style="font-weight: bold; font-style: italic;">K("C-c"): K("C-q"),</span>
<span style="font-weight: bold; font-style: italic;">#         </span><span style="font-weight: bold; font-style: italic;"># cancel</span>
<span style="font-weight: bold; font-style: italic;">#         </span><span style="font-weight: bold; font-style: italic;">K("C-g"): pass_through_key,</span>
<span style="font-weight: bold; font-style: italic;">#         </span><span style="font-weight: bold; font-style: italic;"># C-x u (undo)</span>
<span style="font-weight: bold; font-style: italic;">#         </span><span style="font-weight: bold; font-style: italic;">K("u"): [K("C-z"), set_mark(False)],</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;">}</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">}, "Emacs-like keys")</span>
</pre>
</div></li>
<li><p>
xkeysnail.service
</p>

<div class="org-src-container">
<pre class="src src-conf">systemctl --user enable xkeysnail
systemctl --user start xkeysnail
</pre>
</div>

<div class="org-src-container">
<pre class="src src-conf">[<span style="font-weight: bold; text-decoration: underline;">Unit</span>]
<span style="font-weight: bold; font-style: italic;">Description</span>=xkeysnail

[<span style="font-weight: bold; text-decoration: underline;">Service</span>]
<span style="font-weight: bold; font-style: italic;">KillMode</span>=process
<span style="font-weight: bold; font-style: italic;">ExecStart</span>=/bin/bash -ic <span style="font-style: italic;">'pwsudo xkeysnail --watch --quiet %h/.config/xkeysnail/config.py'</span>
<span style="font-weight: bold; font-style: italic;">Type</span>=simple
<span style="font-weight: bold; font-style: italic;">Restart</span>=always
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Update DISPLAY to be the same as `echo $DISPLAY` on your graphical terminal.</span>
<span style="font-weight: bold; font-style: italic;">Environment</span>=DISPLAY=:0

[<span style="font-weight: bold; text-decoration: underline;">Install</span>]
<span style="font-weight: bold; font-style: italic;">WantedBy</span>=default.target
</pre>
</div></li>
</ul>
</div>
</div>

<div id="outline-container-orgce9fa84" class="outline-3">
<h3 id="orgce9fa84">SKK</h3>
<div class="outline-text-3" id="text-orgce9fa84">
<p>
SKK is Simple Kana to Kanji conversion program, an input method of Japanese.
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"skk-jisyo"</span>
<span style="font-style: italic;">"skktools"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-bash" id="orgf713a9a">. ${<span style="font-weight: bold; font-style: italic;">HOME</span>}/.bashrc

<span style="font-weight: bold;">echo</span> <span style="font-style: italic;">"${GUIX_EXTRA_PROFILES}/base/base/share/skk/"</span>
</pre>
</div>

<ul class="org-ul">
<li>TODO: following programs have no guix package.
It is better to write my own one for my reproducible system.
<ul class="org-ul">
<li class="on"><code>[X]</code> <a href="https://github.com/skk-dev/skktools">skktools</a></li>
<li class="off"><code>[&#xa0;]</code> ibus-skk</li>
</ul></li>
</ul>
</div>

<div id="outline-container-org25b02f9" class="outline-4">
<h4 id="org25b02f9">derive unique entries in user-jisyo</h4>
<div class="outline-text-4" id="text-org25b02f9">
<div class="org-src-container">
<pre class="src src-shell">skkdic_uniq.sh
</pre>
</div>

<div class="org-src-container">
<pre class="src src-bash"><span style="font-weight: bold; font-style: italic;">tmp_euc</span>=$(mktemp)
<span style="font-weight: bold; font-style: italic;">tmp_utf8</span>=$(mktemp)
<span style="font-weight: bold; font-style: italic;">skk_dir</span>=<span style="font-style: italic;">"&lt;&lt;share-dir()&gt;&gt;"</span>/skk
<span style="font-weight: bold; font-style: italic;">skk_get_dir</span>=${<span style="font-weight: bold; font-style: italic;">skk_dir</span>}/get-jisyo
<span style="font-weight: bold; font-style: italic;">dic_orig</span>=$<span style="font-weight: bold; font-style: italic;">XDG_CONFIG_HOME</span>/emacs/var/ddskk/jisyo.txt
<span style="font-weight: bold; font-style: italic;">dic_uniq</span>=${<span style="font-weight: bold; font-style: italic;">skk_dir</span>}/jisyo.uniq

skkdic-expr2 ${<span style="font-weight: bold; font-style: italic;">skk_get_dir</span>}/SKK-JISYO.* &gt; ${<span style="font-weight: bold; font-style: italic;">tmp_euc</span>}
nkf -w -Lu ${<span style="font-weight: bold; font-style: italic;">tmp_euc</span>} &gt; ${<span style="font-weight: bold; font-style: italic;">tmp_utf8</span>}
skkdic-expr2 ${<span style="font-weight: bold; font-style: italic;">dic_orig</span>} - ${<span style="font-weight: bold; font-style: italic;">tmp_utf8</span>} &gt; ${<span style="font-weight: bold; font-style: italic;">dic_uniq</span>}

rm -f ${<span style="font-weight: bold; font-style: italic;">tmp_euc</span>}
rm -f ${<span style="font-weight: bold; font-style: italic;">tmp_utf8</span>}

<span style="font-weight: bold;">echo</span> ${<span style="font-weight: bold; font-style: italic;">dic_uniq</span>}
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orgeff24b7" class="outline-3">
<h3 id="orgeff24b7">Festival</h3>
<div class="outline-text-3" id="text-orgeff24b7">
<p>
<a href="http://festvox.org/festival/">Festival</a> is a framework for building and manipulating speech synthesis engine.
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"festival"</span>
</pre>
</div>

<ul class="org-ul">
<li><p>
configuration
</p>
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">-*- mode:scheme; -*-</span>
(Parameter.set 'Audio_Required_Format 'aiff)
(Parameter.set 'Audio_Method 'Audio_Command)
(Parameter.set 'Audio_Command <span style="font-style: italic;">"paplay $FILE --client-name=Festival --stream-name=Speech"</span>)

<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">add SLT voice and use it as a default one</span>
(voice-location 'cmu_us_slt_cg
                (path-as-directory <span style="font-style: italic;">"&lt;&lt;home-dir()&gt;&gt;/.local/share/festival/lib/voices/us/cmu_us_slt_cg"</span>)
                <span style="font-style: italic;">"English American Female"</span>)
(set! voice_default voice_cmu_us_slt_cg)
</pre>
</div></li>
<li><p>
a script to download voices
</p>

<div class="org-src-container">
<pre class="src src-conf">download-festival-voices
</pre>
</div>

<div class="org-src-container">
<pre class="src src-bash"><span style="font-weight: bold; font-style: italic;">work_dir</span>=~/.local/share/festival
<span style="font-weight: bold; font-style: italic;">voices</span>=(
  cmu_us_aew_cg
  cmu_us_rxr_cg
  cmu_us_slt_cg
)

<span style="font-weight: bold;">if</span> [ ! -d <span style="font-style: italic;">"${work_dir}"</span> ]; <span style="font-weight: bold;">then</span>
  mkdir -p <span style="font-style: italic;">"${work_dir}"</span>
<span style="font-weight: bold;">fi</span>

<span style="font-weight: bold;">cd</span> <span style="font-style: italic;">"${work_dir}"</span>
<span style="font-weight: bold;">for</span> voice<span style="font-weight: bold;"> in</span> <span style="font-style: italic;">"${voices[@]}"</span>; <span style="font-weight: bold;">do</span>
  <span style="font-weight: bold; font-style: italic;">voice_pack_file</span>=festvox_${<span style="font-weight: bold; font-style: italic;">voice</span>}.tar.gz
  <span style="font-weight: bold;">if</span> [ ! -e ${<span style="font-weight: bold; font-style: italic;">voice_pack_file</span>} ]; <span style="font-weight: bold;">then</span>
    wget -c http://festvox.org/packed/festival/2.5/voices/${<span style="font-weight: bold; font-style: italic;">voice_pack_file</span>}
    tar zxf <span style="font-style: italic;">"${voice_pack_file}"</span> -C ../../share
  <span style="font-weight: bold;">fi</span>
<span style="font-weight: bold;">done</span>

<span style="font-weight: bold;">echo</span> <span style="font-style: italic;">"${work_dir}"</span>
</pre>
</div></li>
<li><p>
festival.el
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package festival
  <span style="font-weight: bold;">:defer</span> t
  <span style="font-weight: bold;">:config</span>
  (say-minor-mode 1)
  (<span style="font-weight: bold;">setq</span> festival-tmp-file (make-temp-file <span style="font-style: italic;">"festival-"</span>)))
</pre>
</div></li>
</ul>
</div>
</div>

<div id="outline-container-org83682cf" class="outline-3">
<h3 id="org83682cf">Open JTalk</h3>
<div class="outline-text-3" id="text-org83682cf">
<div class="org-src-container">
<pre class="src src-emacs-lisp" id="org7b8b690">(expand-file-name <span style="font-style: italic;">"~/.local/share/hts-voice"</span>)
</pre>
</div>

<ul class="org-ul">
<li><p>
install on Ubuntu
</p>
<div class="org-src-container">
<pre class="src src-shell">open-jtalk open-jtalk-mecab-naist-jdic hts-voice-nitech-jp-atr503-m001
</pre>
</div></li>
<li><p>
download hts voices
</p>

<div class="org-src-container">
<pre class="src src-conf">download-hts-voices
</pre>
</div>

<div class="org-src-container">
<pre class="src src-bash"><span style="font-weight: bold; font-style: italic;">data_dir</span>=&lt;&lt;hts-voice-dir()&gt;&gt;
<span style="font-weight: bold;">hts_workdir=/tmp</span>
<span style="font-weight: bold;">hts_fname=MMDAgent_Example-1.8.zip</span>

<span style="font-weight: bold;">if [ ! -d "${data_dir}" ]; then</span>
<span style="font-weight: bold;">  mkdir -p "${data_dir}"</span>
<span style="font-weight: bold;">fi</span>

<span style="font-weight: bold;">cd "${hts_workdir}" \</span>
<span style="font-weight: bold;">  &amp;&amp; curl -sLO http://sourceforge.net/projects/mmdagent/files/MMDAgent_Example/${hts_fname%.zip}/${hts_fname} \</span>
<span style="font-weight: bold;">  &amp;&amp; unzip -o -d ${data_dir} ${hts_fname} \</span>
<span style="font-weight: bold;">  &amp;&amp; ln -sfv ${data_dir}/${hts_fname%.zip}/Voice ${data_dir}/</span>
</pre>
</div></li>
</ul>
</div>
</div>

<div id="outline-container-orga60e211" class="outline-3">
<h3 id="orga60e211">Jack</h3>
<div class="outline-text-3" id="text-orga60e211">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"qjackctl"</span>
<span style="font-style: italic;">"qsynth"</span>
<span style="font-style: italic;">"jack-keyboard"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-conf">/usr/bin/jackd -dalsa -dhw:0 -r44100 -p1024 -n3 -Xseq
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf4de07d" class="outline-3">
<h3 id="orgf4de07d">XRandR</h3>
<div class="outline-text-3" id="text-orgf4de07d">
<p>
XRandR is a command line utility for changing display options without restarting X server.
</p>

<p>
<a href="https://wiki.archlinux.org/title/xrandr">xrandr - ArchWiki</a>
</p>

<ul class="org-ul">
<li><p>
show avaulable modes for all displays
</p>
<div class="org-src-container">
<pre class="src src-shell">xrandr
</pre>
</div></li>

<li><p>
change mode (resolution) to 1920x1080 for a display identified as "HDMI-2"
</p>
<div class="org-src-container">
<pre class="src src-shell">xrandr --output HDMI-2 --mode 1920x1080
</pre>
</div></li>

<li><p>
change mode back to preferred (maximum)
</p>
<div class="org-src-container">
<pre class="src src-shell">xrandr --output HDMI-2 --auto
</pre>
</div></li>
</ul>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"xrandr"</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-orgcc8b9b0" class="outline-3">
<h3 id="orgcc8b9b0">C/Migemo</h3>
<div class="outline-text-3" id="text-orgcc8b9b0">
<p>
<a href="https://github.com/koron/cmigemo">C/Migemo</a> allows us to search Japanese with incremental ASCII charactor input.
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"cmigemo"</span>
<span style="font-style: italic;">"migemo-dict-azik"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-style: italic;">"https://github.com/koron/cmigemo/releases.atom"</span> soft_update)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-shell" id="orgd7e68ae">source ~/.bashrc

<span style="font-weight: bold;">echo</span> <span style="font-style: italic;">"${GUIX_EXTRA_PROFILES}/emacs/emacs/share/migemo/"</span>
</pre>
</div>
</div>

<div id="outline-container-orgc43dca1" class="outline-4">
<h4 id="orgc43dca1">C/Migemo in apt&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span></h4>
</div>

<div id="outline-container-orgdde1e9a" class="outline-4">
<h4 id="orgdde1e9a">AZIK-compliant C/Migemo&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span></h4>
</div>
</div>

<div id="outline-container-org6431b00" class="outline-3">
<h3 id="org6431b00">LilyPond</h3>
<div class="outline-text-3" id="text-org6431b00">
<p>
<a href="https://lilypond.org/unix.html">LilyPond</a> elisp package is included in source tarball available at <a href="https://lilypond.org/download/source">here</a>,
you are required to locate that package where emacs can search.
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"lilypond"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package lilypond-mode
  <span style="font-weight: bold;">:delight</span> (LilyPond-mode <span style="font-style: italic;">" LP"</span>)
  <span style="font-weight: bold;">:mode</span> (<span style="font-style: italic;">"\\.ly$"</span> . LilyPond-mode)
  <span style="font-weight: bold;">:custom</span>
  (LilyPond-pdf-command <span style="font-style: italic;">"firefox"</span>)
  (LilyPond-midi-command <span style="font-style: italic;">"fluidsynth -a alsa -m alsa_seq -l"</span>))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgdf368b6" class="outline-3">
<h3 id="orgdf368b6">Graphviz</h3>
<div class="outline-text-3" id="text-orgdf368b6">
<p>
Documentation is available at <a href="https://graphviz.org/documentation/">here</a> and <a href="https://graphviz.org/gallery/">gallery</a> is also useful.
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"graphviz"</span>
<span style="font-style: italic;">"emacs-graphviz-dot-mode"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package graphviz-dot-mode
  <span style="font-weight: bold;">:after</span> eglot
  <span style="font-weight: bold;">:custom</span>
  (graphviz-dot-indent-width 2)
  <span style="font-weight: bold;">:config</span>
  (add-to-list 'eglot-server-programs
               '(graphviz-dot-mode <span style="font-style: italic;">"dot-language-server"</span> <span style="font-style: italic;">"--stdio"</span>)))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-shell">dot-language-server
</pre>
</div>
</div>
</div>

<div id="outline-container-org3926de8" class="outline-3">
<h3 id="org3926de8">Rsync</h3>
<div class="outline-text-3" id="text-org3926de8">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"rsync"</span>
</pre>
</div>
</div>

<div id="outline-container-org454202b" class="outline-4">
<h4 id="org454202b">sync server data&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span></h4>
</div>

<div id="outline-container-org6b4c099" class="outline-4">
<h4 id="org6b4c099">backup script&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span></h4>
</div>
</div>
<div id="outline-container-orgd0cbea4" class="outline-3">
<h3 id="orgd0cbea4">libvirt</h3>
<div class="outline-text-3" id="text-orgd0cbea4">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"libvirt"</span>
<span style="font-style: italic;">"virt-manager"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-shell">qemu-kvm libvirt-clients libvirt-daemon libvirt-daemon-system virtinst virt-manager virt-top bridge-utils
</pre>
</div>

<div class="org-src-container">
<pre class="src src-conf">systemctl enable libvirtd
systemctl start libvirtd
</pre>
</div>

<div class="org-src-container">
<pre class="src src-conf"><span style="font-weight: bold; font-style: italic;">uri_default</span> = <span style="font-style: italic;">"qemu:///system"</span>
</pre>
</div>

<ul class="org-ul">
<li><p>
how to set up local storage pool (named 'local')
</p>
<pre class="example">
$ virsh pool-define ~/.config/libvirt/pool.xml
$ virsh pool-autostart local
$ virsh pool-start local
</pre>


<div class="org-src-container">
<pre class="src src-xml">&lt;<span style="font-weight: bold;">pool</span> <span style="font-weight: bold; font-style: italic;">type</span>=<span style="font-style: italic;">'dir'</span>&gt;
  &lt;<span style="font-weight: bold;">name</span>&gt;local&lt;/<span style="font-weight: bold;">name</span>&gt;
  &lt;<span style="font-weight: bold;">source</span>&gt;
  &lt;/<span style="font-weight: bold;">source</span>&gt;
  &lt;<span style="font-weight: bold;">target</span>&gt;
    &lt;<span style="font-weight: bold;">path</span>&gt;&lt;&lt;<span style="font-weight: bold;">share-dir</span>()&gt;&gt;/libvirt/images&lt;/<span style="font-weight: bold;">path</span>&gt;
    &lt;<span style="font-weight: bold;">permissions</span>&gt;
      &lt;<span style="font-weight: bold;">mode</span>&gt;0711&lt;/<span style="font-weight: bold;">mode</span>&gt;
      &lt;<span style="font-weight: bold;">owner</span>&gt;0&lt;/<span style="font-weight: bold;">owner</span>&gt;
      &lt;<span style="font-weight: bold;">group</span>&gt;0&lt;/<span style="font-weight: bold;">group</span>&gt;
    &lt;/<span style="font-weight: bold;">permissions</span>&gt;
  &lt;/<span style="font-weight: bold;">target</span>&gt;
&lt;/<span style="font-weight: bold;">pool</span>&gt;
</pre>
</div></li>
</ul>
</div>
</div>

<div id="outline-container-orgc9f4e82" class="outline-3">
<h3 id="orgc9f4e82">Calibre</h3>
<div class="outline-text-3" id="text-orgc9f4e82">
<p>
<a href="https://calibre-ebook.com/download_linux">Calibre for linux</a> is a e-book reader. I use it in the mood of reading epub in GUI app.
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"calibre"</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org3322ec7" class="outline-3">
<h3 id="org3322ec7">yt-dlp</h3>
<div class="outline-text-3" id="text-org3322ec7">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"yt-dlp"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-conf">-o %(title)s.%(ext)s
--trim-filenames 72
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc0c754a" class="outline-3">
<h3 id="orgc0c754a">rTorrent</h3>
<div class="outline-text-3" id="text-orgc0c754a">
<p>
<a href="https://github.com/rakshasa/rtorrent/wiki">rTorrent</a> is a bittorrent client using ncurses.
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"rtorrent-xmlrpc"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-shell">rtorrent
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp" id="org818a77f">(expand-file-name <span style="font-style: italic;">"~/.local/share/rtorrent-rpc.socket"</span>)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-conf"><span style="font-weight: bold; font-style: italic;">network.scgi.open_local</span> = &lt;&lt;rtorrent-sock()&gt;&gt;
<span style="font-weight: bold; font-style: italic;">execute.nothrow</span> = chmod,770,&lt;&lt;rtorrent-sock()&gt;&gt;
<span style="font-weight: bold; font-style: italic;">encoding.add</span> = utf8
</pre>
</div>

<div class="org-src-container">
<pre class="src src-conf">systemctl --user enable rtorrent.service
systemctl --user start rtorrent.service
</pre>
</div>

<div class="org-src-container">
<pre class="src src-shell" id="orgb4e2546">realpath <span style="font-style: italic;">"&lt;&lt;share-dir()&gt;&gt;/torrent"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-conf">[<span style="font-weight: bold; text-decoration: underline;">Unit</span>]
<span style="font-weight: bold; font-style: italic;">Description</span>=rTorrent
<span style="font-weight: bold; font-style: italic;">After</span>=network.target

[<span style="font-weight: bold; text-decoration: underline;">Service</span>]
<span style="font-weight: bold; font-style: italic;">Type</span>=simple
<span style="font-weight: bold; font-style: italic;">WorkingDirectory</span>=&lt;&lt;torrent-dir()&gt;&gt;
<span style="font-weight: bold; font-style: italic;">ExecStart</span>=&lt;&lt;which(filename=<span style="font-style: italic;">"rtorrent"</span>)&gt;&gt; -o system.daemon.set=true
<span style="font-weight: bold; font-style: italic;">Restart</span>=on-failure
<span style="font-weight: bold; font-style: italic;">RestartSec</span>=3

[<span style="font-weight: bold; text-decoration: underline;">Install</span>]
<span style="font-weight: bold; font-style: italic;">WantedBy</span>=default.target
</pre>
</div>
</div>
</div>

<div id="outline-container-org72df392" class="outline-3">
<h3 id="org72df392">Ledger</h3>
<div class="outline-text-3" id="text-org72df392">
<p>
<a href="https://www.ledger-cli.org/3.0/doc/ledger-mode.html">Ledger</a> is double-entry accounting cli tool. <a href="https://hledger.org/">hledger</a> is feature rich reimplementation of ledger in Haskell. User data in ledger is interoperable for hledger and vice versa.
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"ledger"</span>
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">"hledger"</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org1b58fb8" class="outline-3">
<h3 id="org1b58fb8">ripgrep-all</h3>
<div class="outline-text-3" id="text-org1b58fb8">
<p>
<a href="https://github.com/phiresky/ripgrep-all">ripgrep-all</a> or rga command enables to search media files such as pdf documents or epub files in grep-like way.
</p>

<div class="org-src-container">
<pre class="src src-shell"><span style="font-weight: bold; font-style: italic;">rga_url</span>=https://github.com/phiresky/ripgrep-all/releases/download/v0.9.6
<span style="font-weight: bold; font-style: italic;">rga_fname</span>=ripgrep_all-v0.9.6-x86_64-unknown-linux-musl.tar.gz
<span style="font-weight: bold; font-style: italic;">rga_workdir</span>=/tmp
<span style="font-weight: bold; font-style: italic;">rga_lbinpath</span>=&lt;&lt;home-dir()&gt;&gt;/.local/bin

<span style="font-weight: bold;">curl -sL "${rga_url}/${rga_fname}" | tar zxf - -C ${rga_workdir} \</span>
<span style="font-weight: bold;">  &amp;&amp; cp -fv ${rga_workdir}/${rga_fname%.tar.gz}/{rga,rga-preproc} ${rga_lbinpath}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb11f6fc" class="outline-3">
<h3 id="orgb11f6fc">Recoll</h3>
<div class="outline-text-3" id="text-orgb11f6fc">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"recoll"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-shell">recollcmd
</pre>
</div>

<div class="org-src-container">
<pre class="src src-conf"><span style="font-weight: bold; font-style: italic;">topdirs</span> = &lt;&lt;doc-dir()&gt;&gt; ~/data

[<span style="font-weight: bold; text-decoration: underline;">&lt;&lt;doc-dir()&gt;&gt;</span>]
<span style="font-weight: bold; font-style: italic;">followLinks</span> = 1

<span style="font-weight: bold; font-style: italic;">skippedNames</span> = .git

<span style="font-weight: bold; font-style: italic;">skippedPaths</span> = &lt;&lt;share-dir()&gt;&gt;/emacs/open-file &lt;&lt;share-dir()&gt;&gt;/emacs/org-subtree-view

<span style="font-weight: bold; font-style: italic;">indexstemminglanguages</span> = english
</pre>
</div>
</div>

<div id="outline-container-org98f3371" class="outline-4">
<h4 id="org98f3371">systemd setting</h4>
<div class="outline-text-4" id="text-org98f3371">
<div class="org-src-container">
<pre class="src src-conf">systemctl --user enable recollindex.service
</pre>
</div>

<div class="org-src-container">
<pre class="src src-conf"><span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Contributed by Frank Dana, licensed as Recoll itself</span>
[<span style="font-weight: bold; text-decoration: underline;">Unit</span>]
<span style="font-weight: bold; font-style: italic;">Description</span>=Recoll real-time document indexing
<span style="font-weight: bold; font-style: italic;">After</span>=gnome-session-manager.target

[<span style="font-weight: bold; text-decoration: underline;">Service</span>]
<span style="font-weight: bold; font-style: italic;">Type</span>=simple
<span style="font-weight: bold; font-style: italic;">ExecStart</span>=&lt;&lt;which(filename=<span style="font-style: italic;">"recollindex"</span>)&gt;&gt; -m -D -x -w 30 -c %h/.recoll/
<span style="font-weight: bold; font-style: italic;">Restart</span>=on-failure

[<span style="font-weight: bold; text-decoration: underline;">Install</span>]
<span style="font-weight: bold; font-style: italic;">WantedBy</span>=graphical-session.target
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org5e91351" class="outline-3">
<h3 id="org5e91351">Enchant</h3>
<div class="outline-text-3" id="text-org5e91351">
<p>
<a href="https://abiword.github.io/enchant/src/enchant.html">ENCHANT</a> offers efficient spell checking mechanism by using checker in order.
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"enchant"</span>
<span style="font-style: italic;">"hunspell"</span>
<span style="font-style: italic;">"hunspell-dict-en"</span>
<span style="font-style: italic;">"hunspell-dict-en-us"</span>
<span style="font-style: italic;">"nuspell"</span>
<span style="font-style: italic;">"aspell"</span>
<span style="font-style: italic;">"aspell-dict-en"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-shell"><span style="font-weight: bold;">export</span> <span style="font-weight: bold; font-style: italic;">ENCHANT_CONFIG_DIR</span>=&lt;&lt;home-dir()&gt;&gt;/.config/enchant
</pre>
</div>

<div class="org-src-container">
<pre class="src src-conf">*:hunspell,nuspell,aspell
en:hunspell,nuspell,aspell
en_US:hunspell,nuspell,aspell
</pre>
</div>

<div class="org-src-container">
<pre class="src src-text">TempEL
</pre>
</div>
</div>
</div>

<div id="outline-container-org7ba85ac" class="outline-3">
<h3 id="org7ba85ac">Modern alternative command line tools</h3>
<div class="outline-text-3" id="text-org7ba85ac">
<p>
They are mostly written in Rust. <a href="https://github.com/mhoye/moderntools/">moderntools</a> offers updated info for this category.
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"bat"</span>
<span style="font-style: italic;">"du-dust"</span>
<span style="font-style: italic;">"eza"</span>
<span style="font-style: italic;">"fd"</span>
<span style="font-style: italic;">"zoxide"</span>
<span style="font-style: italic;">"just"</span>
<span style="font-style: italic;">"tmux"</span>
<span style="font-style: italic;">"moreutils"</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org0664fee" class="outline-2">
<h2 id="org0664fee">Development Infrastructures</h2>
<div class="outline-text-2" id="text-org0664fee">
</div>

<div id="outline-container-org0942a03" class="outline-3">
<h3 id="org0942a03">Python</h3>
<div class="outline-text-3" id="text-org0942a03">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"python"</span>
<span style="font-style: italic;">"python-pip"</span>
<span style="font-style: italic;">"python-sphinx"</span>
<span style="font-style: italic;">"python-lxml"</span>
<span style="font-style: italic;">"python-lsp-server"</span>
<span style="font-style: italic;">"python-jedi"</span>
<span style="font-style: italic;">"python-send2trash"</span>
<span style="font-style: italic;">"python-matplotlib"</span>
<span style="font-style: italic;">"python-numpy"</span>
<span style="font-style: italic;">"python-pandas"</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf1a3d5c" class="outline-3">
<h3 id="orgf1a3d5c">Ruby</h3>
<div class="outline-text-3" id="text-orgf1a3d5c">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"ruby"</span>
<span style="font-style: italic;">"ruby-pry"</span>
<span style="font-style: italic;">"ruby-rubocop"</span>
<span style="font-style: italic;">"ruby-thor"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-shell"><span style="font-weight: bold;">export</span> <span style="font-weight: bold; font-style: italic;">RUBYLIB</span>=${<span style="font-weight: bold; font-style: italic;">HOME</span>}/.local/lib

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">set path for ruby gems in local</span>
<span style="font-weight: bold;">if</span> which ruby &gt;/dev/null &amp;&amp; which gem &gt;/dev/null; <span style="font-weight: bold;">then</span>
  <span style="font-weight: bold; font-style: italic;">PATH</span>=<span style="font-style: italic;">"$(ruby -r rubygems -e 'puts Gem.user_dir')/bin:$PATH"</span>
<span style="font-weight: bold;">fi</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf33f53e" class="outline-3">
<h3 id="orgf33f53e">Rust</h3>
<div class="outline-text-3" id="text-orgf33f53e">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"rust"</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf39a909" class="outline-3">
<h3 id="orgf39a909">Common Lisp</h3>
<div class="outline-text-3" id="text-orgf39a909">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"sbcl"</span>
<span style="font-style: italic;">"sbcl-slynk"</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org1470e80" class="outline-3">
<h3 id="org1470e80">Node.js</h3>
<div class="outline-text-3" id="text-org1470e80">
<div class="org-src-container">
<pre class="src src-shell" id="orgbfc5dd8"><span style="font-weight: bold;">echo</span> ${<span style="font-weight: bold; font-style: italic;">HOME</span>}/.npm-global
</pre>
</div>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"node"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-shell"><span style="font-weight: bold; font-style: italic;">NODE_PATH</span>=<span style="font-style: italic;">"&lt;&lt;npm-prefix()&gt;&gt;/lib/node_modules:${NODE_PATH}"</span>
<span style="font-weight: bold; font-style: italic;">PATH</span>=<span style="font-style: italic;">"&lt;&lt;npm-prefix()&gt;&gt;/bin:${PATH}"</span>
<span style="font-weight: bold; font-style: italic;">MANPATH</span>=<span style="font-style: italic;">"&lt;&lt;npm-prefix()&gt;&gt;/share/man:${MANPATH}"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-shell"><span style="font-weight: bold; font-style: italic;">prefix</span>=&lt;&lt;npm-prefix()&gt;&gt;
</pre>
</div>

<ul class="org-ul">
<li><p>
make a directory for global npm packages
</p>
<div class="org-src-container">
<pre class="src src-shell">mkdir -pv &lt;&lt;npm-prefix()&gt;&gt;
</pre>
</div></li>
<li><p>
install npm packages
</p>
<div class="org-src-container">
<pre class="src src-shell">npm install -g &lt;&lt;npm-pkg&gt;&gt;
</pre>
</div></li>
</ul>
</div>
</div>

<div id="outline-container-orgb7574cb" class="outline-3">
<h3 id="orgb7574cb">asdf-vm&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span></h3>
</div>
<div id="outline-container-orge42e6a5" class="outline-3">
<h3 id="orge42e6a5">Language Servers</h3>
<div class="outline-text-3" id="text-orge42e6a5">
</div>
<div id="outline-container-orgec541ab" class="outline-4">
<h4 id="orgec541ab">Bash Language Server</h4>
<div class="outline-text-4" id="text-orgec541ab">
<p>
<a href="https://github.com/bash-lsp/bash-language-server">Bash Language Server</a>
</p>

<div class="org-src-container">
<pre class="src src-shell">bash-language-server
</pre>
</div>
</div>
</div>

<div id="outline-container-org93dfac0" class="outline-4">
<h4 id="org93dfac0">Solargraph</h4>
<div class="outline-text-4" id="text-org93dfac0">
<p>
<a href="https://github.com/castwide/solargraph">Solargraph</a> is Ruby Language Server.
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"ruby-solargraph"</span>
</pre>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-org16f5414" class="outline-2">
<h2 id="org16f5414">Stuffs for Dedicated Tasks</h2>
<div class="outline-text-2" id="text-org16f5414">
</div>
<div id="outline-container-orgc534fe7" class="outline-3">
<h3 id="orgc534fe7">Batch Processing</h3>
<div class="outline-text-3" id="text-orgc534fe7">
</div>

<div id="outline-container-orgf04cbca" class="outline-4">
<h4 id="orgf04cbca">Morning Batch</h4>
<div class="outline-text-4" id="text-orgf04cbca">
<ul class="org-ul">
<li><p>
when to dispatch morning batch
</p>
<div class="org-src-container">
<pre class="src src-text" id="org4693b91">4
</pre>
</div></li>

<li><p>
morning.sh: morning batch script
</p>
<div class="org-src-container">
<pre class="src src-bash" id="org594d623">&lt;&lt;morning-batch&gt;&gt;
</pre>
</div></li>
</ul>
</div>
</div>

<div id="outline-container-org69815ad" class="outline-4">
<h4 id="org69815ad">Weekend Batch</h4>
<div class="outline-text-4" id="text-org69815ad">
<div class="org-src-container">
<pre class="src src-bash">&lt;&lt;weekend-batch&gt;&gt;
</pre>
</div>
</div>
</div>

<div id="outline-container-orge9f9473" class="outline-4">
<h4 id="orge9f9473">System Batch</h4>
<div class="outline-text-4" id="text-orge9f9473">
<div class="org-src-container">
<pre class="src src-shell">&lt;&lt;system-batch&gt;&gt;
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org53f8b24" class="outline-3">
<h3 id="org53f8b24">Transcode Video Files</h3>
<div class="outline-text-3" id="text-org53f8b24">
<p>
Transcoding my local video files with open codec, like VP9 and AV1, is effective for disc space usage.
</p>

<div class="org-src-container">
<pre class="src src-shell"><span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">!/usr/bin/</span><span style="font-weight: bold;">env</span><span style="font-weight: bold; font-style: italic;"> bash</span>
<span style="font-weight: bold;">set</span> -euo pipefail

<span style="font-weight: bold; font-style: italic;">CRF</span>=28
<span style="font-weight: bold; font-style: italic;">KBITRATE_AUDIO</span>=128

<span style="font-weight: bold;">function</span> <span style="font-weight: bold;">usage</span>() {
  cat &lt;&lt;_EOT_
<span style="font-weight: bold;">Usage:</span>
<span style="font-weight: bold;">  $(basename $0) [OPTIONS] &lt;video_in&gt; [&lt;video_out&gt;]</span>

<span style="font-weight: bold;">Description:</span>
<span style="font-weight: bold;">  $(basename $0) encodes &lt;video_in&gt; to &lt;video_out&gt; in specified codec.</span>

<span style="font-weight: bold;">Options:</span>
<span style="font-weight: bold;">  -c &lt;CRF&gt;      CRF value instead of ${CRF} (DEFAULT)</span>
<span style="font-weight: bold;">  -B &lt;AUDIO_BR&gt; Audio Bitrate in kbps</span>

<span style="font-weight: bold;">_EOT_</span>
}

<span style="font-weight: bold;">if</span> [ <span style="font-style: italic;">"${OPTIND}"</span> = 1 ]; <span style="font-weight: bold;">then</span>
  <span style="font-weight: bold;">while </span><span style="font-weight: bold;">getopts</span> c:B:h OPT
  <span style="font-weight: bold;">do</span>
    <span style="font-weight: bold;">case</span> ${<span style="font-weight: bold; font-style: italic;">OPT</span>} <span style="font-weight: bold;">in</span>
    c)
      <span style="font-weight: bold; font-style: italic;">CRF</span>=${<span style="font-weight: bold; font-style: italic;">OPTARG</span>}
      ;;
    B)
      <span style="font-weight: bold; font-style: italic;">CRF</span>=${<span style="font-weight: bold; font-style: italic;">OPTARG</span>}
      ;;
    h)
      usage
      ;;
    <span style="font-style: italic;">\?</span>)
      <span style="font-weight: bold;">echo</span> <span style="font-style: italic;">"Try to enter the h option."</span> 1&gt;&amp;2
      ;;
    <span style="font-weight: bold;">esac</span>
  <span style="font-weight: bold;">done</span>
<span style="font-weight: bold;">else</span>
  <span style="font-weight: bold;">echo</span> <span style="font-style: italic;">"No installed getopts-command."</span> 1&gt;&amp;2
  <span style="font-weight: bold;">exit</span> 1
<span style="font-weight: bold;">fi</span>

<span style="font-weight: bold;">shift</span> $((OPTIND - 1))

<span style="font-weight: bold;">if</span> [ $<span style="font-weight: bold; font-style: italic;">#</span> -lt 1 ] || [ $<span style="font-weight: bold; font-style: italic;">#</span> -gt 2 ]; <span style="font-weight: bold;">then</span>
  usage
  <span style="font-weight: bold;">exit</span> -1
<span style="font-weight: bold;">fi</span>

<span style="font-weight: bold; font-style: italic;">INPUT_VIDEO</span>=$<span style="font-weight: bold; font-style: italic;">1</span>
<span style="font-weight: bold;">if</span> [ ! -e <span style="font-style: italic;">"${INPUT_VIDEO}"</span> ]; <span style="font-weight: bold;">then</span>
  <span style="font-weight: bold;">echo</span> <span style="font-style: italic;">"${INPUT_VIDEO} does not exist."</span> 1&gt;&amp;2
  <span style="font-weight: bold;">exit</span> -1
<span style="font-weight: bold;">fi</span>

<span style="font-weight: bold;">if</span> [[ $<span style="font-weight: bold; font-style: italic;">#</span> -eq 2 ]]; <span style="font-weight: bold;">then</span>
  <span style="font-weight: bold; font-style: italic;">output_cand</span>=$<span style="font-weight: bold; font-style: italic;">2</span>
<span style="font-weight: bold;">else</span>
  <span style="font-weight: bold; font-style: italic;">output_cand</span>=$(basename <span style="font-style: italic;">"${INPUT_VIDEO}"</span>).webm
<span style="font-weight: bold;">fi</span>
<span style="font-weight: bold;">if</span> [ -e <span style="font-style: italic;">"${output_cand}"</span> ]; <span style="font-weight: bold;">then</span>
  <span style="font-weight: bold; font-style: italic;">OUTPUT_VIDEO</span>=${<span style="font-weight: bold; font-style: italic;">output_cand</span>%.*}_$(date +%Y%m%d_%H%M).webm
<span style="font-weight: bold;">else</span>
  <span style="font-weight: bold; font-style: italic;">OUTPUT_VIDEO</span>=<span style="font-style: italic;">"${output_cand}"</span>
<span style="font-weight: bold;">fi</span>

<span style="font-weight: bold; font-style: italic;">WORK_DIR</span>=<span style="font-style: italic;">"${INPUT_VIDEO%.*}"</span>
</pre>
</div>
</div>

<div id="outline-container-org10c0258" class="outline-4">
<h4 id="org10c0258">vp9 transcoding</h4>
<div class="outline-text-4" id="text-org10c0258">
<ul class="org-ul">
<li><p>
transcode video to vp9
</p>
<pre class="example">
$ vp9transc -c 32 video_orig.mkv video_vp9.webm
</pre></li>
</ul>

<div class="org-src-container">
<pre class="src src-shell">&lt;&lt;transc-shared&gt;&gt;

<span style="font-weight: bold; font-style: italic;">vp9_opts_pass1</span>=<span style="font-style: italic;">"-c:v libvpx-vp9 -cpu-used 4 -threads 3 -row-mt 1 -speed 1 -b:v 0 -crf ${CRF} -pass 1 -an -f null"</span>
<span style="font-weight: bold; font-style: italic;">vp9_opts_pass2</span>=<span style="font-style: italic;">"-c:v libvpx-vp9 -cpu-used 4 -threads 3 -row-mt 1 -speed 1 -b:v 0 -crf ${CRF} -pass 2 -map_metadata 0"</span>
<span style="font-weight: bold; font-style: italic;">opus_opts</span>=<span style="font-style: italic;">"-c:a libopus -b:a ${KBITRATE_AUDIO}k -ac 2"</span>

mkdir -p <span style="font-style: italic;">"${WORK_DIR}"</span> &amp;&amp; <span style="font-weight: bold;">cd</span> <span style="font-style: italic;">"${WORK_DIR}"</span> <span style="font-style: italic;">\</span>
  &amp;&amp; ffmpeg -i <span style="font-style: italic;">"../${INPUT_VIDEO}"</span> ${<span style="font-weight: bold; font-style: italic;">vp9_opts_pass1</span>} /dev/null <span style="font-style: italic;">\</span>
  &amp;&amp; ffmpeg -i <span style="font-style: italic;">"../${INPUT_VIDEO}"</span> ${<span style="font-weight: bold; font-style: italic;">vp9_opts_pass2</span>} ${<span style="font-weight: bold; font-style: italic;">opus_opts</span>} <span style="font-style: italic;">"../${OUTPUT_VIDEO}"</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org2952def" class="outline-4">
<h4 id="org2952def">av1 transcoding</h4>
<div class="outline-text-4" id="text-org2952def">
<ul class="org-ul">
<li><p>
transcode video to av1
</p>
<pre class="example">
$ av1transc video_orig.mkv video_av1.webm
</pre></li>
</ul>

<div class="org-src-container">
<pre class="src src-shell">&lt;&lt;transc-shared&gt;&gt;

<span style="font-weight: bold; font-style: italic;">av1_opts_common</span>=<span style="font-style: italic;">"-c:v libaom-av1 -cpu-used 2 -row-mt 1 -threads $(nproc) -b:v 0 -crf ${CRF}"</span>
<span style="font-weight: bold; font-style: italic;">av1_opts_pass1</span>=<span style="font-style: italic;">"${av1_opts_common} -pass 1 -an -f null"</span>
<span style="font-weight: bold; font-style: italic;">av1_opts_pass2</span>=<span style="font-style: italic;">"${av1_opts_common} -pass 2 -map_metadata 0"</span>
<span style="font-weight: bold; font-style: italic;">opus_opts</span>=<span style="font-style: italic;">"-c:a libopus -b:a ${KBITRATE_AUDIO}k -ac 2"</span>

mkdir -p <span style="font-style: italic;">"${WORK_DIR}"</span> &amp;&amp; <span style="font-weight: bold;">cd</span> <span style="font-style: italic;">"${WORK_DIR}"</span> <span style="font-style: italic;">\</span>
  &amp;&amp; ffmpeg -i <span style="font-style: italic;">"../${INPUT_VIDEO}"</span> ${<span style="font-weight: bold; font-style: italic;">av1_opts_pass1</span>} /dev/null <span style="font-style: italic;">\</span>
  &amp;&amp; ffmpeg -i <span style="font-style: italic;">"../${INPUT_VIDEO}"</span> ${<span style="font-weight: bold; font-style: italic;">av1_opts_pass2</span>} ${<span style="font-weight: bold; font-style: italic;">opus_opts</span>} <span style="font-style: italic;">"../${OUTPUT_VIDEO}"</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org9d7e748" class="outline-3">
<h3 id="org9d7e748">Transcode Audio Files&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span></h3>
</div>

<div id="outline-container-orgc4d221a" class="outline-3">
<h3 id="orgc4d221a">DVD Packing</h3>
<div class="outline-text-3" id="text-orgc4d221a">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"handbrake"</span>
<span style="font-style: italic;">"dvdbackup"</span>
<span style="font-style: italic;">"libdvdnav"</span>
<span style="font-style: italic;">"libdvdcss"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-bash"><span style="font-weight: bold;">set</span> -euo pipefail

<span style="font-weight: bold;">if</span> [ <span style="font-style: italic;">"${OPTIND}"</span> = 1 ]; <span style="font-weight: bold;">then</span>
  <span style="font-weight: bold;">while </span><span style="font-weight: bold;">getopts</span> t: OPT
  <span style="font-weight: bold;">do</span>
    <span style="font-weight: bold;">case</span> ${<span style="font-weight: bold; font-style: italic;">OPT</span>} <span style="font-weight: bold;">in</span>
    t)
      <span style="font-weight: bold; font-style: italic;">TITLE</span>=${<span style="font-weight: bold; font-style: italic;">OPTARG</span>}
      ;;
    <span style="font-weight: bold;">esac</span>
  <span style="font-weight: bold;">done</span>
<span style="font-weight: bold;">else</span>
  <span style="font-weight: bold;">echo</span> <span style="font-style: italic;">"No installed getopts-command."</span> 1&gt;&amp;2
  <span style="font-weight: bold;">exit</span> 1
<span style="font-weight: bold;">fi</span>
<span style="font-weight: bold;">shift</span> $((OPTIND - 1))

<span style="font-weight: bold;">if</span> [[ $<span style="font-weight: bold; font-style: italic;">#</span> -ge 1 ]]; <span style="font-weight: bold;">then</span>
  <span style="font-weight: bold; font-style: italic;">DVD_DIR</span>=$<span style="font-weight: bold; font-style: italic;">1</span>
  <span style="font-weight: bold;">if</span> [[ $<span style="font-weight: bold; font-style: italic;">#</span> -eq 2 ]]; <span style="font-weight: bold;">then</span>
    <span style="font-weight: bold; font-style: italic;">DVD_PACK_VIDEO</span>=$<span style="font-weight: bold; font-style: italic;">2</span>
  <span style="font-weight: bold;">else</span>
    <span style="font-weight: bold; font-style: italic;">DVD_PACK_VIDEO</span>=$(basename <span style="font-style: italic;">"${DVD_DIR}"</span>).mkv
  <span style="font-weight: bold;">fi</span>
<span style="font-weight: bold;">fi</span>

<span style="font-weight: bold;">if</span> [ -v TITLE ]; <span style="font-weight: bold;">then</span>
  <span style="font-weight: bold; font-style: italic;">title_opt</span>=<span style="font-style: italic;">"--title ${TITLE}"</span>
<span style="font-weight: bold;">else</span>
  <span style="font-weight: bold; font-style: italic;">title_opt</span>=<span style="font-style: italic;">'--main-feature'</span>
<span style="font-weight: bold;">fi</span>

<span style="font-weight: bold; font-style: italic;">hb_opts</span>=<span style="font-style: italic;">"--x264-preset veryslow --quality 18 --aencoder copy ${title_opt} --markers --all-audio --all-subtitles"</span>

HandBrakeCLI --input <span style="font-style: italic;">"${DVD_DIR}"</span> --output <span style="font-style: italic;">"${DVD_PACK_VIDEO}"</span> ${<span style="font-weight: bold; font-style: italic;">hb_opts</span>}
</pre>
</div>
</div>
</div>
<div id="outline-container-orgd132532" class="outline-3">
<h3 id="orgd132532">CD Ripping</h3>
<div class="outline-text-3" id="text-orgd132532">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"abcde"</span>
<span style="font-style: italic;">"eyed3"</span>
<span style="font-style: italic;">"lame"</span>
<span style="font-style: italic;">"opus-tools"</span>
<span style="font-style: italic;">"cdrtools"</span>
<span style="font-style: italic;">"easytag"</span>
</pre>
</div>
</div>

<div id="outline-container-orgc098f86" class="outline-4">
<h4 id="orgc098f86">abcde</h4>
<div class="outline-text-4" id="text-orgc098f86">
<div class="org-src-container">
<pre class="src src-conf"><span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">.flac is only desired output format</span>
<span style="font-weight: bold; font-style: italic;">OUTPUTTYPE</span>=<span style="font-style: italic;">"flac"</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">or .flac and .opus (bitrate is 256 kbps) will be generated at the same time</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">OUTPUTTYPE="flac,opus"</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">OPUSENCOPTS='--bitrate 256'</span>

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">.flac files will be utterly compressed with verification</span>
<span style="font-weight: bold; font-style: italic;">FLACOPTS</span>=<span style="font-style: italic;">"-V8"</span>

<span style="font-weight: bold; font-style: italic;">MAXPROCS</span>=4

<span style="font-weight: bold; font-style: italic;">OUTPUTFORMAT</span>=<span style="font-style: italic;">'${ARTISTFILE}/${ALBUMFILE}/${TRACKNUM}.${TRACKFILE}'</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgd312e66" class="outline-3">
<h3 id="orgd312e66">Tutorial Video Creation</h3>
<div class="outline-text-3" id="text-orgd312e66">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"slop"</span>
<span style="font-style: italic;">"gimp"</span>
<span style="font-style: italic;">"obs"</span>
<span style="font-style: italic;">"kdenlive"</span>
<span style="font-style: italic;">"audacity"</span>
</pre>
</div>
</div>

<div id="outline-container-org1ad72d0" class="outline-4">
<h4 id="org1ad72d0">Screenkey</h4>
<div class="outline-text-4" id="text-org1ad72d0">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"python-screenkey"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-json">{
  "timeout": 0.8,
  "key_mode": "composed",
  "bak_mode": "normal",
  "mods_mode": "emacs",
  "opacity": 0.3,
  "screen": 0
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgbe6d505" class="outline-3">
<h3 id="orgbe6d505">Sync Git Repos Automatically</h3>
<div class="outline-text-3" id="text-orgbe6d505">
<div class="org-src-container">
<pre class="src src-conf"><span style="font-weight: bold; font-style: italic;">0 */2 * * * &lt;&lt;which(filename</span>=<span style="font-style: italic;">"bash"</span>)&gt;&gt; -ci <span style="font-style: italic;">"ghq-sync &gt;&gt; $LOG_DIR/ghq-sync.log 2&gt;&amp;1"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-bash" id="orgd82269d"><span style="font-weight: bold;">function</span> <span style="font-weight: bold;">git-one-go</span> {
  local <span style="font-weight: bold; font-style: italic;">_branch</span>=$(git symbolic-ref -q HEAD | sed <span style="font-style: italic;">'s/refs\/heads\///'</span>)
  local <span style="font-weight: bold; font-style: italic;">_remote</span>=$(git config --get branch.$<span style="font-weight: bold; font-style: italic;">_branch</span>.pushRemote)
  local <span style="font-weight: bold; font-style: italic;">_commit_msg</span>=<span style="font-style: italic;">"auto-commit by $(whoami) on $(uname -n) at $(date +"%H:%M %b %d")"</span>

  <span style="font-weight: bold;">echo</span> -e <span style="font-style: italic;">"\nStarting git syncing at $(pwd)"</span>

  <span style="font-weight: bold;">if</span> [[ <span style="font-style: italic;">"true"</span> = <span style="font-style: italic;">"$(git config --get --bool branch.$_branch.sync)"</span> ]] ; <span style="font-weight: bold;">then</span>
    git add -u
    <span style="font-weight: bold;">if</span> [ -n <span style="font-style: italic;">"$(git status --porcelain)"</span> ]; <span style="font-weight: bold;">then</span>
      git commit --allow-empty -m <span style="font-style: italic;">"${_commit_msg}"</span>
    <span style="font-weight: bold;">fi</span>

    <span style="font-weight: bold;">if</span> [ -n <span style="font-style: italic;">"$(git log origin/main..HEAD)"</span> ]; <span style="font-weight: bold;">then</span>
      git push $<span style="font-weight: bold; font-style: italic;">_remote</span> $<span style="font-weight: bold; font-style: italic;">_branch</span>
      <span style="font-weight: bold;">if</span> [ $<span style="font-weight: bold; font-style: italic;">?</span> != 0 ]; <span style="font-weight: bold;">then</span>
        <span style="font-weight: bold;">echo</span> <span style="font-style: italic;">"ghq-sync: git push returned non-zero. Likely a connection failure."</span> &gt;&amp;2
        <span style="font-weight: bold;">exit</span> 1
      <span style="font-weight: bold;">fi</span>
    <span style="font-weight: bold;">else</span>
      <span style="font-weight: bold;">echo</span> <span style="font-style: italic;">"No unpushed commits found. Nothing to push."</span>
    <span style="font-weight: bold;">fi</span>
  <span style="font-weight: bold;">fi</span>
}

<span style="font-weight: bold; font-style: italic;">ghq_repos</span>=$(ghq list --full-path github.com/p-snow)
<span style="font-weight: bold;">for</span> repo_path<span style="font-weight: bold;"> in</span> ${<span style="font-weight: bold; font-style: italic;">ghq_repos</span>[@]}; <span style="font-weight: bold;">do</span>
  (<span style="font-weight: bold;">cd</span> ${<span style="font-weight: bold; font-style: italic;">repo_path</span>} &amp;&amp; git-one-go)
<span style="font-weight: bold;">done</span>
</pre>
</div>
</div>

<div id="outline-container-org2858f0e" class="outline-4">
<h4 id="org2858f0e">git-sync&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span></h4>
</div>
</div>

<div id="outline-container-org761ace8" class="outline-3">
<h3 id="org761ace8">Download media at anywhere in desktop</h3>
<div class="outline-text-3" id="text-org761ace8">
<p>
I prefer using mpv, the video file player, instead of watching YouTube videos in a browser. I can download a video file from the internet by executing this shell script using a shortcut key. The script calls the Emacs dispatch-yt-dlp-dwim function using a client/server scheme.
</p>

<div class="org-src-container">
<pre class="src src-bash" id="orga08c8fb"><span style="font-weight: bold;">if</span> [ $<span style="font-weight: bold; font-style: italic;">#</span> -ge 1 ]; <span style="font-weight: bold;">then</span>
  <span style="font-weight: bold; font-style: italic;">arg</span>=<span style="font-style: italic;">" nil nil t"</span>
<span style="font-weight: bold;">else</span>
  <span style="font-weight: bold; font-style: italic;">arg</span>=<span style="font-style: italic;">""</span>
<span style="font-weight: bold;">fi</span>
emacsclient -s server-&lt;&lt;hash-string(<span style="font-weight: bold; font-style: italic;">seed</span>=<span style="font-style: italic;">"server"</span>, <span style="font-weight: bold; font-style: italic;">len</span>=6)&gt;&gt; --eval <span style="font-style: italic;">"(progn (yt-dlp-dispatch-dwim \"$(xclip -out)\"${arg})(dispatch-execute-macro))"</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org2cf351d" class="outline-2">
<h2 id="org2cf351d">Babel Utility Functions</h2>
<div class="outline-text-2" id="text-org2cf351d">
</div>
<div id="outline-container-orge3193c8" class="outline-3">
<h3 id="orge3193c8">which path</h3>
<div class="outline-text-3" id="text-orge3193c8">
<p>
return absolute path for file using which command
</p>

<div class="org-src-container">
<pre class="src src-bash" id="org17e4001">which ${<span style="font-weight: bold; font-style: italic;">filename</span>}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd5442da" class="outline-3">
<h3 id="orgd5442da">Generate hash string</h3>
<div class="outline-text-3" id="text-orgd5442da">
<p>
Return hash string from 'seed'. You can cull the output to desired length by 'len'.
</p>

<div class="org-src-container">
<pre class="src src-python" id="org9ecba92"><span style="font-weight: bold;">import</span> hashlib

<span style="font-weight: bold; font-style: italic;">sha256_hash</span> = hashlib.sha256(seed.encode(<span style="font-style: italic;">"utf-8"</span>))
<span style="font-weight: bold;">return</span> sha256_hash.hexdigest()[:<span style="font-weight: bold;">len</span>]
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd72d785" class="outline-3">
<h3 id="orgd72d785">random number</h3>
<div class="outline-text-3" id="text-orgd72d785">
<p>
return random number between 0 and max
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp" id="org60ab63b">(calc-eval (format <span style="font-style: italic;">"random(%d)"</span> (1+ max)))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org43b5de7" class="outline-2">
<h2 id="org43b5de7">Specialized Scripts</h2>
<div class="outline-text-2" id="text-org43b5de7">
</div>

<div id="outline-container-org3185e2c" class="outline-3">
<h3 id="org3185e2c">Declutters&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span></h3>
</div>

<div id="outline-container-org553343f" class="outline-3">
<h3 id="org553343f">Database back-up scripts</h3>
<div class="outline-text-3" id="text-org553343f">
<ul class="org-ul">
<li><p>
PostgreSQL
</p>
<div class="org-src-container">
<pre class="src src-bash"><span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">!/usr/bin/</span><span style="font-weight: bold;">env</span><span style="font-weight: bold; font-style: italic;"> bash</span>

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Usage: $ postgres_backup &lt;db_name&gt; &lt;backup_dir&gt;</span>

<span style="font-weight: bold; font-style: italic;">POSTGRES_DBNAME</span>=$<span style="font-weight: bold; font-style: italic;">1</span>
<span style="font-weight: bold; font-style: italic;">BACKUP_DIR</span>=$<span style="font-weight: bold; font-style: italic;">2</span>
<span style="font-weight: bold; font-style: italic;">DATE</span>=<span style="font-style: italic;">"$(date +%Y%m%d_%H%M)"</span>

pg_dump --format=custom ${<span style="font-weight: bold; font-style: italic;">POSTGRES_DBNAME</span>} &gt; ${<span style="font-weight: bold; font-style: italic;">BACKUP_DIR</span>}/${<span style="font-weight: bold; font-style: italic;">DATE</span>}_${<span style="font-weight: bold; font-style: italic;">POSTGRES_DBNAME</span>}.custom || <span style="font-weight: bold;">exit</span> 1

<span style="font-weight: bold;">exit</span> 0
</pre>
</div></li>

<li><p>
MySQL
</p>
<div class="org-src-container">
<pre class="src src-shell"><span style="font-weight: bold; font-style: italic;">BACKUP_DIR</span>=~/data/share/backups/mysql
<span style="font-weight: bold; font-style: italic;">RAW_SQL</span>=<span style="font-style: italic;">"$(date +%Y%m%d_%H%M)_backup.sql"</span>
<span style="font-weight: bold; font-style: italic;">TAR_SQL</span>=<span style="font-style: italic;">"${RAW_SQL}.txz"</span>

(
  <span style="font-weight: bold;">cd</span> <span style="font-style: italic;">"${BACKUP_DIR}"</span> || <span style="font-weight: bold;">exit</span> 1
  mysqldump --opt --all-databases --events --default-character-set=binary -u root &gt; <span style="font-style: italic;">"${RAW_SQL}"</span>
  tar cfJ <span style="font-style: italic;">"${TAR_SQL}"</span> <span style="font-style: italic;">"${RAW_SQL}"</span>
  rm -f <span style="font-style: italic;">"${RAW_SQL}"</span>
) || <span style="font-weight: bold;">exit</span> 1

<span style="font-weight: bold;">exit</span> 0
</pre>
</div></li>
</ul>
</div>
</div>

<div id="outline-container-org1b2ec6e" class="outline-3">
<h3 id="org1b2ec6e">filetype</h3>
<div class="outline-text-3" id="text-org1b2ec6e">
<p>
This program determine type of the file.
</p>

<div class="org-src-container">
<pre class="src src-ruby"><span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">!/usr/bin/env ruby</span>

<span style="font-weight: bold;">require</span> <span style="font-style: italic;">'pathname'</span>
<span style="font-weight: bold;">require</span> <span style="font-style: italic;">'uri'</span>
<span style="font-weight: bold;">require</span> <span style="font-style: italic;">'shellwords'</span>

<span style="font-weight: bold;">class</span> <span style="font-weight: bold; text-decoration: underline;">FileType</span>
  <span style="font-weight: bold; text-decoration: underline;">ZIP_PREFIXES</span> = [<span style="font-style: italic;">'Zip archive data'</span>]

  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">self</span>.<span style="font-weight: bold;">type</span>(filename, file_cmd_opt = <span style="font-style: italic;">""</span>)
    <span style="font-weight: bold;">if</span>  <span style="font-weight: bold; text-decoration: underline;">File</span>.exist?(filename)
      local_opt = <span style="font-style: italic;">""</span>
      <span style="font-weight: bold;">if</span> <span style="font-weight: bold; text-decoration: underline;">File</span>.symlink?(filename)
        local_opt += <span style="font-style: italic;">"--dereference"</span>
      <span style="font-weight: bold;">end</span>
      <span style="font-style: italic;">`file --brief </span><span style="font-weight: bold; font-style: italic;">#{file_cmd_opt}</span><span style="font-style: italic;"> </span><span style="font-weight: bold; font-style: italic;">#{local_opt}</span><span style="font-style: italic;"> </span><span style="font-weight: bold; font-style: italic;">#{Shellwords.shellescape(filename)}</span><span style="font-style: italic;">`</span>.strip
    <span style="font-weight: bold;">elsif</span> filename =~ <span style="font-style: italic;">/https?:\/\/www\.youtube\.com.*/</span>
      <span style="font-style: italic;">`yt-dlp -f worst -q </span><span style="font-weight: bold; font-style: italic;">#{Shellwords.shellescape(filename)}</span><span style="font-style: italic;"> -o - 2&gt;/dev/null | file --brief </span><span style="font-weight: bold; font-style: italic;">#{file_cmd_opt}</span><span style="font-style: italic;"> -`</span>.strip
    <span style="font-weight: bold;">elsif</span> filename =~ <span style="font-weight: bold; text-decoration: underline;">URI</span>::<span style="font-weight: bold; text-decoration: underline;">DEFAULT_PARSER</span>.make_regexp
      <span style="font-style: italic;">`curl --location --range 0-9999 </span><span style="font-weight: bold; font-style: italic;">#{Shellwords.shellescape(filename)}</span><span style="font-style: italic;"> 2&gt;/dev/null | file --brief </span><span style="font-weight: bold; font-style: italic;">#{file_cmd_opt}</span><span style="font-style: italic;"> -`</span>.strip
    <span style="font-weight: bold;">else</span>
      <span style="font-style: italic;">''</span>
    <span style="font-weight: bold;">end</span>
  <span style="font-weight: bold;">end</span>

  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">self</span>.<span style="font-weight: bold;">mime_type</span>(filename)
    type(filename, <span style="font-style: italic;">"--mime-type"</span>)
  <span style="font-weight: bold;">end</span>

  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">self</span>.<span style="font-weight: bold;">block_device?</span>(file)
    type(file).start_with?(<span style="font-style: italic;">'block special'</span>) &amp;&amp;
      mime_type(file) == <span style="font-style: italic;">'inode/blockdevice'</span>
  <span style="font-weight: bold;">end</span>

  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">self</span>.<span style="font-weight: bold;">iso9660?</span>(file)
    mime_type(file) == <span style="font-style: italic;">'application/x-iso9660-image'</span>
  <span style="font-weight: bold;">end</span>

  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">self</span>.<span style="font-weight: bold;">video_dvd_image?</span>(file)
    iso9660?(file) &amp;&amp; type(file).start_with?(<span style="font-style: italic;">'UDF filesystem data'</span>)
  <span style="font-weight: bold;">end</span>

  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">self</span>.<span style="font-weight: bold;">html?</span>(file)
    type(file).start_with?(<span style="font-style: italic;">"HTML document"</span>)
  <span style="font-weight: bold;">end</span>

  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">self</span>.<span style="font-weight: bold;">pdf?</span>(file)
    type(file).start_with?(<span style="font-style: italic;">"PDF document"</span>)
  <span style="font-weight: bold;">end</span>

  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">self</span>.<span style="font-weight: bold;">epub?</span>(file)
    type(file) == <span style="font-style: italic;">"EPUB document"</span>
  <span style="font-weight: bold;">end</span>

  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">self</span>.<span style="font-weight: bold;">mobi?</span>(file)
    type(file).start_with?(<span style="font-style: italic;">"Mobipocket E-book"</span>)
  <span style="font-weight: bold;">end</span>

  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">self</span>.<span style="font-weight: bold;">pgp?</span>(file)
    type(file).start_with?(<span style="font-style: italic;">"PGP"</span>)
  <span style="font-weight: bold;">end</span>

  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">self</span>.<span style="font-weight: bold;">tarpgp?</span>(file)
    pgp?(file) &amp;&amp; file.end_with?(<span style="font-style: italic;">'.tar.gpg'</span>)
  <span style="font-weight: bold;">end</span>

  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">self</span>.<span style="font-weight: bold;">zip?</span>(file)
    type(file).start_with?(*<span style="font-weight: bold; text-decoration: underline;">ZIP_PREFIXES</span>)
  <span style="font-weight: bold;">end</span>

  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">self</span>.<span style="font-weight: bold;">video?</span>(file)
    mime_type(file).start_with?(<span style="font-style: italic;">"video/"</span>)
  <span style="font-weight: bold;">end</span>

  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">self</span>.<span style="font-weight: bold;">audio?</span>(file)
    mime_type(file).start_with?(<span style="font-style: italic;">'audio/'</span>)
  <span style="font-weight: bold;">end</span>

  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">self</span>.<span style="font-weight: bold;">image?</span>(file)
    mime_type(file).start_with?(<span style="font-style: italic;">"image/"</span>)
  <span style="font-weight: bold;">end</span>

  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">self</span>.<span style="font-weight: bold;">playable?</span>(file)
    <span style="font-weight: bold;">if</span> <span style="font-weight: bold; text-decoration: underline;">File</span>.directory?(file)
      <span style="font-weight: bold; text-decoration: underline;">Dir</span>.foreach(file) <span style="font-weight: bold;">do</span> |fname|
        <span style="font-weight: bold;">next</span> <span style="font-weight: bold;">if</span> [<span style="font-style: italic;">"."</span>, <span style="font-style: italic;">".."</span>].include?(fname)
        <span style="font-weight: bold;">return</span> <span style="font-weight: bold; text-decoration: underline;">false</span> <span style="font-weight: bold;">unless</span> playable?(<span style="font-style: italic;">"</span><span style="font-weight: bold; font-style: italic;">#{file}</span><span style="font-style: italic;">/</span><span style="font-weight: bold; font-style: italic;">#{fname}</span><span style="font-style: italic;">"</span>)
      <span style="font-weight: bold;">end</span>
      <span style="font-weight: bold; text-decoration: underline;">true</span>
    <span style="font-weight: bold;">elsif</span> file =~ <span style="font-style: italic;">/https?:\/\/www\.youtube\.com.*/</span>
      <span style="font-weight: bold; text-decoration: underline;">true</span>
    <span style="font-weight: bold;">else</span>
      type(file).start_with?(<span style="font-style: italic;">"ISO Media"</span>, <span style="font-style: italic;">"Audio file"</span>) ||
        mime_type(file).start_with?(<span style="font-style: italic;">"video"</span>, <span style="font-style: italic;">"audio"</span>, <span style="font-style: italic;">"image"</span>)
    <span style="font-weight: bold;">end</span>
  <span style="font-weight: bold;">end</span>

  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">self</span>.<span style="font-weight: bold;">dvd_dir?</span>(file)
    <span style="font-weight: bold; text-decoration: underline;">false</span> <span style="font-weight: bold;">unless</span> mime_type(file) == <span style="font-style: italic;">'inode/directory'</span>
    <span style="font-weight: bold; text-decoration: underline;">File</span>.exist?(<span style="font-weight: bold; text-decoration: underline;">Pathname</span>.new(file).join(<span style="font-style: italic;">"VIDEO_TS"</span>)) ||
      <span style="font-weight: bold; text-decoration: underline;">File</span>.exist?(<span style="font-weight: bold; text-decoration: underline;">Pathname</span>.new(file).join(<span style="font-style: italic;">"video_ts"</span>))
  <span style="font-weight: bold;">end</span>
<span style="font-weight: bold;">end</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org3e5cbe2" class="outline-3">
<h3 id="org3e5cbe2">mediautil</h3>
<div class="outline-text-3" id="text-org3e5cbe2">
<p>
Utility ruby program for manipulating image, audio and video file.
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"dvd+rw-tools"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-ruby"><span style="font-weight: bold;">require</span> <span style="font-style: italic;">'thor'</span>
<span style="font-weight: bold;">require</span> <span style="font-style: italic;">'open3'</span>
<span style="font-weight: bold;">require</span> <span style="font-style: italic;">'fileutils'</span>
<span style="font-weight: bold;">require</span> <span style="font-style: italic;">'tempfile'</span>
<span style="font-weight: bold;">require</span> <span style="font-style: italic;">'tmpdir'</span>

<span style="font-weight: bold;">require</span> <span style="font-style: italic;">'filetype'</span>

<span style="font-weight: bold;">class</span> <span style="font-weight: bold; text-decoration: underline;">MediaUtil</span> &lt; <span style="font-weight: bold; text-decoration: underline;">Thor</span>
  <span style="font-weight: bold; text-decoration: underline;">OUTFILE_SUFFIX</span> = <span style="font-style: italic;">"_out"</span>
  <span style="font-weight: bold; text-decoration: underline;">DEFAULT_VIDEO_EXT</span> = <span style="font-style: italic;">".mkv"</span>

  <span style="font-weight: bold;">class</span> <span style="font-weight: bold; text-decoration: underline;">Names</span> &lt; <span style="font-weight: bold; text-decoration: underline;">Struct</span>.new(<span style="font-weight: bold; text-decoration: underline;">:in_f</span>, <span style="font-weight: bold; text-decoration: underline;">:out_f</span>)
    <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">in_file</span>()
      in_f
    <span style="font-weight: bold;">end</span>
    <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">out_file</span>(extension = <span style="font-weight: bold; text-decoration: underline;">nil</span>)
      <span style="font-weight: bold;">if</span> out_f
        out_f
      <span style="font-weight: bold;">else</span>
        bn = <span style="font-weight: bold; text-decoration: underline;">File</span>.basename(in_f, <span style="font-style: italic;">".*"</span>).gsub(<span style="font-style: italic;">/ /</span>, <span style="font-style: italic;">'_'</span>)
        ext = ((extension) ? extension : <span style="font-weight: bold; text-decoration: underline;">File</span>.extname(in_file))
        default_out = bn + ext
        <span style="font-weight: bold;">if</span> <span style="font-weight: bold; text-decoration: underline;">File</span>.file?(default_out)
          10.times <span style="font-weight: bold;">do</span> |i|
            try_name = bn + <span style="font-style: italic;">"_"</span> + (i+1).to_s + ext
            <span style="font-weight: bold;">unless</span> <span style="font-weight: bold; text-decoration: underline;">File</span>.file?(try_name)
              <span style="font-weight: bold;">return</span> try_name
            <span style="font-weight: bold;">end</span>
          <span style="font-weight: bold;">end</span>
        <span style="font-weight: bold;">end</span>
        default_out
      <span style="font-weight: bold;">end</span>
    <span style="font-weight: bold;">end</span>
    <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">title</span>()
      <span style="font-weight: bold; text-decoration: underline;">File</span>.basename(out_file, <span style="font-style: italic;">".*"</span>)
    <span style="font-weight: bold;">end</span>
  <span style="font-weight: bold;">end</span>
  <span style="font-weight: bold;">class</span> <span style="font-weight: bold; text-decoration: underline;">Commander</span> &lt; <span style="font-weight: bold; text-decoration: underline;">Struct</span>.new(<span style="font-weight: bold; text-decoration: underline;">:log</span>, <span style="font-weight: bold; text-decoration: underline;">:dry</span>)
    <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">execute</span>(command)
      <span style="font-weight: bold;">if</span> dry
        <span style="font-weight: bold;">puts</span> command
      <span style="font-weight: bold;">else</span>
        log_str, s_code = <span style="font-weight: bold; text-decoration: underline;">Open3</span>.capture2e(command)
        <span style="font-weight: bold;">if</span> log
          user_cmd = <span style="font-weight: bold;">caller</span>.first.scan(<span style="font-style: italic;">/`(.*)'/</span>).flatten.first.to_s
          log_fname = <span style="font-weight: bold; text-decoration: underline;">Time</span>.now.strftime(<span style="font-style: italic;">"%Y%m%d_%H%M%S_"</span>) + user_cmd + <span style="font-style: italic;">".log"</span>
          <span style="font-weight: bold; text-decoration: underline;">File</span>.open(log_fname, <span style="font-style: italic;">"w"</span>) <span style="font-weight: bold;">do</span> |f|
            f.puts(log_str)
          <span style="font-weight: bold;">end</span>
        <span style="font-weight: bold;">else</span>
          <span style="font-weight: bold;">puts</span> log_str
        <span style="font-weight: bold;">end</span>
        <span style="font-weight: bold;">exit</span> <span style="font-weight: bold; text-decoration: underline;">false</span> <span style="font-weight: bold;">unless</span> s_code.success?
        <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">exit false</span>
      <span style="font-weight: bold;">end</span>
    <span style="font-weight: bold;">end</span>
  <span style="font-weight: bold;">end</span>

  class_option <span style="font-weight: bold; text-decoration: underline;">:log</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"L"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:boolean</span>,
               <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">"log stdout and stderr instead they reveal in terminal"</span>
  class_option <span style="font-weight: bold; text-decoration: underline;">:dryrun</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"D"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:boolean</span>

  desc <span style="font-style: italic;">"info &lt;file&gt;"</span>, <span style="font-style: italic;">"show information about the video file or DVD directory"</span>
  option <span style="font-weight: bold; text-decoration: underline;">:short</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"s"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:boolean</span>
  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">info</span>(target)
    commander = <span style="font-weight: bold; text-decoration: underline;">Commander</span>.new(options[<span style="font-weight: bold; text-decoration: underline;">:log</span>], options[<span style="font-weight: bold; text-decoration: underline;">:dryrun</span>])

    <span style="font-weight: bold;">if</span> <span style="font-weight: bold; text-decoration: underline;">FileType</span>.video?(target) || <span style="font-weight: bold; text-decoration: underline;">FileType</span>.audio?(target)
      commander.execute(<span style="font-style: italic;">"ffprobe \"</span><span style="font-weight: bold; font-style: italic;">#{target}</span><span style="font-style: italic;">\" -hide_banner -show_entries format"</span>)
    <span style="font-weight: bold;">elsif</span> <span style="font-weight: bold; text-decoration: underline;">FileType</span>.image?(target)
      <span style="font-weight: bold;">if</span> options[<span style="font-weight: bold; text-decoration: underline;">:short</span>]
        commander.execute(<span style="font-style: italic;">"identify </span><span style="font-weight: bold; font-style: italic;">#{target}</span><span style="font-style: italic;">"</span>)
      <span style="font-weight: bold;">else</span>
        commander.execute(<span style="font-style: italic;">"identify -verbose </span><span style="font-weight: bold; font-style: italic;">#{target}</span><span style="font-style: italic;">"</span>)
      <span style="font-weight: bold;">end</span>
    <span style="font-weight: bold;">elsif</span> <span style="font-weight: bold; text-decoration: underline;">FileType</span>.block_device?(target) ||
          <span style="font-weight: bold; text-decoration: underline;">FileType</span>.video_dvd_image?(target) ||
          <span style="font-weight: bold; text-decoration: underline;">FileType</span>.dvd_dir?(target)
      commander.execute(<span style="font-style: italic;">"HandBrakeCLI -i \"</span><span style="font-weight: bold; font-style: italic;">#{target}</span><span style="font-style: italic;">\" --title 0"</span>)
    <span style="font-weight: bold;">else</span>
      <span style="font-weight: bold; text-decoration: underline;">STDERR</span>.puts <span style="font-style: italic;">"Unknown Media Format"</span>
      <span style="font-weight: bold;">exit</span> <span style="font-weight: bold; text-decoration: underline;">false</span>
    <span style="font-weight: bold;">end</span>
  <span style="font-weight: bold;">end</span>

  default_command <span style="font-weight: bold; text-decoration: underline;">:encode</span>
  desc <span style="font-style: italic;">"encode"</span>, <span style="font-style: italic;">"encode video file"</span>
  option <span style="font-weight: bold; text-decoration: underline;">:in</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"i"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>, <span style="font-weight: bold; text-decoration: underline;">:required</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">true</span>
  option <span style="font-weight: bold; text-decoration: underline;">:out</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"o"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>
  option <span style="font-weight: bold; text-decoration: underline;">:vencoder</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"e"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:banner</span> =&gt; <span style="font-style: italic;">"libx265|libx264"</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">"video encoder"</span>
  option <span style="font-weight: bold; text-decoration: underline;">:vquality</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"q"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:banner</span> =&gt; <span style="font-style: italic;">"24.0"</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">"video encoding quality"</span>
  option <span style="font-weight: bold; text-decoration: underline;">:vbitrate</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"b"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:banner</span> =&gt; <span style="font-style: italic;">"1000"</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">"video encoding bitrate in kbps"</span>
  option <span style="font-weight: bold; text-decoration: underline;">:aencoder</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"E"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:banner</span> =&gt; <span style="font-style: italic;">"fdk_aac"</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">"audio encoder"</span>
  option <span style="font-weight: bold; text-decoration: underline;">:aquality</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"Q"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:banner</span> =&gt; <span style="font-style: italic;">"100.0"</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">"audio encoding quality"</span>
  option <span style="font-weight: bold; text-decoration: underline;">:abitrate</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"B"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:banner</span> =&gt; <span style="font-style: italic;">"128"</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">"audio encoding bitrate in kbps"</span>
  option <span style="font-weight: bold; text-decoration: underline;">:display</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"d"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:banner</span> =&gt; <span style="font-style: italic;">"1920:1080"</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">'display (width:height) in which encoded video fit'</span>
  option <span style="font-weight: bold; text-decoration: underline;">:fps</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"f"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:banner</span> =&gt; <span style="font-style: italic;">"30"</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">'max frame rate'</span>
  option <span style="font-weight: bold; text-decoration: underline;">:ffmpeg</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>
  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">encode</span>()
    equip = <span style="font-weight: bold; text-decoration: underline;">Names</span>.new(options[<span style="font-weight: bold; text-decoration: underline;">:in</span>], options[<span style="font-weight: bold; text-decoration: underline;">:out</span>])
    commander = <span style="font-weight: bold; text-decoration: underline;">Commander</span>.new(options[<span style="font-weight: bold; text-decoration: underline;">:log</span>], options[<span style="font-weight: bold; text-decoration: underline;">:dryrun</span>])

    vconf = aconf = pconf = <span style="font-weight: bold; text-decoration: underline;">nil</span>
    <span style="font-weight: bold;">if</span> options[<span style="font-weight: bold; text-decoration: underline;">:vencoder</span>] || options[<span style="font-weight: bold; text-decoration: underline;">:vquality</span>]
      vconf = <span style="font-weight: bold; text-decoration: underline;">VideoConfig</span>.new(options[<span style="font-weight: bold; text-decoration: underline;">:vencoder</span>], options[<span style="font-weight: bold; text-decoration: underline;">:vquality</span>], options[<span style="font-weight: bold; text-decoration: underline;">:vbitrate</span>])
    <span style="font-weight: bold;">end</span>
    <span style="font-weight: bold;">if</span> options[<span style="font-weight: bold; text-decoration: underline;">:aencoder</span>] || options[<span style="font-weight: bold; text-decoration: underline;">:aquality</span>]
      aconf = <span style="font-weight: bold; text-decoration: underline;">AudioConfig</span>.new(options[<span style="font-weight: bold; text-decoration: underline;">:aencoder</span>], options[<span style="font-weight: bold; text-decoration: underline;">:aquality</span>], options[<span style="font-weight: bold; text-decoration: underline;">:abitrate</span>])
    <span style="font-weight: bold;">end</span>
    <span style="font-weight: bold;">if</span> options[<span style="font-weight: bold; text-decoration: underline;">:display</span>] || options[<span style="font-weight: bold; text-decoration: underline;">:fps</span>]
      pconf = <span style="font-weight: bold; text-decoration: underline;">PictureConfig</span>.new
      pconf.fit_size(options[<span style="font-weight: bold; text-decoration: underline;">:display</span>]) <span style="font-weight: bold;">if</span> options[<span style="font-weight: bold; text-decoration: underline;">:display</span>]
      pconf.decrease_framerate(options[<span style="font-weight: bold; text-decoration: underline;">:fps</span>]) <span style="font-weight: bold;">if</span> options[<span style="font-weight: bold; text-decoration: underline;">:fps</span>]
    <span style="font-weight: bold;">end</span>

    <span style="font-weight: bold;">if</span> <span style="font-weight: bold; text-decoration: underline;">FileType</span>.video?(equip.in_file) <span style="font-weight: bold;">then</span>
      commander.execute(<span style="font-weight: bold; text-decoration: underline;">FFMPEG</span>.command([<span style="font-weight: bold; text-decoration: underline;">FFMPEGOptSet</span>.new(equip.in_file, [])],
                                       [<span style="font-weight: bold; text-decoration: underline;">FFMPEGOptSet</span>.new(equip.out_file, [vconf, aconf, pconf, <span style="font-style: italic;">"-map_metadata 0"</span>, options[<span style="font-weight: bold; text-decoration: underline;">:ffmpeg</span>]])]))
    <span style="font-weight: bold;">elsif</span> <span style="font-weight: bold; text-decoration: underline;">FileType</span>.audio?(equip.in_file) <span style="font-weight: bold;">then</span>
      commander.execute(<span style="font-weight: bold; text-decoration: underline;">FFMPEG</span>.command([<span style="font-weight: bold; text-decoration: underline;">FFMPEGOptSet</span>.new(equip.in_file, [])],
                                       [<span style="font-weight: bold; text-decoration: underline;">FFMPEGOptSet</span>.new(equip.out_file, [aconf])]))
    <span style="font-weight: bold;">elsif</span> <span style="font-weight: bold; text-decoration: underline;">FileType</span>.image?(equip.in_file) <span style="font-weight: bold;">then</span>
      pconf = <span style="font-weight: bold; text-decoration: underline;">ImageConfig</span>.new
      commander.execute(<span style="font-weight: bold; text-decoration: underline;">ImageMagick</span>.command(equip.in_file,
                                            equip.out_file,
                                            pconf))
    <span style="font-weight: bold;">else</span>
      <span style="font-weight: bold; text-decoration: underline;">STDERR</span>.puts <span style="font-style: italic;">"Unknown Media Format"</span>
      <span style="font-weight: bold;">exit</span> <span style="font-weight: bold; text-decoration: underline;">false</span>
    <span style="font-weight: bold;">end</span>
  <span style="font-weight: bold;">end</span>

  desc <span style="font-style: italic;">'cdencode'</span>, <span style="font-style: italic;">'rip and encode CD contents'</span>
  option <span style="font-weight: bold; text-decoration: underline;">:device</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">'d'</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">'Device file'</span>
  option <span style="font-weight: bold; text-decoration: underline;">:format</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">'f'</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:banner</span> =&gt; <span style="font-style: italic;">'flac,ogg,m4a'</span>, <span style="font-weight: bold; text-decoration: underline;">:default</span> =&gt; <span style="font-style: italic;">'flac:-8'</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">'formats with additinal argument like compression level'</span>
  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">cdencode</span>()
    commander = <span style="font-weight: bold; text-decoration: underline;">Commander</span>.new(options[<span style="font-weight: bold; text-decoration: underline;">:log</span>], options[<span style="font-weight: bold; text-decoration: underline;">:dryrun</span>])

    abcde_args = []
    abcde_args &lt;&lt; <span style="font-style: italic;">"-d </span><span style="font-weight: bold; font-style: italic;">#{options[:device]}</span><span style="font-style: italic;">"</span> <span style="font-weight: bold;">if</span> options[<span style="font-weight: bold; text-decoration: underline;">:device</span>]
    abcde_args &lt;&lt; <span style="font-style: italic;">'-a default'</span>
    <span style="font-weight: bold;">if</span> options[<span style="font-weight: bold; text-decoration: underline;">:format</span>] <span style="font-weight: bold;">then</span>
      abcde_args &lt;&lt; <span style="font-style: italic;">"-o '</span><span style="font-weight: bold; font-style: italic;">#{options[:format]}</span><span style="font-style: italic;">'"</span>
    <span style="font-weight: bold;">end</span>
    abcde_args &lt;&lt; <span style="font-style: italic;">'-G'</span> <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">getalbumart</span>
    abcde_args &lt;&lt; <span style="font-style: italic;">'-x'</span> <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Eject CD</span>

    commander.execute(<span style="font-style: italic;">"abcde </span><span style="font-weight: bold; font-style: italic;">#{abcde_args.join(' ')}</span><span style="font-style: italic;">"</span>)
  <span style="font-weight: bold;">end</span>

  desc <span style="font-style: italic;">'dvdrip'</span>, <span style="font-style: italic;">'rip(backup) DVD contents'</span>
  option <span style="font-weight: bold; text-decoration: underline;">:device</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">'d'</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">'DVD device file'</span>
  option <span style="font-weight: bold; text-decoration: underline;">:out</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">'o'</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">'output directory name'</span>
  option <span style="font-weight: bold; text-decoration: underline;">:name</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">'n'</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">'root directory name of backup data'</span>
  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">dvdrip</span>()
    commander = <span style="font-weight: bold; text-decoration: underline;">Commander</span>.new(options[<span style="font-weight: bold; text-decoration: underline;">:log</span>], options[<span style="font-weight: bold; text-decoration: underline;">:dryrun</span>])

    dvdbackup_opts = [<span style="font-style: italic;">'dvdbackup'</span>]
    dvdbackup_opts &lt;&lt; <span style="font-style: italic;">'--input=%s'</span> % options[<span style="font-weight: bold; text-decoration: underline;">:device</span>] <span style="font-weight: bold;">if</span> options[<span style="font-weight: bold; text-decoration: underline;">:device</span>]
    dvdbackup_opts &lt;&lt; <span style="font-style: italic;">'--output=%s'</span> % options[<span style="font-weight: bold; text-decoration: underline;">:out</span>] <span style="font-weight: bold;">if</span> options[<span style="font-weight: bold; text-decoration: underline;">:out</span>]
    dvdbackup_opts &lt;&lt; <span style="font-style: italic;">'--name=%s'</span> % options[<span style="font-weight: bold; text-decoration: underline;">:name</span>] <span style="font-weight: bold;">if</span> options[<span style="font-weight: bold; text-decoration: underline;">:name</span>]
    dvdbackup_opts &lt;&lt; <span style="font-style: italic;">'--mirror'</span>
    dvdbackup_opts &lt;&lt; <span style="font-style: italic;">'--progress'</span>
    dvdbackup_opts &lt;&lt; <span style="font-style: italic;">'--verbose'</span>

    commander.execute(dvdbackup_opts.join(<span style="font-style: italic;">' '</span>))
  <span style="font-weight: bold;">end</span>

  desc <span style="font-style: italic;">'dvdencode'</span>, <span style="font-style: italic;">'encode DVD contents'</span>
  option <span style="font-weight: bold; text-decoration: underline;">:in</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">'i'</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>, <span style="font-weight: bold; text-decoration: underline;">:required</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">true</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">'input source, DVD device file or backuped DVD file'</span>
  option <span style="font-weight: bold; text-decoration: underline;">:out</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">'o'</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">'output directory name'</span>
  option <span style="font-weight: bold; text-decoration: underline;">:vencoder</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"e"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:banner</span> =&gt; <span style="font-style: italic;">"x265|x264"</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">"video encoder"</span>
  option <span style="font-weight: bold; text-decoration: underline;">:vquality</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"q"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:banner</span> =&gt; <span style="font-style: italic;">"24.0"</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">"video encoding quality"</span>
  option <span style="font-weight: bold; text-decoration: underline;">:vbitrate</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"b"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:banner</span> =&gt; <span style="font-style: italic;">"1000"</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">"video bitrate in kbps"</span>
  option <span style="font-weight: bold; text-decoration: underline;">:aencoder</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"E"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:banner</span> =&gt; <span style="font-style: italic;">"fdk_aac"</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">"audio encoder"</span>
  option <span style="font-weight: bold; text-decoration: underline;">:aquality</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"Q"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:banner</span> =&gt; <span style="font-style: italic;">"100.0"</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">"audio encoding quality"</span>
  option <span style="font-weight: bold; text-decoration: underline;">:abitrate</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"B"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:banner</span> =&gt; <span style="font-style: italic;">"128"</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">"audio bitrate in kbps"</span>
  option <span style="font-weight: bold; text-decoration: underline;">:title</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">'t'</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:banner</span> =&gt; <span style="font-style: italic;">'1|2|3|...'</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">'title number'</span>
  option <span style="font-weight: bold; text-decoration: underline;">:chapters</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">'c'</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:banner</span> =&gt; <span style="font-style: italic;">'1|1-3|1,3,5|...'</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">'chapter numbers'</span>
  option <span style="font-weight: bold; text-decoration: underline;">:audio</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">'a'</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:banner</span> =&gt; <span style="font-style: italic;">'1,2,3'</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">'audio channel'</span>
  option <span style="font-weight: bold; text-decoration: underline;">:subtitle</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">'s'</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:banner</span> =&gt; <span style="font-style: italic;">'1,2'</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">'subtitle channel'</span>
  option <span style="font-weight: bold; text-decoration: underline;">:handbrake</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:banner</span> =&gt; <span style="font-style: italic;">'--handbrake \"--mixdown 5point1,stereo\"'</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">'HandBrakeCLI options'</span>
  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">dvdencode</span>()
    equip = <span style="font-weight: bold; text-decoration: underline;">Names</span>.new(options[<span style="font-weight: bold; text-decoration: underline;">:in</span>], options[<span style="font-weight: bold; text-decoration: underline;">:out</span>])
    commander = <span style="font-weight: bold; text-decoration: underline;">Commander</span>.new(options[<span style="font-weight: bold; text-decoration: underline;">:log</span>], options[<span style="font-weight: bold; text-decoration: underline;">:dryrun</span>])

    <span style="font-weight: bold;">if</span> <span style="font-weight: bold; text-decoration: underline;">FileType</span>.block_device?(equip.in_file) ||
       <span style="font-weight: bold; text-decoration: underline;">FileType</span>.video_dvd_image?(equip.in_file) ||
       <span style="font-weight: bold; text-decoration: underline;">FileType</span>.dvd_dir?(equip.in_file)
      configs = []
      configs &lt;&lt; <span style="font-weight: bold; text-decoration: underline;">VideoConfig</span>.new(options[<span style="font-weight: bold; text-decoration: underline;">:vencoder</span>], options[<span style="font-weight: bold; text-decoration: underline;">:vquality</span>], options[<span style="font-weight: bold; text-decoration: underline;">:vbitrate</span>])
      configs &lt;&lt; <span style="font-weight: bold; text-decoration: underline;">AudioConfig</span>.new(options[<span style="font-weight: bold; text-decoration: underline;">:aencoder</span>], options[<span style="font-weight: bold; text-decoration: underline;">:aquality</span>], options[<span style="font-weight: bold; text-decoration: underline;">:abitrate</span>])
      dconf = <span style="font-weight: bold; text-decoration: underline;">DVDConfig</span>.new
      dconf.title = options[<span style="font-weight: bold; text-decoration: underline;">:title</span>] <span style="font-weight: bold;">if</span> options[<span style="font-weight: bold; text-decoration: underline;">:title</span>]
      dconf.chapters = options[<span style="font-weight: bold; text-decoration: underline;">:chapters</span>] <span style="font-weight: bold;">if</span> options[<span style="font-weight: bold; text-decoration: underline;">:chapters</span>]
      dconf.audio = options[<span style="font-weight: bold; text-decoration: underline;">:audio</span>] <span style="font-weight: bold;">if</span> options[<span style="font-weight: bold; text-decoration: underline;">:audio</span>]
      dconf.subtitle = options[<span style="font-weight: bold; text-decoration: underline;">:subtitle</span>] <span style="font-weight: bold;">if</span> options[<span style="font-weight: bold; text-decoration: underline;">:subtitle</span>]
      configs &lt;&lt; dconf
      commander.execute(<span style="font-weight: bold; text-decoration: underline;">HandBrakeCLI</span>.command(equip.in_file,
                                             equip.out_file(<span style="font-weight: bold; text-decoration: underline;">DEFAULT_VIDEO_EXT</span>),
                                             configs,
                                             options[<span style="font-weight: bold; text-decoration: underline;">:handbrake</span>]))
    <span style="font-weight: bold;">end</span>
  <span style="font-weight: bold;">end</span>

  desc <span style="font-style: italic;">'mount &lt;dir&gt;'</span>, <span style="font-style: italic;">'Mount CD/DVD media to dir.'</span>
  option <span style="font-weight: bold; text-decoration: underline;">:device</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"d"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>, <span style="font-weight: bold; text-decoration: underline;">:required</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">true</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">'device or iso file to mount'</span>,
         <span style="font-weight: bold; text-decoration: underline;">:banner</span> =&gt; <span style="font-style: italic;">'--mount /dev/dvd|image.iso'</span>
  option <span style="font-weight: bold; text-decoration: underline;">:type</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">'t'</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">'mount DVD-Video'</span>,
         <span style="font-weight: bold; text-decoration: underline;">:banner</span> =&gt; <span style="font-style: italic;">'--type data|video'</span>
  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">mount</span>(dir)
    commander = <span style="font-weight: bold; text-decoration: underline;">Commander</span>.new(options[<span style="font-weight: bold; text-decoration: underline;">:log</span>], options[<span style="font-weight: bold; text-decoration: underline;">:dryrun</span>])

    cmd_opts = [<span style="font-style: italic;">'mount'</span>]
    <span style="font-weight: bold;">if</span> options[<span style="font-weight: bold; text-decoration: underline;">:type</span>] == <span style="font-style: italic;">'video'</span> || <span style="font-weight: bold; text-decoration: underline;">FileType</span>.video_dvd_image?(options[<span style="font-weight: bold; text-decoration: underline;">:device</span>])
      cmd_opts &lt;&lt; [<span style="font-style: italic;">'-t'</span>, <span style="font-style: italic;">'iso9660'</span>, <span style="font-style: italic;">'-o'</span>, <span style="font-style: italic;">'loop'</span>]
    <span style="font-weight: bold;">end</span>
    cmd_opts &lt;&lt; options[<span style="font-weight: bold; text-decoration: underline;">:device</span>]
    cmd_opts &lt;&lt; dir

    <span style="font-weight: bold; text-decoration: underline;">Dir</span>.mkdir(dir) <span style="font-weight: bold;">if</span> !<span style="font-weight: bold; text-decoration: underline;">Dir</span>.exist?(dir) &amp;&amp; !options[<span style="font-weight: bold; text-decoration: underline;">:dryrun</span>]
    commander.execute(<span style="font-style: italic;">"sudo </span><span style="font-weight: bold; font-style: italic;">#{cmd_opts.join(' ')}</span><span style="font-style: italic;">"</span>)
  <span style="font-weight: bold;">end</span>

  desc <span style="font-style: italic;">'umount'</span>, <span style="font-style: italic;">'unmount dir'</span>
  option <span style="font-weight: bold; text-decoration: underline;">:remove</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">'r'</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:boolean</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">'remove dir after unmounting'</span>
  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">umount</span>(dir)
    commander = <span style="font-weight: bold; text-decoration: underline;">Commander</span>.new(options[<span style="font-weight: bold; text-decoration: underline;">:log</span>], options[<span style="font-weight: bold; text-decoration: underline;">:dryrun</span>])

    cmd_opts = [<span style="font-style: italic;">'umount'</span>]
    cmd_opts &lt;&lt; dir

    commander.execute(<span style="font-style: italic;">"sudo </span><span style="font-weight: bold; font-style: italic;">#{cmd_opts.join(' ')}</span><span style="font-style: italic;">"</span>)

    <span style="font-weight: bold;">if</span> options[<span style="font-weight: bold; text-decoration: underline;">:remove</span>]
      <span style="font-weight: bold; text-decoration: underline;">FileUtils</span>.rmdir(dir)
    <span style="font-weight: bold;">end</span>
  <span style="font-weight: bold;">end</span>

  desc <span style="font-style: italic;">'mkiso'</span>, <span style="font-style: italic;">'make ISO image file.'</span>
  option <span style="font-weight: bold; text-decoration: underline;">:type</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">'t'</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>, <span style="font-weight: bold; text-decoration: underline;">:required</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">true</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">'DVD image type. Data or Video DVD.'</span>,
         <span style="font-weight: bold; text-decoration: underline;">:banner</span> =&gt; <span style="font-style: italic;">'--type data|video'</span>
  option <span style="font-weight: bold; text-decoration: underline;">:volume</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">'V'</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">'Volume Label'</span>
  option <span style="font-weight: bold; text-decoration: underline;">:out</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">'o'</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">'ISO image file name.'</span>,
         <span style="font-weight: bold; text-decoration: underline;">:banner</span> =&gt; <span style="font-style: italic;">'--out movie.iso'</span>
  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">mkiso</span>(file)
    names = <span style="font-weight: bold; text-decoration: underline;">Names</span>.new(file, options[<span style="font-weight: bold; text-decoration: underline;">:out</span>])
    commander = <span style="font-weight: bold; text-decoration: underline;">Commander</span>.new(options[<span style="font-weight: bold; text-decoration: underline;">:log</span>], options[<span style="font-weight: bold; text-decoration: underline;">:dryrun</span>])

    mkisofs_opts = [<span style="font-style: italic;">'mkisofs'</span>]
    mkisofs_opts &lt;&lt; [<span style="font-style: italic;">"-V"</span>, <span style="font-style: italic;">"\"</span><span style="font-weight: bold; font-style: italic;">#{options[:volume]}</span><span style="font-style: italic;">\""</span>] <span style="font-weight: bold;">if</span> options[<span style="font-weight: bold; text-decoration: underline;">:volume</span>]
    <span style="font-weight: bold;">if</span> options[<span style="font-weight: bold; text-decoration: underline;">:type</span>] == <span style="font-style: italic;">"data"</span>
      mkisofs_opts &lt;&lt; [<span style="font-style: italic;">"-r"</span>, <span style="font-style: italic;">"-l"</span>, <span style="font-style: italic;">"-J"</span>]
    <span style="font-weight: bold;">elsif</span> options[<span style="font-weight: bold; text-decoration: underline;">:type</span>]
      mkisofs_opts &lt;&lt; <span style="font-style: italic;">"-dvd-video"</span>
    <span style="font-weight: bold;">else</span>
      <span style="font-weight: bold;">exit</span> 1
    <span style="font-weight: bold;">end</span>
    mkisofs_opts &lt;&lt; [<span style="font-style: italic;">"-o"</span>, <span style="font-style: italic;">"\"</span><span style="font-weight: bold; font-style: italic;">#{names.out_file('.iso')}</span><span style="font-style: italic;">\""</span>]
    mkisofs_opts &lt;&lt; <span style="font-style: italic;">"\"</span><span style="font-weight: bold; font-style: italic;">#{file}</span><span style="font-style: italic;">\""</span>

    commander.execute(mkisofs_opts.join(<span style="font-style: italic;">" "</span>))
  <span style="font-weight: bold;">end</span>

  desc <span style="font-style: italic;">'dvdburn &lt;file&gt;'</span>, <span style="font-style: italic;">'Burn file to DVD.'</span>
  option <span style="font-weight: bold; text-decoration: underline;">:iso</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">'I'</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:boolean</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">'Set this option if &lt;file&gt; is ISO 9660 compliant.'</span>
  option <span style="font-weight: bold; text-decoration: underline;">:volume</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">'V'</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>, <span style="font-weight: bold; text-decoration: underline;">:default</span> =&gt; <span style="font-style: italic;">'DVD_VIDEO'</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">'Volume Label'</span>
  option <span style="font-weight: bold; text-decoration: underline;">:video</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">'v'</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:boolean</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">'Create DVD video image file to burn.'</span>
  option <span style="font-weight: bold; text-decoration: underline;">:speed</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">'s'</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>, <span style="font-weight: bold; text-decoration: underline;">:default</span> =&gt; <span style="font-style: italic;">'4'</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">'Burning Speed'</span>,
         <span style="font-weight: bold; text-decoration: underline;">:banner</span> =&gt; <span style="font-style: italic;">'n'</span>
  option <span style="font-weight: bold; text-decoration: underline;">:device</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">'d'</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">'Device file'</span>, <span style="font-weight: bold; text-decoration: underline;">:default</span> =&gt; <span style="font-style: italic;">'/dev/sr0'</span>
  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">dvdburn</span>(file)
    commander = <span style="font-weight: bold; text-decoration: underline;">Commander</span>.new(options[<span style="font-weight: bold; text-decoration: underline;">:log</span>], options[<span style="font-weight: bold; text-decoration: underline;">:dryrun</span>])

    cmd_opts = [<span style="font-style: italic;">'growisofs'</span>]
    cmd_opts &lt;&lt; <span style="font-style: italic;">'-dvd-compat'</span>
    cmd_opts &lt;&lt; <span style="font-style: italic;">'-speed=%s'</span> % options[<span style="font-weight: bold; text-decoration: underline;">:speed</span>]
    <span style="font-weight: bold;">if</span> <span style="font-weight: bold; text-decoration: underline;">FileType</span>.iso9660?(file) || options[<span style="font-weight: bold; text-decoration: underline;">:iso</span>]
      cmd_opts &lt;&lt; <span style="font-style: italic;">'-Z %s=%s'</span> % [options[<span style="font-weight: bold; text-decoration: underline;">:device</span>], file]
    <span style="font-weight: bold;">else</span>
      cmd_opts &lt;&lt; <span style="font-style: italic;">'-Z %s'</span> % options[<span style="font-weight: bold; text-decoration: underline;">:device</span>]
      mkisofs_opts = []
      mkisofs_opts &lt;&lt; [<span style="font-style: italic;">'-V'</span>, <span style="font-style: italic;">"\"</span><span style="font-weight: bold; font-style: italic;">#{options[:volume]}</span><span style="font-style: italic;">\""</span>] <span style="font-weight: bold;">if</span> options[<span style="font-weight: bold; text-decoration: underline;">:volume</span>]
      <span style="font-weight: bold;">if</span> options[<span style="font-weight: bold; text-decoration: underline;">:video</span>]
        mkisofs_opts &lt;&lt; <span style="font-style: italic;">'-dvd-video'</span>
      <span style="font-weight: bold;">else</span> <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Data-DVD</span>
        mkisofs_opts &lt;&lt; [<span style="font-style: italic;">'-r'</span>, <span style="font-style: italic;">'-l'</span>, <span style="font-style: italic;">'-R'</span>]
      <span style="font-weight: bold;">end</span>
      mkisofs_opts &lt;&lt; file
      cmd_opts &lt;&lt; mkisofs_opts
    <span style="font-weight: bold;">end</span>

    commander.execute(cmd_opts.join(<span style="font-style: italic;">' '</span>))
  <span style="font-weight: bold;">end</span>

  desc <span style="font-style: italic;">"cdburn"</span>, <span style="font-style: italic;">"burn files to CD device"</span>
  option <span style="font-weight: bold; text-decoration: underline;">:in</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"i"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>, <span style="font-weight: bold; text-decoration: underline;">:required</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">true</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">"Root Directory for image file"</span>
  option <span style="font-weight: bold; text-decoration: underline;">:volume</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"v"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>, <span style="font-weight: bold; text-decoration: underline;">:required</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">true</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">"Volume ID"</span>
  option <span style="font-weight: bold; text-decoration: underline;">:device</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"d"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">"Device file"</span>, <span style="font-weight: bold; text-decoration: underline;">:default</span> =&gt; <span style="font-style: italic;">"/dev/sr0"</span>
  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">cdburn</span>()
    commander = <span style="font-weight: bold; text-decoration: underline;">Commander</span>.new(options[<span style="font-weight: bold; text-decoration: underline;">:log</span>], options[<span style="font-weight: bold; text-decoration: underline;">:dryrun</span>])

    commander.execute(<span style="font-style: italic;">"mkisofs -V \"</span><span style="font-weight: bold; font-style: italic;">#{options[:volume]}</span><span style="font-style: italic;">\" -J -r </span><span style="font-weight: bold; font-style: italic;">#{options[:in]}</span><span style="font-style: italic;"> | cdrecord -v dev=</span><span style="font-weight: bold; font-style: italic;">#{options[:device]}</span><span style="font-style: italic;"> -waiti -"</span>)
  <span style="font-weight: bold;">end</span>

  desc <span style="font-style: italic;">"screenshot"</span>, <span style="font-style: italic;">"take a screenshot of a video at a time"</span>
  option <span style="font-weight: bold; text-decoration: underline;">:in</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"i"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>, <span style="font-weight: bold; text-decoration: underline;">:required</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">true</span>
  option <span style="font-weight: bold; text-decoration: underline;">:out</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"o"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>
  option <span style="font-weight: bold; text-decoration: underline;">:time</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"t"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">"ex. 00:10:22.300"</span>
  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">screenshot</span>()
    equip = <span style="font-weight: bold; text-decoration: underline;">Names</span>.new(options[<span style="font-weight: bold; text-decoration: underline;">:in</span>], options[<span style="font-weight: bold; text-decoration: underline;">:out</span>])
    commander = <span style="font-weight: bold; text-decoration: underline;">Commander</span>.new(options[<span style="font-weight: bold; text-decoration: underline;">:log</span>], options[<span style="font-weight: bold; text-decoration: underline;">:dryrun</span>])
    <span style="font-weight: bold;">if</span> <span style="font-weight: bold; text-decoration: underline;">FileType</span>.video?(equip.in_file) <span style="font-weight: bold;">then</span>
      args = [<span style="font-style: italic;">'ffmpeg'</span>]
      args &lt;&lt; (<span style="font-style: italic;">'-ss %s'</span> % options[<span style="font-weight: bold; text-decoration: underline;">:time</span>]) <span style="font-weight: bold;">if</span> options[<span style="font-weight: bold; text-decoration: underline;">:time</span>]
      args &lt;&lt; <span style="font-style: italic;">'-i %s'</span> % equip.in_file
      args &lt;&lt; <span style="font-style: italic;">'-vframes 1'</span>
      args &lt;&lt; <span style="font-style: italic;">'-q:v 2'</span>
      args &lt;&lt; equip.out_file(<span style="font-style: italic;">'.jpg'</span>)
      commander.execute(args.join(<span style="font-style: italic;">' '</span>))
    <span style="font-weight: bold;">end</span>
  <span style="font-weight: bold;">end</span>

  desc <span style="font-style: italic;">"clip"</span>, <span style="font-style: italic;">"clip a video with specific time span"</span>
  option <span style="font-weight: bold; text-decoration: underline;">:in</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"i"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>, <span style="font-weight: bold; text-decoration: underline;">:required</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">true</span>
  option <span style="font-weight: bold; text-decoration: underline;">:out</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"o"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>
  option <span style="font-weight: bold; text-decoration: underline;">:time_begin</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"b"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">"ex. 00:10:22.300"</span>
  option <span style="font-weight: bold; text-decoration: underline;">:time_end</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"e"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>
  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">clip</span>()
    equip = <span style="font-weight: bold; text-decoration: underline;">Names</span>.new(options[<span style="font-weight: bold; text-decoration: underline;">:in</span>], options[<span style="font-weight: bold; text-decoration: underline;">:out</span>])
    commander = <span style="font-weight: bold; text-decoration: underline;">Commander</span>.new(options[<span style="font-weight: bold; text-decoration: underline;">:log</span>], options[<span style="font-weight: bold; text-decoration: underline;">:dryrun</span>])

    <span style="font-weight: bold;">if</span> <span style="font-weight: bold; text-decoration: underline;">FileType</span>.video?(equip.in_file) <span style="font-weight: bold;">then</span>
      <span style="font-weight: bold;">if</span> options[<span style="font-weight: bold; text-decoration: underline;">:time_begin</span>] <span style="font-weight: bold;">or</span> options[<span style="font-weight: bold; text-decoration: underline;">:time_end</span>] <span style="font-weight: bold;">then</span>
        in_opts = []
        in_opts &lt;&lt; <span style="font-style: italic;">"-ss </span><span style="font-weight: bold; font-style: italic;">#{options[:time_begin]}</span><span style="font-style: italic;">"</span> <span style="font-weight: bold;">if</span> options[<span style="font-weight: bold; text-decoration: underline;">:time_begin</span>]
        in_opts &lt;&lt; <span style="font-style: italic;">"-to </span><span style="font-weight: bold; font-style: italic;">#{options[:time_end]}</span><span style="font-style: italic;">"</span> <span style="font-weight: bold;">if</span> options[<span style="font-weight: bold; text-decoration: underline;">:time_end</span>]
        out_opts = []
        out_opts &lt;&lt; <span style="font-style: italic;">"-vcodec copy"</span>
        out_opts &lt;&lt; <span style="font-style: italic;">"-acodec copy"</span>
        out_opts &lt;&lt; <span style="font-style: italic;">"-map_metadata 0"</span>
        commander.execute(<span style="font-weight: bold; text-decoration: underline;">FFMPEG</span>.command([<span style="font-weight: bold; text-decoration: underline;">FFMPEGOptSet</span>.new(equip.in_file, in_opts)],
                                         [<span style="font-weight: bold; text-decoration: underline;">FFMPEGOptSet</span>.new(equip.out_file, out_opts)]))
      <span style="font-weight: bold;">end</span>
    <span style="font-weight: bold;">else</span>
      <span style="font-weight: bold; text-decoration: underline;">STDERR</span>.puts <span style="font-style: italic;">"This Media Format is not supported on this function"</span>
      <span style="font-weight: bold;">exit</span> <span style="font-weight: bold; text-decoration: underline;">false</span>
    <span style="font-weight: bold;">end</span>
  <span style="font-weight: bold;">end</span>

  desc <span style="font-style: italic;">"crop"</span>, <span style="font-style: italic;">"extract a specific rectangle of a image/video"</span>
  option <span style="font-weight: bold; text-decoration: underline;">:in</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"i"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>, <span style="font-weight: bold; text-decoration: underline;">:required</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">true</span>
  option <span style="font-weight: bold; text-decoration: underline;">:out</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"o"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>
  option <span style="font-weight: bold; text-decoration: underline;">:width</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"w"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:numeric</span>, <span style="font-weight: bold; text-decoration: underline;">:required</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">true</span>
  option <span style="font-weight: bold; text-decoration: underline;">:height</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"h"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:numeric</span>, <span style="font-weight: bold; text-decoration: underline;">:required</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">true</span>
  option <span style="font-weight: bold; text-decoration: underline;">:xpos</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"x"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:numeric</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">"x coordinate of an original image where cropped image of top-left corner overlaps"</span>
  option <span style="font-weight: bold; text-decoration: underline;">:ypos</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"y"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:numeric</span>
  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">crop</span>()
    names = <span style="font-weight: bold; text-decoration: underline;">Names</span>.new(options[<span style="font-weight: bold; text-decoration: underline;">:in</span>], options[<span style="font-weight: bold; text-decoration: underline;">:out</span>])
    commander = <span style="font-weight: bold; text-decoration: underline;">Commander</span>.new(options[<span style="font-weight: bold; text-decoration: underline;">:log</span>], options[<span style="font-weight: bold; text-decoration: underline;">:dryrun</span>])

    width = options[<span style="font-weight: bold; text-decoration: underline;">:width</span>]
    height = options[<span style="font-weight: bold; text-decoration: underline;">:height</span>]
    xpos = options[<span style="font-weight: bold; text-decoration: underline;">:xpos</span>] ? options[<span style="font-weight: bold; text-decoration: underline;">:xpos</span>] : 0
    ypos = options[<span style="font-weight: bold; text-decoration: underline;">:ypos</span>] ? options[<span style="font-weight: bold; text-decoration: underline;">:ypos</span>] : 0
    <span style="font-weight: bold;">if</span> <span style="font-weight: bold; text-decoration: underline;">FileType</span>.image?(names.in_file) <span style="font-weight: bold;">then</span>
      opt = <span style="font-style: italic;">'-crop %dx%d+%dx%d'</span> % [width, height, xpos, ypos]
      commander.execute(<span style="font-style: italic;">"convert </span><span style="font-weight: bold; font-style: italic;">#{opt}</span><span style="font-style: italic;"> </span><span style="font-weight: bold; font-style: italic;">#{names.in_file}</span><span style="font-style: italic;"> </span><span style="font-weight: bold; font-style: italic;">#{names.out_file}</span><span style="font-style: italic;">"</span>)
    <span style="font-weight: bold;">elsif</span> <span style="font-weight: bold; text-decoration: underline;">FileType</span>.video?(names.in_file) <span style="font-weight: bold;">then</span>
      args = [<span style="font-style: italic;">'ffmpeg'</span>]
      args &lt;&lt; <span style="font-style: italic;">'-i %s'</span> % names.in_file
      args &lt;&lt; <span style="font-style: italic;">'-vf crop=%d:%d:%d:%d'</span> % [width, height, xpos, ypos]
      args &lt;&lt; <span style="font-style: italic;">"-map_metadata 0"</span>
      args &lt;&lt; names.out_file
      commander.execute(args.join(<span style="font-style: italic;">' '</span>))
    <span style="font-weight: bold;">else</span>
      <span style="font-weight: bold; text-decoration: underline;">STDERR</span>.puts <span style="font-style: italic;">"This Media Format is not supported on this function"</span>
      <span style="font-weight: bold;">exit</span> <span style="font-weight: bold; text-decoration: underline;">false</span>
    <span style="font-weight: bold;">end</span>
  <span style="font-weight: bold;">end</span>

  desc <span style="font-style: italic;">"trim"</span>, <span style="font-style: italic;">"trim a image/video with automated detection"</span>
  option <span style="font-weight: bold; text-decoration: underline;">:in</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"i"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>, <span style="font-weight: bold; text-decoration: underline;">:required</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">true</span>
  option <span style="font-weight: bold; text-decoration: underline;">:out</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"o"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>
  option <span style="font-weight: bold; text-decoration: underline;">:threshold</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"t"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">"threshold where trimming begin and end"</span>
  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">trim</span>()
    names = <span style="font-weight: bold; text-decoration: underline;">Names</span>.new(options[<span style="font-weight: bold; text-decoration: underline;">:in</span>], options[<span style="font-weight: bold; text-decoration: underline;">:out</span>])
    commander = <span style="font-weight: bold; text-decoration: underline;">Commander</span>.new(options[<span style="font-weight: bold; text-decoration: underline;">:log</span>], options[<span style="font-weight: bold; text-decoration: underline;">:dryrun</span>])

    <span style="font-weight: bold;">if</span> <span style="font-weight: bold; text-decoration: underline;">FileType</span>.image?(names.in_file) <span style="font-weight: bold;">then</span>
      commander.execute(<span style="font-style: italic;">"convert -trim </span><span style="font-weight: bold; font-style: italic;">#{names.in_file}</span><span style="font-style: italic;"> </span><span style="font-weight: bold; font-style: italic;">#{names.out_file}</span><span style="font-style: italic;">"</span>)
    <span style="font-weight: bold;">elsif</span> <span style="font-weight: bold; text-decoration: underline;">FileType</span>.audio?(names.in_file) <span style="font-weight: bold;">then</span>
      threshold = (options[<span style="font-weight: bold; text-decoration: underline;">:threshold</span>]) ? options[<span style="font-weight: bold; text-decoration: underline;">:threshold</span>] : <span style="font-style: italic;">"-40dB"</span>
      commander.execute(<span style="font-style: italic;">"ffmpeg -i </span><span style="font-weight: bold; font-style: italic;">#{names.in_file}</span><span style="font-style: italic;"> -af \"silenceremove=start_periods=1:start_duration=0:start_threshold=</span><span style="font-weight: bold; font-style: italic;">#{threshold}</span><span style="font-style: italic;">:detection=peak\" </span><span style="font-weight: bold; font-style: italic;">#{names.out_file}</span><span style="font-style: italic;">"</span>)
    <span style="font-weight: bold;">end</span>
  <span style="font-weight: bold;">end</span>

  desc <span style="font-style: italic;">"resize"</span>, <span style="font-style: italic;">"resize the image"</span>
  option <span style="font-weight: bold; text-decoration: underline;">:in</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"i"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>, <span style="font-weight: bold; text-decoration: underline;">:required</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">true</span>
  option <span style="font-weight: bold; text-decoration: underline;">:out</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"o"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>
  option <span style="font-weight: bold; text-decoration: underline;">:width</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"w"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:banner</span> =&gt; <span style="font-style: italic;">"e.g. 300"</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">"resized image width"</span>
  option <span style="font-weight: bold; text-decoration: underline;">:height</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"h"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:banner</span> =&gt; <span style="font-style: italic;">"e.g. 200"</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">"resized image height"</span>
  option <span style="font-weight: bold; text-decoration: underline;">:operation</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"p"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:banner</span> =&gt; <span style="font-style: italic;">"enlarge|shrink"</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">"permitted operation for resizing"</span>
  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">resize</span>()
    names = <span style="font-weight: bold; text-decoration: underline;">Names</span>.new(options[<span style="font-weight: bold; text-decoration: underline;">:in</span>], options[<span style="font-weight: bold; text-decoration: underline;">:out</span>])
    commander = <span style="font-weight: bold; text-decoration: underline;">Commander</span>.new(options[<span style="font-weight: bold; text-decoration: underline;">:log</span>], options[<span style="font-weight: bold; text-decoration: underline;">:dryrun</span>])

    <span style="font-weight: bold;">if</span> <span style="font-weight: bold; text-decoration: underline;">FileType</span>.video?(names.in_file) <span style="font-weight: bold;">then</span>
      <span style="font-weight: bold;">if</span> options[<span style="font-weight: bold; text-decoration: underline;">:width</span>] <span style="font-weight: bold;">and</span> options[<span style="font-weight: bold; text-decoration: underline;">:height</span>]
        out_opts = []
        out_opts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"-vf scale=%s:%s,setsar=1:1"</span>, options[<span style="font-weight: bold; text-decoration: underline;">:width</span>], options[<span style="font-weight: bold; text-decoration: underline;">:height</span>])
        commander.execute(<span style="font-weight: bold; text-decoration: underline;">FFMPEG</span>.command([<span style="font-weight: bold; text-decoration: underline;">FFMPEGOptSet</span>.new(names.in_file, [])],
                                         [<span style="font-weight: bold; text-decoration: underline;">FFMPEGOptSet</span>.new(names.out_file, out_opts)]))
      <span style="font-weight: bold;">end</span>
    <span style="font-weight: bold;">elsif</span> <span style="font-weight: bold; text-decoration: underline;">FileType</span>.image?(names.in_file) <span style="font-weight: bold;">then</span>
      <span style="font-weight: bold;">return</span> <span style="font-weight: bold;">if</span> options[<span style="font-weight: bold; text-decoration: underline;">:width</span>] == <span style="font-weight: bold; text-decoration: underline;">nil</span> &amp;&amp; options[<span style="font-weight: bold; text-decoration: underline;">:height</span>] == <span style="font-weight: bold; text-decoration: underline;">nil</span>
      <span style="font-weight: bold;">if</span> options[<span style="font-weight: bold; text-decoration: underline;">:operation</span>] == <span style="font-style: italic;">"enlarge"</span>
        op = <span style="font-style: italic;">"&lt;"</span>
      <span style="font-weight: bold;">elsif</span> options[<span style="font-weight: bold; text-decoration: underline;">:operation</span>] == <span style="font-style: italic;">"shrink"</span>
        op = <span style="font-style: italic;">"&gt;"</span>
      <span style="font-weight: bold;">else</span>
        op = <span style="font-style: italic;">""</span>
      <span style="font-weight: bold;">end</span>
      geometry = <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"%sx%s%s"</span>, options[<span style="font-weight: bold; text-decoration: underline;">:width</span>], options[<span style="font-weight: bold; text-decoration: underline;">:height</span>], op)
      commander.execute(<span style="font-style: italic;">"convert -resize </span><span style="font-weight: bold; font-style: italic;">#{geometry}</span><span style="font-style: italic;"> </span><span style="font-weight: bold; font-style: italic;">#{names.in_file}</span><span style="font-style: italic;"> </span><span style="font-weight: bold; font-style: italic;">#{names.out_file}</span><span style="font-style: italic;">"</span>)
    <span style="font-weight: bold;">end</span>
  <span style="font-weight: bold;">end</span>

  desc <span style="font-style: italic;">"concat"</span>, <span style="font-style: italic;">"concat multiple files"</span>
  option <span style="font-weight: bold; text-decoration: underline;">:in</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"i"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:array</span>, <span style="font-weight: bold; text-decoration: underline;">:required</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">true</span>
  option <span style="font-weight: bold; text-decoration: underline;">:out</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"o"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>
  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">concat</span>()
    names = <span style="font-weight: bold; text-decoration: underline;">Names</span>.new(options[<span style="font-weight: bold; text-decoration: underline;">:in</span>][0], options[<span style="font-weight: bold; text-decoration: underline;">:out</span>])
    commander = <span style="font-weight: bold; text-decoration: underline;">Commander</span>.new(options[<span style="font-weight: bold; text-decoration: underline;">:log</span>], options[<span style="font-weight: bold; text-decoration: underline;">:dryrun</span>])

    srcs = options[<span style="font-weight: bold; text-decoration: underline;">:in</span>]
    output = names.out_file

    <span style="font-weight: bold;">if</span> srcs.all? { |src| <span style="font-weight: bold; text-decoration: underline;">FileType</span>.video?(src) }
      src_list = <span style="font-style: italic;">""</span>
      src_file = <span style="font-weight: bold; text-decoration: underline;">Tempfile</span>.open()
      chap_file = <span style="font-weight: bold; text-decoration: underline;">Tempfile</span>.open()
      chap_file.write(<span style="font-style: italic;">"### Create Chapterfile ###\n"</span>)
      files_to_remove = []
      time_accumulated = <span style="font-weight: bold; text-decoration: underline;">Time</span>.new(0)
      srcs.each_with_index <span style="font-weight: bold;">do</span> |src, index|
        valid_src =
          <span style="font-weight: bold;">if</span> src =~ <span style="font-style: italic;">/^\p{Ascii}+$/</span>
            src
          <span style="font-weight: bold;">else</span>
            <span style="font-weight: bold; text-decoration: underline;">Dir</span>::<span style="font-weight: bold; text-decoration: underline;">Tmpname</span>.create(<span style="font-style: italic;">'base'</span>) <span style="font-weight: bold;">do</span> |src_dup|
              <span style="font-weight: bold; text-decoration: underline;">FileUtils</span>.cp(src, src_dup)
              files_to_remove &lt;&lt; src_dup
              src_dup
            <span style="font-weight: bold;">end</span>
          <span style="font-weight: bold;">end</span>
        src_file.write(<span style="font-style: italic;">"file '</span><span style="font-weight: bold; font-style: italic;">#{File.expand_path(valid_src)}</span><span style="font-style: italic;">'\n"</span>)
        chap_file.write(<span style="font-style: italic;">"CHAPTER</span><span style="font-weight: bold; font-style: italic;">#{index + 1}</span><span style="font-style: italic;">=</span><span style="font-weight: bold; font-style: italic;">#{time_accumulated.strftime('%H:%M:%S.%L')}</span><span style="font-style: italic;">\n"</span>)
        chap_file.write(<span style="font-style: italic;">"CHAPTER</span><span style="font-weight: bold; font-style: italic;">#{index + 1}</span><span style="font-style: italic;">NAME=</span><span style="font-weight: bold; font-style: italic;">#{File.basename(src, File.extname(src))}</span><span style="font-style: italic;">\n"</span>)
        duration = <span style="font-style: italic;">`ffprobe -v error -show_entries format=duration -of default=noprint_wrappers=1:nokey=1 "</span><span style="font-weight: bold; font-style: italic;">#{src}</span><span style="font-style: italic;">"`</span>.strip().to_f()
        time_accumulated += duration
      <span style="font-weight: bold;">end</span>
      src_file.flush
      commander.execute(<span style="font-style: italic;">"ffmpeg -n -f concat -safe 0 -i </span><span style="font-weight: bold; font-style: italic;">#{src_file.path}</span><span style="font-style: italic;"> -c:v copy -c:a copy -c:s copy -map 0:v -map 0:a -map 0:s? </span><span style="font-weight: bold; font-style: italic;">#{output}</span><span style="font-style: italic;">"</span>)
      src_file.close
      chap_file.flush
      commander.execute(<span style="font-style: italic;">"MP4Box -chap </span><span style="font-weight: bold; font-style: italic;">#{chap_file.path}</span><span style="font-style: italic;"> </span><span style="font-weight: bold; font-style: italic;">#{output}</span><span style="font-style: italic;">"</span>)
      chap_file.close
      src_file.unlink
      chap_file.unlink
      <span style="font-weight: bold; text-decoration: underline;">FileUtils</span>.rm_f(files_to_remove)
    <span style="font-weight: bold;">elsif</span> srcs.all? { |src| <span style="font-weight: bold; text-decoration: underline;">FileType</span>.image?(src) }
      commander.execute <span style="font-style: italic;">"convert </span><span style="font-weight: bold; font-style: italic;">#{srcs.join(' ')}</span><span style="font-style: italic;"> </span><span style="font-weight: bold; font-style: italic;">#{output}</span><span style="font-style: italic;">"</span>
    <span style="font-weight: bold;">else</span>
      <span style="font-weight: bold; text-decoration: underline;">STDERR</span>.puts <span style="font-style: italic;">"This Media Format is not supported on this function"</span>
      <span style="font-weight: bold;">exit</span> <span style="font-weight: bold; text-decoration: underline;">false</span>
    <span style="font-weight: bold;">end</span>
  <span style="font-weight: bold;">end</span>

  desc <span style="font-style: italic;">"diff"</span>, <span style="font-style: italic;">"measure the difference by providing SSIM value"</span>
  option <span style="font-weight: bold; text-decoration: underline;">:out</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"o"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>
  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">diff</span>(file1, file2)
    commander = <span style="font-weight: bold; text-decoration: underline;">Commander</span>.new(options[<span style="font-weight: bold; text-decoration: underline;">:log</span>], options[<span style="font-weight: bold; text-decoration: underline;">:dryrun</span>])

    <span style="font-weight: bold;">if</span> ((<span style="font-weight: bold; text-decoration: underline;">FileType</span>.video?(file1) <span style="font-weight: bold;">and</span> <span style="font-weight: bold; text-decoration: underline;">FileType</span>.video?(file2)) <span style="font-weight: bold;">or</span>
        (<span style="font-weight: bold; text-decoration: underline;">FileType</span>.image?(file1) <span style="font-weight: bold;">and</span> <span style="font-weight: bold; text-decoration: underline;">FileType</span>.image?(file2))) <span style="font-weight: bold;">then</span>
      <span style="font-weight: bold;">if</span> options[<span style="font-weight: bold; text-decoration: underline;">:out</span>] <span style="font-weight: bold;">then</span>
        commander.execute(<span style="font-style: italic;">"ffmpeg -i </span><span style="font-weight: bold; font-style: italic;">#{file1}</span><span style="font-style: italic;"> -i </span><span style="font-weight: bold; font-style: italic;">#{file2}</span><span style="font-style: italic;"> -filter_complex ssim=</span><span style="font-weight: bold; font-style: italic;">#{options[:out]}</span><span style="font-style: italic;"> -an -f null -"</span>)
      <span style="font-weight: bold;">else</span>
        commander.execute(<span style="font-style: italic;">"ffmpeg -i </span><span style="font-weight: bold; font-style: italic;">#{file1}</span><span style="font-style: italic;"> -i </span><span style="font-weight: bold; font-style: italic;">#{file2}</span><span style="font-style: italic;"> -filter_complex ssim -an -f null -"</span>)
      <span style="font-weight: bold;">end</span>
    <span style="font-weight: bold;">end</span>
  <span style="font-weight: bold;">end</span>

  desc <span style="font-style: italic;">"mux"</span>, <span style="font-style: italic;">"mux to one file which has streams correspond with input files"</span>
  option <span style="font-weight: bold; text-decoration: underline;">:video</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"v"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>, <span style="font-weight: bold; text-decoration: underline;">:required</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">true</span>
  option <span style="font-weight: bold; text-decoration: underline;">:audio</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"a"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>, <span style="font-weight: bold; text-decoration: underline;">:required</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">true</span>
  option <span style="font-weight: bold; text-decoration: underline;">:audio_delay</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"d"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>
  option <span style="font-weight: bold; text-decoration: underline;">:out</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"o"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>
  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">mux</span>()
    names = <span style="font-weight: bold; text-decoration: underline;">Names</span>.new(options[<span style="font-weight: bold; text-decoration: underline;">:video</span>], options[<span style="font-weight: bold; text-decoration: underline;">:out</span>])
    commander = <span style="font-weight: bold; text-decoration: underline;">Commander</span>.new(options[<span style="font-weight: bold; text-decoration: underline;">:log</span>], options[<span style="font-weight: bold; text-decoration: underline;">:dryrun</span>])

    in_optsets = []
    in_optsets &lt;&lt; <span style="font-weight: bold; text-decoration: underline;">FFMPEGOptSet</span>.new(options[<span style="font-weight: bold; text-decoration: underline;">:video</span>], [])
    aconf = []
    aconf &lt;&lt; <span style="font-style: italic;">"-itsoffset </span><span style="font-weight: bold; font-style: italic;">#{options[:audio_delay]}</span><span style="font-style: italic;">"</span> <span style="font-weight: bold;">if</span> options[<span style="font-weight: bold; text-decoration: underline;">:audio_delay</span>]
    in_optsets &lt;&lt; <span style="font-weight: bold; text-decoration: underline;">FFMPEGOptSet</span>.new(options[<span style="font-weight: bold; text-decoration: underline;">:audio</span>], aconf)
    commander.execute(<span style="font-weight: bold; text-decoration: underline;">FFMPEG</span>.command(in_optsets,
                                     [<span style="font-weight: bold; text-decoration: underline;">FFMPEGOptSet</span>.new(names.out_file, [])]))
  <span style="font-weight: bold;">end</span>
<span style="font-weight: bold;">end</span>

<span style="font-weight: bold;">class</span> <span style="font-weight: bold; text-decoration: underline;">MainConfig</span>
  <span style="font-weight: bold;">attr_accessor</span> <span style="font-weight: bold; text-decoration: underline;">:start</span>, <span style="font-weight: bold; text-decoration: underline;">:end</span>
<span style="font-weight: bold;">end</span>

<span style="font-weight: bold;">class</span> <span style="font-weight: bold; text-decoration: underline;">VideoConfig</span>
  <span style="font-weight: bold;">attr_accessor</span> <span style="font-weight: bold; text-decoration: underline;">:encode</span>, <span style="font-weight: bold; text-decoration: underline;">:quality</span>, <span style="font-weight: bold; text-decoration: underline;">:bitrate</span>, <span style="font-weight: bold; text-decoration: underline;">:preset</span>, <span style="font-weight: bold; text-decoration: underline;">:tune</span>, <span style="font-weight: bold; text-decoration: underline;">:profile</span>, <span style="font-weight: bold; text-decoration: underline;">:level</span>

  <span style="font-weight: bold; text-decoration: underline;">DEFAULT_ENCODE</span> = <span style="font-style: italic;">'vp9'</span>
  <span style="font-weight: bold; text-decoration: underline;">DEFAULT_QUALITY</span> = <span style="font-style: italic;">'26'</span>
  <span style="font-weight: bold; text-decoration: underline;">DEFAULT_BITRATE</span> = <span style="font-style: italic;">'1000'</span>

  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">initialize</span>(encode, quality=<span style="font-weight: bold; text-decoration: underline;">nil</span>, bitrate=<span style="font-weight: bold; text-decoration: underline;">nil</span>)
    <span style="font-weight: bold; font-style: italic;">@encode</span> = encode
    <span style="font-weight: bold; font-style: italic;">@quality</span> = quality
    <span style="font-weight: bold; font-style: italic;">@bitrate</span> = bitrate

    <span style="font-weight: bold;">case</span> <span style="font-weight: bold; font-style: italic;">@encode</span>
    <span style="font-weight: bold;">when</span> <span style="font-style: italic;">"x265"</span>
      <span style="font-weight: bold; font-style: italic;">@preset</span> = <span style="font-style: italic;">"veryslow"</span>
      <span style="font-weight: bold; font-style: italic;">@tune</span> = <span style="font-style: italic;">"ssim"</span>
      <span style="font-weight: bold; font-style: italic;">@profile</span> = <span style="font-style: italic;">"main"</span>
      <span style="font-weight: bold; font-style: italic;">@level</span> = <span style="font-weight: bold; text-decoration: underline;">nil</span>
    <span style="font-weight: bold;">when</span> <span style="font-style: italic;">"x264"</span>
      <span style="font-weight: bold; font-style: italic;">@preset</span> = <span style="font-style: italic;">"veryslow"</span>
      <span style="font-weight: bold; font-style: italic;">@tune</span> = <span style="font-style: italic;">"film"</span>
      <span style="font-weight: bold; font-style: italic;">@profile</span> = <span style="font-style: italic;">"main"</span>
      <span style="font-weight: bold; font-style: italic;">@level</span> = <span style="font-style: italic;">"4.1"</span>
    <span style="font-weight: bold;">end</span>
  <span style="font-weight: bold;">end</span>
<span style="font-weight: bold;">end</span>

<span style="font-weight: bold;">class</span> <span style="font-weight: bold; text-decoration: underline;">PictureConfig</span>
  <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">conversion options</span>
  <span style="font-weight: bold;">attr_accessor</span> <span style="font-weight: bold; text-decoration: underline;">:vf_opts</span>, <span style="font-weight: bold; text-decoration: underline;">:fps</span>

  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">initialize</span>()
    <span style="font-weight: bold; font-style: italic;">@vf_opts</span> = []
    <span style="font-weight: bold; font-style: italic;">@vf_opts</span> &lt;&lt; <span style="font-style: italic;">"format=yuv420p"</span>
  <span style="font-weight: bold;">end</span>

  <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">down-size to fit to display (width:heigh) in keeping aspect ratio</span>
  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">fit_size</span>(display_size)
    <span style="font-weight: bold; font-style: italic;">@vf_opts</span> &lt;&lt; <span style="font-style: italic;">"scale=</span><span style="font-weight: bold; font-style: italic;">#{display_size}</span><span style="font-style: italic;">:force_original_aspect_ratio=decrease"</span>
    <span style="font-weight: bold; font-style: italic;">@vf_opts</span> &lt;&lt; <span style="font-style: italic;">"pad=((iw+1)/2)*2:((ih+1)/2)*2"</span> <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">avoid width/height to odd</span>
  <span style="font-weight: bold;">end</span>

  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">decrease_framerate</span>(fps)
    <span style="font-weight: bold; font-style: italic;">@fps</span> = fps
  <span style="font-weight: bold;">end</span>
<span style="font-weight: bold;">end</span>

<span style="font-weight: bold;">class</span> <span style="font-weight: bold; text-decoration: underline;">AudioConfig</span>
  <span style="font-weight: bold;">attr_accessor</span> <span style="font-weight: bold; text-decoration: underline;">:encode</span>, <span style="font-weight: bold; text-decoration: underline;">:quality</span>, <span style="font-weight: bold; text-decoration: underline;">:bitrate</span>

  <span style="font-weight: bold; text-decoration: underline;">DEFAULT_ENCODE</span> = <span style="font-style: italic;">'opus'</span>
  <span style="font-weight: bold; text-decoration: underline;">DEFAULT_QUALITY</span> = <span style="font-style: italic;">'100'</span>
  <span style="font-weight: bold; text-decoration: underline;">DEFAULT_BITRATE</span> = <span style="font-style: italic;">'128'</span>

  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">initialize</span>(encode, quality=<span style="font-weight: bold; text-decoration: underline;">nil</span>, bitrate=<span style="font-weight: bold; text-decoration: underline;">nil</span>)
    <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">@encode = (encode ? encode : DEFAULT_ENCODE)</span>
    <span style="font-weight: bold; font-style: italic;">@encode</span> = encode
    <span style="font-weight: bold; font-style: italic;">@quality</span> = quality
    <span style="font-weight: bold; font-style: italic;">@bitrate</span> = bitrate
  <span style="font-weight: bold;">end</span>

  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">quality</span>
    <span style="font-weight: bold;">case</span> <span style="font-weight: bold; font-style: italic;">@encode</span>
    <span style="font-weight: bold;">when</span> <span style="font-style: italic;">'opus'</span>
    <span style="font-weight: bold;">else</span>
      <span style="font-weight: bold; font-style: italic;">@quality</span>
    <span style="font-weight: bold;">end</span>
  <span style="font-weight: bold;">end</span>

  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">bitrate</span>
    <span style="font-weight: bold;">case</span> <span style="font-weight: bold; font-style: italic;">@encode</span>
    <span style="font-weight: bold;">when</span> <span style="font-style: italic;">'opus'</span>
      (<span style="font-weight: bold; font-style: italic;">@bitrate</span> ? <span style="font-weight: bold; font-style: italic;">@bitrate</span> : <span style="font-weight: bold; text-decoration: underline;">DEFAULT_BITRATE</span>)
    <span style="font-weight: bold;">else</span>
      <span style="font-weight: bold; font-style: italic;">@bitrate</span>
    <span style="font-weight: bold;">end</span>
  <span style="font-weight: bold;">end</span>
<span style="font-weight: bold;">end</span>

<span style="font-weight: bold;">class</span> <span style="font-weight: bold; text-decoration: underline;">DVDConfig</span>
  <span style="font-weight: bold;">attr_accessor</span> <span style="font-weight: bold; text-decoration: underline;">:title</span>, <span style="font-weight: bold; text-decoration: underline;">:chapters</span>, <span style="font-weight: bold; text-decoration: underline;">:audio</span>, <span style="font-weight: bold; text-decoration: underline;">:subtitle</span>, <span style="font-weight: bold; text-decoration: underline;">:options</span>
  <span style="font-weight: bold;">attr_accessor</span> <span style="font-weight: bold; text-decoration: underline;">:chapter_marker</span>

  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">initialize</span>
    <span style="font-weight: bold; font-style: italic;">@chapter_marker</span> = <span style="font-weight: bold; text-decoration: underline;">true</span>
  <span style="font-weight: bold;">end</span>
<span style="font-weight: bold;">end</span>

<span style="font-weight: bold;">class</span> <span style="font-weight: bold; text-decoration: underline;">ImageConfig</span>
  <span style="font-weight: bold;">attr_reader</span> <span style="font-weight: bold; text-decoration: underline;">:quality</span> <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">1~100</span>
<span style="font-weight: bold;">end</span>

<span style="font-weight: bold;">class</span> <span style="font-weight: bold; text-decoration: underline;">FFMPEGOptSet</span> &lt; <span style="font-weight: bold; text-decoration: underline;">Struct</span>.new(<span style="font-weight: bold; text-decoration: underline;">:fname</span>, <span style="font-weight: bold; text-decoration: underline;">:optset</span>)
<span style="font-weight: bold;">end</span>

<span style="font-weight: bold;">class</span> <span style="font-weight: bold; text-decoration: underline;">FFMPEG</span>
  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">self</span>.<span style="font-weight: bold;">command</span>(in_optsets, out_optsets)
    opts = [<span style="font-style: italic;">"ffmpeg"</span>]

    infilep = <span style="font-weight: bold;">proc</span> <span style="font-weight: bold;">do</span> |fname, optset|
      opt_arr = []
      optset.each <span style="font-weight: bold;">do</span> |opt|
        <span style="font-weight: bold;">if</span> opt.instance_of?(<span style="font-weight: bold; text-decoration: underline;">String</span>)
          opt_arr &lt;&lt; opt
        <span style="font-weight: bold;">end</span>
      <span style="font-weight: bold;">end</span>
      opt_arr &lt;&lt; [<span style="font-style: italic;">"-i"</span>, <span style="font-style: italic;">"\"</span><span style="font-weight: bold; font-style: italic;">#{fname}</span><span style="font-style: italic;">\""</span>]
      <span style="font-weight: bold;">next</span> opt_arr
    <span style="font-weight: bold;">end</span>
    in_optsets.each <span style="font-weight: bold;">do</span> |in_optset|
      opts &lt;&lt; infilep.call(in_optset.fname, in_optset.optset)
    <span style="font-weight: bold;">end</span>

    outfilep = <span style="font-weight: bold;">proc</span> <span style="font-weight: bold;">do</span> |fname, optset|
      oopts = []
      optset.each <span style="font-weight: bold;">do</span> |opt|
        <span style="font-weight: bold;">if</span> opt.instance_of?(<span style="font-weight: bold; text-decoration: underline;">VideoConfig</span>)
          <span style="font-weight: bold;">case</span> opt.encode
          <span style="font-weight: bold;">when</span> <span style="font-style: italic;">'av1'</span>
            oopts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"-c:v librav1e"</span>)
            <span style="font-weight: bold;">if</span> opt.bitrate
              oopts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"-b:v %sk"</span>, opt.bitrate)
            <span style="font-weight: bold;">end</span>
          <span style="font-weight: bold;">when</span> <span style="font-style: italic;">'vp9'</span>
            oopts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"-c:v libvpx-vp9"</span>)
            <span style="font-weight: bold;">if</span> opt.quality
              oopts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"-crf %s"</span>, opt.quality)
              oopts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"-b:v 0"</span>)
            <span style="font-weight: bold;">elsif</span> opt.bitrate
              oopts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"-b:v %s"</span>, opt.bitrate)
            <span style="font-weight: bold;">end</span>
          <span style="font-weight: bold;">when</span> <span style="font-style: italic;">'h265'</span>
            oopts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"-c:v libx265"</span>)
            oopts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"-crf %s"</span>, opt.quality)
            oopts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"-preset %s"</span>, opt.preset) <span style="font-weight: bold;">if</span> opt.preset
            oopts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"-tune %s"</span>, opt.tune) <span style="font-weight: bold;">if</span> opt.tune
            <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Currently, ffmpeg &#8203;does not support setting profiles on x265</span>
            oopts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"-profile:v %s"</span>, opt.profile) <span style="font-weight: bold;">if</span> opt.profile &amp;&amp; opt.encoder == <span style="font-style: italic;">'x264'</span>
            oopts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"-level %s"</span>, opt.level) <span style="font-weight: bold;">if</span> opt.level
          <span style="font-weight: bold;">else</span>
            oopts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"-c:v copy"</span>)
          <span style="font-weight: bold;">end</span>
        <span style="font-weight: bold;">elsif</span> opt.instance_of?(<span style="font-weight: bold; text-decoration: underline;">AudioConfig</span>)
          <span style="font-weight: bold;">case</span> opt.encode
          <span style="font-weight: bold;">when</span> <span style="font-style: italic;">'opus'</span>
            oopts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"-c:a lib%s"</span>, opt.encode)
            oopts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"-b:a %sk"</span>, opt.bitrate) <span style="font-weight: bold;">if</span> opt.bitrate
          <span style="font-weight: bold;">when</span> <span style="font-style: italic;">'aac'</span>
            oopts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"-c:a libfdk_aac"</span>)
            <span style="font-weight: bold;">if</span> opt.quality
              oopts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"-aq %s"</span>, opt.quality)
              oopts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"-b:a 0"</span>)
            <span style="font-weight: bold;">elsif</span> opt.bitrate
              oopts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"-b:a %s"</span>, opt.bitrate)
            <span style="font-weight: bold;">end</span>
          <span style="font-weight: bold;">else</span>
            oopts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"-c:a copy"</span>)
          <span style="font-weight: bold;">end</span>
        <span style="font-weight: bold;">elsif</span> opt.instance_of?(<span style="font-weight: bold; text-decoration: underline;">PictureConfig</span>)
          oopts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"-vf \"%s\""</span>, opt.vf_opts.join(<span style="font-style: italic;">","</span>)) <span style="font-weight: bold;">if</span> opt.vf_opts &amp;&amp; opt.vf_opts.any?
          oopts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"-r %s"</span>, opt.fps) <span style="font-weight: bold;">if</span> opt.fps
        <span style="font-weight: bold;">elsif</span> opt.instance_of?(<span style="font-weight: bold; text-decoration: underline;">String</span>)
          oopts &lt;&lt; opt
        <span style="font-weight: bold;">end</span>
      <span style="font-weight: bold;">end</span>
      oopts &lt;&lt; <span style="font-style: italic;">"\"</span><span style="font-weight: bold; font-style: italic;">#{fname}</span><span style="font-style: italic;">\""</span>
      <span style="font-weight: bold;">next</span> oopts
    <span style="font-weight: bold;">end</span>
    out_optsets.each <span style="font-weight: bold;">do</span> |out_optset|
      opts &lt;&lt; outfilep.call(out_optset.fname, out_optset.optset)
    <span style="font-weight: bold;">end</span>

    opts.join(<span style="font-style: italic;">" "</span>)
  <span style="font-weight: bold;">end</span>
<span style="font-weight: bold;">end</span>

<span style="font-weight: bold;">class</span> <span style="font-weight: bold; text-decoration: underline;">HandBrakeCLI</span>
  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">self</span>.<span style="font-weight: bold;">command</span>(input, output, configs, raw_option)
    cmd_opts = [<span style="font-style: italic;">"HandBrakeCLI"</span>]
    cmd_opts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"--input \"%s\""</span>, input)
    cmd_opts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"--output \"%s\""</span>, output)
    configs.each <span style="font-weight: bold;">do</span> |config|
      <span style="font-weight: bold;">if</span> config.instance_of?(<span style="font-weight: bold; text-decoration: underline;">VideoConfig</span>)
        <span style="font-weight: bold;">case</span> config.encode
        <span style="font-weight: bold;">when</span> <span style="font-style: italic;">'vp9'</span>
          cmd_opts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"--encoder VP9"</span>)
          <span style="font-weight: bold;">if</span> config.quality
            cmd_opts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"--quality %s"</span>, config.quality)
            cmd_opts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"--vb 0"</span>)
          <span style="font-weight: bold;">elsif</span> config.bitrate
            cmd_opts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"--vb %s"</span>, config.bitrate)
          <span style="font-weight: bold;">end</span>
          cmd_opts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"--encoder-preset veryslow"</span>)
        <span style="font-weight: bold;">when</span> <span style="font-style: italic;">'h265'</span> || <span style="font-style: italic;">'hevc'</span>
          cmd_opts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"--encoder x265"</span>)
          <span style="font-weight: bold;">if</span> config.quality
            cmd_opts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"--quality %s"</span>, config.quality)
            cmd_opts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"--vb 0"</span>)
          <span style="font-weight: bold;">elsif</span> config.bitrate
            cmd_opts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"--vb %s"</span>, config.bitrate)
          <span style="font-weight: bold;">end</span>
          cmd_opts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"--encoder-preset %s"</span>, config.preset) <span style="font-weight: bold;">if</span> config.preset
          cmd_opts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"--encoder-tune %s"</span>, config.tune) <span style="font-weight: bold;">if</span> config.tune
          cmd_opts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"--encoder-profile %s"</span>, config.profile) <span style="font-weight: bold;">if</span> config.profile
          cmd_opts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"--encoder-level %s"</span>, config.level) <span style="font-weight: bold;">if</span> config.level
        <span style="font-weight: bold;">else</span>
          cmd_opts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"--encoder %s"</span>, config.encode) <span style="font-weight: bold;">if</span> config.encode
          cmd_opts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"--quality %s"</span>, config.quality) <span style="font-weight: bold;">if</span> config.quality
          cmd_opts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"--vb %s"</span>, config.bitrate) <span style="font-weight: bold;">if</span> config.bitrate
        <span style="font-weight: bold;">end</span>
      <span style="font-weight: bold;">elsif</span> config.instance_of?(<span style="font-weight: bold; text-decoration: underline;">AudioConfig</span>)
        <span style="font-weight: bold;">case</span> config.encode
        <span style="font-weight: bold;">when</span> <span style="font-style: italic;">'opus'</span>
          cmd_opts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"--aencoder %s"</span>, config.encode)
          cmd_opts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"--aq %s"</span>, config.quality) <span style="font-weight: bold;">if</span> config.quality
          cmd_opts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"--ab %s"</span>, config.bitrate) <span style="font-weight: bold;">if</span> config.bitrate
        <span style="font-weight: bold;">when</span> <span style="font-style: italic;">'aac'</span>
          cmd_opts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"--aencoder ca_haac"</span>)
          <span style="font-weight: bold;">if</span> config.quality
            cmd_opts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"--aq %s"</span>, config.quality)
            cmd_opts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"--ab 0"</span>)
          <span style="font-weight: bold;">elsif</span> config.bitrate
            cmd_opts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"--ab %s"</span>, config.bitrate)
          <span style="font-weight: bold;">end</span>
        <span style="font-weight: bold;">else</span>
          cmd_opts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"--aencoder copy"</span>)
        <span style="font-weight: bold;">end</span>
      <span style="font-weight: bold;">elsif</span> config.instance_of?(<span style="font-weight: bold; text-decoration: underline;">DVDConfig</span>)
        cmd_opts &lt;&lt; (config.title ? <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"--title %s"</span>, config.title) : <span style="font-style: italic;">"--main-feature"</span>)
        cmd_opts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"--chapters %s"</span>, config.chapters) <span style="font-weight: bold;">if</span> config.chapters
        cmd_opts &lt;&lt; <span style="font-style: italic;">"--markers"</span> <span style="font-weight: bold;">if</span> config.chapter_marker
        cmd_opts &lt;&lt; (config.audio ? <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"--audio %s"</span>, config.audio) : <span style="font-style: italic;">"--all-audio"</span> )
        cmd_opts &lt;&lt; (config.subtitle ? <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"--subtitle %s"</span>, config.subtitle) : <span style="font-style: italic;">"--all-subtitles"</span> )
      <span style="font-weight: bold;">end</span>
    <span style="font-weight: bold;">end</span>

    cmd_opts &lt;&lt; raw_option <span style="font-weight: bold;">if</span> raw_option

    cmd_opts.join(<span style="font-style: italic;">" "</span>)
  <span style="font-weight: bold;">end</span>
<span style="font-weight: bold;">end</span>

<span style="font-weight: bold;">class</span> <span style="font-weight: bold; text-decoration: underline;">ImageMagick</span>
  <span style="font-weight: bold; text-decoration: underline;">COMMAND</span> = <span style="font-style: italic;">"convert %s %s %s %s "</span>

  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">self</span>.<span style="font-weight: bold;">command</span>(input, output, pconfig, raw_option=<span style="font-style: italic;">""</span>)
    input_opt = <span style="font-style: italic;">""</span>
    output_opt = <span style="font-style: italic;">""</span>
    <span style="font-weight: bold;">if</span> pconfig.instance_of?(<span style="font-weight: bold; text-decoration: underline;">ImageConfig</span>) <span style="font-weight: bold;">then</span>
      input_opt += <span style="font-style: italic;">"-quality %s"</span> % pconfig.quality <span style="font-weight: bold;">if</span> pconfig.quality
      s = <span style="font-weight: bold; text-decoration: underline;">COMMAND</span> % [input, input_opt, output, output_opt]
      s
    <span style="font-weight: bold;">end</span>
  <span style="font-weight: bold;">end</span>
<span style="font-weight: bold;">end</span>

<span style="font-weight: bold; text-decoration: underline;">MediaUtil</span>.start(<span style="font-weight: bold; text-decoration: underline;">ARGV</span>)
</pre>
</div>
</div>
</div>
<div id="outline-container-org61a3040" class="outline-3">
<h3 id="org61a3040">genalbum</h3>
<div class="outline-text-3" id="text-org61a3040">
<p>
Personal script for encoding family pictures and movies.
</p>

<div class="org-src-container">
<pre class="src src-ruby"><span style="font-weight: bold;">require</span> <span style="font-style: italic;">'fileutils'</span>
<span style="font-weight: bold;">require</span> <span style="font-style: italic;">'time'</span>
<span style="font-weight: bold;">require</span> <span style="font-style: italic;">'exifr'</span>
<span style="font-weight: bold;">require</span> <span style="font-style: italic;">'streamio-ffmpeg'</span>
<span style="font-weight: bold;">require</span> <span style="font-style: italic;">'pathname'</span>
<span style="font-weight: bold;">require</span> <span style="font-style: italic;">'thor'</span>

<span style="font-weight: bold; text-decoration: underline;">PICTURE_FILE_EXTS</span> = [<span style="font-style: italic;">".jpg"</span>]
<span style="font-weight: bold; text-decoration: underline;">MOVIE_FILE_EXTS</span> = [<span style="font-style: italic;">".mp4"</span>]
<span style="font-weight: bold; text-decoration: underline;">ALBUM_DIR_NAME</span> = <span style="font-style: italic;">"album/"</span>
<span style="font-weight: bold; text-decoration: underline;">RENAME_DIR_NAME</span> = <span style="font-style: italic;">"rename/"</span>
<span style="font-weight: bold; text-decoration: underline;">WEB_DIR_NAME</span> = <span style="font-style: italic;">"album_web/"</span>
<span style="font-weight: bold; text-decoration: underline;">IMG_PREFIX</span> = <span style="font-style: italic;">"img_"</span>

<span style="font-weight: bold;">class</span> <span style="font-weight: bold; text-decoration: underline;">GenAlbum</span> &lt; <span style="font-weight: bold; text-decoration: underline;">Thor</span>
  default_command <span style="font-weight: bold; text-decoration: underline;">:album</span>
  desc <span style="font-style: italic;">"[album] -i &lt;img_dir&gt;"</span>, <span style="font-style: italic;">"generate album"</span>
  option <span style="font-weight: bold; text-decoration: underline;">:in</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"i"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>, <span style="font-weight: bold; text-decoration: underline;">:required</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">true</span>
  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">album</span>
    src_path = <span style="font-weight: bold; text-decoration: underline;">File</span>.expand_path(options[<span style="font-weight: bold; text-decoration: underline;">:in</span>], <span style="font-weight: bold; text-decoration: underline;">Dir</span>.pwd)
    dest_path = <span style="font-weight: bold; text-decoration: underline;">ALBUM_DIR_NAME</span>

    <span style="font-weight: bold; text-decoration: underline;">FileUtils</span>.mkdir_p(dest_path) <span style="font-weight: bold;">unless</span> <span style="font-weight: bold; text-decoration: underline;">FileTest</span>.exist?(dest_path)

    <span style="font-weight: bold; text-decoration: underline;">Dir</span>.glob(src_path + <span style="font-style: italic;">"/*"</span>).each <span style="font-weight: bold;">do</span> |img_file|
      basename = <span style="font-weight: bold; text-decoration: underline;">File</span>::basename(img_file)
      src_file = src_path + <span style="font-style: italic;">"/"</span> + basename
      dest_file = dest_path + <span style="font-style: italic;">"/"</span> + basename
      ext = <span style="font-weight: bold; text-decoration: underline;">File</span>.extname(img_file)
      <span style="font-weight: bold;">if</span> <span style="font-weight: bold; text-decoration: underline;">PICTURE_FILE_EXTS</span>.index(ext.downcase) != <span style="font-weight: bold; text-decoration: underline;">nil</span> <span style="font-weight: bold;">then</span>
        <span style="font-weight: bold;">system</span>(<span style="font-style: italic;">"convert -resize \"4096x&gt;\" -quality 92 </span><span style="font-weight: bold; font-style: italic;">#{src_file}</span><span style="font-style: italic;"> </span><span style="font-weight: bold; font-style: italic;">#{dest_file}</span><span style="font-style: italic;">"</span>)
      <span style="font-weight: bold;">elsif</span> <span style="font-weight: bold; text-decoration: underline;">MOVIE_FILE_EXTS</span>.index(ext.downcase) != <span style="font-weight: bold; text-decoration: underline;">nil</span> <span style="font-weight: bold;">then</span>
        <span style="font-weight: bold;">system</span>(<span style="font-style: italic;">"mediautil encode -i </span><span style="font-weight: bold; font-style: italic;">#{src_file}</span><span style="font-style: italic;"> -o </span><span style="font-weight: bold; font-style: italic;">#{dest_file}</span><span style="font-style: italic;"> -q 22.0 -Q 100.0"</span>)
      <span style="font-weight: bold;">end</span>
    <span style="font-weight: bold;">end</span>
  <span style="font-weight: bold;">end</span>

  desc <span style="font-style: italic;">"web -i &lt;img_dir&gt;"</span>, <span style="font-style: italic;">"generate lightweight album for web"</span>
  option <span style="font-weight: bold; text-decoration: underline;">:in</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"i"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>, <span style="font-weight: bold; text-decoration: underline;">:required</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">true</span>
  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">web</span>
    src_path = <span style="font-weight: bold; text-decoration: underline;">File</span>.expand_path(options[<span style="font-weight: bold; text-decoration: underline;">:in</span>], <span style="font-weight: bold; text-decoration: underline;">Dir</span>.pwd)
    dest_path = <span style="font-weight: bold; text-decoration: underline;">WEB_DIR_NAME</span>

    <span style="font-weight: bold; text-decoration: underline;">FileUtils</span>.mkdir_p(dest_path) <span style="font-weight: bold;">unless</span> <span style="font-weight: bold; text-decoration: underline;">FileTest</span>.exist?(dest_path)

    <span style="font-weight: bold; text-decoration: underline;">Dir</span>.glob(src_path + <span style="font-style: italic;">"/*"</span>).each <span style="font-weight: bold;">do</span> |img_file|
      basename = <span style="font-weight: bold; text-decoration: underline;">File</span>::basename(img_file)
      src_file = src_path + <span style="font-style: italic;">"/"</span> + basename
      dest_file = dest_path + <span style="font-style: italic;">"/"</span> + basename
      ext = <span style="font-weight: bold; text-decoration: underline;">File</span>.extname(img_file)
      <span style="font-weight: bold;">if</span> <span style="font-weight: bold; text-decoration: underline;">PICTURE_FILE_EXTS</span>.index(ext.downcase) != <span style="font-weight: bold; text-decoration: underline;">nil</span> <span style="font-weight: bold;">then</span>
        <span style="font-weight: bold;">system</span>(<span style="font-style: italic;">"convert -resize \"1024x&gt;\" -quality 80 </span><span style="font-weight: bold; font-style: italic;">#{src_file}</span><span style="font-style: italic;"> </span><span style="font-weight: bold; font-style: italic;">#{dest_file}</span><span style="font-style: italic;">"</span>)
      <span style="font-weight: bold;">elsif</span> <span style="font-weight: bold; text-decoration: underline;">MOVIE_FILE_EXTS</span>.index(ext.downcase) != <span style="font-weight: bold; text-decoration: underline;">nil</span> <span style="font-weight: bold;">then</span>
        <span style="font-weight: bold;">system</span>(<span style="font-style: italic;">"mediautil encode -i </span><span style="font-weight: bold; font-style: italic;">#{src_file}</span><span style="font-style: italic;"> -o </span><span style="font-weight: bold; font-style: italic;">#{dest_file}</span><span style="font-style: italic;"> -q 26.0 -Q 100.0"</span>)
      <span style="font-weight: bold;">end</span>
    <span style="font-weight: bold;">end</span>
  <span style="font-weight: bold;">end</span>

  desc <span style="font-style: italic;">"renmae -i &lt;img_dir&gt;"</span>, <span style="font-style: italic;">"rename image files in chlonological order"</span>
  option <span style="font-weight: bold; text-decoration: underline;">:in</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"i"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>, <span style="font-weight: bold; text-decoration: underline;">:required</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">true</span>
  option <span style="font-weight: bold; text-decoration: underline;">:out</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"o"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>
  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">rename</span>
    src_path = <span style="font-weight: bold; text-decoration: underline;">File</span>.expand_path(options[<span style="font-weight: bold; text-decoration: underline;">:in</span>], <span style="font-weight: bold; text-decoration: underline;">Dir</span>.pwd)
    dest_path = ((options[<span style="font-weight: bold; text-decoration: underline;">:out</span>]) ? options[<span style="font-weight: bold; text-decoration: underline;">:out</span>] : <span style="font-weight: bold; text-decoration: underline;">RENAME_DIR_NAME</span>)

    <span style="font-weight: bold; text-decoration: underline;">FileUtils</span>.mkdir_p(dest_path) <span style="font-weight: bold;">unless</span> <span style="font-weight: bold; text-decoration: underline;">FileTest</span>.exist?(dest_path)

    img_time = {}
    <span style="font-weight: bold; text-decoration: underline;">Dir</span>.glob(src_path + <span style="font-style: italic;">"/*"</span>).each <span style="font-weight: bold;">do</span> |img_file|
      ext = <span style="font-weight: bold; text-decoration: underline;">File</span>.extname(img_file)
      <span style="font-weight: bold;">if</span> <span style="font-weight: bold; text-decoration: underline;">PICTURE_FILE_EXTS</span>.index(ext.downcase) != <span style="font-weight: bold; text-decoration: underline;">nil</span> <span style="font-weight: bold;">then</span>
        pic = <span style="font-weight: bold; text-decoration: underline;">EXIFR</span>::<span style="font-weight: bold; text-decoration: underline;">JPEG</span>.new(img_file)
        <span style="font-weight: bold;">if</span> pic.exif? &amp;&amp; pic.date_time_original <span style="font-weight: bold;">then</span>
          img_time[img_file] = pic.date_time_original
        <span style="font-weight: bold;">else</span>
          img_time[img_file] = <span style="font-weight: bold; text-decoration: underline;">Time</span>.now
        <span style="font-weight: bold;">end</span>
      <span style="font-weight: bold;">elsif</span> <span style="font-weight: bold; text-decoration: underline;">MOVIE_FILE_EXTS</span>.index(ext.downcase) != <span style="font-weight: bold; text-decoration: underline;">nil</span> <span style="font-weight: bold;">then</span>
        movie = <span style="font-weight: bold; text-decoration: underline;">FFMPEG</span>::<span style="font-weight: bold; text-decoration: underline;">Movie</span>.new(img_file)
        time = movie.creation_time
        <span style="font-weight: bold;">if</span> time <span style="font-weight: bold;">then</span>
          img_time[img_file] = time
        <span style="font-weight: bold;">else</span>
          img_time[img_file] = <span style="font-weight: bold; text-decoration: underline;">Time</span>.now
        <span style="font-weight: bold;">end</span>
      <span style="font-weight: bold;">end</span>
    <span style="font-weight: bold;">end</span>
    img_time = img_time.sort_by{ |_, v| v }

    digit = img_time.length.to_s.length
    digit = 2 <span style="font-weight: bold;">if</span> digit &lt; 2
    img_time.each_with_index <span style="font-weight: bold;">do</span> |(img, time), i|
      ext = <span style="font-weight: bold; text-decoration: underline;">File</span>.extname(img).downcase
      base = <span style="font-weight: bold; text-decoration: underline;">IMG_PREFIX</span> + <span style="font-style: italic;">"%0</span><span style="font-weight: bold; font-style: italic;">#{digit}</span><span style="font-style: italic;">d"</span> % (i + 1) + ext
      src_file = img
      dest_file = dest_path + <span style="font-style: italic;">"/"</span> + base
      <span style="font-weight: bold;">system</span>(<span style="font-style: italic;">"cp </span><span style="font-weight: bold; font-style: italic;">#{src_file}</span><span style="font-style: italic;"> </span><span style="font-weight: bold; font-style: italic;">#{dest_file}</span><span style="font-style: italic;">"</span>)
    <span style="font-weight: bold;">end</span>
  <span style="font-weight: bold;">end</span>
<span style="font-weight: bold;">end</span>

<span style="font-weight: bold; text-decoration: underline;">GenAlbum</span>.start(<span style="font-weight: bold; text-decoration: underline;">ARGV</span>)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd78981c" class="outline-3">
<h3 id="orgd78981c">nhp&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span></h3>
</div>

<div id="outline-container-org40f4835" class="outline-3">
<h3 id="org40f4835">sendmail.py</h3>
<div class="outline-text-3" id="text-org40f4835">
<p>
Utility for sendind email programatically
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="font-weight: bold;">import</span> sys
<span style="font-weight: bold;">import</span> argparse
<span style="font-weight: bold;">import</span> subprocess
<span style="font-weight: bold;">import</span> smtplib
<span style="font-weight: bold;">import</span> ssl
<span style="font-weight: bold;">from</span> email.mime.text <span style="font-weight: bold;">import</span> MIMEText
<span style="font-weight: bold;">from</span> email.utils <span style="font-weight: bold;">import</span> formatdate

<span style="font-weight: bold;">def</span> <span style="font-weight: bold;">sendmail</span>(mail_to, mail_from, subject, message):
    <span style="font-weight: bold; font-style: italic;">smtp_host</span> = <span style="font-style: italic;">'smtp.&lt;&lt;my-domain()&gt;&gt;'</span>
    <span style="font-weight: bold; font-style: italic;">smtp_port</span> = <span style="font-style: italic;">'465'</span>
    <span style="font-weight: bold; font-style: italic;">smtp_user</span> = <span style="font-style: italic;">'&lt;&lt;email&gt;&gt;'</span>.split(sep=<span style="font-style: italic;">'@'</span>)[0]
    <span style="font-weight: bold; font-style: italic;">smtp_pass</span> = subprocess.run([<span style="font-style: italic;">"pass {}:{}/{} | head -1"</span>.<span style="font-weight: bold;">format</span>(smtp_host, smtp_port, smtp_user)], stdout=subprocess.PIPE, shell=<span style="font-weight: bold; text-decoration: underline;">True</span>).stdout.decode().strip()

    <span style="font-weight: bold; font-style: italic;">mime_msg</span> = MIMEText(message)
    <span style="font-weight: bold; font-style: italic;">mime_msg</span>[<span style="font-style: italic;">'Subject'</span>] = subject
    <span style="font-weight: bold; font-style: italic;">mime_msg</span>[<span style="font-style: italic;">'From'</span>] = mail_from
    <span style="font-weight: bold; font-style: italic;">mime_msg</span>[<span style="font-style: italic;">'To'</span>] = mail_to
    <span style="font-weight: bold; font-style: italic;">mime_msg</span>[<span style="font-style: italic;">"Date"</span>] = formatdate(<span style="font-weight: bold; text-decoration: underline;">None</span>, <span style="font-weight: bold; text-decoration: underline;">True</span>)

    <span style="font-weight: bold;">if</span> smtp_port == <span style="font-style: italic;">'465'</span>:
        <span style="font-weight: bold; font-style: italic;">context</span> = ssl.create_default_context()
        <span style="font-weight: bold; font-style: italic;">smtp</span> = smtplib.SMTP_SSL(smtp_host, smtp_port, context=context)

    <span style="font-weight: bold;">if</span> smtp <span style="font-weight: bold;">is</span> <span style="font-weight: bold;">not</span> <span style="font-weight: bold; text-decoration: underline;">None</span>:
        smtp.login(smtp_user, smtp_pass)
        smtp.sendmail(mail_from, mail_to, mime_msg.as_string())
        smtp.<span style="font-weight: bold; text-decoration: underline;">quit</span>()


<span style="font-weight: bold; font-style: italic;">DESC</span> = <span style="font-style: italic;">'sendmail.py sends mail'</span>
<span style="font-weight: bold; font-style: italic;">parser</span> = argparse.ArgumentParser(description=DESC)
parser.add_argument(<span style="font-style: italic;">'-s'</span>, <span style="font-style: italic;">'--subject'</span>)
parser.add_argument(<span style="font-style: italic;">'-f'</span>, <span style="font-style: italic;">'--mailfrom'</span>)
parser.add_argument(<span style="font-style: italic;">'to'</span>)
<span style="font-weight: bold; font-style: italic;">args</span> = parser.parse_args()

<span style="font-weight: bold; font-style: italic;">message</span> = sys.stdin.read()
sendmail(args.to, args.mailfrom, args.subject, message)
</pre>
</div>
</div>
</div>

<div id="outline-container-org1203dee" class="outline-3">
<h3 id="org1203dee">pwsudo</h3>
<div class="outline-text-3" id="text-org1203dee">
<p>
Nifty script that executes command with elevating privilege using password from pass command.
</p>

<div class="org-src-container">
<pre class="src src-shell"><span style="font-weight: bold; font-style: italic;">_userid</span>=$(whoami)
<span style="font-weight: bold; font-style: italic;">_hostname</span>=$(hostname)

<span style="font-weight: bold; font-style: italic;">pas</span>=$(pass show <span style="font-style: italic;">"${_hostname}/${_userid}"</span> 2&gt;/dev/null) <span style="font-style: italic;">\</span>
  &amp;&amp; ( <span style="font-weight: bold;">echo</span> <span style="font-style: italic;">"${pas}"</span> | head -1 | sudo -sES -p <span style="font-style: italic;">""</span> <span style="font-style: italic;">"$@"</span> ) <span style="font-style: italic;">\</span>
  || sudo -sES <span style="font-style: italic;">"$@"</span>

<span style="font-weight: bold;">exit</span> $<span style="font-weight: bold; font-style: italic;">?</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org51aa919" class="outline-3">
<h3 id="org51aa919">gitsync&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span></h3>
</div>

<div id="outline-container-org39f9c2d" class="outline-3">
<h3 id="org39f9c2d">filetype-cli&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span></h3>
</div>
<div id="outline-container-org0c9ba8b" class="outline-3">
<h3 id="org0c9ba8b">strip ruby</h3>
<div class="outline-text-3" id="text-org0c9ba8b">
<p>
A program strips all ruby tags in a HTML stream. All HTML contents are expected to be from STDIN and go out as STDOUT. This procedure is mainly for html files converted from pdf and epub files.
Stripping rules are:
</p>
<ul class="org-ul">
<li>&lt;ruby&gt; tag will be stripped</li>
<li>&lt;rt&gt; tree for furigana tree will be removed</li>
<li>&lt;rp&gt; tree contains parenthes for non-ruby-support brouwser will be removed</li>
<li>&lt;rb&gt; tag for delimiter will be stripped</li>
<li>&lt;rtc&gt; tree for semantic word will be removed</li>
</ul>

<div class="org-src-container">
<pre class="src src-python"><span style="font-weight: bold;">import</span> sys
<span style="font-weight: bold;">import</span> lxml.html <span style="font-weight: bold;">as</span> html

<span style="font-weight: bold; font-style: italic;">INPUT_STR</span> = sys.stdin.read()
<span style="font-weight: bold; font-style: italic;">ROOT</span> = html.fromstring(INPUT_STR).getroottree()

<span style="font-weight: bold;">for</span> ruby <span style="font-weight: bold;">in</span> ROOT.xpath(<span style="font-style: italic;">'//ruby'</span>):
    <span style="font-weight: bold;">for</span> rt <span style="font-weight: bold;">in</span> ruby.xpath(<span style="font-style: italic;">'//rt'</span>):
        rt.drop_tree()
    <span style="font-weight: bold;">for</span> rp <span style="font-weight: bold;">in</span> ruby.xpath(<span style="font-style: italic;">'//rp'</span>):
        rp.drop_tree()
    <span style="font-weight: bold;">for</span> rb <span style="font-weight: bold;">in</span> ruby.xpath(<span style="font-style: italic;">'//rb'</span>):
        rb.drop_tag()
    <span style="font-weight: bold;">for</span> rtc <span style="font-weight: bold;">in</span> ruby.xpath(<span style="font-style: italic;">'//rtc'</span>):
        rtc.drop_tree()
        ruby.drop_tag()

<span style="font-weight: bold; font-style: italic;">CONTENT</span> = html.tostring(ROOT, encoding=<span style="font-style: italic;">"utf-8"</span>, method=<span style="font-style: italic;">'html'</span>, pretty_print=<span style="font-weight: bold; text-decoration: underline;">True</span>)
<span style="font-weight: bold;">print</span>(CONTENT.decode())
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orgaad24f0" class="outline-2">
<h2 id="orgaad24f0">Local Variables</h2>
<div class="outline-text-2" id="text-orgaad24f0">
</div>
</div>
</div>
</body>
</html>
