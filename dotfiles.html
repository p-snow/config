<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>My Configuration Collection</title>
<meta name="generator" content="Org mode" />
<link rel="stylesheet" type="text/css" href="https://fniessen.github.io/org-html-themes/src/readtheorg_theme/css/htmlize.css"/>
<link rel="stylesheet" type="text/css" href="https://fniessen.github.io/org-html-themes/src/readtheorg_theme/css/readtheorg.css"/>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/src/lib/js/jquery.stickytableheaders.min.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/src/readtheorg_theme/js/readtheorg.js"></script>
</head>
<body>
<div id="content">
<h1 class="title">My Configuration Collection</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org2878941">definitions</a></li>
<li><a href="#orgee22b27">configurations</a>
<ul>
<li><a href="#orgd3f266e">GNU Emacs</a>
<ul>
<li><a href="#orgf7aed76">general configuration</a></li>
<li><a href="#org1e3d49f">further customization</a></li>
</ul>
</li>
<li><a href="#orgededa58">Bash</a></li>
<li><a href="#org66a941a">OpenSSH</a></li>
<li><a href="#org61db0fb">abcde</a></li>
<li><a href="#orgc920927">Git</a></li>
<li><a href="#orga06f2cb">ghq</a></li>
<li><a href="#orge01b62f">Pass</a></li>
<li><a href="#org00c5b11">mpv</a></li>
<li><a href="#org73a00c7">unison</a></li>
<li><a href="#org1e71351">Aspell</a></li>
<li><a href="#org4526256">asdf-vm</a>
<ul>
<li><a href="#orgdb6528f">asdf-ruby</a></li>
<li><a href="#org4228bef">asdf-python</a></li>
</ul>
</li>
<li><a href="#org65726d6">xkeysnail</a>
<ul>
<li><a href="#orgb45b88f">how to make xkeysnail daemonize</a></li>
</ul>
</li>
<li><a href="#org9b69904">GnuPG (gpg)</a></li>
<li><a href="#org3a12b54">GNU Guix</a>
<ul>
<li><a href="#org7fd33a3">Channel definitions</a></li>
<li><a href="#org992ef33">Manifests</a></li>
<li><a href="#org11b8004">Activating Profiles</a></li>
<li><a href="#org760b510">Updating Channels</a></li>
</ul>
</li>
<li><a href="#orga2db21f">SKK</a>
<ul>
<li><a href="#org5acc3f7">derive unique entries in user-jisyo</a></li>
</ul>
</li>
<li><a href="#org6bb762b">Festival</a></li>
<li><a href="#orgcc0e467">Open JTalk</a></li>
<li><a href="#org76b54cd">Jack</a></li>
<li><a href="#org344e882">XRandR</a></li>
<li><a href="#orgf66e72d">C/Migemo</a></li>
<li><a href="#orgc050cb6">LilyPond</a></li>
</ul>
</li>
<li><a href="#org287e3dd">utility scripts</a>
<ul>
<li><a href="#orga24533f">Declutters</a></li>
<li><a href="#org2f1686a">Database back-up scripts</a></li>
<li><a href="#orge64a70b">Snapshots taking</a></li>
<li><a href="#orga8091b0">git repo syncing</a></li>
<li><a href="#orga358cd6">backup scripts</a></li>
<li><a href="#org0573985">filetype</a></li>
<li><a href="#orgbb63ac2">mediautil</a></li>
<li><a href="#orge73e1f5">genalbum</a></li>
<li><a href="#orga2d88d3">nhp&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span></a></li>
<li><a href="#orgf413940">sendmail.py</a></li>
<li><a href="#org8d7e750">pwsudo</a></li>
<li><a href="#orgba117d0">gitsync</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-org2878941" class="outline-2">
<h2 id="org2878941">definitions</h2>
<div class="outline-text-2" id="text-org2878941">
<ul class="org-ul">
<li><p>
my home directory
</p>
<div class="org-src-container">
<pre class="src src-shell" id="org99a2711"><span style="font-weight: bold;">echo</span> <span style="font-style: italic;">"${HOME}"</span>
</pre>
</div></li>
<li><p>
my user name on system
</p>
<div class="org-src-container">
<pre class="src src-bash" id="orge57a5a6">whoami
</pre>
</div></li>
<li><p>
my email address
</p>
<div class="org-src-container">
<pre class="src src-bash" id="org7576e13"><span style="font-weight: bold;">echo</span> -n <span style="font-style: italic;">"${EMAIL}"</span>
</pre>
</div></li>
<li><p>
user account part of my email
</p>
<div class="org-src-container">
<pre class="src src-shell" id="org25c4fc9"><span style="font-weight: bold;">echo</span> -n <span style="font-style: italic;">"${EMAIL}"</span> | cut -d<span style="font-style: italic;">'@'</span> -f1
</pre>
</div></li>
<li><p>
network part of my email
</p>
<div class="org-src-container">
<pre class="src src-shell" id="org0ca7ffd"><span style="font-weight: bold;">echo</span> -n <span style="font-style: italic;">"${EMAIL}"</span> | cut -d<span style="font-style: italic;">'@'</span> -f2
</pre>
</div></li>
<li><p>
utility functions
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp" id="orgd026ef5">(* h 60 60)
</pre>
</div></li>
</ul>
</div>
</div>

<div id="outline-container-orgee22b27" class="outline-2">
<h2 id="orgee22b27">configurations</h2>
<div class="outline-text-2" id="text-orgee22b27">
</div>

<div id="outline-container-orgd3f266e" class="outline-3">
<h3 id="orgd3f266e">GNU Emacs</h3>
<div class="outline-text-3" id="text-orgd3f266e">
</div>
<div id="outline-container-orgf7aed76" class="outline-4">
<h4 id="orgf7aed76">general configuration</h4>
<div class="outline-text-4" id="text-orgf7aed76">
</div>
<ul class="org-ul">
<li><a id="orgf205643"></a>early initialization<br />
<div class="outline-text-5" id="text-orgf205643">
<p>
These process must be evaluated beforehand.
</p>
</div>

<ul class="org-ul">
<li><a id="org8cd5041"></a>global variable definitions<br />
<div class="outline-text-6" id="text-org8cd5041">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">setf</span> user-emacs-directory
      (expand-file-name (file-name-as-directory <span style="font-style: italic;">"~/share/emacs"</span>)))
(<span style="font-weight: bold;">setf</span> user-emacs-directory-default
      (expand-file-name (file-name-as-directory <span style="font-style: italic;">"~/.emacs.d"</span>)))
</pre>
</div>
</div>
</li>
<li><a id="org189f0f6"></a>package.el<br />
<div class="outline-text-6" id="text-org189f0f6">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">package</span>)
(<span style="font-weight: bold;">setq</span> package-archives
      '((<span style="font-style: italic;">"gnu"</span> . <span style="font-style: italic;">"http://elpa.gnu.org/packages/"</span>)
        (<span style="font-style: italic;">"melpa"</span> . <span style="font-style: italic;">"http://melpa.org/packages/"</span>)
        (<span style="font-style: italic;">"org"</span> . <span style="font-style: italic;">"http://orgmode.org/elpa/"</span>)))
(<span style="font-weight: bold;">setq</span> package-enable-at-startup nil)
(package-initialize t)

(<span style="font-weight: bold;">setq</span> package-user-dir (expand-file-name <span style="font-style: italic;">"elpa"</span> user-emacs-directory-default))
</pre>
</div>
</div>
</li>

<li><a id="org40e4fe3"></a>straight.el<br />
<div class="outline-text-6" id="text-org40e4fe3">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-style: italic;">"https://github.com/raxod502/straight.el/releases.atom"</span> soft_update)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">setq</span> straight-recipes-gnu-elpa-use-mirror t
      straight-base-dir user-emacs-directory-default)

(<span style="font-weight: bold;">let</span> ((bootstrap-file
       (expand-file-name <span style="font-style: italic;">"straight/repos/straight.el/bootstrap.el"</span> user-emacs-directory-default))
      (bootstrap-version 4))
  (<span style="font-weight: bold;">unless</span> (file-exists-p bootstrap-file)
    (<span style="font-weight: bold;">with-current-buffer</span>
        (url-retrieve-synchronously
         <span style="font-style: italic;">"https://raw.githubusercontent.com/raxod502/straight.el/develop/install.el"</span>
         'silent 'inhibit-cookies)
      (goto-char (point-max))
      (eval-print-last-sexp)))
  (load bootstrap-file nil 'nomessage))

(<span style="font-weight: bold;">with-eval-after-load</span> 'hydra
  (defhydra hydra-straight (global-map <span style="font-style: italic;">"C-x -"</span>
                                       <span style="font-weight: bold;">:color</span> blue)
    <span style="font-style: italic;">"Straight"</span>
    (<span style="font-style: italic;">"c"</span> straight-check-package)
    (<span style="font-style: italic;">"C"</span> straight-check-all)
    (<span style="font-style: italic;">"r"</span> straight-rebuild-package)
    (<span style="font-style: italic;">"R"</span> straight-rebuild-all)
    (<span style="font-style: italic;">"f"</span> straight-fetch-package)
    (<span style="font-style: italic;">"F"</span> straight-fetch-all)
    (<span style="font-style: italic;">"p"</span> straight-pull-package-and-deps)
    (<span style="font-style: italic;">"P"</span> straight-pull-all)
    (<span style="font-style: italic;">"m"</span> straight-merge-package)
    (<span style="font-style: italic;">"M"</span> straight-merge-all)
    (<span style="font-style: italic;">"n"</span> straight-normalize-package)
    (<span style="font-style: italic;">"N"</span> straight-normalize-all)
    (<span style="font-style: italic;">"u"</span> straight-push-package)
    (<span style="font-style: italic;">"U"</span> straight-push-all)
    (<span style="font-style: italic;">"v"</span> straight-freeze-versions)
    (<span style="font-style: italic;">"V"</span> straight-thaw-versions)
    (<span style="font-style: italic;">"w"</span> straight-watcher-start)
    (<span style="font-style: italic;">"W"</span> straight-watcher-quit)
    (<span style="font-style: italic;">"g"</span> straight-get-recipe)
    (<span style="font-style: italic;">"e"</span> straight-prune-build)
    (<span style="font-style: italic;">"q"</span> nil)))
</pre>
</div>
</div>
</li>

<li><a id="org29ac352"></a>use-package<br />
<div class="outline-text-6" id="text-org29ac352">
<p>
<a href="https://jwiegley.github.io/use-package/">Official manual</a> is handy especially when you look up <a href="https://jwiegley.github.io/use-package/keywords/">Keywords</a>.
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-use-package"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-style: italic;">"https://github.com/jwiegley/use-package/releases.atom"</span> soft_update)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">use-package</span>)

(<span style="font-weight: bold;">setq</span> use-package-ensure-function 'straight-use-package-ensure-function)
</pre>
</div>

<p>
use-package depends on following packages internally
</p>
</div>

<ul class="org-ul">
<li><a id="orgb72653d"></a>diminish<br />
<div class="outline-text-7" id="text-orgb72653d">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-diminish"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package diminish)
</pre>
</div>
</div>
</li>

<li><a id="org6d10938"></a>delight<br />
<div class="outline-text-7" id="text-org6d10938">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-delight"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package delight)
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="orgbf2f3cf"></a>load cl-lib<br />
<div class="outline-text-6" id="text-orgbf2f3cf">
<p>
Use 'cl-lib' rather than 'cl' package since it is <a href="https://www.gnu.org/savannah-checkouts/gnu/emacs/news/NEWS.27.1">officially deprecated</a>.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">cl-lib</span>)
</pre>
</div>
</div>
</li>
</ul>
</li>
<li><a id="orgb4a9fb5"></a>init file<br />
<div class="outline-text-5" id="text-orgb4a9fb5">
</div>

<ul class="org-ul">
<li><a id="org2a2a37b"></a>loading lisp files<br />
<div class="outline-text-6" id="text-org2a2a37b">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">dolist</span> (file (directory-files <span style="font-style: italic;">"~/.emacs.d/lisp"</span> t <span style="font-style: italic;">"</span><span style="font-weight: bold; font-style: italic;">\</span><span style="font-style: italic;">.el$"</span>))
  (funcall #'load-file file))
(<span style="font-weight: bold;">dolist</span> (file (directory-files <span style="font-style: italic;">"~/.emacs.d/site-lisp"</span> t <span style="font-style: italic;">"</span><span style="font-weight: bold; font-style: italic;">\</span><span style="font-style: italic;">.el$"</span>))
  (funcall #'load-file file))
(<span style="font-weight: bold;">dolist</span> (file (directory-files <span style="font-style: italic;">"~/.emacs.d/secrets"</span> t <span style="font-style: italic;">"</span><span style="font-weight: bold; font-style: italic;">\</span><span style="font-style: italic;">.el$"</span>))
  (funcall #'load-file file))
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="org52ee9b3"></a>basic config<br />
<div class="outline-text-5" id="text-org52ee9b3">
</div>

<ul class="org-ul">
<li><a id="org7b90527"></a>language<br />
<div class="outline-text-6" id="text-org7b90527">
<p>
<a href="https://www.gnu.org/software/emacs/manual/html_mono/emacs.html#Language-Environments">emacs#Language Environments</a>
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">language and locale</span>
(set-language-environment <span style="font-style: italic;">"Japanese"</span>)
(<span style="font-weight: bold;">setq</span> system-time-locale <span style="font-style: italic;">"C"</span>)

<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">coding system</span>
(set-default-coding-systems 'utf-8-unix)
(prefer-coding-system 'utf-8-unix)
(set-selection-coding-system 'utf-8-unix)

<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">prefer-coding-system take effect equally to follows</span>
(set-buffer-file-coding-system 'utf-8-unix)
(set-file-name-coding-system 'utf-8-unix)
(set-terminal-coding-system 'utf-8-unix)
(set-keyboard-coding-system 'utf-8-unix)
(<span style="font-weight: bold;">setq</span> locale-coding-system 'utf-8-unix)
</pre>
</div>
</div>
</li>
<li><a id="org0c39826"></a>visual facets<br />
<div class="outline-text-6" id="text-org0c39826">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">do not use basic GUI facets</span>
(tool-bar-mode -1)
(menu-bar-mode -1)
(scroll-bar-mode -1)
(tooltip-mode -1)

<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">fringe is preferably as thin as possible</span>
(set-fringe-mode 10)

<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">do not use visual bell</span>
(<span style="font-weight: bold;">setf</span> visible-bell nil)

<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">conceal distractions at startup</span>
(<span style="font-weight: bold;">setf</span> initial-scratch-message <span style="font-style: italic;">""</span>)
(<span style="font-weight: bold;">setf</span> inhibit-startup-screen t)
</pre>
</div>
</div>
</li>
<li><a id="orgcd6548b"></a>face<br />
<div class="outline-text-6" id="text-orgcd6548b">
<p>
Disclaimers: There are some face definitions which use an extra large font since I am <a href="https://en.wikipedia.org/wiki/Visual_impairment">visually impaired</a>.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my-default-pixel-width</span> 2560 <span style="font-style: italic;">"Default display width in pixel."</span>)
(<span style="font-weight: bold;">defmacro</span> <span style="font-weight: bold;">my-adjust-font-size</span> (original)
  <span style="font-style: italic;">"Adjust original font size to fit in display."</span>
  `(truncate (* ,original (/ (float (x-display-pixel-width))
                             ,my-default-pixel-width))))


(create-fontset-from-ascii-font <span style="font-style: italic;">"TakaoGothic"</span> nil <span style="font-style: italic;">"default"</span>)
(create-fontset-from-ascii-font <span style="font-style: italic;">"TakaoExGothic"</span> nil <span style="font-style: italic;">"variable"</span>)
(create-fontset-from-ascii-font <span style="font-style: italic;">"TakaoPMincho"</span> nil <span style="font-style: italic;">"mincho"</span>)
(create-fontset-from-ascii-font <span style="font-style: italic;">"TakaoMincho"</span> nil <span style="font-style: italic;">"fmincho"</span>)
(create-fontset-from-ascii-font <span style="font-style: italic;">"Gen Shin Gothic Monospace Light"</span> nil <span style="font-style: italic;">"dense"</span>)

(set-face-attribute 'default
                    nil
                    <span style="font-weight: bold;">:font</span> <span style="font-style: italic;">"fontset-default"</span>
                    <span style="font-weight: bold;">:height</span> (my-adjust-font-size 660))
(set-face-attribute 'fixed-pitch
                    nil
                    <span style="font-weight: bold;">:font</span> <span style="font-style: italic;">"fontset-default"</span>)
(set-face-attribute 'variable-pitch
                    nil
                    <span style="font-weight: bold;">:font</span> <span style="font-style: italic;">"fontset-variable"</span>)
(set-face-attribute 'bold
                    nil
                    <span style="font-weight: bold;">:weight</span> 'bold)
(set-face-attribute 'mode-line
                    nil
                    <span style="font-weight: bold;">:font</span> <span style="font-style: italic;">"fontset-fmincho"</span>
                    <span style="font-weight: bold;">:height</span> (my-adjust-font-size 660))

(use-package face-remap
  <span style="font-weight: bold;">:diminish</span> buffer-face-mode
  <span style="font-weight: bold;">:custom</span>
  (text-scale-mode-step 1.0625)
  <span style="font-weight: bold;">:config</span>
  (buffer-face-mode 1))

(use-package face
  <span style="font-weight: bold;">:no-require</span> t
  <span style="font-weight: bold;">:init</span>
  (<span style="font-weight: bold;">defface</span> <span style="font-weight: bold; font-style: italic;">my/large-gothic-face</span> `((t . (<span style="font-weight: bold;">:font</span> <span style="font-style: italic;">"fontset-default"</span>
                                              <span style="font-weight: bold;">:height</span> ,(my-adjust-font-size 900))))
    <span style="font-style: italic;">"A face with large font."</span>)
  (<span style="font-weight: bold;">defface</span> <span style="font-weight: bold; font-style: italic;">my/medium-large-gothic-face</span> `((t . (<span style="font-weight: bold;">:font</span> <span style="font-style: italic;">"fontset-default"</span>
                                                     <span style="font-weight: bold;">:height</span> ,(my-adjust-font-size 835))))
    <span style="font-style: italic;">"A face with medium-large font."</span>)
  (<span style="font-weight: bold;">defface</span> <span style="font-weight: bold; font-style: italic;">my/medium-gothic-face</span> `((t . (<span style="font-weight: bold;">:font</span> <span style="font-style: italic;">"fontset-default"</span>
                                               <span style="font-weight: bold;">:height</span> ,(my-adjust-font-size 655))))
    <span style="font-style: italic;">"A face with medium font."</span>)
  (<span style="font-weight: bold;">defface</span> <span style="font-weight: bold; font-style: italic;">my/small-gothic-face</span> `((t . (<span style="font-weight: bold;">:font</span> <span style="font-style: italic;">"fontset-default"</span>
                                              <span style="font-weight: bold;">:height</span> ,(my-adjust-font-size 570))))
    <span style="font-style: italic;">"A face with small font."</span>)
  (<span style="font-weight: bold;">defface</span> <span style="font-weight: bold; font-style: italic;">my/tiny-gothic-face</span> `((t . (<span style="font-weight: bold;">:font</span> <span style="font-style: italic;">"fontset-default"</span>
                                             <span style="font-weight: bold;">:height</span> ,(my-adjust-font-size 400))))
    <span style="font-style: italic;">"A face with tiny font."</span>)
  (<span style="font-weight: bold;">defface</span> <span style="font-weight: bold; font-style: italic;">my/large-mincho-face</span> `((t . (<span style="font-weight: bold;">:font</span> <span style="font-style: italic;">"fontset-mincho"</span>
                                              <span style="font-weight: bold;">:height</span> ,(my-adjust-font-size 840))))
    <span style="font-style: italic;">"A face with large mincho font."</span>)
  (<span style="font-weight: bold;">defface</span> <span style="font-weight: bold; font-style: italic;">my/medium-mincho-face</span> `((t . (<span style="font-weight: bold;">:font</span> <span style="font-style: italic;">"fontset-fmincho"</span>
                                               <span style="font-weight: bold;">:height</span> ,(my-adjust-font-size 780))))
    <span style="font-style: italic;">"A face with medium mincho font."</span>)
  <span style="font-weight: bold;">:hook</span>
  ((eww-mode twittering-mode nov-mode) . (<span style="font-weight: bold;">lambda</span> () (buffer-face-set 'my/large-gothic-face)))
  ((Info-mode help-mode helpful-mode woman-mode) . (<span style="font-weight: bold;">lambda</span> () (buffer-face-set 'my/medium-large-gothic-face)))
  ((org-mode text-mode dired-mode mu4e-headers-mode mu4e-compose-mode) . (<span style="font-weight: bold;">lambda</span> () (buffer-face-set 'my/medium-gothic-face)))
  ((prog-mode shell-mode term-mode vterm-mode eshell-mode) . (<span style="font-weight: bold;">lambda</span> () (buffer-face-set 'my/small-gothic-face)))
  (calendar-mode . (<span style="font-weight: bold;">lambda</span> () (buffer-face-set 'my/tiny-gothic-face)))
  ((mu4e-view-mode elfeed-show-mode) . (<span style="font-weight: bold;">lambda</span> () (buffer-face-set 'my/large-mincho-face)))
  (elfeed-search-update . (<span style="font-weight: bold;">lambda</span> () (buffer-face-set 'my/medium-mincho-face))))
</pre>
</div>
</div>
</li>

<li><a id="org7d224bd"></a>file handling<br />
<div class="outline-text-6" id="text-org7d224bd">
<p>
File-related tweaks including <a href="https://www.gnu.org/software/emacs/manual/html_mono/emacs.html#Customize-Save">Customizing Saving of Files</a>.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package files
  <span style="font-weight: bold;">:custom</span>
  (mode-require-final-newline 'visit-save)
  (make-backup-files nil)
  (delete-auto-save-files t)
  (enable-remote-dir-locals t)
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">setq</span> delete-by-moving-to-trash t))

(use-package saveplace
  <span style="font-weight: bold;">:custom</span>
  (save-place-version-control t)
  <span style="font-weight: bold;">:config</span>
  (save-place-mode 1))

(auto-compression-mode 1)

(<span style="font-weight: bold;">setq</span> auto-save-interval 4)
(<span style="font-weight: bold;">setq</span> auto-save-timeout 1)
(<span style="font-weight: bold;">setq</span> auto-save-default t)
(<span style="font-weight: bold;">setq</span> auto-save-list-file-prefix
      (concat user-emacs-directory <span style="font-style: italic;">"auto-save-list/.saves-"</span>))
</pre>
</div>
</div>
</li>
<li><a id="org4d15ad7"></a>modifier keys<br />
<div class="outline-text-6" id="text-org4d15ad7">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">cond</span>
 ((string= window-system <span style="font-style: italic;">"x"</span>)
  (<span style="font-weight: bold;">setf</span> x-alt-keysym  'alt
        x-meta-keysym 'meta))
 ((string= window-system <span style="font-style: italic;">"ns"</span>)
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">IME inline patch</span>
  (<span style="font-weight: bold;">setf</span> mac-use-input-method-on-system nil)
  (<span style="font-weight: bold;">setf</span> mac-control-modifier       'control
        mac-command-modifier       'meta
        mac-option-modifier        'super
        mac-right-option-modifier  'alt
        mac-right-control-modifier 'super
        mac-function-modifier      'hyper)))
</pre>
</div>
</div>
</li>
<li><a id="orge397256"></a>mark/region<br />
<div class="outline-text-6" id="text-orge397256">
<p>
Variables need to be carefully tweaked with <a href="https://www.gnu.org/software/emacs/manual/html_mono/emacs.html#Mark">manual</a>.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(setq set-mark-command-repeat-pop t)</span>
(<span style="font-weight: bold;">setf</span> mark-ring-max 32)
(<span style="font-weight: bold;">setf</span> highlight-nonselected-windows t)

<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">text in region will be deleted</span>
(delete-selection-mode t)
</pre>
</div>
</div>
</li>

<li><a id="org1976869"></a>window<br />
<div class="outline-text-6" id="text-org1976869">
<p>
Triple Escape (M-ESC ESC) has got to reset window layout by tweaking buffer-quit-function.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(winner-mode)
(global-set-key (kbd <span style="font-style: italic;">"C-z"</span>) 'winner-undo)
(global-set-key (kbd <span style="font-style: italic;">"C-M-z"</span>) 'winner-redo)

(<span style="font-weight: bold;">setq</span> buffer-quit-function 'winner-undo)

(global-set-key (kbd <span style="font-style: italic;">"M-o"</span>) 'other-window)

(windmove-default-keybindings)

<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">You can now switch windows with your shift key by pressing S-&lt;left&gt;, S-&lt;right&gt;, S-&lt;up&gt;, S-&lt;down&gt;.</span>
(windmove-default-keybindings)
</pre>
</div>
</div>
</li>

<li><a id="orgd6350d7"></a>buffers<br />
<div class="outline-text-6" id="text-orgd6350d7">
<p>
Bind for C-x C-b, use <a href="ibuffer">ibuffer</a> which has more features than <a href="list-buffers">list-buffers</a> based on <a href="https://irreal.org/blog/?p=10329">this advice</a>.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(substitute-key-definition 'list-buffers
                           'ibuffer
                           global-map)
</pre>
</div>
</div>
</li>

<li><a id="orge21dcd8"></a>mode line<br />
<div class="outline-text-6" id="text-orge21dcd8">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Don't show line and column number in the mode line</span>
(line-number-mode -1)
(column-number-mode -1)

(use-package time
  <span style="font-weight: bold;">:custom</span>
  (display-time-24hr-format t)
  (display-time-mail-string <span style="font-style: italic;">""</span>)
  (display-time-default-load-average nil)
  <span style="font-weight: bold;">:config</span>
  (display-time-mode t))

(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my/mode-line-buffer-name-length</span> 15
  <span style="font-style: italic;">"Fixed length for displaying buffer name in mode line."</span>)

(<span style="font-weight: bold;">setq-default</span> mode-line-format
              '(<span style="font-style: italic;">"%e"</span>
                mode-line-front-space
                mode-line-mule-info
                (<span style="font-weight: bold;">:eval</span>
                 (<span style="font-weight: bold;">let</span> ((mode-line-buffer-name
                        (replace-regexp-in-string <span style="font-style: italic;">" %</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">[[:ascii:]]</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">"</span> <span style="font-style: italic;">" %%\\1"</span>
                                                  (truncate-string-to-width
                                                   (buffer-name) my/mode-line-buffer-name-length nil ? t))))
                   (<span style="font-weight: bold;">cond</span>
                    (buffer-read-only
                     (propertize mode-line-buffer-name 'face 'underline))
                    ((buffer-modified-p)
                     (propertize mode-line-buffer-name 'face 'warning))
                    (mode-line-buffer-name))))
                (<span style="font-weight: bold;">:eval</span>
                 (<span style="font-weight: bold;">let</span> ((str (<span style="font-weight: bold;">if</span> line-number-mode
                                <span style="font-style: italic;">"^%l-%p"</span> <span style="font-style: italic;">""</span>)))
                   (<span style="font-weight: bold;">if</span> column-number-mode
                       (concat str <span style="font-style: italic;">"_%c"</span>) str)))
                global-mode-string))
</pre>
</div>
</div>
</li>

<li><a id="org180dbeb"></a>history<br />
<div class="outline-text-6" id="text-org180dbeb">
<p>
<a href="savehist-mode">savehist-mode</a> saves minibuffer history and additionals.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package savehist
  <span style="font-weight: bold;">:custom</span>
  (savehist-save-minibuffer-history t)
  (savehist-additional-variables '(kill-ring))
  <span style="font-weight: bold;">:config</span>
  (savehist-mode 1))

(<span style="font-weight: bold;">setf</span> history-length 300
      history-delete-duplicates t)
</pre>
</div>
</div>
</li>

<li><a id="orge251bbd"></a>minibuffer<br />
<div class="outline-text-6" id="text-orge251bbd">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">allow y/n answer for an either-or selection</span>
(fset 'yes-or-no-p 'y-or-n-p)

(add-hook 'minibuffer-setup-hook 'my/minibuffer-setup-function)

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/minibuffer-setup-function</span> ()
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">disable input method in mini buffer</span>
  (<span style="font-weight: bold;">when</span> current-input-method
    (deactivate-input-method))
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">decrease font size to 90% in minibuffer</span>
  (<span style="font-weight: bold;">setq-local</span> face-remapping-alist '((default <span style="font-weight: bold;">:height</span> 0.9))))

(<span style="font-weight: bold;">setf</span> enable-recursive-minibuffers t)
(minibuffer-depth-indicate-mode 1)

<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">search files in case insensitive way</span>
(<span style="font-weight: bold;">setf</span> read-file-name-completion-ignore-case t)
</pre>
</div>
</div>
</li>

<li><a id="orgc8ad318"></a>displaying<br />
<div class="outline-text-6" id="text-orgc8ad318">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">setf</span> scroll-step 1)

<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">use emacs in full screen mode</span>
(<span style="font-weight: bold;">when</span> (member (window-system) '(x ns w32))
  (set-frame-parameter nil 'fullscreen 'fullboth))

(<span style="font-weight: bold;">setq-default</span> truncate-lines t)

(use-package visual-line
  <span style="font-weight: bold;">:no-require</span> t
  <span style="font-weight: bold;">:after</span> adaptive-wrap
  <span style="font-weight: bold;">:hook</span>
  ((feed-show-mode eww-after-render help-mode helpful-mode Info-mode woman-mode mu4e-view-mode nov-mode twittering-mode)
   . visual-line-mode)
  ((feed-show-mode eww-after-render help-mode helpful-mode Info-mode woman-mode mu4e-view-mode nov-mode twittering-mode)
   . adaptive-wrap-prefix-mode)
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">major modes inherited from text-mode, like org-mode, is not desired to enable visual-line-mode</span>
  (text-mode . (<span style="font-weight: bold;">lambda</span> ()
                 (<span style="font-weight: bold;">when</span> (eq major-mode 'text-mode)
                   (visual-line-mode))))
  <span style="font-weight: bold;">:config</span>
  (global-visual-line-mode 0))
</pre>
</div>
</div>
</li>

<li><a id="org5b45648"></a>cursor<br />
<div class="outline-text-6" id="text-org5b45648">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">make cursor blinking</span>
(<span style="font-weight: bold;">setf</span> blink-cursor-blinks 15)
(<span style="font-weight: bold;">setf</span> blink-cursor-delay 0.7)
(<span style="font-weight: bold;">setf</span> blink-cursor-interval 0.35)
(blink-cursor-mode 1)

(use-package hl-line
  <span style="font-weight: bold;">:hook</span> (vterm-mode . (<span style="font-weight: bold;">lambda</span> () (hl-line-mode -1)))
  <span style="font-weight: bold;">:config</span>
  (hl-line-mode 1))
</pre>
</div>
</div>
</li>

<li><a id="orgb4c1555"></a><a id="ID-a504f06e-02d3-4dcd-b80b-566a55cca2c7"></a>display buffer<br />
<div class="outline-text-6" id="text-orgb4c1555">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">setq</span> display-buffer-base-action
      '((display-buffer-same-window
         display-buffer-reuse-window
         display-buffer-reuse-mode-window
         display-buffer-in-previous-window)))
</pre>
</div>
</div>
</li>

<li><a id="orge796231"></a>text handling<br />
<div class="outline-text-6" id="text-orge796231">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">setq-default</span> fill-column 80)

<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">suppress curved quotes in docstring (for emacs25)</span>
(<span style="font-weight: bold;">setf</span> text-quoting-style 'straight)
</pre>
</div>
</div>
</li>

<li><a id="org29d5076"></a>images<br />
<div class="outline-text-6" id="text-org29d5076">
<p>
<a href="https://xenodium.com/emacs-viewing-webp-images/">This post</a> teaches me how to enable converting external formats (i.e. webp) to internal ones.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package image
  <span style="font-weight: bold;">:custom</span>
  (image-use-external-converter t))
</pre>
</div>
</div>
</li>

<li><a id="orga4b966a"></a>indent<br />
<div class="outline-text-6" id="text-orga4b966a">
<p>
customization for <a href="https://www.gnu.org/software/emacs/manual/html_mono/emacs.html#Indentation">indentation</a>
See also <a href="#org6c0bf15">aggressive-indent-mode</a>
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">use spaces instead of a horizontal tab</span>
(<span style="font-weight: bold;">setq-default</span> indent-tabs-mode nil)

(custom-set-variables '(tab-always-indent 'complete))
(electric-indent-mode 1)
</pre>
</div>
</div>
</li>

<li><a id="org1b32950"></a>comments<br />
<div class="outline-text-6" id="text-org1b32950">
<p>
This command was introduced at <a href="https://irreal.org/blog/?p=10318">here</a> to insert comment box with fixed width based on <a href="fill-column">fill-column</a>.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/comment-box</span> (b e)
  <span style="font-style: italic;">"Draw a box comment around the region but arrange for the region</span>
<span style="font-style: italic;">to extend to at least the fill column. Place the point after the</span>
<span style="font-style: italic;">comment box."</span>
  (<span style="font-weight: bold;">interactive</span> <span style="font-style: italic;">"r"</span>)
  (<span style="font-weight: bold;">let</span> ((e (copy-marker e t)))
    (goto-char b)
    (end-of-line)
    (insert-char ?  (- fill-column (current-column)))
    (comment-box b e 1)
    (goto-char e)
    (set-marker e nil)))
</pre>
</div>
</div>
</li>

<li><a id="orgb39b921"></a>performance<br />
<div class="outline-text-6" id="text-orgb39b921">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">setq</span> gc-cons-threshold (* 10 gc-cons-threshold))
(<span style="font-weight: bold;">setq</span> message-log-max 10000)
(<span style="font-weight: bold;">setq</span> undo-outer-limit 64000000)

(<span style="font-weight: bold;">setq-default</span> bidi-display-reordering nil)

(<span style="font-weight: bold;">setq</span> next-screen-context-lines 2)
</pre>
</div>
</div>
</li>

<li><a id="orgacd0900"></a>customize buffer<br />
<div class="outline-text-6" id="text-orgacd0900">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(custom-set-variables
 '(custom-file (expand-file-name <span style="font-style: italic;">"custom.el"</span> user-emacs-directory)))
</pre>
</div>
</div>
</li>

<li><a id="org27b8a96"></a>killing&#xa0;&#xa0;&#xa0;<span class="tag"><span class="kill">kill</span></span><br />
<div class="outline-text-6" id="text-org27b8a96">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-style: italic;">"https://github.com/purcell/whole-line-or-region/releases.atom"</span> soft_update)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(custom-set-variables '(yank-pop-change-selection t))

(use-package whole-line-or-region
  <span style="font-weight: bold;">:straight</span> t
  <span style="font-weight: bold;">:config</span>
  (whole-line-or-region-global-mode 1))
</pre>
</div>
</div>
</li>

<li><a id="orgc621c7c"></a>mouse<br />
<div class="outline-text-6" id="text-orgc621c7c">
<p>
I prefer to rid my emacs experience of mouse as least as possible.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package mouse
  <span style="font-weight: bold;">:custom</span>
  (mouse-1-click-follows-link nil)
  (mouse-highlight nil)
  <span style="font-weight: bold;">:config</span>
  (mouse-wheel-mode 0))
</pre>
</div>
</div>
</li>

<li><a id="org8ecfe97"></a>fundamental key bindings<br />
<div class="outline-text-6" id="text-org8ecfe97">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">to be capable of distinguishing TAB and C-i</span>
(<span style="font-weight: bold;">setq</span> local-function-key-map (delq '(kp-tab . [9]) local-function-key-map))

(substitute-key-definition 'upcase-region
                           'upcase-dwim
                           global-map)
(substitute-key-definition 'downcase-region
                           'downcase-dwim
                           global-map)
(global-set-key (kbd <span style="font-style: italic;">"C-x C-c"</span>) #'capitalize-dwim)

<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">suppress prompting in (up/down)case-region</span>
(put 'upcase-region 'disabled nil)
(put 'downcase-region 'disabled nil)

(global-set-key (kbd <span style="font-style: italic;">"C-j"</span>) 'newline)
(global-set-key (kbd <span style="font-style: italic;">"C-M-o"</span>) 'open-line)
(global-set-key (kbd <span style="font-style: italic;">"C-h"</span>) 'backward-delete-char-untabify)
(global-set-key (kbd <span style="font-style: italic;">"M-h"</span>) 'backward-kill-word)
(global-set-key (kbd <span style="font-style: italic;">"M-SPC"</span>) 'cycle-spacing)
(global-set-key (kbd <span style="font-style: italic;">"C-c k"</span>) 'kill-this-buffer)
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="orgfb7ae59"></a>built-in features<br />
<div class="outline-text-5" id="text-orgfb7ae59">
</div>
<ul class="org-ul">
<li><a id="org75e38ef"></a>Auto Revert<br />
<div class="outline-text-6" id="text-org75e38ef">
<p>
<a href="https://www.gnu.org/software/emacs/manual/html_mono/emacs.html#Auto-Revert">Auto Revert</a>: Keeping buffers automatically up-to-date.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package autorevert
  <span style="font-weight: bold;">:diminish</span> (global-auto-revert-mode auto-revert-mode)
  <span style="font-weight: bold;">:custom</span>
  (auto-revert-verbose nil)
  (global-auto-revert-non-file-buffers t)
  <span style="font-weight: bold;">:config</span>
  (global-auto-revert-mode 1))
</pre>
</div>
</div>
</li>

<li><a id="orgf8aff26"></a>Abbrev<br />
<div class="outline-text-6" id="text-orgf8aff26">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package abbrev
  <span style="font-weight: bold;">:diminish</span> abbrev-mode
  <span style="font-weight: bold;">:custom</span>
  (save-abbrevs t)
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">setf</span> abbrev-file-name (expand-file-name <span style="font-style: italic;">"abbrev_defs"</span> user-emacs-directory))
  (quietly-read-abbrev-file))
</pre>
</div>
</div>
</li>

<li><a id="org825e8fb"></a>EasyPG (epg)<br />
<div class="outline-text-6" id="text-org825e8fb">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package epg
  <span style="font-weight: bold;">:custom</span>
  (epg-pinentry-mode 'loopback))
</pre>
</div>
</div>
</li>

<li><a id="orgbbe1574"></a>auth-source<br />
<div class="outline-text-6" id="text-orgbbe1574">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package auth-source
  <span style="font-weight: bold;">:custom</span>
  (auth-source-gpg-encrypt-to `(,user-mail-address))
  <span style="font-weight: bold;">:config</span>
  (add-to-list 'auth-sources <span style="font-style: italic;">"~/.netrc.gpg"</span>))

(use-package auth-source-pass
  <span style="font-weight: bold;">:config</span>
  (auth-source-pass-enable))
</pre>
</div>
</div>
</li>

<li><a id="orgc40458d"></a>whitespace<br />
<div class="outline-text-6" id="text-orgc40458d">
<p>
<a href="https://www.gnu.org/software/emacs/manual/html_mono/emacs.html#Useless-Whitespace">emacs#Useless Whitespace</a>
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package whitespace
  <span style="font-weight: bold;">:diminish</span> ((global-whitespace-mode . <span style="font-style: italic;">"Ws"</span>)
             (whitespace-mode . <span style="font-style: italic;">"ws"</span>))
  <span style="font-weight: bold;">:hook</span>
  ((org-mode prog-mode dired-mode) . whitespace-mode)
  (eww-mode . whitespace-turn-off)
  (before-save . delete-trailing-whitespace)
  <span style="font-weight: bold;">:custom</span>
  (whitespace-style
   '(face trailing tabs tab-mark spaces space-mark empty))
  (whitespace-space-regexp <span style="font-style: italic;">"</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">\x3000+</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">"</span>)
  (whitespace-trailing-regexp <span style="font-style: italic;">"</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">[ \t\u00A0]+</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">$"</span>)
  (whitespace-display-mappings
   '((space-mark ?\x3000 [?\u2423])
     (tab-mark   ?\t   [?\u00BB ?\t])))
  <span style="font-weight: bold;">:config</span>
  (global-whitespace-mode -1))
</pre>
</div>
</div>
</li>

<li><a id="orgb9ea885"></a>hippie-exp<br />
<div class="outline-text-6" id="text-orgb9ea885">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package hippie-exp
  <span style="font-weight: bold;">:bind</span> (<span style="font-style: italic;">"M-/"</span> . hippie-expand)
  <span style="font-weight: bold;">:custom</span>
  (hippie-expand-try-functions-list
   '(try-complete-file-name-partially
     try-complete-file-name
     try-expand-dabbrev
     try-expand-dabbrev-all-buffers
     try-expand-dabbrev-from-kill
     try-complete-lisp-symbol-partially
     try-complete-lisp-symbol)))
</pre>
</div>
</div>
</li>

<li><a id="org7775430"></a>bookmark<br />
<div class="outline-text-6" id="text-org7775430">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package bookmark
  <span style="font-weight: bold;">:bind</span> (<span style="font-style: italic;">"C-c b"</span> . bookmark-jump)
  <span style="font-weight: bold;">:custom</span>
  (bookmark-watch-bookmark-file 'silent)
  <span style="font-weight: bold;">:config</span>
  (delight 'bookmark-bmenu-mode <span style="font-style: italic;">" BB"</span>))
</pre>
</div>
</div>
</li>

<li><a id="org9d94e08"></a>find-dired<br />
<div class="outline-text-6" id="text-org9d94e08">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package find-dired
  <span style="font-weight: bold;">:custom</span>
  (find-grep-options <span style="font-style: italic;">"-n -H --no-heading -q"</span>)
  (find-ls-option '(<span style="font-style: italic;">"-print0 | xargs -0 ls -ldN"</span> . <span style="font-style: italic;">"-ldN"</span>)))

(<span style="font-weight: bold;">with-eval-after-load</span> 'hydra
  (defhydra hydra-find-dired (global-map <span style="font-style: italic;">"M-s d"</span>
                                         <span style="font-weight: bold;">:color</span> teal)
    <span style="font-style: italic;">"find dired"</span>
    (<span style="font-style: italic;">"f"</span> find-dired)
    (<span style="font-style: italic;">"F"</span> find-lisp-find-dired)
    (<span style="font-style: italic;">"g"</span> find-grep-dired)
    (<span style="font-style: italic;">"n"</span> find-name-dired)
    (<span style="font-style: italic;">"d"</span> find-lisp-find-dired-subdirectories)
    (<span style="font-style: italic;">"q"</span> nil <span style="font-style: italic;">"quit"</span>)))
</pre>
</div>
</div>
</li>

<li><a id="org0637219"></a>hideshow<br />
<div class="outline-text-6" id="text-org0637219">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package hideshow
  <span style="font-weight: bold;">:diminish</span> <span style="font-style: italic;">"hs"</span>
  <span style="font-weight: bold;">:bind</span> ((<span style="font-style: italic;">"C-c TAB"</span> . hs-toggle-hiding)))
</pre>
</div>
</div>
</li>

<li><a id="org7f20c59"></a>uniquify<br />
<div class="outline-text-6" id="text-org7f20c59">
<p>
<a href="https://www.gnu.org/software/emacs/manual/html_mono/emacs.html#Uniquify">Uniquify</a> makes buffer names unique.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package uniquify
  <span style="font-weight: bold;">:custom</span>
  (uniquify-buffer-name-style 'forward)
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(uniquify-ignore-buffers-re "*[</span><span style="font-weight: bold; font-style: italic;">^</span><span style="font-weight: bold; font-style: italic;">*]+*")</span>
  )
</pre>
</div>
</div>
</li>
<li><a id="orgbb847ce"></a>recentf<br />
<div class="outline-text-6" id="text-orgbb847ce">
<p>
<a href="https://www.gnu.org/software/emacs/manual/html_mono/emacs.html#File-Conveniences">emacs#File Conveniences</a>
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package recentf
  <span style="font-weight: bold;">:custom</span>
  (recentf-exclude '(<span style="font-style: italic;">".gz"</span> <span style="font-style: italic;">".xz"</span> <span style="font-style: italic;">".zip"</span> <span style="font-style: italic;">".gpg"</span>))
  (recentf-max-saved-items 200)
  (recentf-max-menu-items 15)
  (recentf-auto-cleanup <span style="font-style: italic;">"1:23am"</span>)
  <span style="font-weight: bold;">:config</span>
  (recentf-mode 1))
</pre>
</div>
</div>
</li>
<li><a id="org84277bd"></a>server<br />
<div class="outline-text-6" id="text-org84277bd">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package server
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">unless</span> (server-running-p)
    (server-start)))
</pre>
</div>
</div>
</li>
<li><a id="org3c9c212"></a>calc<br />
<div class="outline-text-6" id="text-org3c9c212">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package calc
  <span style="font-weight: bold;">:bind</span> (<span style="font-style: italic;">"&lt;f6&gt;"</span> . calc)
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">setf</span> calc-display-trail nil))
</pre>
</div>
</div>
</li>
<li><a id="orgc042d8a"></a>calendar<br />
<div class="outline-text-6" id="text-orgc042d8a">
<p>
<a href="https://github.com/emacs-jp/japanese-holidays/releases.atom">japanese-holidays</a>
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package calendar
  <span style="font-weight: bold;">:commands</span> calendar
  <span style="font-weight: bold;">:straight</span> japanese-holidays
  <span style="font-weight: bold;">:hook</span>
  ((calendar-today-visible calendar-today-invisible) . japanese-holiday-mark-weekend)
  (calendar-today-visible . calendar-mark-today)
  (calendar-move . my/japanese-holiday-show)
  <span style="font-weight: bold;">:custom</span>
  (calendar-mark-holidays-flag t)
  (japanese-holiday-weekend '(0 6))
  (japanese-holiday-weekend-marker
   '(holiday nil nil nil nil nil japanese-holiday-saturday))
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">japanese-holidays</span>)
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">add 'holiday-general-holidays to calendar-holidays</span>
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">if you want holidays in the U.S. to be counted as your holidays.</span>
  (<span style="font-weight: bold;">setf</span> calendar-holidays
        (append japanese-holidays holiday-local-holidays holiday-other-holidays))
  (bind-keys <span style="font-weight: bold;">:map</span> calendar-mode-map
             (<span style="font-style: italic;">"v"</span> . my/calendar-show-items)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/japanese-holiday-show</span> (<span style="font-weight: bold; text-decoration: underline;">&amp;rest</span> _args)
  <span style="font-style: italic;">"Show holiday information in mini buffer if date on which the cursor is any holidays."</span>
  (<span style="font-weight: bold;">let*</span> ((date (calendar-cursor-to-date t))
         (calendar-date-display-form '((format <span style="font-style: italic;">"%s&#24180; %s&#26376; %s&#26085;&#65288;%s&#65289;"</span> year month day dayname)))
         (date-string (calendar-date-string date))
         (holiday-list (calendar-check-holidays date)))
    (<span style="font-weight: bold;">when</span> holiday-list
      (message <span style="font-style: italic;">"%s: %s"</span> date-string (mapconcat #'identity holiday-list <span style="font-style: italic;">"; "</span>)))))
</pre>
</div>
</div>
</li>

<li><a id="orgf271ba4"></a>proced<br />
<div class="outline-text-6" id="text-orgf271ba4">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package proced
  <span style="font-weight: bold;">:no-require</span> t
  <span style="font-weight: bold;">:custom</span>
  (proced-auto-update-flag t)
  (proced-auto-update-interval 3))
</pre>
</div>
</div>
</li>
<li><a id="org00e7a29"></a>vc (version control)&#xa0;&#xa0;&#xa0;<span class="tag"><span class="maintaining">maintaining</span></span><br />
<ul class="org-ul">
<li><a id="org330c0b6"></a>ediff<br />
<div class="outline-text-7" id="text-org330c0b6">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package ediff
  <span style="font-weight: bold;">:commands</span> ediff-files
  <span style="font-weight: bold;">:custom</span>
  (ediff-window-setup-function 'ediff-setup-windows-default)
  (ediff-split-window-function 'split-window-horizontally))
</pre>
</div>
</div>
</li>
<li><a id="orgf042a84"></a>vc-hooks<br />
<div class="outline-text-7" id="text-orgf042a84">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package vc-hooks
  <span style="font-weight: bold;">:custom</span>
  (vc-follow-symlinks t))
</pre>
</div>
</div>
</li>
</ul>
</li>
<li><a id="org1996df9"></a>re-builder<br />
<div class="outline-text-6" id="text-org1996df9">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package re-builder
  <span style="font-weight: bold;">:custom</span>
  (reb-re-syntax 'string))
</pre>
</div>
</div>
</li>
<li><a id="org386ef7c"></a>isearch<br />
<div class="outline-text-6" id="text-org386ef7c">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package isearch
  <span style="font-weight: bold;">:diminish</span> <span style="font-style: italic;">"is"</span>
  <span style="font-weight: bold;">:config</span>
  (bind-keys <span style="font-weight: bold;">:map</span> isearch-mode-map
             (<span style="font-style: italic;">"C-j"</span> . isearch-exit)))
</pre>
</div>
</div>
</li>

<li><a id="org5e722f0"></a>imenu&#xa0;&#xa0;&#xa0;<span class="tag"><span class="programs">programs</span></span><br />
<div class="outline-text-6" id="text-org5e722f0">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package imenu
  <span style="font-weight: bold;">:custom</span>
  (imenu-auto-rescan t))
</pre>
</div>
</div>
</li>
<li><a id="orgbb78b5a"></a>flyspell&#xa0;&#xa0;&#xa0;<span class="tag"><span class="fixit">fixit</span></span><br />
<div class="outline-text-6" id="text-orgbb78b5a">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package flyspell
  <span style="font-weight: bold;">:diminish</span> <span style="font-style: italic;">"fs"</span>
  <span style="font-weight: bold;">:if</span> (executable-find <span style="font-style: italic;">"aspell"</span>)
  <span style="font-weight: bold;">:after</span> (hydra)
  <span style="font-weight: bold;">:custom</span>
  (ispell-program-name <span style="font-style: italic;">"aspell"</span>)
  (flyspell-issue-message-flag nil)
  <span style="font-weight: bold;">:config</span>
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">avoid checking for Japanese characters</span>
  (add-to-list 'ispell-skip-region-alist '(<span style="font-style: italic;">"[</span><span style="font-style: italic;">^</span><span style="font-style: italic;">\000-\377]+"</span>))
  (<span style="font-weight: bold;">setq-default</span> ispell-extra-args '(<span style="font-style: italic;">"--sug-mode=ultra"</span>
                                    <span style="font-style: italic;">"--lang=en_US"</span>))
  (<span style="font-weight: bold;">when</span> (string-match-p <span style="font-style: italic;">"--camel-case"</span>
                        (shell-command-to-string (concat ispell-program-name <span style="font-style: italic;">" --help"</span>)))
    (<span style="font-weight: bold;">push</span> <span style="font-style: italic;">"--camel-case"</span> ispell-extra-args))
  (bind-keys <span style="font-weight: bold;">:map</span> flyspell-mode-map
             (<span style="font-style: italic;">"C-,"</span>   . nil)
             (<span style="font-style: italic;">"C-."</span>   . nil)
             (<span style="font-style: italic;">"C-;"</span>   . nil)
             (<span style="font-style: italic;">"C-c $"</span> . nil)
             (<span style="font-style: italic;">"C-M-i"</span> . nil))
  (defhydra hydra-flyspell (flyspell-mode-map <span style="font-style: italic;">"C-c $"</span>
                                              <span style="font-weight: bold;">:color</span> red)
    <span style="font-style: italic;">"Flyspell"</span>
    (<span style="font-style: italic;">"c"</span> flyspell-buffer)
    (<span style="font-style: italic;">"n"</span> flyspell-goto-next-error)
    (<span style="font-style: italic;">"."</span> flyspell-auto-correct-word)
    (<span style="font-style: italic;">"q"</span> nil <span style="font-style: italic;">"quit"</span>)))
</pre>
</div>
</div>
</li>
<li><a id="org5f977a0"></a><a id="ID-a55da7a2-6525-4788-ba56-085eb61928d4"></a>help&#xa0;&#xa0;&#xa0;<span class="tag"><span class="help">help</span></span><br />
<div class="outline-text-6" id="text-org5f977a0">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package help-mode
  <span style="font-weight: bold;">:delight</span> <span style="font-style: italic;">" HE"</span>
  <span style="font-weight: bold;">:config</span>
  (bind-key <span style="font-style: italic;">"C-M-h"</span> help-map)
  (bind-keys <span style="font-weight: bold;">:map</span> help-map
             (<span style="font-style: italic;">"C-h"</span> . nil) <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">for which-key</span>
             (<span style="font-style: italic;">"c"</span> . describe-face)
             (<span style="font-style: italic;">"C-l"</span> . find-library)
             <span style="font-weight: bold;">:map</span> help-mode-map
             (<span style="font-style: italic;">"f"</span> . scroll-up-line)
             (<span style="font-style: italic;">"e"</span> . scroll-down-line)
             (<span style="font-style: italic;">"SPC"</span> . my/forward-paragraph)
             (<span style="font-style: italic;">"E"</span> . my/backward-paragraph)
             (<span style="font-style: italic;">"2"</span> . backward-button)
             (<span style="font-style: italic;">"3"</span> . forward-button)
             (<span style="font-style: italic;">"4"</span> . push-button)))
</pre>
</div>
</div>
</li>
<li><a id="orgd4d089a"></a>info&#xa0;&#xa0;&#xa0;<span class="tag"><span class="help">help</span></span><br />
<div class="outline-text-6" id="text-orgd4d089a">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package Info
  <span style="font-weight: bold;">:defer</span> t
  <span style="font-weight: bold;">:bind</span> (<span style="font-weight: bold;">:map</span> Info-mode-map
              (<span style="font-style: italic;">"C-j"</span> . Info-follow-nearest-node)
              (<span style="font-style: italic;">"C-c C-o"</span> . Info-follow-nearest-node)
              (<span style="font-style: italic;">"a"</span>   . info-apropos)
              <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">lazy control</span>
              (<span style="font-style: italic;">"f"</span> . scroll-up-line)
              (<span style="font-style: italic;">"e"</span> . scroll-down-line)
              (<span style="font-style: italic;">"SPC"</span> . my/forward-paragraph)
              (<span style="font-style: italic;">"E"</span> . my/backward-paragraph)
              (<span style="font-style: italic;">"1"</span> . Info-history-back)
              (<span style="font-style: italic;">"2"</span> . Info-prev-reference)
              (<span style="font-style: italic;">"3"</span> . Info-next-reference)
              (<span style="font-style: italic;">"4"</span> . Info-follow-nearest-node)
              (<span style="font-style: italic;">"5"</span> . Info-history-forward))
  <span style="font-weight: bold;">:custom</span>
  (Info-use-header-line nil)
  (Info-additional-directory-list
   (append `(,(expand-file-name <span style="font-style: italic;">"~/.local/share/info"</span>))))
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">info-look</span>)
  (autoload 'info-lookup-add-help <span style="font-style: italic;">"info-look"</span>))
</pre>
</div>
</div>
</li>
<li><a id="org9bce498"></a>tramp<br />
<div class="outline-text-6" id="text-org9bce498">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package tramp
  <span style="font-weight: bold;">:defer</span> t
  <span style="font-weight: bold;">:custom</span>
  (tramp-default-method <span style="font-style: italic;">"ssh"</span>)
  <span style="font-weight: bold;">:config</span>
  (add-to-list 'tramp-remote-path 'tramp-own-remote-path)
  (add-to-list 'tramp-remote-path <span style="font-style: italic;">"~/bin"</span>))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">sudo</span> ()
  <span style="font-style: italic;">"Use TRAMP to `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">sudo</span><span style="font-style: italic;">' the current buffer"</span>
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">when</span> buffer-file-name
    (find-alternate-file
     (concat <span style="font-style: italic;">"/sudo:root@localhost:"</span>
             buffer-file-name))))
</pre>
</div>
</div>
</li>

<li><a id="orge79acd0"></a>view<br />
<div class="outline-text-6" id="text-orge79acd0">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package view
  <span style="font-weight: bold;">:diminish</span> view-mode <span style="font-style: italic;">"vw"</span>)
</pre>
</div>
</div>
</li>
<li><a id="orgd9e6a0b"></a>woman&#xa0;&#xa0;&#xa0;<span class="tag"><span class="programs">programs</span></span><br />
<div class="outline-text-6" id="text-orgd9e6a0b">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package woman
  <span style="font-weight: bold;">:defer</span> t
  <span style="font-weight: bold;">:delight</span> <span style="font-style: italic;">" WM"</span>
  <span style="font-weight: bold;">:config</span>
  (bind-keys <span style="font-weight: bold;">:map</span> woman-mode-map
             (<span style="font-style: italic;">"f"</span> . scroll-up-line)
             (<span style="font-style: italic;">"e"</span> . scroll-down-line)
             (<span style="font-style: italic;">"SPC"</span> . my/forward-paragraph)
             (<span style="font-style: italic;">"E"</span> . my/backward-paragraph)
             (<span style="font-style: italic;">"2"</span> . backward-button)
             (<span style="font-style: italic;">"3"</span> . forward-button)
             (<span style="font-style: italic;">"4"</span> . push-button)))
</pre>
</div>
</div>
</li>
<li><a id="orgb51e1ae"></a>executable<br />
<div class="outline-text-6" id="text-orgb51e1ae">
<p>
This customization is based on <a href="https://emacsredux.com/blog/2021/09/29/make-script-files-executable-automatically/">this advice</a>
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package executable
  <span style="font-weight: bold;">:hook</span> (after-save
         . executable-make-buffer-file-executable-if-script-p))
</pre>
</div>
</div>
</li>
<li><a id="orgb0a1e9c"></a>paren<br />
<div class="outline-text-6" id="text-orgb0a1e9c">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package paren
  <span style="font-weight: bold;">:custom</span>
  (show-paren-style 'parenthesis)
  (show-paren-delay 0.25)
  <span style="font-weight: bold;">:config</span>
  (show-paren-mode -1))
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="orgd184ddd"></a>input method<br />
<div class="outline-text-5" id="text-orgd184ddd">
</div>

<ul class="org-ul">
<li><a id="org9b981a9"></a>ddskk<br />
<div class="outline-text-6" id="text-org9b981a9">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-ddskk"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-style: italic;">"https://github.com/skk-dev/ddskk/releases.atom"</span> soft_update)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">skk-dir</span> (expand-file-name <span style="font-style: italic;">"~/share/skk"</span>))
(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">skk-dotemacs-dir</span> (expand-file-name <span style="font-style: italic;">"ddskk"</span> user-emacs-directory-default))
(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">skk-dotskk-dir</span> (expand-file-name <span style="font-style: italic;">"~/.config/skk"</span>))

(use-package ddskk
  <span style="font-weight: bold;">:defer</span> t
  <span style="font-weight: bold;">:bind</span> (<span style="font-style: italic;">"C-x j"</span> . skk-mode)
  <span style="font-weight: bold;">:init</span>
  (custom-set-variables '(default-input-method <span style="font-style: italic;">"japanese-skk"</span>))
  (<span style="font-weight: bold;">defface</span> <span style="font-weight: bold; font-style: italic;">skk-candidate</span> `((t . (<span style="font-weight: bold;">:font</span> <span style="font-style: italic;">"fontset-default"</span>
                                       <span style="font-weight: bold;">:height</span> ,(my-adjust-font-size 860))))
    <span style="font-style: italic;">"Default face for ddskk candidates."</span>
    <span style="font-weight: bold;">:group</span> 'skk-dcomp)
  <span style="font-weight: bold;">:custom</span>
  (skk-kakutei-key (kbd <span style="font-style: italic;">"C-m"</span>))
  (skk-user-directory (expand-file-name <span style="font-style: italic;">"ddskk"</span> user-emacs-directory))
  (skk-init-file (expand-file-name <span style="font-style: italic;">"init"</span> skk-dotemacs-dir))
  (skk-byte-compile-init-file t)
  (skk-tut-file
   (expand-file-name <span style="font-style: italic;">"etc/SKK.tut"</span> (straight--repos-dir <span style="font-style: italic;">"ddskk"</span>)))
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">cursor color</span>
  (skk-use-color-cursor t)
  (skk-cursor-hiragana-color <span style="font-style: italic;">"orange"</span>)
  (skk-cursor-katakana-color <span style="font-style: italic;">"SpringGreen3"</span>)
  (skk-cursor-latin-color <span style="font-style: italic;">"DodgerBlue3"</span>)
  (skk-cursor-jisx0201-color <span style="font-style: italic;">"purple3"</span>)
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">mode line string</span>
  (skk-latin-mode-string <span style="font-style: italic;">"A"</span>)
  (skk-hiragana-mode-string <span style="font-style: italic;">"&#12354;"</span>)
  (skk-katakana-mode-string <span style="font-style: italic;">"&#12450;"</span>)
  (skk-jisx0201-mode-string <span style="font-style: italic;">"&#65393;"</span>)
  (skk-jisx0208-latin-mode-string <span style="font-style: italic;">"&#65313;"</span>)
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">AZIK</span>
  (skk-use-azik t)
  (skk-azik-keyboard-type 'us101)
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">conversion</span>
  (skk-egg-like-newline t)
  (skk-henkan-strict-okuri-precedence t)
  (skk-check-okurigana-on-touroku t)
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">annotation</span>
  (skk-show-annotation t)
  (skk-annotation-delay 0.3)
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">how candidates behave</span>
  (skk-show-candidates-always-pop-to-buffer t)
  (skk-henkan-number-to-display-candidates 10)
  (skk-show-candidates-nth-henkan-char 3)
  (skk-henkan-show-candidates-keys
   '(?1 ?2 ?3 ?4 ?5 ?6 ?7 ?8 ?9 ?0))
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">set face for candidates list</span>
  (skk-treat-candidate-appearance-function
   (<span style="font-weight: bold;">lambda</span> (candidate listing-p)
     (<span style="font-weight: bold;">cond</span>
      ((string-match <span style="font-style: italic;">";"</span> candidate)
       (put-text-property 0 (match-beginning 0)
                          'face 'skk-candidate
                          candidate)
       (put-text-property (match-beginning 0)
                          (length candidate) 'face 'shadow candidate))
      (t
       (put-text-property 0 (length candidate)
                          'face 'skk-candidate
                          candidate)))
     candidate))
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">bind C-q for hankaku-kana input mode</span>
  (skk-use-jisx0201-input-method t)
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">dynamic conversion</span>
  (skk-dcomp-activate nil)
  (skk-dcomp-multiple-activate nil)
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">config file</span>
  (skk-record-file (expand-file-name <span style="font-style: italic;">"record"</span> skk-dir))
  (skk-emacs-id-file (expand-file-name <span style="font-style: italic;">"emacs-id"</span> skk-dir))
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">jisyo</span>
  (skk-share-private-jisyo t)
  (skk-compare-jisyo-size-when-saving t)
  (skk-save-jisyo-instantly t)
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">jisyo file/directory</span>
  (skk-get-jisyo-directory (expand-file-name <span style="font-style: italic;">"get-jisyo"</span> skk-dir))
  (skk-jisyo `(,(expand-file-name <span style="font-style: italic;">"jisyo"</span> skk-dotskk-dir) . utf-8))
  (skk-backup-jisyo (expand-file-name <span style="font-style: italic;">"jisyo.bak"</span> skk-dir))
  (skk-large-jisyo (expand-file-name <span style="font-style: italic;">"SKK-JISYO.L"</span> skk-get-jisyo-directory))
  (skk-itaiji-jisyo (expand-file-name <span style="font-style: italic;">"SKK-JISYO.itaiji"</span> skk-get-jisyo-directory))
  (skk-extra-jisyo-file-list
   (seq-remove (<span style="font-weight: bold;">lambda</span> (dic)
                 (seq-some (<span style="font-weight: bold;">lambda</span> (suffix)
                             (string-suffix-p (symbol-name suffix) dic))
                           '(L itaiji tar)))
               (append (file-expand-wildcards (expand-file-name <span style="font-style: italic;">"SKK-JISYO.*"</span> skk-get-jisyo-directory))
                       (file-expand-wildcards (expand-file-name <span style="font-style: italic;">"open-jisyo/SKK-JISYO.*"</span> skk-dir)))))
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">jisyo server</span>
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(skk-server-host "localhost")</span>
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(skk-server-portnum 1178)</span>
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(skk-server-inhibit-startup-server t)</span>
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">study</span>
  (skk-study-file (expand-file-name <span style="font-style: italic;">"study"</span> skk-dir))
  (skk-study-backup-file (expand-file-name <span style="font-style: italic;">"study.bak"</span> skk-dir)))
</pre>
</div>
</div>
</li>

<li><a id="org59a1b25"></a>skk init file<br />
<div class="outline-text-6" id="text-org59a1b25">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">-*- mode:emacs-lisp; -*-</span>
(<span style="font-weight: bold;">setq</span> skk-rom-kana-rule-list
      (append skk-rom-kana-rule-list
              '((<span style="font-style: italic;">"!"</span> nil skk-purge-from-jisyo)
                (<span style="font-style: italic;">"xka"</span> nil (<span style="font-style: italic;">"&#12533;"</span> . <span style="font-style: italic;">"&#12533;"</span>))
                (<span style="font-style: italic;">"xke"</span> nil (<span style="font-style: italic;">"&#12534;"</span> . <span style="font-style: italic;">"&#12534;"</span>))
                (<span style="font-style: italic;">"n"</span> nil nil)
                (<span style="font-style: italic;">"nn"</span> nil (<span style="font-style: italic;">"&#12490;&#12494;"</span> . <span style="font-style: italic;">"&#12394;&#12398;"</span>))
                (<span style="font-style: italic;">"nm"</span> nil (<span style="font-style: italic;">"&#12494;&#12511;"</span> . <span style="font-style: italic;">"&#12398;&#12415;"</span>))
                (<span style="font-style: italic;">"ks"</span> nil (<span style="font-style: italic;">"&#12467;&#12477;"</span> . <span style="font-style: italic;">"&#12371;&#12381;"</span>))
                (<span style="font-style: italic;">"kz"</span> nil (<span style="font-style: italic;">"&#12467;&#12494;"</span> . <span style="font-style: italic;">"&#12371;&#12398;"</span>))
                (<span style="font-style: italic;">"ym"</span> nil (<span style="font-style: italic;">"&#12516;&#12510;"</span> . <span style="font-style: italic;">"&#12420;&#12414;"</span>))
                (<span style="font-style: italic;">"yk"</span> nil (<span style="font-style: italic;">"&#12518;&#12461;"</span> . <span style="font-style: italic;">"&#12422;&#12365;"</span>))
                (<span style="font-style: italic;">"tga"</span> nil (<span style="font-style: italic;">"&#12479;&#12460;"</span> . <span style="font-style: italic;">"&#12383;&#12364;"</span>))
                (<span style="font-style: italic;">"vj"</span> nil (<span style="font-style: italic;">"&#12532;&#12531;"</span> . <span style="font-style: italic;">"&#12406;&#12435;"</span>))
                <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">followings are for preventing from changing to zenkaku eisu mode by pressing 'L'</span>
                (<span style="font-style: italic;">"bL"</span> nil (<span style="font-style: italic;">"&#12508;&#12531;"</span> . <span style="font-style: italic;">"&#12412;&#12435;"</span>))
                (<span style="font-style: italic;">"byL"</span> nil (<span style="font-style: italic;">"&#12499;&#12519;&#12531;"</span> . <span style="font-style: italic;">"&#12403;&#12423;&#12435;"</span>))
                (<span style="font-style: italic;">"cL"</span> nil (<span style="font-style: italic;">"&#12481;&#12519;&#12531;"</span> . <span style="font-style: italic;">"&#12385;&#12423;&#12435;"</span>))
                (<span style="font-style: italic;">"dL"</span> nil (<span style="font-style: italic;">"&#12489;&#12531;"</span> . <span style="font-style: italic;">"&#12393;&#12435;"</span>))
                (<span style="font-style: italic;">"fL"</span> nil (<span style="font-style: italic;">"&#12501;&#12457;&#12531;"</span> . <span style="font-style: italic;">"&#12405;&#12361;&#12435;"</span>))
                (<span style="font-style: italic;">"gL"</span> nil (<span style="font-style: italic;">"&#12468;&#12531;"</span> . <span style="font-style: italic;">"&#12372;&#12435;"</span>))
                (<span style="font-style: italic;">"gyL"</span> nil (<span style="font-style: italic;">"&#12462;&#12519;&#12531;"</span> . <span style="font-style: italic;">"&#12366;&#12423;&#12435;"</span>))
                (<span style="font-style: italic;">"hL"</span> nil (<span style="font-style: italic;">"&#12507;&#12531;"</span> . <span style="font-style: italic;">"&#12411;&#12435;"</span>))
                (<span style="font-style: italic;">"hgL"</span> nil (<span style="font-style: italic;">"&#12498;&#12519;&#12531;"</span> . <span style="font-style: italic;">"&#12402;&#12423;&#12435;"</span>))
                (<span style="font-style: italic;">"hyL"</span> nil (<span style="font-style: italic;">"&#12498;&#12519;&#12531;"</span> . <span style="font-style: italic;">"&#12402;&#12423;&#12435;"</span>))
                (<span style="font-style: italic;">"jL"</span> nil (<span style="font-style: italic;">"&#12472;&#12519;&#12531;"</span> . <span style="font-style: italic;">"&#12376;&#12423;&#12435;"</span>))
                (<span style="font-style: italic;">"kL"</span> nil (<span style="font-style: italic;">"&#12467;&#12531;"</span> . <span style="font-style: italic;">"&#12371;&#12435;"</span>))
                (<span style="font-style: italic;">"kgL"</span> nil (<span style="font-style: italic;">"&#12461;&#12519;&#12531;"</span> . <span style="font-style: italic;">"&#12365;&#12423;&#12435;"</span>))
                (<span style="font-style: italic;">"kyL"</span> nil (<span style="font-style: italic;">"&#12461;&#12519;&#12531;"</span> . <span style="font-style: italic;">"&#12365;&#12423;&#12435;"</span>))
                (<span style="font-style: italic;">"mL"</span> nil (<span style="font-style: italic;">"&#12514;&#12531;"</span> . <span style="font-style: italic;">"&#12418;&#12435;"</span>))
                (<span style="font-style: italic;">"mgL"</span> nil (<span style="font-style: italic;">"&#12511;&#12519;&#12531;"</span> . <span style="font-style: italic;">"&#12415;&#12423;&#12435;"</span>))
                (<span style="font-style: italic;">"myL"</span> nil (<span style="font-style: italic;">"&#12511;&#12519;&#12531;"</span> . <span style="font-style: italic;">"&#12415;&#12423;&#12435;"</span>))
                (<span style="font-style: italic;">"nL"</span> nil (<span style="font-style: italic;">"&#12494;&#12531;"</span> . <span style="font-style: italic;">"&#12398;&#12435;"</span>))
                (<span style="font-style: italic;">"ngL"</span> nil (<span style="font-style: italic;">"&#12491;&#12519;&#12531;"</span> . <span style="font-style: italic;">"&#12395;&#12423;&#12435;"</span>))
                (<span style="font-style: italic;">"nyL"</span> nil (<span style="font-style: italic;">"&#12491;&#12519;&#12531;"</span> . <span style="font-style: italic;">"&#12395;&#12423;&#12435;"</span>))
                (<span style="font-style: italic;">"pL"</span> nil (<span style="font-style: italic;">"&#12509;&#12531;"</span> . <span style="font-style: italic;">"&#12413;&#12435;"</span>))
                (<span style="font-style: italic;">"pgL"</span> nil (<span style="font-style: italic;">"&#12500;&#12519;&#12531;"</span> . <span style="font-style: italic;">"&#12404;&#12423;&#12435;"</span>))
                (<span style="font-style: italic;">"pyL"</span> nil (<span style="font-style: italic;">"&#12500;&#12519;&#12531;"</span> . <span style="font-style: italic;">"&#12404;&#12423;&#12435;"</span>))
                (<span style="font-style: italic;">"rL"</span> nil (<span style="font-style: italic;">"&#12525;&#12531;"</span> . <span style="font-style: italic;">"&#12429;&#12435;"</span>))
                (<span style="font-style: italic;">"ryL"</span> nil (<span style="font-style: italic;">"&#12522;&#12519;&#12531;"</span> . <span style="font-style: italic;">"&#12426;&#12423;&#12435;"</span>))
                (<span style="font-style: italic;">"sL"</span> nil (<span style="font-style: italic;">"&#12477;&#12531;"</span> . <span style="font-style: italic;">"&#12381;&#12435;"</span>))
                (<span style="font-style: italic;">"syL"</span> nil (<span style="font-style: italic;">"&#12471;&#12519;&#12531;"</span> . <span style="font-style: italic;">"&#12375;&#12423;&#12435;"</span>))
                (<span style="font-style: italic;">"tL"</span> nil (<span style="font-style: italic;">"&#12488;&#12531;"</span> . <span style="font-style: italic;">"&#12392;&#12435;"</span>))
                (<span style="font-style: italic;">"tyL"</span> nil (<span style="font-style: italic;">"&#12481;&#12519;&#12531;"</span> . <span style="font-style: italic;">"&#12385;&#12423;&#12435;"</span>))
                (<span style="font-style: italic;">"vL"</span> nil (<span style="font-style: italic;">"&#12532;&#12457;&#12531;"</span> . <span style="font-style: italic;">"&#12358;&#12443;&#12361;&#12435;"</span>))
                (<span style="font-style: italic;">"wL"</span> nil (<span style="font-style: italic;">"&#12454;&#12457;&#12531;"</span> . <span style="font-style: italic;">"&#12358;&#12361;&#12435;"</span>))
                (<span style="font-style: italic;">"xL"</span> nil (<span style="font-style: italic;">"&#12471;&#12519;&#12531;"</span> . <span style="font-style: italic;">"&#12375;&#12423;&#12435;"</span>))
                (<span style="font-style: italic;">"xxL"</span> nil (<span style="font-style: italic;">"&#8594;"</span> . <span style="font-style: italic;">"&#8594;"</span>))
                (<span style="font-style: italic;">"yL"</span> nil (<span style="font-style: italic;">"&#12520;&#12531;"</span> . <span style="font-style: italic;">"&#12424;&#12435;"</span>))
                (<span style="font-style: italic;">"zL"</span> nil (<span style="font-style: italic;">"&#12478;&#12531;"</span> . <span style="font-style: italic;">"&#12382;&#12435;"</span>))
                (<span style="font-style: italic;">"zyL"</span> nil (<span style="font-style: italic;">"&#12472;&#12519;&#12531;"</span> . <span style="font-style: italic;">"&#12376;&#12423;&#12435;"</span>)))))

(add-hook 'skk-azik-load-hook
          (<span style="font-weight: bold;">lambda</span> ()
            (<span style="font-weight: bold;">dolist</span> (key '(<span style="font-style: italic;">"kA"</span> <span style="font-style: italic;">"kE"</span> <span style="font-style: italic;">"tU"</span> <span style="font-style: italic;">"wA"</span>))
              (<span style="font-weight: bold;">setq</span> skk-rom-kana-rule-list
                    (skk-del-alist key skk-rom-kana-rule-list)))))
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="org3731b44"></a>theme<br />
<div class="outline-text-5" id="text-org3731b44">
</div>
<ul class="org-ul">
<li><a id="org3f58c5d"></a>modus-themes<br />
<div class="outline-text-6" id="text-org3f58c5d">
<p>
I love modus-theme which <a href="https://protesilaos.com/codelog/2019-08-07-emacs-modus-themes/">conforms to WCAG AAA</a>
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-modus-themes"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package modus-themes
  <span style="font-weight: bold;">:init</span>
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Add all your customizations prior to loading the themes</span>
  (<span style="font-weight: bold;">setq</span> modus-themes-italic-constructs t
        modus-themes-bold-constructs nil
        modus-themes-region '(bg-only no-extend))
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Load the theme files before enabling a theme</span>
  (modus-themes-load-themes)
  <span style="font-weight: bold;">:config</span>
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Load the theme of your choice:</span>
  (modus-themes-load-vivendi)
  <span style="font-weight: bold;">:bind</span> (<span style="font-style: italic;">"&lt;f5&gt;"</span> . modus-themes-toggle))
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="org5c44ce8"></a>EWW<br />
<div class="outline-text-5" id="text-org5c44ce8">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package eww
  <span style="font-weight: bold;">:delight</span> <span style="font-style: italic;">" EW"</span>
  <span style="font-weight: bold;">:hook</span>
  (eww-after-render . my/eww-rename-buffer)
  <span style="font-weight: bold;">:custom</span>
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">set enough large column number to prevent from inserting line break</span>
  (shr-width 10000)
  (shr-use-fonts nil)
  (shr-image-animate t)
  (eww-header-line-format nil)
  (shr-max-image-proportion 0.4)
  <span style="font-weight: bold;">:config</span>
  (bind-keys <span style="font-weight: bold;">:map</span> eww-mode-map
             (<span style="font-style: italic;">"f"</span> . scroll-up-line)
             (<span style="font-style: italic;">"e"</span> . scroll-down-line)
             (<span style="font-style: italic;">"SPC"</span> . my/forward-paragraph)
             (<span style="font-style: italic;">"E"</span> . my/backward-paragraph)
             (<span style="font-style: italic;">"C"</span> . eww-set-character-encoding)
             (<span style="font-style: italic;">"1"</span> . eww-back-url)
             (<span style="font-style: italic;">"2"</span> . shr-next-link)
             (<span style="font-style: italic;">"4"</span> . eww-follow-link)
             (<span style="font-style: italic;">"C-j"</span> . eww-follow-link)
             (<span style="font-style: italic;">"T"</span> . eww-goto-title-heading)
             (<span style="font-style: italic;">"L"</span> . my/eww-goto-heading)
             (<span style="font-style: italic;">"O"</span> . my/eww-convert-to-org)
             <span style="font-weight: bold;">:map</span> eww-bookmark-mode-map
             (<span style="font-style: italic;">"C-j"</span> . eww-bookmark-browse)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/eww-rename-buffer</span> ()
  <span style="font-style: italic;">"Rename the name of current EWW buffer.</span>

<span style="font-style: italic;">If associated HTML file have a title tag, use title as a buffer name.</span>
<span style="font-style: italic;">Otherwise, use a current URL."</span>
  (<span style="font-weight: bold;">let</span> ((title (plist-get eww-data <span style="font-weight: bold;">:title</span>))
        (url (file-name-base (eww-current-url))))
    (rename-buffer (format <span style="font-style: italic;">"eww: %s"</span> (<span style="font-weight: bold;">or</span> (<span style="font-weight: bold;">if</span> (<span style="font-weight: bold;">and</span> title (&gt; (length title) 0))
                                             title nil)
                                         url <span style="font-style: italic;">""</span>)) <span style="font-weight: bold;">t)))</span>

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/eww-convert-to-org</span> ()
  <span style="font-style: italic;">"Convert current html page into one org file and show it.</span>

<span style="font-style: italic;">This is handy if you would like to check a page index comfortably."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">let</span> ((source (plist-get eww-data <span style="font-weight: bold;">:source</span>))
        (src-html (make-temp-file <span style="font-style: italic;">"source-"</span>))
        (dst-org (expand-file-name (format <span style="font-style: italic;">"%s.org"</span> (org-id-uuid)) <span style="font-style: italic;">"~/tmp"</span>))
        (coding-system-for-write 'utf-8-unix)
        (org-startup-folded t))
    (<span style="font-weight: bold;">with-temp-buffer</span>
      (insert source)
      (write-region (point-min) (point-max) src-html nil)
      (call-process-shell-command (format <span style="font-style: italic;">"pandoc %s -f html -t org -o %s"</span>
                                          (shell-quote-argument src-html)
                                          (shell-quote-argument dst-org)))
      (delete-file src-html))
    (find-file dst-org t)
    (goto-char (point-min))
    (org-ctrl-c-tab)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">eww-headings-dom</span> ()
  <span style="font-style: italic;">"Return heading list as a dom from xml."</span>
  (<span style="font-weight: bold;">let</span> ((source (plist-get eww-data <span style="font-weight: bold;">:source</span>))
        (dom nil))
    (<span style="font-weight: bold;">with-temp-buffer</span>
      (<span style="font-weight: bold;">let</span> ((source-file (make-temp-file <span style="font-style: italic;">"source-"</span>))
            (coding-system-for-write 'utf-8-unix))
        (insert source)
        (write-region (point-min) (point-max) source-file nil)
        (erase-buffer)
        (call-process <span style="font-style: italic;">"extract_headings"</span> source-file t)
        (delete-file source-file)
        (libxml-parse-xml-region (point-min) (point-max))))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">eww-goto-title-heading</span> ()
  <span style="font-style: italic;">"Set point to a line which contaings the possible heading."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (when-let* ((headings-dom (eww-headings-dom))
              (possible-heading (cl-reduce (<span style="font-weight: bold;">lambda</span> (node-a node-b)
                                             (<span style="font-weight: bold;">if</span> (not (<span style="font-weight: bold;">bound-and-true-p</span> node-a))
                                                 (<span style="font-weight: bold;">if</span> (not (<span style="font-weight: bold;">bound-and-true-p</span> node-b))
                                                     nil
                                                   node-b)
                                               (<span style="font-weight: bold;">if</span> (&gt;= (string-to-number (dom-attr node-a 'proximity))
                                                       (string-to-number (dom-attr node-b 'proximity)))
                                                   node-a node-b)))
                                           (dom-children headings-dom)
                                           <span style="font-weight: bold;">:initial-value</span> nil))
              (possible-text (dom-text possible-heading))
              (match-pos (<span style="font-weight: bold;">or</span> (re-search-forward (format <span style="font-style: italic;">"^*?[[:blank:]]*%s[[:blank:]]*$"</span> (regexp-quote possible-text)) nil t 1)
                             (re-search-backward (format <span style="font-style: italic;">"^*?[[:blank:]]*%s[[:blank:]]*$"</span> (regexp-quote possible-text)) nil t 1))))
    (beginning-of-line)
    (recenter-top-bottom 0)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/eww-goto-heading</span> ()
  <span style="font-style: italic;">"Go to selected heading line."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">setq</span> lexical-binding t)
  (when-let* ((headings-root (eww-headings-dom))
              (cur-buf (current-buffer))
              (heading (completing-read
                        <span style="font-style: italic;">"Heading : "</span>
                        (mapcar (<span style="font-weight: bold;">lambda</span> (heading-node)
                                  (when-let* ((heading (dom-text heading-node))
                                              (tag (symbol-name (dom-tag heading-node)))
                                              (match-pos (string-match <span style="font-style: italic;">"h</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">[1-6]\\{1\\}</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">"</span> tag))
                                              (indent (- (string-to-number (match-string 1 tag)) 1)))
                                    (format <span style="font-style: italic;">"%s%s"</span>
                                            (apply 'concat (make-list indent <span style="font-style: italic;">"  "</span>))
                                            heading)))
                                (dom-children headings-root))))
              (match (string-match <span style="font-style: italic;">"</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(?:</span><span style="font-style: italic;">  </span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">*</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">.*</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">"</span> heading))
              (heading (match-string 1 heading))
              (match-pos (<span style="font-weight: bold;">or</span> (re-search-forward (build-regex heading) nil t 1)
                             (re-search-backward (build-regex heading) nil t 1))))
    (<span style="font-weight: bold;">with-current-buffer</span> cur-buf
      (switch-to-buffer cur-buf)
      (beginning-of-line)
      (recenter-top-bottom 0))))

(<span style="font-weight: bold;">defmacro</span> <span style="font-weight: bold;">build-regex</span> (str)
  <span style="font-style: italic;">"Return a regexp representation for `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">STR</span><span style="font-style: italic;">'."</span>
  `(format <span style="font-style: italic;">"^[[:blank:]SVG Image]*%s[[:blank:]]*$"</span>
           ,str))
</pre>
</div>
</div>

<ul class="org-ul">
<li><a id="orgf44f7d9"></a>extract<sub>headings</sub><br />
<div class="outline-text-6" id="text-orgf44f7d9">
<div class="org-src-container">
<pre class="src src-python"><span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">!/usr/bin/env python3</span>

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">This script extract most probable page heading.</span>

<span style="font-weight: bold;">import</span> sys
<span style="font-weight: bold;">import</span> lxml.html <span style="font-weight: bold;">as</span> html
<span style="font-weight: bold;">from</span> lxml <span style="font-weight: bold;">import</span> etree
<span style="font-weight: bold;">import</span> difflib

<span style="font-weight: bold;">if</span> <span style="font-weight: bold;">len</span>(sys.argv) == 1:
    <span style="font-weight: bold; font-style: italic;">INPUT_STR</span> = sys.stdin.read()
    <span style="font-weight: bold; font-style: italic;">ROOT</span> = html.fromstring(INPUT_STR).getroottree()
<span style="font-weight: bold;">else</span>:
    sys.<span style="font-weight: bold; text-decoration: underline;">exit</span>(1)

<span style="font-weight: bold; font-style: italic;">OUT_ROOT</span> = etree.Element(<span style="font-style: italic;">"headings"</span>)

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">extract title text</span>
<span style="font-weight: bold; font-style: italic;">title</span> = <span style="font-style: italic;">''</span>
<span style="font-weight: bold; font-style: italic;">title_text_arr</span> = ROOT.xpath(<span style="font-style: italic;">'//title[1]//text()'</span>)
<span style="font-weight: bold;">if</span> <span style="font-weight: bold;">len</span>(title_text_arr):
    <span style="font-weight: bold; font-style: italic;">title</span> = title_text_arr[0]
    OUT_ROOT.<span style="font-weight: bold;">set</span>(<span style="font-style: italic;">"title"</span>, title.strip())

<span style="font-weight: bold; font-style: italic;">htag_text_arr</span> = ROOT.xpath(<span style="font-style: italic;">'//*[self::h1 or self::h2 or self::h3 or self::h4 or self::h5 or self::h6]'</span>)
<span style="font-weight: bold;">for</span> i <span style="font-weight: bold;">in</span> <span style="font-weight: bold;">range</span>(<span style="font-weight: bold;">len</span>(htag_text_arr)):
    <span style="font-weight: bold; font-style: italic;">text</span> = <span style="font-style: italic;">''</span>
    <span style="font-weight: bold; font-style: italic;">texts</span> = htag_text_arr[i].xpath(<span style="font-style: italic;">'.//text()'</span>)
    <span style="font-weight: bold;">if</span> <span style="font-weight: bold;">len</span>(texts) == 1:
        <span style="font-weight: bold; font-style: italic;">text</span> = texts[0].strip()
    <span style="font-weight: bold;">elif</span> <span style="font-weight: bold;">len</span>(texts) &gt; 1:
        <span style="font-weight: bold; font-style: italic;">text</span> = <span style="font-style: italic;">''</span>.join(<span style="font-weight: bold;">map</span>(<span style="font-weight: bold;">str</span>.strip, texts))
    <span style="font-weight: bold;">else</span>:
        <span style="font-weight: bold;">continue</span>
    <span style="font-weight: bold; font-style: italic;">proximity</span> = difflib.SequenceMatcher(<span style="font-weight: bold; text-decoration: underline;">None</span>, title, text).ratio()
    <span style="font-weight: bold; font-style: italic;">heading</span> = etree.Element(htag_text_arr[i].tag)
    <span style="font-weight: bold; font-style: italic;">heading.text</span> = text
    heading.<span style="font-weight: bold;">set</span>(<span style="font-style: italic;">'proximity'</span>, <span style="font-weight: bold;">str</span>(proximity))
    OUT_ROOT.append(heading)

<span style="font-weight: bold; font-style: italic;">out_root_str</span> = etree.tostring(OUT_ROOT, encoding=<span style="font-style: italic;">'utf-8'</span>, method=<span style="font-style: italic;">'xml'</span>, pretty_print=<span style="font-weight: bold; text-decoration: underline;">True</span>)
<span style="font-weight: bold;">if</span> <span style="font-weight: bold;">type</span>(out_root_str) <span style="font-weight: bold;">is</span> <span style="font-weight: bold;">bytes</span>:
    <span style="font-weight: bold; font-style: italic;">out_root_str</span> = out_root_str.decode()
    <span style="font-weight: bold;">print</span>(out_root_str)
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="orge506638"></a>mu4e<br />
<div class="outline-text-5" id="text-orge506638">
<p>
You need to <a href="https://www.djcbsoftware.nl/code/mu/mu4e/Initializing-the-message-store.html">issue 'mu init' command</a> before using mu4e.
Command in practice presumably looks like:
</p>
<pre class="example">
mu init --maildir=~/share/mail --muhome=~/share/mu --my-address=jim@example.com

</pre>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"mu"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package mu4e-utils
  <span style="font-weight: bold;">:after</span> org-contacts
  <span style="font-weight: bold;">:delight</span>
  (mu4e-main-mode    <span style="font-style: italic;">" MU"</span>)
  (mu4e-headers-mode <span style="font-style: italic;">" MU"</span>)
  (mu4e-view-mode    <span style="font-style: italic;">" MU"</span>)
  (mu4e-compose-mode <span style="font-style: italic;">" MU"</span>)
  <span style="font-weight: bold;">:hook</span> (after-init . mu4e~start)
  <span style="font-weight: bold;">:custom</span>
  (mail-user-agent 'mu4e-user-agent)
  (mu4e-hide-index-messages t)
  (mu4e-context-policy 'pick-first)
  (mu4e-compose-context-policy 'ask)
  (mu4e-update-interval 300)
  (mu4e-split-view t)
  (mu4e-headers-date-format <span style="font-style: italic;">"%y%m%d"</span>)
  (mu4e-headers-time-format <span style="font-style: italic;">" %R"</span>)
  (mu4e-headers-fields
   '((<span style="font-weight: bold;">:human-date</span> . 6)
     (<span style="font-weight: bold;">:flags</span>      . 3)
     (<span style="font-weight: bold;">:from</span>       . 16)
     (<span style="font-weight: bold;">:subject</span>)))
  (mu4e-headers-results-limit 1000)
  (mu4e-headers-advance-after-mark t)
  (mu4e-change-filenames-when-moving t)
  (mu4e-view-show-images t)
  (mu4e-html2text-command (<span style="font-weight: bold;">lambda</span> (msg)
                            (plist-put msg <span style="font-weight: bold;">:body-html</span>
                                       (<span style="font-weight: bold;">with-temp-buffer</span>
                                         (insert (<span style="font-weight: bold;">or</span> (mu4e-message-field msg <span style="font-weight: bold;">:body-html</span>) <span style="font-style: italic;">""</span>))
                                         (shell-command-on-region (point-min) (point-max) <span style="font-style: italic;">"nkf -w -Lu"</span> (current-buffer) t)
                                         (<span style="font-weight: bold;">or</span> (buffer-string) <span style="font-style: italic;">""</span>)))
                            (mu4e-shr2text msg)))
  (message-send-mail-function 'smtpmail-send-it)
  (mm-sign-option nil)
  (mml-secure-openpgp-sign-with-sender t)
  (mml-default-sign-method 'pgpmime)
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">mu4e</span>)
  (bind-keys <span style="font-weight: bold;">:map</span> mu4e-headers-mode-map
             (<span style="font-style: italic;">"f"</span> . scroll-up-line)
             (<span style="font-style: italic;">"e"</span> . scroll-down-line)
             (<span style="font-style: italic;">"4"</span> . mu4e-headers-view-message)
             (<span style="font-style: italic;">"C-j"</span> . mu4e-headers-view-message)
             <span style="font-weight: bold;">:map</span> mu4e-view-mode-map
             (<span style="font-style: italic;">"f"</span> . scroll-up-line)
             (<span style="font-style: italic;">"e"</span> . scroll-down-line)
             (<span style="font-style: italic;">"SPC"</span> . my/forward-paragraph)
             (<span style="font-style: italic;">"E"</span> . my/backward-paragraph)
             (<span style="font-style: italic;">"TAB"</span> . shr-next-link)
             (<span style="font-style: italic;">"&lt;backtab&gt;"</span> . shr-previous-link)
             (<span style="font-style: italic;">"3"</span> . shr-next-link)
             (<span style="font-style: italic;">"4"</span> . my/enter-thing-at-point)
             (<span style="font-style: italic;">"C-c C-a"</span> . mu4e-view-attachment-action)
             <span style="font-weight: bold;">:map</span> mu4e-compose-mode-map
             (<span style="font-style: italic;">"C-x C-o"</span> . org-mu4e-compose-org-mode))
  (add-to-list 'mu4e-view-actions
               '(<span style="font-style: italic;">"external browser"</span> . mu4e-action-view-in-browser) t)
  (add-to-list 'mu4e-view-actions
               '(<span style="font-style: italic;">"XWidget View"</span> . mu4e-action-view-with-xwidget) t)
  (<span style="font-weight: bold;">when</span> (fboundp 'imagemagick-register-types)
    (imagemagick-register-types)))
</pre>
</div>
</div>

<ul class="org-ul">
<li><a id="org3235330"></a>mu4e-alert<br />
<div class="outline-text-6" id="text-org3235330">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-mu4e-alert"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package mu4e-alert
  <span style="font-weight: bold;">:hook</span> (after-init . (<span style="font-weight: bold;">lambda</span> ()
                        (mu4e-alert-enable-notifications)
                        (mu4e-alert-enable-mode-line-display)))
  <span style="font-weight: bold;">:after</span> mu4e
  <span style="font-weight: bold;">:custom</span>
  (mu4e-alert-modeline-formatter
   (<span style="font-weight: bold;">lambda</span> (count)
     (<span style="font-weight: bold;">if</span> (&gt; count 0)
         (format <span style="font-style: italic;">" M:%d"</span> count)
       <span style="font-style: italic;">""</span>)))
  <span style="font-weight: bold;">:config</span>
  (mu4e-alert-set-default-style 'fringe))
</pre>
</div>
</div>
</li>

<li><a id="orgc106130"></a>additional tweaks<br />
<div class="outline-text-6" id="text-orgc106130">
<ul class="org-ul">
<li><p>
file attachment in dired (<a href="https://www.djcbsoftware.nl/code/mu/mu4e/Dired.html">source</a>)
</p>
<pre class="example">
gnus-dired-attach (C-c RET C-a)

</pre>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package gnus-dired
  <span style="font-weight: bold;">:after</span> mu4e-compose
  <span style="font-weight: bold;">:hook</span>
  (dired-mode . turn-on-gnus-dired-mode)
  <span style="font-weight: bold;">:custom</span>
  (gnus-dired-mail-mode 'mu4e-user-agent))
</pre>
</div></li>

<li><p>
use contact info from org-contacts
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package mu4e-actions
  <span style="font-weight: bold;">:after</span> org-contacts
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">setq</span> mu4e-org-contacts-file (car org-contacts-files))
  (add-to-list 'mu4e-headers-actions
               '(<span style="font-style: italic;">"Contact to add"</span> . mu4e-action-add-org-contact) t)
  (add-to-list 'mu4e-view-actions
               '(<span style="font-style: italic;">"Contact to add"</span> . mu4e-action-add-org-contact) t))
</pre>
</div></li>
</ul>
</div>
</li>
</ul>
</li>

<li><a id="org3a997e5"></a>elfeed<br />
<div class="outline-text-5" id="text-org3a997e5">
<p>
<a href="https://github.com/skeeto/elfeed">Elfeed</a> is a powerful RSS feed reader with tag capability which is one of core software in my input workflow.
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-elfeed"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-style: italic;">"https://github.com/skeeto/elfeed/releases.atom"</span> soft_update)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package elfeed
  <span style="font-weight: bold;">:delight</span>
  (elfeed-show-mode   <span style="font-style: italic;">" EF"</span>)
  (elfeed-search-mode <span style="font-style: italic;">" EF"</span>)
  <span style="font-weight: bold;">:commands</span> (elfeed)
  <span style="font-weight: bold;">:init</span>
  (<span style="font-weight: bold;">defface</span> <span style="font-weight: bold; font-style: italic;">elfeed-search-unchecked-title-face</span>
    nil
    <span style="font-style: italic;">"Face used in search mode for unchecked entry titles."</span>
    <span style="font-weight: bold;">:group</span> 'elfeed)
  (<span style="font-weight: bold;">defface</span> <span style="font-weight: bold; font-style: italic;">elfeed-search-checked-title-face</span>
    nil
    <span style="font-style: italic;">"Face used in search mode for checked entry titles."</span>
    <span style="font-weight: bold;">:group</span> 'elfeed)
  <span style="font-weight: bold;">:custom-face</span>
  (elfeed-search-title-face ((t (<span style="font-weight: bold;">:foreground</span> <span style="font-style: italic;">"#4D4D4D"</span>))))
  (elfeed-search-unchecked-title-face ((t (<span style="font-weight: bold;">:foreground</span> <span style="font-style: italic;">"cornflowerblue"</span>))))
  (elfeed-search-checked-title-face ((t (<span style="font-weight: bold;">:foreground</span> <span style="font-style: italic;">"darkblue"</span>))))
  <span style="font-weight: bold;">:custom</span>
  (elfeed-use-curl t)
  (elfeed-db-directory (expand-file-name <span style="font-style: italic;">"~/share/emacs/elfeed"</span>))
  (elfeed-search-date-format '(<span style="font-style: italic;">"%Y%m%d"</span> 8 <span style="font-weight: bold;">:left</span>))
  (elfeed-search-title-min-width 100)
  (elfeed-search-title-max-width 120)
  (elfeed-search-trailing-width 160)
  (elfeed-sort-order 'ascending)
  (elfeed-enclosure-default-dir <span style="font-style: italic;">"~/Downloads/"</span>)
  (elfeed-save-multiple-enclosures-without-asking t)
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">setf</span> elfeed-search-print-entry-function
        'my/elfeed-search-print-entry)
  (<span style="font-weight: bold;">defalias</span> '<span style="font-weight: bold;">elfeed-search-tag-all-unchecked</span>
    (elfeed-expose #'elfeed-search-tag-all 'unchecked)
    <span style="font-style: italic;">"Add the `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">unchecked</span><span style="font-style: italic;">' tag to all selected entries."</span>)
  (<span style="font-weight: bold;">defalias</span> '<span style="font-weight: bold;">elfeed-search-untag-all-unchecked</span>
    (elfeed-expose #'elfeed-search-untag-all 'unchecked)
    <span style="font-style: italic;">"Remove the `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">unchecked</span><span style="font-style: italic;">' tag from all selected entries."</span>)
  (<span style="font-weight: bold;">defalias</span> '<span style="font-weight: bold;">elfeed-search-tag-all-checked</span>
    (elfeed-expose #'elfeed-search-tag-all 'checked)
    <span style="font-style: italic;">"Add the `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">checked</span><span style="font-style: italic;">' tag to all selected entries."</span>)
  (<span style="font-weight: bold;">defalias</span> '<span style="font-weight: bold;">elfeed-search-untag-all-checked</span>
    (elfeed-expose #'elfeed-search-untag-all 'checked)
    <span style="font-style: italic;">"Remove the `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">checked</span><span style="font-style: italic;">' tag from all selected entries."</span>)
  (bind-keys <span style="font-weight: bold;">:map</span> elfeed-search-mode-map
             (<span style="font-style: italic;">"C-j"</span> . elfeed-search-show-entry)
             (<span style="font-style: italic;">"o"</span> . elfeed-search-open-url)
             (<span style="font-style: italic;">"C-c C-o"</span> . elfeed-search-open-url)
             (<span style="font-style: italic;">"f"</span> . scroll-up-line)
             (<span style="font-style: italic;">"e"</span> . scroll-down-line)
             (<span style="font-style: italic;">"q"</span> . elfeed-kill-buffer)
             (<span style="font-style: italic;">"Q"</span> . quit-window)
             (<span style="font-style: italic;">"x"</span> . elfeed-search-update--force)
             (<span style="font-style: italic;">"c"</span> . (<span style="font-weight: bold;">lambda</span> () (<span style="font-weight: bold;">interactive</span>)
                      (elfeed-search-untag-all-unread)
                      (<span style="font-weight: bold;">unless</span> (use-region-p) (forward-line -1))
                      (elfeed-search-tag-all-unchecked)))
             (<span style="font-style: italic;">"C"</span> . elfeed-search-untag-all-unchecked)
             (<span style="font-style: italic;">"r"</span> . (<span style="font-weight: bold;">lambda</span> () (<span style="font-weight: bold;">interactive</span>)
                      (elfeed-search-untag-all-unread)
                      (<span style="font-weight: bold;">unless</span> (use-region-p) (forward-line -1))
                      (elfeed-search-untag-all-unchecked)
                      (<span style="font-weight: bold;">unless</span> (use-region-p) (forward-line -1))
                      (elfeed-search-tag-all-checked)
                      (<span style="font-weight: bold;">unless</span> (use-region-p) (forward-line -1))
                      (elfeed-search-tag-all (intern (format-time-string <span style="font-style: italic;">"%Y%m%d"</span>)))))
             (<span style="font-style: italic;">"R"</span> . elfeed-search-untag-all-checked)
             (<span style="font-style: italic;">"d"</span> . elfeed-search-untag-all-unread)
             (<span style="font-style: italic;">"Dv"</span> . elfeed-search-download-video)
             (<span style="font-style: italic;">"Da"</span> . elfeed-search-download-audio)
             (<span style="font-style: italic;">"D="</span> . elfeed-search-show-media-duration)
             (<span style="font-style: italic;">"X"</span> . elfeed-search-org-capture-derived)
             <span style="font-weight: bold;">:map</span> elfeed-show-mode-map
             (<span style="font-style: italic;">"f"</span> . scroll-up-line)
             (<span style="font-style: italic;">"e"</span> . scroll-down-line)
             (<span style="font-style: italic;">"SPC"</span> . my/forward-paragraph)
             (<span style="font-style: italic;">"E"</span> . my/backward-paragraph)
             (<span style="font-style: italic;">"4"</span> . my/enter-thing-at-point)
             (<span style="font-style: italic;">"TAB"</span> . shr-next-link))
  (add-to-list 'elfeed-search-face-alist '(unchecked elfeed-search-unchecked-title-face))
  (add-to-list 'elfeed-search-face-alist '(checked elfeed-search-checked-title-face)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/elfeed-search-print-entry</span> (entry)
  <span style="font-style: italic;">"Print ENTRY to the buffer with my style."</span>
  (<span style="font-weight: bold;">let*</span> ((date (elfeed-search-format-date (elfeed-entry-date entry)))
         (title (<span style="font-weight: bold;">or</span> (elfeed-meta entry <span style="font-weight: bold;">:title</span>) (elfeed-entry-title entry) <span style="font-style: italic;">""</span>))
         (title-faces (elfeed-search--faces (elfeed-entry-tags entry)))
         (feed (elfeed-entry-feed entry))
         (feed-title
          (<span style="font-weight: bold;">when</span> feed
            (<span style="font-weight: bold;">or</span> (elfeed-meta feed <span style="font-weight: bold;">:title</span>) (elfeed-feed-title feed))))
         (tags (mapcar #'symbol-name (elfeed-entry-tags entry)))
         (tags-str (mapconcat
                    (<span style="font-weight: bold;">lambda</span> (s) (propertize s 'face 'elfeed-search-tag-face))
                    tags <span style="font-style: italic;">","</span>))
         (title-width (- (window-width) 10 elfeed-search-trailing-width))
         (title-column (elfeed-format-column
                        title (elfeed-clamp
                               elfeed-search-title-min-width
                               title-width
                               elfeed-search-title-max-width)
                        <span style="font-weight: bold;">:left</span>)))
    (<span style="font-weight: bold;">when</span> feed-title
      (insert (propertize (elfeed-format-column feed-title 6 <span style="font-weight: bold;">:left</span>)
                          'face 'elfeed-search-feed-face) <span style="font-style: italic;">" "</span>))
    (insert (propertize title-column 'face title-faces 'kbd-help title) <span style="font-style: italic;">" "</span>)
    (insert (propertize date 'face 'elfeed-search-date-face) <span style="font-style: italic;">" "</span>)
    (<span style="font-weight: bold;">when</span> tags
      (insert <span style="font-style: italic;">"("</span> tags-str <span style="font-style: italic;">")"</span>))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">elfeed-search-open-url</span> ()
  <span style="font-style: italic;">"Visit the current entry in your browser using 'eww-browse-url'."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">let</span> ((browse-url-browser-function 'open-url))
    (elfeed-search-untag-all-unchecked)
    (<span style="font-weight: bold;">unless</span> (use-region-p) (forward-line -1))
    (elfeed-search-tag-all-checked)
    (<span style="font-weight: bold;">unless</span> (use-region-p) (forward-line -1))
    (elfeed-search-tag-all (intern (format-time-string <span style="font-style: italic;">"%Y%m%d"</span>)))
    (<span style="font-weight: bold;">unless</span> (use-region-p) (forward-line -1))
    (elfeed-search-browse-url)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">elfeed-search-download-video</span> ()
  <span style="font-style: italic;">"Downlaod video file."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">let</span> ((entries (elfeed-search-selected)))
    (<span style="font-weight: bold;">cl-loop</span> for entry in entries
             when (<span style="font-weight: bold;">or</span> (caar (elfeed-entry-enclosures entry))
                      (elfeed-entry-link entry))
             do (<span style="font-weight: bold;">let</span> ((title (elfeed-entry-title entry)))
                  (my/download-video it title)))
    (mapc #'elfeed-search-update-entry entries)
    (<span style="font-weight: bold;">unless</span> (<span style="font-weight: bold;">or</span> elfeed-search-remain-on-entry (use-region-p))
      (forward-line))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">elfeed-search-download-audio</span> ()
  <span style="font-style: italic;">"Download audio file."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">let</span> ((entries (elfeed-search-selected)))
    (<span style="font-weight: bold;">cl-loop</span> for entry in entries
             when (<span style="font-weight: bold;">or</span> (caar (elfeed-entry-enclosures entry))
                      (elfeed-entry-link entry))
             do (<span style="font-weight: bold;">let</span> ((title (elfeed-entry-title entry)))
                  (my/download-audio it title)))
    (mapc #'elfeed-search-update-entry entries)
    (<span style="font-weight: bold;">unless</span> (<span style="font-weight: bold;">or</span> elfeed-search-remain-on-entry (use-region-p))
      (forward-line))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">elfeed-search-show-media-duration</span> ()
  <span style="font-style: italic;">"Show duration of media attached to current entry."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">let*</span> ((entry (elfeed-search-selected <span style="font-weight: bold;">:single</span>))
         (url (<span style="font-weight: bold;">or</span> (caar (elfeed-entry-enclosures entry))
                  (elfeed-entry-link entry))))
    (show-media-duration url)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">elfeed-search-org-capture-derived</span> (<span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> arg)
  <span style="font-style: italic;">"Create actionable org task derived from current elfeed entry.</span>

<span style="font-style: italic;">If called with C-u prefix, ask user to specify tags and target."</span>
  (<span style="font-weight: bold;">interactive</span> <span style="font-style: italic;">"P"</span>)
  (<span style="font-weight: bold;">let</span> ((entries (elfeed-search-selected)))
    (<span style="font-weight: bold;">save-window-excursion</span>
      (<span style="font-weight: bold;">cl-loop</span> for entry in entries
               do (<span style="font-weight: bold;">progn</span>
                    (elfeed-show-entry entry)
                    (<span style="font-weight: bold;">let</span> ((org-capture-derived-todo org-todo-keyword-3)
                          (org-capture-derived-tags (format <span style="font-style: italic;">":web:%s"</span>
                                                            (<span style="font-weight: bold;">cond</span>
                                                             ((<span style="font-weight: bold;">or</span> (member 'video (elfeed-entry-tags entry))
                                                                  (member 'audio (elfeed-entry-tags entry)))
                                                              <span style="font-style: italic;">"ac_watch:"</span>)
                                                             (t <span style="font-style: italic;">"ac_read:"</span>))))
                          (org-capture-derived-target <span style="font-style: italic;">"68d74115-1f70-448d-a76e-738e32b272d8"</span>)
                          (org-capture-derived-deadline-in-day 7))
                      (call-interactively #'org-capture-derived))
                    (elfeed-kill-buffer))))
    (elfeed-search-untag-all-unchecked)
    (<span style="font-weight: bold;">unless</span> (use-region-p) (forward-line -1))
    (elfeed-search-tag-all-checked)
    (mapc #'elfeed-search-update-entry entries)))
</pre>
</div>
</div>

<ul class="org-ul">
<li><a id="org4773c9b"></a>elfeed-org<br />
<div class="outline-text-6" id="text-org4773c9b">
<p>
<a href="https://github.com/remyhonig/elfeed-org">elfeed-org</a> allow me to express feeds for elfeed in org file.
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-elfeed-org"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package elfeed-org
  <span style="font-weight: bold;">:after</span> (elfeed org)
  <span style="font-weight: bold;">:custom</span>
  (rmh-elfeed-org-files '(<span style="font-style: italic;">"~/org/index/feed.org"</span>))
  (rmh-elfeed-org-ignore-tag <span style="font-style: italic;">"ignore"</span>)
  (rmh-elfeed-org-auto-ignore-invalid-feeds t)
  <span style="font-weight: bold;">:config</span>
  (elfeed-org))
</pre>
</div>

<p>
Packages managed by other than guix (i.e. straight.el or apt) are encouraged to register feed since updating information channel is desirable to exist.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(advice-add #'rmh-elfeed-org-process
            <span style="font-weight: bold;">:after</span> #'my/elfeed-org-add-feeds)

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/elfeed-org-add-feeds</span> (rmh-elfeed-org-files rmh-elfeed-org-tree-id)
  <span style="font-style: italic;">"Add feeds in addition to feeds in `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">rmh-elfeed-org-files</span><span style="font-style: italic;">'.</span>

<span style="font-style: italic;">This function needs to be invoked after `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">rmh-elfeed-org-process</span><span style="font-style: italic;">' which clear all feeds."</span>
  (<span style="font-weight: bold;">setf</span> elfeed-feeds
        (append elfeed-feeds
                '(<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">s-exps for feeds will be inserted here</span>
                  (<span style="font-style: italic;">"https://github.com/raxod502/straight.el/releases.atom"</span> soft_update)
                  (<span style="font-style: italic;">"https://github.com/jwiegley/use-package/releases.atom"</span> soft_update)
                  (<span style="font-style: italic;">"https://github.com/purcell/whole-line-or-region/releases.atom"</span> soft_update)
                  (<span style="font-style: italic;">"https://github.com/skk-dev/ddskk/releases.atom"</span> soft_update)
                  (<span style="font-style: italic;">"https://github.com/skeeto/elfeed/releases.atom"</span> soft_update)
                  (<span style="font-style: italic;">"https://github.com/crocket/dired-single/releases.atom"</span> soft_update)
                  (<span style="font-style: italic;">"https://github.com/mattiasb/dired-hide-dotfiles/releases.atom"</span> soft_update)
                  (<span style="font-style: italic;">"https://github.com/akermu/emacs-libvterm/releases.atom"</span> soft_update)
                  (<span style="font-style: italic;">"https://updates.orgmode.org/feed/releases"</span> soft_update)
                  (<span style="font-style: italic;">"https://github.com/alphapapa/org-ql/releases.atom"</span> soft_update)
                  (<span style="font-style: italic;">"https://github.com/ndwarshuis/org-ml/releases.atom"</span> soft_update)
                  (<span style="font-style: italic;">"https://github.com/org-roam/org-roam/releases.atom"</span> soft_update)
                  (<span style="font-style: italic;">"https://gitlab.com/phillord/org-drill/-/tags?format=atom"</span> soft_update)
                  (<span style="font-style: italic;">"https://github.com/akirak/org-volume/releases.atom"</span> soft_update)
                  (<span style="font-style: italic;">"https://github.com/dfeich/org-clock-convenience/releases.atom"</span> soft_update)
                  (<span style="font-style: italic;">"https://github.com/minad/vertico/releases.atom"</span> soft_update)
                  (<span style="font-style: italic;">"https://github.com/minad/consult/releases.atom"</span> soft_update)
                  (<span style="font-style: italic;">"https://github.com/oantolin/embark/releases.atom"</span> soft_update)
                  (<span style="font-style: italic;">"https://github.com/minad/marginalia/releases.atom"</span> soft_update)
                  (<span style="font-style: italic;">"https://github.com/oantolin/orderless/releases.atom"</span> soft_update)
                  (<span style="font-style: italic;">"https://github.com/magit/magit/releases.atom"</span> soft_update)
                  (<span style="font-style: italic;">"https://github.com/benma/visual-regexp-steroids.el/releases.atom"</span> soft_update)
                  (<span style="font-style: italic;">"https://github.com/hayamiz/twittering-mode/releases.atom"</span> soft_update)
                  (<span style="font-style: italic;">"https://github.com/remyferre/comment-dwim-2/releases.atom"</span> soft_update)
                  (<span style="font-style: italic;">"https://github.com/abo-abo/define-word/releases.atom"</span> soft_update)
                  (<span style="font-style: italic;">"https://github.com/emacs-jp/migemo/releases.atom"</span> soft_update)
                  (<span style="font-style: italic;">"https://github.com/nflath/hungry-delete/releases.atom"</span> soft_update)
                  (<span style="font-style: italic;">"https://github.com/coldnew/pangu-spacing/releases.atom"</span> soft_update)
                  (<span style="font-style: italic;">"https://github.com/koron/cmigemo/releases.atom"</span> soft_update)
                  (<span style="font-style: italic;">"https://github.com/lilypond/lilypond/releases.atom"</span> soft_update)))))
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="org0af1b24"></a>Dired<br />
<div class="outline-text-5" id="text-org0af1b24">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package dired
  <span style="font-weight: bold;">:bind</span> (<span style="font-weight: bold;">:map</span> dired-mode-map
              (<span style="font-style: italic;">"("</span> . dired-hide-details-mode)
              (<span style="font-style: italic;">")"</span> . dired-hide-details-mode)
              (<span style="font-style: italic;">"E"</span> . dired-create-empty-file)
              (<span style="font-style: italic;">"Y"</span> . dired-do-relsymlink)
              (<span style="font-style: italic;">"r"</span> . wdired-change-to-wdired-mode)
              (<span style="font-style: italic;">"C-o"</span> . nil)
              (<span style="font-style: italic;">"o"</span> . my/dired-open)
              (<span style="font-style: italic;">"C-c C-o"</span> . my/dired-open)
              (<span style="font-style: italic;">"C-c C-s"</span> . my/dired-share))
  <span style="font-weight: bold;">:hook</span> (dired-mode . dired-hide-details-mode)
  <span style="font-weight: bold;">:custom</span>
  (dired-recursive-copies 'always)
  (dired-recursive-deletes 'top)
  (dired-listing-switches <span style="font-style: italic;">"-ahgG --time-style=iso --group-directories-first"</span>)
  (dired-dwim-target 'dired-dwim-target-recent)
  (dired-hide-details-hide-information-lines nil)
  <span style="font-weight: bold;">:config</span>
  (put 'dired-find-alternate-file 'disabled nil)
  (<span style="font-weight: bold;">setq</span> dired-isearch-filenames t)
  (advice-add #'dired-do-delete <span style="font-weight: bold;">:around</span> #'my/advice-dired-control-deletion)
  (advice-add #'dired-do-flagged-delete <span style="font-weight: bold;">:around</span> #'my/advice-dired-control-deletion))

(use-package dired-x
  <span style="font-weight: bold;">:after</span> dired)

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/advice-dired-control-deletion</span> (oldfun <span style="font-weight: bold; text-decoration: underline;">&amp;rest</span> r)
  <span style="font-style: italic;">"Enable file deleting functions to control deleting procedure</span>
<span style="font-style: italic;">whether files are going to be in trash box."</span>
  (<span style="font-weight: bold;">let</span> ((delete-by-moving-to-trash
         (<span style="font-weight: bold;">if</span> (equal current-prefix-arg '(4))
             nil t)))
    (apply oldfun (cdr r))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/dired-open</span> (<span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> arg)
  <span style="font-style: italic;">"Open file in Dired.</span>

<span style="font-style: italic;">File is either on current line or marked targets.</span>
<span style="font-style: italic;">Optional argument `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">ARG</span><span style="font-style: italic;">' is passed to `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">my/view-file</span><span style="font-style: italic;">'."</span>
  (<span style="font-weight: bold;">interactive</span> <span style="font-style: italic;">"P"</span>)
  (<span style="font-weight: bold;">let</span> ((files (dired-get-marked-files nil nil)))
    (mapc (<span style="font-weight: bold;">lambda</span> (file)
            (<span style="font-weight: bold;">if</span> (equal arg '(4))
                (find-file file)
              (my/view-file file arg)))
          files)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/dired-share</span> ()
  <span style="font-style: italic;">"Share file with remote device via KDE Connect."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">let</span> ((files (dired-get-marked-files nil nil)))
    (mapc (<span style="font-weight: bold;">lambda</span> (file)
            (shell-command
             (mapconcat 'identity
                        (list <span style="font-style: italic;">"kdeconnect-cli"</span> <span style="font-style: italic;">"-d"</span> <span style="font-style: italic;">"a30587ededf4c2d2"</span>
                              <span style="font-style: italic;">"--share"</span> (shell-quote-argument
                                         file)) <span style="font-style: italic;">" "</span>)))
          files)))
</pre>
</div>
</div>

<ul class="org-ul">
<li><a id="orgb5c8f59"></a>dired-rsync<br />
<div class="outline-text-6" id="text-orgb5c8f59">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-dired-rsync"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package dired-rsync
  <span style="font-weight: bold;">:after</span> dired
  <span style="font-weight: bold;">:bind</span> (<span style="font-weight: bold;">:map</span> dired-mode-map
              (<span style="font-style: italic;">"C-c C-r"</span> . dired-rsync))
  <span style="font-weight: bold;">:custom</span>
  (dired-rsync-options <span style="font-style: italic;">"-auz --info=progress2"</span>))
</pre>
</div>
</div>
</li>

<li><a id="org27705c3"></a>dired-single<br />
<div class="outline-text-6" id="text-org27705c3">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-style: italic;">"https://github.com/crocket/dired-single/releases.atom"</span> soft_update)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package dired-single
  <span style="font-weight: bold;">:straight</span> t
  <span style="font-weight: bold;">:after</span> dired
  <span style="font-weight: bold;">:bind</span> (<span style="font-weight: bold;">:map</span> dired-mode-map
              (<span style="font-style: italic;">"C-j"</span> . dired-single-buffer)
              (<span style="font-style: italic;">"^"</span> . dired-single-up-directory)))
</pre>
</div>
</div>
</li>

<li><a id="org5fbc577"></a>dired-hacks<br />
<div class="outline-text-6" id="text-org5fbc577">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-dired-hacks"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package dired-subtree
  <span style="font-weight: bold;">:after</span> dired
  <span style="font-weight: bold;">:bind</span> (<span style="font-weight: bold;">:map</span> dired-mode-map
              (<span style="font-style: italic;">"TAB"</span> . dired-subtree-cycle)))

(use-package dired-narrow
  <span style="font-weight: bold;">:after</span> dired
  <span style="font-weight: bold;">:bind</span>
  (<span style="font-weight: bold;">:map</span> dired-mode-map
        (<span style="font-style: italic;">"z"</span> . dired-narrow))
  (<span style="font-weight: bold;">:map</span> dired-narrow-map
        (<span style="font-style: italic;">"C-j"</span> . exit-minibuffer)))
</pre>
</div>
</div>
</li>

<li><a id="org00cd7ed"></a>dired-hide-dotfiles<br />
<div class="outline-text-6" id="text-org00cd7ed">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-style: italic;">"https://github.com/mattiasb/dired-hide-dotfiles/releases.atom"</span> soft_update)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package dired-hide-dotfiles
  <span style="font-weight: bold;">:straight</span> t
  <span style="font-weight: bold;">:after</span> dired
  <span style="font-weight: bold;">:bind</span> (<span style="font-weight: bold;">:map</span> dired-mode-map
              (<span style="font-style: italic;">","</span> . dired-clean-directory)
              (<span style="font-style: italic;">"."</span> . dired-hide-dotfiles-mode))
  <span style="font-weight: bold;">:config</span>
  (dired-hide-dotfiles-mode -1))
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="org9f823ac"></a>Shells / Terminal emulators<br />
<div class="outline-text-5" id="text-org9f823ac">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">setf</span> shell-command-switch <span style="font-style: italic;">"-c"</span>)
(custom-set-variables '(shell-command-prompt-show-cwd t))

(shell-command-with-editor-mode 1)
</pre>
</div>
</div>

<ul class="org-ul">
<li><a id="orgddf85d0"></a>shell<br />
<div class="outline-text-6" id="text-orgddf85d0">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package shell
  <span style="font-weight: bold;">:delight</span> <span style="font-style: italic;">" SM"</span>
  <span style="font-weight: bold;">:commands</span> (shell)
  <span style="font-weight: bold;">:config</span>
  (bind-keys <span style="font-weight: bold;">:map</span> shell-mode-map
             (<span style="font-style: italic;">"C-j"</span> . comint-send-input)))
</pre>
</div>
</div>
</li>

<li><a id="orgc0f2c7d"></a>term<br />
<div class="outline-text-6" id="text-orgc0f2c7d">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package term
  <span style="font-weight: bold;">:delight</span>
  (term-mode <span style="font-style: italic;">" TR"</span>)
  <span style="font-weight: bold;">:config</span>
  (bind-keys <span style="font-weight: bold;">:map</span> term-mode-map
             (<span style="font-style: italic;">"C-j"</span> . term-send-input)))
</pre>
</div>
</div>
</li>

<li><a id="org5bd0c6f"></a>vterm<br />
<div class="outline-text-6" id="text-org5bd0c6f">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-vterm"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-style: italic;">"https://github.com/akermu/emacs-libvterm/releases.atom"</span> soft_update)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package vterm
  <span style="font-weight: bold;">:commands</span> (vterm)
  <span style="font-weight: bold;">:delight</span> <span style="font-style: italic;">" VT"</span>
  <span style="font-weight: bold;">:diminish</span> ((vterm-copy-mode . <span style="font-style: italic;">"vc"</span>))
  <span style="font-weight: bold;">:bind</span>
  <span style="font-weight: bold;">:custom</span>
  (vterm-min-window-width 55)
  (vterm-buffer-name-string <span style="font-style: italic;">"vterm %s"</span>)
  <span style="font-weight: bold;">:config</span>
  (bind-keys <span style="font-weight: bold;">:map</span> vterm-mode-map
             (<span style="font-style: italic;">"C-h"</span> . vterm-send-backspace)
             (<span style="font-style: italic;">"M-h"</span> . vterm-send-meta-backspace)
             (<span style="font-style: italic;">"C-y"</span> . vterm-yank)
             (<span style="font-style: italic;">"M-y"</span> . vterm-yank-pop)
             (<span style="font-style: italic;">"C-o"</span> . nil)
             (<span style="font-style: italic;">"M-l"</span> . nil)
             <span style="font-weight: bold;">:map</span> vterm-copy-mode-map
             (<span style="font-style: italic;">"C-j"</span> . vterm-copy-mode-done))
  (advice-add 'consult-yank-from-kill-ring <span style="font-weight: bold;">:around</span> #'advice/vterm-yank-pop))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">advice/vterm-yank-pop</span> (orig-fun <span style="font-weight: bold; text-decoration: underline;">&amp;rest</span> args)
  (<span style="font-weight: bold;">if</span> (equal major-mode 'vterm-mode)
      (<span style="font-weight: bold;">let</span> ((inhibit-read-only t)
            (yank-undo-function (<span style="font-weight: bold;">lambda</span> (_start _end) (vterm-undo))))
        (<span style="font-weight: bold;">cl-letf</span> (((symbol-function 'insert-for-yank)
                   (<span style="font-weight: bold;">lambda</span> (str) (vterm-send-string str t))))
          (apply orig-fun args)))
    (apply orig-fun args)))
</pre>
</div>
</div>
</li>

<li><a id="org08a0cb3"></a>eshell<br />
<div class="outline-text-6" id="text-org08a0cb3">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package eshell
  <span style="font-weight: bold;">:delight</span> <span style="font-style: italic;">" ES"</span>
  <span style="font-weight: bold;">:hook</span>
  (eshell-kill . eshell-command-alert)
  <span style="font-weight: bold;">:custom</span>
  (eshell-prompt-function
   #'(lambda ()
       (format <span style="font-style: italic;">"[%s]\n%s"</span>
               (eshell/basename (eshell/pwd))
               (<span style="font-weight: bold;">if</span> (= (user-uid) 0) <span style="font-style: italic;">"# "</span> <span style="font-style: italic;">"$ "</span>))))
  (eshell-prompt-regexp <span style="font-style: italic;">"[#$] "</span>)
  (eshell-visual-subcommands '((<span style="font-style: italic;">"git"</span> <span style="font-style: italic;">"log"</span> <span style="font-style: italic;">"diff"</span> <span style="font-style: italic;">"show"</span>)))
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">setq</span> eshell-path-env (getenv <span style="font-style: italic;">"PATH"</span>)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">eshell-command-alert</span> (process status)
  <span style="font-style: italic;">"Send `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">alert</span><span style="font-style: italic;">' with severity based on STATUS when PROCESS finished."</span>
  (<span style="font-weight: bold;">let*</span> ((cmd (process-command process))
         (buffer (process-buffer process))
         (msg (format <span style="font-style: italic;">"%s: %s"</span> (mapconcat 'identity cmd <span style="font-style: italic;">" "</span>)  status)))
    (<span style="font-weight: bold;">if</span> (string-prefix-p <span style="font-style: italic;">"finished"</span> status)
        (alert msg <span style="font-weight: bold;">:buffer</span> buffer <span style="font-weight: bold;">:severity</span>  'normal)
      (alert msg <span style="font-weight: bold;">:buffer</span> buffer <span style="font-weight: bold;">:severity</span> 'urgent))))
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="org72a9238"></a>Org-mode<br />
<div class="outline-text-5" id="text-org72a9238">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-org"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-style: italic;">"https://updates.orgmode.org/feed/releases"</span> soft_update)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package org
  <span style="font-weight: bold;">:defer</span> t
  <span style="font-weight: bold;">:mode</span> ((<span style="font-style: italic;">"\\.org$"</span> . org-mode))
  <span style="font-weight: bold;">:interpreter</span> ((<span style="font-style: italic;">"org"</span> . org-mode))
  <span style="font-weight: bold;">:init</span>
  (<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">org-warning-keyword-0</span> <span style="font-style: italic;">"UG"</span> <span style="font-style: italic;">"TODO keyword acronym standing for 'UrGent'"</span>)
  (<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">org-todo-keyword-0</span> <span style="font-style: italic;">"TD"</span> <span style="font-style: italic;">"TODO keyword acronym standing for 'To Do'"</span>)
  (<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">org-todo-keyword-1</span> <span style="font-style: italic;">"GO"</span> <span style="font-style: italic;">"TODO keyword acronym standing for 'Get On'"</span>)
  (<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">org-todo-keyword-2</span> <span style="font-style: italic;">"IP"</span> <span style="font-style: italic;">"TODO keyword acronym standing for 'In Progressn'"</span>)
  (<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">org-todo-keyword-3</span> <span style="font-style: italic;">"AC"</span> <span style="font-style: italic;">"TODO keyword acronym standing for 'doABle'"</span>)
  (<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">org-todo-keyword-4</span> <span style="font-style: italic;">"SD"</span> <span style="font-style: italic;">"TODO keyword acronym standing for 'SomeDay'"</span>)
  (<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">org-done-keyword-0</span> <span style="font-style: italic;">"DN"</span> <span style="font-style: italic;">"TODO keyword acronym standing for 'DoNe'"</span>)
  (<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">org-done-keyword-1</span> <span style="font-style: italic;">"CX"</span> <span style="font-style: italic;">"TODO keyword acronym standing for 'Cancel'"</span>)
  (<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">org-done-keyword-2</span> <span style="font-style: italic;">"PD"</span> <span style="font-style: italic;">"TODO keyword acronym standing for 'PenDing'"</span>)
  <span style="font-weight: bold;">:hook</span> (org-after-todo-state-change . save-buffer)
  <span style="font-weight: bold;">:custom</span>
  (org-directory (expand-file-name <span style="font-style: italic;">"~/org"</span>))
  (org-special-ctrl-a/e t)
  (org-adapt-indentation nil)
  (org-hide-emphasis-markers t)
  (org-bookmark-names-plist nil)
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">inline image</span>
  (org-startup-with-inline-images t)
  (org-display-remote-inline-images 'cache)
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">do not split line at point</span>
  (org-M-RET-may-split-line '((default . nil)))
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">org-mu4e</span>)

  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">local key bindings</span>
  (bind-keys <span style="font-weight: bold;">:map</span> org-mode-map
             (<span style="font-style: italic;">"C-j"</span>     . org-return)
             (<span style="font-style: italic;">"C-m"</span>     . org-return-indent)
             (<span style="font-style: italic;">"M-j"</span>     . org-meta-return)
             (<span style="font-style: italic;">"C-S-p"</span>   . org-previous-item)
             (<span style="font-style: italic;">"C-S-n"</span>   . org-next-item)
             (<span style="font-style: italic;">"C-S-u"</span>   . org-up-element)
             (<span style="font-style: italic;">"C-$"</span>     . org-down-element)
             (<span style="font-style: italic;">"C-&lt;"</span>     . org-previous-link)
             (<span style="font-style: italic;">"C-&gt;"</span>     . org-next-link)
             (<span style="font-style: italic;">"C-c @"</span>   . org-mark-element)
             (<span style="font-style: italic;">"C-c C-SPC"</span> . org-mark-subtree)
             (<span style="font-style: italic;">"C-c D v"</span> . org-download-video-link-at-point)
             (<span style="font-style: italic;">"C-c D a"</span> . org-download-audio-link-at-point)
             (<span style="font-style: italic;">"C-c D ="</span> . org-show-media-duration-at-point)
             (<span style="font-style: italic;">"C-c !"</span>   . org-readable)
             (<span style="font-style: italic;">"C-c C-a"</span> . nil)
             (<span style="font-style: italic;">"C-,"</span>     . nil)
             (<span style="font-style: italic;">"M-h"</span>     . nil))

  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">attach</span>
  (<span style="font-weight: bold;">setq</span> org-attach-preferred-new-method nil)

  (<span style="font-weight: bold;">setq</span> org-file-apps
        '((t . (<span style="font-weight: bold;">lambda</span> (file-path link-string)
                 (my/view-file file-path)))))

  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">basic</span>
  (<span style="font-weight: bold;">setq</span> org-hide-leading-stars t)
  (<span style="font-weight: bold;">setq</span> org-comment-string <span style="font-style: italic;">"####"</span>)
  (<span style="font-weight: bold;">setq</span> org-pretty-entities t)
  (<span style="font-weight: bold;">setq</span> org-use-sub-superscripts '{}) <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">use _{}/^{} for sub/super script</span>

  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">tag/property</span>
  (<span style="font-weight: bold;">setq</span> org-use-tag-inheritance <span style="font-style: italic;">"ARCHIVE"</span>)
  (<span style="font-weight: bold;">setq</span> org-tags-column -57)
  (<span style="font-weight: bold;">setq</span> org-global-properties
        '((<span style="font-style: italic;">"Effort_ALL"</span>. <span style="font-style: italic;">"0 0:10 0:20 0:30 1:00 1:30 2:00 3:00 4:00 6:00 8:00"</span>)))
  (<span style="font-weight: bold;">setq</span> org-use-property-inheritance <span style="font-style: italic;">"TIMELIMIT.*"</span>)
  (<span style="font-weight: bold;">setq</span> org-highest-priority ?A)
  (<span style="font-weight: bold;">setq</span> org-lowest-priority ?Z)
  (<span style="font-weight: bold;">setq</span> org-default-priority ?E)

  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">todo</span>
  (<span style="font-weight: bold;">setq</span> org-enforce-todo-dependencies t)
  (<span style="font-weight: bold;">setq</span> org-todo-keywords
        `((sequence ,(format <span style="font-style: italic;">"%s(t/!)"</span> org-todo-keyword-0)
                    ,(format <span style="font-style: italic;">"%s(u/!)"</span> org-warning-keyword-0)
                    ,(format <span style="font-style: italic;">"%s(g/!)"</span> org-todo-keyword-1)
                    ,(format <span style="font-style: italic;">"%s(i/!)"</span> org-todo-keyword-2)
                    <span style="font-style: italic;">"|"</span>
                    ,(format <span style="font-style: italic;">"%s(d/@)"</span> org-done-keyword-0)
                    ,(format <span style="font-style: italic;">"%s(x/@)"</span> org-done-keyword-1)
                    ,(format <span style="font-style: italic;">"%s(p/@)"</span> org-done-keyword-2))
          (sequence ,(format <span style="font-style: italic;">"%s(a/!)"</span> org-todo-keyword-3)
                    <span style="font-style: italic;">"|"</span>
                    ,(format <span style="font-style: italic;">"%s(d/@)"</span> org-done-keyword-0)
                    ,(format <span style="font-style: italic;">"%s(x/@)"</span> org-done-keyword-1)
                    ,(format <span style="font-style: italic;">"%s(p/@)"</span> org-done-keyword-2))
          (sequence ,(format <span style="font-style: italic;">"%s(t/!)"</span> org-todo-keyword-0)
                    ,(format <span style="font-style: italic;">"%s(s/!)"</span> org-todo-keyword-4)
                    <span style="font-style: italic;">"|"</span>
                    ,(format <span style="font-style: italic;">"%s(x/@)"</span> org-done-keyword-1)
                    ,(format <span style="font-style: italic;">"%s(p/@)"</span> org-done-keyword-2))))
  (<span style="font-weight: bold;">setq</span> org-todo-keyword-faces
        `((,org-warning-keyword-0 . <span style="font-style: italic;">"red1"</span>)
          (,org-todo-keyword-0    . <span style="font-style: italic;">"green1"</span>)
          (,org-todo-keyword-1    . <span style="font-style: italic;">"DeepPink1"</span>)
          (,org-todo-keyword-2    . <span style="font-style: italic;">"DodgerBlue1"</span>)
          (,org-todo-keyword-3    . <span style="font-style: italic;">"chocolate"</span>)
          (,org-todo-keyword-4    . <span style="font-style: italic;">"SpringGreen"</span>)
          (,org-done-keyword-0    . <span style="font-style: italic;">"gray30"</span>)
          (,org-done-keyword-1    . <span style="font-style: italic;">"dark gray"</span>)
          (,org-done-keyword-2    . <span style="font-style: italic;">"sea green"</span>)))
  (add-hook  'org-after-todo-state-change-hook
             (<span style="font-weight: bold;">lambda</span> ()
               (<span style="font-weight: bold;">save-excursion</span>
                 (<span style="font-weight: bold;">let*</span> ((element (org-element-at-point))
                        (todo-state (org-get-todo-state))
                        (tags (org-get-tags))
                        (priority (org-element-property <span style="font-weight: bold;">:priority</span> element))
                        (category (org-entry-get (point) <span style="font-style: italic;">"CATEGORY"</span>))
                        (style (org-entry-get (point) <span style="font-style: italic;">"STYLE"</span>)))
                   <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">remove priority level when the to-do state is changed to DN|CX|PD</span>
                   (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">and</span>
                          (s-matches? (format <span style="font-style: italic;">"%1$s</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">|</span><span style="font-style: italic;">%2$s</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">|</span><span style="font-style: italic;">%3$s"</span>
                                              org-done-keyword-0
                                              org-done-keyword-1
                                              org-done-keyword-2)
                                      todo-state)
                          (<span style="font-weight: bold;">bound-and-true-p</span> priority))
                     (org-priority ? ))
                   <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">remove DN state if CATEGORY of the entry is "Cyclic"</span>
                   (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">and</span> (string= category <span style="font-style: italic;">"Cyclic"</span>)
                              (string= todo-state org-done-keyword-0)
                              (not (member <span style="font-style: italic;">"web"</span> tags))
                              (not (string= style <span style="font-style: italic;">"habit"</span>)))
                     (org-todo <span style="font-style: italic;">""</span>))))))
  (add-hook 'org-after-todo-statistics-hook
            (<span style="font-weight: bold;">lambda</span> (n-done n-not-done)
              <span style="font-style: italic;">"Switch project entry to DONE when all subentries are done, to empty otherwise."</span>
              (<span style="font-weight: bold;">when</span> (member <span style="font-style: italic;">"project"</span> (org-get-tags))
                (org-todo (<span style="font-weight: bold;">if</span> (= n-not-done 0)
                              (<span style="font-weight: bold;">prog1</span> org-done-keyword-0
                                (org-add-planning-info 'closed <span style="font-style: italic;">"now"</span>))
                            <span style="font-style: italic;">""</span>)))))

  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">time</span>
  (<span style="font-weight: bold;">setq</span> org-duration-format
        '((<span style="font-style: italic;">"d"</span> . nil)
          (special . h:mm)))

  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">time-stamp</span>
  (<span style="font-weight: bold;">setq</span> org-time-stamp-custom-formats
        '(<span style="font-style: italic;">"&lt;%m-%d %a&gt;"</span> . <span style="font-style: italic;">"&lt;%H:%M&gt;"</span>))
  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">org-display-iso-week-at-point</span> ()
    <span style="font-style: italic;">"Display ISO 8601 week number correspoinds to time stamp at point."</span>
    (<span style="font-weight: bold;">interactive</span>)
    (<span style="font-weight: bold;">let</span> ((ts (org-timestamp-at-point)))
      (<span style="font-weight: bold;">when</span> ts
        (message <span style="font-style: italic;">"W%s"</span> (format-time-string <span style="font-style: italic;">"%V"</span> (org-read-date nil t ts nil))))))
  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">org-timestamp-at-point</span> ()
    <span style="font-style: italic;">"Return time stamp string at point."</span>
    (<span style="font-weight: bold;">let</span> ((ts-bound (org-in-regexp (org-re-timestamp 'all))))
      (<span style="font-weight: bold;">when</span> ts-bound
        (buffer-substring (car ts-bound) (cdr ts-bound)))))

  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">logging</span>
  (<span style="font-weight: bold;">setq</span> org-log-done 'time)
  (<span style="font-weight: bold;">setq</span> org-log-into-drawer t)
  (<span style="font-weight: bold;">setq</span> org-log-states-order-reversed t)
  (<span style="font-weight: bold;">setq</span> org-reverse-note-order nil)
  (add-hook 'org-log-buffer-setup-hook
            (<span style="font-weight: bold;">lambda</span> ()
              (<span style="font-weight: bold;">setq</span> skk-dcomp-activate 'eolp)
              (<span style="font-weight: bold;">setq</span> skk-dcomp-multiple-activate nil)))

  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">clock table</span>
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">work around for the bug in emacs 25</span>
  (<span style="font-weight: bold;">defalias</span> '<span style="font-weight: bold;">calendar-absolute-from-iso</span> 'calendar-iso-to-absolute)

  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">image</span>
  (<span style="font-weight: bold;">setq</span> org-image-actual-width 100)

  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">structure templates</span>
  (add-to-list 'org-structure-template-alist (cons <span style="font-style: italic;">"sh"</span> <span style="font-style: italic;">"src shell"</span>))
  (add-to-list 'org-structure-template-alist (cons <span style="font-style: italic;">"tx"</span> <span style="font-style: italic;">"src text"</span>))
  (add-to-list 'org-structure-template-alist (cons <span style="font-style: italic;">"el"</span> <span style="font-style: italic;">"src emacs-lisp"</span>))
  (add-to-list 'org-structure-template-alist (cons <span style="font-style: italic;">"py"</span> <span style="font-style: italic;">"src python"</span>)))
</pre>
</div>
</div>

<ul class="org-ul">
<li><a id="orgdad63fd"></a>org-agenda<br />
<div class="outline-text-6" id="text-orgdad63fd">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package org-agenda
  <span style="font-weight: bold;">:after</span> (org org-ql my/org-archive)
  <span style="font-weight: bold;">:bind</span> (<span style="font-weight: bold;">:map</span> org-agenda-mode-map
              (<span style="font-style: italic;">"C-j"</span> . org-agenda-switch-to)
              (<span style="font-style: italic;">"M"</span> . org-agenda-month-view))
  <span style="font-weight: bold;">:hook</span>
  (org-agenda-mode . (<span style="font-weight: bold;">lambda</span> ()
                       (delete-other-windows)
                       (org-agenda-to-appt t '((category <span style="font-style: italic;">"appt"</span>)))))
  <span style="font-weight: bold;">:custom</span>
  (org-agenda-start-on-weekday 1)
  (org-agenda-skip-deadline-if-done t)
  (org-agenda-include-diary t)
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">following three are for fast agenda view building</span>
  (org-agenda-inhibit-startup t)
  (org-agenda-dim-blocked-tasks nil)
  (org-agenda-use-tag-inheritance nil)
  (org-agenda-files (directory-files (expand-file-name <span style="font-style: italic;">"agenda"</span> org-directory) t <span style="font-style: italic;">"</span><span style="font-weight: bold; font-style: italic;">\</span><span style="font-style: italic;">.org$"</span>))
  (org-agenda-prefix-format '((agenda   . <span style="font-style: italic;">"%?-12t% s"</span>)
                              (timeline . <span style="font-style: italic;">"  %s"</span>)
                              (todo     . <span style="font-style: italic;">" "</span>)
                              (tags     . <span style="font-style: italic;">" "</span>)
                              (search   . <span style="font-style: italic;">" "</span>)))
  (org-agenda-custom-commands
   `((<span style="font-style: italic;">"a"</span> <span style="font-style: italic;">"Week-agenda"</span>
      agenda <span style="font-style: italic;">""</span>
      ((org-agenda-skip-function
        (<span style="font-weight: bold;">lambda</span> ()
          <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">skip entry which has 'web' tag even if it has deadline</span>
          (<span style="font-weight: bold;">and</span> (<span style="font-weight: bold;">save-excursion</span>
                 (<span style="font-weight: bold;">let</span> ((tags (org-get-tags)))
                   (member <span style="font-style: italic;">"web"</span> tags)))
               (<span style="font-weight: bold;">progn</span> (outline-next-heading) (point)))))))
     (<span style="font-style: italic;">"r"</span> . <span style="font-style: italic;">"Search for all record files"</span>)
     (<span style="font-style: italic;">"rs"</span> <span style="font-style: italic;">"Entries containing search words entry or headline."</span>
      search <span style="font-style: italic;">""</span>
      ((org-agenda-files my/org-archive-files)
       (org-agenda-sorting-strategy '(time-down))))
     (<span style="font-style: italic;">"rm"</span> <span style="font-style: italic;">"Match a TAGS/PROP/TODO query in record file"</span>
      tags <span style="font-style: italic;">""</span>
      ((org-agenda-files my/org-archive-files)
       (org-agenda-sorting-strategy '(time-down))))
     (<span style="font-style: italic;">"o"</span> . <span style="font-style: italic;">"someday list"</span>)
     (<span style="font-style: italic;">"om"</span> <span style="font-style: italic;">"someday to craft"</span>
      ((org-ql-search-block `(<span style="font-weight: bold;">and</span> (todo ,org-todo-keyword-4)
                                  (tags-expanded <span style="font-style: italic;">"AC_CRAFT"</span>))
                            ((org-ql-block-header <span style="font-style: italic;">"Someday to craft"</span>))))
      ((org-agenda-files my/org-archive-files)
       (org-agenda-sorting-strategy '(priority-down))))
     (<span style="font-style: italic;">"op"</span> <span style="font-style: italic;">"someday to purchase"</span>
      ((org-ql-search-block `(<span style="font-weight: bold;">and</span> (todo ,org-todo-keyword-4)
                                  (tags <span style="font-style: italic;">"ac_purchase"</span>))
                            ((org-ql-block-header <span style="font-style: italic;">"Someday to purchase"</span>))))
      ((org-agenda-files my/org-archive-files)
       (org-agenda-sorting-strategy '(priority-down))))
     (<span style="font-style: italic;">"oc"</span> <span style="font-style: italic;">"someday to cook"</span>
      ((org-ql-search-block `(<span style="font-weight: bold;">and</span> (todo ,org-todo-keyword-4)
                                  (tags <span style="font-style: italic;">"ac_cook"</span>))
                            ((org-ql-block-header <span style="font-style: italic;">"Someday to cook"</span>))))
      ((org-agenda-files my/org-archive-files)
       (org-agenda-sorting-strategy '(priority-down))))
     (<span style="font-style: italic;">"O"</span> <span style="font-style: italic;">"all someday entries"</span>
      ((org-ql-search-block `(<span style="font-weight: bold;">and</span> (todo ,org-todo-keyword-4)
                                  (tags-expanded <span style="font-style: italic;">"AC_CRAFT"</span>))
                            ((org-ql-block-header <span style="font-style: italic;">"Someday to craft"</span>)))
       (org-ql-search-block `(<span style="font-weight: bold;">and</span> (todo ,org-todo-keyword-4)
                                  (tags <span style="font-style: italic;">"ac_purchase"</span>))
                            ((org-ql-block-header <span style="font-style: italic;">"Someday to purchase"</span>)))
       (org-ql-search-block `(<span style="font-weight: bold;">and</span> (todo ,org-todo-keyword-4)
                                  (tags <span style="font-style: italic;">"ac_cook"</span>))
                            ((org-ql-block-header <span style="font-style: italic;">"Someday to cook"</span>)))
       (org-ql-search-block `(<span style="font-weight: bold;">and</span> (todo ,org-todo-keyword-4)
                                  (not (tags-expanded <span style="font-style: italic;">"ac_purchase"</span> <span style="font-style: italic;">"ac_cook"</span> <span style="font-style: italic;">"AC_CRAFT"</span>)))
                            ((org-ql-block-header <span style="font-style: italic;">"Someday things"</span>))))
      ((org-agenda-files my/org-archive-files)))
     (<span style="font-style: italic;">"l"</span> <span style="font-style: italic;">"Log entries in a week"</span>
      agenda <span style="font-style: italic;">""</span>
      ((org-agenda-span (<span style="font-weight: bold;">if</span> (equal current-prefix-arg '(4))
                            'day 'week))
       (org-agenda-start-with-log-mode t)
       (org-agenda-include-inactive-timestamps nil)
       (org-agenda-include-diary t)
       (org-agenda-sorting-strategy
        '(time-up
          deadline-up
          todo-state-up
          priority-down))))
     (<span style="font-style: italic;">"L"</span> <span style="font-style: italic;">"Log entry timeline on today with default org-agenda-prefix-format"</span>
      agenda <span style="font-style: italic;">""</span>
      ((org-agenda-prefix-format (eval (car (get 'org-agenda-prefix-format 'standard-value))))
       (org-agenda-span (<span style="font-weight: bold;">if</span> (equal current-prefix-arg '(4))
                            'day 'week))
       (org-agenda-start-with-log-mode t)
       (org-agenda-include-inactive-timestamps nil)
       (org-agenda-include-diary t)
       (org-agenda-sorting-strategy
        '(time-up
          deadline-up
          todo-state-up
          priority-down))))
     <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">KEEP IN MIND</span>
     <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">invoking `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">org-clock-sum-all</span><span style="font-weight: bold; font-style: italic;">' is required before showing effort table</span>
     (<span style="font-style: italic;">"e"</span> . <span style="font-style: italic;">"Effort table"</span>)
     (<span style="font-style: italic;">"ei"</span> <span style="font-style: italic;">"today"</span>
      ((org-ql-search-block `(<span style="font-weight: bold;">or</span> (todo ,org-warning-keyword-0)
                                 (todo ,org-todo-keyword-2)
                                 (<span style="font-weight: bold;">and</span> (clocked <span style="font-weight: bold;">:on</span> today)
                                      (<span style="font-weight: bold;">or</span> (todo) (done))
                                      (not (habit))
                                      (not (tags <span style="font-style: italic;">"web"</span>))))
                            ((org-ql-block-header <span style="font-style: italic;">"Today's task"</span>))))
      ((org-agenda-overriding-header <span style="font-style: italic;">"Today's Task"</span>)
       (org-overriding-columns-format <span style="font-style: italic;">"%26ITEM(Task) %Effort(Effort){:} %CLOCKSUM_T(Today){:} %CLOCKSUM(Total)"</span>)
       (org-agenda-view-columns-initially t)
       (org-agenda-sorting-strategy '(todo-state-up priority-down deadline-up))))
     (<span style="font-style: italic;">"eg"</span> <span style="font-style: italic;">"this week"</span>
      ((org-ql-search-block `(<span style="font-weight: bold;">or</span> (todo ,org-warning-keyword-0)
                                 (todo ,org-todo-keyword-1)
                                 (todo ,org-todo-keyword-2))
                            ((org-ql-block-header <span style="font-style: italic;">"This Week's task"</span>))))
      ((org-agenda-overriding-header <span style="font-style: italic;">"This Week's Task"</span>)
       (org-overriding-columns-format <span style="font-style: italic;">"%26ITEM(Task) %Effort(Effort){:} %CLOCKSUM_T(Today){:} %CLOCKSUM(Total)"</span>)
       (org-agenda-view-columns-initially t)
       (org-agenda-sorting-strategy '(todo-state-up priority-down deadline-up))))
     (<span style="font-style: italic;">"ed"</span> <span style="font-style: italic;">"done task"</span>
      ((org-ql-search-block `(<span style="font-weight: bold;">or</span> (todo ,org-done-keyword-0)
                                 (todo ,org-done-keyword-1)
                                 (todo ,org-done-keyword-2))
                            ((org-ql-block-header <span style="font-style: italic;">"Done task"</span>))))
      ((org-agenda-overriding-header <span style="font-style: italic;">"Done Task"</span>)
       (org-overriding-columns-format <span style="font-style: italic;">"%26ITEM(Task) %Effort(Effort){:} %CLOCKSUM(Total){:}"</span>)
       (org-agenda-view-columns-initially t)
       (org-agenda-sorting-strategy '(todo-state-up priority-down deadline-up))))
     (<span style="font-style: italic;">"i"</span> <span style="font-style: italic;">"Today's agenda"</span>
      ((todo <span style="font-style: italic;">"Today's agenda"</span>
             ((org-agenda-sorting-strategy '(priority-up))))
       (org-ql-search-block `(heading ,(format-time-string <span style="font-style: italic;">"%Y-%m-%d %A"</span>))
                            ((org-agenda-files `(,(my/org-archive-file)))
                             (org-ql-block-header <span style="font-style: italic;">"Today's tree node"</span>)))
       (org-ql-search-block `(<span style="font-weight: bold;">or</span> (todo ,org-warning-keyword-0)
                                 (todo ,org-todo-keyword-2))
                            ((org-ql-block-header <span style="font-style: italic;">"Today's task"</span>)))
       (org-ql-search-block `(<span style="font-weight: bold;">and</span> (planning <span style="font-weight: bold;">:on</span> today)
                                  (not (todo ,org-todo-keyword-2
                                             ,org-done-keyword-0
                                             ,org-done-keyword-1
                                             ,org-done-keyword-2))
                                  (not (tags <span style="font-style: italic;">"web"</span>))
                                  (not (habit)))
                            ((org-ql-block-header <span style="font-style: italic;">"Scheduled/Deadlined on today"</span>)))
       (org-ql-search-block `(<span style="font-weight: bold;">and</span> (habit)
                                  (todo ,org-todo-keyword-0)
                                  (scheduled <span style="font-weight: bold;">:to</span> today)
                                  (not (tags <span style="font-style: italic;">"bad_habit"</span>))
                                  (not (tags-inherited <span style="font-style: italic;">"ARCHIVE"</span>)))
                            ((org-ql-block-header <span style="font-style: italic;">"Habits to take"</span>)))
       (org-ql-search-block `(<span style="font-weight: bold;">and</span> (ts-active <span style="font-weight: bold;">:on</span> today)
                                  (not (<span style="font-weight: bold;">or</span> (todo ,org-todo-keyword-2)
                                           (habit) (done))))
                            ((org-ql-block-header <span style="font-style: italic;">"Today's common event"</span>)))
       (org-ql-search-block '(<span style="font-weight: bold;">and</span> (done)
                                  (closed <span style="font-weight: bold;">:on</span> today))
                            ((org-ql-block-header <span style="font-style: italic;">"Completed tasks on today"</span>)))))
     (<span style="font-style: italic;">"g"</span> <span style="font-style: italic;">"This Week's agenda"</span>
      ((org-ql-search-block `(heading ,(format-time-string <span style="font-style: italic;">"%G-W%V"</span>))
                            ((org-agenda-files `(,(my/org-archive-file)))
                             (org-ql-block-header <span style="font-style: italic;">"This week's tree"</span>)))
       (org-ql-search-block `(<span style="font-weight: bold;">or</span> (todo ,org-todo-keyword-1))
                            ((org-ql-block-header <span style="font-style: italic;">"This week's tasks"</span>)))
       (org-ql-search-block `(<span style="font-weight: bold;">or</span> (todo ,org-warning-keyword-0)
                                 (todo ,org-todo-keyword-2))
                            ((org-ql-block-header <span style="font-style: italic;">"Today's tasks"</span>)))
       (org-ql-search-block `(<span style="font-weight: bold;">and</span> (planning <span style="font-weight: bold;">:from</span> 0 <span style="font-weight: bold;">:to</span> 6)
                                  (not (todo ,org-todo-keyword-2
                                             ,org-done-keyword-0
                                             ,org-done-keyword-1
                                             ,org-done-keyword-2))
                                  (not (tags <span style="font-style: italic;">"web"</span>))
                                  (not (habit)))
                            ((org-ql-block-header <span style="font-style: italic;">"Scheduled/Deadlined this week"</span>)))
       (org-ql-search-block `(<span style="font-weight: bold;">and</span> (<span style="font-weight: bold;">and</span> (ts-active <span style="font-weight: bold;">:from</span> 0 <span style="font-weight: bold;">:to</span> 6)
                                       (not (deadline))
                                       (not (scheduled))
                                       (not (closed)))
                                  (not (<span style="font-weight: bold;">or</span> (todo ,org-todo-keyword-1
                                                 ,org-todo-keyword-2)
                                           (done))))
                            ((org-ql-block-header <span style="font-style: italic;">"This week's common event"</span>))))
      ((org-agenda-sorting-strategy
        '(todo-state-up priority-down deadline-up))))
     (<span style="font-style: italic;">"c"</span> <span style="font-style: italic;">"actionable thing list"</span>
      ((org-ql-search-block `(<span style="font-weight: bold;">and</span> (todo ,org-todo-keyword-3)
                                  (not (deadline <span style="font-weight: bold;">:to</span> -1)))
                            ((org-ql-block-header <span style="font-style: italic;">"Doable things"</span>))))
      ((org-agenda-sorting-strategy
        '(todo-state-up priority-down deadline-up))))
     (<span style="font-style: italic;">"t"</span> <span style="font-style: italic;">"All tasks"</span>
      ((org-ql-search-block `(todo ,org-warning-keyword-0)
                            ((org-ql-block-header <span style="font-style: italic;">"Urgent task"</span>)))
       (org-ql-search-block `(todo ,org-todo-keyword-2)
                            ((org-ql-block-header <span style="font-style: italic;">"Today's task"</span>)))
       (org-ql-search-block `(todo ,org-todo-keyword-1)
                            ((org-ql-block-header <span style="font-style: italic;">"This week's task"</span>)))
       (org-ql-search-block `(todo ,org-todo-keyword-4)
                            ((org-ql-block-header <span style="font-style: italic;">"Someday's entries on agenda files"</span>)))
       (org-ql-search-block `(<span style="font-weight: bold;">and</span> (todo ,org-todo-keyword-0)
                                  (not (habit)))
                            ((org-ql-block-header <span style="font-style: italic;">"Remaining task"</span>)))))
     (<span style="font-style: italic;">"d"</span> <span style="font-style: italic;">"Done tasks"</span>
      ((org-ql-search-block '(done)
                            ((org-ql-block-header <span style="font-style: italic;">"Done/Canceled/Pending task"</span>)))))
     (<span style="font-style: italic;">"#"</span> <span style="font-style: italic;">"stuck project"</span>
      ((org-ql-search-block `(<span style="font-weight: bold;">and</span> (tags <span style="font-style: italic;">"project"</span>)
                                  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">exclude projects</span>
                                  (not (children (todo ,org-todo-keyword-0
                                                       ,org-todo-keyword-1
                                                       ,org-todo-keyword-2
                                                       ,org-todo-keyword-3))))
                            ((org-ql-block-header <span style="font-style: italic;">"Stuck projects"</span>)))))
     (<span style="font-style: italic;">"p"</span> <span style="font-style: italic;">"Projects"</span> tags <span style="font-style: italic;">"+project"</span>)
     (<span style="font-style: italic;">"h"</span> <span style="font-style: italic;">"Habits in consistency graph"</span>
      agenda <span style="font-style: italic;">""</span>
      ((org-agenda-span 'day)
       (org-agenda-use-time-grid nil)
       (org-agenda-prefix-format '((agenda . <span style="font-style: italic;">""</span>)))
       (org-habit-show-all-today t)
       (org-habit-graph-column 32)
       (org-habit-preceding-days 14)
       (org-habit-following-days 21)
       (org-agenda-sorting-strategy '(scheduled-up))
       <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">display habits only</span>
       (org-agenda-skip-function
        (<span style="font-weight: bold;">lambda</span> ()
          (<span style="font-weight: bold;">and</span> (<span style="font-weight: bold;">save-excursion</span>
                 (not (org-is-habit-p)))
               (<span style="font-weight: bold;">progn</span> (outline-next-heading) (point)))))))
     (<span style="font-style: italic;">"H"</span> <span style="font-style: italic;">"show all habits"</span>
      ((org-ql-search-block '(habit)
                            ((org-ql-block-header <span style="font-style: italic;">"All Habits"</span>))))
      ((org-agenda-sorting-strategy '(scheduled-up))))))
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">dolist</span> (dir '(<span style="font-style: italic;">"archive"</span> <span style="font-style: italic;">"index"</span> <span style="font-style: italic;">"wiki"</span>))
    (mapc (<span style="font-weight: bold;">lambda</span> (org-file)
            (add-to-list 'org-agenda-text-search-extra-files
                         org-file))
          (directory-files (expand-file-name dir org-directory)
                           t
                           (<span style="font-weight: bold;">rx</span> (one-or-more not-newline)
                               (<span style="font-weight: bold;">or</span> <span style="font-style: italic;">".org"</span> <span style="font-style: italic;">".org.gpg"</span>)
                               line-end)))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">org-agenda-cmp-latest-clock-log</span> (a b)
  <span style="font-style: italic;">"Compare two org entry A and B in terms of clock log.</span>

<span style="font-style: italic;">This function can be used as `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">org-agenda-cmp-user-defined</span><span style="font-style: italic;">' in `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">org-agenda-sorting-strategy</span><span style="font-style: italic;">'."</span>
  (<span style="font-weight: bold;">let*</span> ((marker-a (get-text-property 1 'org-marker a))
         (time-a (org-get-latest-clock-log-time marker-a))
         (marker-b (get-text-property 1 'org-marker b))
         (time-b (org-get-latest-clock-log-time marker-b)))
    (<span style="font-weight: bold;">if</span> (time-less-p time-a time-b) -1 +1)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">org-clock-sum-all</span> ()
  <span style="font-style: italic;">"Sum the times for all agenda files."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">save-excursion</span>
    (mapc (<span style="font-weight: bold;">lambda</span> (file)
            (<span style="font-weight: bold;">with-current-buffer</span> (<span style="font-weight: bold;">or</span> (org-find-base-buffer-visiting file)
                                     (find-file-noselect file))
              (org-clock-sum)
              (org-clock-sum-today)))
          (org-agenda-files))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">org-get-latest-clock-log-time</span> (pom)
  <span style="font-style: italic;">"Get the latest clock log time stamp in org entry at POM as a time object.</span>

<span style="font-style: italic;">If entry at POM has no clock log time stamp, this function returns 0."</span>
  (<span style="font-weight: bold;">org-with-point-at</span> pom
    (<span style="font-weight: bold;">save-excursion</span>
      (<span style="font-weight: bold;">setq</span> end-of-subtree (org-end-of-subtree))
      (<span style="font-weight: bold;">setq</span> latest-time 0)
      (org-back-to-heading t)
      (org-show-all)
      (<span style="font-weight: bold;">while</span> (re-search-forward org-drawer-regexp end-of-subtree t)
        (<span style="font-weight: bold;">when</span> (string= (match-string 1) (org-clock-drawer-name))
          (<span style="font-weight: bold;">while</span> (<span style="font-weight: bold;">progn</span>
                   (forward-line 1)
                   (<span style="font-weight: bold;">when</span> (org-match-line org-clock-ts-line-re)
                     (<span style="font-weight: bold;">setq</span> match-ts
                           (<span style="font-weight: bold;">if</span> (match-string 3)
                               (match-string 3) (match-string 1)))
                     (<span style="font-weight: bold;">when</span> (time-less-p latest-time
                                        (apply 'encode-time (parse-time-string match-ts)))
                       (<span style="font-weight: bold;">setq</span> latest-time (apply 'encode-time (parse-time-string match-ts)))))
                   (not (org-match-line org-clock-drawer-end-re))))))))
  latest-time)
</pre>
</div>
</div>
</li>

<li><a id="org030d059"></a>org-capture<br />
<div class="outline-text-6" id="text-org030d059">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package org-capture
  <span style="font-weight: bold;">:after</span> (org my/org-archive)
  <span style="font-weight: bold;">:hook</span>
  (org-capture-mode . (<span style="font-weight: bold;">lambda</span> ()
                        (skk-mode 1)
                        (delete-other-windows)))
  <span style="font-weight: bold;">:custom</span>
  (org-capture-bookmark nil)
  (org-capture-templates
   `((<span style="font-style: italic;">"t"</span> <span style="font-style: italic;">"Task"</span>
      entry (id <span style="font-style: italic;">"adcd63ea-f81a-4909-b659-6e5794052fcc"</span>)
      ,(format <span style="font-style: italic;">"* %s %%?\n%%U\n"</span>
               org-todo-keyword-0))
     (<span style="font-style: italic;">"p"</span> <span style="font-style: italic;">"Project"</span>
      entry (id <span style="font-style: italic;">"adcd63ea-f81a-4909-b659-6e5794052fcc"</span>)
      <span style="font-style: italic;">"* %? [/] :project:\n %U\n- [ ] insert ID property if necessary"</span>
      <span style="font-weight: bold;">:prepend</span> t <span style="font-weight: bold;">:jump-to-captured</span> t)
     (<span style="font-style: italic;">"n"</span> <span style="font-style: italic;">"Note"</span>
      entry (file+datetree ,my/org-archive-file)
      <span style="font-style: italic;">"* %? %^g\n %U\n"</span> <span style="font-weight: bold;">:tree-type</span> week)
     (<span style="font-style: italic;">"m"</span> <span style="font-style: italic;">"Memo"</span>
      entry (file <span style="font-style: italic;">"~/org/note/memo.org"</span>)
      <span style="font-style: italic;">"* %U\n#+begin_src %^{Lnaguage|text}\n%(my-org-capture-filter-memo \"%i\")\n#+end_src"</span>
      <span style="font-weight: bold;">:jump-to-captured</span> t
      <span style="font-weight: bold;">:immediate-finish</span> t)
     (<span style="font-style: italic;">"s"</span> <span style="font-style: italic;">"Someday memo"</span>)
     (<span style="font-style: italic;">"ss"</span> <span style="font-style: italic;">"any"</span>
      entry (file+datetree ,my/org-archive-file)
      ,(format <span style="font-style: italic;">"* %s %%?\n%%U\n%%a"</span>
               org-todo-keyword-4)
      <span style="font-weight: bold;">:tree-type</span> week)
     (<span style="font-style: italic;">"sr"</span> <span style="font-style: italic;">"purchase book"</span>
      entry (file+datetree ,my/org-archive-file)
      ,(format <span style="font-style: italic;">"* %s %%? :ac_purchase:book:\n%%U\n%%a"</span>
               org-todo-keyword-4)
      <span style="font-weight: bold;">:tree-type</span> week)
     (<span style="font-style: italic;">"sc"</span> <span style="font-style: italic;">"cook"</span>
      entry (file+datetree ,my/org-archive-file)
      ,(format <span style="font-style: italic;">"* %s %%? :ac_cook:\n%%U\n%%a"</span>
               org-todo-keyword-4)
      <span style="font-weight: bold;">:tree-type</span> week)
     (<span style="font-style: italic;">"sp"</span> <span style="font-style: italic;">"purchase"</span>
      entry (file+datetree ,my/org-archive-file)
      ,(format <span style="font-style: italic;">"* %s %%? :ac_purchase:\n%%U\n%%a"</span>
               org-todo-keyword-4)
      <span style="font-weight: bold;">:tree-type</span> week)
     (<span style="font-style: italic;">"D"</span> <span style="font-style: italic;">"Drill"</span>)
     (<span style="font-style: italic;">"Dd"</span> <span style="font-style: italic;">"Drill entry in currently clocking or today's entry."</span>
      entry (<span style="font-weight: bold;">function</span> org-goto-clocking-or-today)
      <span style="font-style: italic;">"* %i :drill:\n[%?]"</span>)
     (<span style="font-style: italic;">"De"</span> <span style="font-style: italic;">"English drill entry in currently clocking or today's entry."</span>
      entry (<span style="font-weight: bold;">function</span> org-goto-clocking-or-today)
      <span style="font-style: italic;">"* %i :drill:fd_en:\n[%^C%?]\n- %a"</span>)
     (<span style="font-style: italic;">"M"</span> <span style="font-style: italic;">"Append memo to clocking task"</span>
      item (clock)
      <span style="font-style: italic;">"- %i%?"</span>))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-org-capture-filter-memo</span> (<span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> str)
  <span style="font-style: italic;">"Replace semantic representation in `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">org-mode</span><span style="font-style: italic;">' with plain string in STR."</span>
  (<span style="font-weight: bold;">cond</span>
   ((stringp str)
    (replace-regexp-in-string <span style="font-style: italic;">"^</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">*+ </span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">"</span> <span style="font-style: italic;">",\\1"</span> str))
   (t <span style="font-style: italic;">""</span>)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">org-goto-clocking-or-today</span> ()
  <span style="font-style: italic;">"Go to currently clocking entry.</span>

<span style="font-style: italic;">If no entry is clocked or CATEGORY on clocking entry is \"Cyclic\",</span>
<span style="font-style: italic;">go to today's entry in record file."</span>
  (<span style="font-weight: bold;">if</span> (<span style="font-weight: bold;">and</span> (org-clocking-p)
           (<span style="font-weight: bold;">save-excursion</span>
             (<span style="font-weight: bold;">with-current-buffer</span> (org-clocking-buffer)
               (org-clock-jump-to-current-clock)
               (org-back-to-heading)
               (not (string=
                     (org-entry-get (point) <span style="font-style: italic;">"CATEGORY"</span> t)
                     <span style="font-style: italic;">"Cyclic"</span>)))))
      (org-clock-goto)
    (<span style="font-weight: bold;">let*</span> ((now (decode-time (current-time)))
           (day (nth 3 now))
           (month (nth 4 now))
           (year (nth 5 now))
           (org-refile-targets
            `((,my/org-archive-file <span style="font-weight: bold;">:regexp</span> . ,(format <span style="font-style: italic;">"%04d-%02d-%02d"</span> year month day)))))
      (find-file my/org-archive-file)
      (org-datetree-find-iso-week-create `(,month ,day ,year) nil))))
</pre>
</div>
</div>
</li>

<li><a id="org8d06c77"></a>org-timer and org-clock<br />
<div class="outline-text-6" id="text-org8d06c77">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package org-timer
  <span style="font-weight: bold;">:after</span> org
  <span style="font-weight: bold;">:hook</span>
  (org-timer-done . (<span style="font-weight: bold;">lambda</span> ()
                      (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">and</span> (org-clocking-p)
                                 org-clock-marker)
                        (<span style="font-weight: bold;">let</span> ((alert (org-entry-get org-clock-marker
                                                    <span style="font-style: italic;">"ALERT"</span>)))
                          (<span style="font-weight: bold;">if</span> (<span style="font-weight: bold;">and</span> (stringp alert)
                                   (string= alert <span style="font-style: italic;">"alarm"</span>))
                              (alert <span style="font-style: italic;">"Timer Done!"</span> <span style="font-weight: bold;">:style</span> 'alarm)
                            (alert <span style="font-style: italic;">"Timer Done!"</span> <span style="font-weight: bold;">:style</span> 'fringe <span style="font-weight: bold;">:mode</span> 'org-mode <span style="font-weight: bold;">:buffer</span> (org-clocking-buffer) <span style="font-weight: bold;">:severity</span> 'trivial)))))))

(use-package org-clock
  <span style="font-weight: bold;">:after</span> org
  <span style="font-weight: bold;">:hook</span>
  ((org-clock-in org-clock-out org-clock-cancel) . save-buffer)
  (org-clock-in-prepare . my/org-clock-in-set-timer)
  (org-clock-out . my/org-clock-out-have-a-break)
  ((org-clock-out org-clock-cancel) .
   (<span style="font-weight: bold;">lambda</span> () (<span style="font-weight: bold;">and</span> org-timer-countdown-timer
                   (org-timer-stop))))
  <span style="font-weight: bold;">:custom</span>
  (org-clock-out-when-done t)
  (org-clock-persist t)
  (org-clock-persist-query-resume nil)
  (org-clock-string-limit 20)
  (org-clock-continuously t)
  (org-clock-ask-before-exiting nil)
  (org-clock-out-remove-zero-time-clocks t)
  <span style="font-weight: bold;">:config</span>
  (org-clock-persistence-insinuate)
  (<span style="font-weight: bold;">defconst</span> <span style="font-weight: bold; font-style: italic;">org-clock-ts-line-re</span>
    (concat <span style="font-style: italic;">"^[ \t]*"</span> org-clock-string <span style="font-style: italic;">"[ \t]*"</span> org-tsr-regexp-both)
    <span style="font-style: italic;">"Matches a line with clock time stamp."</span>))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/org-clock-in-set-timer</span> ()
  <span style="font-style: italic;">"Start count down timer for a clocked in entry.</span>

<span style="font-style: italic;">If the entry has ATTENTION_SPAN property, use it for `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">org-timer-default-timer</span><span style="font-style: italic;">'.</span>
<span style="font-style: italic;">Otherwise count down time is Effort property value.</span>
<span style="font-style: italic;">In neither case, count down time is 25 min which is suggested in the Pomodoro-technique."</span>
  (<span style="font-weight: bold;">let</span> ((todo (org-get-todo-state))
        (attention-span (org-entry-get (point) <span style="font-style: italic;">"ATTENTION_SPAN"</span> 'selective))
        (effort (org-entry-get (point) <span style="font-style: italic;">"Effort"</span> 'selective)))
    (<span style="font-weight: bold;">when</span> org-clock-clocking-in
      (org-clock-out))
    (<span style="font-weight: bold;">cond</span>
     ((stringp attention-span)
      (<span style="font-weight: bold;">let</span> ((org-timer-default-timer attention-span))
        (org-timer-set-timer '(64))))
     ((<span style="font-weight: bold;">and</span> (stringp effort)
           (ts&lt; (ts-parse effort) (ts-parse <span style="font-style: italic;">"01:40"</span>)))
      (org-timer-set-timer '(16)))
     (todo
      (<span style="font-weight: bold;">let</span> ((org-timer-default-timer <span style="font-style: italic;">"25"</span>))
        (org-timer-set-timer '(64)))))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/org-clock-out-without-remove</span> ()
  <span style="font-style: italic;">"Clock out and save record even if clock time is zero."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">let</span> ((org-clock-out-remove-zero-time-clocks nil))
    (org-clock-out nil t)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/org-clock-out-have-a-break</span> ()
  <span style="font-style: italic;">"Clock in 'Break' task if the task about to clock out manually has any kind of TODO keyword."</span>
  (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">and</span> (not org-clock-clocking-in)
             (org-get-todo-state))
    (org-id-goto <span style="font-style: italic;">"d49d97de-58ec-4e41-b58c-491a9e216e1c"</span>)
    (org-clock-in)
    (org-save-all-org-buffers)))
</pre>
</div>
</div>
</li>

<li><a id="org563bbbd"></a>org-refile<br />
<div class="outline-text-6" id="text-org563bbbd">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package org-refile
  <span style="font-weight: bold;">:after</span> org
  <span style="font-weight: bold;">:custom</span>
  (org-refile-targets
   `((org-agenda-files <span style="font-weight: bold;">:tag</span> . <span style="font-style: italic;">"project"</span>)
     (,(directory-files-recursively org-directory <span style="font-style: italic;">"\\.org$"</span>) <span style="font-weight: bold;">:tag</span> . <span style="font-style: italic;">"refile"</span>))))
</pre>
</div>
</div>
</li>

<li><a id="orgfff4008"></a>org-plot<br />
<div class="outline-text-6" id="text-orgfff4008">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"gnuplot"</span>
<span style="font-style: italic;">"emacs-gnuplot"</span>
<span style="font-style: italic;">"emacs-mkmcc-gnuplot-mode"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package org-plot
  <span style="font-weight: bold;">:after</span> org)
</pre>
</div>
</div>
</li>

<li><a id="org4c3f4e3"></a>org-id<br />
<div class="outline-text-6" id="text-org4c3f4e3">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package org-id
  <span style="font-weight: bold;">:after</span> org
  <span style="font-weight: bold;">:custom</span>
  (org-id-locations-file
   (expand-file-name <span style="font-style: italic;">".org-id-locations"</span> org-directory))
  (org-id-track-globally t)
  (org-id-link-to-org-use-id 'create-if-interactive))
</pre>
</div>
</div>
</li>

<li><a id="org12ed368"></a>org links (ol)<br />
<div class="outline-text-6" id="text-org12ed368">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package ol
  <span style="font-weight: bold;">:after</span> org
  <span style="font-weight: bold;">:custom</span>
  (org-link-elisp-confirm-function nil)
  <span style="font-weight: bold;">:config</span>
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">the file which is referred via ong link opens in same window</span>
  (<span style="font-weight: bold;">setf</span> (alist-get 'file org-link-frame-setup) 'find-file)
  (org-link-set-parameters <span style="font-style: italic;">"src"</span> <span style="font-weight: bold;">:follow</span> #'org-babel-ref-resolve)
  (add-to-list 'org-open-at-point-functions 'org-open-at-point-link)
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">set 'sudo' link type to invoke command with root privilege</span>
  (org-link-set-parameters
   <span style="font-style: italic;">"sudo"</span>
   (<span style="font-weight: bold;">lambda</span> (cmd)
     <span style="font-style: italic;">"Run CMD with sudo."</span>
     (shell-command
      (concat <span style="font-style: italic;">"echo "</span> (shell-quote-argument (read-passwd <span style="font-style: italic;">"Password? "</span>))
              <span style="font-style: italic;">" | sudo -S "</span> cmd)))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">org-open-at-point-link</span> ()
  <span style="font-style: italic;">"This function is responsible for org links when user calls `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">org-open-at-point</span><span style="font-style: italic;">'."</span>
  (<span style="font-weight: bold;">let*</span> ((context (org-element-lineage
                   (org-element-context)
                   '(link)
                   t))
         (type (org-element-property <span style="font-weight: bold;">:type</span> context))
         (path (org-element-property <span style="font-weight: bold;">:path</span> context))
         (app (org-element-property <span style="font-weight: bold;">:application</span> context))
         (search-option (org-element-property <span style="font-weight: bold;">:search-option</span> context)))
    (<span style="font-weight: bold;">if</span> (stringp type)
        (<span style="font-weight: bold;">cond</span>
         ((string-match-p <span style="font-style: italic;">"https?"</span> type)
          (<span style="font-weight: bold;">let</span> ((url-pos (split-location-uri (org-link-unescape (concat type <span style="font-style: italic;">":"</span> path)))))
            (<span style="font-weight: bold;">cl-case</span> (prefix-numeric-value current-prefix-arg)
              (16 (browse-url-default-browser (car url-pos)))
              (4 (eww-browse-url (car url-pos)))
              (t (open-url (car url-pos) (cadr url-pos))))
            t))
         ((string= type <span style="font-style: italic;">"file"</span>)
          (<span style="font-weight: bold;">let</span> ((line-search (<span style="font-weight: bold;">cond</span> ((not search-option) nil)
                                   ((string-match-p <span style="font-style: italic;">"\\`[0-9]+\\'"</span> search-option)
                                    (list (string-to-number search-option)))
                                   (t (list nil search-option)))))
            (apply #'my/org-open-file
                   path
                   (<span style="font-weight: bold;">cond</span>
                    ((equal app <span style="font-style: italic;">"sys"</span>) 'system)
                    ((equal app <span style="font-style: italic;">"emacs"</span>) 'emacs)
                    (t nil))
                   line-search))
          t))
      (my/enter-thing-at-point))))
</pre>
</div>
</div>
</li>

<li><a id="org65e1a07"></a>org-archive<br />
<div class="outline-text-6" id="text-org65e1a07">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package org-archive
  <span style="font-weight: bold;">:after</span> org
  <span style="font-weight: bold;">:custom</span>
  (org-archive-default-command 'org-archive-set-tag)
  (org-cycle-open-archived-trees t))
</pre>
</div>
</div>
</li>

<li><a id="org3317eca"></a>org-list<br />
<div class="outline-text-6" id="text-org3317eca">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package org-list
  <span style="font-weight: bold;">:after</span> org
  <span style="font-weight: bold;">:custom</span>
  (org-list-demote-modify-bullet '((<span style="font-style: italic;">"-"</span> . <span style="font-style: italic;">"+"</span>) (<span style="font-style: italic;">"+"</span> . <span style="font-style: italic;">"-"</span>) (<span style="font-style: italic;">"*"</span> . <span style="font-style: italic;">"-"</span>)
                                   (<span style="font-style: italic;">"1."</span> . <span style="font-style: italic;">"1)"</span>) (<span style="font-style: italic;">"1)"</span> . <span style="font-style: italic;">"1."</span>) (<span style="font-style: italic;">"*"</span> . <span style="font-style: italic;">"1."</span>)))
  (org-cycle-include-plain-lists 'integrate)
  (org-list-use-circular-motion t)
  (org-list-allow-alphabetical t)
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">setf</span> org-list-forbidden-blocks nil))
</pre>
</div>
</div>
</li>

<li><a id="org31ecdaf"></a>org-indent<br />
<div class="outline-text-6" id="text-org31ecdaf">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package org-indent
  <span style="font-weight: bold;">:after</span> org
  <span style="font-weight: bold;">:hook</span>
  (org-mode . org-indent-mode)
  <span style="font-weight: bold;">:custom</span>
  (org-startup-indented t))
</pre>
</div>
</div>
</li>

<li><a id="orgf3ea91b"></a>org-crypt<br />
<div class="outline-text-6" id="text-orgf3ea91b">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package org-crypt
  <span style="font-weight: bold;">:after</span> org
  <span style="font-weight: bold;">:custom</span>
  (org-crypt-key user-mail-address)
  (org-tags-exclude-from-inheritance '(<span style="font-style: italic;">"crypt"</span>))
  <span style="font-weight: bold;">:config</span>
  (org-crypt-use-before-save-magic))
</pre>
</div>
</div>
</li>

<li><a id="org3d589b7"></a>org-babel<br />
<div class="outline-text-6" id="text-org3d589b7">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"graphviz"</span>
<span style="font-style: italic;">"plantuml"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package ob-core
  <span style="font-weight: bold;">:after</span> org
  <span style="font-weight: bold;">:custom</span>
  (org-confirm-babel-evaluate nil)
  <span style="font-weight: bold;">:config</span>
  (org-babel-do-load-languages
   'org-babel-load-languages
   '((C        . t)
     (java     . t)
     (R        . t)
     (shell    . t)
     (ruby     . t)
     (python   . t)
     (org      . t)
     (lua      . t)
     (gnuplot  . t)
     (dot      . t)
     (plantuml . t)
     (lilypond . t)))
  (add-hook 'org-babel-after-execute-hook 'org-display-inline-images)
  (<span style="font-weight: bold;">cond</span>
   ((string= system-type <span style="font-style: italic;">"gnu/linux"</span>)
    (custom-set-variables `(org-plantuml-jar-path ,(expand-file-name <span style="font-style: italic;">"plantuml.jar"</span> <span style="font-style: italic;">"~/.guix-profile/share/java"</span>))))
   ((string= system-type <span style="font-style: italic;">"darwin"</span>)
    (custom-set-variables '(org-plantuml-jar-path <span style="font-style: italic;">"/usr/local/Cellar/plantuml/8041/plantuml.8041.jar"</span>)))))
</pre>
</div>
</div>

<ul class="org-ul">
<li><a id="org6058aec"></a>ob-async<br />
<div class="outline-text-7" id="text-org6058aec">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-ob-async"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package ob-async
  <span style="font-weight: bold;">:after</span> ob-core)
</pre>
</div>
</div>
</li>

<li><a id="orgb17b729"></a>ob-lilypond<br />
<div class="outline-text-7" id="text-orgb17b729">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package ob-lilypond
  <span style="font-weight: bold;">:after</span> (org lilypond-mode)
  <span style="font-weight: bold;">:custom</span>
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(org-babel-lilypond-commands '("lilypond" "firefox" "fluidsynth -a alsa -m alsa_seq -l"))</span>
  (org-babel-lilypond-commands '(<span style="font-style: italic;">"lilypond"</span> <span style="font-style: italic;">"firefox"</span> <span style="font-style: italic;">"xdg-open"</span>))
  (org-babel-lilypond-arrange-mode t))
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="org906e6b1"></a>org-src<br />
<div class="outline-text-6" id="text-org906e6b1">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package org-src
  <span style="font-weight: bold;">:diminish</span> (org-src-mode . <span style="font-style: italic;">"os"</span>)
  <span style="font-weight: bold;">:custom</span>
  (org-src-window-setup 'current-window)
  <span style="font-weight: bold;">:config</span>
  (advice-add #'org-edit-src-save
              <span style="font-weight: bold;">:before</span>
              #'my/delete-trailing-whitespace)
  (advice-add #'org-edit-src-exit
              <span style="font-weight: bold;">:after</span>
              #'save-buffer))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/delete-trailing-whitespace</span> ()
  (delete-trailing-whitespace))
</pre>
</div>
</div>
</li>

<li><a id="orgde2c4ab"></a>org-export<br />
<div class="outline-text-6" id="text-orgde2c4ab">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-ox-hugo"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package ox
  <span style="font-weight: bold;">:defer</span> t
  <span style="font-weight: bold;">:after</span> org
  <span style="font-weight: bold;">:custom</span>
  (org-export-with-smart-quotes t)
  (org-export-with-emphasize t)
  (org-export-with-special-strings t)
  (org-export-with-fixed-width t)
  (org-export-with-timestamps t)
  (org-export-preserve-breaks nil)
  (org-export-with-sub-superscripts nil)
  (org-export-with-archived-trees 'headline)
  (org-export-with-author nil)
  (org-export-with-broken-links 'mark)
  (org-export-with-clocks nil)
  (org-export-with-creator nil)
  (org-export-with-drawers '(not <span style="font-style: italic;">"LOGBOOK"</span>))
  (org-export-with-date nil)
  (org-export-with-entities t)
  (org-export-with-email nil)
  (org-export-with-footnotes t)
  (org-export-headline-levels 5)
  (org-export-with-inlinetasks t)
  (org-export-with-section-numbers nil)
  (org-export-with-planning nil)
  (org-export-with-priority nil)
  (org-export-with-properties nil)
  (org-export-with-statistics-cookies t)
  (org-export-with-tags nil)
  (org-export-with-tasks t)
  (org-export-with-latex t)
  (org-export-time-stamp-file nil)
  (org-export-with-title t)
  (org-export-with-toc nil)
  (org-export-with-todo-keywords nil)
  (org-export-with-tables t)
  (org-export-default-language <span style="font-style: italic;">"ja"</span>)
  (org-export-dispatch-use-expert-ui nil))

(use-package ox-html
  <span style="font-weight: bold;">:defer</span> t
  <span style="font-weight: bold;">:after</span> ox
  <span style="font-weight: bold;">:custom</span>
  (org-html-preamble t)
  (org-html-postamble 'auto)
  (org-html-with-latex t)
  (org-html-container-element <span style="font-style: italic;">"div"</span>)
  (org-html-doctype <span style="font-style: italic;">"xhtml-strict"</span>))

(use-package ox-latex
  <span style="font-weight: bold;">:defer</span> t
  <span style="font-weight: bold;">:after</span> ox
  <span style="font-weight: bold;">:custom</span>
  (org-latex-pdf-process '(<span style="font-style: italic;">"platex %f"</span>
                           <span style="font-style: italic;">"platex %f"</span>
                           <span style="font-style: italic;">"bibtex %b"</span>
                           <span style="font-style: italic;">"platex %f"</span>
                           <span style="font-style: italic;">"platex %f"</span>
                           <span style="font-style: italic;">"dvipdfmx %b.dvi"</span>))
  (org-latex-default-class <span style="font-style: italic;">"jsarticle"</span>)
  <span style="font-weight: bold;">:config</span>
  (add-to-list 'org-latex-classes
               '(<span style="font-style: italic;">"jsarticle"</span>
                 <span style="font-style: italic;">"\\documentclass[dvipdfmx,12pt]{jsarticle}"</span>
                 (<span style="font-style: italic;">"\\section{%s}"</span> . <span style="font-style: italic;">"\\section*{%s}"</span>)
                 (<span style="font-style: italic;">"\\subsection{%s}"</span> . <span style="font-style: italic;">"\\subsection*{%s}"</span>)
                 (<span style="font-style: italic;">"\\subsubsection{%s}"</span> . <span style="font-style: italic;">"\\subsubsection*{%s}"</span>)
                 (<span style="font-style: italic;">"\\paragraph{%s}"</span> . <span style="font-style: italic;">"\\paragraph*{%s}"</span>)
                 (<span style="font-style: italic;">"\\subparagraph{%s}"</span> . <span style="font-style: italic;">"\\subparagraph*{%s}"</span>)))
  (add-to-list 'org-latex-classes
               `(<span style="font-style: italic;">"beamer"</span>
                 <span style="font-style: italic;">"\\documentclass[presentation,dvipdfmx,18pt]{beamer}\n"</span>
                 (<span style="font-style: italic;">"\\section{%s}"</span> . <span style="font-style: italic;">"\\section*{%s}"</span>)
                 (<span style="font-style: italic;">"\\subsection{%s}"</span> . <span style="font-style: italic;">"\\subsection*{%s}"</span>)
                 (<span style="font-style: italic;">"\\subsubsection{%s}"</span> . <span style="font-style: italic;">"\\subsubsection*{%s}"</span>))))

(use-package ox-hugo
  <span style="font-weight: bold;">:defer</span> t
  <span style="font-weight: bold;">:after</span> ox)
</pre>
</div>
</div>
</li>

<li><a id="org0094219"></a>org-contrib<br />
<div class="outline-text-6" id="text-org0094219">
<p>
org-contrib is a set of 3rd party add-ons for org-mode.
</p>
</div>

<ul class="org-ul">
<li><a id="org07c07d9"></a>org-contacts<br />
<div class="outline-text-7" id="text-org07c07d9">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-org-contacts"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package org-contacts
  <span style="font-weight: bold;">:after</span> org
  <span style="font-weight: bold;">:custom</span>
  (org-contacts-files `(,(expand-file-name <span style="font-style: italic;">"index/contacts.org.gpg"</span> org-directory))))
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="orgeda927b"></a>org-reveal<br />
<div class="outline-text-6" id="text-orgeda927b">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-org-reveal"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package ox-reveal
  <span style="font-weight: bold;">:after</span> ox)
</pre>
</div>
</div>
</li>

<li><a id="org50b4a02"></a>org-ql<br />
<div class="outline-text-6" id="text-org50b4a02">
<p>
<a href="https://github.com/alphapapa/org-ql">Org QL</a> enables me to issue queries to search org entries with either SQL-like format or plain search strings.
</p>

<p>
Org QL on Guix official channel is version 0.6 which is quite obsolete. I temporarily decided to use an org-ql managed by straight.el as a work around.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-style: italic;">"https://github.com/alphapapa/org-ql/releases.atom"</span> soft_update)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package org-ql
  <span style="font-weight: bold;">:straight</span> t
  <span style="font-weight: bold;">:after</span> org
  <span style="font-weight: bold;">:custom</span>
  (org-ql-search-directories-files-recursive t)
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">org-ql-search</span>)
  (org-ql-defpred (tags-expanded expanded-tags tags-x xtags) (<span style="font-weight: bold; text-decoration: underline;">&amp;rest</span> tags)
    <span style="font-style: italic;">"Return non-nil if current heading has one or more of TAGS.</span>
<span style="font-style: italic;">If TAGS contains a group tag, all tags in the group is used to match.</span>
<span style="font-style: italic;">Both inherited and local tags is tested."</span>
    <span style="font-weight: bold;">:normalizers</span> ((`(,predicate-names . ,tags)
                   `(tags-expanded ,@tags)))
    <span style="font-weight: bold;">:body</span> (apply #'org-ql--predicate-tags
                 (seq-uniq (--mapcat (org-tags-expand it t)
                                     tags))))
  (org-ql-defpred (category-inherited) (<span style="font-weight: bold; text-decoration: underline;">&amp;rest</span> categories)
    <span style="font-style: italic;">"Return non-nil if current heading has CATEGORY.</span>
<span style="font-style: italic;">Ancestors are looked up If current heading has no CATEGORY."</span>
    <span style="font-weight: bold;">:body</span> (when-let ((category (<span style="font-weight: bold;">or</span> (org-get-category (point))
                                   (org-entry-get (point) <span style="font-style: italic;">"CATEGORY"</span> t))))
            (<span style="font-weight: bold;">cl-typecase</span> categories
              (null t)
              (otherwise (member category categories))))))
</pre>
</div>
</div>
</li>

<li><a id="org9f66476"></a>org-ml<br />
<div class="outline-text-6" id="text-org9f66476">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-style: italic;">"https://github.com/ndwarshuis/org-ml/releases.atom"</span> soft_update)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package org-ml
  <span style="font-weight: bold;">:straight</span> t
  <span style="font-weight: bold;">:after</span> org)
</pre>
</div>
</div>
</li>

<li><a id="orgd7ef483"></a>org-roam<br />
<div class="outline-text-6" id="text-orgd7ef483">
<p>
org-roam v2
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-org-roam"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-style: italic;">"https://github.com/org-roam/org-roam/releases.atom"</span> soft_update)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package org-roam
  <span style="font-weight: bold;">:after</span> org
  <span style="font-weight: bold;">:bind</span> ((<span style="font-style: italic;">"C-c n l"</span> . org-roam-buffer-toggle-display)
         (<span style="font-style: italic;">"C-c n D"</span> . org-roam-find-directory)
         (<span style="font-style: italic;">"C-c n f"</span> . org-roam-find-file)
         (<span style="font-style: italic;">"C-c n i"</span> . org-roam-insert)
         <span style="font-weight: bold;">:map</span> org-mode-map
         (<span style="font-style: italic;">"C-M-i"</span> . completion-at-point))
  <span style="font-weight: bold;">:custom</span>
  (org-roam-directory (expand-file-name <span style="font-style: italic;">"note"</span> org-directory))
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">DB does not have to be with org files since it is derived from org files uniquely</span>
  (org-roam-db-location (expand-file-name <span style="font-style: italic;">"org-roam.db"</span> <span style="font-style: italic;">"~/share/emacs/org-roam"</span>))
  (org-roam-buffer-position 'bottom))
</pre>
</div>
</div>
</li>
<li><a id="org6aa6e04"></a>org-drill<br />
<div class="outline-text-6" id="text-org6aa6e04">
<p>
<a href="https://gitlab.com/phillord/org-drill">org-drill</a> helps me to learn english words and phrases. <a href="https://youtu.be/SGzdFtN_NqE">This video</a> introduces how I use org-drill.
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-org-drill"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-style: italic;">"https://gitlab.com/phillord/org-drill/-/tags?format=atom"</span> soft_update)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package org-drill
  <span style="font-weight: bold;">:after</span> org
  <span style="font-weight: bold;">:custom</span>
  (org-drill-spaced-repetition-algorithm 'sm5)
  (org-drill-sm5-initial-interval 10.0)
  (org-drill-add-random-noise-to-intervals-p t)
  (org-drill-adjust-intervals-for-early-and-late-repetitions-p t)
  (org-drill-days-before-old 20)
  (org-drill-learn-fraction 0.65)
  (org-drill-overdue-interval-factor 1.6))
</pre>
</div>
</div>
</li>
<li><a id="orge4e4edf"></a>org-mime<br />
<div class="outline-text-6" id="text-orge4e4edf">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-org-mime"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package org-mime
  <span style="font-weight: bold;">:after</span> org
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">push</span> '(<span style="font-style: italic;">"Send An Email"</span>) org-speed-commands))
</pre>
</div>
</div>
</li>

<li><a id="org0cb14a0"></a>org-web-tools<br />
<div class="outline-text-6" id="text-org0cb14a0">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-org-web-tools"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package org-web-tools
  <span style="font-weight: bold;">:after</span> org
  <span style="font-weight: bold;">:demand</span> t
  <span style="font-weight: bold;">:bind</span> ((<span style="font-style: italic;">"C-c C-;"</span> . org-web-tools-insert-link-for-url)))
</pre>
</div>
</div>
</li>

<li><a id="orgc246722"></a>org-volume<br />
<div class="outline-text-6" id="text-orgc246722">
<p>
<a href="https://github.com/akirak/org-volume">org-volume</a> can be used to insert book information in dynamic block.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-style: italic;">"https://github.com/akirak/org-volume/releases.atom"</span> soft_update)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package org-volume
  <span style="font-weight: bold;">:straight</span> (org-volume
             <span style="font-weight: bold;">:host</span> github
             <span style="font-weight: bold;">:repo</span> <span style="font-style: italic;">"akirak/org-volume"</span>
             <span style="font-weight: bold;">:branch</span> <span style="font-style: italic;">"master"</span>))
</pre>
</div>
</div>
</li>

<li><a id="org14d3a44"></a>org-clock-convenience<br />
<div class="outline-text-6" id="text-org14d3a44">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-style: italic;">"https://github.com/dfeich/org-clock-convenience/releases.atom"</span> soft_update)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package org-clock-convenience
  <span style="font-weight: bold;">:straight</span> t
  <span style="font-weight: bold;">:after</span> (org)
  <span style="font-weight: bold;">:bind</span> (<span style="font-weight: bold;">:map</span> org-agenda-mode-map
              (<span style="font-style: italic;">"@"</span>   . org-clock-convenience-fill-gap)
              (<span style="font-style: italic;">"C-@"</span> . org-clock-convenience-fill-gap-both)))
</pre>
</div>
</div>
</li>

<li><a id="org6bf5a1a"></a>custom functions<br />
<div class="outline-text-6" id="text-org6bf5a1a">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/org-open-file</span> (path <span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> in-emacs line search)
  <span style="font-style: italic;">"docstring"</span>
  (<span style="font-weight: bold;">cl-case</span> (prefix-numeric-value current-prefix-arg)
    (16 (my/view-file path t))
    (4 (org-open-file path t line search))
    (t (<span style="font-weight: bold;">cond</span>
        ((member in-emacs '((16) system))
         (my/view-file path t))
        ((member in-emacs '((4) emacs))
         (org-open-file path t line search))
        (t (my/view-file path)
           (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">or</span> line search)
             (goto-pos (<span style="font-weight: bold;">or</span> line search))))))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/org-babel-lob-ingest-batch</span> ()
  (<span style="font-weight: bold;">interactive</span>)
  (mapc (<span style="font-weight: bold;">lambda</span> (dir)
          (<span style="font-weight: bold;">dolist</span> (f (directory-files (expand-file-name dir org-directory) <span style="font-style: italic;">"</span><span style="font-weight: bold; font-style: italic;">\</span><span style="font-style: italic;">.org$"</span>))
            (org-babel-lob-ingest f)))
        '(<span style="font-style: italic;">"agenda"</span> <span style="font-style: italic;">"index"</span> <span style="font-style: italic;">"wiki"</span>)))

(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">org-readable-directory</span> <span style="font-style: italic;">"~/tmp"</span>
  <span style="font-style: italic;">"A directory where generated html files are located in org-readable."</span>)

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">org-readable</span> ()
  <span style="font-style: italic;">"Show current org subtree in EWW."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">let*</span> ((heading (org-get-heading t t t t))
         (org-export-show-temporary-export-buffer nil)
         (export-buf-name <span style="font-style: italic;">"*Org HTML Export*"</span>)
         (org-export-with-broken-links 'mark)
         (id (org-id-get))
         (uuid (downcase (<span style="font-weight: bold;">if</span> id id (org-id-uuid))))
         (org-readable-file (format <span style="font-style: italic;">"%s/%s.html"</span> org-readable-directory uuid)))
    (org-html-export-as-html nil t nil)
    (<span style="font-weight: bold;">with-current-buffer</span> export-buf-name
      (write-file org-readable-file)
      (eww-open-file org-readable-file))
    (kill-buffer export-buf-name)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">org-property-copy-as-kill</span> ()
  <span style="font-style: italic;">"Prompt user to select property to append to the kill ring.</span>

<span style="font-style: italic;">If property's value matches $(...) format, ... is interpreted as shell command and execute it."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">let*</span> ((properties (org-entry-properties))
         (prop-key-to-copy
          (completing-read <span style="font-style: italic;">"Property name: "</span>
                           (mapcar #'(lambda (var) (car var)) properties))))
    (<span style="font-weight: bold;">when</span> (stringp prop-key-to-copy)
      (<span style="font-weight: bold;">let*</span> ((prop-value (cdr (assoc prop-key-to-copy properties)))
             (str-to-copy
              (<span style="font-weight: bold;">cond</span>
               ((string-match <span style="font-style: italic;">"$(</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">.+</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">)"</span> prop-value)
                (shell-command-to-string (match-string 1 prop-value)))
               (t prop-value))))
        (kill-new str-to-copy)))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/org-reset-dwim</span> ()
  <span style="font-style: italic;">"Do reset procedure in each context."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">cond</span>
   ((org-at-table-p) (org-table-blank-field))
   ((org-in-subtree-not-table-p)
    (<span style="font-weight: bold;">org-save-outline-visibility</span> t
      (org-reset-checkbox-state-subtree)))))

<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">WARN: This function does not work correctly</span>
<span style="font-weight: bold; font-style: italic;">;;       </span><span style="font-weight: bold; font-style: italic;">Wait until library org-ml get mature</span>
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">org-gc-drawer-subtree</span> ()
  <span style="font-style: italic;">"Remove all clocks and items in drawer of subtrees older than a month before."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">let*</span> ((month-before (-&gt;&gt; (decode-time (current-time))
                            (--map-indexed (<span style="font-weight: bold;">if</span> (= it-index 4)
                                               (- it 1) it))
                            (encode-time)))
         (config (list <span style="font-weight: bold;">:log-into-drawer</span> t
                       <span style="font-weight: bold;">:clock-into-drawer</span> t))
         (gc-clock-fun (<span style="font-weight: bold;">lambda</span> (headline)
                         (org-ml-update*
                           (org-ml-headline-map-logbook-clocks* config
                             (--filter
                              (time-less-p month-before
                                           (org-ml-time-to-unixtime
                                            (org-ml-timestamp-get-end-time
                                             (org-ml-get-property <span style="font-weight: bold;">:value</span> it))))
                              it)
                             it)
                           headline)))
         (gc-item-fun (<span style="font-weight: bold;">lambda</span> (headline)
                        (org-ml-update*
                          (org-ml-headline-map-logbook-items* config
                            (--filter
                             (time-less-p month-before
                                          (org-ml-logbook-item-get-timestamp it))
                             it)
                            it)
                          headline))))
    (-&gt;&gt; (org-ml-parse-this-headline)
         (funcall gc-clock-fun))
    (-&gt;&gt; (org-ml-parse-this-headline)
         (funcall gc-item-fun))
    (-&gt;&gt; (org-ml-parse-this-subtree)
         (org-ml-headline-get-subheadlines)
         (-map gc-clock-fun))
    (-&gt;&gt; (org-ml-parse-this-subtree)
         (org-ml-headline-get-subheadlines)
         (-map gc-item-fun))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">org-download-video-link-at-point</span> (<span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> playlistp)
  <span style="font-style: italic;">"Download video file at point.</span>
<span style="font-style: italic;">With `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">C-u</span><span style="font-style: italic;">' prefix arg, try to download all videos in playlist.</span>

<span style="font-style: italic;">Video file is expected to appear in org-link."</span>
  (<span style="font-weight: bold;">interactive</span> <span style="font-style: italic;">"P"</span>)
  (org-link-at-point-map (<span style="font-weight: bold;">lambda</span> (url title)
                           (my/download-video url title playlistp))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">org-download-audio-link-at-point</span> ()
  <span style="font-style: italic;">"Download audio file at point.</span>

<span style="font-style: italic;">Audio file is expected to appear in org-link."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (org-link-at-point-map (<span style="font-weight: bold;">lambda</span> (url title)
                           (my/download-audio url title))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">org-show-media-duration-at-point</span> ()
  <span style="font-style: italic;">"Show duration of media at point."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (org-link-at-point-map (<span style="font-weight: bold;">lambda</span> (url title)
                           (show-media-duration url))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">org-link-at-point-map</span> (<span style="font-weight: bold;">function</span>)
  <span style="font-style: italic;">"Call `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">FUNCTION</span><span style="font-style: italic;">' with url and title obtained from org-link at point."</span>
  (<span style="font-weight: bold;">let*</span> ((context (org-element-lineage
                   (org-element-context)
                   '(link)
                   t))
         (type (org-element-property <span style="font-weight: bold;">:type</span> context))
         (path (org-element-property <span style="font-weight: bold;">:path</span> context))
         (desc (when-let ((begin (org-element-property <span style="font-weight: bold;">:contents-begin</span> context))
                          (end (org-element-property <span style="font-weight: bold;">:contents-end</span> context)))
                 (buffer-substring begin end))))
    (<span style="font-weight: bold;">cond</span>
     ((string-match-p <span style="font-style: italic;">"https?"</span> type)
      (funcall function (org-link-unescape (concat type <span style="font-style: italic;">":"</span> path)) desc))
     ((string-match-p <span style="font-style: italic;">"elfeed"</span> type)
      (<span style="font-weight: bold;">save-excursion</span>
        (org-open-at-point)
        (<span style="font-weight: bold;">when</span> (eq major-mode 'elfeed-show-mode)
          (when-let ((url (<span style="font-weight: bold;">or</span> (caar (elfeed-entry-enclosures elfeed-show-entry))
                              (elfeed-entry-link elfeed-show-entry)))
                     (title (elfeed-entry-title elfeed-show-entry)))
            (funcall function url title))
          (quit-window)))))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">org-send-email</span> (<span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> arg)
  <span style="font-style: italic;">"Send a html email extracted from current org entry.</span>

<span style="font-style: italic;">Given a `\\[</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">universal-argument</span><span style="font-style: italic;">]' prefix `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">ARG</span><span style="font-style: italic;">', send an ascii email instead."</span>
  (<span style="font-weight: bold;">interactive</span> <span style="font-style: italic;">"P"</span>)
  (<span style="font-weight: bold;">cond</span>
   ((equal arg '(4))
    (call-interactively #'org-send-email-ascii))
   (t
    (<span style="font-weight: bold;">let</span> ((org-mime-use-property-inheritance t))
      (call-interactively #'org-mime-org-subtree-htmlize)))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">org-send-email-ascii</span> ()
  <span style="font-style: italic;">"Send a mail whose contents converted from current org entry.</span>

<span style="font-style: italic;">Format of mail contents is plain text."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">let</span> ((heading (org-get-heading t t t t))
        (org-export-show-temporary-export-buffer nil)
        (export-buf-name <span style="font-style: italic;">"*Org ASCII Export*"</span>)
        (org-export-with-toc nil)
        (org-export-with-author nil))
    (org-ascii-export-as-ascii nil t t t)
    (mail-simple-send (<span style="font-weight: bold;">or</span> (org-entry-get (point) <span style="font-style: italic;">"MAIL_TO"</span> t)
                          (read-string <span style="font-style: italic;">"MAIL_TO: "</span>))
                      heading
                      (<span style="font-weight: bold;">with-current-buffer</span> export-buf-name
                        (buffer-string)))
    (kill-buffer export-buf-name)))

</pre>
</div>
</div>
</li>

<li><a id="orge1beffd"></a>key bindings<br />
<div class="outline-text-6" id="text-orge1beffd">
<p>
speed commands and hydra-org.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package org-keys
  <span style="font-weight: bold;">:after</span> org
  <span style="font-weight: bold;">:custom</span>
  (org-use-speed-commands
   (<span style="font-weight: bold;">lambda</span> () (<span style="font-weight: bold;">and</span> (looking-at org-outline-regexp) (looking-back <span style="font-style: italic;">"^</span><span style="font-weight: bold; font-style: italic;">\</span><span style="font-style: italic;">**"</span>))))
  (org-speed-commands
   '((<span style="font-style: italic;">"Outline Navigation"</span>)
     (<span style="font-style: italic;">"n"</span> . (org-speed-move-safe 'org-next-visible-heading))
     (<span style="font-style: italic;">"p"</span> . (org-speed-move-safe 'org-previous-visible-heading))
     (<span style="font-style: italic;">"f"</span> . (org-speed-move-safe 'org-forward-heading-same-level))
     (<span style="font-style: italic;">"b"</span> . (org-speed-move-safe 'org-backward-heading-same-level))
     (<span style="font-style: italic;">"F"</span> . org-next-block)
     (<span style="font-style: italic;">"B"</span> . org-previous-block)
     (<span style="font-style: italic;">"u"</span> . (org-speed-move-safe 'outline-up-heading))
     (<span style="font-style: italic;">"j"</span> . org-goto)
     (<span style="font-style: italic;">"g"</span> . (org-refile t))
     (<span style="font-style: italic;">"Outline Visibility"</span>)
     (<span style="font-style: italic;">"c"</span> . org-ctrl-c-tab)
     (<span style="font-style: italic;">"C"</span> . org-shifttab)
     (<span style="font-style: italic;">" "</span> . org-display-outline-path)
     (<span style="font-style: italic;">"N"</span> . my/toggle-narrow-dwim)
     (<span style="font-style: italic;">"z"</span> . org-toggle-narrow-to-subtree)
     (<span style="font-style: italic;">"="</span> . org-columns)
     (<span style="font-style: italic;">"/"</span> . org-sparse-tree)
     (<span style="font-style: italic;">"Outline Structure Editing"</span>)
     (<span style="font-style: italic;">"U"</span> . org-metaup)
     (<span style="font-style: italic;">"D"</span> . org-metadown)
     (<span style="font-style: italic;">"r"</span> . org-metaright)
     (<span style="font-style: italic;">"l"</span> . org-metaleft)
     (<span style="font-style: italic;">"R"</span> . org-shiftmetaright)
     (<span style="font-style: italic;">"L"</span> . org-shiftmetaleft)
     (<span style="font-style: italic;">"i"</span> . (<span style="font-weight: bold;">progn</span> (forward-char 1) (call-interactively 'org-insert-heading-respect-content)))
     (<span style="font-style: italic;">"^"</span> . org-sort)
     (<span style="font-style: italic;">"w"</span> . org-refile)
     (<span style="font-style: italic;">"a"</span> . org-archive-subtree-default-with-confirmation)
     (<span style="font-style: italic;">"@"</span> . org-mark-subtree)
     (<span style="font-style: italic;">"#"</span> . org-toggle-comment)
     (<span style="font-style: italic;">"Clock Commands"</span>)
     (<span style="font-style: italic;">"I"</span> . org-clock-in)
     (<span style="font-style: italic;">"O"</span> . my/org-clock-out-without-remove)
     (<span style="font-style: italic;">"X"</span> . org-clock-cancel)
     (<span style="font-style: italic;">"Meta Data Editing"</span>)
     (<span style="font-style: italic;">"t"</span> . org-todo)
     (<span style="font-style: italic;">","</span> . (org-priority))
     (<span style="font-style: italic;">"0"</span> . (org-priority ?\ ))
     (<span style="font-style: italic;">":"</span> . org-set-tags-command)
     (<span style="font-style: italic;">"P"</span> . org-set-property)
     (<span style="font-style: italic;">"e"</span> . org-set-effort)
     (<span style="font-style: italic;">"E"</span> . org-inc-effort)
     (<span style="font-style: italic;">"s"</span> . org-schedule)
     (<span style="font-style: italic;">"d"</span> . org-deadline)
     (<span style="font-style: italic;">"v"</span> . org-property-copy-as-kill)
     (<span style="font-style: italic;">"W"</span> . (<span style="font-weight: bold;">lambda</span> (m) (<span style="font-weight: bold;">interactive</span> <span style="font-style: italic;">"sMinutes before warning: "</span>) (org-entry-put (point) <span style="font-style: italic;">"APPT_WARNTIME"</span> m)))
     (<span style="font-style: italic;">"Org Capture"</span>)
     (<span style="font-style: italic;">"Misc"</span>)
     (<span style="font-style: italic;">"$"</span> . my/org-archive-subtree)
     (<span style="font-style: italic;">"!"</span> . org-readable)
     (<span style="font-style: italic;">"o"</span> . org-open-at-point)
     (<span style="font-style: italic;">"M"</span> . org-send-email)
     (<span style="font-style: italic;">"?"</span> . org-speed-command-help)
     (<span style="font-style: italic;">"&lt;"</span> . (org-agenda-set-restriction-lock 'subtree))
     (<span style="font-style: italic;">"&gt;"</span> . (org-agenda-remove-restriction-lock)))))

(<span style="font-weight: bold;">with-eval-after-load</span> 'hydra
  (defhydra hydra-org (global-map <span style="font-style: italic;">"C-o"</span>
                                  <span style="font-weight: bold;">:color</span> teal)
    <span style="font-style: italic;">"Org Search"</span>
    (<span style="font-style: italic;">"a"</span> org-agenda)
    (<span style="font-style: italic;">"c"</span> org-capture)
    (<span style="font-style: italic;">"t"</span> org-set-tags-command)
    (<span style="font-style: italic;">"j"</span> org-clock-goto)
    (<span style="font-style: italic;">"g"</span> consult-org-agenda)
    (<span style="font-style: italic;">"h"</span> consult-outline)
    (<span style="font-style: italic;">"ee"</span> my/org-english-capture)
    (<span style="font-style: italic;">"ed"</span> my/org-english-drill)
    (<span style="font-style: italic;">"eD"</span> my/org-english-drill-resume)
    (<span style="font-style: italic;">"et"</span> my/org-english-drill-test-display)
    (<span style="font-style: italic;">"s"</span> org-store-link)
    (<span style="font-style: italic;">"C-s"</span> org-save-all-org-buffers)
    (<span style="font-style: italic;">"TAB"</span> org-indent-mode)
    (<span style="font-style: italic;">"i"</span> org-info-find-node)
    (<span style="font-style: italic;">"&amp;"</span> org-mark-ring-goto)
    (<span style="font-style: italic;">"I"</span> org-clock-in)
    (<span style="font-style: italic;">"O"</span> my/org-clock-out-without-remove)
    (<span style="font-style: italic;">"X"</span> org-clock-cancel)
    (<span style="font-style: italic;">"qq"</span> org-ql-search)
    (<span style="font-style: italic;">"qv"</span> org-ql-view)
    (<span style="font-style: italic;">"qr"</span> my/org-archive-search)
    (<span style="font-style: italic;">"r"</span> my/org-archive-find-date)
    (<span style="font-style: italic;">"l"</span> my/lookup-org-archive)
    (<span style="font-style: italic;">"bi"</span> my/org-babel-lob-ingest-batch)
    (<span style="font-style: italic;">"@"</span> org-mark-subtree)
    (<span style="font-style: italic;">"="</span> org-clock-sum-all)
    (<span style="font-style: italic;">"SPC"</span> my/org-reset-dwim)
    (<span style="font-style: italic;">"C-g"</span> nil <span style="font-style: italic;">"quit"</span>)))
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="orgb501336"></a>Completion framework<br />
<div class="outline-text-5" id="text-orgb501336">
</div>

<ul class="org-ul">
<li><a id="org7bc02cf"></a>vertico<br />
<div class="outline-text-6" id="text-org7bc02cf">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-vertico"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-style: italic;">"https://github.com/minad/vertico/releases.atom"</span> soft_update)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package vertico
  <span style="font-weight: bold;">:config</span>
  (bind-keys <span style="font-weight: bold;">:map</span> vertico-map
             (<span style="font-style: italic;">"M-w"</span> . vertico-save))
  (vertico-mode))
</pre>
</div>
</div>
</li>

<li><a id="orgddc5d97"></a>consult<br />
<div class="outline-text-6" id="text-orgddc5d97">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-consult"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-style: italic;">"https://github.com/minad/consult/releases.atom"</span> soft_update)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package consult
  <span style="font-weight: bold;">:after</span> vertico
  <span style="font-weight: bold;">:bind</span>
  (<span style="font-weight: bold;">:map</span> global-map
        (<span style="font-style: italic;">"C-s"</span> . consult-line)
        (<span style="font-style: italic;">"C-;"</span> . consult-buffer)
        (<span style="font-style: italic;">"C-c m"</span> . consult-mode-command)
        (<span style="font-style: italic;">"C-c r"</span> . consult-recent-file)
        (<span style="font-style: italic;">"C-c g"</span> . consult-outline)
        (<span style="font-style: italic;">"C-x M-:"</span> . consult-complex-command)
        (<span style="font-style: italic;">"M-y"</span> . consult-yank-pop)
        (<span style="font-style: italic;">"C-M-y"</span> . consult-yank-from-kill-ring)
        (<span style="font-style: italic;">"M-g M-g"</span> . consult-goto-line)
        (<span style="font-style: italic;">"M-g m"</span> . consult-mark)
        (<span style="font-style: italic;">"M-g M"</span> . consult-global-mark)
        (<span style="font-style: italic;">"M-g i"</span> . consult-imenu)
        (<span style="font-style: italic;">"M-g I"</span> . consult-imenu-multi)
        (<span style="font-style: italic;">"M-s e"</span> . consult-isearch)
        (<span style="font-style: italic;">"M-s \\"</span> . consult-locate)
        (<span style="font-style: italic;">"M-s g"</span> . consult-grep)
        (<span style="font-style: italic;">"M-s G"</span> . consult-git-grep)
        (<span style="font-style: italic;">"M-s r"</span> . consult-ripgrep)
        (<span style="font-style: italic;">"M-s l"</span> . consult-line)
        (<span style="font-style: italic;">"M-s L"</span> . consult-line-multi)
        (<span style="font-style: italic;">"M-s m"</span> . consult-multi-occur)
        (<span style="font-style: italic;">"M-s k"</span> . consult-keep-lines)
        (<span style="font-style: italic;">"M-s u"</span> . consult-focus-lines)
        <span style="font-weight: bold;">:map</span> isearch-mode-map
        (<span style="font-style: italic;">"M-e"</span> . consult-isearch)
        (<span style="font-style: italic;">"M-s e"</span> . consult-isearch)
        (<span style="font-style: italic;">"M-s l"</span> . consult-line)
        (<span style="font-style: italic;">"M-s L"</span> . consult-line-multi)
        (<span style="font-style: italic;">"C-c h"</span> . consult-history)
        <span style="font-weight: bold;">:map</span> minibuffer-local-map
        (<span style="font-style: italic;">"C-c h"</span> . consult-history)
        <span style="font-weight: bold;">:map</span> help-map
        (<span style="font-style: italic;">"a"</span> . consult-apropos)
        <span style="font-weight: bold;">:map</span> org-mode-map
        (<span style="font-style: italic;">"C-c h"</span> . consult-org-heading))
  <span style="font-weight: bold;">:custom</span>
  (consult-line-start-from-top t)
  (consult-project-root-function #'project-root-function))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">project-root-function</span> ()
  (when-let (project (project-current))
    (car (project-roots project))))
</pre>
</div>
</div>

<ul class="org-ul">
<li><a id="org1854a0e"></a>consult-dir<br />
<div class="outline-text-7" id="text-org1854a0e">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-consult-dir"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package consult-dir
  <span style="font-weight: bold;">:bind</span> ((<span style="font-style: italic;">"C-x C-d"</span> . consult-dir)
         <span style="font-weight: bold;">:map</span> vertico-map
         (<span style="font-style: italic;">"C-x C-d"</span> . consult-dir)
         (<span style="font-style: italic;">"C-x C-j"</span> . consult-dir-jump-file)))
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="org44f6a2a"></a>embark<br />
<div class="outline-text-6" id="text-org44f6a2a">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-embark"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-style: italic;">"https://github.com/oantolin/embark/releases.atom"</span> soft_update)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package embark
  <span style="font-weight: bold;">:bind</span> ((<span style="font-style: italic;">"C-."</span> . embark-act)
         (<span style="font-style: italic;">"M-."</span> . embark-dwim)
         (<span style="font-style: italic;">"&lt;help&gt; B"</span> . embark-bindings))
  <span style="font-weight: bold;">:init</span>
  (<span style="font-weight: bold;">setq</span> prefix-help-command #'embark-prefix-help-command) <span style="font-weight: bold; font-style: italic;">;</span>
  <span style="font-weight: bold;">:config</span>
  (bind-keys <span style="font-weight: bold;">:map</span> embark-collect-mode-map
             (<span style="font-style: italic;">"C-j"</span> . push-button)))

(use-package embark-consult
  <span style="font-weight: bold;">:straight</span> t
  <span style="font-weight: bold;">:after</span> (embark consult)
  <span style="font-weight: bold;">:demand</span> t
  <span style="font-weight: bold;">:hook</span>
  (embark-collect-mode . consult-preview-at-point-mode))
</pre>
</div>
</div>
</li>

<li><a id="org83ad56e"></a>marginalia<br />
<div class="outline-text-6" id="text-org83ad56e">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-marginalia"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-style: italic;">"https://github.com/minad/marginalia/releases.atom"</span> soft_update)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package marginalia
  <span style="font-weight: bold;">:custom</span>
  (marginalia-field-width 180)
  <span style="font-weight: bold;">:config</span>
  (marginalia-mode))
</pre>
</div>
</div>
</li>

<li><a id="org7cf65bf"></a>orderless<br />
<div class="outline-text-6" id="text-org7cf65bf">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-orderless"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-style: italic;">"https://github.com/oantolin/orderless/releases.atom"</span> soft_update)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package orderless
  <span style="font-weight: bold;">:custom</span> (completion-styles '(orderless)))
</pre>
</div>
</div>

<ul class="org-ul">
<li><a id="org991f3bb"></a>migemo support<br />
<div class="outline-text-7" id="text-org991f3bb">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">orderless-migemo</span> (component)
  (<span style="font-weight: bold;">let</span> ((pattern (migemo-get-pattern component)))
    (<span style="font-weight: bold;">condition-case</span> nil
        (<span style="font-weight: bold;">progn</span> (string-match-p pattern <span style="font-style: italic;">""</span>) pattern)
      (invalid-regexp nil))))

(orderless-define-completion-style orderless-default-style
  (orderless-matching-styles '(orderless-literal
                               orderless-regexp)))

(orderless-define-completion-style orderless-migemo-style
  (orderless-matching-styles '(orderless-literal
                               orderless-regexp
                               orderless-migemo)))

<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">uncomment below if you wish to apply migemo globally</span>
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(setq orderless-matching-styles '(orderless-literal orderless-regexp orderless-migemo))</span>

(<span style="font-weight: bold;">setq</span> completion-category-overrides
      '((command (styles orderless-default-style))
        (file (styles orderless-migemo-style))
        (buffer (styles orderless-migemo-style))
        (symbol (styles orderless-default-style))
        (consult-location (styles orderless-migemo-style)) <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">category `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">consult-location</span><span style="font-weight: bold; font-style: italic;">' &#12399; `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">consult-line</span><span style="font-weight: bold; font-style: italic;">' &#12394;&#12393;&#12395;&#20351;&#12431;&#12428;&#12427;</span>
        (consult-multi (styles orderless-migemo-style)) <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">category `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">consult-multi</span><span style="font-weight: bold; font-style: italic;">' &#12399; `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">consult-buffer</span><span style="font-weight: bold; font-style: italic;">' &#12394;&#12393;&#12395;&#20351;&#12431;&#12428;&#12427;</span>
        (consult-org-heading (styles orderless-migemo-style))
        (org-roam-node (styles orderless-migemo-style)) <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">category `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">org-roam-node</span><span style="font-weight: bold; font-style: italic;">' &#12399; `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">org-roam-node-find</span><span style="font-weight: bold; font-style: italic;">' &#12391;&#20351;&#12431;&#12428;&#12427;</span>
        (unicode-name (styles orderless-migemo-style))
        (variable (styles orderless-default-style))))
</pre>
</div>
</div>
</li>
</ul>
</li>
</ul>
</li>

<li><a id="org7fb54e6"></a>major modes for programming/editing&#xa0;&#xa0;&#xa0;<span class="tag"><span class="programs">programs</span></span><br />
<div class="outline-text-5" id="text-org7fb54e6">
</div>

<ul class="org-ul">
<li><a id="org6a9d0b0"></a>prog<br />
<div class="outline-text-6" id="text-org6a9d0b0">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package prog-mode
  <span style="font-weight: bold;">:hook</span> (prog-mode . my/prog-mode-hook-function))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/prog-mode-hook-function</span> ()
  (hl-line-mode -1)
  (hs-minor-mode -1)
  (flyspell-prog-mode)
  (display-fill-column-indicator-mode))
</pre>
</div>
</div>
</li>

<li><a id="org1378f7d"></a>sh<br />
<div class="outline-text-6" id="text-org1378f7d">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package sh-script
  <span style="font-weight: bold;">:delight</span> <span style="font-style: italic;">" SH"</span>
  <span style="font-weight: bold;">:commands</span> sh-mode
  <span style="font-weight: bold;">:mode</span> (<span style="font-style: italic;">"\\.sh$"</span> . sh-mode)
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">:dash "Bash"</span>
  <span style="font-weight: bold;">:custom</span>
  (sh-basic-offset 2)
  (sh-indent-after-if '+)
  (sh-indent-for-case-label 0)
  (sh-indent-for-case-alt '+))
</pre>
</div>
</div>
</li>

<li><a id="orgfe60998"></a>emacs lisp<br />
<div class="outline-text-6" id="text-orgfe60998">
<p>
I'm in the trial of pp-eval-last-sexp instead of eval-last-sexp adviced from <a href="https://karthinks.com/software/an-elisp-editing-tip/">this blog post</a>
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package elisp-mode
  <span style="font-weight: bold;">:commands</span> emacs-lisp-mode
  <span style="font-weight: bold;">:delight</span>
  (emacs-lisp-mode <span style="font-style: italic;">" EL"</span>)
  (lisp-interaction-mode <span style="font-style: italic;">" LispInt"</span>)
  <span style="font-weight: bold;">:hook</span> (emacs-lisp-mode . (<span style="font-weight: bold;">lambda</span> ()
                             (<span style="font-weight: bold;">setq-local</span> tab-width 4)
                             (<span style="font-weight: bold;">setq-local</span> counsel-dash-docsets '(<span style="font-style: italic;">"Emacs Lisp"</span> <span style="font-style: italic;">"Common Lisp"</span>))
                             (eldoc-mode 1)))
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">eldoc</span>)
  (substitute-key-definition 'eval-last-sexp
                             'pp-eval-last-sexp
                             global-map))
</pre>
</div>
</div>
</li>

<li><a id="org274f2eb"></a>scheme<br />
<div class="outline-text-6" id="text-org274f2eb">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"mit-scheme"</span>
</pre>
</div>
</div>
</li>

<li><a id="orgaf3d5e5"></a>cc-mode<br />
<div class="outline-text-6" id="text-orgaf3d5e5">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package cc-mode
  <span style="font-weight: bold;">:hook</span> (c-mode-common . (<span style="font-weight: bold;">lambda</span> ()
                           (<span style="font-weight: bold;">setq-local</span> counsel-dash-docsets '(<span style="font-style: italic;">"C"</span>))))
  <span style="font-weight: bold;">:custom</span>
  (c-tab-always-indent t)
  (c-auto-align-backslashes nil)
  (c-echo-syntactic-information-p t)
  (c-default-style <span style="font-style: italic;">"my/c-style"</span>)
  <span style="font-weight: bold;">:config</span>
  (c-toggle-auto-newline 1)
  (c-add-style <span style="font-style: italic;">"my/c-style"</span>
               '((c-basic-offset . 4)
                 (c-comment-only-line-offset . 0)
                 (c-hanging-braces-alist
                  . ((brace-if-brace before after)
                     (substatement-open before after)))
                 (c-hanging-colons-alist
                  . ((case-label after)))
                 (c-cleanup-list
                  . (brace-else-brace
                     brace-elseif-brace
                     empty-defun-braces
                     defun-close-semi
                     list-close-comma
                     scope-operator))
                 (c-offsets-alist
                  . ((arglist-intro . +)
                     (arglist-cont-nonempty . c-lineup-arglist)))))
  (c-add-style <span style="font-style: italic;">"my/objc-style"</span>
               '((c-basic-offset . 2)
                 (c-comment-only-line-offset . 0)
                 (c-hanging-braces-alist
                  . ((brace-if-brace before after)
                     (substatement-open before after)))
                 (c-hanging-colons-alist
                  . ((case-label after)))
                 (c-cleanup-list
                  . (brace-else-brace
                     brace-elseif-brace
                     empty-defun-braces
                     defun-close-semi
                     list-close-comma
                     scope-operator))
                 (c-offsets-alist
                  . ((arglist-intro . +)
                     (arglist-cont-nonempty . c-lineup-arglist))))))
</pre>
</div>
</div>
</li>

<li><a id="orga36358c"></a>python-mode<br />
<div class="outline-text-6" id="text-orga36358c">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package python
  <span style="font-weight: bold;">:mode</span> <span style="font-style: italic;">"\\.py\\'"</span>
  <span style="font-weight: bold;">:interpreter</span> <span style="font-style: italic;">"python"</span>
  <span style="font-weight: bold;">:delight</span> <span style="font-style: italic;">" PY"</span>
  <span style="font-weight: bold;">:hook</span>
  ((python-mode inferior-python-mode) . my-python-mode-hook)
  (lsp-mode . (<span style="font-weight: bold;">lambda</span> ()
                (add-to-list 'lsp-disabled-clients 'jedi)
                (add-to-list 'lsp-enabled-clients 'pyls))))

(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">python-mode-initialized</span> nil)

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-python-mode-hook</span> ()
  (<span style="font-weight: bold;">setq-local</span> flycheck-checker 'python-pylint)
  (jedi:setup)
  (jedi-mode 1)
  (<span style="font-weight: bold;">setq-local</span> counsel-dash-docsets
              '(<span style="font-style: italic;">"Python 3"</span> <span style="font-style: italic;">"Pandas"</span> <span style="font-style: italic;">"NumPy"</span> <span style="font-style: italic;">"Matplotlib"</span> <span style="font-style: italic;">"Scrapy"</span> <span style="font-style: italic;">"PEPs"</span> <span style="font-style: italic;">"lxml"</span>))
  (<span style="font-weight: bold;">unless</span> python-mode-initialized
    (<span style="font-weight: bold;">setq</span> python-mode-initialized t)
    (info-lookup-add-help
     <span style="font-weight: bold;">:mode</span> 'python-mode
     <span style="font-weight: bold;">:regexp</span> <span style="font-style: italic;">"[a-zA-Z_0-9.]+"</span>
     <span style="font-weight: bold;">:doc-spec</span>
     '((<span style="font-style: italic;">"(python)Python Module Index"</span> )
       (<span style="font-style: italic;">"(python)Index"</span>
        (<span style="font-weight: bold;">lambda</span>
          (item)
          (<span style="font-weight: bold;">cond</span>
           ((string-match
             <span style="font-style: italic;">"</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">[A-Za-z0-9_]+</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">() (in module </span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">[A-Za-z0-9_.]+</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">)"</span> item)
            (format <span style="font-style: italic;">"%s.%s"</span> (match-string 2 item)
                    (match-string 1 item))))))))))
</pre>
</div>
</div>

<ul class="org-ul">
<li><a id="orga9f7e2f"></a>emacs-project<br />
<div class="outline-text-7" id="text-orga9f7e2f">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-company-jedi"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package company-jedi
  <span style="font-weight: bold;">:after</span> python
  <span style="font-weight: bold;">:hook</span> (python-mode . my/python-mode-hook)
  <span style="font-weight: bold;">:custom</span>
  (jedi:tooltip-method nil)
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/python-mode-hook</span> ()
    (add-to-list 'company-backends 'company-jedi)))
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="org7003b2f"></a>ruby-mode<br />
<div class="outline-text-6" id="text-org7003b2f">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package ruby-mode
  <span style="font-weight: bold;">:delight</span> <span style="font-style: italic;">" RB"</span>
  <span style="font-weight: bold;">:mode</span> ((<span style="font-style: italic;">"\\.rb$"</span>   . ruby-mode)
         (<span style="font-style: italic;">"Capfile$"</span> . ruby-mode)
         (<span style="font-style: italic;">"Gemfile$"</span> . ruby-mode))
  <span style="font-weight: bold;">:interpreter</span> ((<span style="font-style: italic;">"ruby"</span>    . ruby-mode)
                (<span style="font-style: italic;">"rbx"</span>     . ruby-mode)
                (<span style="font-style: italic;">"jruby"</span>   . ruby-mode))
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">setq</span> ruby-indent-level 2)
  (<span style="font-weight: bold;">setq</span> ruby-insert-encoding-magic-comment nil)
  (add-hook 'ruby-mode-hook
            '(lambda ()
               (<span style="font-weight: bold;">setq-local</span> flycheck-checker 'ruby-rubocop)
               (<span style="font-weight: bold;">setq-local</span> counsel-dash-docsets '(<span style="font-style: italic;">"Ruby"</span>))))
  (add-to-list 'hs-special-modes-alist
               `(ruby-mode
                 ,(<span style="font-weight: bold;">rx</span> (<span style="font-weight: bold;">or</span> <span style="font-style: italic;">"def"</span> <span style="font-style: italic;">"class"</span> <span style="font-style: italic;">"module"</span> <span style="font-style: italic;">"do"</span> <span style="font-style: italic;">"if"</span> <span style="font-style: italic;">"{"</span> <span style="font-style: italic;">"["</span>)) <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">Block start</span>
                 ,(<span style="font-weight: bold;">rx</span> (<span style="font-weight: bold;">or</span> <span style="font-style: italic;">"}"</span> <span style="font-style: italic;">"]"</span> <span style="font-style: italic;">"end"</span>))                       <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">Block end</span>
                 ,(<span style="font-weight: bold;">rx</span> (<span style="font-weight: bold;">or</span> <span style="font-style: italic;">"#"</span> <span style="font-style: italic;">"=begin"</span>))                        <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">Comment start</span>
                 ruby-forward-sexp nil)))
</pre>
</div>
</div>
</li>

<li><a id="org9b8d2c0"></a>inf-ruby<br />
<div class="outline-text-6" id="text-org9b8d2c0">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-inf-ruby"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package inf-ruby
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">setq</span> inf-ruby-default-implementation <span style="font-style: italic;">"pry"</span>)
  (add-to-list 'inf-ruby-implementations '(<span style="font-style: italic;">"pry"</span> . <span style="font-style: italic;">"pry"</span>))
  (<span style="font-weight: bold;">setq</span> inf-ruby-eval-binding <span style="font-style: italic;">"Pry.toplevel_binding"</span>)
  (<span style="font-weight: bold;">setq</span> inf-ruby-first-prompt-pattern <span style="font-style: italic;">"^\\[[0-9]+\\] pry</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">(.*)</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">&gt; *"</span>)
  (<span style="font-weight: bold;">setq</span> inf-ruby-prompt-pattern <span style="font-style: italic;">"^\\[[0-9]+\\] pry</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">(.*)</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">[&gt;*\"'] *"</span>))
</pre>
</div>
</div>
</li>

<li><a id="org0b5e086"></a>yaml-mode<br />
<div class="outline-text-6" id="text-org0b5e086">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-yaml-mode"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package yaml-mode)
</pre>
</div>
</div>
</li>

<li><a id="orgb4487da"></a>lua-mode<br />
<div class="outline-text-6" id="text-orgb4487da">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-lua-mode"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package lua-mode)
</pre>
</div>
</div>
</li>

<li><a id="orgd08dba2"></a>perl-mode<br />
<div class="outline-text-6" id="text-orgd08dba2">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package perl-mode
  <span style="font-weight: bold;">:delight</span> <span style="font-style: italic;">" PL"</span>)
</pre>
</div>
</div>
</li>

<li><a id="orgd4beadf"></a>tex-mode<br />
<div class="outline-text-6" id="text-orgd4beadf">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package tex-mode
  <span style="font-weight: bold;">:mode</span> (<span style="font-style: italic;">"\\.tex$"</span> . latex-mode)
  <span style="font-weight: bold;">:hook</span> ((latex-mode . (<span style="font-weight: bold;">lambda</span> ()
                         (<span style="font-weight: bold;">setq-local</span> counsel-dash-docsets '(<span style="font-style: italic;">"LaTeX"</span>))))
         (tex-mode . (<span style="font-weight: bold;">lambda</span> () (<span style="font-weight: bold;">setq</span> ispell-parser 'tex)))))
</pre>
</div>
</div>
</li>

<li><a id="orgce2fc0c"></a>web-mode<br />
<div class="outline-text-6" id="text-orgce2fc0c">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-web-mode"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package web-mode
  <span style="font-weight: bold;">:delight</span> <span style="font-style: italic;">" WB"</span>
  <span style="font-weight: bold;">:mode</span> ((<span style="font-style: italic;">"\\.phtml$"</span>     . web-mode)
         (<span style="font-style: italic;">"\\.tpl\\.php$"</span> . web-mode)
         (<span style="font-style: italic;">"\\.jsp$"</span>       . web-mode)
         (<span style="font-style: italic;">"\\.as[cp]x$"</span>   . web-mode)
         (<span style="font-style: italic;">"\\.erb$"</span>       . web-mode)
         (<span style="font-style: italic;">"\\.html?$"</span>     . web-mode))
  <span style="font-weight: bold;">:hook</span> (web-mode . (<span style="font-weight: bold;">lambda</span> ()
                      (<span style="font-weight: bold;">setq-local</span> counsel-dash-docsets '(<span style="font-style: italic;">"HTML"</span> <span style="font-style: italic;">"HTTP"</span>))))
  <span style="font-weight: bold;">:custom</span>
  (web-mode-attr-indent-offset        2)
  (web-mode-attr-value-indent-offset  2)
  (web-mode-code-indent-offset        2)
  (web-mode-css-offset                2)
  (web-mode-markup-indent-offset      2)
  (web-mode-sql-indent-offset         2)
  (web-mode-block-padding             2)
  (web-mode-script-padding            2))
</pre>
</div>
</div>
</li>

<li><a id="orge4c9fb5"></a>css-mode<br />
<div class="outline-text-6" id="text-orge4c9fb5">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package css-mode
  <span style="font-weight: bold;">:hook</span> (css-mode . (<span style="font-weight: bold;">lambda</span> ()
                      (<span style="font-weight: bold;">setq-local</span> counsel-dash-docsets '(<span style="font-style: italic;">"CSS"</span>))))
  <span style="font-weight: bold;">:custom</span>
  (css-indent-offset 2))
</pre>
</div>
</div>
</li>

<li><a id="orga12609d"></a>js2-mode<br />
<div class="outline-text-6" id="text-orga12609d">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-js2-mode"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package js2-mode
  <span style="font-weight: bold;">:delight</span> <span style="font-style: italic;">" J2"</span>
  <span style="font-weight: bold;">:mode</span> ((<span style="font-style: italic;">"\\.js</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">on</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">?\\'"</span> . js2-mode)
         (<span style="font-style: italic;">"\\.eslintrc\\'"</span>    . js2-mode))
  <span style="font-weight: bold;">:hook</span> (js2-mode . (<span style="font-weight: bold;">lambda</span> ()
                      (<span style="font-weight: bold;">setq-local</span> flycheck-checker 'javascript-eslint)
                      (<span style="font-weight: bold;">setq-local</span> flycheck-disabled-checkers '(javascript-jshint javascript-jscs))
                      (<span style="font-weight: bold;">setq-local</span> counsel-dash-docsets '(<span style="font-style: italic;">"JavaScript"</span> <span style="font-style: italic;">"HTTP"</span> <span style="font-style: italic;">"NodeJS"</span>))))
  <span style="font-weight: bold;">:custom</span>
  (flycheck-javascript-eslint-executable <span style="font-style: italic;">"eslint"</span>))

(use-package js
  <span style="font-weight: bold;">:delight</span> <span style="font-style: italic;">" JS"</span>
  <span style="font-weight: bold;">:custom</span>
  (js-indent-level 2))
</pre>
</div>
</div>
</li>

<li><a id="org80abffe"></a>text-mode<br />
<div class="outline-text-6" id="text-org80abffe">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package text-mode
  <span style="font-weight: bold;">:mode</span> (<span style="font-style: italic;">"\\.txt$"</span> . text-mode)
  <span style="font-weight: bold;">:delight</span> <span style="font-style: italic;">" TX"</span>)
</pre>
</div>
</div>
</li>
<li><a id="org7c07dec"></a>nxml<br />
<div class="outline-text-6" id="text-org7c07dec">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package nxml-mode
  <span style="font-weight: bold;">:delight</span> (nxml-mode <span style="font-style: italic;">" XM"</span>)
  <span style="font-weight: bold;">:mode</span> ((<span style="font-style: italic;">"</span><span style="font-weight: bold; font-style: italic;">\</span><span style="font-style: italic;">.xml$"</span>   . nxml-mode)
         (<span style="font-style: italic;">"</span><span style="font-weight: bold; font-style: italic;">\</span><span style="font-style: italic;">.xsl$"</span>   . nxml-mode)
         (<span style="font-style: italic;">"</span><span style="font-weight: bold; font-style: italic;">\</span><span style="font-style: italic;">.xhtml$"</span> . nxml-mode)
         (<span style="font-style: italic;">"</span><span style="font-weight: bold; font-style: italic;">\</span><span style="font-style: italic;">.page$"</span>  . nxml-mode)
         (<span style="font-style: italic;">"</span><span style="font-weight: bold; font-style: italic;">\</span><span style="font-style: italic;">.plist$"</span> . nxml-mode))
  <span style="font-weight: bold;">:hook</span> (nxml-mode . my/prog-mode-hook-function)
  <span style="font-weight: bold;">:custom</span>
  (nxml-child-indent 2)
  (nxml-attribute-indent 2)
  (nxml-slash-auto-complete-flag t)
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">setq-local</span> tab-width 2)
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">pattern in hideshow mode for nxml mode</span>
  (add-to-list 'hs-special-modes-alist
               (list 'nxml-mode
                     <span style="font-style: italic;">"&lt;!--</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">|</span><span style="font-style: italic;">&lt;[</span><span style="font-style: italic;">^</span><span style="font-style: italic;">/&gt;]*[</span><span style="font-style: italic;">^</span><span style="font-style: italic;">/]&gt;"</span>
                     <span style="font-style: italic;">"--&gt;</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">|</span><span style="font-style: italic;">&lt;/[</span><span style="font-style: italic;">^</span><span style="font-style: italic;">/&gt;]*[</span><span style="font-style: italic;">^</span><span style="font-style: italic;">/]&gt;"</span>
                     <span style="font-style: italic;">"&lt;!--"</span>
                     'nxml-forward-element
                     nil)))
</pre>
</div>
</div>
</li>

<li><a id="orgdc1e865"></a>sql-mode<br />
<div class="outline-text-6" id="text-orgdc1e865">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package sql
  <span style="font-weight: bold;">:delight</span> <span style="font-style: italic;">" SQ"</span>
  <span style="font-weight: bold;">:commands</span> (sql-mode)
  <span style="font-weight: bold;">:mode</span> ((<span style="font-style: italic;">"\\.sql$"</span> . sql-mode))
  <span style="font-weight: bold;">:bind</span> (<span style="font-weight: bold;">:map</span> sql-interactive-mode-map
              (<span style="font-style: italic;">"C-j"</span> . comint-send-input))
  <span style="font-weight: bold;">:hook</span> (sql-mode . (<span style="font-weight: bold;">lambda</span> ()
                      (<span style="font-weight: bold;">setq-local</span> flycheck-checker 'sql-sqlint)
                      (<span style="font-weight: bold;">setq-local</span> counsel-dash-docsets '(<span style="font-style: italic;">"MySQL"</span>)))))
</pre>
</div>
</div>
</li>

<li><a id="orgb896eea"></a>project<br />
<div class="outline-text-6" id="text-orgb896eea">
<p>
Use hosting version of project.el on GitHub via straight until Emacs 28 which ships with latest version of project.el is released.
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-project"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package project)
</pre>
</div>
</div>
</li>

<li><a id="org9911257"></a>grep<br />
<div class="outline-text-6" id="text-org9911257">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package grep
  <span style="font-weight: bold;">:custom</span>
  (grep-program <span style="font-style: italic;">"rg"</span>)
  <span style="font-weight: bold;">:config</span>
  (bind-keys <span style="font-weight: bold;">:map</span> grep-mode-map
             (<span style="font-style: italic;">"C-j"</span> . compile-goto-error)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/grep-ripgrep-all</span> ()
  <span style="font-style: italic;">"Grep many kind of files like pdf, epub and more."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">let</span> ((grep-find-command '(<span style="font-style: italic;">"rga --with-filename --no-heading --line-number --color never -e ''"</span> . 66)))
    (call-interactively 'grep-find)))

(global-set-key (kbd <span style="font-style: italic;">"M-s A"</span>) 'my/grep-ripgrep-all)
</pre>
</div>
</div>
</li>

<li><a id="org195746e"></a>compile<br />
<div class="outline-text-6" id="text-org195746e">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package compile
  <span style="font-weight: bold;">:bind</span> (<span style="font-weight: bold;">:map</span> compilation-mode-map
              (<span style="font-style: italic;">"C-j"</span> . compile-goto-error)))
</pre>
</div>
</div>
</li>

<li><a id="org26cf6c1"></a>log-view<br />
<div class="outline-text-6" id="text-org26cf6c1">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package log-view
  <span style="font-weight: bold;">:delight</span>
  (log-view-mode <span style="font-style: italic;">" LV"</span>)
  <span style="font-weight: bold;">:mode</span> (<span style="font-style: italic;">"\\.log$"</span> . log-view-mode)
  <span style="font-weight: bold;">:hook</span> ((log-view-mode . my/prog-mode-hook-function )
         (log-view-mode . auto-revert-tail-mode)))
</pre>
</div>
</div>
</li>

<li><a id="org815d9c7"></a>plantuml-mode<br />
<div class="outline-text-6" id="text-org815d9c7">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-plantuml-mode"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package plantuml-mode
  <span style="font-weight: bold;">:delight</span> <span style="font-style: italic;">" UM"</span>
  <span style="font-weight: bold;">:hook</span>
  (plantuml-mode . (<span style="font-weight: bold;">lambda</span> ()
                     (<span style="font-weight: bold;">setq-local</span> counsel-dash-docsets '(<span style="font-style: italic;">"PlantUML"</span>))))
  <span style="font-weight: bold;">:custom</span>
  (plantuml-jar-path <span style="font-style: italic;">"/usr/share/plantuml/plantuml.jar"</span>))
</pre>
</div>
</div>
</li>

<li><a id="orgaf744b8"></a>conf<br />
<div class="outline-text-6" id="text-orgaf744b8">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package conf-mode
  <span style="font-weight: bold;">:delight</span> <span style="font-style: italic;">" CF"</span>)
</pre>
</div>
</div>
</li>

<li><a id="org0995348"></a>generic-x<br />
<div class="outline-text-6" id="text-org0995348">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package generic-x
  <span style="font-weight: bold;">:mode</span> ((<span style="font-style: italic;">"\\.conf$"</span>     . apache-conf-generic-mode)
         (<span style="font-style: italic;">"\\.htaccess$"</span> . apache-conf-generic-mode)))
</pre>
</div>
</div>
</li>

<li><a id="org5d9616c"></a>fundamental mode<br />
<div class="outline-text-6" id="text-org5d9616c">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package emacs
  <span style="font-weight: bold;">:delight</span> (fundamental-mode <span style="font-style: italic;">" FU"</span>))
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="org474156e"></a>other third-party packages<br />
<div class="outline-text-5" id="text-org474156e">
</div>

<ul class="org-ul">
<li><a id="org2f4435a"></a>Magit<br />
<div class="outline-text-6" id="text-org2f4435a">
<p>
<a href="https://github.com/magit/magit">Magit</a> is git front end for emacs which is outstandingly powerful.
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-magit"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-style: italic;">"https://github.com/magit/magit/releases.atom"</span> soft_update)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package magit
  <span style="font-weight: bold;">:delight</span>
  (magit-status-mode <span style="font-style: italic;">" MG"</span>)
  (magit-revision-mode <span style="font-style: italic;">" MG"</span>)
  <span style="font-weight: bold;">:bind</span> (<span style="font-weight: bold;">:map</span> magit-status-mode-map
              (<span style="font-style: italic;">"C-j"</span> . magit-visit-thing)
              (<span style="font-style: italic;">"/"</span>   . magit-file-checkout)
              (<span style="font-style: italic;">";"</span>   . magit-list-repositories)
              <span style="font-weight: bold;">:map</span> magit-log-mode-map
              (<span style="font-style: italic;">"C-j"</span> . magit-visit-thing)
              <span style="font-weight: bold;">:map</span> magit-repolist-mode-map
              (<span style="font-style: italic;">"C-j"</span> . magit-repolist-status))
  <span style="font-weight: bold;">:custom</span>
  (magit-repository-directories '((<span style="font-style: italic;">"~/git"</span> . 1))))
</pre>
</div>
</div>

<ul class="org-ul">
<li><a id="org0da6a6c"></a>git-modes<br />
<div class="outline-text-7" id="text-org0da6a6c">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-git-modes"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package git-modes)
</pre>
</div>
</div>
</li>

<li><a id="org9ae6907"></a>orgit<br />
<div class="outline-text-7" id="text-org9ae6907">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-orgit"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package orgit
  <span style="font-weight: bold;">:after</span> (magit org)
  <span style="font-weight: bold;">:custom</span>
  (orgit-remote <span style="font-style: italic;">"github"</span>))
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="org8eb2cd3"></a>projectile&#xa0;&#xa0;&#xa0;<span class="tag"><span class="maintaining">maintaining</span>&#xa0;<span class="ARCHIVE">ARCHIVE</span>&#xa0;<span class="ignore">ignore</span></span><br /></li>

<li><a id="orgee53006"></a>counsel-projectile&#xa0;&#xa0;&#xa0;<span class="tag"><span class="maintaining">maintaining</span>&#xa0;<span class="ARCHIVE">ARCHIVE</span>&#xa0;<span class="ignore">ignore</span></span><br /></li>
<li><a id="org0d8b6af"></a>ag.el&#xa0;&#xa0;&#xa0;<span class="tag"><span class="programs">programs</span>&#xa0;<span class="ARCHIVE">ARCHIVE</span>&#xa0;<span class="ignore">ignore</span></span><br /></li>

<li><a id="org53721a7"></a>ripgrep.el&#xa0;&#xa0;&#xa0;<span class="tag"><span class="programs">programs</span>&#xa0;<span class="ARCHIVE">ARCHIVE</span>&#xa0;<span class="ignore">ignore</span></span><br /></li>

<li><a id="org770746a"></a>wgrep<br />
<div class="outline-text-6" id="text-org770746a">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-wgrep"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package wgrep)
</pre>
</div>
</div>
</li>

<li><a id="orgd8159a6"></a>dumb-jump<br />
<div class="outline-text-6" id="text-orgd8159a6">
<p>
<a href="https://github.com/jacktasia/dumb-jump">dumb-jump</a> is "jump to definition" package without tagging.
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-dumb-jump"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package dumb-jump
  <span style="font-weight: bold;">:bind</span> ((<span style="font-style: italic;">"M-g o"</span> . dumb-jump-go-other-window)
         (<span style="font-style: italic;">"M-g j"</span> . dumb-jump-go)
         (<span style="font-style: italic;">"M-g x"</span> . dumb-jump-go-prefer-external)
         (<span style="font-style: italic;">"M-g z"</span> . dumb-jump-go-prefer-external-other-window)
         (<span style="font-style: italic;">"M-g /"</span> . dumb-jump-back)
         (<span style="font-style: italic;">"M-g l"</span> . dumb-jump-quick-look)))
</pre>
</div>
</div>
</li>

<li><a id="orga8a6531"></a>visual-regexp<br />
<div class="outline-text-6" id="text-orga8a6531">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-visual-regexp"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package visual-regexp
  <span style="font-weight: bold;">:bind</span> (<span style="font-style: italic;">"C-%"</span> . vr/query-replace))
</pre>
</div>
</div>

<ul class="org-ul">
<li><a id="org99a3906"></a>visual-regexp-steroids<br />
<div class="outline-text-7" id="text-org99a3906">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-style: italic;">"https://github.com/benma/visual-regexp-steroids.el/releases.atom"</span> soft_update)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package visual-regexp-steroids
  <span style="font-weight: bold;">:straight</span> t
  <span style="font-weight: bold;">:after</span> (visual-regexp)
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">setq</span> vr/engine 'python))
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="orgd801d26"></a>avy<br />
<div class="outline-text-6" id="text-orgd801d26">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-avy"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package avy
  <span style="font-weight: bold;">:bind</span> ((<span style="font-style: italic;">"C-c a"</span> . avy-goto-char-timer)
         <span style="font-weight: bold;">:map</span> isearch-mode-map
         (<span style="font-style: italic;">"C-a"</span> . avy-isearch)))
</pre>
</div>
</div>
</li>

<li><a id="orgfc13c3d"></a>paredit<br />
<div class="outline-text-6" id="text-orgfc13c3d">
<p>
Handy commands
</p>
<ul class="org-ul">
<li>press '(' to insert '()' pair</li>
<li>C-&lt;left/right&gt; to barf and slurp s-expressions</li>
<li>call paredit-splice-sexp to strip embracing parenthes</li>
<li>press M-&lt;up&gt; or M-r to delete upper sexp except pointing one</li>
<li>DEL, C-d, C-k act like originals but care for parenthes</li>
<li>press DEL to remedy unbalanced parenthes</li>
<li>press C-q ( to insert ( char manually</li>
</ul>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-paredit"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package paredit
  <span style="font-weight: bold;">:bind</span> (<span style="font-weight: bold;">:map</span> paredit-mode-map
              (<span style="font-style: italic;">"C-h"</span> . paredit-backward-delete)
              (<span style="font-style: italic;">"C-M-g"</span> .  paredit-splice-sexp)
              (<span style="font-style: italic;">"M-s"</span> . nil)
              (<span style="font-style: italic;">"C-M-;"</span> . paredit-comment-dwim)
              (<span style="font-style: italic;">"M-;"</span> . nil))
  <span style="font-weight: bold;">:hook</span> ((emacs-lisp-mode . enable-paredit-mode)
         (paredit-mode . show-paren-mode)))
</pre>
</div>

<ul class="org-ul">
<li><p>
bug fix
Thanks to <a href="https://andreyorst.gitlab.io/posts/2021-09-30-why-is-paredit-is-so-un-emacsy/">this blog post</a>, a couple of commands in paredit.el are fixed with transient-mark-mode
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my/paredit-delete-region-functions</span>
  '(paredit-forward-delete
    paredit-backward-delete)
  <span style="font-style: italic;">"List of `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">paredit-mode</span><span style="font-style: italic;">' functions that should support tmm region deletion."</span>)

(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my/paredit-kill-region-functions</span>
  '(paredit-forward-kill-word
    paredit-backward-kill-word)
  <span style="font-style: italic;">"List of `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">paredit-mode</span><span style="font-style: italic;">' functions that should support tmm region killing."</span>)

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/paredit-fix-transient-mark-mode</span> (orig-fn <span style="font-weight: bold; text-decoration: underline;">&amp;rest</span> args)
  <span style="font-style: italic;">"Allow deleting/killing a region if expression is balanced."</span>
  (<span style="font-weight: bold;">if</span> (<span style="font-weight: bold;">and</span> transient-mark-mode
           mark-active)
      (<span style="font-weight: bold;">cond</span> ((memq this-command my/paredit-delete-region-functions)
             (paredit-delete-region (region-beginning) (region-end)))
            ((memq this-command my/paredit-kill-region-functions)
             (paredit-kill-region (region-beginning) (region-end)))
            (t (apply orig-fn args)))
    (apply orig-fn args)))

(<span style="font-weight: bold;">dolist</span> (fun (append my/paredit-delete-region-functions
                     my/paredit-kill-region-functions))
  (advice-add fun <span style="font-weight: bold;">:around</span> #'my/paredit-fix-transient-mark-mode))
</pre>
</div></li>
</ul>
</div>
</li>

<li><a id="org3c917e4"></a>lsp-mode<br />
<div class="outline-text-6" id="text-org3c917e4">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-lsp-mode"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package lsp-mode
  <span style="font-weight: bold;">:commands</span> (lsp lsp-deferred)
  <span style="font-weight: bold;">:hook</span> ((python-mode) . lsp-deferred))
</pre>
</div>
</div>

<ul class="org-ul">
<li><a id="orgfae57d1"></a>lsp-ivy&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span>&#xa0;<span class="ignore">ignore</span></span><br /></li>
</ul>
</li>

<li><a id="org954bf7b"></a>company-mode<br />
<div class="outline-text-6" id="text-org954bf7b">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-company"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package company
  <span style="font-weight: bold;">:hook</span> (prog-mode . company-mode)
  <span style="font-weight: bold;">:bind</span> (<span style="font-weight: bold;">:map</span> company-active-map
              (<span style="font-style: italic;">"C-j"</span> . company-complete-selection)
              (<span style="font-style: italic;">"C-h"</span> . backward-delete-char-untabify)
              (<span style="font-style: italic;">"C-M-h"</span> . company-show-doc-buffer)
              (<span style="font-style: italic;">"C-n"</span> . company-select-next)
              (<span style="font-style: italic;">"C-p"</span> . company-select-previous)))
</pre>
</div>
</div>
</li>

<li><a id="orgb35a42b"></a>flycheck<br />
<div class="outline-text-6" id="text-orgb35a42b">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-flycheck"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package flycheck
  <span style="font-weight: bold;">:diminish</span>
  <span style="font-weight: bold;">:hook</span> ((c-mode sh-mode emacs-lisp-mode ruby-mode python-mode js2-mode sql-mode) . flycheck-mode)
  <span style="font-weight: bold;">:custom</span>
  (flycheck-check-syntax-automatically
   '(save new-line idle-change))
  (flycheck-display-errors-delay 10.0)
  (flycheck-checker-error-threshold 1000)
  <span style="font-weight: bold;">:config</span>
  (add-to-list 'display-buffer-alist
               `(,flycheck-error-message-buffer
                 . (display-buffer-reuse-window
                    display-buffer-in-previous-window
                    display-buffer-pop-up-window
                    . ((window-height . 5)))))
  (<span style="font-weight: bold;">with-eval-after-load</span> 'hydra
    (defhydra hydra-flycheck (flycheck-mode-map <span style="font-style: italic;">"C-c !"</span>
                                                <span style="font-weight: bold;">:color</span> red)
      <span style="font-style: italic;">"Flycheck"</span>
      (<span style="font-style: italic;">"C-c"</span> flycheck-compile)
      (<span style="font-style: italic;">"C-w"</span> flycheck-copy-errors-as-kill)
      (<span style="font-style: italic;">"?"</span> flycheck-describe-checker)
      (<span style="font-style: italic;">"C"</span> flycheck-clear)
      (<span style="font-style: italic;">"H"</span> display-local-help)
      (<span style="font-style: italic;">"V"</span> flycheck-version)
      (<span style="font-style: italic;">"c"</span> flycheck-buffer)
      (<span style="font-style: italic;">"e"</span> flycheck-explain-error-at-point)
      (<span style="font-style: italic;">"d"</span> flycheck-display-error-at-point)
      (<span style="font-style: italic;">"i"</span> flycheck-manual)
      (<span style="font-style: italic;">"l"</span> flycheck-list-errors)
      (<span style="font-style: italic;">"n"</span> flycheck-next-error)
      (<span style="font-style: italic;">"p"</span> flycheck-previous-error)
      (<span style="font-style: italic;">"s"</span> flycheck-select-checker)
      (<span style="font-style: italic;">"v"</span> flycheck-verify-setup)
      (<span style="font-style: italic;">"x"</span> flycheck-disable-checker)
      (<span style="font-style: italic;">"q"</span> nil <span style="font-style: italic;">"quit"</span>))))
</pre>
</div>
</div>
</li>

<li><a id="org1924e30"></a>twittering-mode<br />
<div class="outline-text-6" id="text-org1924e30">
<p>
useful tips:
</p>
<ul class="org-ul">
<li>invoke twittering-toggle-show-replied-statuses on "in reply to" state to show replied messages</li>
<li>invoke twittering-view-user-page (C-c C-v) on user name to jump to user profile page in default browser</li>
</ul>

<p>
Disclaimers: An unexpected incident might occur if twittering-icon-mode call lay at :config section of use-package
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-style: italic;">"https://github.com/hayamiz/twittering-mode/releases.atom"</span> soft_update)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my/twittering-resource-dir</span> <span style="font-style: italic;">"~/share/emacs/twmode"</span>)

(use-package twittering-mode
  <span style="font-weight: bold;">:straight</span> (twittering-mode
             <span style="font-weight: bold;">:host</span> github
             <span style="font-weight: bold;">:repo</span> <span style="font-style: italic;">"hayamiz/twittering-mode"</span>
             <span style="font-weight: bold;">:fork</span> (<span style="font-weight: bold;">:host</span> github
                          <span style="font-weight: bold;">:repo</span> <span style="font-style: italic;">"p-snow/twittering-mode"</span>))
  <span style="font-weight: bold;">:delight</span> <span style="font-style: italic;">" TW"</span>
  <span style="font-weight: bold;">:after</span> hydra
  <span style="font-weight: bold;">:commands</span> twit
  <span style="font-weight: bold;">:hook</span>
  (twittering-mode . twittering-icon-mode)
  <span style="font-weight: bold;">:custom</span>
  (twittering-private-info-file
   (expand-file-name <span style="font-style: italic;">"twittering-mode.gpg"</span> my/twittering-resource-dir))
  (twittering-user-id-db-file
   (expand-file-name <span style="font-style: italic;">"user-info.gz"</span> my/twittering-resource-dir))
  (twittering-use-master-password t)
  (twittering-use-ssl t)
  (twittering-number-of-tweets-on-retrieval 50)
  (twittering-use-icon-storage t)
  (twittering-icon-storage-file
   (expand-file-name <span style="font-style: italic;">"icons.gz"</span> my/twittering-resource-dir))
  (twittering-icon-storage-limit 2000)
  (twittering-convert-fix-size 24)
  (twittering-initial-timeline-spec-string '(<span style="font-style: italic;">":home"</span> <span style="font-style: italic;">":mentions"</span>))
  (twittering-edit-skeleton 'inherit-any)
  (twittering-display-remaining t)
  (twittering-timeline-header <span style="font-style: italic;">""</span>)
  (twittering-timeline-footer <span style="font-style: italic;">""</span>)
  (twittering-status-format
   (concat <span style="font-style: italic;">"%RT{%FACE[bold]{RT by %S\n}}"</span>
           <span style="font-style: italic;">"%i %S,"</span>
           <span style="font-style: italic;">"%FACE[font-lock-constant-face]{%FIELD-IF-NONZERO[ &#8634;%d]{retweet_count}}"</span>
           <span style="font-style: italic;">"%FACE[font-lock-warning-face]{%FIELD-IF-NONZERO[ &#9825;%d]{favorite_count}}"</span>
           <span style="font-style: italic;">" %@{}:\n"</span>
           <span style="font-style: italic;">"%T %r%QT{\n+----\n%i %S, %@{}:\n%T %r%R\n+----}\n "</span>))
  <span style="font-weight: bold;">:config</span>
  (bind-keys <span style="font-weight: bold;">:map</span> twittering-mode-map
             (<span style="font-style: italic;">"C-c C-l"</span> . nil)
             <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">move cursor</span>
             (<span style="font-style: italic;">"f"</span> . scroll-up-line)
             (<span style="font-style: italic;">"e"</span> . scroll-down-line)
             (<span style="font-style: italic;">"E"</span> . my/twittering-previous-status-and-top)
             (<span style="font-style: italic;">"SPC"</span> . my/twittering-next-status-and-top)
             (<span style="font-style: italic;">"&lt;"</span> . twittering-goto-first-status)
             (<span style="font-style: italic;">"&gt;"</span> . twittering-goto-last-status)
             (<span style="font-style: italic;">"TAB"</span> . twittering-goto-next-thing)
             (<span style="font-style: italic;">"&lt;backtab&gt;"</span> . twittering-goto-previous-thing)
             (<span style="font-style: italic;">"2"</span> . twittering-goto-previous-thing)
             (<span style="font-style: italic;">"3"</span> . twittering-goto-next-thing)
             (<span style="font-style: italic;">"4"</span> . my/twittering-open)
             <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">create/delete tweets(messages)</span>
             (<span style="font-style: italic;">"u"</span> . twittering-update-status-interactive)
             (<span style="font-style: italic;">"j"</span> . twittering-enter)
             (<span style="font-style: italic;">"J"</span> . twittering-reply-to-user)
             (<span style="font-style: italic;">"RET"</span> . twittering-enter)
             (<span style="font-style: italic;">"o"</span> . my/twittering-open)
             (<span style="font-style: italic;">"C-c C-o"</span> . my/twittering-open)
             (<span style="font-style: italic;">"d"</span> . twittering-direct-message)
             (<span style="font-style: italic;">"k"</span> . twittering-delete-status)
             (<span style="font-style: italic;">"y"</span> . twittering-push-uri-onto-kill-ring)
             (<span style="font-style: italic;">"Y"</span> . twittering-push-tweet-onto-kill-ring)
             <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">response to tweets</span>
             (<span style="font-style: italic;">"r"</span> . twittering-native-retweet)
             (<span style="font-style: italic;">"R"</span> . my/twittering-quote-retweet)
             (<span style="font-style: italic;">"b"</span> . twittering-favorite)
             (<span style="font-style: italic;">"B"</span> . twittering-unfavorite)
             (<span style="font-style: italic;">"l"</span> . twittering-follow)
             (<span style="font-style: italic;">"L"</span> . twittering-unfollow)
             (<span style="font-style: italic;">"t"</span> . twittering-toggle-show-replied-statuses)
             (<span style="font-style: italic;">"T"</span> . twittering-toggle-or-retrieve-replied-statuses)
             <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">switch between timelines</span>
             (<span style="font-style: italic;">"n"</span> . twittering-switch-to-next-timeline)
             (<span style="font-style: italic;">"p"</span> . twittering-switch-to-previous-timeline)
             (<span style="font-style: italic;">"."</span> . twittering-visit-timeline)
             (<span style="font-style: italic;">"@"</span> . twittering-other-user-timeline)
             (<span style="font-style: italic;">"/"</span> . my/twittering-search)
             (<span style="font-style: italic;">"?"</span> . twittering-search)
             (<span style="font-style: italic;">"c1"</span> . twittering-home-timeline)
             (<span style="font-style: italic;">"c2"</span> . (<span style="font-weight: bold;">lambda</span> ()
                       (<span style="font-weight: bold;">interactive</span>)
                       (twittering-visit-timeline <span style="font-style: italic;">":mentions"</span>)))
             (<span style="font-style: italic;">"c3"</span> . (<span style="font-weight: bold;">lambda</span> ()
                       (<span style="font-weight: bold;">interactive</span>)
                       (twittering-visit-timeline <span style="font-style: italic;">":retweets_of_me"</span>)))
             (<span style="font-style: italic;">"c4"</span> . (<span style="font-weight: bold;">lambda</span> ()
                       (<span style="font-weight: bold;">interactive</span>)
                       (twittering-search <span style="font-style: italic;">"from:_p_snow"</span>)))
             (<span style="font-style: italic;">"c5"</span> . (<span style="font-weight: bold;">lambda</span> ()
                       (<span style="font-weight: bold;">interactive</span>)
                       (twittering-visit-timeline <span style="font-style: italic;">":favorites"</span>)))
             (<span style="font-style: italic;">"c6"</span> . (<span style="font-weight: bold;">lambda</span> ()
                       (<span style="font-weight: bold;">interactive</span>)
                       (twittering-visit-timeline <span style="font-style: italic;">":direct_message_events"</span>)))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/twittering-next-status-and-top</span> ()
  <span style="font-style: italic;">"docstring"</span>
  (<span style="font-weight: bold;">interactive</span>)
  (twittering-goto-next-status)
  (recenter-top-bottom 0))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/twittering-previous-status-and-top</span> ()
  <span style="font-style: italic;">"docstring"</span>
  (<span style="font-weight: bold;">interactive</span>)
  (twittering-goto-previous-status)
  (recenter-top-bottom 0))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/twittering-quote-retweet</span> ()
  <span style="font-style: italic;">"docstring"</span>
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">let</span> ((orig-tweet-uri (twittering-push-uri-onto-kill-ring)))
    (twittering-update-status (format <span style="font-style: italic;">"\n%s"</span> orig-tweet-uri))
    (next-line -1 t)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/twittering-search</span> (<span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> arg)
  <span style="font-style: italic;">""</span>
  (<span style="font-weight: bold;">interactive</span> <span style="font-style: italic;">"P"</span>)
  (<span style="font-weight: bold;">let*</span> ((spec (get-text-property (point) 'goto-spec))
         (username (get-text-property (point) 'username))
         (word (<span style="font-weight: bold;">cond</span>
                ((use-region-p) (buffer-substring (region-beginning) (region-end)))
                ((stringp spec) spec)
                ((eq (car spec) 'user) (format <span style="font-style: italic;">"@%s"</span> (cadr spec)))
                ((stringp username) username))))
    (twittering-search (<span style="font-weight: bold;">and</span> (not arg) word))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/twittering-open</span> (<span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> arg)
  <span style="font-style: italic;">""</span>
  (<span style="font-weight: bold;">interactive</span> <span style="font-style: italic;">"P"</span>)
  (<span style="font-weight: bold;">unless</span> (my/enter-thing-at-point)
    (<span style="font-weight: bold;">let</span> ((uri (<span style="font-weight: bold;">or</span> (get-text-property (point) 'uri)
                   (<span style="font-weight: bold;">if</span> (get-text-property (point) 'field)
                       (<span style="font-weight: bold;">let*</span> ((id (get-text-property (point) 'id))
                              (status (twittering-find-status id)))
                         (twittering-get-status-url-from-alist status))
                     nil))))
      (<span style="font-weight: bold;">cl-case</span> (prefix-numeric-value arg)
        (16 (browse-url-default-browser uri))
        (4 (eww-browse-url uri))
        (t (open-url uri))))))
</pre>
</div>
</div>
</li>

<li><a id="org0727338"></a>comment-dwim-2<br />
<div class="outline-text-6" id="text-org0727338">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-style: italic;">"https://github.com/remyferre/comment-dwim-2/releases.atom"</span> soft_update)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package comment-dwim-2
  <span style="font-weight: bold;">:straight</span> t
  <span style="font-weight: bold;">:defer</span> 1
  <span style="font-weight: bold;">:bind</span> (<span style="font-style: italic;">"M-;"</span> . comment-dwim-2)
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">setf</span> comment-dwim-2--inline-comment-behavior 'reindent-comment
        cd2/region-command 'cd2/comment-or-uncomment-region))
</pre>
</div>
</div>
</li>

<li><a id="org23119da"></a>undo-tree<br />
<div class="outline-text-6" id="text-org23119da">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-undo-tree"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package undo-tree
  <span style="font-weight: bold;">:diminish</span> undo-tree-mode
  <span style="font-weight: bold;">:hook</span>
  ((text-mode org-mode prog-mode) . undo-tree-mode)
  <span style="font-weight: bold;">:custom</span>
  (undo-tree-enable-undo-in-region t)
  (undo-tree-auto-save-history t)
  <span style="font-weight: bold;">:config</span>
  (add-to-list 'undo-tree-history-directory-alist `(<span style="font-style: italic;">"."</span> . ,(expand-file-name <span style="font-style: italic;">"undo-tree"</span> user-emacs-directory)))
  (<span style="font-weight: bold;">setq</span> undo-tree-visualizer-buffer-name <span style="font-style: italic;">"*undo tree*"</span>)
  (add-to-list 'display-buffer-alist
               `(,undo-tree-visualizer-buffer-name . (display-buffer-in-side-window
                                                      . ((side . right)
                                                         (window-width . 15))))))
</pre>
</div>
</div>
</li>

<li><a id="orgf0f8f60"></a>quickrun&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span><br /></li>

<li><a id="org999fb7a"></a>expand-region<br />
<div class="outline-text-6" id="text-org999fb7a">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-expand-region"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package expand-region
  <span style="font-weight: bold;">:bind</span> ((<span style="font-style: italic;">"C-,"</span>   . er/expand-region)
         (<span style="font-style: italic;">"C-M-,"</span> . er/contract-region))
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">push</span> 'er/mark-outside-pairs er/try-expand-list))
</pre>
</div>
</div>
</li>

<li><a id="orgacb5b8c"></a>helpful<br />
<div class="outline-text-6" id="text-orgacb5b8c">
<p>
helpful-mode shows  than <a href="#org5f977a0">help-mode</a>.
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-helpful"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package helpful
  <span style="font-weight: bold;">:bind</span>
  (<span style="font-weight: bold;">:map</span> help-map
        (<span style="font-style: italic;">"f"</span> . helpful-callable)
        (<span style="font-style: italic;">"v"</span> . helpful-variable)
        (<span style="font-style: italic;">"k"</span> . helpful-key))
  (<span style="font-weight: bold;">:map</span> helpful-mode-map
        (<span style="font-style: italic;">"w"</span> . helpful-push-symbol-onto-kill-ring) )
  <span style="font-weight: bold;">:config</span>
  (bind-keys <span style="font-weight: bold;">:map</span> helpful-mode-map
             (<span style="font-style: italic;">"f"</span> . scroll-up-line)
             (<span style="font-style: italic;">"e"</span> . scroll-down-line)
             (<span style="font-style: italic;">"SPC"</span> . my/forward-paragraph)
             (<span style="font-style: italic;">"E"</span> . my/backward-paragraph)
             (<span style="font-style: italic;">"2"</span> . backward-button)
             (<span style="font-style: italic;">"3"</span> . forward-button)
             (<span style="font-style: italic;">"4"</span> . push-button)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">helpful-push-symbol-onto-kill-ring</span> ()
  <span style="font-style: italic;">"Push symbol name to kill ring."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">let</span> ((symbol (symbol-name helpful--sym)))
    (kill-new (symbol-name helpful--sym))
    (message <span style="font-style: italic;">"COPY: %s"</span> symbol)))
</pre>
</div>
</div>
</li>

<li><a id="org1b0d954"></a>define-word<br />
<div class="outline-text-6" id="text-org1b0d954">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-style: italic;">"https://github.com/abo-abo/define-word/releases.atom"</span> soft_update)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package define-word
  <span style="font-weight: bold;">:straight</span> t
  <span style="font-weight: bold;">:custom</span>
  (define-word-displayfn-alist
    '((wordnik . my/define-word--display-in-buffer)
      (openthesaurus . my/define-word--display-in-buffer)
      (webster . my/define-word--display-in-buffer)
      (weblio . my/define-word--display-in-buffer)))
  (define-word-default-service 'wordnik)
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">setf</span> (cdr (assoc 'wordnik define-word-services))
        '(<span style="font-style: italic;">"http://wordnik.com/words/%s"</span> my/define-word--parse-wordnik-all))
  (<span style="font-weight: bold;">push</span> '(weblio <span style="font-style: italic;">"https://ejje.weblio.jp/content/%s"</span>
                 my/define-word--parse-weblio)
        define-word-services)
  (<span style="font-weight: bold;">push</span> '(<span style="font-style: italic;">"&lt;b&gt;</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">.*?</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">&lt;/b&gt;"</span> bold)
        define-word--tag-faces)
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">fix issue #31 temporally</span>
  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/define-word--fix-31</span> (define-word-orig <span style="font-weight: bold; text-decoration: underline;">&amp;rest</span> args)
    <span style="font-style: italic;">"Fix `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">define-word</span><span style="font-style: italic;">' backends that require a user agent (like wordnik)."</span>
    (<span style="font-weight: bold;">let</span> ((url-request-extra-headers
           '((<span style="font-style: italic;">"User-Agent"</span> .
              <span style="font-style: italic;">"Mozilla/5.0 (Macintosh; Intel Mac OS X 11_5_2) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/93.0.4577.63 Safari/537.36"</span>))))
      (apply define-word-orig args)))
  (advice-add #'define-word <span style="font-weight: bold;">:around</span> #'my/define-word--fix-31))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/define-word</span> ()
  <span style="font-style: italic;">"docstring"</span>
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">if</span> (use-region-p)
      (call-interactively #'define-word-at-point)
    (call-interactively #'define-word)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/define-word--display-in-buffer</span> (definition)
  <span style="font-style: italic;">"docstring"</span>
  (<span style="font-weight: bold;">let*</span> ((buf-name <span style="font-style: italic;">"*DEFINE WORD*"</span>)
         (buffer (get-buffer-create buf-name))
         (display-buffer-alist
          `((,buf-name
             (display-buffer-same-window)))))
    (<span style="font-weight: bold;">with-current-buffer</span> buffer
      (read-only-mode -1)
      (erase-buffer)
      (insert definition)
      (goto-char (point-min))
      (<span style="font-weight: bold;">save-excursion</span> (xml-parse-string))
      (read-only-mode 1)
      (buffer-face-set 'my/medium-large-gothic-face))
    (display-buffer buffer)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/define-word--parse-wordnik-example</span> ()
  (<span style="font-weight: bold;">save-excursion</span>
    (<span style="font-weight: bold;">let</span> (beg
          results
          (define-word-limit 10))
      (re-search-forward <span style="font-style: italic;">"&lt;h2&gt;Examples"</span> nil t)
      (<span style="font-weight: bold;">save-excursion</span>
        (<span style="font-weight: bold;">setq</span> beg (re-search-forward <span style="font-style: italic;">"&lt;div class=\"relatedWords-module\"&gt;"</span> nil t)))
      (<span style="font-weight: bold;">while</span> (re-search-forward <span style="font-style: italic;">"&lt;p class=\"text\"&gt;</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">.*</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">&lt;/p&gt;"</span> beg t)
        (<span style="font-weight: bold;">push</span> <span style="font-style: italic;">"---"</span> results)
        (<span style="font-weight: bold;">push</span> (match-string 1) results))
      (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">setq</span> results (nreverse results))
        (define-word--convert-html-tag-to-face (define-word--join-results results))))))

(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my/define-word-part-map-alist</span> '((<span style="font-style: italic;">"adjective"</span> <span style="font-style: italic;">"adj."</span>)
                                        (<span style="font-style: italic;">"adverb"</span> <span style="font-style: italic;">"adv."</span>)
                                        (<span style="font-style: italic;">"intransitive verb"</span> <span style="font-style: italic;">"v.i."</span>)
                                        (<span style="font-style: italic;">"transitive verb"</span> <span style="font-style: italic;">"v.t."</span>)))


(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/define-word--parse-wordnik</span> ()
  (<span style="font-weight: bold;">let</span> ((str (define-word--parse-wordnik)))
    (<span style="font-weight: bold;">with-temp-buffer</span>
      (insert str)
      (mapc (<span style="font-weight: bold;">lambda</span> (abbrev-map)
              (goto-char (point-min))
              (<span style="font-weight: bold;">while</span> (re-search-forward (format <span style="font-style: italic;">"</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">%s</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">"</span> (car abbrev-map)) nil t)
                (<span style="font-weight: bold;">let</span> ((match (match-string 1)))
                  (replace-match
                   (propertize (cadr abbrev-map) 'face (text-properties-at (point)))))))
            my/define-word-part-map-alist)
      (buffer-string))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/define-word--parse-wordnik-related-word</span> ()
  <span style="font-style: italic;">"docstring"</span>
  (<span style="font-weight: bold;">save-excursion</span>
    (<span style="font-weight: bold;">save-match-data</span>
      (seq-reduce
       (<span style="font-weight: bold;">lambda</span> (accum group)
         (<span style="font-weight: bold;">let</span> (results
               (define-word-limit 20))
           (<span style="font-weight: bold;">if</span> (re-search-forward (format <span style="font-style: italic;">"&lt;h3&gt;%s"</span> group) nil t)
               (<span style="font-weight: bold;">progn</span> (<span style="font-weight: bold;">save-excursion</span>
                        (<span style="font-weight: bold;">setq</span> beg (re-search-forward <span style="font-style: italic;">"&lt;div class=\"related-group-header clearfix\"&gt;"</span> nil t)))
                      (<span style="font-weight: bold;">push</span> (concat group <span style="font-style: italic;">":"</span>) results)
                      (<span style="font-weight: bold;">while</span> (re-search-forward <span style="font-style: italic;">"&lt;span data-definition-for=\"</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">[</span><span style="font-style: italic;">^</span><span style="font-style: italic;">\"]*</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">\""</span> beg t)
                        (<span style="font-weight: bold;">push</span> (concat <span style="font-style: italic;">"- "</span> (match-string 1)) results)
                        (re-search-forward <span style="font-style: italic;">"&lt;/span&gt;"</span>))
                      (concat (<span style="font-weight: bold;">when</span> accum (concat accum <span style="font-style: italic;">"\n\n"</span>))
                              (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">setq</span> results (nreverse results))
                                (define-word--convert-html-tag-to-face (define-word--join-results results)))))
             accum)))
       '(<span style="font-style: italic;">"antonym"</span> <span style="font-style: italic;">"equivalents"</span> <span style="font-style: italic;">"hypernyms"</span> <span style="font-style: italic;">"hyponyms"</span> <span style="font-style: italic;">"same context"</span>)
       nil))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/define-word--parse-wordnik-all</span> ()
  <span style="font-style: italic;">""</span>
  (<span style="font-weight: bold;">let*</span> ((def (funcall #'my/define-word--parse-wordnik))
         (rel (funcall #'my/define-word--parse-wordnik-related-word))
         (exp (funcall #'my/define-word--parse-wordnik-example)))
    (concat <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">"Definitions:\n" (funcall #'define-word--parse-wordnik) "\n\n"</span>
     (<span style="font-weight: bold;">when</span> def (format <span style="font-style: italic;">"Definitions:\n%s\n\n"</span> def))
     (<span style="font-weight: bold;">when</span> rel (format <span style="font-style: italic;">"%s\n\n"</span> rel))
     (<span style="font-weight: bold;">when</span> exp (format <span style="font-style: italic;">"Examples:\n%s\n"</span> exp)))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/define-word--parse-weblio</span> ()
  (<span style="font-weight: bold;">save-excursion</span>
    (<span style="font-weight: bold;">let</span> (beg
          results
          (define-word-limit 10))
      (re-search-forward <span style="font-style: italic;">"&lt;span class=\"squareCircle description\"&gt;\n[[:blank:]]*&#24847;&#21619;&#12539;&#23550;&#35379;&lt;/span&gt;"</span> nil t)
      (<span style="font-weight: bold;">save-excursion</span>
        (<span style="font-weight: bold;">setq</span> beg (re-search-forward <span style="font-style: italic;">"&lt;/div&gt;"</span> nil t)))
      (<span style="font-weight: bold;">while</span> (re-search-forward <span style="font-style: italic;">"&lt;span class=\"content-explanation  ej\"&gt;\n[[:blank:]]*</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">[</span><span style="font-style: italic;">^</span><span style="font-style: italic;">&lt;]*</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">&lt;/span&gt;"</span> beg t)
        (<span style="font-weight: bold;">push</span> (match-string 1) results))
      (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">setq</span> results (nreverse results))
        (define-word--convert-html-tag-to-face (define-word--join-results results))))))
</pre>
</div>
</div>
</li>

<li><a id="org6fa79e0"></a>synosaurus<br />
<div class="outline-text-6" id="text-org6fa79e0">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-synosaurus"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package synosaurus
  <span style="font-weight: bold;">:custom</span>
  (synosaurus-choose-method 'default))
</pre>
</div>
</div>
</li>

<li><a id="org214511d"></a>exec-path-from-shell<br />
<div class="outline-text-6" id="text-org214511d">
<p>
A GNU Emacs library to ensure environment variables inside Emacs look the same as in the user's shell.
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-exec-path-from-shell"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package exec-path-from-shell
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">when</span> (memq window-system '(mac))
    (exec-path-from-shell-initialize)))
</pre>
</div>
</div>
</li>

<li><a id="org4964f10"></a>migemo.el<br />
<div class="outline-text-6" id="text-org4964f10">
<p>
migemo allows me to search incrementally Japanese words using roma-ji expression.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-style: italic;">"https://github.com/emacs-jp/migemo/releases.atom"</span> soft_update)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package migemo
  <span style="font-weight: bold;">:straight</span> t
  <span style="font-weight: bold;">:ensure-system-package</span> cmigemo
  <span style="font-weight: bold;">:custom</span>
  (migemo-command <span style="font-style: italic;">"cmigemo"</span>)
  (migemo-options '(<span style="font-style: italic;">"-q"</span> <span style="font-style: italic;">"--emacs"</span>))
  (migemo-directory <span style="font-style: italic;">"/usr/share/cmigemo/utf-8"</span>)
  (migemo-dictionary <span style="font-style: italic;">"/usr/share/cmigemo/utf-8/migemo-dict"</span>)
  (migemo-user-dictionary nil)
  (migemo-coding-system 'utf-8-unix)
  (migemo-regex-dictionary nil)
  <span style="font-weight: bold;">:config</span>
  (migemo-init))
</pre>
</div>
</div>

<ul class="org-ul">
<li><a id="org94794a3"></a>ivy-migemo&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span>&#xa0;<span class="ignore">ignore</span></span><br /></li>
</ul>
</li>

<li><a id="org5f593b0"></a>hungry-delete<br />
<div class="outline-text-6" id="text-org5f593b0">
<p>
Aggressively delete successive white spaces.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-style: italic;">"https://github.com/nflath/hungry-delete/releases.atom"</span> soft_update)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package hungry-delete
  <span style="font-weight: bold;">:straight</span> t
  <span style="font-weight: bold;">:diminish</span>
  <span style="font-weight: bold;">:config</span>
  (global-hungry-delete-mode 1))
</pre>
</div>
</div>
</li>

<li><a id="org6c0bf15"></a><a id="ID-4a58219c-74dd-4135-b56d-876b0db2cd83"></a>aggressive-indent-mode<br />
<div class="outline-text-6" id="text-org6c0bf15">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-aggressive-indent"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package aggressive-indent
  <span style="font-weight: bold;">:diminish</span> (aggressive-indent-mode . <span style="font-style: italic;">"ai"</span>)
  <span style="font-weight: bold;">:hook</span> (emacs-lisp-mode . aggressive-indent-mode))
</pre>
</div>
</div>
</li>
<li><a id="orgce542f6"></a>adaptive-wrap<br />
<div class="outline-text-6" id="text-orgce542f6">
<p>
adaptive-wrap and visual-line-mode are active in a bundle in a bunch of major modes.
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-adaptive-wrap"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package adaptive-wrap)
</pre>
</div>
</div>
</li>

<li><a id="org8e1da0a"></a>restart-emacs<br />
<div class="outline-text-6" id="text-org8e1da0a">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-restart-emacs"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package restart-emacs
  <span style="font-weight: bold;">:bind</span> ((<span style="font-style: italic;">"C-M-&lt;delete&gt;"</span>   . restart-emacs)
         (<span style="font-style: italic;">"C-M-S-&lt;delete&gt;"</span> . save-buffers-kill-emacs)))
</pre>
</div>
</div>
</li>
<li><a id="org59cb068"></a>pangu-spacing<br />
<div class="outline-text-6" id="text-org59cb068">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-style: italic;">"https://github.com/coldnew/pangu-spacing/releases.atom"</span> soft_update)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package pangu-spacing
  <span style="font-weight: bold;">:straight</span> t
  <span style="font-weight: bold;">:diminish</span> pangu-spacing-mode
  <span style="font-weight: bold;">:custom</span>
  (pangu-spacing-real-insert-separtor t)
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">setq</span> pangu-spacing-chinese-before-english-regexp
        (<span style="font-weight: bold;">rx</span> (group-n 1 (category japanese))
            (group-n 2 (in <span style="font-style: italic;">"a-zA-Z0-9"</span>))))
  (<span style="font-weight: bold;">setq</span> pangu-spacing-chinese-after-english-regexp
        (<span style="font-weight: bold;">rx</span> (group-n 1 (in <span style="font-style: italic;">"a-zA-Z0-9"</span>))
            (group-n 2 (category japanese)))))
</pre>
</div>
</div>
</li>
<li><a id="orgb625778"></a>which-key<br />
<div class="outline-text-6" id="text-orgb625778">
<p>
<a href="https://github.com/justbur/emacs-which-key">which-key</a> guides me "which key is available" after current key stroke in the mini buffer.
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-which-key"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package which-key
  <span style="font-weight: bold;">:diminish</span> which-key-mode
  <span style="font-weight: bold;">:custom</span>
  (which-key-use-C-h-commands t)
  (which-key-max-description-length 43)
  (which-key-idle-delay 0.7)
  (which-key-separator <span style="font-style: italic;">" : "</span>)
  (which-key-side-window-max-height 0.5)
  <span style="font-weight: bold;">:config</span>
  (which-key-mode 1)
  (which-key-setup-side-window-bottom))
</pre>
</div>
</div>
</li>
<li><a id="org0bb2956"></a>hydra<br />
<div class="outline-text-6" id="text-org0bb2956">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-hydra"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package hydra
  <span style="font-weight: bold;">:custom</span>
  (hydra-is-helpful nil))
</pre>
</div>
</div>
</li>
<li><a id="orgc2358ef"></a>pass<br />
<div class="outline-text-6" id="text-orgc2358ef">
<p>
Major mode for manupulating password store file.
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-pass"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package pass
  <span style="font-weight: bold;">:config</span>
  (bind-keys <span style="font-weight: bold;">:map</span> pass-mode-map
             (<span style="font-style: italic;">"C-j"</span> . pass-view)))
</pre>
</div>
</div>
</li>

<li><a id="org4ab7b5d"></a>password-store<br />
<div class="outline-text-6" id="text-org4ab7b5d">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-password-store"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package password-store
  <span style="font-weight: bold;">:custom</span>
  (password-store-time-before-clipboard-restore 25))
</pre>
</div>
</div>
</li>

<li><a id="org5038c21"></a>nov.el<br />
<div class="outline-text-6" id="text-org5038c21">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-nov-el"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package nov
  <span style="font-weight: bold;">:demand</span> t
  <span style="font-weight: bold;">:mode</span> (<span style="font-style: italic;">"\\.epub$"</span> . nov-mode)
  <span style="font-weight: bold;">:hook</span> (nov-mode . nov-abbreviate-file-name)
  <span style="font-weight: bold;">:custom</span>
  (nov-variable-pitch nil)
  (nov-text-width t)
  <span style="font-weight: bold;">:config</span>
  (bind-keys <span style="font-weight: bold;">:map</span> nov-mode-map
             (<span style="font-style: italic;">"f"</span> . scroll-up-line)
             (<span style="font-style: italic;">"e"</span> . scroll-down-line)
             (<span style="font-style: italic;">"SPC"</span> . my/forward-paragraph)
             (<span style="font-style: italic;">"E"</span> . my/backward-paragraph)
             (<span style="font-style: italic;">"2"</span> . shr-next-link)
             (<span style="font-style: italic;">"4"</span> . nov-browse-url)
             (<span style="font-style: italic;">"C-j"</span> . nov-browse-url)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">nov-abbreviate-file-name</span> ()
  <span style="font-style: italic;">"Shorten `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">nov-file-name</span><span style="font-style: italic;">' using `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">directory-abbrev-alist</span><span style="font-style: italic;">'."</span>
  (<span style="font-weight: bold;">setq</span> nov-file-name (abbreviate-file-name nov-file-name)))
</pre>
</div>
</div>
</li>
<li><a id="org539ad57"></a>yasnippet<br />
<div class="outline-text-6" id="text-org539ad57">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-yasnippet"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package yasnippet
  <span style="font-weight: bold;">:delight</span> (snippet-mode <span style="font-style: italic;">" SN"</span>)
  <span style="font-weight: bold;">:diminish</span> (yas-minor-mode . <span style="font-style: italic;">"ys"</span>)
  <span style="font-weight: bold;">:hook</span>
  ((prog-mode org-mode shell-mode) . yas-minor-mode-on)
  <span style="font-weight: bold;">:custom</span>
  (yas-triggers-in-field t)
  (yas-snippet-dirs
   `(,(expand-file-name <span style="font-style: italic;">"snippets"</span> user-emacs-directory-default)))
  <span style="font-weight: bold;">:config</span>
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">work around code</span>
  (yas-reload-all))
</pre>
</div>
</div>
<ul class="org-ul">
<li><a id="org0c5fcbb"></a>yasnippet-snippets<br />
<div class="outline-text-7" id="text-org0c5fcbb">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-yasnippet-snippets"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package yasnippet-snippets
  <span style="font-weight: bold;">:after</span> yasnippet)
</pre>
</div>
</div>
</li>
</ul>
</li>
<li><a id="orgd14379c"></a>pdf-tools<br />
<div class="outline-text-6" id="text-orgd14379c">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-pdf-tools"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package pdf-tools
  <span style="font-weight: bold;">:delight</span>
  (pdf-view-mode <span style="font-style: italic;">" PV"</span>)
  <span style="font-weight: bold;">:mode</span> (<span style="font-style: italic;">"\\.pdf$"</span> . pdf-view-mode)
  <span style="font-weight: bold;">:hook</span>
  (pdf-view-mode . pdf-view-midnight-minor-mode)
  (pdf-view-mode . pdf-view-fit-page-to-window)
  <span style="font-weight: bold;">:custom</span>
  (pdf-view-display-size 'fit-width))
</pre>
</div>
</div>
</li>

<li><a id="org6ffc1c8"></a>rainbow-mode<br />
<div class="outline-text-6" id="text-org6ffc1c8">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-rainbow-mode"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package rainbow-mode
  <span style="font-weight: bold;">:diminish</span>
  (rainbow-mode . <span style="font-style: italic;">"rb"</span>)
  <span style="font-weight: bold;">:hook</span>
  ((css-mode scss-mode php-mode html-mode) . rainbow-mode)
  <span style="font-weight: bold;">:custom</span>
  (rainbow-html-colors t)
  (rainbow-x-colors t)
  (rainbow-latex-colors t)
  (rainbow-ansi-colors t))
</pre>
</div>
</div>
</li>
<li><a id="org2b5c51f"></a>alert<br />
<div class="outline-text-6" id="text-org2b5c51f">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"mpg321"</span>
<span style="font-style: italic;">"emacs-alert"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package alert
  <span style="font-weight: bold;">:config</span>
  (set-face-background 'alert-saved-fringe-face nil)
  (alert-add-rule <span style="font-weight: bold;">:status</span> '(buried)
                  <span style="font-weight: bold;">:mode</span>   'mu4e-alert
                  <span style="font-weight: bold;">:style</span>  'fringe)
  (alert-add-rule <span style="font-weight: bold;">:status</span> '(buried)
                  <span style="font-weight: bold;">:mode</span>   'dired-mode
                  <span style="font-weight: bold;">:style</span>  'fringe)
  (alert-add-rule <span style="font-weight: bold;">:status</span> '(buried)
                  <span style="font-weight: bold;">:mode</span>   'org-mode
                  <span style="font-weight: bold;">:style</span>  'libnotify))

(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">alarm-sound</span> (expand-file-name <span style="font-style: italic;">"~/data/media/music/levelup.mp3"</span>))
(alert-define-style 'alarm
                    <span style="font-weight: bold;">:title</span> <span style="font-style: italic;">"alarm"</span>
                    <span style="font-weight: bold;">:notifier</span>
                    (<span style="font-weight: bold;">lambda</span> (info)
                      (<span style="font-weight: bold;">let</span> ((message (plist-get info <span style="font-weight: bold;">:message</span>))
                            (severity (plist-get info <span style="font-weight: bold;">:severity</span>))
                            (title (plist-get info <span style="font-weight: bold;">:title</span>))
                            (icon (plist-get info <span style="font-weight: bold;">:icon</span>))
                            (category (plist-get info <span style="font-weight: bold;">:category</span>))
                            (buffer (plist-get info <span style="font-weight: bold;">:buffer</span>))
                            (mode (plist-get info <span style="font-weight: bold;">:mode</span>))
                            (data (plist-get info <span style="font-weight: bold;">:data</span>))
                            (style (plist-get info <span style="font-weight: bold;">:style</span>))
                            (persistent (plist-get info <span style="font-weight: bold;">:persistent</span>))
                            (id (plist-get info <span style="font-weight: bold;">:id</span>))
                            (system-volume (string-trim (shell-command-to-string <span style="font-style: italic;">"volget"</span>))))
                        (<span style="font-weight: bold;">if</span> (string= system-volume <span style="font-style: italic;">"0"</span>)
                            (alert message <span style="font-weight: bold;">:severity</span> severity <span style="font-weight: bold;">:title</span> title <span style="font-weight: bold;">:icon</span> icon <span style="font-weight: bold;">:category</span> category <span style="font-weight: bold;">:buffer</span> buffer <span style="font-weight: bold;">:mode</span> mode <span style="font-weight: bold;">:data</span> data <span style="font-weight: bold;">:style</span> 'fringe <span style="font-weight: bold;">:persistent</span> persistent <span style="font-weight: bold;">:id</span> id)
                          (start-process-shell-command <span style="font-style: italic;">"system-alarm"</span> nil
                                                       (mapconcat #'shell-quote-argument
                                                                  (list <span style="font-style: italic;">"mpg321"</span> alarm-sound)
                                                                  <span style="font-style: italic;">" "</span>))))))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-shell"><span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">!/usr/bin/</span><span style="font-weight: bold;">env</span><span style="font-weight: bold; font-style: italic;"> bash</span>

pactl list sinks | grep <span style="font-style: italic;">'^[[:space:]]Volume:'</span> | head -n $(($<span style="font-weight: bold; font-style: italic;">SINK</span> + 1 )) | tail -n 1 | sed -e <span style="font-style: italic;">'s,.* \([0-9][0-9]*\)%.*,\1,'</span>
</pre>
</div>
</div>
</li>

<li><a id="orgcbf89e9"></a>ts<br />
<div class="outline-text-6" id="text-orgcbf89e9">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-ts"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package ts)
</pre>
</div>
</div>
</li>

<li><a id="org76862bf"></a>app-launcher&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span><br /></li>

<li><a id="org175f65d"></a>tldr<br />
<div class="outline-text-6" id="text-org175f65d">
<p>
I ran into a problem with downloading TL;DR document. I forcibly download, uncompress and locate that to `tldr-directory-path'.
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-tldr"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package tldr
  <span style="font-weight: bold;">:custom</span>
  (tldr-use-word-at-point t))
</pre>
</div>
</div>
</li>
</ul>
</li>
</ul>
</div>

<div id="outline-container-org1e3d49f" class="outline-4">
<h4 id="org1e3d49f">further customization</h4>
<div class="outline-text-4" id="text-org1e3d49f">
</div>
<ul class="org-ul">
<li><a id="orgfa53954"></a>handy functionalities<br />
<div class="outline-text-5" id="text-orgfa53954">
</div>

<ul class="org-ul">
<li><a id="orgffbfea2"></a>power management<br />
<div class="outline-text-6" id="text-orgffbfea2">
<p>
Shut down emacs automatically when remaining power of laptop PC lower than <a href="battery-load-low">battery-load-low</a>
to avoid accidental data loss.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">battery</span>)

(run-with-timer 60 60 #'kill-emacs-auto)

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">kill-emacs-auto</span> ()
  <span style="font-style: italic;">"Kill Emacs if remaining machine power lower than `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">battery-load-low</span><span style="font-style: italic;">'."</span>
  (when-let* ((data (<span style="font-weight: bold;">and</span> battery-status-function (funcall battery-status-function)))
              (percentage (car (read-from-string (cdr (assq ?p data)))))
              (power (cdr (assq ?L data))))
    (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">and</span> (&lt; percentage battery-load-low)
               (string= power <span style="font-style: italic;">"BAT"</span>))
      (save-buffers-kill-emacs t))))
</pre>
</div>
</div>
</li>

<li><a id="org72f9a5d"></a>cursor movement<br />
<div class="outline-text-6" id="text-org72f9a5d">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">setq</span> sentence-end-double-space nil)

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/forward-paragraph</span> ()
  (<span style="font-weight: bold;">interactive</span>)
  (forward-paragraph 2)
  (backward-paragraph 1)
  (forward-line 1)
  (recenter-top-bottom 0))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/backward-paragraph</span> ()
  (<span style="font-weight: bold;">interactive</span>)
  (backward-paragraph 2)
  (forward-paragraph 1)
  (backward-paragraph 1)
  (forward-line 1)
  (recenter-top-bottom 0))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/drag-line-backward</span> ()
  <span style="font-style: italic;">"Drag up current line for one."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (transpose-lines 1)
  (previous-line 2))

(global-set-key (kbd <span style="font-style: italic;">"M-S-&lt;up&gt;"</span>) 'my/drag-line-backward)

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/drag-line-forward</span> ()
  <span style="font-style: italic;">"Drag down current line for one."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (next-line 1)
  (transpose-lines 1)
  (previous-line 1))

(global-set-key (kbd <span style="font-style: italic;">"M-S-&lt;down&gt;"</span>) 'my/drag-line-forward)
</pre>
</div>
</div>
</li>

<li><a id="org35d9eec"></a>lookup functions<br />
<div class="outline-text-6" id="text-org35d9eec">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defmacro</span> <span style="font-weight: bold;">define-lookup-function</span> (fun search-prefix)
  <span style="font-style: italic;">"Create lookup function named FUN using SEARCH-PREFIX for querying.</span>

<span style="font-style: italic;">if WORD-FIXED is given, use it as a search word."</span>
  (<span style="font-weight: bold;">declare</span> (indent 1))
  `(<span style="font-weight: bold;">defun</span> ,fun (word <span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> arg)
     <span style="font-style: italic;">"Issue search query with WORD.</span>

<span style="font-style: italic;">Use a string in region for WORD if region is active.</span>
<span style="font-style: italic;">If called with prefix argument, prompt the user to input WORD regardless region is active or not."</span>
     (<span style="font-weight: bold;">interactive</span> (<span style="font-weight: bold;">let</span> ((region-str (<span style="font-weight: bold;">when</span> (use-region-p)
                                      (buffer-substring (region-beginning) (region-end)))))
                    (list (<span style="font-weight: bold;">cond</span>
                           ((<span style="font-weight: bold;">and</span> (stringp region-str)
                                 (equal current-prefix-arg nil))
                            region-str)
                           (t
                            (read-string <span style="font-style: italic;">"Enter URL or keywords: "</span> region-str))))))
     (<span style="font-weight: bold;">let</span> ((eww-search-prefix ,search-prefix))
       (eww word 4))))

(define-lookup-function lookup-google <span style="font-style: italic;">"https://www.google.com/search?q="</span>)
(define-lookup-function lookup-wikipedia-en <span style="font-style: italic;">"https://en.wikipedia.org/wiki/"</span>)
(define-lookup-function lookup-wikipedia-ja <span style="font-style: italic;">"https://ja.wikipedia.org/wiki/"</span>)
(define-lookup-function lookup-amazon <span style="font-style: italic;">"https://www.amazon.co.jp/gp/search/?field-keywords="</span>)
(define-lookup-function lookup-melpa <span style="font-style: italic;">"https://melpa.org/#/?q="</span>)
(define-lookup-function lookup-duckduckgo <span style="font-style: italic;">"https://duckduckgo.com/html/?kl=jp-jp&amp;k1=-1&amp;kc=1&amp;kf=-1&amp;q="</span>)
(define-lookup-function lookup-eijiro <span style="font-style: italic;">"https://eow.alc.co.jp/search?q="</span>)
(define-lookup-function lookup-weblio <span style="font-style: italic;">"https://www.weblio.jp/content/"</span>)
(define-lookup-function lookup-youtube <span style="font-style: italic;">"https://www.youtube.com/results?search_query="</span>)

(<span style="font-weight: bold;">with-eval-after-load</span> 'hydra
  (defhydra hydra-lookup (global-map <span style="font-style: italic;">"C-c l"</span>
                                     <span style="font-weight: bold;">:color</span> blue)
    <span style="font-style: italic;">"Lookup"</span>
    (<span style="font-style: italic;">"g"</span> lookup-google)
    (<span style="font-style: italic;">"w"</span> lookup-wikipedia-ja)
    (<span style="font-style: italic;">"W"</span> lookup-wikipedia-en)
    (<span style="font-style: italic;">"a"</span> lookup-amazon <span style="font-style: italic;">"amazon.co.jp"</span>)
    (<span style="font-style: italic;">"m"</span> lookup-melpa <span style="font-style: italic;">"melpa"</span>)
    (<span style="font-style: italic;">"d"</span> lookup-duckduckgo <span style="font-style: italic;">"duckduckgo"</span>)
    (<span style="font-style: italic;">"l"</span> lookup-weblio <span style="font-style: italic;">"weblio"</span>)
    (<span style="font-style: italic;">"y"</span> lookup-youtube <span style="font-style: italic;">"youtube"</span>)
    (<span style="font-style: italic;">"e"</span> my/define-word)
    (<span style="font-style: italic;">"j"</span> (<span style="font-weight: bold;">lambda</span> ()
           (<span style="font-weight: bold;">interactive</span>)
           (<span style="font-weight: bold;">let</span> ((define-word-default-service 'weblio))
             (my/define-word)))
     <span style="font-style: italic;">"japanese translation"</span>)
    (<span style="font-style: italic;">"J"</span> lookup-eijiro)
    (<span style="font-style: italic;">"s"</span> synosaurus-lookup <span style="font-style: italic;">"synosaurus-lookup"</span>)
    (<span style="font-style: italic;">"S"</span> synosaurus-choose-and-replace <span style="font-style: italic;">"synosaurus-replace"</span>)
    (<span style="font-style: italic;">"o"</span> my/lookup-org-archive)
    (<span style="font-style: italic;">"q"</span> nil <span style="font-style: italic;">"quit"</span>)))
</pre>
</div>
</div>
</li>

<li><a id="org8bdf88f"></a>perspective control<br />
<div class="outline-text-6" id="text-org8bdf88f">
<p>
This hydra definition enalbes the user to focus on changing font size, moving window to display.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">with-eval-after-load</span> 'hydra
  (defhydra hydra-perspective
    (global-map <span style="font-style: italic;">"C-&amp;"</span>
                <span style="font-weight: bold;">:foreign-keys</span> warn
                <span style="font-weight: bold;">:pre</span> (set-face-attribute 'fringe nil <span style="font-weight: bold;">:background</span> <span style="font-style: italic;">"LightSeaGreen"</span>)
                <span style="font-weight: bold;">:post</span> (set-face-attribute 'fringe nil <span style="font-weight: bold;">:background</span> nil))
    <span style="font-style: italic;">"Hydra perspective"</span>
    (<span style="font-style: italic;">"f"</span> scroll-up-line)
    (<span style="font-style: italic;">"e"</span> scroll-down-line)
    (<span style="font-style: italic;">"&gt;"</span> (scroll-left 1))
    (<span style="font-style: italic;">"&lt;"</span> (scroll-right 1))
    (<span style="font-style: italic;">"t"</span> visual-line-mode)
    (<span style="font-style: italic;">"+"</span> text-scale-adjust)
    (<span style="font-style: italic;">"="</span> text-scale-adjust)
    (<span style="font-style: italic;">"-"</span> text-scale-adjust)
    (<span style="font-style: italic;">"0"</span> text-scale-adjust)
    (<span style="font-style: italic;">"C-f"</span> forward-char)
    (<span style="font-style: italic;">"M-f"</span> forward-word)
    (<span style="font-style: italic;">"C-b"</span> backward-char)
    (<span style="font-style: italic;">"M-b"</span> backward-word)
    (<span style="font-style: italic;">"C-n"</span> next-line)
    (<span style="font-style: italic;">"C-p"</span> previous-line)
    (<span style="font-style: italic;">"C-v"</span> scroll-up-command)
    (<span style="font-style: italic;">"M-v"</span> scroll-down-command)
    (<span style="font-style: italic;">"C-a"</span> move-beginning-of-line)
    (<span style="font-style: italic;">"C-e"</span> move-end-of-line)
    (<span style="font-style: italic;">"C-g"</span> keyboard-quit <span style="font-weight: bold;">:exit</span> t)
    (<span style="font-style: italic;">"q"</span> nil <span style="font-weight: bold;">:exit</span> t)))
</pre>
</div>
</div>
</li>

<li><a id="org426a558"></a>tldr<br />
<div class="outline-text-6" id="text-org426a558">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/tldr</span> (command)
  <span style="font-style: italic;">"Show the output of tldr for COMMAND in a dedicated buffer."</span>
  (<span style="font-weight: bold;">interactive</span> (list (read-string <span style="font-style: italic;">"Coomand: "</span>)))
  (<span style="font-weight: bold;">let*</span> ((buf-name <span style="font-style: italic;">"*TL;DR*"</span>)
         (buffer (get-buffer-create buf-name)))
    (<span style="font-weight: bold;">with-current-buffer</span> buffer
      (read-only-mode -1)
      (erase-buffer)
      (insert (shell-command-to-string (format <span style="font-style: italic;">"tldr %s"</span>
                                               (shell-quote-argument command))))
      (ansi-color-apply-on-region (point-min) (point-max))
      (goto-char (point-min))
      (read-only-mode 1))
    (display-buffer buffer '((display-buffer-pop-up-window)
                             . ((window-height . 8))))
    (switch-to-buffer-other-window buffer)))
</pre>
</div>
</div>
</li>

<li><a id="org0952a2c"></a>sending email<br />
<div class="outline-text-6" id="text-org0952a2c">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">mail-simple-send</span> (mailto subject body)
  <span style="font-style: italic;">"Default function to send a mail with SUBJECT and BODY to myself."</span>
  (<span style="font-weight: bold;">save-excursion</span>
    (<span style="font-weight: bold;">let</span> ((message-kill-buffer-on-exit t))
      (message-mail mailto subject)
      (message-goto-body)
      (insert body)
      (message-send-and-exit))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">mail-buffer</span> (mailto)
  <span style="font-style: italic;">"Send the current buffer contents as a email.</span>

<span style="font-style: italic;">If region is active, send the string in the region instead."</span>
  (<span style="font-weight: bold;">let</span> ((mail-subj (buffer-name))
        (mail-body (<span style="font-weight: bold;">if</span> (use-region-p)
                       (buffer-substring (region-beginning) (region-end))
                     (buffer-string))))
    (mail-simple-send mailto mail-subj mail-body)))
</pre>
</div>
</div>
</li>

<li><a id="orgc7afaf0"></a>open url or something<br />
<div class="outline-text-6" id="text-orgc7afaf0">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">thingatpt</span>)

(global-set-key (kbd <span style="font-style: italic;">"C-c C-o"</span>) 'my/enter-thing-at-point)

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/enter-thing-at-point</span> ()
  <span style="font-style: italic;">"Enter thing in appropriate manner."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">let*</span> ((thing nil)
         (region-thing (<span style="font-weight: bold;">when</span> (use-region-p)
                         (buffer-substring (region-beginning) (region-end)))))
    (<span style="font-weight: bold;">cond</span>
     ((<span style="font-weight: bold;">setq</span> thing
            (<span style="font-weight: bold;">if</span> region-thing
                (<span style="font-weight: bold;">when</span> (string-match thing-at-point-email-regexp
                                    region-thing)
                  (match-string 0 region-thing))
              (thing-at-point 'email t)))
      (mu4e~compose-mail thing)
      t)
     ((<span style="font-weight: bold;">setq</span> thing (car (eww-links-at-point)))
      (<span style="font-weight: bold;">cl-case</span> (prefix-numeric-value current-prefix-arg)
        (16 (browse-url-default-browser thing))
        (4 (eww-browse-url thing))
        (t (open-url thing)))
      t)
     ((<span style="font-weight: bold;">setq</span> thing
            (<span style="font-weight: bold;">if</span> region-thing
                (<span style="font-weight: bold;">when</span> (string-match browse-url-button-regexp
                                    region-thing)
                  (match-string 0 region-thing))
              (thing-at-point 'url t)))
      (<span style="font-weight: bold;">let</span> ((url-pos (split-location-uri thing)))
        (<span style="font-weight: bold;">cl-case</span> (prefix-numeric-value current-prefix-arg)
          (16 (browse-url-default-browser (car url-pos)))
          (4 (eww-browse-url (car url-pos)))
          (t (open-url (car url-pos) (cadr url-pos))))
        t))
     ((<span style="font-weight: bold;">and</span> (<span style="font-weight: bold;">setq</span> thing
                 (<span style="font-weight: bold;">if</span> region-thing
                     (<span style="font-weight: bold;">when</span> (string-match (format <span style="font-style: italic;">"[%s].+"</span> thing-at-point-file-name-chars)
                                         region-thing)
                       (match-string 0 region-thing))
                   (thing-at-point 'filename t)))
           (file-exists-p thing))
      (<span style="font-weight: bold;">let</span> ((url-pos (split-location-uri thing))
            (prefix-arg current-prefix-arg))
        (<span style="font-weight: bold;">if</span> (equal prefix-arg '(4))
            (find-file (car url-pos))
          (my/view-file (car url-pos) prefix-arg)
          (<span style="font-weight: bold;">unless</span> prefix-arg
            (goto-pos (cadr url-pos))))
        t))
     <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">this clause must be last in cond</span>
     ((<span style="font-weight: bold;">setq</span> thing (button-at (point)))
      (push-button)
      t))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">split-location-uri</span> (location-uri)
  <span style="font-style: italic;">"Split LOCATION-URI into normal uri and location specifier.</span>

<span style="font-style: italic;">Location specifier is either line number or string.</span>
<span style="font-style: italic;">If splitting is successful, this function returns a list containing uri and location specifier."</span>
  (<span style="font-weight: bold;">cond</span>
   ((string-match <span style="font-style: italic;">"</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">.+</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">::</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">[[:digit:]]+</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">$"</span> location-uri)
    (list (match-string 1 location-uri) (string-to-number (match-string 2 location-uri))))
   ((string-match <span style="font-style: italic;">"</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">.+</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">::</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">[[:graph:][:blank:]]+</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">$"</span> location-uri)
    (list (match-string 1 location-uri) (match-string 2 location-uri)))
   (t (list location-uri))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">goto-pos</span> (pos)
  <span style="font-style: italic;">"Move the cursor to the location where `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">POS</span><span style="font-style: italic;">' is pointing.</span>

<span style="font-style: italic;">if `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">POS</span><span style="font-style: italic;">' is a number assumed to be a line number.</span>
<span style="font-style: italic;">If `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">POS</span><span style="font-style: italic;">' is a string assumed to be a searching word."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">cond</span>
         ((numberp pos)
          (forward-line (- pos (line-number-at-pos)))
          t)
         ((stringp pos)
          (<span style="font-weight: bold;">let</span> ((pos-num (string-to-number pos)))
            (<span style="font-weight: bold;">cl-case</span> pos-num
              (0 (goto-char
                  (re-search-forward
                   (string-join (split-string pos <span style="font-style: italic;">""</span> t <span style="font-style: italic;">"[ \t\r\n]*"</span>) <span style="font-style: italic;">"[ \t\r\n]*"</span>) nil nil)))
              (t (forward-line (- pos-num (line-number-at-pos))))))
          t))
    (beginning-of-line)
    (recenter-top-bottom 0)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">open-url</span> (url <span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> pos)
  <span style="font-style: italic;">"Open URL in an appropriate manner and jump to POS.</span>

<span style="font-style: italic;">If URL points to a multimedia contents such as youtube video and mp3 audio file,</span>
<span style="font-style: italic;">play it in media player."</span>
  (<span style="font-weight: bold;">cond</span>
   ((<span style="font-weight: bold;">or</span> (string-match <span style="font-style: italic;">"</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">[</span><span style="font-style: italic;">^</span><span style="font-style: italic;">/]+\\.pdf</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">"</span> url)
        (string-match <span style="font-style: italic;">"</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">[</span><span style="font-style: italic;">^</span><span style="font-style: italic;">/]+\\.epub</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">"</span> url))
    (<span style="font-weight: bold;">let</span> ((dl-file (expand-file-name (match-string 1 url)
                                     temporary-file-directory)))
      (call-process-shell-command (format <span style="font-style: italic;">"curl %s -s -o %s"</span> url dl-file))
      (my/view-file dl-file)
      (<span style="font-weight: bold;">when</span> pos (goto-pos pos))))
   ((string-match-p <span style="font-style: italic;">"^https?://www.youtube.com.*"</span> url)
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">convert greedily watch url to playlist url if possible</span>
    (<span style="font-weight: bold;">let</span> ((url (<span style="font-weight: bold;">if</span> (string-match <span style="font-style: italic;">"&amp;list=</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">[[:graph:]]+</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">"</span> url)
                   (format <span style="font-style: italic;">"https://www.youtube.com/playlist?list=%s"</span> (match-string 1 url))
                 url))
          (ytdl-opts
           (remove nil
                   (list (<span style="font-weight: bold;">when</span> (numberp pos)
                           (format <span style="font-style: italic;">"--ytdl-raw-options=playlist-start=%d"</span> pos))
                         (format <span style="font-style: italic;">"--ytdl-format=%s"</span> (shell-quote-argument (youtube-dl-format)))))))
      (start-process-shell-command <span style="font-style: italic;">"mpv"</span> nil (format <span style="font-style: italic;">"nohup mpv --force-window %s \"%s\" &gt;/dev/null 2&gt;&amp;1"</span> (mapconcat 'identity ytdl-opts <span style="font-style: italic;">" "</span>) url))))
   ((seq-some (<span style="font-weight: bold;">lambda</span> (suffix)
                (string-suffix-p suffix url))
              '(<span style="font-style: italic;">".mp3"</span> <span style="font-style: italic;">".m4a"</span> <span style="font-style: italic;">".mp4"</span> <span style="font-style: italic;">".mkv"</span> <span style="font-style: italic;">".web"</span> <span style="font-style: italic;">".|m3"</span> <span style="font-style: italic;">".|jp"</span> <span style="font-style: italic;">".|jp"</span> <span style="font-style: italic;">".png"</span>))
    (start-process-shell-command <span style="font-style: italic;">"mpv"</span> nil (format <span style="font-style: italic;">"nohup mpv --force-window \"%s\" &gt;/dev/null 2&gt;&amp;1"</span> url)))
   (t (browse-web url)
      (<span style="font-weight: bold;">setq</span> lexical-binding t)
      (<span style="font-weight: bold;">setq</span> position pos)
      (add-hook 'eww-after-render-hook
                (<span style="font-weight: bold;">lambda</span> ()
                  (<span style="font-weight: bold;">when</span> position (goto-pos position))
                  (<span style="font-weight: bold;">setq-local</span> eww-after-render-hook nil))
                0 t))))
</pre>
</div>
</div>
</li>

<li><a id="org71916a9"></a>download media file<br />
<div class="outline-text-6" id="text-org71916a9">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my/download-video-dir</span> <span style="font-style: italic;">"~/data/media/video"</span> <span style="font-style: italic;">"Directory where downloaded video locate."</span>)

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/download-video</span> (url <span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> filename playlistp)
  <span style="font-style: italic;">"Download video from `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">URL</span><span style="font-style: italic;">'.</span>

<span style="font-style: italic;">If optional argument `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">FILENAME</span><span style="font-style: italic;">' is passed, try to use this as filename.</span>
<span style="font-style: italic;">If optional argument `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">PLAYLISTP</span><span style="font-style: italic;">' is passed, try to download all videos in playlist</span>
<span style="font-style: italic;">instead of single video."</span>
  (<span style="font-weight: bold;">interactive</span> (list (read-string <span style="font-style: italic;">"URL: "</span>)))
  (<span style="font-weight: bold;">when</span> (string-match <span style="font-style: italic;">"https?://www.youtube.com.+"</span> url)
    (<span style="font-weight: bold;">let*</span> ((url-orig (match-string 0 url))
           (urlobj-orig (url-generic-parse-url url-orig))
           (pq-orig (url-path-and-query urlobj-orig))
           (yt-url
            (<span style="font-weight: bold;">if</span> (<span style="font-weight: bold;">and</span> (not playlistp)
                     (string= (car pq-orig) <span style="font-style: italic;">"/watch"</span>)
                     (assoc-string <span style="font-style: italic;">"list"</span> (url-parse-query-string (cdr pq-orig))))
                (url-recreate-url
                 (url-parse-make-urlobj (url-type urlobj-orig)
                                        (url-user urlobj-orig)
                                        (url-password urlobj-orig)
                                        (url-host urlobj-orig)
                                        (url-portspec urlobj-orig)
                                        (concat (car pq-orig) <span style="font-style: italic;">"?"</span>
                                                (url-build-query-string
                                                 (list (assoc <span style="font-style: italic;">"v"</span> (url-parse-query-string (cdr pq-orig))))))
                                        (url-target urlobj-orig)
                                        (url-attributes urlobj-orig)
                                        (url-fullness urlobj-orig)))
              url)))
      (<span style="font-weight: bold;">setq</span> lexical-binding t)
      (<span style="font-weight: bold;">setq</span> url-lex url)
      (<span style="font-weight: bold;">setq</span> filename-lex (<span style="font-weight: bold;">if</span> filename
                             (replace-regexp-in-string
                              <span style="font-style: italic;">"[\\?\"/:|&#8217;]"</span> <span style="font-style: italic;">""</span> filename)
                           nil))
      (message <span style="font-style: italic;">"Downloading: %s"</span> (<span style="font-weight: bold;">or</span> filename-lex url))
      (set-process-sentinel
       (start-process-shell-command
        <span style="font-style: italic;">"download video"</span> nil
        (format <span style="font-style: italic;">"cd \"%1$s\" &amp;&amp; nohup youtube-dl %2$s \"%3$s\" &gt;/dev/null 2&gt;&amp;1"</span>
                (expand-file-name my/download-video-dir)
                (mapconcat #'identity
                           (list (format <span style="font-style: italic;">"--format \"%s\""</span> (youtube-dl-format))
                                 (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">and</span> filename-lex
                                            (not playlistp)
                                            (not (string= (car pq-orig) <span style="font-style: italic;">"/playlist"</span>)))
                                   (format <span style="font-style: italic;">"--output %s"</span> (shell-quote-argument filename-lex)))
                                 (<span style="font-weight: bold;">when</span> playlistp <span style="font-style: italic;">"--yes-playlist --ignore-errors --download-archive downloaded.txt"</span>))
                           <span style="font-style: italic;">" "</span>)
                yt-url))
       (<span style="font-weight: bold;">lambda</span> (process desc)
         (<span style="font-weight: bold;">when</span> (eq (process-status process) 'exit)
           (<span style="font-weight: bold;">let</span> ((exit-status (process-exit-status process)))
             (<span style="font-weight: bold;">if</span> (= exit-status 0)
                 (alert (format <span style="font-style: italic;">"Downloaded: %s"</span> (<span style="font-weight: bold;">or</span> filename-lex url-lex)) <span style="font-weight: bold;">:severity</span> 'normal <span style="font-weight: bold;">:style</span> 'fringe)
               (alert (format <span style="font-style: italic;">"Failed(%d): %s"</span> exit-status (<span style="font-weight: bold;">or</span> filename-lex url-lex)) <span style="font-weight: bold;">:severity</span> 'urgent <span style="font-weight: bold;">:style</span> 'fringe)))))))))

(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my/download-audio-dir</span> <span style="font-style: italic;">"~/data/media/audio"</span> <span style="font-style: italic;">"Directory where downloaded audio locate."</span>)

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/download-audio</span> (url <span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> filename)
  <span style="font-style: italic;">"Download audio from `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">URL</span><span style="font-style: italic;">'.</span>

<span style="font-style: italic;">If optional argument `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">FILENAME</span><span style="font-style: italic;">' is given use this as a filename."</span>
  (<span style="font-weight: bold;">interactive</span> (list (read-string <span style="font-style: italic;">"URL: "</span>)))
  (<span style="font-weight: bold;">setq</span> lexical-binding t)
  (<span style="font-weight: bold;">setq</span> url-lex url)
  (<span style="font-weight: bold;">setq</span> filename-lex (<span style="font-weight: bold;">if</span> filename
                         (replace-regexp-in-string
                          <span style="font-style: italic;">"[\\?\"/:|&#8217;]"</span> <span style="font-style: italic;">""</span> filename)
                       nil))
  (message <span style="font-style: italic;">"Downloading: %s"</span> (<span style="font-weight: bold;">or</span> filename-lex url))
  (set-process-sentinel
   (start-process-shell-command
    <span style="font-style: italic;">"download audio"</span> nil
    (format <span style="font-style: italic;">"cd %s &amp;&amp; nohup %s &gt;/dev/null 2&gt;&amp;1"</span>
            (shell-quote-argument (expand-file-name my/download-audio-dir))
            (<span style="font-weight: bold;">if</span> (string-match-p <span style="font-style: italic;">"https?://www.youtube.com.+"</span> url)
                (format <span style="font-style: italic;">"youtube-dl --extract-audio %s"</span> url)
              (concat (format <span style="font-style: italic;">"curl -LJs %s"</span> url)
                      (<span style="font-weight: bold;">and</span> filename-lex
                           (format <span style="font-style: italic;">" -o %s.%s"</span> filename-lex
                                   (file-name-extension url)))))))
   (<span style="font-weight: bold;">lambda</span> (process desc)
     (<span style="font-weight: bold;">when</span> (eq (process-status process) 'exit)
       (<span style="font-weight: bold;">let</span> ((exit-status (process-exit-status process)))
         (<span style="font-weight: bold;">if</span> (= exit-status 0)
             (alert (format <span style="font-style: italic;">"Downloaded: %s"</span> (<span style="font-weight: bold;">or</span> filename-lex url-lex)) <span style="font-weight: bold;">:severity</span> 'normal <span style="font-weight: bold;">:style</span> 'fringe)
           (alert (format <span style="font-style: italic;">"Failed(%d): %s"</span> exit-status (<span style="font-weight: bold;">or</span> filename-lex url-lex)) <span style="font-weight: bold;">:severity</span> 'urgent <span style="font-weight: bold;">:style</span> 'fringe)))))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">show-media-duration</span> (url)
  <span style="font-style: italic;">"Return a duration value for media located at URL."</span>
  (when-let ((duration (<span style="font-weight: bold;">cond</span>
                        ((string-match <span style="font-style: italic;">"https?://www.youtube.com.+"</span> url)
                         (car (split-string (shell-command-to-string
                                             (format <span style="font-style: italic;">"youtube-dl --get-duration %s"</span> url)))))
                        ((string-match <span style="font-style: italic;">"https?://.+"</span> url)
                         (car (split-string (shell-command-to-string
                                             (format <span style="font-style: italic;">"ffmpeg -i \"%s\" 2&gt;&amp;1 | grep Duration | awk -F '[ ]+' '{print substr($3, 0, length($3)-1)}'"</span> url))))))))
    (message <span style="font-style: italic;">"Duration: %s"</span> (<span style="font-weight: bold;">if</span> (stringp duration)
                                duration <span style="font-style: italic;">"N/A"</span>))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/download-video-at-point</span> ()
  <span style="font-style: italic;">"Download video file from url currently pointed."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (when-let ((url (thing-at-point-url-at-point)))
    (my/download-video url)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/download-audio-at-point</span> ()
  <span style="font-style: italic;">"Download audio file from url currently pointed."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">let</span> ((url (thing-at-point-url-at-point)))
    (<span style="font-weight: bold;">when</span> url
      (my/download-audio url))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/show-media-duration-at-point</span> ()
  <span style="font-style: italic;">"Show duration of media file which cursor currently pointed."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (if-let* ((url (thing-at-point-url-at-point)))
      (show-media-duration url)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">youtube-dl-format</span> ()
  <span style="font-style: italic;">"Return appropriate format option value for youtube-dl command."</span>
  (<span style="font-weight: bold;">let*</span> ((ipv4-addr (shell-command-to-string <span style="font-style: italic;">"hostname -I | cut -f1 -d' ' | tr -d '\n'"</span>))
         (wifi-ssid (shell-command-to-string <span style="font-style: italic;">"iwgetid -r | tr -d '\n'"</span>))
         (fmt-quality (<span style="font-weight: bold;">cond</span>
                       <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">using mobile Wi-Fi</span>
                       ((string-prefix-p <span style="font-style: italic;">"192.168.179."</span> ipv4-addr)
                        <span style="font-style: italic;">"bestvideo[height&lt;=?240]+worstaudio/best"</span>)
                       <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">using wired network or broad wifi</span>
                       ((<span style="font-weight: bold;">or</span> (string-prefix-p <span style="font-style: italic;">"192.168.100."</span> ipv4-addr)
                            (member wifi-ssid '(<span style="font-style: italic;">"saint_laurent_ap"</span> <span style="font-style: italic;">"FREE_SPOT"</span>)))
                        <span style="font-style: italic;">"bestvideo[height&lt;=?720]+bestaudio/best"</span>)
                       <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">using unknown network</span>
                       (t
                        <span style="font-style: italic;">"worstvideo+worstaudio"</span>))))
    (format <span style="font-style: italic;">"%s"</span> fmt-quality)))

(global-set-key (kbd <span style="font-style: italic;">"C-c D v"</span>) 'my/download-video-at-point)
(global-set-key (kbd <span style="font-style: italic;">"C-c D a"</span>) 'my/download-audio-at-point)
(global-set-key (kbd <span style="font-style: italic;">"C-c D ="</span>) 'my/show-media-duration-at-point)
</pre>
</div>
</div>
</li>

<li><a id="orgf845661"></a>say out loud text with speech synthesis<br />
<div class="outline-text-6" id="text-orgf845661">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defcustom</span> <span style="font-weight: bold; font-style: italic;">my/say-maximum-duration</span> 30
  <span style="font-style: italic;">"Maximum speech duration in second for `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">my/say</span><span style="font-style: italic;">'."</span>)

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/say</span> (<span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> arg)
  <span style="font-style: italic;">"Say out loud text in buffer.</span>

<span style="font-style: italic;">If region is active the selected string is spoken instead.</span>

<span style="font-style: italic;">With `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">C-u</span><span style="font-style: italic;">' prefix ARG, cancel speeching.</span>

<span style="font-style: italic;">As of now, English and Japanese is supported for speech. Appropriate language is</span>
<span style="font-style: italic;"> determined from a spoken string, specifically the string consists of ASCII</span>
<span style="font-style: italic;"> character is spoken in English. Otherwise the string is  spoken in Japanese."</span>
  (<span style="font-weight: bold;">interactive</span> <span style="font-style: italic;">"P"</span>)
  (<span style="font-weight: bold;">if</span> (equal arg '(4))
      (<span style="font-weight: bold;">progn</span>
        (<span style="font-weight: bold;">and</span> my/say--timer
             (<span style="font-weight: bold;">progn</span> (cancel-timer my/say--timer)
                    (<span style="font-weight: bold;">setq</span> my/say--timer nil)))
        (<span style="font-weight: bold;">if</span> (<span style="font-weight: bold;">and</span> festival-process
                 (string= (process-status festival-process)
                          <span style="font-style: italic;">"run"</span>))
            (festival-kill-process)
          (<span style="font-weight: bold;">and</span> (get-process my/say--open-jtalk-process)
               (interrupt-process my/say--open-jtalk-process))))
    (<span style="font-weight: bold;">let</span> ((my/say-lang 'en))
      (<span style="font-weight: bold;">if</span> (region-active-p)
          (<span style="font-weight: bold;">let</span> ((region-text (buffer-substring (region-beginning) (region-end))))
            (<span style="font-weight: bold;">if</span> (my/say-ascii-p region-text)
                (call-interactively #'festival-say-region)
              (my/say--open-jtalk region-text)
              (<span style="font-weight: bold;">setq</span> my/say-lang 'ja)))
        (<span style="font-weight: bold;">let</span> ((buffer-text (buffer-string)))
          (<span style="font-weight: bold;">if</span> (my/say-ascii-p buffer-text)
              (call-interactively #'festival-say-buffer)
            (princ buffer-text)
            (my/say--open-jtalk buffer-text)
            (<span style="font-weight: bold;">setq</span> my/say-lang 'ja))))
      (<span style="font-weight: bold;">setq</span> my/say--timer
            (<span style="font-weight: bold;">cond</span>
             ((eq my/say-lang 'en)
              (run-with-timer my/say-maximum-duration nil
                              (<span style="font-weight: bold;">lambda</span> ()
                                (festival-kill-process)
                                (<span style="font-weight: bold;">setq</span> my/say--timer nil))))
             ((eq my/say-lang 'ja)
              (run-with-timer my/say-maximum-duration nil
                              (<span style="font-weight: bold;">lambda</span> ()
                                (<span style="font-weight: bold;">and</span> (get-process my/say--open-jtalk-process)
                                     (interrupt-process my/say--open-jtalk-process))
                                (<span style="font-weight: bold;">setq</span> my/say--timer nil)))))))))
(global-set-key (kbd <span style="font-style: italic;">"C-\""</span>) #'my/say)

(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my/say--timer</span> nil <span style="font-style: italic;">"Timer used to cancel speech process."</span>)
(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my/say--open-jtalk-process</span> <span style="font-style: italic;">"Say&lt;Open-JTalk&gt;"</span>
  <span style="font-style: italic;">"Fixed name for a process running Open JTalk."</span>)

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/say--open-jtalk</span> (text)
  <span style="font-style: italic;">"Speech TEXT in Japanese using Open JTalk."</span>
  (start-process-shell-command
   my/say--open-jtalk-process nil
   (format <span style="font-style: italic;">"echo %s | open_jtalk -x /var/lib/mecab/dic/open-jtalk/naist-jdic -m ~/.local/share/hts-voice/mei/mei_angry.htsvoice -ow /tmp/a.wav &amp;&amp; aplay /tmp/a.wav"</span>
           (replace-regexp-in-string <span style="font-style: italic;">"[\t\r\n\v\f]+"</span> <span style="font-style: italic;">" "</span> text))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/say-ascii-p</span> (text)
  <span style="font-style: italic;">"Return non-nil if TEXT consists of ASCII character."</span>
  (string-match-p
   (format <span style="font-style: italic;">"\\`[%s]+\\'"</span> <span style="font-style: italic;">"[:ascii:]&#8217;&#8220;&#8221;&#8211;"</span>)
   text))
</pre>
</div>
</div>

<ul class="org-ul">
<li><a id="org442225c"></a>jsay&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span><br /></li>

<li><a id="orge216959"></a>esay&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span><br /></li>
</ul>
</li>

<li><a id="orgeff783b"></a>collective hydra definitions<br />
<div class="outline-text-6" id="text-orgeff783b">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">with-eval-after-load</span> 'hydra
  (defhydra hydra-launcher (global-map <span style="font-style: italic;">"M-l"</span>
                                       <span style="font-weight: bold;">:color</span> blue)
    <span style="font-style: italic;">"Launch"</span>
    (<span style="font-style: italic;">"xe"</span> eshell)
    (<span style="font-style: italic;">"xg"</span> gdb)
    (<span style="font-style: italic;">"xi"</span> ielm)
    (<span style="font-style: italic;">"xs"</span> shell)
    (<span style="font-style: italic;">"xt"</span> term)
    (<span style="font-style: italic;">"xv"</span> vterm)
    (<span style="font-style: italic;">"D"</span> dired-jump)
    (<span style="font-style: italic;">"="</span> ediff)
    (<span style="font-style: italic;">"@"</span> twit)
    (<span style="font-style: italic;">"v"</span> magit-status)
    (<span style="font-style: italic;">"r"</span> re-builder)
    (<span style="font-style: italic;">"a"</span> app-launcher-run-app)
    (<span style="font-style: italic;">"w"</span> lookup-google)
    (<span style="font-style: italic;">"W"</span> eww-switch-to-buffer)
    (<span style="font-style: italic;">"m"</span> mu4e)
    (<span style="font-style: italic;">"M"</span> mu4e-alert-view-unread-mails)
    (<span style="font-style: italic;">"f"</span> elfeed)
    (<span style="font-style: italic;">"p"</span> proced)
    (<span style="font-style: italic;">"P"</span> list-processes)
    (<span style="font-style: italic;">"b"</span> battery)
    (<span style="font-style: italic;">"c"</span> calendar)
    (<span style="font-style: italic;">"C"</span> calc)
    (<span style="font-style: italic;">"?"</span> woman)
    (<span style="font-style: italic;">";"</span> my/tldr)
    (<span style="font-style: italic;">"q"</span> quickrun)
    (<span style="font-style: italic;">"C-g"</span> nil <span style="font-style: italic;">"cancel"</span>))
  (defhydra hydra-toggle
    (global-map <span style="font-style: italic;">"C-c t"</span>
                <span style="font-weight: bold;">:color</span> pink
                <span style="font-weight: bold;">:pre</span> (set-face-background 'mode-line <span style="font-style: italic;">"DarkOrange4"</span>)
                <span style="font-weight: bold;">:post</span> (set-face-background 'mode-line <span style="font-style: italic;">"gray10"</span>))
    <span style="font-style: italic;">"Toggle"</span>
    (<span style="font-style: italic;">"t"</span> visual-line-mode)
    (<span style="font-style: italic;">"T"</span> toggle-truncate-lines)
    (<span style="font-style: italic;">"i"</span> adaptive-wrap-prefix-mode)
    (<span style="font-style: italic;">"p"</span> variable-pitch-mode)
    (<span style="font-style: italic;">"w"</span> whitespace-mode)
    (<span style="font-style: italic;">"l"</span> display-line-numbers-mode)
    (<span style="font-style: italic;">"L"</span> line-number-mode)
    (<span style="font-style: italic;">"C"</span> column-number-mode)
    (<span style="font-style: italic;">"v"</span> view-mode)
    (<span style="font-style: italic;">"r"</span> rainbow-mode)
    (<span style="font-style: italic;">"\\"</span> toggle-input-method)
    (<span style="font-style: italic;">"F"</span> toggle-frame-fullscreen)
    (<span style="font-style: italic;">"SPC"</span> pangu-spacing-mode)
    (<span style="font-style: italic;">"q"</span> nil <span style="font-style: italic;">"quit"</span>)))
</pre>
</div>
</div>
</li>

<li><a id="org92ddc0f"></a>show the day in calendar<br />
<div class="outline-text-6" id="text-org92ddc0f">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/calendar-show-items</span> ()
  <span style="font-style: italic;">"Show items on the day pointed in calendar view."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">let*</span> ((calendar-date-display-form calendar-iso-date-display-form)
         (date (calendar-date-string (calendar-cursor-to-date)))
         (d (parse-time-string date))
         (year (decoded-time-year d))
         (files (append `(,(my/org-archive-file year))
                        org-agenda-files))
         (buffer-name-prefix <span style="font-style: italic;">"=="</span>)
         (buffer-name (concat buffer-name-prefix date))
         (display-buffer-alist
          `((,buffer-name-prefix
             (display-buffer-reuse-mode-window
              display-buffer-pop-up-window)))))
    (org-ql-search files `(<span style="font-weight: bold;">and</span> (<span style="font-weight: bold;">or</span> (parent (heading ,date))
                                   (ts-a <span style="font-weight: bold;">:on</span> ,date))
                               (not (tags <span style="font-style: italic;">"web"</span> <span style="font-style: italic;">"drill"</span>)))
      <span style="font-weight: bold;">:buffer</span> buffer-name)
    (other-window 1)))
</pre>
</div>
</div>
</li>

<li><a id="orgdec3611"></a>utilities<br />
<div class="outline-text-6" id="text-orgdec3611">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/copy-line-number</span> ()
  <span style="font-style: italic;">"Copy the line number of current point into the kill ring."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">let</span> ((line-number (number-to-string (line-number-at-pos))))
    (message <span style="font-style: italic;">"Line number: %s"</span> line-number)
    (kill-new line-number)))

(global-set-key (kbd <span style="font-style: italic;">"C-M-S-w"</span>) 'my/copy-line-number)

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/insert-time-stamp</span> (<span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> arg)
  <span style="font-style: italic;">"Insert date string with format derived in deterministic way with ARG."</span>
  (<span style="font-weight: bold;">interactive</span> <span style="font-style: italic;">"P"</span>)
  (<span style="font-weight: bold;">let*</span> ((simple-fmt <span style="font-style: italic;">"%Y%m%d"</span>)
         (concise-fmt <span style="font-style: italic;">"%Y-%m-%d"</span>)
         (verbose-fmt <span style="font-style: italic;">"%Y-%m-%d %H:%M:%S"</span>)
         (fmt-in-use (<span style="font-weight: bold;">cond</span>
                      ((equal arg '(16))
                       (read-string <span style="font-style: italic;">"time format: "</span>
                                    <span style="font-style: italic;">"%Y-%m-%d %H:%M:%S"</span>))
                      ((equal arg '(4))
                       verbose-fmt)
                      (t (<span style="font-weight: bold;">cond</span>
                          ((eq major-mode 'text-mode) concise-fmt)
                          ((eq major-mode 'dired-mode) simple-fmt)
                          (t simple-fmt))))))
    (insert (format-time-string fmt-in-use))))

(global-set-key (kbd <span style="font-style: italic;">"C-c ."</span>) 'my/insert-time-stamp)
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="org45cfe87"></a>original features<br />
<ul class="org-ul">
<li><a id="orgcb15eec"></a>org-english<br />
<div class="outline-text-6" id="text-orgcb15eec">
<p>
Learning Workflow for English words:
</p>
<ol class="org-ol">
<li>Capture an word to study by invoking my/org-english-capture</li>
<li>Review words periodically with my/org-english-drill-test-display or its variants</li>
</ol>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/org-english-capture</span> (word)
  <span style="font-style: italic;">"Capture an english WORD as a org-mode entry suitable for org-drill.</span>

<span style="font-style: italic;">Capture URL or file currently visiting as well as a sentence at point."</span>
  (<span style="font-weight: bold;">interactive</span> (list (<span style="font-weight: bold;">if</span> (use-region-p)
                         (buffer-substring (region-beginning) (region-end))
                       (read-string <span style="font-style: italic;">"Phrase: "</span>))))
  (<span style="font-weight: bold;">let*</span> ((sentence-end-double-space nil)
         (org-english-word word)
         (match-entry (org-ql-select
                        (my/org-archive-files)
                        `(<span style="font-weight: bold;">and</span> (heading ,(format <span style="font-style: italic;">"%s"</span> word))
                              (tags <span style="font-style: italic;">"drill"</span>))
                        <span style="font-weight: bold;">:action</span> 'element-with-markers))
         (sentence
          (seq-reduce (<span style="font-weight: bold;">lambda</span> (s w)
                        (replace-regexp-in-string w (format <span style="font-style: italic;">"[%s||%c]"</span> w (string-to-char w))
                                                  s))
                      (split-string word <span style="font-style: italic;">" "</span>)
                      (sentence-at-point))))
    (kill-new (<span style="font-weight: bold;">if</span> (stringp sentence) sentence <span style="font-style: italic;">""</span>))
    (<span style="font-weight: bold;">cond</span>
     (match-entry (org-capture nil <span style="font-style: italic;">"!1"</span>))
     (t (org-capture nil <span style="font-style: italic;">"!0"</span>)))))

(<span style="font-weight: bold;">with-eval-after-load</span> 'org-ql-view
  (<span style="font-weight: bold;">push</span> '(<span style="font-style: italic;">"English phrase list"</span>
          <span style="font-weight: bold;">:buffers-files</span> my/org-archive-files
          <span style="font-weight: bold;">:query</span> (<span style="font-weight: bold;">and</span> (tags <span style="font-style: italic;">"drill"</span>)
                      (tags <span style="font-style: italic;">"fd_en"</span>)))
        org-ql-views))

(<span style="font-weight: bold;">with-eval-after-load</span> 'org-capture
  (add-to-list 'org-capture-templates
               '(<span style="font-style: italic;">"!0"</span> <span style="font-style: italic;">"drill entry for english word"</span>
                 entry (<span style="font-weight: bold;">function</span> org-goto-clocking-or-today)
                 <span style="font-style: italic;">"* %i :drill:fd_en:</span>
<span style="font-style: italic;">[%(my/org-english-insert-japanese-translation)]</span>
<span style="font-style: italic;">%(my/org-english-insert-english-translation)</span>
<span style="font-style: italic;">- %a</span>
<span style="font-style: italic;">  #+begin_quote</span>
<span style="font-style: italic;">%c</span>
<span style="font-style: italic;">  #+end_quote"</span>))
  (add-to-list 'org-capture-templates
               '(<span style="font-style: italic;">"!1"</span> <span style="font-style: italic;">"drill entry for english word"</span>
                 item(<span style="font-weight: bold;">function</span> my/org-english-goto-match)
                 <span style="font-style: italic;">"- %a</span>
<span style="font-style: italic;">  #+begin_quote</span>
<span style="font-style: italic;">%c</span>
<span style="font-style: italic;">  #+end_quote"</span>)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/org-english-goto-match</span> ()
  <span style="font-style: italic;">"Goto function for org-capture-template designed to insert an edditional example</span>
<span style="font-style: italic;">to existing english word entry."</span>
  (org-goto-marker-or-bmk
   (plist-get (cadar match-entry) <span style="font-weight: bold;">:org-marker</span>)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/org-english-insert-english-translation</span> ()
  <span style="font-style: italic;">"Insert English translation into org capture entry."</span>
  (<span style="font-weight: bold;">let*</span> ((url (format <span style="font-style: italic;">"http://wordnik.com/words/%s"</span> (downcase org-english-word)))
         (buffer (url-retrieve-synchronously url t t))
         (vertico-sort-function nil))
    (<span style="font-weight: bold;">with-temp-buffer</span>
      (url-insert-buffer-contents buffer url)
      (completing-read <span style="font-style: italic;">"match"</span> (split-string (funcall 'my/define-word--parse-wordnik) <span style="font-style: italic;">"\n"</span>)))))

(advice-add #'my/org-english-insert-english-translation <span style="font-weight: bold;">:around</span> #'my/define-word--fix-31)

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/org-english-insert-japanese-translation</span> ()
  <span style="font-style: italic;">"Insert Japanese translation into org capture entry."</span>
  (<span style="font-weight: bold;">let*</span> ((url (format <span style="font-style: italic;">"https://ejje.weblio.jp/content/%s"</span> (downcase org-english-word)))
         (buffer (url-retrieve-synchronously url t t)))
    (<span style="font-weight: bold;">with-temp-buffer</span>
      (url-insert-buffer-contents buffer url)
      (funcall 'my/define-word--parse-weblio))))

(<span style="font-weight: bold;">defmacro</span> <span style="font-weight: bold;">with-org-drill-english-config</span> (<span style="font-weight: bold; text-decoration: underline;">&amp;rest</span> body)
  <span style="font-style: italic;">"Evaluate BODY with config for Org-Drill for english words review."</span>
  `(<span style="font-weight: bold;">progn</span>
     (<span style="font-weight: bold;">let</span> ((org-drill-scope (append '(<span style="font-style: italic;">"~/org/agenda/life.org"</span>)
                                    (seq-remove
                                     (<span style="font-weight: bold;">lambda</span> (item)
                                       (string-match <span style="font-style: italic;">"archive_</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">[[:digit:]]\\{4\\}</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">.org"</span> item)
                                       (&lt; (string-to-number (match-string 1 item)) 2019))
                                     (file-expand-wildcards <span style="font-style: italic;">"~/org/archive/archive_*.org"</span>))))
           (org-drill-question-tag <span style="font-style: italic;">"drill"</span>)
           (org-drill-maximum-items-per-session 25)
           (org-drill-hide-item-headings-p t)
           (org-startup-indented nil))
       (global-visual-line-mode 1)
       (org-indent-mode -1)
       ,@body)
     (global-visual-line-mode 0)
     (org-indent-mode 1)
     (org-save-all-org-buffers)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/org-english-drill</span> ()
  <span style="font-style: italic;">"Invoke Org-Drill for English word review."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (with-org-drill-english-config (org-drill)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/org-english-drill-resume</span> ()
  <span style="font-style: italic;">"Resume Org-Drill session for english word review."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (with-org-drill-english-config (org-drill-resume)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/org-english-drill-nontrivial</span> ()
  <span style="font-style: italic;">""</span>
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">let</span> ((org-drill-match <span style="font-style: italic;">"-trivial"</span>))
    (with-org-drill-english-config (org-drill))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/org-english-drill-new</span> ()
  <span style="font-style: italic;">""</span>
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">let</span> ((org-drill-match <span style="font-style: italic;">"-DRILL_TOTAL_REPEATS&gt;0"</span>))
    (with-org-drill-english-config (org-drill))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/org-english-drill-test-display</span> ()
  <span style="font-style: italic;">"Show Org-Drill entry in the same way as english drill session."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (with-org-drill-english-config (org-drill-test-display)))

(<span style="font-weight: bold;">provide</span> '<span style="font-weight: bold; text-decoration: underline;">my/org-english</span>)
</pre>
</div>
</div>
</li>

<li><a id="orgc362d94"></a>org-password-store<br />
<div class="outline-text-6" id="text-orgc362d94">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">password-store</span>)

(<span style="font-weight: bold;">defcustom</span> <span style="font-weight: bold; font-style: italic;">my/org-password-store-property</span> <span style="font-style: italic;">"PASSWORD_STORE"</span>
  <span style="font-style: italic;">"Property used in my/password-store feature to get password-store entry name attached to current org entry."</span>)

(<span style="font-weight: bold;">defmacro</span> <span style="font-weight: bold;">with-password-store-entry</span> (entry <span style="font-weight: bold; text-decoration: underline;">&amp;rest</span> body)
  <span style="font-style: italic;">"Eval BODY which can refer password-store ENTRY.."</span>
  (<span style="font-weight: bold;">declare</span> (indent defun))
  `(<span style="font-weight: bold;">let</span> ((entry (<span style="font-weight: bold;">or</span> ,entry
                    (<span style="font-weight: bold;">when</span> (derived-mode-p 'org-mode) (org-entry-get (point) my/org-password-store-property))
                    (password-store--completing-read t))))
     ,@body))

(<span style="font-weight: bold;">defmacro</span> <span style="font-weight: bold;">with-password-store-entry-field</span> (entry field <span style="font-weight: bold; text-decoration: underline;">&amp;rest</span> body)
  <span style="font-style: italic;">"Eval BODY which can refer password-store ENTRY and FIELD..</span>

<span style="font-style: italic;">Plus, OBDY can refer value of FIELD named field-value."</span>
  (<span style="font-weight: bold;">declare</span> (indent defun))
  `(<span style="font-weight: bold;">let*</span> ((entry (<span style="font-weight: bold;">or</span> ,entry
                     (<span style="font-weight: bold;">when</span> (derived-mode-p 'org-mode) (org-entry-get (point) my/org-password-store-property))
                     (password-store--completing-read t)))
          (field (<span style="font-weight: bold;">or</span> ,field
                     (password-store-read-field entry)))
          (field-value (password-store-get-field entry field)))
     ,@body))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/password-store-copy</span> ()
  <span style="font-style: italic;">"Add password for ENTRY into the kill ring.</span>

<span style="font-style: italic;">`</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">password-store-copy</span><span style="font-style: italic;">' is responsible for managing the kill ring."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (with-password-store-entry nil
    (password-store-copy entry)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/password-store-copy-field</span> ()
  <span style="font-style: italic;">"Add field for entry into the kill ring.</span>

<span style="font-style: italic;">entry and field is determined by appropriate manner."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (with-password-store-entry-field nil nil
    (password-store-copy-field entry field)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/password-store-url</span> (<span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> arg)
  <span style="font-style: italic;">"Browse url stored in entry by appropriate manner determined by ARG."</span>
  (<span style="font-weight: bold;">interactive</span> <span style="font-style: italic;">"P"</span>)
  (with-password-store-entry-field nil <span style="font-style: italic;">"url"</span>
    (<span style="font-weight: bold;">cl-case</span> (prefix-numeric-value arg)
      (16 (browse-url field-value))
      (4 (eww-browse-url field-value))
      (t (open-url field-value)))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/password-store-show-field</span> ()
  <span style="font-style: italic;">"Show a field value in the minibuffer.</span>

<span style="font-style: italic;">Password-store entry and field used to derive this value are from org property</span>
<span style="font-style: italic;">or selected by user."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (with-password-store-entry-field nil nil
    (message <span style="font-style: italic;">"%s: %s"</span> field field-value)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/password-store-create</span> ()
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">let*</span> ((input (read-string <span style="font-style: italic;">"Entry-name or URL: "</span>))
         (domain (<span style="font-weight: bold;">when</span> (string-match-p browse-url-button-regexp input)
                   (string-trim-right
                    (shell-command-to-string (format <span style="font-style: italic;">"echo %s | awk -F[/:] '{print $4}'"</span>
                                                     (shell-quote-argument input)))))))
    (with-password-store-entry (<span style="font-weight: bold;">cond</span>
                                ((&gt; (length domain) 0) domain)
                                (input))
      (<span style="font-weight: bold;">when</span> (derived-mode-p 'org-mode)
        (org-entry-put (point) my/org-password-store-property entry))
      (password-store-edit entry))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/password-store-edit</span> ()
  (<span style="font-weight: bold;">interactive</span>)
  (with-password-store-entry nil
    (password-store-edit entry)))

<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">TODO: make my/password-store-insert as soon after</span>
<span style="font-weight: bold; font-style: italic;">;;     </span><span style="font-weight: bold; font-style: italic;">: password-store--run-insert has been implemented</span>

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/password-store-remove</span> ()
  (<span style="font-weight: bold;">interactive</span>)
  (with-password-store-entry nil
    (password-store-remove entry)
    (<span style="font-weight: bold;">when</span> (derived-mode-p 'org-mode)
      (org-entry-delete (point) my/org-password-store-property))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/password-store-web-login</span> ()
  (<span style="font-weight: bold;">interactive</span>)
  (with-password-store-entry-field nil <span style="font-style: italic;">"username"</span>
    (password-store-copy entry)
    (sleep-for 0.2) <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">work around for overlapping message</span>
    (<span style="font-weight: bold;">if</span> field-value
        (message <span style="font-style: italic;">"%s: %s"</span> field field-value)
      (message (string-trim-right
                (concat
                 (when-let ((email (assoc <span style="font-style: italic;">"email"</span> (password-store-parse-entry entry))))
                   (format <span style="font-style: italic;">"%s: %s\n"</span> (car email) (cdr email)))
                 (when-let ((second (nth 1 (password-store-parse-entry entry))))
                   (format <span style="font-style: italic;">"%s: %s\n"</span> (car second) (cdr second)))))))
    (sleep-for 3)
    (funcall-interactively #'my/password-store-url '(16))))

(advice-add #'password-store-clear <span style="font-weight: bold;">:before</span> #'my/password-store-clear)

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/password-store-clear</span> (<span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> field)
  <span style="font-style: italic;">"Overwrite clipboard data so that password once saved in clipboard is deleted</span>
<span style="font-style: italic;"> for security risk.</span>

<span style="font-style: italic;">FIELD originally for messaging is ignored in this function."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">when</span> password-store-kill-ring-pointer
    (kill-new <span style="font-style: italic;">""</span>)
    (setcar kill-ring-yank-pointer <span style="font-style: italic;">""</span>)))

(<span style="font-weight: bold;">with-eval-after-load</span> 'hydra
  (defhydra hydra-password-store (global-map <span style="font-style: italic;">"C-o p"</span>
                                             <span style="font-weight: bold;">:color</span> teal)
    <span style="font-style: italic;">"Password store"</span>
    (<span style="font-style: italic;">"cc"</span> my/password-store-copy)
    (<span style="font-style: italic;">"cf"</span> my/password-store-copy-field)
    (<span style="font-style: italic;">"s"</span> my/password-store-show-field)
    (<span style="font-style: italic;">"w"</span> my/password-store-url)
    (<span style="font-style: italic;">"l"</span> my/password-store-web-login)
    (<span style="font-style: italic;">"n"</span> my/password-store-create)
    (<span style="font-style: italic;">"e"</span> my/password-store-edit)
    (<span style="font-style: italic;">"v"</span> my/password-store-edit)
    (<span style="font-style: italic;">"k"</span> my/password-store-remove)
    (<span style="font-style: italic;">"q"</span> nil <span style="font-style: italic;">"quit"</span>)))
</pre>
</div>
</div>
</li>

<li><a id="org5cc64e2"></a>org-archive<br />
<div class="outline-text-6" id="text-org5cc64e2">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">org</span>)
(<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">org-agenda</span>)

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/org-archive-file</span> (<span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> year)
  <span style="font-style: italic;">"Return a path of archive file.</span>

<span style="font-style: italic;">If optional argument `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">YEAR</span><span style="font-style: italic;">' is passed that year's file is returned instead of current year's."</span>
  (<span style="font-weight: bold;">let*</span> ((record-year (<span style="font-weight: bold;">or</span> year (ts-year (ts-now))))
         (record-file-cand (format <span style="font-style: italic;">"%s/archive/archive_%s.org"</span> org-directory record-year))
         (record-file
          (<span style="font-weight: bold;">if</span> (file-exists-p record-file-cand)
              record-file-cand
            (expand-file-name <span style="font-style: italic;">"archive/archive_0000.org"</span> org-directory))))
    (<span style="font-weight: bold;">if</span> (<span style="font-weight: bold;">or</span> (file-exists-p record-file)
            (file-symlink-p record-file))
        record-file
      nil)))

(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my/org-archive-file</span> (my/org-archive-file))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/org-archive-files</span> ()
  <span style="font-style: italic;">"Return list of archive files."</span>
  (append (directory-files (expand-file-name <span style="font-style: italic;">"archive"</span> org-directory) t <span style="font-style: italic;">"archive_[[:digit:]]\\{4\\}\\.org"</span> nil)
          org-agenda-files))

(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my/org-archive-files</span> (my/org-archive-files))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/org-archive-find-date</span> (date)
  <span style="font-style: italic;">"Find and visit the location of DATE in archivee file.</span>

<span style="font-style: italic;">DATE must be a string representing the date to find and parsable with `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">format-time-string</span><span style="font-style: italic;">'.</span>

<span style="font-style: italic;">If called interactively, it prompt the user to select the date to find."</span>
  (<span style="font-weight: bold;">interactive</span>
   (<span style="font-weight: bold;">cond</span>
    ((eq major-mode 'calendar-mode)
     (list (calendar-date-string (calendar-cursor-to-date))))
    ((eq major-mode 'org-agenda-mode)
     (<span style="font-weight: bold;">let*</span> ((day (<span style="font-weight: bold;">or</span> (get-text-property (min (1- (point-max)) (point)) 'day)
                     (<span style="font-weight: bold;">user-error</span> <span style="font-style: italic;">"Don't know which date to open in calendar"</span>)))
            (date (calendar-gregorian-from-absolute day)))
       (list (calendar-date-string date))))
    (t (<span style="font-weight: bold;">let</span> ((date-select (org-read-date)))
         (list date-select)))))
  (<span style="font-weight: bold;">let*</span> ((d (parse-time-string date))
         (day (decoded-time-day d))
         (month (decoded-time-month d))
         (year (decoded-time-year d)))
    (find-file (my/org-archive-file year))
    (org-datetree-find-iso-week-create `(,month ,day ,year))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/org-archive-subtree</span> ()
  <span style="font-style: italic;">"Refile current subtree to archive file using latest timestamp."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">let*</span> ((ts (car (sort (org-timestamps-in-entry) #'ts&gt;)))
         (year (ts-year (<span style="font-weight: bold;">or</span> ts (ts-now))))
         (save-file (my/org-archive-file year))
         (tags (org-get-local-tags))
         (todo (org-get-todo-state)))
    (when-let* ((pos (<span style="font-weight: bold;">with-current-buffer</span> (find-file-noselect save-file)
                       (<span style="font-weight: bold;">save-excursion</span>
                         (<span style="font-weight: bold;">if</span> (<span style="font-weight: bold;">and</span> (member <span style="font-style: italic;">"web"</span> tags)
                                  (not (member todo '(<span style="font-style: italic;">"DN"</span> <span style="font-style: italic;">"PD"</span>))))
                             (org-find-exact-headline-in-buffer <span style="font-style: italic;">"untouched items"</span>)
                           (org-datetree-find-iso-week-create `(,(ts-month ts)
                                                                ,(ts-day ts)
                                                                ,(ts-year ts)))
                           (point))))))
      (org-refile nil nil (list nil save-file nil pos)))
    (org-save-all-org-buffers)
    (<span style="font-weight: bold;">setq</span> this-command 'my/org-archive-subtree)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/org-agenda-archive-subtree</span> ()
  <span style="font-style: italic;">"Refile the entry or subtree belonging to the current agenda entry."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (org-agenda-archive-with 'my/org-archive-subtree))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/org-ql-view-archive-subtree</span> ()
  <span style="font-style: italic;">"Refile the entry or subtree belonging to the current agenda entry."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (org-agenda-archive-with 'my/org-archive-subtree)
  (org-ql-view-refresh))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/org-archive-search</span> (query)
  <span style="font-style: italic;">"Search org entries matched QUERY in archive files using `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">org-ql-search</span><span style="font-style: italic;">'."</span>
  (<span style="font-weight: bold;">interactive</span> (list (read-string <span style="font-style: italic;">"Query: "</span>)))
  (<span style="font-weight: bold;">let</span> ((files (my/org-archive-files)))
    (org-ql-search files query)))

(bind-keys <span style="font-weight: bold;">:map</span> org-agenda-mode-map
           (<span style="font-style: italic;">"$"</span> . my/org-agenda-archive-subtree)
           (<span style="font-style: italic;">"C"</span> . my/org-archive-find-date)
           <span style="font-weight: bold;">:map</span> org-ql-view-map
           (<span style="font-style: italic;">"$"</span> . my/org-ql-view-archive-subtree)
           <span style="font-weight: bold;">:map</span> calendar-mode-map
           (<span style="font-style: italic;">"C"</span> . my/org-archive-find-date))

(<span style="font-weight: bold;">push</span> '(<span style="font-style: italic;">"Archive entries"</span> . my/org-archive-search)
      org-ql-views)

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/lookup-org-archive</span> (word <span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> arg)
  <span style="font-style: italic;">"Look up WORD in my archive files using `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">org-ql-search</span><span style="font-style: italic;">'."</span>
  (<span style="font-weight: bold;">interactive</span> (list (<span style="font-weight: bold;">if</span> (use-region-p)
                         (buffer-substring (region-beginning) (region-end))
                       (read-string <span style="font-style: italic;">"Word: "</span>))
                     current-prefix-arg))
  (org-ql-search
    my/org-archive-files
    (<span style="font-weight: bold;">cond</span>
     ((equal arg '(4)) `(heading ,word))
     (t `(regexp ,word)))))

<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">TODO: This function can be rewritten with org-ml</span>
<span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">org-timestamps-in-entry</span> ()
  <span style="font-style: italic;">"Return timestamp objects for all Org timestamps in entry."</span>
  (<span style="font-weight: bold;">interactive</span> (list current-prefix-arg))
  (<span style="font-weight: bold;">save-excursion</span>
    (goto-char (org-entry-beginning-position))
    (org-show-entry)
    (org-narrow-to-element)
    (<span style="font-weight: bold;">let*</span> ((parsetree (org-element-parse-buffer))
           (ts-list nil))
      (org-element-map parsetree '(planning clock timestamp)
        (<span style="font-weight: bold;">lambda</span> (elm)
          (<span style="font-weight: bold;">cl-case</span> (org-element-type elm)
            ('planning
             (add-to-list 'ts-list (ts-parse-org-element (<span style="font-weight: bold;">or</span> (org-element-property <span style="font-weight: bold;">:closed</span> elm)
                                                             (org-element-property <span style="font-weight: bold;">:scheduled</span> elm)
                                                             (org-element-property <span style="font-weight: bold;">:deadline</span> elm)))
                          t))
            ('clock
             (add-to-list 'ts-list (ts-parse-org-element (org-element-property <span style="font-weight: bold;">:value</span> elm)) t))
            ('timestamp
             (add-to-list 'ts-list (ts-parse-org-element elm) t)))))
      (widen)
      ts-list)))

(<span style="font-weight: bold;">provide</span> '<span style="font-weight: bold; text-decoration: underline;">my/org-archive</span>)
</pre>
</div>
</div>
</li>

<li><a id="org05ad1af"></a>org-capture-derived<br />
<div class="outline-text-6" id="text-org05ad1af">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">thingatpt</span>)
(<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">whitespace</span>)

(<span style="font-weight: bold;">with-eval-after-load</span> 'org-capture
  (mapc (<span style="font-weight: bold;">lambda</span> (template)
          (add-to-list 'org-capture-templates
                       template))
        '((<span style="font-style: italic;">"x"</span> <span style="font-style: italic;">"actionable entry for manual input"</span>
           entry
           (<span style="font-weight: bold;">function</span> org-capture-derived-target-function)
           <span style="font-style: italic;">"* %(org-capture-derived-insert-todo)%? %(org-set-tags org-capture-derived-tags)\n%(org-capture-derived-insert-deadline)"</span>)
          (<span style="font-style: italic;">"X"</span> <span style="font-style: italic;">"Actionable entry for automated input"</span>
           entry
           (<span style="font-weight: bold;">function</span> org-capture-derived-target-function)
           <span style="font-style: italic;">"* %(org-capture-derived-insert-todo)%a %(org-set-tags org-capture-derived-tags)\n%(org-capture-derived-insert-deadline)"</span>
           <span style="font-weight: bold;">:immediate-finish</span> t))))

(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">org-capture-derived-todo</span> nil
  <span style="font-style: italic;">"Todo state to be set to an org entry which org-capture-derived creates.</span>

<span style="font-style: italic;">User should set this value locally, otherwise unexpected results occur."</span>)
(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">org-capture-derived-tags</span> nil
  <span style="font-style: italic;">"Tags represented with colon(:) to be set to an org entry which org-capture-derived creates.</span>

<span style="font-style: italic;">User should set this value locally, otherwise unexpected results occur."</span>)
(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">org-capture-derived-target</span> nil <span style="font-style: italic;">"docstring"</span>)
(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">org-capture-derived-deadline-in-day</span> nil <span style="font-style: italic;">"docstring"</span>)

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">org-capture-derived-target-function</span> ()
  <span style="font-style: italic;">""</span>
  (<span style="font-weight: bold;">cond</span>
   ((listp org-capture-derived-target)
    (set-buffer (org-capture-target-buffer (nth 1 org-capture-derived-target)))
    (org-capture-put-target-region-and-position)
    (widen)
    (goto-char (nth 3 org-capture-derived-target)))
   ((<span style="font-weight: bold;">and</span> (stringp org-capture-derived-target)
         (string-match-p thing-at-point-uuid-regexp org-capture-derived-target))
    (org-id-goto org-capture-derived-target))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">org-capture-derived</span> (<span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> arg)
  <span style="font-style: italic;">"C-u user is asked for all arguments</span>
<span style="font-style: italic;">C-u C-u create manually"</span>
  (<span style="font-weight: bold;">interactive</span> <span style="font-style: italic;">"P"</span>)
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">insert ID property unless existing</span>
  (<span style="font-weight: bold;">cond</span>
   ((<span style="font-weight: bold;">and</span> (eq major-mode 'org-mode)
         (not (equal arg '(16))))
    (org-id-get nil t)))
  (<span style="font-weight: bold;">let*</span> ((todo-in-org
          (<span style="font-weight: bold;">when</span> (derived-mode-p 'org-mode)
            (org-entry-get (point) <span style="font-style: italic;">"DERIVED_TODO"</span> t)))
         (org-capture-derived-todo
          (<span style="font-weight: bold;">or</span> todo-in-org
              org-capture-derived-todo))
         (tags-in-org
          (<span style="font-weight: bold;">when</span> (derived-mode-p 'org-mode)
            (org-entry-get (point) <span style="font-style: italic;">"DERIVED_TAGS"</span> t)))
         (org-capture-derived-tags
          (<span style="font-weight: bold;">or</span> (<span style="font-weight: bold;">when</span> (not (equal arg '(4)))
                (<span style="font-weight: bold;">or</span> tags-in-org
                    org-capture-derived-tags))
              (read-string <span style="font-style: italic;">"Tags: "</span> tags-in-org)))
         (target-in-org
          (<span style="font-weight: bold;">when</span> (derived-mode-p 'org-mode)
            (org-entry-get (point) <span style="font-style: italic;">"DERIVED_TARGET"</span> t)))
         (org-capture-derived-target
          (<span style="font-weight: bold;">or</span> (<span style="font-weight: bold;">when</span> (not (equal arg '(4)))
                (<span style="font-weight: bold;">or</span> target-in-org
                    org-capture-derived-target))
              (org-refile-get-location)))
         (deadline-str-in-org
          (<span style="font-weight: bold;">when</span> (derived-mode-p 'org-mode)
            (org-entry-get (point) <span style="font-style: italic;">"DERIVED_DEADLINE_IN_DAY"</span> t)))
         (deadline-num-in-org
          (<span style="font-weight: bold;">if</span> (stringp deadline-str-in-org) (string-to-number deadline-str-in-org) nil))
         (org-capture-derived-deadline-in-day
          (<span style="font-weight: bold;">if</span> (equal arg '(4))
              (read-number <span style="font-style: italic;">"Deadline in day: "</span>
                           deadline-num-in-org)
            (<span style="font-weight: bold;">or</span> deadline-num-in-org
                org-capture-derived-deadline-in-day))))
    (<span style="font-weight: bold;">if</span> (equal arg '(16))
        (org-capture nil <span style="font-style: italic;">"x"</span>)
      (org-capture nil <span style="font-style: italic;">"X"</span>))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">org-capture-derived-insert-todo</span> ()
  <span style="font-style: italic;">""</span>
  (<span style="font-weight: bold;">if</span> (stringp org-capture-derived-todo)
      (<span style="font-weight: bold;">if</span> (string-match-p whitespace-trailing-regexp
                          org-capture-derived-todo)
          org-capture-derived-todo
        (format <span style="font-style: italic;">"%s "</span> org-capture-derived-todo))
    <span style="font-style: italic;">""</span>))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">org-capture-derived-insert-deadline</span> ()
  <span style="font-style: italic;">""</span>
  (<span style="font-weight: bold;">if</span> (numberp org-capture-derived-deadline-in-day)
      (<span style="font-weight: bold;">let</span> ((week-ahead (encode-time
                         (seq-map-indexed (<span style="font-weight: bold;">lambda</span> (element index)
                                            (<span style="font-weight: bold;">if</span> (= index 3)
                                                (+ element org-capture-derived-deadline-in-day)
                                              element))
                                          (decode-time (current-time))))))
        (format-time-string <span style="font-style: italic;">"DEADLINE: &lt;%Y-%m-%d %a&gt;"</span> week-ahead))
    <span style="font-style: italic;">""</span>))
</pre>
</div>
</div>
</li>

<li><a id="orge3ae2a1"></a>org-relate<br />
<div class="outline-text-6" id="text-orge3ae2a1">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">thingatpt</span>)
(<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">org-ql-search</span>)

(<span style="font-weight: bold;">defconst</span> <span style="font-weight: bold; font-style: italic;">org-relate-property</span> <span style="font-style: italic;">"PARENT"</span>
  <span style="font-style: italic;">"Property name for child nodes to look up parent node."</span>)
(<span style="font-weight: bold;">defcustom</span> <span style="font-weight: bold; font-style: italic;">org-relate-parent-tag-list</span>
  '(<span style="font-style: italic;">"project"</span> <span style="font-style: italic;">"refile"</span>)
  <span style="font-style: italic;">"A list of tags all parent nodes must have one of them."</span>)
(<span style="font-weight: bold;">defcustom</span> <span style="font-weight: bold; font-style: italic;">org-relate-target-files</span>
  (directory-files-recursively org-directory <span style="font-style: italic;">"\\.org$"</span>)
  <span style="font-style: italic;">"A list of target files to search relation nodes."</span>)

(<span style="font-weight: bold;">with-eval-after-load</span> 'org
  (bind-key <span style="font-style: italic;">"C-c %"</span> #'org-relate-search
            org-mode-map))

(<span style="font-weight: bold;">with-eval-after-load</span> 'org-keys
  (<span style="font-weight: bold;">setf</span> (map-elt org-speed-commands <span style="font-style: italic;">"%"</span>) #'org-relate-search)
  (<span style="font-weight: bold;">setf</span> (map-elt org-speed-commands <span style="font-style: italic;">"&amp;"</span>) #'org-relate-interrelate)
  (<span style="font-weight: bold;">push</span> '(<span style="font-style: italic;">"Org-Relate Operation"</span>) org-speed-commands))

(<span style="font-weight: bold;">with-eval-after-load</span> 'org-agenda
  (bind-keys <span style="font-weight: bold;">:map</span> org-agenda-mode-map
             (<span style="font-style: italic;">"&amp;"</span> . org-agenda-relation-interrelate)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">org-relate-search</span> ()
  <span style="font-style: italic;">"Search for entries related to the entry at point.</span>

<span style="font-style: italic;">User who would like to search for parent and children of that, namely siblings,</span>
<span style="font-style: italic;"> must press 'p'.</span>
<span style="font-style: italic;">User who would like to search for children of this entry must press 'c'.</span>
<span style="font-style: italic;">User who would like to search for friends either pointing to this entry</span>
<span style="font-style: italic;"> or pointed from this entry must be press 'f'.</span>
<span style="font-style: italic;">User who would like to search for all listed above must press 'a'."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">let*</span> ((org-super-agenda-properties-inherit nil)
         (char (read-char-from-minibuffer <span style="font-style: italic;">"Target: [a]ll [p]arent [c]hild [f]riend"</span>))
         (queries (seq-remove 'null
                              (<span style="font-weight: bold;">cond</span>
                               ((equal char ?a) (list (org-relate--search-parent-org-ql-query)
                                                      (org-relate--search-children-org-ql-query)
                                                      (org-relate--search-friends-refer-org-ql-query)
                                                      (org-relate--search-friends-referred-org-ql-query)
                                                      (org-relate--search-siblings-org-ql-query)))
                               ((equal char ?p) (list (org-relate--search-parent-org-ql-query)
                                                      (org-relate--search-siblings-org-ql-query)))
                               ((equal char ?c) (list (org-relate--search-children-org-ql-query)))
                               ((equal char ?f) (list (org-relate--search-friends-refer-org-ql-query)
                                                      (org-relate--search-friends-referred-org-ql-query)))))))
    (<span style="font-weight: bold;">if</span> queries
        (org-ql-search org-relate-target-files
          (seq-reduce (<span style="font-weight: bold;">lambda</span> (accum elem)
                        (<span style="font-weight: bold;">push</span> elem (cdr (last accum)))
                        accum)
                      (mapcar 'car queries)
                      '(<span style="font-weight: bold;">or</span>))
          <span style="font-weight: bold;">:super-groups</span> (mapcar 'cdr queries))
      (message <span style="font-style: italic;">"No query found"</span>))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">org-relate--search-children-org-ql-query</span> ()
  (when-let* ((id (org-id-get))
              (rel-prop-link (format <span style="font-style: italic;">"[[id:%s]]"</span> id)))
    `((<span style="font-weight: bold;">or</span> (property ,org-relate-property ,id)
          (property ,org-relate-property ,rel-prop-link)) <span style="font-weight: bold;">.</span>
          (<span style="font-weight: bold;">:name</span> <span style="font-style: italic;">"Children"</span> <span style="font-weight: bold;">:property</span> (,org-relate-property ,id)))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">org-relate--search-parent-org-ql-query</span> ()
  (if-let* ((prop-ref (org-entry-get (point) org-relate-property))
            (index (string-match (format <span style="font-style: italic;">"</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">%s</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">"</span> thing-at-point-uuid-regexp) prop-ref))
            (parent-id (match-string 0 prop-ref)))
      `((property <span style="font-style: italic;">"ID"</span> ,parent-id) .
        (<span style="font-weight: bold;">:name</span> <span style="font-style: italic;">"Parent"</span> <span style="font-weight: bold;">:property</span> (<span style="font-style: italic;">"ID"</span> ,parent-id)))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">org-relate--search-siblings-org-ql-query</span> ()
  (if-let* ((prop-ref (org-entry-get (point) org-relate-property))
            (index (string-match (format <span style="font-style: italic;">"</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">%s</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">"</span> thing-at-point-uuid-regexp) prop-ref))
            (parent-id (match-string 0 prop-ref))
            (parent-id-link (format <span style="font-style: italic;">"[[id:%s]]"</span> parent-id)))
      `((<span style="font-weight: bold;">or</span> (property ,org-relate-property ,parent-id)
            (property ,org-relate-property ,parent-id-link)) <span style="font-weight: bold;">.</span>
            (<span style="font-weight: bold;">:name</span> <span style="font-style: italic;">"Siblings"</span> <span style="font-weight: bold;">:property</span> (,org-relate-property ,parent-id)))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">org-relate--search-friends-refer-org-ql-query</span> ()
  (when-let* ((id (org-id-get))
              (ref-re (format <span style="font-style: italic;">"\\[\\[</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">id:%s\\</span><span style="font-style: italic;">].*\\]"</span> id)))
    `((regexp ,ref-re) .
      (<span style="font-weight: bold;">:name</span> <span style="font-style: italic;">"Friends pointing to this entry"</span> <span style="font-weight: bold;">:regexp</span> ,ref-re))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">org-relate--search-friends-referred-org-ql-query</span> ()
  (<span style="font-weight: bold;">let*</span> ((id-link-re (format <span style="font-style: italic;">"\\[\\[id:</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">%s</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">\\].*\\]"</span> thing-at-point-uuid-regexp))
         (end (<span style="font-weight: bold;">or</span> (<span style="font-weight: bold;">save-excursion</span>
                    (outline-next-heading))
                  (point-max))))
    (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">save-excursion</span>
            (re-search-forward id-link-re end t))
      `((property <span style="font-style: italic;">"ID"</span> ,(match-string 1)) .
        (<span style="font-weight: bold;">:name</span> <span style="font-style: italic;">"Friends to whom this entry is pointing"</span> <span style="font-weight: bold;">:property</span> (<span style="font-style: italic;">"ID"</span> ,(match-string 1)))))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">org-relate-interrelate</span> ()
  <span style="font-style: italic;">"Make parent-child relationship by inserting property.</span>

<span style="font-style: italic;">This command must be called in parent node which should have one of `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">org-relate-parent-tag-list</span><span style="font-style: italic;">'."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">save-excursion</span>
    (org-back-to-heading)
    (<span style="font-weight: bold;">if</span> (cl-some (<span style="font-weight: bold;">lambda</span> (parent-tag)
                   (member parent-tag (org-get-tags)))
                 org-relate-parent-tag-list)
        (<span style="font-weight: bold;">let</span> ((ref-id (org-id-get-create)))
          (<span style="font-weight: bold;">and</span> (org-goto-first-child)
               (<span style="font-weight: bold;">cl-labels</span> ((set-ref-id-to-siblings
                            (ref-link)
                            (org-set-property org-relate-property ref-link)
                            (<span style="font-weight: bold;">and</span> (org-goto-sibling)
                                 (set-ref-id-to-siblings ref-link))))
                 (set-ref-id-to-siblings ref-id)))
          (message <span style="font-style: italic;">"Interrelated has done."</span>))
      (message <span style="font-style: italic;">"This entry does not compliant with 'org-relate-parent-tag-list"</span>))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">org-agenda-relation-interrelate</span> ()
  <span style="font-style: italic;">"Invoke `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">org-relate-interrelate</span><span style="font-style: italic;">' in agenda view."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (org-agenda-check-no-diary)
  (<span style="font-weight: bold;">let*</span> ((hdmarker (<span style="font-weight: bold;">or</span> (org-get-at-bol 'org-hd-marker)
                       (org-agenda-error)))
         (buffer (marker-buffer hdmarker))
         (pos (marker-position hdmarker))
         (inhibit-read-only t)
         newhead)
    (<span style="font-weight: bold;">org-with-remote-undo</span> buffer
      (<span style="font-weight: bold;">with-current-buffer</span> buffer
        (widen)
        (goto-char pos)
        (org-show-context 'agenda)
        (call-interactively 'org-relate-interrelate)
        (end-of-line 1)
        (<span style="font-weight: bold;">setq</span> newhead (org-get-heading))))))

(<span style="font-weight: bold;">provide</span> '<span style="font-weight: bold; text-decoration: underline;">org-relate</span>)
</pre>
</div>
</div>
</li>

<li><a id="orga80bf32"></a>clocktable-by-tag with org-clock<br />
<div class="outline-text-6" id="text-orga80bf32">
<p>
Provide a function to Build a clock table summing up time by tag.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">org-table</span>)
(<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">org-clock</span>)

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">clocktable-by-tag/shift-cell</span> (n)
  (<span style="font-weight: bold;">let</span> ((str <span style="font-style: italic;">""</span>))
    (<span style="font-weight: bold;">dotimes</span> (i n)
      (<span style="font-weight: bold;">setq</span> str (concat str <span style="font-style: italic;">"| "</span>)))
    str))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">clocktable-by-tag/insert-tag</span> (params)
  (<span style="font-weight: bold;">let</span> ((match (plist-get params <span style="font-weight: bold;">:match</span>)))
    (insert <span style="font-style: italic;">"|--\n"</span>)
    (insert (format <span style="font-style: italic;">"| %s | *Tag time* |\n"</span> match))
    (<span style="font-weight: bold;">let</span> ((total 0))
      (mapcar
       (<span style="font-weight: bold;">lambda</span> (file)
         (<span style="font-weight: bold;">let</span> ((clock-data (<span style="font-weight: bold;">with-current-buffer</span> (find-file-noselect file)
                             (org-clock-get-table-data (buffer-name) params))))
           (<span style="font-weight: bold;">when</span> (&gt; (nth 1 clock-data) 0)
             (<span style="font-weight: bold;">setq</span> total (+ total (nth 1 clock-data)))
             (insert (format <span style="font-style: italic;">"| | File *%s* | %.2f |\n"</span>
                             (file-name-nondirectory file)
                             (/ (nth 1 clock-data) 60.0)))
             (<span style="font-weight: bold;">dolist</span> (entry (nth 2 clock-data))
               (insert (format <span style="font-style: italic;">"| | . %s%s | %s %.2f |\n"</span>
                               (org-clocktable-indent-string (nth 0 entry))
                               (replace-regexp-in-string <span style="font-style: italic;">"|"</span> <span style="font-style: italic;">"\\vert</span><span style="font-weight: bold; font-style: italic;">\</span><span style="font-style: italic;">{</span><span style="font-weight: bold; font-style: italic;">\</span><span style="font-style: italic;">}"</span> (nth 1 entry) nil t)
                               (clocktable-by-tag/shift-cell (nth 0 entry))
                               (/ (nth 4 entry) 60.0)))))))
       (org-agenda-files))
      (<span style="font-weight: bold;">if</span> (= total 0)
          (<span style="font-weight: bold;">save-excursion</span>
            (re-search-backward <span style="font-style: italic;">"*Tag time*"</span>)
            (forward-line -1)
            (<span style="font-weight: bold;">dotimes</span> (i 2)
              (org-table-kill-row)))
        (<span style="font-weight: bold;">save-excursion</span>
          (re-search-backward <span style="font-style: italic;">"*Tag time*"</span>)
          (org-table-next-field)
          (org-table-blank-field)
          (insert (format <span style="font-style: italic;">"*%.2f*"</span> (/ total 60.0))))))
    (org-table-align)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">org-dblock-write:clocktable-by-tag</span> (params)
  (funcall indent-line-function)
  (insert <span style="font-style: italic;">"| Tag | Headline | Time (h) |\n"</span>)
  (insert <span style="font-style: italic;">"|     |          | &lt;r&gt;  |\n"</span>)
  (<span style="font-weight: bold;">let</span> ((matches
         (org-global-tags-completion-table)))
    (mapcar (<span style="font-weight: bold;">lambda</span> (match)
              (<span style="font-weight: bold;">let</span> ((match-str (car match)))
                (<span style="font-weight: bold;">when</span> (string= (substring match-str 0 3) <span style="font-style: italic;">"AC_"</span>)
                  (<span style="font-weight: bold;">setq</span> params (plist-put params <span style="font-weight: bold;">:match</span> match-str))
                  (clocktable-by-tag/insert-tag params))))
            matches)))

(<span style="font-weight: bold;">provide</span> '<span style="font-weight: bold; text-decoration: underline;">clocktable-by-tag</span>)
</pre>
</div>
</div>
</li>

<li><a id="org6c4fc68"></a>narrow-dwim<br />
<div class="outline-text-6" id="text-org6c4fc68">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(bind-key* <span style="font-style: italic;">"C-x n"</span> 'my/toggle-narrow-dwim)

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/toggle-narrow-dwim</span> (arg)
  <span style="font-style: italic;">"If the buffer is narrowed, it widens. Otherwise, it narrows intelligently.</span>
<span style="font-style: italic;">Intelligently means: region, org-src-block, org-subtree, or defun,</span>
<span style="font-style: italic;">whichever applies first.</span>
<span style="font-style: italic;">Narrowing to org-src-block actually calls `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">org-edit-src-code</span><span style="font-style: italic;">'.</span>

<span style="font-style: italic;">With prefix ARG, don't widen, just narrow even if buffer is already narrowed."</span>
  (<span style="font-weight: bold;">interactive</span> <span style="font-style: italic;">"P"</span>)
  (<span style="font-weight: bold;">declare</span> (interactive-only))
  (<span style="font-weight: bold;">cond</span> ((<span style="font-weight: bold;">and</span> (buffer-narrowed-p) (not arg))
         (<span style="font-weight: bold;">when</span> (org-buffer-narrowed-p)
           (<span style="font-weight: bold;">when</span> org-startup-indented
             (org-indent-mode 1))
           (visual-line-mode -1)
           (adaptive-wrap-prefix-mode -1))
         (widen)
         (<span style="font-weight: bold;">setq-local</span> truncate-lines t))
        ((region-active-p)
         (narrow-to-region (region-beginning) (region-end)))
        ((<span style="font-weight: bold;">and</span> (boundp 'org-src-mode) org-src-mode (not arg))
         (org-edit-src-exit))
        ((<span style="font-weight: bold;">condition-case</span> err
             (org-edit-src-code)
           (<span style="font-weight: bold;">user-error</span> nil)))
        ((derived-mode-p 'org-mode)
         (<span style="font-weight: bold;">cond</span> ((org-at-block-p)
                (org-narrow-to-block))
               ((org-at-heading-p)
                (org-narrow-to-subtree)
                (adaptive-wrap-prefix-mode))
               (t (org-narrow-to-element)))
         (org-indent-mode -1)
         (visual-line-mode 1))
        ((eq major-mode 'dired-mode)
         (dired-subtree-narrow))
        (t (narrow-to-defun))))

<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(add-hook 'post-command-hook 'highlight-narrowed-buffer)</span>
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(defun highlight-narrowed-buffer ()</span>
<span style="font-weight: bold; font-style: italic;">;;   </span><span style="font-weight: bold; font-style: italic;">"Highlight narrowed buffer.</span>

<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Narrowed buffer have a fringe with highlighting color.</span>
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Plus text size in the buffer becomes a little bit larger."</span>
<span style="font-weight: bold; font-style: italic;">;;   </span><span style="font-weight: bold; font-style: italic;">(unless (or (member last-command</span>
<span style="font-weight: bold; font-style: italic;">;;                       </span><span style="font-weight: bold; font-style: italic;">'(text-scale-adjust))</span>
<span style="font-weight: bold; font-style: italic;">;;               </span><span style="font-weight: bold; font-style: italic;">(eq major-mode 'Info-mode)</span>
<span style="font-weight: bold; font-style: italic;">;;               </span><span style="font-weight: bold; font-style: italic;">(string-match-p (rx (seq line-start "CAPTURE-" (one-or-more ascii) line-end))</span>
<span style="font-weight: bold; font-style: italic;">;;                               </span><span style="font-weight: bold; font-style: italic;">(buffer-name)))</span>
<span style="font-weight: bold; font-style: italic;">;;     </span><span style="font-weight: bold; font-style: italic;">(let ((hl-fringe-color "purple2")</span>
<span style="font-weight: bold; font-style: italic;">;;           </span><span style="font-weight: bold; font-style: italic;">(hl-text-scale (sqrt 2)))</span>
<span style="font-weight: bold; font-style: italic;">;;       </span><span style="font-weight: bold; font-style: italic;">(set-face-attribute</span>
<span style="font-weight: bold; font-style: italic;">;;        </span><span style="font-weight: bold; font-style: italic;">'fringe nil :background (if (buffer-narrowed-p)</span>
<span style="font-weight: bold; font-style: italic;">;;                                    </span><span style="font-weight: bold; font-style: italic;">(progn</span>
<span style="font-weight: bold; font-style: italic;">;;                                      </span><span style="font-weight: bold; font-style: italic;">(text-scale-set hl-text-scale)</span>
<span style="font-weight: bold; font-style: italic;">;;                                      </span><span style="font-weight: bold; font-style: italic;">hl-fringe-color)</span>
<span style="font-weight: bold; font-style: italic;">;;                                  </span><span style="font-weight: bold; font-style: italic;">(progn</span>
<span style="font-weight: bold; font-style: italic;">;;                                    </span><span style="font-weight: bold; font-style: italic;">(when (= text-scale-mode-amount hl-text-scale)</span>
<span style="font-weight: bold; font-style: italic;">;;                                      </span><span style="font-weight: bold; font-style: italic;">(text-scale-set 0))</span>
<span style="font-weight: bold; font-style: italic;">;;                                    </span><span style="font-weight: bold; font-style: italic;">nil))))))</span>
</pre>
</div>
</div>
</li>
<li><a id="org1b3dfc5"></a>weather<br />
<div class="outline-text-6" id="text-org1b3dfc5">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#27671;&#35937;&#24193;&#37197;&#20449;&#12398;&#22825;&#27671;&#24773;&#22577;&#12434;&#21152;&#24037;&#12375;&#12390;&#34920;&#31034;</span>

(<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">request</span>)
(<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">cl</span>)

(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">weather-areas</span>
  '(((url . <span style="font-style: italic;">"http://www.drk7.jp/weather/xml/14.xml"</span>)
     (pref . <span style="font-style: italic;">"&#31070;&#22856;&#24029;&#30476;"</span>)
     (area . <span style="font-style: italic;">"&#35199;&#37096;"</span>))
    ((url . <span style="font-style: italic;">"http://www.drk7.jp/weather/xml/22.xml"</span>)
     (pref . <span style="font-style: italic;">"&#38745;&#23713;&#30476;"</span>)
     (area . <span style="font-style: italic;">"&#20013;&#37096;"</span>))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">weather-area-show</span> (weather-area-alist weather-buffer)
  (lexical-let ((url (assoc-default 'url weather-area-alist))
                (pref (assoc-default 'pref weather-area-alist))
                (area (assoc-default 'area weather-area-alist))
                (buffer weather-buffer))
    (request
      url
      <span style="font-weight: bold;">:parser</span>
      (<span style="font-weight: bold;">lambda</span> ()
        (<span style="font-weight: bold;">let</span> ((xml-string (string-as-multibyte (string-as-unibyte (buffer-string)))))
          (<span style="font-weight: bold;">with-temp-buffer</span>
            (erase-buffer)
            (insert xml-string)
            (libxml-parse-xml-region (point-min) (point-max)))))
      <span style="font-weight: bold;">:success</span>
      (<span style="font-weight: bold;">cl-function</span>
       (<span style="font-weight: bold;">lambda</span> (<span style="font-weight: bold; text-decoration: underline;">&amp;key</span> data <span style="font-weight: bold; text-decoration: underline;">&amp;allow-other-keys</span>)
         (<span style="font-weight: bold;">when</span> data
           (<span style="font-weight: bold;">with-current-buffer</span> buffer
             (insert (format <span style="font-style: italic;">"%s %s\n"</span> pref area))
             (mapcar
              (<span style="font-weight: bold;">lambda</span> (info-node)
                (insert
                 (format <span style="font-style: italic;">"%s %s %s %s\n"</span>
                         (dom-attr info-node 'date)
                         (apply (<span style="font-weight: bold;">lambda</span> (max-temp-node min-temp-node)
                                  (format <span style="font-style: italic;">"%2d/%2d&#8451;"</span>
                                          (string-to-number (dom-text min-temp-node))
                                          (string-to-number (dom-text max-temp-node))))
                                (dom-by-tag (dom-child-by-tag info-node 'temperature) 'range))
                         (apply (<span style="font-weight: bold;">lambda</span> (node-1 node-2 node-3 node-4)
                                  (format <span style="font-style: italic;">"%2d-%2d-%2d-%2d&#65285;"</span>
                                          (string-to-number (dom-text node-1))
                                          (string-to-number (dom-text node-2))
                                          (string-to-number (dom-text node-3))
                                          (string-to-number (dom-text node-4))))
                                (dom-by-tag (dom-child-by-tag info-node 'rainfallchance) 'period))
                         (dom-text (dom-child-by-tag info-node 'weather)))))
              (dom-by-tag (dom-by-id data area) 'info))
             (insert <span style="font-style: italic;">"\n"</span>))))))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">weather</span> ()
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">let</span> ((buffer (get-buffer-create <span style="font-style: italic;">"weather"</span>)))
    (mapcar (<span style="font-weight: bold;">lambda</span> (weather-area)
              (weather-area-show weather-area buffer))
            weather-areas)
    (switch-to-buffer buffer)))

(<span style="font-weight: bold;">provide</span> '<span style="font-weight: bold; text-decoration: underline;">weather</span>)
</pre>
</div>
</div>
</li>
<li><a id="org76f1495"></a>view-file<br />
<div class="outline-text-6" id="text-org76f1495">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defcustom</span> <span style="font-weight: bold; font-style: italic;">my/view-file--temp-dir</span> <span style="font-style: italic;">"~/tmp/view-file"</span>
  <span style="font-style: italic;">"Directory in which we will work for uncompresssing, decrypting and htmlize."</span>)
(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my/view-file--open-file</span> nil
  <span style="font-style: italic;">"Target file which we will actually open.</span>
<span style="font-style: italic;">User should not change this value."</span>)
(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my/view-file--remove-files</span> nil
  <span style="font-style: italic;">"List of files which we will remove afterward.</span>
<span style="font-style: italic;">User should not change this value."</span>)

<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">TODO: support line/search args to jump to the desired position</span>
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/view-file</span> (file <span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> system)
  <span style="font-style: italic;">"Open FILE in my preferable way.</span>

<span style="font-style: italic;">if SYSTEM is non-nii open FILE using preferable application in system."</span>
  (<span style="font-weight: bold;">setq</span> my/view-file--open-file (expand-file-name file))
  (make-directory my/view-file--temp-dir t)

  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">decrypt file if it is encrypted</span>
  (when-let* ((match (string-match <span style="font-style: italic;">"</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">.+</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-weight: bold; font-style: italic;">\</span><span style="font-style: italic;">.gpg$"</span> my/view-file--open-file))
              (decrypt-file (expand-file-name (file-name-base my/view-file--open-file)
                                              (expand-file-name my/view-file--temp-dir)))
              (context (epg-make-context epa-protocol)))
    (epg-context-set-passphrase-callback context
                                         #'epa-passphrase-callback-function)
    (epg-decrypt-file context my/view-file--open-file decrypt-file)
    (<span style="font-weight: bold;">setq</span> my/view-file--open-file decrypt-file)
    (add-to-list 'my/view-file--remove-files decrypt-file))

  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">uncompress file if it is tarball</span>
  (<span style="font-weight: bold;">let*</span> (uncompress-file
         (uncompress-command
          (<span style="font-weight: bold;">cond</span>
           ((string-match <span style="font-style: italic;">"</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">.+</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">\\.t</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">ar\\.</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">?gz$"</span> my/view-file--open-file)
            (<span style="font-weight: bold;">setq</span> uncompress-file (expand-file-name (file-name-base (match-string 1 my/view-file--open-file))
                                                    my/view-file--temp-dir))
            (format <span style="font-style: italic;">"gzip -dc %s | tar -xf - -C %s"</span>
                    (shell-quote-argument my/view-file--open-file)
                    (shell-quote-argument uncompress-file)))
           ((string-match <span style="font-style: italic;">"</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">.+</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">\\.t</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">ar\\.</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">?zst$"</span> my/view-file--open-file)
            (<span style="font-weight: bold;">setq</span> uncompress-file (expand-file-name (file-name-base (match-string 1 my/view-file--open-file))
                                                    my/view-file--temp-dir))
            (format <span style="font-style: italic;">"unzstd -c %s | tar -xf - -C %s"</span>
                    (shell-quote-argument my/view-file--open-file)
                    (shell-quote-argument uncompress-file)))
           ((string-match <span style="font-style: italic;">"</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">.+</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">\\.zip$"</span> my/view-file--open-file)
            (<span style="font-weight: bold;">setq</span> uncompress-file (expand-file-name (file-name-base (match-string 1 my/view-file--open-file))
                                                    my/view-file--temp-dir))
            (format <span style="font-style: italic;">"unzip -o -d %s %s"</span>
                    (shell-quote-argument uncompress-file)
                    (shell-quote-argument my/view-file--open-file))))))
    (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">and</span> (stringp uncompress-file)
               (stringp uncompress-command))
      (make-directory uncompress-file t)
      (call-process-shell-command
       uncompress-command)
      (add-to-list 'my/view-file--remove-files uncompress-file)
      (<span style="font-weight: bold;">setq</span> my/view-file--open-file uncompress-file)))

  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">convert pdf/epub to html</span>
  (<span style="font-weight: bold;">let*</span> ((dirname-html
          (expand-file-name (file-relative-name my/view-file--open-file <span style="font-style: italic;">"/"</span>)
                            (expand-file-name my/view-file--temp-dir)))
         (filename-html
          (concat (file-name-as-directory dirname-html)
                  <span style="font-style: italic;">"index.html"</span>))
         (command
          (<span style="font-weight: bold;">cond</span>
           ((= (call-process-shell-command (format <span style="font-style: italic;">"filetype-cli check --type pdf %s"</span> (shell-quote-argument my/view-file--open-file))) 0)
            (format <span style="font-style: italic;">"cat %s 2&gt;/dev/null | pdftohtml -p -s -noframes -nomerge -nodrm - %s"</span>
                    (shell-quote-argument my/view-file--open-file)
                    (shell-quote-argument filename-html)))
           ((= (call-process-shell-command (format <span style="font-style: italic;">"filetype-cli check --type epub %s"</span> (shell-quote-argument my/view-file--open-file))) 0)
            (format <span style="font-style: italic;">"cat %s 2&gt;/dev/null | pandoc --from=epub --to=html --extract-media=%s - | strip_ruby &gt; %s"</span>
                    (shell-quote-argument my/view-file--open-file)
                    (shell-quote-argument dirname-html)
                    (shell-quote-argument filename-html))))))
    (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">and</span> (null system)
               (stringp command))
      (<span style="font-weight: bold;">unless</span> (file-exists-p filename-html)
        (make-directory dirname-html t)
        (call-process-shell-command command)
        <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">reuse html only if pdf/epub file is not ecrypted</span>
        (<span style="font-weight: bold;">when</span> (member my/view-file--open-file my/view-file--remove-files)
          (add-to-list 'my/view-file--remove-files dirname-html)))
      (<span style="font-weight: bold;">setq</span> my/view-file--open-file filename-html)))

  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">open file</span>
  (<span style="font-weight: bold;">cond</span>
   ((<span style="font-weight: bold;">or</span> system
        (string-match-p <span style="font-style: italic;">"\\.midi?$"</span> my/view-file--open-file)
        (= (call-process-shell-command (format <span style="font-style: italic;">"filetype-cli check --type pdf %s"</span> (shell-quote-argument my/view-file--open-file))) 0)
        (= (call-process-shell-command (format <span style="font-style: italic;">"filetype-cli check --type epub %s"</span> (shell-quote-argument my/view-file--open-file))) 0))
    (<span style="font-weight: bold;">let</span> ((process-connection-type nil))
      (call-process-shell-command (format <span style="font-style: italic;">"xdg-open %s"</span> (shell-quote-argument my/view-file--open-file)))
      (sleep-for 3)
      (funcall 'my/view-file--finalize-function)))
   ((<span style="font-weight: bold;">or</span> (= (call-process-shell-command (format <span style="font-style: italic;">"filetype-cli check --type playable %s"</span> (shell-quote-argument my/view-file--open-file))) 0)
        (seq-some (<span style="font-weight: bold;">lambda</span> (suffix)
                    (string-suffix-p suffix my/view-file--open-file t))
                  '(<span style="font-style: italic;">".m3u"</span> <span style="font-style: italic;">".mts"</span> <span style="font-style: italic;">".m2ts"</span>)))
    (when-let ((mpv-proc (start-process-shell-command
                          <span style="font-style: italic;">"mpv"</span> nil
                          (format <span style="font-style: italic;">"nohup mpv --force-window %s &gt;/dev/null 2&gt;&amp;1"</span> (shell-quote-argument my/view-file--open-file)))))
      (set-process-sentinel
       mpv-proc
       (<span style="font-weight: bold;">lambda</span> (process desc)
         (<span style="font-weight: bold;">when</span> (eq (process-status process) 'exit)
           (funcall 'my/view-file--finalize-function))))))
   ((= (call-process-shell-command
        (format <span style="font-style: italic;">"filetype-cli check --type html %s"</span>
                (shell-quote-argument my/view-file--open-file))) <span style="font-weight: bold;">0)</span>
    (add-hook 'eww-after-render-hook 'my/view-file--eww-finalize-function)
    (eww-open-file my/view-file--open-file))
   ((file-directory-p my/view-file--open-file)
    (dired my/view-file--open-file)
    (funcall 'my/view-file--finalize-function))
   (t
    (find-file my/view-file--open-file)
    (funcall 'my/view-file--finalize-function))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/view-file--finalize-function</span> ()
  <span style="font-style: italic;">"Remove files and initialize variables."</span>
  (mapc (<span style="font-weight: bold;">lambda</span> (file)
          (<span style="font-weight: bold;">when</span> (stringp file)
            (<span style="font-weight: bold;">cond</span>
             ((file-directory-p file)
              (delete-directory file t nil))
             ((file-exists-p file)
              (<span style="font-weight: bold;">let</span> ((delete-by-moving-to-trash t))
                (delete-file file))))))
        my/view-file--remove-files)
  (<span style="font-weight: bold;">setq</span> my/view-file--open-file nil
        my/view-file--remove-files nil))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/view-file--eww-finalize-function</span> ()
  <span style="font-style: italic;">"Finalize function for `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">EWW</span><span style="font-style: italic;">'."</span>
  (remove-hook 'eww-after-render-hook 'my/view-file--eww-finalize-function)
  (funcall 'my/view-file--finalize-function))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/view-file-filter-org-link-store-props</span> (<span style="font-weight: bold; text-decoration: underline;">&amp;rest</span> plist-orig)
  <span style="font-style: italic;">"Filter PLIST-ORIG to original file name if value of `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">eww-current-url</span><span style="font-style: italic;">'</span>
<span style="font-style: italic;"> is in `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">my/view-file--temp-dir</span><span style="font-style: italic;">'."</span>
  (<span style="font-weight: bold;">let</span> ((plist-filtered (car plist-orig)))
    (<span style="font-weight: bold;">if</span> (plist-member plist-filtered <span style="font-weight: bold;">:link</span>)
        (plist-put plist-filtered
                   <span style="font-weight: bold;">:link</span>
                   (replace-regexp-in-string (format <span style="font-style: italic;">"%s</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">.*</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">/index.html"</span>
                                                     (expand-file-name my/view-file--temp-dir))
                                             (format <span style="font-style: italic;">"%s\\1"</span>
                                                     (expand-file-name <span style="font-style: italic;">"~"</span>))
                                             (plist-get plist-filtered
                                                        <span style="font-weight: bold;">:link</span>))))
    (car plist-orig)))

(advice-add #'org-link-store-props <span style="font-weight: bold;">:filter-args</span>
            #'my/view-file-filter-org-link-store-props)

(<span style="font-weight: bold;">provide</span> '<span style="font-weight: bold; text-decoration: underline;">my/view-file</span>)
</pre>
</div>
</div>
<ul class="org-ul">
<li><a id="org77118f9"></a>filetype-cli<br />
<div class="outline-text-7" id="text-org77118f9">
<p>
Wrapper script for <a href="#org0573985">filetype.rb</a>.
</p>

<div class="org-src-container">
<pre class="src src-ruby"><span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">!/usr/bin/env ruby</span>

<span style="font-weight: bold;">require</span> <span style="font-style: italic;">'thor'</span>
<span style="font-weight: bold;">require</span> <span style="font-style: italic;">'filetype'</span>

<span style="font-weight: bold;">class</span> <span style="font-weight: bold; text-decoration: underline;">FileTypeCLI</span> &lt; <span style="font-weight: bold; text-decoration: underline;">Thor</span>
  default_command <span style="font-weight: bold; text-decoration: underline;">:check</span>
  desc <span style="font-style: italic;">"check"</span>, <span style="font-style: italic;">"check whether the file is the speicfied type."</span>
  option <span style="font-weight: bold; text-decoration: underline;">:type</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"t"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>, <span style="font-weight: bold; text-decoration: underline;">:required</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">true</span>,
         <span style="font-weight: bold; text-decoration: underline;">:bannar</span> =&gt; <span style="font-style: italic;">'--type image'</span>
  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">check</span>(file)
    <span style="font-weight: bold;">unless</span> <span style="font-weight: bold; text-decoration: underline;">FileType</span>.respond_to?(<span style="font-style: italic;">"</span><span style="font-weight: bold; font-style: italic;">#{options[:type]}</span><span style="font-style: italic;">?"</span>)
      <span style="font-weight: bold;">$stderr</span>.print(<span style="font-style: italic;">"file type '</span><span style="font-weight: bold; font-style: italic;">#{options[:type]}</span><span style="font-style: italic;">' is not valid."</span>)
      <span style="font-weight: bold;">exit</span> 1
    <span style="font-weight: bold;">end</span>

    status = <span style="font-weight: bold; text-decoration: underline;">FileType</span>.send(<span style="font-style: italic;">"</span><span style="font-weight: bold; font-style: italic;">#{options[:type]}</span><span style="font-style: italic;">?"</span>, file)
    <span style="font-weight: bold;">unless</span> status
      <span style="font-weight: bold;">$stderr</span>.print(<span style="font-style: italic;">"</span><span style="font-weight: bold; font-style: italic;">#{file}</span><span style="font-style: italic;"> is not of </span><span style="font-weight: bold; font-style: italic;">#{options[:type]}</span><span style="font-style: italic;">?"</span>)
      <span style="font-weight: bold;">exit</span> 1
    <span style="font-weight: bold;">end</span>

    <span style="font-weight: bold;">exit</span> 0
  <span style="font-weight: bold;">end</span>
<span style="font-weight: bold;">end</span>

<span style="font-weight: bold; text-decoration: underline;">FileTypeCLI</span>.start(<span style="font-weight: bold; text-decoration: underline;">ARGV</span>)
</pre>
</div>
</div>
</li>

<li><a id="orga82de67"></a>strip<sub>ruby</sub><br />
<div class="outline-text-7" id="text-orga82de67">
<p>
A program strips all ruby tags in a HTML stream. All HTML contents are expected to be from STDIN and go out as STDOUT. This procedure is mainly for html files converted from pdf and epub files.
Stripping rules are:
</p>
<ul class="org-ul">
<li>&lt;ruby&gt; tag will be stripped</li>
<li>&lt;rt&gt; tree for furigana tree will be removed</li>
<li>&lt;rp&gt; tree contains parenthes for non-ruby-support brouwser will be removed</li>
<li>&lt;rb&gt; tag for delimiter will be stripped</li>
<li>&lt;rtc&gt; tree for semantic word will be removed</li>
</ul>

<div class="org-src-container">
<pre class="src src-python"><span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">!/usr/bin/env python3</span>

<span style="font-weight: bold;">import</span> sys
<span style="font-weight: bold;">import</span> lxml.html <span style="font-weight: bold;">as</span> html

<span style="font-weight: bold; font-style: italic;">INPUT_STR</span> = sys.stdin.read()
<span style="font-weight: bold; font-style: italic;">ROOT</span> = html.fromstring(INPUT_STR).getroottree()

<span style="font-weight: bold;">for</span> ruby <span style="font-weight: bold;">in</span> ROOT.xpath(<span style="font-style: italic;">'//ruby'</span>):
    <span style="font-weight: bold;">for</span> rt <span style="font-weight: bold;">in</span> ruby.xpath(<span style="font-style: italic;">'//rt'</span>):
        rt.drop_tree()
    <span style="font-weight: bold;">for</span> rp <span style="font-weight: bold;">in</span> ruby.xpath(<span style="font-style: italic;">'//rp'</span>):
        rp.drop_tree()
    <span style="font-weight: bold;">for</span> rb <span style="font-weight: bold;">in</span> ruby.xpath(<span style="font-style: italic;">'//rb'</span>):
        rb.drop_tag()
    <span style="font-weight: bold;">for</span> rtc <span style="font-weight: bold;">in</span> ruby.xpath(<span style="font-style: italic;">'//rtc'</span>):
        rtc.drop_tree()
    ruby.drop_tag()

<span style="font-weight: bold; font-style: italic;">CONTENT</span> = html.tostring(ROOT, encoding=<span style="font-style: italic;">"utf-8"</span>, method=<span style="font-style: italic;">'html'</span>, pretty_print=<span style="font-weight: bold; text-decoration: underline;">True</span>)
<span style="font-weight: bold;">print</span>(CONTENT.decode())
</pre>
</div>
</div>
</li>
</ul>
</li>
</ul>
</li>
<li><a id="org80bf77d"></a>additional emacs lisp code<br />
<div class="outline-text-5" id="text-org80bf77d">
<p>
This section mainly for elisp code associated with some other programs.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package festival
  <span style="font-weight: bold;">:config</span>
  (say-minor-mode 1)
  (<span style="font-weight: bold;">setq</span> festival-tmp-file (make-temp-file <span style="font-style: italic;">"festival-"</span>)))
(use-package lilypond-mode
  <span style="font-weight: bold;">:delight</span> (LilyPond-mode <span style="font-style: italic;">" LP"</span>)
  <span style="font-weight: bold;">:mode</span> (<span style="font-style: italic;">"\\.ly$"</span> . LilyPond-mode)
  <span style="font-weight: bold;">:custom</span>
  (LilyPond-pdf-command <span style="font-style: italic;">"firefox"</span>)
  (LilyPond-midi-command <span style="font-style: italic;">"fluidsynth -a alsa -m alsa_seq -l"</span>))
</pre>
</div>
</div>
</li>
</ul>
</div>
</div>

<div id="outline-container-orgededa58" class="outline-3">
<h3 id="orgededa58">Bash</h3>
<div class="outline-text-3" id="text-orgededa58">
<ul class="org-ul">
<li><p>
bash profile
</p>
<div class="org-src-container">
<pre class="src src-bash"><span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">!/usr/bin/</span><span style="font-weight: bold;">env</span><span style="font-weight: bold; font-style: italic;"> bash</span>

<span style="font-weight: bold;">if</span> [ -f ~/.bashrc ]; <span style="font-weight: bold;">then</span>
   source ~/.bashrc
<span style="font-weight: bold;">fi</span>
</pre>
</div></li>
<li><p>
bashrc
</p>
<div class="org-src-container">
<pre class="src src-bash"><span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">!/usr/bin/</span><span style="font-weight: bold;">env</span><span style="font-weight: bold; font-style: italic;"> bash</span>

<span style="font-weight: bold;">if</span> [ -f ~/.bashrc.secret ]; <span style="font-weight: bold;">then</span>
   source ~/.bashrc.secret
<span style="font-weight: bold;">fi</span>

<span style="font-weight: bold;">export</span> <span style="font-weight: bold; font-style: italic;">VIEWER</span>=less

<span style="font-weight: bold; font-style: italic;">USER_PATHS</span>=(
  <span style="font-style: italic;">"${HOME}/usr/bin"</span>
  <span style="font-style: italic;">"${HOME}/.local/bin"</span>
)
<span style="font-weight: bold;">for</span> path<span style="font-weight: bold;"> in</span> <span style="font-style: italic;">"${USER_PATHS[@]}"</span>; <span style="font-weight: bold;">do</span>
  <span style="font-weight: bold;">if</span> [ -d <span style="font-style: italic;">"${path}"</span> ]; <span style="font-weight: bold;">then</span>
    <span style="font-weight: bold;">export</span> <span style="font-weight: bold; font-style: italic;">PATH</span>=<span style="font-style: italic;">"${path}:$PATH"</span>
  <span style="font-weight: bold;">fi</span>
<span style="font-weight: bold;">done</span>

<span style="font-weight: bold;">if</span> [ -e $<span style="font-weight: bold; font-style: italic;">HOME</span>/.bash_aliases ]; <span style="font-weight: bold;">then</span>
  source $<span style="font-weight: bold; font-style: italic;">HOME</span>/.bash_aliases
<span style="font-weight: bold;">fi</span>
<span style="font-weight: bold;">if</span> [ -e $<span style="font-weight: bold; font-style: italic;">HOME</span>/.bash_functions ]; <span style="font-weight: bold;">then</span>
  source $<span style="font-weight: bold; font-style: italic;">HOME</span>/.bash_functions
<span style="font-weight: bold;">fi</span>

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">prompt</span>
<span style="font-weight: bold; font-style: italic;">MACHINE</span>=$(<span style="font-weight: bold;">echo</span> $(uname -n) | awk -F . <span style="font-style: italic;">'{print $1}'</span>)
<span style="font-weight: bold; font-style: italic;">PS1</span>=<span style="font-style: italic;">"[\u@${MACHINE}:\\W]\n\$ "</span>

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">function/variable used in libvterm/emacs</span>
<span style="font-weight: bold;">vterm_printf</span>(){
  <span style="font-weight: bold;">if</span> [ -n <span style="font-style: italic;">"$TMUX"</span> ]; <span style="font-weight: bold;">then</span>
    <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Tell tmux to pass the escape sequences through</span>
    <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">(Source: http://permalink.gmane.org/gmane.comp.terminal-emulators.tmux.user/1324)</span>
    printf <span style="font-style: italic;">"\ePtmux;\e\e]%s\007\e\\"</span> <span style="font-style: italic;">"$1"</span>
  <span style="font-weight: bold;">elif</span> [ <span style="font-style: italic;">"${TERM%%-*}"</span> = <span style="font-style: italic;">"screen"</span> ]; <span style="font-weight: bold;">then</span>
    <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">GNU screen (screen, screen-256color, screen-256color-bce)</span>
    printf <span style="font-style: italic;">"\eP\e]%s\007\e\\"</span> <span style="font-style: italic;">"$1"</span>
  <span style="font-weight: bold;">else</span>
    printf <span style="font-style: italic;">"\e]%s\e\\"</span> <span style="font-style: italic;">"$1"</span>
  <span style="font-weight: bold;">fi</span>
}

<span style="font-weight: bold;">vterm_prompt_end</span>(){
  vterm_printf <span style="font-style: italic;">"51;A$(whoami)@$(hostname):$(pwd)"</span>
}

<span style="font-weight: bold; font-style: italic;">PROMPT_COMMAND</span>=<span style="font-style: italic;">'echo -ne "\033]0;${HOSTNAME}:${PWD}\007"'</span>

<span style="font-weight: bold;">case</span> ${<span style="font-weight: bold; font-style: italic;">TERM</span>} <span style="font-weight: bold;">in</span>
dumb)
  ;;
xterm-256color)
  <span style="font-weight: bold;">export</span> <span style="font-weight: bold; font-style: italic;">LANG</span>=en_US.UTF-8
  <span style="font-weight: bold; font-style: italic;">PS1</span>=$<span style="font-weight: bold; font-style: italic;">PS1</span><span style="font-style: italic;">'\[$(vterm_prompt_end)\]'</span>
  ;;
*)
  <span style="font-weight: bold;">export</span> <span style="font-weight: bold; font-style: italic;">LANG</span>=ja_JP.UTF-8
  ;;
<span style="font-weight: bold;">esac</span>

<span style="font-weight: bold;">export</span> <span style="font-weight: bold; font-style: italic;">WINEARCH</span>=win64
<span style="font-weight: bold;">export</span> <span style="font-weight: bold; font-style: italic;">WINEPREFIX</span>=~/.wine

<span style="font-weight: bold;">export</span> <span style="font-weight: bold; font-style: italic;">PASSWORD_STORE_CLIP_TIME</span>=25
. $<span style="font-weight: bold; font-style: italic;">HOME</span>/.asdf/asdf.sh
. $<span style="font-weight: bold; font-style: italic;">HOME</span>/.asdf/completions/asdf.bash

<span style="font-weight: bold;">export</span> <span style="font-weight: bold; font-style: italic;">RUBYLIB</span>=${<span style="font-weight: bold; font-style: italic;">RUBYLIB</span>}:${<span style="font-weight: bold; font-style: italic;">HOME</span>}/.local/lib
<span style="font-weight: bold;">export</span> <span style="font-weight: bold; font-style: italic;">GPG_TTY</span>=$(tty)

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Refresh gpg-agent tty in case user switches into an X session</span>
gpg-connect-agent updatestartuptty /bye &gt;/dev/null
<span style="font-weight: bold; font-style: italic;">GUIX_EXTRA_PROFILES</span>=$<span style="font-weight: bold; font-style: italic;">HOME</span>/.guix-extra-profiles

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">fill in a variable below like a comment line</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">if you'd like to acticate specific profiles under GUIX_EXTRA_PROFILES</span>
<span style="font-weight: bold; font-style: italic;">ACTIVE_PROFILE_NAMES</span>=()
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">ACTIVE_PROFILE_NAMES=(base emacs)</span>

<span style="font-weight: bold; font-style: italic;">profiles</span>=()
<span style="font-weight: bold;">if</span> [ ${#<span style="font-weight: bold; font-style: italic;">ACTIVE_PROFILE_NAMES</span>[@]} -eq 0 ]; <span style="font-weight: bold;">then</span>
  <span style="font-weight: bold; font-style: italic;">profiles</span>=<span style="font-style: italic;">"${GUIX_EXTRA_PROFILES}/*"</span>
<span style="font-weight: bold;">else</span>
  <span style="font-weight: bold;">for</span> name<span style="font-weight: bold;"> in</span> ${<span style="font-weight: bold; font-style: italic;">ACTIVE_PROFILE_NAMES</span>[@]}; <span style="font-weight: bold;">do</span>
    profiles+=(<span style="font-style: italic;">"${GUIX_EXTRA_PROFILES}/${name}"</span>)
  <span style="font-weight: bold;">done</span>
<span style="font-weight: bold;">fi</span>

<span style="font-weight: bold;">for</span> profile<span style="font-weight: bold;"> in</span> ${<span style="font-weight: bold; font-style: italic;">profiles</span>[@]}; <span style="font-weight: bold;">do</span>
  <span style="font-weight: bold; font-style: italic;">GUIX_PROFILE</span>=<span style="font-style: italic;">"${profile}/$(basename ${profile})"</span>
  <span style="font-weight: bold;">if</span> [ -f ${<span style="font-weight: bold; font-style: italic;">GUIX_PROFILE</span>}/etc/profile ]; <span style="font-weight: bold;">then</span>
    . <span style="font-style: italic;">"${GUIX_PROFILE}"</span>/etc/profile
  <span style="font-weight: bold;">fi</span>
<span style="font-weight: bold;">done</span>

<span style="font-weight: bold;">export</span> <span style="font-weight: bold; font-style: italic;">GUIX_PROFILE</span>=<span style="font-style: italic;">"$HOME/.guix-profile"</span>
. <span style="font-style: italic;">"$GUIX_PROFILE/etc/profile"</span>

<span style="font-weight: bold;">export</span> <span style="font-weight: bold; font-style: italic;">GUIX_PROFILE</span>=<span style="font-style: italic;">"$HOME/.config/guix/current"</span>
. <span style="font-style: italic;">"$GUIX_PROFILE/etc/profile"</span>

<span style="font-weight: bold;">export</span> <span style="font-weight: bold; font-style: italic;">GUIX_LOCPATH</span>=<span style="font-style: italic;">"$HOME/.guix-profile/lib/locale"</span>
</pre>
</div></li>
<li><p>
aliases
</p>
<div class="org-src-container">
<pre class="src src-bash">alias ..=<span style="font-style: italic;">"cd ../"</span>
alias <span style="font-weight: bold; font-style: italic;">l</span>=<span style="font-style: italic;">"ls -F"</span>
alias <span style="font-weight: bold; font-style: italic;">ll</span>=<span style="font-style: italic;">"l -lh"</span>
alias <span style="font-weight: bold; font-style: italic;">la</span>=<span style="font-style: italic;">"l -a"</span>
alias <span style="font-weight: bold; font-style: italic;">lal</span>=<span style="font-style: italic;">"l -alh"</span>
alias <span style="font-weight: bold; font-style: italic;">lld</span>=<span style="font-style: italic;">"l -ld"</span>
alias <span style="font-weight: bold; font-style: italic;">cp</span>=<span style="font-style: italic;">"cp -i"</span>
alias <span style="font-weight: bold; font-style: italic;">mv</span>=<span style="font-style: italic;">"mv -i"</span>
alias <span style="font-weight: bold; font-style: italic;">rm</span>=<span style="font-style: italic;">"rm -i"</span>
alias <span style="font-weight: bold; font-style: italic;">rmf</span>=<span style="font-style: italic;">"rm -rf"</span>
alias <span style="font-weight: bold; font-style: italic;">mkdir</span>=<span style="font-style: italic;">"mkdir -pv"</span>
alias <span style="font-weight: bold; font-style: italic;">rmdir</span>=<span style="font-style: italic;">"rmdir -v"</span>
alias <span style="font-weight: bold; font-style: italic;">ff</span>=<span style="font-style: italic;">'find . -type f -iname'</span>

alias <span style="font-weight: bold; font-style: italic;">cputemp</span>=<span style="font-style: italic;">'cat /sys/class/thermal/thermal_zone0/temp'</span>
alias <span style="font-weight: bold; font-style: italic;">ipaddr</span>=<span style="font-style: italic;">"hostname -I | cut -f1 -d' '"</span>
</pre>
</div></li>
<li><p>
functions
</p>
<div class="org-src-container">
<pre class="src src-bash"><span style="font-weight: bold;">function</span> <span style="font-weight: bold;">cl</span>() {
    <span style="font-weight: bold; font-style: italic;">DIR</span>=<span style="font-style: italic;">"$*"</span>;
        <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">if no DIR given, go home</span>
        <span style="font-weight: bold;">if</span> [ $<span style="font-weight: bold; font-style: italic;">#</span> -lt 1 ]; <span style="font-weight: bold;">then</span>
          <span style="font-weight: bold; font-style: italic;">DIR</span>=$<span style="font-weight: bold; font-style: italic;">HOME</span>;
    <span style="font-weight: bold;">fi</span>;

    builtin cd <span style="font-style: italic;">"${DIR}"</span> &amp;&amp; <span style="font-style: italic;">\</span>
      <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">use your preferred ls command</span>
      ls -F --color=auto
}

<span style="font-weight: bold;">function</span> <span style="font-weight: bold;">cpuinfo</span> {
  <span style="font-weight: bold; font-style: italic;">cores</span>=$(nproc)
  <span style="font-weight: bold; font-style: italic;">frequency</span>=$(grep MHz /proc/cpuinfo | head -1 | awk -F <span style="font-style: italic;">' '</span> <span style="font-style: italic;">'{print $4" MHz"}'</span>)
  <span style="font-weight: bold; font-style: italic;">model</span>=$(grep <span style="font-style: italic;">"model name"</span> /proc/cpuinfo | head -1 | sed -r <span style="font-style: italic;">'s/^.{13}//'</span>)
  <span style="font-weight: bold;">echo</span> <span style="font-style: italic;">"CPU Model: $model"</span>
  <span style="font-weight: bold;">echo</span> <span style="font-style: italic;">"CPU Cores: $cores"</span>
  <span style="font-weight: bold;">echo</span> <span style="font-style: italic;">"Frequency: $frequency"</span>
}

<span style="font-weight: bold;">function</span> <span style="font-weight: bold;">dual</span>() {
  <span style="font-weight: bold;">if</span> [ $<span style="font-weight: bold; font-style: italic;">#</span> -eq 0 ]; <span style="font-weight: bold;">then</span>
    <span style="font-weight: bold; font-style: italic;">du_arg</span>=<span style="font-style: italic;">"./* ./.[^.]*"</span>
  <span style="font-weight: bold;">else</span>
    <span style="font-weight: bold; font-style: italic;">du_arg</span>=<span style="font-style: italic;">""</span>
    <span style="font-weight: bold;">for</span> v<span style="font-weight: bold;"> in</span> <span style="font-style: italic;">"$@"</span>
    <span style="font-weight: bold;">do</span>
      <span style="font-weight: bold;">if</span> [ -f ${<span style="font-weight: bold; font-style: italic;">v</span>} ]; <span style="font-weight: bold;">then</span>
        <span style="font-weight: bold; font-style: italic;">du_arg</span>=<span style="font-style: italic;">"${du_arg} ${v}"</span>
      <span style="font-weight: bold;">elif</span> [ -d ${<span style="font-weight: bold; font-style: italic;">v</span>} ]; <span style="font-weight: bold;">then</span>
        <span style="font-weight: bold; font-style: italic;">du_arg</span>=<span style="font-style: italic;">"${du_arg} ${v}/* ${v}/.[^.]*"</span>
      <span style="font-weight: bold;">fi</span>
    <span style="font-weight: bold;">done</span>
  <span style="font-weight: bold;">fi</span>

  ionice -c2 -n7 nice -n19 du -sc ${<span style="font-weight: bold; font-style: italic;">du_arg</span>} 2&gt;/dev/null
}
<span style="font-weight: bold;">export</span> -f dual

<span style="font-weight: bold;">function</span> <span style="font-weight: bold;">mkcdir</span>() {
  mkdir -p -- <span style="font-style: italic;">"$1"</span> &amp;&amp; <span style="font-weight: bold;">cd</span> -P -- <span style="font-style: italic;">"$1"</span>
}

<span style="font-weight: bold;">function</span> <span style="font-weight: bold;">rms</span>() {
  <span style="font-weight: bold;">read</span> -p <span style="font-style: italic;">'shred all files - are you sure (y/n) ? '</span> ans
  <span style="font-weight: bold;">test</span> x$<span style="font-weight: bold; font-style: italic;">ans</span> == xy &amp;&amp; (
    <span style="font-weight: bold;">for</span> file<span style="font-weight: bold;"> in</span> <span style="font-style: italic;">"$@"</span>; <span style="font-weight: bold;">do</span>
      <span style="font-weight: bold;">if</span> [ -f <span style="font-style: italic;">"${file}"</span> ]; <span style="font-weight: bold;">then</span>
        shred -uzv <span style="font-style: italic;">"${file}"</span>
      <span style="font-weight: bold;">elif</span> [ -d <span style="font-style: italic;">"${file}"</span> ]; <span style="font-weight: bold;">then</span>
        find <span style="font-style: italic;">"${file}"</span> -type f -exec shred -uzv {} <span style="font-style: italic;">\;</span>
        rm -rf <span style="font-style: italic;">"${file}"</span>
      <span style="font-weight: bold;">fi</span>
    <span style="font-weight: bold;">done</span>
  )
}

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">A simple script to check on system resources</span>
<span style="font-weight: bold;">function</span> <span style="font-weight: bold;">chksys</span>() {
  clear

  <span style="font-weight: bold;">echo</span> <span style="font-style: italic;">"Memory Usage:"</span>
  /usr/bin/free -h

  <span style="font-weight: bold;">echo</span> $<span style="font-style: italic;">'\n'</span>$<span style="font-style: italic;">"Disk Usage:"</span>
  /bin/df -h /dev/sd[a-z][1-9] 2&gt;/dev/null

  <span style="font-weight: bold;">echo</span> $<span style="font-style: italic;">'\n'</span>$<span style="font-style: italic;">"Uptime:"</span>
  /usr/bin/uptime
}
</pre>
</div></li>
<li><p>
profile
</p>
<div class="org-src-container">
<pre class="src src-bash"><span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">~/.profile: executed by the command interpreter for login shells.</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">This file is not read by bash(1), if ~/.bash_profile or ~/.bash_login</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">exists.</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">see /usr/share/doc/bash/examples/startup-files for examples.</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">the files are located in the bash-doc package.</span>

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">the default umask is set in /etc/profile; for setting the umask</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">for ssh logins, install and configure the libpam-umask package.</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">umask 022</span>

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">if running bash</span>
<span style="font-weight: bold;">if</span> [ -n <span style="font-style: italic;">"$BASH_VERSION"</span> ]; <span style="font-weight: bold;">then</span>
    <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">include .bash_profile if it exists</span>
    <span style="font-weight: bold;">if</span> [ -f <span style="font-style: italic;">"$HOME/.bash_profile"</span> ]; <span style="font-weight: bold;">then</span>
        . <span style="font-style: italic;">"$HOME/.bash_profile"</span>
    <span style="font-weight: bold;">fi</span>
<span style="font-weight: bold;">fi</span>

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">set PATH so it includes user's private bin if it exists</span>
<span style="font-weight: bold;">if</span> [ -d <span style="font-style: italic;">"$HOME/bin"</span> ] ; <span style="font-weight: bold;">then</span>
    <span style="font-weight: bold; font-style: italic;">PATH</span>=<span style="font-style: italic;">"$HOME/bin:$PATH"</span>
<span style="font-weight: bold;">fi</span>

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">set PATH so it includes user's private bin if it exists</span>
<span style="font-weight: bold;">if</span> [ -d <span style="font-style: italic;">"$HOME/.local/bin"</span> ] ; <span style="font-weight: bold;">then</span>
    <span style="font-weight: bold; font-style: italic;">PATH</span>=<span style="font-style: italic;">"$HOME/.local/bin:$PATH"</span>
<span style="font-weight: bold;">fi</span>
</pre>
</div></li>
</ul>
</div>
</div>
<div id="outline-container-org66a941a" class="outline-3">
<h3 id="org66a941a">OpenSSH</h3>
<div class="outline-text-3" id="text-org66a941a">
<p>
<a href="https://www.openssh.com/">OpenSSH</a> is client and server side of ssh implementation.
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"openssh"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-conf">Include config.d/*
</pre>
</div>
</div>
</div>

<div id="outline-container-org61db0fb" class="outline-3">
<h3 id="org61db0fb">abcde</h3>
<div class="outline-text-3" id="text-org61db0fb">
<div class="org-src-container">
<pre class="src src-conf"><span style="font-weight: bold; font-style: italic;">FDKAACENCOPTS</span>=<span style="font-style: italic;">'--bitrate 256k'</span>

<span style="font-weight: bold; font-style: italic;">OUTPUTFORMAT</span>=<span style="font-style: italic;">'${ARTISTFILE}/${ALBUMFILE}/${TRACKNUM}.${TRACKFILE}'</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-orgc920927" class="outline-3">
<h3 id="orgc920927">Git</h3>
<div class="outline-text-3" id="text-orgc920927">
<ul class="org-ul">
<li><p>
git ignore
</p>
<div class="org-src-container">
<pre class="src src-conf"><span style="font-weight: bold; font-style: italic;">#</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">~/.gitignote</span>
<span style="font-weight: bold; font-style: italic;">#</span>
<span style="font-weight: bold; font-style: italic;">## </span><span style="font-weight: bold; font-style: italic;">archive ##</span>
*.zip
*.lzh
*.tar.gz
*.tgz
*.bz2
*.dmg

<span style="font-weight: bold; font-style: italic;">## </span><span style="font-weight: bold; font-style: italic;">Compiled object files ##</span>
*.slo
*.lo
*.o
*.obj

<span style="font-weight: bold; font-style: italic;">## </span><span style="font-weight: bold; font-style: italic;">Compiled Dynamic libraries ##</span>
*.so
*.dylib
*.dll

<span style="font-weight: bold; font-style: italic;">## </span><span style="font-weight: bold; font-style: italic;">Compiled Static libraries ##</span>
*.lai
*.la
*.a
*.lib

<span style="font-weight: bold; font-style: italic;">## </span><span style="font-weight: bold; font-style: italic;">Executables ##</span>
*.exe
*.out
*.app

<span style="font-weight: bold; font-style: italic;">## </span><span style="font-weight: bold; font-style: italic;">Windows ##</span>
Thumbs.db
ehthumbs.db
Desktop.ini
$RECYCLE.BIN/
*.cab
*.msi
*.msm
*.msp

<span style="font-weight: bold; font-style: italic;">## </span><span style="font-weight: bold; font-style: italic;">Mac ##</span>
.DS_Store
.AppleDouble
.LSOverride
.Spotlight-V100
.Trashes
._*

<span style="font-weight: bold; font-style: italic;">## </span><span style="font-weight: bold; font-style: italic;">Linux ##</span>
locate.db

<span style="font-weight: bold; font-style: italic;">## </span><span style="font-weight: bold; font-style: italic;">version control system ##</span>
.git/
.hg/
.svn/

<span style="font-weight: bold; font-style: italic;">## </span><span style="font-weight: bold; font-style: italic;">backup,log ##</span>
*~
~*
*.swp
.swp.*
*.tmp
*.bak
*.old
*.log
.cache/
*.autosave

<span style="font-weight: bold; font-style: italic;">## </span><span style="font-weight: bold; font-style: italic;">Emacs ##</span>
*.elc

<span style="font-weight: bold; font-style: italic;">## </span><span style="font-weight: bold; font-style: italic;">Vim ##</span>
*.un~
Session.vim
.netrwhist

<span style="font-weight: bold; font-style: italic;">## </span><span style="font-weight: bold; font-style: italic;">GNU GLOBAL ##</span>
GPATH
GRTAGS
GTAGS

<span style="font-weight: bold; font-style: italic;">## </span><span style="font-weight: bold; font-style: italic;">netbeans ##</span>
nbproject/
<span style="font-weight: bold; font-style: italic;">## </span><span style="font-weight: bold; font-style: italic;">intellij idea ##</span>
.idea/
<span style="font-weight: bold; font-style: italic;">## </span><span style="font-weight: bold; font-style: italic;">eclipse ##</span>
.settings/
.project
.classpath
.buildpath
<span style="font-weight: bold; font-style: italic;">## </span><span style="font-weight: bold; font-style: italic;">XCode ##</span>
*.xcodeproj/*

<span style="font-weight: bold; font-style: italic;">## </span><span style="font-weight: bold; font-style: italic;">Build dir ##</span>
build/
</pre>
</div></li>
<li><p>
git config
</p>

<p>
<a href="https://magit.vc/manual/magit/How-to-show-diffs-for-gpg_002dencrypted-files_003f.html">This page</a> show you how to get diffs of gpg files in Magit.
</p>

<div class="org-src-container">
<pre class="src src-gitconfig">[core]
	excludesfile = &lt;&lt;home-dir()&gt;&gt;/.config/git/info/ignore
	attributesfile = &lt;&lt;home-dir()&gt;&gt;/.config/git/info/attributes
	editor = emacs
	symlinks = true
	# Unicode
	precomposeunicode = true
	quotepath = true
	autocrlf = false
[push]
	# simple,matching,upstream,current
	default = simple
[color]
	ui = auto
	status = auto
	diff = auto
	branch = auto
	interactive = auto
	grep = auto
[diff]
	patience = true
[diff "gpg"]
	textconv = gpg --no-tty --decrypt
[help]
	autocorrect = 0
[alias]
	co = checkout
	ca = commit -a -v
	ce = commit -v --amend
	st = status --branch --short
	si = status --ignored --short
	branches = branch -a
	remotes = remote -v
	tags = tag -l
	lg = log --graph --all --decorate --abbrev-commit --branches --date=short --pretty=format:\"%C(red)%h%C(reset) %C(green)[%ad]%C(reset) %s %C(cyan)@%an%C(reset) %C(yellow)%d%C(reset)\"
	fp = fetch --prune
	di = diff
	dh = diff --histogram
	dw = diff --word-diff
	dc = diff --cached
	wc = whatchanged
[user]
	email = 6841207+p-snow@users.noreply.github.com
	name = p-snow
[credential]
	helper = &lt;&lt;home-dir()&gt;&gt;/.guix-extra-profiles/base/base/bin/pass-git-helper -m &lt;&lt;home-dir()&gt;&gt;/.config/pass-git-helper/git-pass-mapping.ini
&lt;&lt;git-config&gt;&gt;
</pre>
</div></li>
<li><p>
git attributes
</p>
<div class="org-src-container">
<pre class="src src-gitattributes">*.c diff=cpp
*.h diff=cpp
*.cpp diff=cpp
*.hpp diff=cpp
*.cs diff=csharp
*.m diff=objc
*.java diff=java
*.html diff=html
*.xml diff=html
*.pl diff=perl
*.pm diff=perl
*.t diff=perl
*.php diff=php
*.ptml diff=php
*.py diff=python
*.rb diff=ruby
*.js diff=java
*.csv encoding=cp932
*.json diff=json
*.gpg filter=gpg diff=gpg
</pre>
</div></li>
</ul>
</div>
</div>

<div id="outline-container-orga06f2cb" class="outline-3">
<h3 id="orga06f2cb">ghq</h3>
<div class="outline-text-3" id="text-orga06f2cb">
<p>
<a href="https://github.com/x-motemen/ghq">ghq</a> is management system for remote git repositories.
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"ghq"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-gitconfig">[ghq]
	root = ~/ghq
</pre>
</div>

<div class="org-src-container">
<pre class="src src-conf">[<span style="font-weight: bold; text-decoration: underline;">github.com*</span>]
<span style="font-weight: bold; font-style: italic;">username_extractor</span>=specific_line
<span style="font-weight: bold; font-style: italic;">line_username</span>=2
<span style="font-weight: bold; font-style: italic;">target</span>=github.com
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">username_extractor=entry_name</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orge01b62f" class="outline-3">
<h3 id="orge01b62f">Pass</h3>
<div class="outline-text-3" id="text-orge01b62f">
<p>
<a href="https://www.passwordstore.org/">Pass</a> is a simple password manager.
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"password-store"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-conf">[<span style="font-weight: bold; text-decoration: underline;">github.com*</span>]
<span style="font-weight: bold; font-style: italic;">username_extractor</span>=specific_line
<span style="font-weight: bold; font-style: italic;">line_username</span>=2
<span style="font-weight: bold; font-style: italic;">target</span>=github.com
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">username_extractor=entry_name</span>
</pre>
</div>

<ul class="org-ul">
<li><p>
additional environment variables
</p>
<div class="org-src-container">
<pre class="src src-shell"><span style="font-weight: bold;">export</span> <span style="font-weight: bold; font-style: italic;">PASSWORD_STORE_CLIP_TIME</span>=25
</pre>
</div></li>
</ul>
</div>
</div>
<div id="outline-container-org00c5b11" class="outline-3">
<h3 id="org00c5b11">mpv</h3>
<div class="outline-text-3" id="text-org00c5b11">
<ul class="org-ul">
<li><p>
mpv.conf
</p>
<div class="org-src-container">
<pre class="src src-conf"><span style="font-weight: bold; font-style: italic;">##################</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">video settings #</span>
<span style="font-weight: bold; font-style: italic;">##################</span>

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Start in fullscreen mode by default.</span>
<span style="font-weight: bold; font-style: italic;">fs</span>=yes


<span style="font-weight: bold; font-style: italic;">###########</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">General #</span>
<span style="font-weight: bold; font-style: italic;">###########</span>

<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">save-position-on-quit</span>
no-border                               <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">no window title bar</span>
msg-module                              <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">prepend module name to log messages</span>
msg-color                               <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">color log messages on terminal</span>
term-osd-bar                            <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">display a progress bar on the terminal</span>
use-filedir-conf                        <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">look for additional config files in the directory of the opened file</span>
pause                                   <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">no autoplay</span>
<span style="font-weight: bold; font-style: italic;">force-window</span>=immediate
keep-open                               <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">keep the player open when a file's end is reached</span>
<span style="font-weight: bold; font-style: italic;">autofit-larger</span>=100%x95%                 <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">resize window in case it's larger than W%xH% of the screen</span>
cursor-autohide-fs-only                 <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">don't autohide the cursor in window mode, only fullscreen</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">input-media-keys=no                     # enable/disable OSX media keys</span>
<span style="font-weight: bold; font-style: italic;">cursor-autohide</span>=1000                    <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">autohide the curser after 1s</span>

<span style="font-weight: bold; font-style: italic;">screenshot-format</span>=png
<span style="font-weight: bold; font-style: italic;">screenshot-png-compression</span>=8
<span style="font-weight: bold; font-style: italic;">screenshot-template</span>=<span style="font-style: italic;">'~/Desktop/%F (%P) %n'</span>

<span style="font-weight: bold; font-style: italic;">hls-bitrate</span>=max                         <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">use max quality for HLS streams</span>


<span style="font-weight: bold; font-style: italic;">#########</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Cache #</span>
<span style="font-weight: bold; font-style: italic;">#########</span>

<span style="font-weight: bold; font-style: italic;">cache</span>=yes
<span style="font-weight: bold; font-style: italic;">cache-secs</span>=10                           <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">how many seconds of audio/video to prefetch if the cache is active</span>


<span style="font-weight: bold; font-style: italic;">#############</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">OSD / OSC #</span>
<span style="font-weight: bold; font-style: italic;">#############</span>

<span style="font-weight: bold; font-style: italic;">osd-level</span>=1                             <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">enable osd and display --osd-status-msg on interaction</span>
<span style="font-weight: bold; font-style: italic;">osd-duration</span>=2500                       <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">hide the osd after x ms</span>
<span style="font-weight: bold; font-style: italic;">osd-status-msg</span>=<span style="font-style: italic;">'${time-pos} / ${duration}${?percent-pos: (${percent-pos}%)}${?frame-drop-count:${!frame-drop-count==0: Dropped: ${frame-drop-count}}}\n${?chapter:Chapter: ${chapter}}'</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">osd-status-msg='${=time-pos}'         # show raw position</span>

<span style="font-weight: bold; font-style: italic;">osd-font</span>=<span style="font-style: italic;">'Source Sans Pro'</span>
<span style="font-weight: bold; font-style: italic;">osd-font-size</span>=64
<span style="font-weight: bold; font-style: italic;">osd-color</span>=<span style="font-style: italic;">'#CCFFFFFF'</span>                   <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">ARGB format</span>
<span style="font-weight: bold; font-style: italic;">osd-border-color</span>=<span style="font-style: italic;">'#DD322640'</span>            <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">ARGB format</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">osd-shadow-offset=1                    # pixel width for osd text and progress bar</span>
<span style="font-weight: bold; font-style: italic;">osd-bar-align-y</span>=0                       <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">progress bar y alignment (-1 top, 0 centered, 1 bottom)</span>
<span style="font-weight: bold; font-style: italic;">osd-border-size</span>=2                       <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">size for osd text and progress bar</span>
<span style="font-weight: bold; font-style: italic;">osd-bar-h</span>=2                             <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">height of osd bar as a fractional percentage of your screen height</span>
<span style="font-weight: bold; font-style: italic;">osd-bar-w</span>=60                            <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">width of " " "</span>


<span style="font-weight: bold; font-style: italic;">#############</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Subtitles #</span>
<span style="font-weight: bold; font-style: italic;">#############</span>

sub-use-margins
sub-ass-force-margins

demuxer-mkv-subtitle-preroll            <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">try to correctly show embedded subs when seeking</span>
<span style="font-weight: bold; font-style: italic;">sub-auto</span>=fuzzy                          <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">external subs don't have to match the file name exactly to autoload</span>
<span style="font-weight: bold; font-style: italic;">embeddedfonts</span>=yes                       <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">use embedded fonts for SSA/ASS subs</span>
<span style="font-weight: bold; font-style: italic;">sub-fix-timing</span>=no                       <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">do not try to fix gaps (which might make it worse in some cases)</span>
<span style="font-weight: bold; font-style: italic;">sub-ass-force-style</span>=Kerning=yes         <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">allows you to override style parameters of ASS scripts</span>

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">the following options only apply to subtitles without own styling (i.e. not ASS but e.g. SRT)</span>
<span style="font-weight: bold; font-style: italic;">sub-font</span>=<span style="font-style: italic;">"Source Sans Pro Semibold"</span>
<span style="font-weight: bold; font-style: italic;">sub-font-size</span>=36
<span style="font-weight: bold; font-style: italic;">sub-color</span>=<span style="font-style: italic;">"#FFFFFFFF"</span>
<span style="font-weight: bold; font-style: italic;">sub-border-color</span>=<span style="font-style: italic;">"#FF262626"</span>
<span style="font-weight: bold; font-style: italic;">sub-border-size</span>=3.2
<span style="font-weight: bold; font-style: italic;">sub-shadow-offset</span>=1
<span style="font-weight: bold; font-style: italic;">sub-shadow-color</span>=<span style="font-style: italic;">"#33000000"</span>
<span style="font-weight: bold; font-style: italic;">sub-spacing</span>=0.5


<span style="font-weight: bold; font-style: italic;">#############</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Languages #</span>
<span style="font-weight: bold; font-style: italic;">#############</span>

<span style="font-weight: bold; font-style: italic;">slang</span>=enm,en,eng,de,deu,ger             <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">automatically select these subtitles (decreasing priority)</span>
<span style="font-weight: bold; font-style: italic;">alang</span>=ja,jp,jpn,en,eng,de,deu,ger       <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">automatically select these audio tracks (decreasing priority)</span>

<span style="font-weight: bold; font-style: italic;">#########</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Image #</span>
<span style="font-weight: bold; font-style: italic;">#########</span>

<span style="font-weight: bold; font-style: italic;">image-display-duration</span>=4

<span style="font-weight: bold; font-style: italic;">#########</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Audio #</span>
<span style="font-weight: bold; font-style: italic;">#########</span>

<span style="font-weight: bold; font-style: italic;">audio-file-auto</span>=fuzzy                   <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">external audio doesn't has to match the file name exactly to autoload</span>
<span style="font-weight: bold; font-style: italic;">audio-pitch-correction</span>=yes              <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">automatically insert scaletempo when playing with higher speed</span>
<span style="font-weight: bold; font-style: italic;">volume-max</span>=200                          <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">maximum volume in %, everything above 100 results in amplification</span>
<span style="font-weight: bold; font-style: italic;">volume</span>=100                              <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">default volume, 100 = unchanged</span>


<span style="font-weight: bold; font-style: italic;">################</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Video Output #</span>
<span style="font-weight: bold; font-style: italic;">################</span>

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Active VOs (and some other options) are set conditionally</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">See here for more information: https://github.com/wm4/mpv-scripts/blob/master/auto-profiles.lua</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">The script was modified to import functions from scripts/auto-profiles-functions.lua</span>

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Defaults for all profiles</span>
<span style="font-weight: bold; font-style: italic;">tscale</span>=catmull_rom                      <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">sharp: oversample &lt;-&gt; linear (triangle) &lt;-&gt; catmull_rom &lt;-&gt; mitchell &lt;-&gt; gaussian &lt;-&gt; bicubic : smooth</span>
<span style="font-weight: bold; font-style: italic;">opengl-early-flush</span>=no
<span style="font-weight: bold; font-style: italic;">opengl-pbo</span>=yes


[<span style="font-weight: bold; text-decoration: underline;">high-quality</span>]
<span style="font-weight: bold; font-style: italic;">profile-desc</span>=cond:is_desktop() and get(<span style="font-style: italic;">'width'</span>, math.huge) &lt; 3840
<span style="font-weight: bold; font-style: italic;">scale</span>=ewa_lanczossharp
<span style="font-weight: bold; font-style: italic;">cscale</span>=ewa_lanczossoft
<span style="font-weight: bold; font-style: italic;">dscale</span>=mitchell
<span style="font-weight: bold; font-style: italic;">scale-antiring</span>=0.7
<span style="font-weight: bold; font-style: italic;">cscale-antiring</span>=0.7
<span style="font-weight: bold; font-style: italic;">dither-depth</span>=auto
<span style="font-weight: bold; font-style: italic;">correct-downscaling</span>=yes
<span style="font-weight: bold; font-style: italic;">sigmoid-upscaling</span>=yes
<span style="font-weight: bold; font-style: italic;">deband</span>=yes
<span style="font-weight: bold; font-style: italic;">hwdec</span>=no

[<span style="font-weight: bold; text-decoration: underline;">mid-quality</span>]
<span style="font-weight: bold; font-style: italic;">profile-desc</span>=cond:(is_laptop() and not on_battery() and get(<span style="font-style: italic;">'width'</span>, math.huge) &lt; 1920) or (is_desktop() and get(<span style="font-style: italic;">'width'</span>, math.huge) &gt;= 3840)
<span style="font-weight: bold; font-style: italic;">scale</span>=spline36
<span style="font-weight: bold; font-style: italic;">cscale</span>=bilinear
<span style="font-weight: bold; font-style: italic;">dscale</span>=mitchell
<span style="font-weight: bold; font-style: italic;">scale-antiring</span>=1.0
<span style="font-weight: bold; font-style: italic;">cscale-antiring</span>=1.0
<span style="font-weight: bold; font-style: italic;">dither-depth</span>=auto
<span style="font-weight: bold; font-style: italic;">correct-downscaling</span>=yes
<span style="font-weight: bold; font-style: italic;">sigmoid-upscaling</span>=yes
<span style="font-weight: bold; font-style: italic;">deband</span>=yes
<span style="font-weight: bold; font-style: italic;">hwdec</span>=no

[<span style="font-weight: bold; text-decoration: underline;">low-quality</span>]
<span style="font-weight: bold; font-style: italic;">profile-desc</span>=cond:is_laptop() and (on_battery() or get(<span style="font-style: italic;">'width'</span>, math.huge) &gt;= 1920)
<span style="font-weight: bold; font-style: italic;">scale</span>=bilinear
<span style="font-weight: bold; font-style: italic;">cscale</span>=bilinear
<span style="font-weight: bold; font-style: italic;">dscale</span>=bilinear
<span style="font-weight: bold; font-style: italic;">scale-antiring</span>=0.0
<span style="font-weight: bold; font-style: italic;">cscale-antiring</span>=0.0
<span style="font-weight: bold; font-style: italic;">dither-depth</span>=no
<span style="font-weight: bold; font-style: italic;">correct-downscaling</span>=no
<span style="font-weight: bold; font-style: italic;">sigmoid-upscaling</span>=no
<span style="font-weight: bold; font-style: italic;">deband</span>=no
<span style="font-weight: bold; font-style: italic;">hwdec</span>=auto

[<span style="font-weight: bold; text-decoration: underline;">60FPS</span>]
<span style="font-weight: bold; font-style: italic;">profile-desc</span>=cond:is_laptop() and get(<span style="font-style: italic;">'container-fps'</span>, 0) &gt;= 59
<span style="font-weight: bold; font-style: italic;">scale</span>=bilinear
<span style="font-weight: bold; font-style: italic;">cscale</span>=bilinear

[<span style="font-weight: bold; text-decoration: underline;">4K</span>]
<span style="font-weight: bold; font-style: italic;">profile-desc</span>=cond:get(<span style="font-style: italic;">'width'</span>, -math.huge) &gt;= 3840
<span style="font-weight: bold; font-style: italic;">vd-lavc-threads</span>=32

[<span style="font-weight: bold; text-decoration: underline;">4K-inverted</span>]
<span style="font-weight: bold; font-style: italic;">profile-desc</span>=cond:get(<span style="font-style: italic;">'width'</span>, -math.huge) &lt; 3840
<span style="font-weight: bold; font-style: italic;">vd-lavc-threads</span>=0


[<span style="font-weight: bold; text-decoration: underline;">default</span>]


<span style="font-weight: bold; font-style: italic;">###################################</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Protocol Specific Configuration #</span>
<span style="font-weight: bold; font-style: italic;">###################################</span>

[<span style="font-weight: bold; text-decoration: underline;">protocol.https</span>]
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">cache=yes</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">cache-default=500000                    # size in KB</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">cache-backbuffer=250000                 # size in KB</span>
<span style="font-weight: bold; font-style: italic;">cache-secs</span>=100                          <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">how many seconds of audio/video to prefetch</span>
<span style="font-weight: bold; font-style: italic;">user-agent</span>=<span style="font-style: italic;">'Mozilla/5.0 (Macintosh; Intel Mac OS X 10.11; rv:47.0) Gecko/20100101 Firefox/47.0'</span>

[<span style="font-weight: bold; text-decoration: underline;">protocol.http</span>]
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">cache=yes</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">cache-default=500000                    # size in KB</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">cache-backbuffer=250000                 # size in KB</span>
<span style="font-weight: bold; font-style: italic;">cache-secs</span>=100                          <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">how many seconds of audio/video to prefetch</span>
<span style="font-weight: bold; font-style: italic;">user-agent</span>=<span style="font-style: italic;">'Mozilla/5.0 (Macintosh; Intel Mac OS X 10.11; rv:47.0) Gecko/20100101 Firefox/47.0'</span>

[<span style="font-weight: bold; text-decoration: underline;">extension.gif</span>]
<span style="font-weight: bold; font-style: italic;">cache</span>=no
no-pause
<span style="font-weight: bold; font-style: italic;">loop-file</span>=yes

[<span style="font-weight: bold; text-decoration: underline;">extension.webm</span>]
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">cache=no</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">no-pause</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">loop-file=yes</span>
</pre>
</div></li>
<li><p>
input.conf
</p>
<div class="org-src-container">
<pre class="src src-conf"><span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">mpv keybindings</span>
<span style="font-weight: bold; font-style: italic;">#</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Location of user-defined bindings: ~/.config/mpv/input.conf</span>
<span style="font-weight: bold; font-style: italic;">#</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Lines starting with # are comments. Use SHARP to assign the # key.</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Copy this file and uncomment and edit the bindings you want to change.</span>
<span style="font-weight: bold; font-style: italic;">#</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">List of commands and further details: DOCS/man/input.rst</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">List of special keys: --input-keylist</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Keybindings testing mode: mpv --input-test --force-window --idle</span>
<span style="font-weight: bold; font-style: italic;">#</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Use 'ignore' to unbind a key fully (e.g. 'ctrl+a ignore').</span>
<span style="font-weight: bold; font-style: italic;">#</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Strings need to be quoted and escaped:</span>
<span style="font-weight: bold; font-style: italic;">#   </span><span style="font-weight: bold; font-style: italic;">KEY show-text "This is a single backslash: \\ and a quote: \" !"</span>
<span style="font-weight: bold; font-style: italic;">#</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">You can use modifier-key combinations like Shift+Left or Ctrl+Alt+x with</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">the modifiers Shift, Ctrl, Alt and Meta (may not work on the terminal).</span>
<span style="font-weight: bold; font-style: italic;">#</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">The default keybindings are hardcoded into the mpv binary.</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">You can disable them completely with: --no-input-default-bindings</span>

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Developer note:</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">On compilation, this file is baked into the mpv binary, and all lines are</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">uncommented (unless '#' is followed by a space) - thus this file defines the</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">default key bindings.</span>

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">If this is enabled, treat all the following bindings as default.</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">default-bindings start</span>

<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">MOUSE_BTN0 ignore                      # don't do anything</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">MOUSE_BTN0_DBL cycle fullscreen        # toggle fullscreen on/off</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">MOUSE_BTN2 cycle pause                 # toggle pause on/off</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">MOUSE_BTN3 seek 10</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">MOUSE_BTN4 seek -10</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">MOUSE_BTN5 add volume -2</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">MOUSE_BTN6 add volume 2</span>

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Mouse wheels, touchpad or other input devices that have axes</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">if the input devices supports precise scrolling it will also scale the</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">numeric value accordingly</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">AXIS_UP    seek 10</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">AXIS_DOWN  seek -10</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">AXIS_LEFT  seek 5</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">AXIS_RIGHT seek -5</span>

<span style="font-weight: bold; font-style: italic;">## </span><span style="font-weight: bold; font-style: italic;">Seek units are in seconds, but note that these are limited by keyframes</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">RIGHT seek  5</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">LEFT  seek -5</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">UP    seek  60</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">DOWN  seek -60</span>
RIGHT  seek  5
LEFT   seek -5
UP     seek -60
DOWN   seek  60
Ctrl+f seek  3
Ctrl+b seek -3
Ctrl+p seek -60
Ctrl+n seek  60
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Do smaller, always exact (non-keyframe-limited), seeks with shift.</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Don't show them on the OSD (no-osd).</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">Shift+RIGHT no-osd seek  1 exact</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">Shift+LEFT  no-osd seek -1 exact</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">Shift+UP    no-osd seek  5 exact</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">Shift+DOWN  no-osd seek -5 exact</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Skip to previous/next subtitle (subject to some restrictions; see manpage)</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">Ctrl+LEFT   no-osd sub-seek -1</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">Ctrl+RIGHT  no-osd sub-seek  1</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">PGUP add chapter 1                     # skip to next chapter</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">PGDWN add chapter -1                   # skip to previous chapter</span>
PGUP add chapter -1                     <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">skip to next chapter</span>
PGDWN add chapter 1                     <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">skip to previous chapter</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">Shift+PGUP seek 600</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">Shift+PGDWN seek -600</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">[ multiply speed 0.9091                # scale playback speed</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">] multiply speed 1.1</span>
<span style="font-weight: bold; font-style: italic; text-decoration: underline;">#</span><span style="font-weight: bold; font-style: italic;">{ multiply speed 0.5</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">} multiply speed 2.0</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">BS set speed 1.0                       # reset speed to normal</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">q quit</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">Q quit-watch-later</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">q {encode} quit 4</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">ESC set fullscreen no</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">ESC {encode} quit 4</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">p cycle pause                          # toggle pause/playback mode</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">. frame-step                           # advance one frame and pause</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">, frame-back-step                      # go back by one frame and pause</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">SPACE cycle pause</span>
? playlist-shuffle                      <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">skip to random file</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">&gt; playlist-next                        # skip to next file</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">ENTER playlist-next                    # skip to next file</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">&lt; playlist-prev                        # skip to previous file</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">O no-osd cycle-values osd-level 3 1    # cycle through OSD mode</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">o show-progress</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">P show-progress</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">I show-text "${filename}"              # display filename in osd</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">z add sub-delay -0.1                   # subtract 100 ms delay from subs</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">x add sub-delay +0.1                   # add</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">ctrl++ add audio-delay 0.100           # this changes audio/video sync</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">ctrl+- add audio-delay -0.100</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">9 add volume -2</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">/ add volume -2</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">0 add volume 2</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">* add volume 2</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">m cycle mute</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">1 add contrast -1</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">2 add contrast 1</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">3 add brightness -1</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">4 add brightness 1</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">5 add gamma -1</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">6 add gamma 1</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">7 add saturation -1</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">8 add saturation 1</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">Alt+0 set window-scale 0.5</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">Alt+1 set window-scale 1.0</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">Alt+2 set window-scale 2.0</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">toggle deinterlacer (automatically inserts or removes required filter)</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">d cycle deinterlace</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">r add sub-pos -1                       # move subtitles up</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">t add sub-pos +1                       #                down</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">v cycle sub-visibility</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">stretch SSA/ASS subtitles with anamorphic videos to match historical</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">V cycle sub-ass-vsfilter-aspect-compat</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">switch between applying no style overrides to SSA/ASS subtitles, and</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">overriding them almost completely with the normal subtitle style</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">u cycle-values sub-ass-style-override "force" "no"</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">j cycle sub                            # cycle through subtitles</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">J cycle sub down                       # ...backwards</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">SHARP cycle audio                      # switch audio streams</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">_ cycle video</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">T cycle ontop                          # toggle video window ontop of other windows</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">f cycle fullscreen                     # toggle fullscreen</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">s async screenshot                     # take a screenshot</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">S async screenshot video               # ...without subtitles</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">Ctrl+s async screenshot window         # ...with subtitles and OSD, and scaled</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">Alt+s screenshot each-frame            # automatically screenshot every frame</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">w add panscan -0.1                     # zoom out with -panscan 0 -fs</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">e add panscan +0.1                     #      in</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">cycle video aspect ratios; "-1" is the container aspect</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">A cycle-values video-aspect "16:9" "4:3" "2.35:1" "-1"</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">POWER quit</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">PLAY cycle pause</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">PAUSE cycle pause</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">PLAYPAUSE cycle pause</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">STOP quit</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">FORWARD seek 60</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">REWIND seek -60</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">NEXT playlist-next</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">PREV playlist-prev</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">VOLUME_UP add volume 2</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">VOLUME_DOWN add volume -2</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">MUTE cycle mute</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">CLOSE_WIN quit</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">CLOSE_WIN {encode} quit 4</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">E cycle edition                        # next edition</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">l ab-loop                              # Set/clear A-B loop points</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">L cycle-values loop-file "inf" "no"    # toggle infinite looping</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">ctrl+c quit 4</span>

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Apple Remote section</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">AR_PLAY cycle pause</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">AR_PLAY_HOLD quit</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">AR_CENTER cycle pause</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">AR_CENTER_HOLD quit</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">AR_NEXT seek 10</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">AR_NEXT_HOLD seek 120</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">AR_PREV seek -10</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">AR_PREV_HOLD seek -120</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">AR_MENU show-progress</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">AR_MENU_HOLD cycle mute</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">AR_VUP add volume 2</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">AR_VUP_HOLD add chapter 1</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">AR_VDOWN add volume -2</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">AR_VDOWN_HOLD add chapter -1</span>

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">For tv://</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">h cycle tv-channel -1                  # previous channel</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">k cycle tv-channel +1                  # next channel</span>

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">For dvb://</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">H cycle dvb-channel-name -1            # previous channel</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">K cycle dvb-channel-name +1            # next channel</span>

<span style="font-weight: bold; font-style: italic;">#</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Legacy bindings (may or may not be removed in the future)</span>
<span style="font-weight: bold; font-style: italic;">#</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">! add chapter -1                       # skip to previous chapter</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">@ add chapter 1                        #         next</span>

<span style="font-weight: bold; font-style: italic;">#</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Not assigned by default</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">(not an exhaustive list of unbound commands)</span>
<span style="font-weight: bold; font-style: italic;">#</span>

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">? add sub-scale +0.1                  # increase subtitle font size</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">? add sub-scale -0.1                  # decrease subtitle font size</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">? sub-step -1                         # immediately display next subtitle</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">? sub-step +1                         #                     previous</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">? cycle angle                         # switch DVD/Bluray angle</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">? add balance -0.1                    # adjust audio balance in favor of left</span>
Z add balance -0.1                    <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">adjust audio balance in favor of left</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">? add balance 0.1                     #                                  right</span>
X add balance 0.1                     <span style="font-weight: bold; font-style: italic;">#                                  </span><span style="font-weight: bold; font-style: italic;">right</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">? cycle sub-forced-only               # toggle DVD forced subs</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">? cycle program                       # cycle transport stream programs</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">? stop                                # stop playback (quit or enter idle mode)</span>
</pre>
</div></li>
<li><p>
scripts
</p>
<div class="org-src-container">
<pre class="src src-lua">local utils = require "mp.utils"

del_list = {}

function contains_item(l, i)
   for k, v in pairs(l) do
      if v == i then
	 mp.osd_message("undeleting current file")
	 l[k] = nil
	 return true
      end
   end
   mp.osd_message("deleting current file")
   return false
end

function mark_delete()
   local work_dir = mp.get_property_native("working-directory")
   local file_path = mp.get_property_native("path")
   local s = file_path:find(work_dir, 0, true)
   local final_path
   if s and s == 0 then
      final_path = file_path
   else
      final_path = utils.join_path(work_dir, file_path)
   end
   if not contains_item(del_list, final_path) then
      table.insert(del_list, final_path)
   end
end

function delete(e)
   if e.reason == "quit" then
      for i, v in pairs(del_list) do
	 print("deleting: "..v)
	 os.remove(v)
      end
   end
end

mp.add_key_binding("ctrl+DEL", "delete_file", mark_delete)
mp.register_event("end-file", delete)
</pre>
</div></li>
</ul>
</div>
</div>

<div id="outline-container-org73a00c7" class="outline-3">
<h3 id="org73a00c7">unison</h3>
<div class="outline-text-3" id="text-org73a00c7">
<ul class="org-ul">
<li><p>
music directory syncing
</p>
<div class="org-src-container">
<pre class="src src-conf"><span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Roots of the synchronization</span>
<span style="font-weight: bold; font-style: italic;">root</span> = &lt;&lt;home-dir()&gt;&gt;/mnt/ruizu/Music
<span style="font-weight: bold; font-style: italic;">root</span> = &lt;&lt;home-dir()&gt;&gt;/Audio

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Paths to synchronize</span>
<span style="font-weight: bold; font-style: italic;">path</span> = .

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Ruizu's file system is FAT</span>
<span style="font-weight: bold; font-style: italic;">fat</span> = true

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Overwrite by newer file on confliction</span>
<span style="font-weight: bold; font-style: italic;">prefer</span> = newer

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Show nothing</span>
<span style="font-weight: bold; font-style: italic;">silent</span> = true
<span style="font-weight: bold; font-style: italic;">confirmbigdel</span> = false

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Do fast checking</span>
<span style="font-weight: bold; font-style: italic;">fastcheck</span> = true

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Log settings</span>
<span style="font-weight: bold; font-style: italic;">log</span> = true
<span style="font-weight: bold; font-style: italic;">logfile</span> = &lt;&lt;home-dir()&gt;&gt;/.local/state/log/log/unison/music.log

</pre>
</div></li>
<li><p>
doc directory backup
</p>
<div class="org-src-container">
<pre class="src src-conf"><span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Roots of the synchronization</span>
<span style="font-weight: bold; font-style: italic;">root</span> = &lt;&lt;home-dir()&gt;&gt;/mnt/ns01
<span style="font-weight: bold; font-style: italic;">root</span> = &lt;&lt;home-dir()&gt;&gt;

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Paths to synchronize</span>
<span style="font-weight: bold; font-style: italic;">path</span> = doc

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Overwrite by newer file on confliction</span>
<span style="font-weight: bold; font-style: italic;">prefer</span> = newer

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Use this command for displaying diffs</span>
<span style="font-weight: bold; font-style: italic;">diff</span> = diff -y -W 79 --suppress-common-lines

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Write down synchronization activity on log file rather than show in stdout</span>
<span style="font-weight: bold; font-style: italic;">auto</span> = true
<span style="font-weight: bold; font-style: italic;">confirmbigdel</span> = false
<span style="font-weight: bold; font-style: italic;">silent</span> = true
<span style="font-weight: bold; font-style: italic;">log</span> = true
<span style="font-weight: bold; font-style: italic;">logfile</span> = &lt;&lt;home-dir()&gt;&gt;/.local/state/log/unison/doc.log

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Use inode number to verify identity rather than ckeck whole byte sequence</span>
<span style="font-weight: bold; font-style: italic;">fastcheck</span> = true

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Abort if device is not mounted</span>
<span style="font-weight: bold; font-style: italic;">mountpoint</span> = doc
</pre>
</div></li>
</ul>
</div>
</div>
<div id="outline-container-org1e71351" class="outline-3">
<h3 id="org1e71351">Aspell</h3>
<div class="outline-text-3" id="text-org1e71351">
<p>
aspell - interactive spell checker
</p>
<div class="org-src-container">
<pre class="src src-conf">lang en_US
</pre>
</div>
</div>
</div>
<div id="outline-container-org4526256" class="outline-3">
<h3 id="org4526256">asdf-vm</h3>
<div class="outline-text-3" id="text-org4526256">
<p>
Extendable version manager
</p>
<ul class="org-ul">
<li><p>
call for init script in bashrc
</p>
<div class="org-src-container">
<pre class="src src-shell">. $<span style="font-weight: bold; font-style: italic;">HOME</span>/.asdf/asdf.sh
. $<span style="font-weight: bold; font-style: italic;">HOME</span>/.asdf/completions/asdf.bash

<span style="font-weight: bold;">export</span> <span style="font-weight: bold; font-style: italic;">RUBYLIB</span>=${<span style="font-weight: bold; font-style: italic;">RUBYLIB</span>}:${<span style="font-weight: bold; font-style: italic;">HOME</span>}/.local/lib
</pre>
</div></li>
<li><p>
define versions
</p>
<div class="org-src-container">
<pre class="src src-conf">ruby 2.6.8
python 3.8.5
</pre>
</div>

<p>
steps to install tools for specific versions
</p>
<ol class="org-ol">
<li><p>
install plugins
</p>
<pre class="example">
$ asdf plugin add ruby
$ asdf plugin add python

</pre></li>

<li><p>
install tools
</p>
<pre class="example">
$ cd ~ &amp;&amp; asdf install

</pre></li>
</ol></li>
</ul>
</div>

<div id="outline-container-orgdb6528f" class="outline-4">
<h4 id="orgdb6528f">asdf-ruby</h4>
<div class="outline-text-4" id="text-orgdb6528f">
<div class="org-src-container">
<pre class="src src-conf">thor 1.2.1
pry 0.14.1
rubocop 1.26
exifr 1.2.6
streamio-ffmpeg
</pre>
</div>
</div>
</div>
<div id="outline-container-org4228bef" class="outline-4">
<h4 id="org4228bef">asdf-python</h4>
<div class="outline-text-4" id="text-org4228bef">
<div class="org-src-container">
<pre class="src src-python">lxml
jedi
ical2orgpy
Send2Trash
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org65726d6" class="outline-3">
<h3 id="org65726d6">xkeysnail</h3>
<div class="outline-text-3" id="text-org65726d6">
<ul class="org-ul">
<li><p>
config.py
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">-*- coding: utf-8 -*-</span>

<span style="font-weight: bold;">import</span> re
<span style="font-weight: bold;">from</span> xkeysnail.transform <span style="font-weight: bold;">import</span> *

define_multipurpose_modmap({
    <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">SandS</span>
    Key.SPACE: [Key.SPACE, Key.LEFT_SHIFT],

    <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Enter is enter when pressed and released. Control when held down.</span>
    Key.ENTER: [Key.ENTER, Key.RIGHT_CTRL],

    Key.LEFT_SHIFT: [Key.EQUAL, Key.LEFT_SHIFT],
    Key.RIGHT_SHIFT: [Key.MINUS, Key.RIGHT_SHIFT],
})

define_modmap({
    Key.LEFT_CTRL: Key.CAPSLOCK,
    Key.CAPSLOCK: Key.LEFT_CTRL,
    Key.SYSRQ: Key.RIGHT_META,
})

define_keymap(<span style="font-weight: bold; text-decoration: underline;">None</span>, {
    K(<span style="font-style: italic;">"C-Shift-a"</span>): K(<span style="font-style: italic;">"KEY_1"</span>),
    K(<span style="font-style: italic;">"C-Shift-s"</span>): K(<span style="font-style: italic;">"KEY_2"</span>),
    K(<span style="font-style: italic;">"C-Shift-d"</span>): K(<span style="font-style: italic;">"KEY_3"</span>),
    K(<span style="font-style: italic;">"C-Shift-f"</span>): K(<span style="font-style: italic;">"KEY_4"</span>),
    K(<span style="font-style: italic;">"C-Shift-g"</span>): K(<span style="font-style: italic;">"KEY_5"</span>),
    K(<span style="font-style: italic;">"C-Shift-h"</span>): K(<span style="font-style: italic;">"KEY_6"</span>),
    K(<span style="font-style: italic;">"C-Shift-j"</span>): K(<span style="font-style: italic;">"KEY_7"</span>),
    K(<span style="font-style: italic;">"C-Shift-k"</span>): K(<span style="font-style: italic;">"KEY_8"</span>),
    K(<span style="font-style: italic;">"C-Shift-l"</span>): K(<span style="font-style: italic;">"KEY_9"</span>),
    K(<span style="font-style: italic;">"C-Shift-semicolon"</span>): K(<span style="font-style: italic;">"KEY_0"</span>),
})


<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;"># [Conditional modmap] Change modifier keys in certain applications</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">define_conditional_modmap(re.compile(r'Emacs'), {</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;">Key.RIGHT_CTRL: Key.ESC,</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">})</span>

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;"># [Multipurpose modmap] Give a key two meanings. A normal key when pressed and</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;"># released, and a modifier key when held down with another key. See Xcape,</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;"># Carabiner and caps2esc for ideas and concept.</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">define_multipurpose_modmap(</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;"># Enter is enter when pressed and released. Control when held down.</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;">{Key.ENTER: [Key.ENTER, Key.RIGHT_CTRL]}</span>

<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;"># Capslock is escape when pressed and released. Control when held down.</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;"># {Key.CAPSLOCK: [Key.ESC, Key.LEFT_CTRL]</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;"># To use this example, you can't remap capslock with define_modmap.</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">)</span>


<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;"># Keybindings for Firefox/Chrome</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">define_keymap(re.compile("Firefox|Google-chrome"), {</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;"># Ctrl+Alt+j/k to switch next/previous tab</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;">K("C-M-j"): K("C-TAB"),</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;">K("C-M-k"): K("C-Shift-TAB"),</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;"># Type C-j to focus to the content</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;">K("C-j"): K("C-f6"),</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;"># very naive "Edit in editor" feature (just an example)</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;">K("C-o"): [K("C-a"), K("C-c"), launch(["gedit"]), sleep(0.5), K("C-v")]</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">}, "Firefox and Chrome")</span>

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;"># Keybindings for Zeal https://github.com/zealdocs/zeal/</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">define_keymap(re.compile("Zeal"), {</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;"># Ctrl+s to focus search area</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;">K("C-s"): K("C-k"),</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">}, "Zeal")</span>

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;"># Emacs-like keybindings in non-Emacs applications</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">define_keymap(lambda wm_class: wm_class not in ("Emacs", "URxvt"), {</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;"># Cursor</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;">K("C-b"): with_mark(K("left")),</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;">K("C-f"): with_mark(K("right")),</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;">K("C-p"): with_mark(K("up")),</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;">K("C-n"): with_mark(K("down")),</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;">K("C-h"): with_mark(K("backspace")),</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;"># Forward/Backward word</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;">K("M-b"): with_mark(K("C-left")),</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;">K("M-f"): with_mark(K("C-right")),</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;"># Beginning/End of line</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;">K("C-a"): with_mark(K("home")),</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;">K("C-e"): with_mark(K("end")),</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;"># Page up/down</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;">K("M-v"): with_mark(K("page_up")),</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;">K("C-v"): with_mark(K("page_down")),</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;"># Beginning/End of file</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;">K("M-Shift-comma"): with_mark(K("C-home")),</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;">K("M-Shift-dot"): with_mark(K("C-end")),</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;"># Newline</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;">K("C-m"): K("enter"),</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;">K("C-j"): K("enter"),</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;">K("C-o"): [K("enter"), K("left")],</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;"># Copy</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;">K("C-w"): [K("C-x"), set_mark(False)],</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;">K("M-w"): [K("C-c"), set_mark(False)],</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;">K("C-y"): [K("C-v"), set_mark(False)],</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;"># Delete</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;">K("C-d"): [K("delete"), set_mark(False)],</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;">K("M-d"): [K("C-delete"), set_mark(False)],</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;"># Kill line</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;">K("C-k"): [K("Shift-end"), K("C-x"), set_mark(False)],</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;"># Undo</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;">K("C-slash"): [K("C-z"), set_mark(False)],</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;">K("C-Shift-ro"): K("C-z"),</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;"># Mark</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;">K("C-space"): set_mark(True),</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;">K("C-M-space"): with_or_set_mark(K("C-right")),</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;"># Search</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;">K("C-s"): K("F3"),</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;">K("C-r"): K("Shift-F3"),</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;">K("M-Shift-key_5"): K("C-h"),</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;"># Cancel</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;">K("C-g"): [K("esc"), set_mark(False)],</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;"># Escape</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;">K("C-q"): escape_next_key,</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;"># C-x YYY</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;">K("C-x"): {</span>
<span style="font-weight: bold; font-style: italic;">#         </span><span style="font-weight: bold; font-style: italic;"># C-x h (select all)</span>
<span style="font-weight: bold; font-style: italic;">#         </span><span style="font-weight: bold; font-style: italic;">K("h"): [K("C-home"), K("C-a"), set_mark(True)],</span>
<span style="font-weight: bold; font-style: italic;">#         </span><span style="font-weight: bold; font-style: italic;"># C-x C-f (open)</span>
<span style="font-weight: bold; font-style: italic;">#         </span><span style="font-weight: bold; font-style: italic;">K("C-f"): K("C-o"),</span>
<span style="font-weight: bold; font-style: italic;">#         </span><span style="font-weight: bold; font-style: italic;"># C-x C-s (save)</span>
<span style="font-weight: bold; font-style: italic;">#         </span><span style="font-weight: bold; font-style: italic;">K("C-s"): K("C-s"),</span>
<span style="font-weight: bold; font-style: italic;">#         </span><span style="font-weight: bold; font-style: italic;"># C-x k (kill tab)</span>
<span style="font-weight: bold; font-style: italic;">#         </span><span style="font-weight: bold; font-style: italic;">K("k"): K("C-f4"),</span>
<span style="font-weight: bold; font-style: italic;">#         </span><span style="font-weight: bold; font-style: italic;"># C-x C-c (exit)</span>
<span style="font-weight: bold; font-style: italic;">#         </span><span style="font-weight: bold; font-style: italic;">K("C-c"): K("C-q"),</span>
<span style="font-weight: bold; font-style: italic;">#         </span><span style="font-weight: bold; font-style: italic;"># cancel</span>
<span style="font-weight: bold; font-style: italic;">#         </span><span style="font-weight: bold; font-style: italic;">K("C-g"): pass_through_key,</span>
<span style="font-weight: bold; font-style: italic;">#         </span><span style="font-weight: bold; font-style: italic;"># C-x u (undo)</span>
<span style="font-weight: bold; font-style: italic;">#         </span><span style="font-weight: bold; font-style: italic;">K("u"): [K("C-z"), set_mark(False)],</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;">}</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">}, "Emacs-like keys")</span>
</pre>
</div></li>
<li><p>
xkeysnail.service
</p>
<div class="org-src-container">
<pre class="src src-conf">[<span style="font-weight: bold; text-decoration: underline;">Unit</span>]
<span style="font-weight: bold; font-style: italic;">Description</span>=xkeysnail

[<span style="font-weight: bold; text-decoration: underline;">Service</span>]
<span style="font-weight: bold; font-style: italic;">KillMode</span>=process
<span style="font-weight: bold; font-style: italic;">ExecStart</span>=/bin/bash -ic <span style="font-style: italic;">'%h/.local/bin/pwsudo %h/.guix-extra-profiles/desktop/desktop/bin/xkeysnail --watch --quiet %h/.config/xkeysnail/config.py'</span>
<span style="font-weight: bold; font-style: italic;">Type</span>=simple
<span style="font-weight: bold; font-style: italic;">Restart</span>=always
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Update DISPLAY to be the same as `echo $DISPLAY` on your graphical terminal.</span>
<span style="font-weight: bold; font-style: italic;">Environment</span>=DISPLAY=:0

[<span style="font-weight: bold; text-decoration: underline;">Install</span>]
<span style="font-weight: bold; font-style: italic;">WantedBy</span>=default.target
</pre>
</div></li>
</ul>
</div>
<div id="outline-container-orgb45b88f" class="outline-4">
<h4 id="orgb45b88f">how to make xkeysnail daemonize</h4>
<div class="outline-text-4" id="text-orgb45b88f">
<ol class="org-ol">
<li>Install xkeysnail on guix</li>
<li><p>
Start systemd service for xkeysnail
</p>
<pre class="example">
$ systemctl --user enable xkeysnail
$ systemctl --user start xkeysnail

</pre></li>
</ol>
</div>
</div>
</div>
<div id="outline-container-org9b69904" class="outline-3">
<h3 id="org9b69904">GnuPG (gpg)</h3>
<div class="outline-text-3" id="text-org9b69904">
<p>
<a href="https://wiki.archlinux.org/title/GnuPG">GnuPG - ArchWiki</a>
</p>

<ul class="org-ul">
<li><p>
gpg config
</p>
<div class="org-src-container">
<pre class="src src-conf">with-keygrip
</pre>
</div></li>
<li><p>
gpg-agent config
</p>
<div class="org-src-container">
<pre class="src src-conf"><span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">pinentry-program /usr/bin/pinentry-curses</span>
pinentry-program /usr/bin/pinentry
allow-emacs-pinentry
allow-loopback-pinentry
enable-ssh-support
<span style="font-weight: bold; font-style: italic;">max-cache-ttl &lt;&lt;hours-in-sec(h</span>=700)&gt;&gt;
<span style="font-weight: bold; font-style: italic;">default-cache-ttl &lt;&lt;hours-in-sec(h</span>=700)&gt;&gt;
<span style="font-weight: bold; font-style: italic;">default-cache-ttl-ssh &lt;&lt;hours-in-sec(h</span>=48)&gt;&gt;
</pre>
</div></li>
<li><p>
mandatory config to use pinentry-curses for gpg-agent
</p>

<div class="org-src-container">
<pre class="src src-shell"><span style="font-weight: bold;">export</span> <span style="font-weight: bold; font-style: italic;">GPG_TTY</span>=$(tty)

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Refresh gpg-agent tty in case user switches into an X session</span>
gpg-connect-agent updatestartuptty /bye &gt;/dev/null
</pre>
</div>

<div class="org-src-container">
<pre class="src src-conf">Match host * exec <span style="font-style: italic;">"gpg-connect-agent UPDATESTARTUPTTY /bye"</span>
</pre>
</div></li>
</ul>
</div>
</div>

<div id="outline-container-org3a12b54" class="outline-3">
<h3 id="org3a12b54">GNU Guix</h3>
<div class="outline-text-3" id="text-org3a12b54">
<div class="org-src-container">
<pre class="src src-shell"><span style="font-weight: bold; font-style: italic;">GUIX_EXTRA_PROFILES</span>=$<span style="font-weight: bold; font-style: italic;">HOME</span>/.guix-extra-profiles

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">fill in a variable below like a comment line</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">if you'd like to acticate specific profiles under GUIX_EXTRA_PROFILES</span>
<span style="font-weight: bold; font-style: italic;">ACTIVE_PROFILE_NAMES</span>=()
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">ACTIVE_PROFILE_NAMES=(base emacs)</span>

<span style="font-weight: bold; font-style: italic;">profiles</span>=()
<span style="font-weight: bold;">if</span> [ ${#<span style="font-weight: bold; font-style: italic;">ACTIVE_PROFILE_NAMES</span>[@]} -eq 0 ]; <span style="font-weight: bold;">then</span>
  <span style="font-weight: bold; font-style: italic;">profiles</span>=<span style="font-style: italic;">"${GUIX_EXTRA_PROFILES}/*"</span>
<span style="font-weight: bold;">else</span>
  <span style="font-weight: bold;">for</span> name<span style="font-weight: bold;"> in</span> ${<span style="font-weight: bold; font-style: italic;">ACTIVE_PROFILE_NAMES</span>[@]}; <span style="font-weight: bold;">do</span>
    profiles+=(<span style="font-style: italic;">"${GUIX_EXTRA_PROFILES}/${name}"</span>)
  <span style="font-weight: bold;">done</span>
<span style="font-weight: bold;">fi</span>

<span style="font-weight: bold;">for</span> profile<span style="font-weight: bold;"> in</span> ${<span style="font-weight: bold; font-style: italic;">profiles</span>[@]}; <span style="font-weight: bold;">do</span>
  <span style="font-weight: bold; font-style: italic;">GUIX_PROFILE</span>=<span style="font-style: italic;">"${profile}/$(basename ${profile})"</span>
  <span style="font-weight: bold;">if</span> [ -f ${<span style="font-weight: bold; font-style: italic;">GUIX_PROFILE</span>}/etc/profile ]; <span style="font-weight: bold;">then</span>
    . <span style="font-style: italic;">"${GUIX_PROFILE}"</span>/etc/profile
  <span style="font-weight: bold;">fi</span>
<span style="font-weight: bold;">done</span>

<span style="font-weight: bold;">export</span> <span style="font-weight: bold; font-style: italic;">GUIX_PROFILE</span>=<span style="font-style: italic;">"$HOME/.guix-profile"</span>
. <span style="font-style: italic;">"$GUIX_PROFILE/etc/profile"</span>

<span style="font-weight: bold;">export</span> <span style="font-weight: bold; font-style: italic;">GUIX_PROFILE</span>=<span style="font-style: italic;">"$HOME/.config/guix/current"</span>
. <span style="font-style: italic;">"$GUIX_PROFILE/etc/profile"</span>

<span style="font-weight: bold;">export</span> <span style="font-weight: bold; font-style: italic;">GUIX_LOCPATH</span>=<span style="font-style: italic;">"$HOME/.guix-profile/lib/locale"</span>
</pre>
</div>
</div>

<div id="outline-container-org7fd33a3" class="outline-4">
<h4 id="org7fd33a3">Channel definitions</h4>
<div class="outline-text-4" id="text-org7fd33a3">
<div class="org-src-container">
<pre class="src src-scheme">(list (channel
       (name 'flat)
       (url <span style="font-style: italic;">"https://github.com/flatwhatson/guix-channel.git"</span>))
      (channel
       (name 'nonguix)
       (url <span style="font-style: italic;">"https://gitlab.com/nonguix/nonguix"</span>))
      (channel
       (name 'guix)
       (url <span style="font-style: italic;">"https://git.savannah.gnu.org/git/guix.git"</span>)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org992ef33" class="outline-4">
<h4 id="org992ef33">Manifests</h4>
<div class="outline-text-4" id="text-org992ef33">
<ul class="org-ul">
<li><p>
base
</p>
<div class="org-src-container">
<pre class="src src-scheme">(specifications-&gt;manifest
 '(<span style="font-style: italic;">"coreutils"</span>
   <span style="font-style: italic;">"findutils"</span>
   <span style="font-style: italic;">"diffutils"</span>
   <span style="font-style: italic;">"moreutils"</span>
   <span style="font-style: italic;">"gawk"</span>
   <span style="font-style: italic;">"sed"</span>
   <span style="font-style: italic;">"tar"</span>
   <span style="font-style: italic;">"zip"</span>
   <span style="font-style: italic;">"unzip"</span>
   <span style="font-style: italic;">"zstd"</span>
   <span style="font-style: italic;">"shadow"</span>
   <span style="font-style: italic;">"sshfs"</span>
   <span style="font-style: italic;">"grep"</span>
   <span style="font-style: italic;">"ripgrep"</span>
   <span style="font-style: italic;">"less"</span>
   <span style="font-style: italic;">"gnupg"</span>
   <span style="font-style: italic;">"pwgen"</span>
   <span style="font-style: italic;">"file"</span>
   <span style="font-style: italic;">"nkf"</span>
   <span style="font-style: italic;">"lsof"</span>
   <span style="font-style: italic;">"tree"</span>
   <span style="font-style: italic;">"poppler"</span>
   <span style="font-style: italic;">"pass-git-helper"</span>
   <span style="font-style: italic;">"git"</span>
   <span style="font-style: italic;">"stow"</span>
   <span style="font-style: italic;">"pandoc"</span>
   <span style="font-style: italic;">"nss-certs"</span>
   <span style="font-style: italic;">"openssl"</span>
   <span style="font-style: italic;">"glibc-locales"</span>
   <span style="font-style: italic;">"procps"</span>
   <span style="font-style: italic;">"time"</span>
   <span style="font-style: italic;">"htop"</span>
   <span style="font-style: italic;">"net-tools"</span>
   <span style="font-style: italic;">"curl"</span>
   <span style="font-style: italic;">"wget"</span>
   <span style="font-style: italic;">"rsync"</span>
   <span style="font-style: italic;">"speedtest-cli"</span>
   <span style="font-style: italic;">"ddrescue"</span>
   <span style="font-style: italic;">"sqlite"</span>
   <span style="font-style: italic;">"openssh"</span>
   <span style="font-style: italic;">"ghq"</span>
   <span style="font-style: italic;">"password-store"</span>))
</pre>
</div></li>
<li><p>
desktop
</p>
<div class="org-src-container">
<pre class="src src-scheme">(specifications-&gt;manifest
 '(<span style="font-style: italic;">"font-adobe-source-han-sans"</span>
   <span style="font-style: italic;">"fontconfig"</span>
   <span style="font-style: italic;">"xkeysnail"</span>
   <span style="font-style: italic;">"imagemagick"</span>
   <span style="font-style: italic;">"pulseaudio"</span>
   <span style="font-style: italic;">"gparted"</span>
   <span style="font-style: italic;">"abcde"</span>
   <span style="font-style: italic;">"cdrtools"</span>
   <span style="font-style: italic;">"dvdbackup"</span>
   <span style="font-style: italic;">"easytag"</span>
   <span style="font-style: italic;">"libdvdnav"</span>
   <span style="font-style: italic;">"vlc"</span>
   <span style="font-style: italic;">"handbrake"</span>
   <span style="font-style: italic;">"youtube-dl"</span>
   <span style="font-style: italic;">"mpv"</span>
   <span style="font-style: italic;">"ffmpeg"</span>
   <span style="font-style: italic;">"libdvdcss"</span>
   <span style="font-style: italic;">"dav1d"</span>
   <span style="font-style: italic;">"xrandr"</span>
   <span style="font-style: italic;">"dvd+rw-tools"</span>))
</pre>
</div></li>
<li><p>
media
</p>
<div class="org-src-container">
<pre class="src src-scheme">(specifications-&gt;manifest
 '(<span style="font-style: italic;">"krita"</span>
   <span style="font-style: italic;">"gimp"</span>
   <span style="font-style: italic;">"kdenlive"</span>
   <span style="font-style: italic;">"obs"</span>
   <span style="font-style: italic;">"gcompris-qt"</span>
   <span style="font-style: italic;">"qjackctl"</span>
   <span style="font-style: italic;">"qsynth"</span>
   <span style="font-style: italic;">"jack-keyboard"</span>))
</pre>
</div></li>
<li><p>
devel (software development)
</p>
<div class="org-src-container">
<pre class="src src-scheme">(specifications-&gt;manifest
 '(<span style="font-style: italic;">"binutils"</span>
   <span style="font-style: italic;">"make"</span>
   <span style="font-style: italic;">"llvm"</span>
   <span style="font-style: italic;">"cmake"</span>
   <span style="font-style: italic;">"libtool"</span>
   <span style="font-style: italic;">"texinfo"</span>
   <span style="font-style: italic;">"shellcheck"</span>
   <span style="font-style: italic;">"global"</span>
   <span style="font-style: italic;">"mit-scheme"</span>))
</pre>
</div></li>
<li><p>
emacs
</p>
<div class="org-src-container">
<pre class="src src-scheme">(specifications-&gt;manifest
 '(<span style="font-style: italic;">"emacs"</span>
   <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">"emacs-no-x-toolkit"</span>
   <span style="font-style: italic;">"emacs-use-package"</span>
   <span style="font-style: italic;">"emacs-diminish"</span>
   <span style="font-style: italic;">"emacs-delight"</span>
   <span style="font-style: italic;">"emacs-ddskk"</span>
   <span style="font-style: italic;">"emacs-modus-themes"</span>
   <span style="font-style: italic;">"mu"</span>
   <span style="font-style: italic;">"emacs-mu4e-alert"</span>
   <span style="font-style: italic;">"emacs-elfeed"</span>
   <span style="font-style: italic;">"emacs-elfeed-org"</span>
   <span style="font-style: italic;">"emacs-dired-rsync"</span>
   <span style="font-style: italic;">"emacs-dired-hacks"</span>
   <span style="font-style: italic;">"emacs-vterm"</span>
   <span style="font-style: italic;">"emacs-org"</span>
   <span style="font-style: italic;">"gnuplot"</span>
   <span style="font-style: italic;">"emacs-gnuplot"</span>
   <span style="font-style: italic;">"emacs-mkmcc-gnuplot-mode"</span>
   <span style="font-style: italic;">"graphviz"</span>
   <span style="font-style: italic;">"plantuml"</span>
   <span style="font-style: italic;">"emacs-ob-async"</span>
   <span style="font-style: italic;">"emacs-ox-hugo"</span>
   <span style="font-style: italic;">"emacs-org-contacts"</span>
   <span style="font-style: italic;">"emacs-org-reveal"</span>
   <span style="font-style: italic;">"emacs-org-roam"</span>
   <span style="font-style: italic;">"emacs-org-drill"</span>
   <span style="font-style: italic;">"emacs-org-mime"</span>
   <span style="font-style: italic;">"emacs-org-web-tools"</span>
   <span style="font-style: italic;">"emacs-vertico"</span>
   <span style="font-style: italic;">"emacs-consult"</span>
   <span style="font-style: italic;">"emacs-consult-dir"</span>
   <span style="font-style: italic;">"emacs-embark"</span>
   <span style="font-style: italic;">"emacs-marginalia"</span>
   <span style="font-style: italic;">"emacs-orderless"</span>
   <span style="font-style: italic;">"emacs-company-jedi"</span>
   <span style="font-style: italic;">"emacs-inf-ruby"</span>
   <span style="font-style: italic;">"emacs-yaml-mode"</span>
   <span style="font-style: italic;">"emacs-lua-mode"</span>
   <span style="font-style: italic;">"emacs-web-mode"</span>
   <span style="font-style: italic;">"emacs-js2-mode"</span>
   <span style="font-style: italic;">"emacs-project"</span>
   <span style="font-style: italic;">"emacs-plantuml-mode"</span>
   <span style="font-style: italic;">"emacs-magit"</span>
   <span style="font-style: italic;">"emacs-git-modes"</span>
   <span style="font-style: italic;">"emacs-orgit"</span>
   <span style="font-style: italic;">"emacs-wgrep"</span>
   <span style="font-style: italic;">"emacs-dumb-jump"</span>
   <span style="font-style: italic;">"emacs-visual-regexp"</span>
   <span style="font-style: italic;">"emacs-avy"</span>
   <span style="font-style: italic;">"emacs-paredit"</span>
   <span style="font-style: italic;">"emacs-lsp-mode"</span>
   <span style="font-style: italic;">"emacs-company"</span>
   <span style="font-style: italic;">"emacs-flycheck"</span>
   <span style="font-style: italic;">"emacs-undo-tree"</span>
   <span style="font-style: italic;">"emacs-expand-region"</span>
   <span style="font-style: italic;">"emacs-helpful"</span>
   <span style="font-style: italic;">"emacs-synosaurus"</span>
   <span style="font-style: italic;">"emacs-exec-path-from-shell"</span>
   <span style="font-style: italic;">"emacs-aggressive-indent"</span>
   <span style="font-style: italic;">"emacs-adaptive-wrap"</span>
   <span style="font-style: italic;">"emacs-restart-emacs"</span>
   <span style="font-style: italic;">"emacs-which-key"</span>
   <span style="font-style: italic;">"emacs-hydra"</span>
   <span style="font-style: italic;">"emacs-pass"</span>
   <span style="font-style: italic;">"emacs-password-store"</span>
   <span style="font-style: italic;">"emacs-nov-el"</span>
   <span style="font-style: italic;">"emacs-yasnippet"</span>
   <span style="font-style: italic;">"emacs-yasnippet-snippets"</span>
   <span style="font-style: italic;">"emacs-pdf-tools"</span>
   <span style="font-style: italic;">"emacs-rainbow-mode"</span>
   <span style="font-style: italic;">"mpg321"</span>
   <span style="font-style: italic;">"emacs-alert"</span>
   <span style="font-style: italic;">"emacs-ts"</span>
   <span style="font-style: italic;">"emacs-tldr"</span>
   <span style="font-style: italic;">"festival"</span>
   <span style="font-style: italic;">"lilypond"</span>
   <span style="font-style: italic;">"isync"</span>
   <span style="font-style: italic;">"stunnel"</span>
   <span style="font-style: italic;">"wordnet"</span>))
</pre>
</div></li>
<li><p>
wine
</p>
<div class="org-src-container">
<pre class="src src-scheme">(specifications-&gt;manifest
 '(<span style="font-style: italic;">"wine64"</span>
   <span style="font-style: italic;">"winetricks"</span>))
</pre>
</div></li>
</ul>
</div>
</div>
<div id="outline-container-org11b8004" class="outline-4">
<h4 id="org11b8004">Activating Profiles</h4>
<div class="outline-text-4" id="text-org11b8004">
<p>
This script accepts a space-separated list of manifest file names (without extension) under the <code>~/.config/guix/manifests</code> folder and then installs those profiles for the first time.  For example:
</p>

<pre class="example">
activate-profiles base emacs

</pre>

<div class="org-src-container">
<pre class="src src-sh"><span style="font-weight: bold; font-style: italic;">GREEN</span>=<span style="font-style: italic;">'\033[1;32m'</span>
<span style="font-weight: bold; font-style: italic;">RED</span>=<span style="font-style: italic;">'\033[1;30m'</span>
<span style="font-weight: bold; font-style: italic;">NC</span>=<span style="font-style: italic;">'\033[0m'</span>
<span style="font-weight: bold; font-style: italic;">GUIX_EXTRA_PROFILES</span>=$<span style="font-weight: bold; font-style: italic;">HOME</span>/.guix-extra-profiles

<span style="font-weight: bold; font-style: italic;">profiles</span>=$<span style="font-weight: bold; font-style: italic;">*</span>
<span style="font-weight: bold;">if</span> [ $<span style="font-weight: bold; font-style: italic;">#</span> -eq 0 ]; <span style="font-weight: bold;">then</span>
    <span style="font-weight: bold; font-style: italic;">profiles</span>=<span style="font-style: italic;">"$HOME/.config/guix/manifests/*.scm"</span>;
<span style="font-weight: bold;">fi</span>

<span style="font-weight: bold;">for</span> profile<span style="font-weight: bold;"> in</span> $<span style="font-weight: bold; font-style: italic;">profiles</span>; <span style="font-weight: bold;">do</span>
  <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Remove the path and file extension, if any</span>
  <span style="font-weight: bold; font-style: italic;">profileName</span>=$(basename $<span style="font-weight: bold; font-style: italic;">profile</span>)
  <span style="font-weight: bold; font-style: italic;">profileName</span>=<span style="font-style: italic;">"${profileName%.*}"</span>
  <span style="font-weight: bold; font-style: italic;">profilePath</span>=<span style="font-style: italic;">"$GUIX_EXTRA_PROFILES/$profileName"</span>
  <span style="font-weight: bold; font-style: italic;">manifestPath</span>=$<span style="font-weight: bold; font-style: italic;">HOME</span>/.config/guix/manifests/$<span style="font-weight: bold; font-style: italic;">profileName</span>.scm

  <span style="font-weight: bold;">if</span> [ -f $<span style="font-weight: bold; font-style: italic;">manifestPath</span> ]; <span style="font-weight: bold;">then</span>
    <span style="font-weight: bold;">echo</span>
    <span style="font-weight: bold;">echo</span> -e <span style="font-style: italic;">"${GREEN}Activating profile:"</span> $<span style="font-weight: bold; font-style: italic;">manifestPath</span> <span style="font-style: italic;">"${NC}"</span>
    <span style="font-weight: bold;">echo</span>

    mkdir -p $<span style="font-weight: bold; font-style: italic;">profilePath</span>
    guix package --manifest=$<span style="font-weight: bold; font-style: italic;">manifestPath</span> --profile=<span style="font-style: italic;">"$profilePath/$profileName"</span>

    <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Source the new profile</span>
    <span style="font-weight: bold; font-style: italic;">GUIX_PROFILE</span>=<span style="font-style: italic;">"$profilePath/$profileName"</span>
    <span style="font-weight: bold;">if</span> [ -f $<span style="font-weight: bold; font-style: italic;">GUIX_PROFILE</span>/etc/profile ]; <span style="font-weight: bold;">then</span>
        . <span style="font-style: italic;">"$GUIX_PROFILE"</span>/etc/profile
    <span style="font-weight: bold;">else</span>
        <span style="font-weight: bold;">echo</span> -e <span style="font-style: italic;">"${RED}Couldn't find profile:"</span> $<span style="font-weight: bold; font-style: italic;">GUIX_PROFILE</span>/etc/profile <span style="font-style: italic;">"${NC}"</span>
    <span style="font-weight: bold;">fi</span>
  <span style="font-weight: bold;">else</span>
    <span style="font-weight: bold;">echo</span> <span style="font-style: italic;">"No profile found at path"</span> $<span style="font-weight: bold; font-style: italic;">profilePath</span>
  <span style="font-weight: bold;">fi</span>
<span style="font-weight: bold;">done</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org760b510" class="outline-4">
<h4 id="org760b510">Updating Channels</h4>
<div class="outline-text-4" id="text-org760b510">
<p>
This script makes it easy to update all channels to the latest commit based on an original channel file.
</p>

<pre class="example">
update-channels

</pre>

<p>
You can use ~/.config/guix/channels.scm to replicate exact packages on another machine with
</p>

<pre class="example">
guix pull -C ~/.config/guix/channels.scm

</pre>

<div class="org-src-container">
<pre class="src src-sh">guix pull --channels=$<span style="font-weight: bold; font-style: italic;">HOME</span>/.config/guix/base-channels.scm
guix describe --format=channels &gt; ~/.config/guix/channels.scm
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orga2db21f" class="outline-3">
<h3 id="orga2db21f">SKK</h3>
<div class="outline-text-3" id="text-orga2db21f">
<p>
SKK is Simple Kana to Kanji conversion program, an input method of Japanese.
</p>

<ul class="org-ul">
<li>TODO: following programs have no guix package.
It is better to write my own one for my reproducible system.
<ul class="org-ul">
<li class="off"><code>[&#xa0;]</code> <a href="https://github.com/skk-dev/skktools">skktools</a></li>
<li class="off"><code>[&#xa0;]</code> ibus-skk</li>
</ul></li>
</ul>
</div>

<div id="outline-container-org5acc3f7" class="outline-4">
<h4 id="org5acc3f7">derive unique entries in user-jisyo</h4>
<div class="outline-text-4" id="text-org5acc3f7">
<div class="org-src-container">
<pre class="src src-shell"><span style="font-weight: bold; font-style: italic;">tmp_euc</span>=$(mktemp)
<span style="font-weight: bold; font-style: italic;">tmp_utf8</span>=$(mktemp)
<span style="font-weight: bold; font-style: italic;">skk_get_dir</span>=~/share/skk/get-jisyo
<span style="font-weight: bold; font-style: italic;">skk_dotskk_dir</span>=~/.config/skk
<span style="font-weight: bold; font-style: italic;">dic_orig</span>=${<span style="font-weight: bold; font-style: italic;">skk_dotskk_dir</span>}/jisyo
<span style="font-weight: bold; font-style: italic;">dic_uniq</span>=${<span style="font-weight: bold; font-style: italic;">skk_dotskk_dir</span>}/jisyo.uniq

skkdic-expr2 ${<span style="font-weight: bold; font-style: italic;">skk_get_dir</span>}/SKK-JISYO.* &gt; ${<span style="font-weight: bold; font-style: italic;">tmp_euc</span>}
nkf -w -Lu ${<span style="font-weight: bold; font-style: italic;">tmp_euc</span>} &gt; ${<span style="font-weight: bold; font-style: italic;">tmp_utf8</span>}
skkdic-expr2 ${<span style="font-weight: bold; font-style: italic;">dic_orig</span>} - ${<span style="font-weight: bold; font-style: italic;">tmp_utf8</span>} &gt; ${<span style="font-weight: bold; font-style: italic;">dic_uniq</span>}

rm -f ${<span style="font-weight: bold; font-style: italic;">tmp_euc</span>}
rm -f ${<span style="font-weight: bold; font-style: italic;">tmp_utf8</span>}

<span style="font-weight: bold;">echo</span> ${<span style="font-weight: bold; font-style: italic;">dic_uniq</span>}
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org6bb762b" class="outline-3">
<h3 id="org6bb762b">Festival</h3>
<div class="outline-text-3" id="text-org6bb762b">
<p>
<a href="http://festvox.org/festival/">Festival</a> is a framework for building and manipulating speech synthesis engine.
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"festival"</span>
</pre>
</div>

<ul class="org-ul">
<li><p>
configuration
</p>
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">-*- mode:scheme; -*-</span>
(Parameter.set 'Audio_Required_Format 'aiff)
(Parameter.set 'Audio_Method 'Audio_Command)
(Parameter.set 'Audio_Command <span style="font-style: italic;">"paplay $FILE --client-name=Festival --stream-name=Speech"</span>)

<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">add SLT voice and use it as a default one</span>
(voice-location 'cmu_us_slt_cg
                (path-as-directory <span style="font-style: italic;">"&lt;&lt;home-dir()&gt;&gt;/.local/share/festival/lib/voices/us/cmu_us_slt_cg"</span>)
                <span style="font-style: italic;">"English American Female"</span>)
(set! voice_default voice_cmu_us_slt_cg)
</pre>
</div></li>
<li><p>
a script to download voices
</p>

<div class="org-src-container">
<pre class="src src-shell"><span style="font-weight: bold; font-style: italic;">work_dir</span>=~/.local/share/festival
<span style="font-weight: bold; font-style: italic;">voices</span>=(
  cmu_us_aew_cg
  cmu_us_rxr_cg
  cmu_us_slt_cg
)

<span style="font-weight: bold;">if</span> [ ! -d <span style="font-style: italic;">"${work_dir}"</span> ]; <span style="font-weight: bold;">then</span>
  mkdir -p <span style="font-style: italic;">"${work_dir}"</span>
<span style="font-weight: bold;">fi</span>

<span style="font-weight: bold;">cd</span> <span style="font-style: italic;">"${work_dir}"</span>
<span style="font-weight: bold;">for</span> voice<span style="font-weight: bold;"> in</span> <span style="font-style: italic;">"${voices[@]}"</span>; <span style="font-weight: bold;">do</span>
  <span style="font-weight: bold; font-style: italic;">voice_pack_file</span>=festvox_${<span style="font-weight: bold; font-style: italic;">voice</span>}.tar.gz
  <span style="font-weight: bold;">if</span> [ ! -e ${<span style="font-weight: bold; font-style: italic;">voice_pack_file</span>} ]; <span style="font-weight: bold;">then</span>
    wget -c http://festvox.org/packed/festival/2.5/voices/${<span style="font-weight: bold; font-style: italic;">voice_pack_file</span>}
    tar zxf <span style="font-style: italic;">"${voice_pack_file}"</span> -C ../../share
  <span style="font-weight: bold;">fi</span>
<span style="font-weight: bold;">done</span>

<span style="font-weight: bold;">echo</span> <span style="font-style: italic;">"${work_dir}"</span>
</pre>
</div></li>
<li><p>
festival.el
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package festival
  <span style="font-weight: bold;">:config</span>
  (say-minor-mode 1)
  (<span style="font-weight: bold;">setq</span> festival-tmp-file (make-temp-file <span style="font-style: italic;">"festival-"</span>)))
</pre>
</div></li>
</ul>
</div>
</div>
<div id="outline-container-orgcc0e467" class="outline-3">
<h3 id="orgcc0e467">Open JTalk</h3>
<div class="outline-text-3" id="text-orgcc0e467">
<ul class="org-ul">
<li><p>
install on Ubuntu
</p>
<pre class="example">
sudo apt install -y \
     open-jtalk \
     open-jtalk-mecab-naist-jdic \
     hts-voice-nitech-jp-atr503-m001
</pre></li>
<li><p>
download hts voices
</p>

<div class="org-src-container">
<pre class="src src-shell"><span style="font-weight: bold; font-style: italic;">data_dir</span>=~/.local/share/hts-voice

<span style="font-weight: bold;">if</span> [ ! -d <span style="font-style: italic;">"${data_dir}"</span> ]; <span style="font-weight: bold;">then</span>
  mkdir -p <span style="font-style: italic;">"${data_dir}"</span>
<span style="font-weight: bold;">fi</span>

<span style="font-weight: bold;">cd</span> /tmp <span style="font-style: italic;">\</span>
  &amp;&amp; wget http://sourceforge.net/projects/mmdagent/files/MMDAgent_Example/MMDAgent_Example-1.8/MMDAgent_Example-1.8.zip <span style="font-style: italic;">\</span>
  &amp;&amp; unzip -f -qq MMDAgent_Example-1.8.zip <span style="font-style: italic;">\</span>
  &amp;&amp; rm -f MMDAgent_Example-1.8.zip <span style="font-style: italic;">\</span>
  &amp;&amp; cp -rf MMDAgent_Example-1.8/Voice/* <span style="font-style: italic;">"${data_dir}"</span> <span style="font-style: italic;">\</span>
  &amp;&amp; <span style="font-weight: bold;">echo</span> <span style="font-style: italic;">"Downloaded in ${data_dir}"</span>
</pre>
</div></li>
</ul>
</div>
</div>

<div id="outline-container-org76b54cd" class="outline-3">
<h3 id="org76b54cd">Jack</h3>
<div class="outline-text-3" id="text-org76b54cd">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"qjackctl"</span>
<span style="font-style: italic;">"qsynth"</span>
<span style="font-style: italic;">"jack-keyboard"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-conf">/usr/bin/jackd -dalsa -dhw:0 -r44100 -p1024 -n3 -Xseq
</pre>
</div>
</div>
</div>

<div id="outline-container-org344e882" class="outline-3">
<h3 id="org344e882">XRandR</h3>
<div class="outline-text-3" id="text-org344e882">
<p>
XRandR is a command line utility for changing display options without restarting X server.
</p>

<p>
<a href="https://wiki.archlinux.org/title/xrandr">xrandr - ArchWiki</a>
</p>

<ul class="org-ul">
<li><p>
show avaulable modes for all displays
</p>
<div class="org-src-container">
<pre class="src src-shell">xrandr
</pre>
</div></li>

<li><p>
change mode (resolution) to 1920x1080 for a display identified as "HDMI-2"
</p>
<div class="org-src-container">
<pre class="src src-shell">xrandr --output HDMI-2 --mode 1920x1080
</pre>
</div></li>

<li><p>
change mode back to preferred (maximum)
</p>
<div class="org-src-container">
<pre class="src src-shell">xrandr --output HDMI-2 --auto
</pre>
</div></li>
</ul>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"xrandr"</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-orgf66e72d" class="outline-3">
<h3 id="orgf66e72d"><a id="ID-9ac77d59-90bd-4054-89c9-dcab29bd7462"></a>C/Migemo</h3>
<div class="outline-text-3" id="text-orgf66e72d">
<p>
<a href="https://github.com/koron/cmigemo">C/Migemo</a> allows me to search Japanese with incremental ASCII charactor input.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-style: italic;">"https://github.com/koron/cmigemo/releases.atom"</span> soft_update)
</pre>
</div>

<p>
If you are AZIK lover, replace /usr/share/cmigemo/utf-8/roma2hira.dat with data file below to type in AZIK style.
</p>

<div class="org-src-container">
<pre class="src src-text"># vi:set ts=8 sts=8 sw=8 tw=0:
#
# roma2hira.dat - &#12525;&#12540;&#12510;&#23383;&#8594;&#24179;&#20206;&#21517;&#22793;&#25563;&#34920;
#
# Last Change: 18-Oct-2003.
# Written By:  Muraoka Taro  <a href="mailto:koron%40tka.att.ne.jp">&lt;koron@tka.att.ne.jp&gt;</a>

# &#12371;&#12356;&#12388;&#12434;&#12459;&#12473;&#12479;&#12510;&#12452;&#12474;&#12377;&#12427;&#12371;&#12392;&#12391;&#12525;&#12540;&#12510;&#23383;&#12398;&#20837;&#21147;&#26041;&#24335;&#12364;&#22793;&#12431;&#12426;&#12414;&#12377;&#12290;
# &#29694;&#22312;&#12399;MS-IME2000&#12434;&#21442;&#32771;&#12395;&#27770;&#23450;&#12375;&#12390;&#12356;&#12414;&#12377;&#12290;
# &#28450;&#23383;&#12467;&#12540;&#12489;&#12398;&#36949;&#12356;&#12434;&#21560;&#21454;&#12377;&#12427;&#24441;&#21106;&#12418;&#26524;&#12383;&#12375;&#12414;&#12377;&#12290;
# xn&#12392;xtu&#12395;&#12399;&#12300;&#12435;&#12301;&#12392;&#12300;&#12387;&#12301;&#12434;&#25351;&#23450;&#12377;&#12427;&#24441;&#21106;&#12364;&#12354;&#12426;&#12414;&#12377;&#12290;
# {from} {to}&#12398;&#24418;&#24335;&#12391;&#12377;&#12290;
# &#29694;&#22312;&#12399;{from}&#12399;&#26368;&#22823;7&#12496;&#12452;&#12488;&#12414;&#12391;{to}&#12399;6&#12496;&#12452;&#12488;&#12414;&#12391;&#12392;&#12394;&#12387;&#12390;&#12356;&#12414;&#12377;&#12290;
# {from}&#12392;{to}&#12398;&#38291;&#12399;&#31354;&#30333;&#25991;&#23383;(isspace())&#12391;&#21306;&#20999;&#12426;&#12414;&#12377;&#12290;

# http://asiamoth.com/mt/archives/2006-08/05_2313.php

-       &#12540;
~       &#12316;
,       &#12289;
.       &#12290;
:       &#12540;
[       &#12300;
]       &#12301;
;       &#12387;
a       &#12354;
ba      &#12400;
bd      &#12409;&#12435;
be      &#12409;
bh      &#12406;&#12358;
bi      &#12403;
bj      &#12406;&#12435;
bk      &#12403;&#12435;
bl      &#12412;&#12435;
bn      &#12400;&#12435;
bo      &#12412;
bp      &#12412;&#12358;
bq      &#12400;&#12356;
bt      &#12403;&#12392;
bu      &#12406;
bv      &#12403;&#12421;&#12358;
bw      &#12409;&#12356;
bx      &#12403;&#12423;&#12358;
bya     &#12403;&#12419;
byj     &#12403;&#12421;&#12435;
byo     &#12403;&#12423;
byp     &#12403;&#12423;&#12358;
byu     &#12403;&#12421;
bz      &#12400;&#12435;
ca      &#12385;&#12419;
cd      &#12385;&#12359;&#12435;
ce      &#12385;&#12359;
cf      &#12385;&#12359;
ch      &#12385;&#12421;&#12358;
ci      &#12385;
cj      &#12385;&#12421;&#12435;
ck      &#12385;&#12435;
cl      &#12385;&#12423;&#12435;
cn      &#12385;&#12419;&#12435;
co      &#12385;&#12423;
cp      &#12385;&#12423;&#12358;
cq      &#12385;&#12419;&#12356;
cu      &#12385;&#12421;
cz      &#12385;&#12419;&#12435;
da      &#12384;
dch     &#12393;&#12357;&#12540;
dci     &#12391;&#12355;
dcj     &#12393;&#12357;&#12435;
dck     &#12391;&#12355;&#12435;
dcu     &#12393;&#12357;
dd      &#12391;&#12435;
de      &#12391;
df      &#12391;
dga     &#12386;&#12419;
dge     &#12386;&#12359;
dgj     &#12386;&#12421;&#12435;
dgl     &#12386;&#12423;&#12435;
dgo     &#12386;&#12423;
dgq     &#12386;&#12419;&#12356;
dgu     &#12386;&#12421;
dgz     &#12386;&#12419;&#12435;
dh      &#12389;&#12358;
di      &#12386;
dj      &#12389;&#12435;
dk      &#12386;&#12435;
dl      &#12393;&#12435;
dm      &#12391;&#12418;
dn      &#12384;&#12435;
do      &#12393;
dp      &#12393;&#12358;
dq      &#12384;&#12356;
dr      &#12391;&#12354;&#12427;
ds      &#12391;&#12377;
dt      &#12384;&#12385;
du      &#12389;
dv      &#12386;&#12421;&#12358;
dw      &#12391;&#12356;
dx      &#12386;&#12423;&#12358;
dya     &#12391;&#12419;
dyh     &#12391;&#12421;&#12540;
dyj     &#12391;&#12421;&#12435;
dyq     &#12391;&#12419;&#12356;
dyu     &#12391;&#12421;
dyz     &#12391;&#12419;&#12435;
dz      &#12384;&#12435;
e       &#12360;
fa      &#12405;&#12353;
fd      &#12405;&#12359;&#12435;
fe      &#12405;&#12359;
fh      &#12405;&#12358;
fi      &#12405;&#12355;
fj      &#12405;&#12435;
fk      &#12405;&#12355;&#12435;
fl      &#12405;&#12361;&#12435;
fn      &#12405;&#12353;&#12435;
fo      &#12405;&#12361;
fq      &#12405;&#12353;&#12356;
fu      &#12405;
fv      &#12405;&#12421;&#12540;
fw      &#12405;&#12359;&#12356;
fyh     &#12405;&#12421;&#12540;
fyj     &#12405;&#12421;&#12435;
fyu     &#12405;&#12421;
fz      &#12405;&#12353;&#12435;
ga      &#12364;
gd      &#12370;&#12435;
ge      &#12370;
gh      &#12368;&#12358;
gi      &#12366;
gj      &#12368;&#12435;
gk      &#12366;&#12435;
gl      &#12372;&#12435;
gn      &#12364;&#12435;
go      &#12372;
gp      &#12372;&#12358;
gq      &#12364;&#12356;
gr      &#12364;&#12425;
gt      &#12372;&#12392;
gu      &#12368;
gv      &#12366;&#12421;&#12358;
gw      &#12370;&#12356;
gx      &#12366;&#12423;&#12358;
gya     &#12366;&#12419;
gyh     &#12366;&#12421;&#12358;
gyj     &#12366;&#12421;&#12435;
gyl     &#12366;&#12423;&#12435;
gyo     &#12366;&#12423;
gyp     &#12366;&#12423;&#12358;
gyq     &#12366;&#12419;&#12356;
gyu     &#12366;&#12421;
gyz     &#12366;&#12419;&#12435;
gz      &#12364;&#12435;
ha      &#12399;
hd      &#12408;&#12435;
he      &#12408;
hf      &#12405;
hga     &#12402;&#12419;
hgd     &#12402;&#12359;&#12435;
hge     &#12402;&#12359;
hgh     &#12402;&#12421;&#12358;
hgj     &#12402;&#12421;&#12435;
hgl     &#12402;&#12423;&#12435;
hgn     &#12402;&#12419;&#12435;
hgo     &#12402;&#12423;
hgp     &#12402;&#12423;&#12358;
hgq     &#12402;&#12419;&#12356;
hgu     &#12402;&#12421;
hgz     &#12402;&#12419;&#12435;
hh      &#12405;&#12358;
hi      &#12402;
hj      &#12405;&#12435;
hk      &#12402;&#12435;
hl      &#12411;&#12435;
ho      &#12411;
hp      &#12411;&#12358;
hq      &#12399;&#12356;
ht      &#12402;&#12392;
hu      &#12405;
hv      &#12402;&#12421;&#12358;
hw      &#12408;&#12356;
hx      &#12402;&#12423;&#12358;
hya     &#12402;&#12419;
hyd     &#12402;&#12359;&#12435;
hye     &#12402;&#12359;
hyh     &#12402;&#12421;&#12358;
hyj     &#12402;&#12421;&#12435;
hyl     &#12402;&#12423;&#12435;
hyo     &#12402;&#12423;
hyp     &#12402;&#12423;&#12358;
hyq     &#12402;&#12419;&#12356;
hyu     &#12402;&#12421;
hyz     &#12402;&#12419;&#12435;
hz      &#12399;&#12435;
i       &#12356;
ja      &#12376;&#12419;
jd      &#12376;&#12359;&#12435;
je      &#12376;&#12359;
jf      &#12376;&#12421;
jh      &#12376;&#12421;&#12358;
ji      &#12376;
jj      &#12376;&#12421;&#12435;
jk      &#12376;&#12435;
jl      &#12376;&#12423;&#12435;
jo      &#12376;&#12423;
jp      &#12376;&#12423;&#12358;
jq      &#12376;&#12419;&#12356;
ju      &#12376;&#12421;
jw      &#12376;&#12359;&#12356;
jz      &#12376;&#12419;&#12435;
ka      &#12363;
kd      &#12369;&#12435;
ke      &#12369;
kf      &#12365;
kga     &#12365;&#12419;
kgh     &#12365;&#12421;&#12358;
kgj     &#12365;&#12421;&#12435;
kgl     &#12365;&#12423;&#12435;
kgn     &#12365;&#12419;&#12435;
kgo     &#12365;&#12423;
kgp     &#12365;&#12423;&#12358;
kgq     &#12365;&#12419;&#12356;
kgu     &#12365;&#12421;
kgz     &#12365;&#12419;&#12435;
kh      &#12367;&#12358;
ki      &#12365;
kj      &#12367;&#12435;
kk      &#12365;&#12435;
kl      &#12371;&#12435;
km      &#12363;&#12418;
ko      &#12371;
kp      &#12371;&#12358;
kq      &#12363;&#12356;
kr      &#12363;&#12425;
kt      &#12371;&#12392;
ku      &#12367;
kv      &#12365;&#12421;&#12358;
kw      &#12369;&#12356;
kx      &#12365;&#12423;&#12358;
kya     &#12365;&#12419;
kyh     &#12365;&#12421;&#12358;
kyj     &#12365;&#12421;&#12435;
kyl     &#12365;&#12423;&#12435;
kyo     &#12365;&#12423;
kyp     &#12365;&#12423;&#12358;
kyq     &#12365;&#12419;&#12356;
kyu     &#12365;&#12421;
kyz     &#12365;&#12419;&#12435;
kz      &#12363;&#12435;
la      &#12353;
le      &#12359;
li      &#12355;
lo      &#12361;
ltsu    &#12387;
ltu     &#12387;
lu      &#12357;
lwa     &#12430;
lya     &#12419;
lye     &#12359;
lyi     &#12355;
lyo     &#12423;
lyu     &#12421;
ma      &#12414;
md      &#12417;&#12435;
me      &#12417;
mf      &#12416;
mgn     &#12415;&#12419;&#12435;
mh      &#12416;&#12358;
mi      &#12415;
mj      &#12416;&#12435;
mk      &#12415;&#12435;
ml      &#12418;&#12435;
mn      &#12418;&#12398;
mo      &#12418;
mp      &#12418;&#12358;
mq      &#12414;&#12356;
ms      &#12414;&#12377;
mt      &#12414;&#12383;
mu      &#12416;
mv      &#12415;&#12421;&#12358;
mw      &#12417;&#12356;
mx      &#12415;&#12423;&#12358;
mya     &#12415;&#12419;
myh     &#12415;&#12421;&#12358;
myj     &#12415;&#12421;&#12435;
myl     &#12415;&#12423;&#12435;
myo     &#12415;&#12423;
myp     &#12415;&#12423;&#12358;
myq     &#12415;&#12419;&#12356;
myu     &#12415;&#12421;
myz     &#12415;&#12419;&#12435;
mz      &#12414;&#12435;
na      &#12394;
nb      &#12397;&#12400;
nd      &#12397;&#12435;
ne      &#12397;
nf      &#12396;
nga     &#12395;&#12419;
ngh     &#12395;&#12421;&#12358;
ngj     &#12395;&#12421;&#12435;
ngl     &#12395;&#12423;&#12435;
ngn     &#12395;&#12419;&#12435;
ngo     &#12395;&#12423;
ngp     &#12395;&#12423;&#12358;
ngq     &#12395;&#12419;&#12356;
ngu     &#12395;&#12421;
ngz     &#12395;&#12419;&#12435;
nh      &#12396;&#12358;
ni      &#12395;
nj      &#12396;&#12435;
nk      &#12395;&#12435;
nl      &#12398;&#12435;
nn      &#12435;
no      &#12398;
np      &#12398;&#12358;
nq      &#12394;&#12356;
nr      &#12394;&#12427;
nt      &#12395;&#12385;
nu      &#12396;
nv      &#12395;&#12421;&#12358;
nw      &#12397;&#12356;
nx      &#12395;&#12423;&#12358;
nya     &#12395;&#12419;
nyh     &#12395;&#12421;&#12358;
nyj     &#12395;&#12421;&#12435;
nyl     &#12395;&#12423;&#12435;
nyo     &#12395;&#12423;
nyp     &#12395;&#12423;&#12358;
nyq     &#12395;&#12419;&#12356;
nyu     &#12395;&#12421;
nyz     &#12395;&#12419;&#12435;
nz      &#12394;&#12435;
o       &#12362;
pa      &#12401;
pd      &#12410;&#12435;
pe      &#12410;
pf      &#12413;&#12435;
pga     &#12404;&#12419;
pgh     &#12404;&#12421;&#12358;
pgj     &#12404;&#12421;&#12435;
pgl     &#12404;&#12423;&#12435;
pgn     &#12404;&#12419;&#12435;
pgo     &#12404;&#12423;
pgp     &#12404;&#12423;&#12358;
pgq     &#12404;&#12419;&#12356;
pgu     &#12404;&#12421;
pgz     &#12404;&#12419;&#12435;
ph      &#12407;&#12358;
pi      &#12404;
pj      &#12407;&#12435;
pk      &#12404;&#12435;
pl      &#12413;&#12435;
po      &#12413;
pp      &#12413;&#12358;
pq      &#12401;&#12356;
pu      &#12407;
pv      &#12404;&#12421;&#12358;
pw      &#12410;&#12356;
px      &#12404;&#12423;&#12358;
pya     &#12404;&#12419;
pyh     &#12404;&#12421;&#12358;
pyj     &#12404;&#12421;&#12435;
pyl     &#12404;&#12423;&#12435;
pyo     &#12404;&#12423;
pyp     &#12404;&#12423;&#12358;
pyq     &#12404;&#12419;&#12356;
pyu     &#12404;&#12421;
pz      &#12401;&#12435;
q       &#12435;
ra      &#12425;
rd      &#12428;&#12435;
re      &#12428;
rh      &#12427;&#12358;
ri      &#12426;
rj      &#12427;&#12435;
rk      &#12426;&#12435;
rl      &#12429;&#12435;
rn      &#12425;&#12435;
ro      &#12429;
rp      &#12429;&#12358;
rq      &#12425;&#12356;
rr      &#12425;&#12428;
ru      &#12427;
rv      &#12426;&#12421;&#12358;
rw      &#12428;&#12356;
rx      &#12426;&#12423;&#12358;
rya     &#12426;&#12419;
ryh     &#12426;&#12421;&#12358;
ryj     &#12426;&#12421;&#12435;
ryl     &#12426;&#12423;&#12435;
ryo     &#12426;&#12423;
ryp     &#12426;&#12423;&#12358;
ryq     &#12426;&#12419;&#12356;
ryu     &#12426;&#12421;
ryz     &#12426;&#12419;&#12435;
rz      &#12425;&#12435;
sa      &#12373;
sd      &#12379;&#12435;
se      &#12379;
sf      &#12373;&#12356;
sh      &#12377;&#12358;
si      &#12375;
sj      &#12377;&#12435;
sk      &#12375;&#12435;
sl      &#12381;&#12435;
sn      &#12373;&#12435;
so      &#12381;
sp      &#12381;&#12358;
sq      &#12373;&#12356;
sr      &#12377;&#12427;
ss      &#12379;&#12356;
st      &#12375;&#12383;
su      &#12377;
sv      &#12375;&#12421;&#12358;
sw      &#12379;&#12356;
sx      &#12375;&#12423;&#12358;
syi     &#12377;&#12355;
syk     &#12377;&#12355;&#12435;
sz      &#12373;&#12435;
ta      &#12383;
tb      &#12383;&#12403;
td      &#12390;&#12435;
te      &#12390;
tgh     &#12392;&#12357;&#12540;
tgi     &#12390;&#12355;
tgj     &#12392;&#12357;&#12435;
tgk     &#12390;&#12355;&#12435;
tgu     &#12392;&#12357;
th      &#12388;&#12358;
ti      &#12385;
tj      &#12388;&#12435;
tk      &#12385;&#12435;
tl      &#12392;&#12435;
tm      &#12383;&#12417;
tn      &#12383;&#12435;
to      &#12392;
tp      &#12392;&#12358;
tq      &#12383;&#12356;
tr      &#12383;&#12425;
tsa     &#12388;&#12353;
tsd     &#12388;&#12359;&#12435;
tse     &#12388;&#12359;
tsh     &#12388;&#12358;
tsi     &#12388;&#12355;
tsj     &#12388;&#12435;
tsk     &#12388;&#12355;&#12435;
tsl     &#12388;&#12361;&#12435;
tso     &#12388;&#12361;
tsq     &#12388;&#12353;&#12356;
tst     &#12392;&#12375;&#12390;
tsu     &#12388;
tsz     &#12388;&#12353;&#12435;
tt      &#12383;&#12385;
tu      &#12388;
tw      &#12390;&#12356;
tya     &#12390;&#12419;
tyh     &#12390;&#12421;&#12540;
tyj     &#12390;&#12421;&#12435;
tyq     &#12390;&#12419;&#12356;
tyu     &#12390;&#12421;
tyz     &#12390;&#12419;&#12435;
tz      &#12383;&#12435;
u       &#12358;
va      &#12358;&#12443;&#12353;
vd      &#12358;&#12443;&#12359;&#12435;
ve      &#12358;&#12443;&#12359;
vh      &#12358;&#12443;&#12540;
vi      &#12358;&#12443;&#12355;
vj      &#12358;&#12443;&#12435;
vk      &#12358;&#12443;&#12355;&#12435;
vl      &#12358;&#12443;&#12361;&#12435;
vn      &#12358;&#12443;&#12353;&#12435;
vo      &#12358;&#12443;&#12361;
vp      &#12358;&#12443;&#12361;&#12358;
vq      &#12358;&#12443;&#12353;&#12356;
vu      &#12358;&#12443;
vv      &#12358;&#12443;&#12421;&#12540;
vw      &#12358;&#12443;&#12359;&#12356;
vyh     &#12358;&#12443;&#12421;&#12540;
vyj     &#12358;&#12443;&#12421;&#12435;
vyu     &#12358;&#12443;&#12421;
vz      &#12358;&#12443;&#12353;&#12435;
wa      &#12431;
wd      &#12358;&#12359;&#12435;
we      &#12358;&#12359;
wi      &#12358;&#12355;
wk      &#12358;&#12355;&#12435;
wl      &#12358;&#12361;&#12435;
wn      &#12431;&#12435;
wo      &#12434;
wp      &#12358;&#12361;&#12540;
wq      &#12431;&#12356;
wr      &#12431;&#12428;
wse     &#12433;
wsi     &#12432;
wso     &#12358;&#12361;
wt      &#12431;&#12383;
ww      &#12358;&#12359;&#12356;
wz      &#12431;&#12435;
xa      &#12375;&#12419;
xd      &#12375;&#12359;&#12435;
xe      &#12375;&#12359;
xh      &#12375;&#12421;&#12358;
xi      &#12375;
xj      &#12375;&#12421;&#12435;
xk      &#12375;&#12435;
xl      &#12375;&#12423;&#12435;
xn      &#12375;&#12419;&#12435;
xo      &#12375;&#12423;
xp      &#12375;&#12423;&#12358;
xq      &#12375;&#12419;&#12356;
xu      &#12375;&#12421;
xw      &#12375;&#12359;&#12356;
xz      &#12375;&#12419;&#12435;
ya      &#12420;
yd      &#12356;&#12359;&#12435;
ye      &#12356;&#12359;
yf      &#12422;
yh      &#12422;&#12358;
yj      &#12422;&#12435;
yl      &#12424;&#12435;
yo      &#12424;
yp      &#12424;&#12358;
yq      &#12420;&#12356;
yr      &#12424;&#12427;
yu      &#12422;
yw      &#12356;&#12359;&#12356;
yz      &#12420;&#12435;
za      &#12374;
zc      &#12374;
zd      &#12380;&#12435;
ze      &#12380;
zh      &#12378;&#12358;
zi      &#12376;
zj      &#12378;&#12435;
zk      &#12376;&#12435;
zl      &#12382;&#12435;
zn      &#12374;&#12435;
zo      &#12382;
zp      &#12382;&#12358;
zq      &#12374;&#12356;
zr      &#12374;&#12427;
zu      &#12378;
zv      &#12374;&#12356;
zw      &#12380;&#12356;
zx      &#12380;&#12356;
zyi     &#12378;&#12355;
zz      &#12374;&#12435;
</pre>
</div>
</div>
</div>
<div id="outline-container-orgc050cb6" class="outline-3">
<h3 id="orgc050cb6">LilyPond</h3>
<div class="outline-text-3" id="text-orgc050cb6">
<p>
<a href="https://lilypond.org/unix.html">LilyPond</a> elisp package is included in source tarball available at <a href="https://lilypond.org/download/source">here</a>,
you are required to locate that package where emacs can search.
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"lilypond"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-style: italic;">"https://github.com/lilypond/lilypond/releases.atom"</span> soft_update)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package lilypond-mode
  <span style="font-weight: bold;">:delight</span> (LilyPond-mode <span style="font-style: italic;">" LP"</span>)
  <span style="font-weight: bold;">:mode</span> (<span style="font-style: italic;">"\\.ly$"</span> . LilyPond-mode)
  <span style="font-weight: bold;">:custom</span>
  (LilyPond-pdf-command <span style="font-style: italic;">"firefox"</span>)
  (LilyPond-midi-command <span style="font-style: italic;">"fluidsynth -a alsa -m alsa_seq -l"</span>))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org287e3dd" class="outline-2">
<h2 id="org287e3dd">utility scripts</h2>
<div class="outline-text-2" id="text-org287e3dd">
</div>

<div id="outline-container-orga24533f" class="outline-3">
<h3 id="orga24533f">Declutters</h3>
<div class="outline-text-3" id="text-orga24533f">
<p>
These scripts (declutter<sub>xxx</sub>) keep things decluttered.
</p>

<ul class="org-ul">
<li><p>
trash
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">!/usr/bin/env python3</span>

<span style="font-weight: bold;">import</span> os
<span style="font-weight: bold;">import</span> time
<span style="font-weight: bold;">import</span> datetime
<span style="font-weight: bold;">import</span> shutil
<span style="font-weight: bold;">import</span> glob
<span style="font-weight: bold;">from</span> send2trash <span style="font-weight: bold;">import</span> send2trash

<span style="font-weight: bold; font-style: italic;">TRASH_DIR</span> = os.environ[<span style="font-style: italic;">'HOME'</span>] + <span style="font-style: italic;">'/.local/share/Trash/files/'</span>
<span style="font-weight: bold; font-style: italic;">TIDY_DIRS</span> = <span style="font-weight: bold;">filter</span>(<span style="font-weight: bold;">lambda</span> x: os.path.isdir(x),
                   <span style="font-weight: bold;">list</span>(<span style="font-weight: bold;">map</span>(<span style="font-weight: bold;">lambda</span> x: os.path.join(os.environ[<span style="font-style: italic;">'HOME'</span>], x), [<span style="font-style: italic;">'tmp'</span>, <span style="font-style: italic;">'Downloads'</span>]))
                   + glob.glob(os.path.join(os.environ[<span style="font-style: italic;">'HOME'</span>], <span style="font-style: italic;">'tmp/*'</span>)))

<span style="font-weight: bold; font-style: italic;">MAX_STAY_DAYS_IN_TRASH</span> = 7
<span style="font-weight: bold; font-style: italic;">MAX_NEGLECTED_DAYS_IN_TIDY_DIRS</span> = 14

<span style="font-weight: bold; font-style: italic;">suffixes</span> = [<span style="font-style: italic;">'B'</span>, <span style="font-style: italic;">'KB'</span>, <span style="font-style: italic;">'MB'</span>, <span style="font-style: italic;">'GB'</span>, <span style="font-style: italic;">'TB'</span>, <span style="font-style: italic;">'PB'</span>]
<span style="font-weight: bold;">def</span> <span style="font-weight: bold;">humansize</span>(nbytes):
    <span style="font-weight: bold; font-style: italic;">i</span> = 0
    <span style="font-weight: bold;">while</span> nbytes &gt;= 1024 <span style="font-weight: bold;">and</span> i &lt; <span style="font-weight: bold;">len</span>(suffixes)-1:
        <span style="font-weight: bold; font-style: italic;">nbytes</span> /= 1024.
        <span style="font-weight: bold; font-style: italic;">i</span> += 1
    <span style="font-weight: bold; font-style: italic;">f</span> = (<span style="font-style: italic;">'%.2f'</span> % nbytes).rstrip(<span style="font-style: italic;">'0'</span>).rstrip(<span style="font-style: italic;">'.'</span>)
    <span style="font-weight: bold;">return</span> <span style="font-style: italic;">'%s %s'</span> % (f, suffixes[i])

<span style="font-weight: bold;">def</span> <span style="font-weight: bold;">get_size</span>(start_path = <span style="font-style: italic;">'.'</span>):
    <span style="font-weight: bold; font-style: italic;">total_size</span> = 0
    <span style="font-weight: bold;">for</span> dirpath, dirnames, filenames <span style="font-weight: bold;">in</span> os.walk(start_path):
        <span style="font-weight: bold;">for</span> f <span style="font-weight: bold;">in</span> filenames:
            <span style="font-weight: bold; font-style: italic;">fp</span> = os.path.join(dirpath, f)
            <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">skip if it is symbolic link</span>
            <span style="font-weight: bold;">if</span> <span style="font-weight: bold;">not</span> os.path.islink(fp):
                <span style="font-weight: bold; font-style: italic;">total_size</span> += os.path.getsize(fp)

    <span style="font-weight: bold;">return</span> total_size

<span style="font-weight: bold;">print</span>(<span style="font-style: italic;">'{0} starts at {1}\n'</span>.<span style="font-weight: bold;">format</span>(os.path.basename(__file__),
                                   datetime.datetime.now()))

<span style="font-weight: bold; font-style: italic;">NOW</span> = time.time()

<span style="font-weight: bold;">print</span>(<span style="font-style: italic;">'--{0} starts to move files neglected more than {1} days to trash box.\n'</span>
      .<span style="font-weight: bold;">format</span>(os.path.basename(__file__),
              MAX_NEGLECTED_DAYS_IN_TIDY_DIRS))

<span style="font-weight: bold; font-style: italic;">tidyup_lists</span> = <span style="font-weight: bold;">map</span>(<span style="font-weight: bold;">lambda</span> x: <span style="font-weight: bold;">map</span>(<span style="font-weight: bold;">lambda</span> y: os.path.join(x, y), os.listdir(x)), TIDY_DIRS)
<span style="font-weight: bold;">for</span> a_file <span style="font-weight: bold;">in</span> [item <span style="font-weight: bold;">for</span> sublist <span style="font-weight: bold;">in</span> tidyup_lists <span style="font-weight: bold;">for</span> item <span style="font-weight: bold;">in</span> sublist]:
    <span style="font-weight: bold; font-style: italic;">atime</span> = os.lstat(a_file).st_atime
    <span style="font-weight: bold; font-style: italic;">delta_atime</span> = datetime.timedelta(seconds=(NOW - atime))
    <span style="font-weight: bold;">if</span> delta_atime &gt; datetime.timedelta(days = MAX_NEGLECTED_DAYS_IN_TIDY_DIRS):
        <span style="font-weight: bold;">try</span>:
            send2trash(a_file)
        <span style="font-weight: bold;">except</span> <span style="font-weight: bold; text-decoration: underline;">OSError</span> <span style="font-weight: bold;">as</span> error:
            <span style="font-weight: bold;">print</span>(error)
        <span style="font-weight: bold;">else</span>:
            <span style="font-weight: bold;">print</span>(<span style="font-style: italic;">'moveed to trash: {}'</span>.<span style="font-weight: bold;">format</span>(a_file))

<span style="font-weight: bold;">print</span>(<span style="font-style: italic;">'--{0} starts to remove files staying more than {1} days in trash box.'</span>
      .<span style="font-weight: bold;">format</span>(os.path.basename(__file__),
              MAX_STAY_DAYS_IN_TRASH))

<span style="font-weight: bold; font-style: italic;">rbytes_total</span> = 0
<span style="font-weight: bold;">for</span> trash_file <span style="font-weight: bold;">in</span> <span style="font-weight: bold;">map</span>(<span style="font-weight: bold;">lambda</span> fname: os.path.join(TRASH_DIR, fname), os.listdir(TRASH_DIR)):
    <span style="font-weight: bold; font-style: italic;">lstat</span> = os.lstat(trash_file)
    <span style="font-weight: bold; font-style: italic;">delta_time</span> = datetime.timedelta(seconds=(NOW - <span style="font-weight: bold;">max</span>(lstat.st_atime, lstat.st_ctime)))
    <span style="font-weight: bold;">if</span> delta_time &gt; datetime.timedelta(days = MAX_STAY_DAYS_IN_TRASH):
        <span style="font-weight: bold; font-style: italic;">method</span> = <span style="font-style: italic;">'removed'</span>
        <span style="font-weight: bold; font-style: italic;">fname</span> = os.path.basename(trash_file)
        <span style="font-weight: bold;">if</span> os.path.islink(trash_file):
            <span style="font-weight: bold; font-style: italic;">method</span> = <span style="font-style: italic;">'unlinked'</span>
            <span style="font-weight: bold; font-style: italic;">fsize</span> = <span style="font-style: italic;">'N/A'</span>
            os.unlink(trash_file)
        <span style="font-weight: bold;">elif</span> os.path.isfile(trash_file):
            <span style="font-weight: bold; font-style: italic;">rbytes</span> = os.path.getsize(trash_file)
            <span style="font-weight: bold; font-style: italic;">rbytes_total</span> += rbytes
            <span style="font-weight: bold; font-style: italic;">fsize</span> = humansize(rbytes)
            os.remove(trash_file)
        <span style="font-weight: bold;">elif</span> os.path.isdir(trash_file):
            <span style="font-weight: bold; font-style: italic;">rbytes</span> = get_size(trash_file)
            <span style="font-weight: bold; font-style: italic;">rbytes_total</span> += rbytes
            <span style="font-weight: bold; font-style: italic;">fsize</span> = humansize(rbytes)
            <span style="font-weight: bold; font-style: italic;">fname</span> += <span style="font-style: italic;">'/'</span>
            shutil.rmtree(trash_file)
        <span style="font-weight: bold;">print</span>(<span style="font-style: italic;">'{}: [{:&gt;9}] {}'</span>.<span style="font-weight: bold;">format</span>(method, fsize, fname))

<span style="font-weight: bold;">print</span>(<span style="font-style: italic;">'--{0} removes [{1}] in total.\n'</span>
      .<span style="font-weight: bold;">format</span>(os.path.basename(__file__),
              humansize(rbytes_total)))

<span style="font-weight: bold;">print</span>(<span style="font-style: italic;">'{0} ends at {1}\n'</span>.<span style="font-weight: bold;">format</span>(os.path.basename(__file__),
                                 datetime.datetime.now()))
</pre>
</div></li>
<li><p>
home directory (ruby implementation)
</p>
<div class="org-src-container">
<pre class="src src-ruby"><span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">!/usr/bin/env ruby</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">coding: utf-8</span>

<span style="font-weight: bold; text-decoration: underline;">TRASHES</span> = [<span style="font-style: italic;">"*~"</span>, <span style="font-style: italic;">"#*#"</span>, <span style="font-style: italic;">".#*#"</span>, <span style="font-style: italic;">"._*"</span>, <span style="font-style: italic;">".DS_Store"</span>]

<span style="font-weight: bold;">class</span> <span style="font-weight: bold; text-decoration: underline;">Sweep</span>
  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">self</span>.<span style="font-weight: bold;">sweep</span>(base_dir)
    <span style="font-weight: bold;">puts</span> base_dir
    <span style="font-weight: bold; text-decoration: underline;">TRASHES</span>.each <span style="font-weight: bold;">do</span> |trash|
      tfiles = <span style="font-weight: bold; text-decoration: underline;">File</span>.join(<span style="font-style: italic;">"%s/**"</span> % base_dir, trash)
      <span style="font-weight: bold; text-decoration: underline;">Dir</span>.glob(tfiles).each <span style="font-weight: bold;">do</span> |f|
        <span style="font-weight: bold;">if</span> <span style="font-weight: bold; text-decoration: underline;">File</span>.delete(f) &gt; 0
          <span style="font-weight: bold;">puts</span> <span style="font-style: italic;">"Removed: "</span> + f
        <span style="font-weight: bold;">else</span>
          <span style="font-weight: bold;">puts</span> <span style="font-style: italic;">"CANNOT Removed: "</span> + f
        <span style="font-weight: bold;">end</span>
      <span style="font-weight: bold;">end</span>
    <span style="font-weight: bold;">end</span>
  <span style="font-weight: bold;">end</span>
<span style="font-weight: bold;">end</span>

<span style="font-weight: bold; text-decoration: underline;">ARGV</span>.each <span style="font-weight: bold;">do</span> |arg|
  <span style="font-weight: bold;">if</span> <span style="font-weight: bold; text-decoration: underline;">Dir</span>.exist?(arg) <span style="font-weight: bold;">then</span>
    <span style="font-weight: bold; text-decoration: underline;">Sweep</span>.sweep(arg)
  <span style="font-weight: bold;">end</span>
<span style="font-weight: bold;">end</span>
</pre>
</div></li>
<li><p>
home directory (python implementation)
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">!/usr/bin/env python3</span>

<span style="font-weight: bold;">import</span> sys
<span style="font-weight: bold;">import</span> os
<span style="font-weight: bold;">import</span> glob
<span style="font-weight: bold;">import</span> argparse

<span style="font-weight: bold; font-style: italic;">TRASH_REGEXPS</span> = [<span style="font-style: italic;">"*~"</span>, <span style="font-style: italic;">"#*"</span>, <span style="font-style: italic;">".#*"</span>, <span style="font-style: italic;">"._*"</span>, <span style="font-style: italic;">".DS_Store"</span>, <span style="font-style: italic;">"*.dvi"</span>, <span style="font-style: italic;">"*.aux"</span>, <span style="font-style: italic;">"*.bbl"</span>]

<span style="font-weight: bold;">class</span> <span style="font-weight: bold; text-decoration: underline;">Sweepy</span>:
    <span style="font-weight: bold; text-decoration: underline;">@classmethod</span>
    <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">sweep_with_regexp</span>(<span style="font-weight: bold;">self</span>, base_dir, recursive=<span style="font-weight: bold; text-decoration: underline;">False</span>):
        <span style="font-weight: bold;">for</span> trash_regexp <span style="font-weight: bold;">in</span> TRASH_REGEXPS:
            <span style="font-weight: bold; font-style: italic;">files</span> = glob.glob(<span style="font-style: italic;">"%s/**/"</span> % base_dir + trash_regexp, recursive=recursive)
            <span style="font-weight: bold;">for</span> <span style="font-weight: bold;">file</span> <span style="font-weight: bold;">in</span> files:
                <span style="font-weight: bold;">if</span> os.path.isfile(<span style="font-weight: bold;">file</span>):
                    os.remove(<span style="font-weight: bold;">file</span>)
                    <span style="font-weight: bold;">print</span>(<span style="font-style: italic;">"Removed: "</span> + <span style="font-weight: bold;">file</span>)
    <span style="font-weight: bold; text-decoration: underline;">@classmethod</span>
    <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">sweep_broken_symlink</span>(<span style="font-weight: bold;">self</span>, base_dir, recursive=<span style="font-weight: bold; text-decoration: underline;">False</span>):
        <span style="font-weight: bold; font-style: italic;">files</span> = glob.glob(<span style="font-style: italic;">"%s/*"</span> % base_dir, recursive=recursive)
        <span style="font-weight: bold; font-style: italic;">dotfiles</span> = glob.glob(<span style="font-style: italic;">"%s/.*"</span> % base_dir, recursive=recursive)
        <span style="font-weight: bold;">for</span> <span style="font-weight: bold;">file</span> <span style="font-weight: bold;">in</span> (files + dotfiles):
            <span style="font-weight: bold;">if</span> os.path.islink(<span style="font-weight: bold;">file</span>):
                <span style="font-weight: bold;">if</span> <span style="font-weight: bold;">not</span> os.path.exists(os.readlink(<span style="font-weight: bold;">file</span>)):
                    os.unlink(<span style="font-weight: bold;">file</span>)
                    <span style="font-weight: bold;">print</span>(<span style="font-style: italic;">"Unlinked: "</span> + <span style="font-weight: bold;">file</span>)

<span style="font-weight: bold; font-style: italic;">parser</span> = argparse.ArgumentParser(description=<span style="font-style: italic;">'Removes all desired files'</span>)
parser.add_argument(<span style="font-style: italic;">'dir'</span>, metavar=<span style="font-style: italic;">'dir'</span>, nargs=<span style="font-style: italic;">'?'</span>, action=<span style="font-style: italic;">'store'</span>,
                    <span style="font-weight: bold;">help</span>=<span style="font-style: italic;">'base directory to search'</span>)
parser.add_argument(<span style="font-style: italic;">'-r'</span>, dest=<span style="font-style: italic;">'recursive'</span>, action=<span style="font-style: italic;">"store_true"</span>, default=<span style="font-weight: bold; text-decoration: underline;">False</span>)
<span style="font-weight: bold; font-style: italic;">args</span> = parser.parse_args()
<span style="font-weight: bold;">if</span> args.recursive:
    Sweepy.sweep_with_regexp(args.<span style="font-weight: bold;">dir</span>, recursive=<span style="font-weight: bold; text-decoration: underline;">True</span>)
    Sweepy.sweep_broken_symlink(args.<span style="font-weight: bold;">dir</span>, recursive=<span style="font-weight: bold; text-decoration: underline;">True</span>)
<span style="font-weight: bold;">else</span>:
    Sweepy.sweep_with_regexp(args.<span style="font-weight: bold;">dir</span>, recursive=<span style="font-weight: bold; text-decoration: underline;">False</span>)
    Sweepy.sweep_broken_symlink(args.<span style="font-weight: bold;">dir</span>, recursive=<span style="font-weight: bold; text-decoration: underline;">False</span>)
</pre>
</div></li>
</ul>
</div>
</div>

<div id="outline-container-org2f1686a" class="outline-3">
<h3 id="org2f1686a">Database back-up scripts</h3>
<div class="outline-text-3" id="text-org2f1686a">
<ul class="org-ul">
<li><p>
PostgreSQL
</p>
<div class="org-src-container">
<pre class="src src-bash"><span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">!/usr/bin/</span><span style="font-weight: bold;">env</span><span style="font-weight: bold; font-style: italic;"> bash</span>

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Usage: $ postgres_backup &lt;db_name&gt; &lt;backup_dir&gt;</span>

<span style="font-weight: bold; font-style: italic;">POSTGRES_DBNAME</span>=$<span style="font-weight: bold; font-style: italic;">1</span>
<span style="font-weight: bold; font-style: italic;">BACKUP_DIR</span>=$<span style="font-weight: bold; font-style: italic;">2</span>
<span style="font-weight: bold; font-style: italic;">DATE</span>=<span style="font-style: italic;">"$(date +%Y%m%d_%H%M)"</span>

pg_dump --format=custom ${<span style="font-weight: bold; font-style: italic;">POSTGRES_DBNAME</span>} &gt; ${<span style="font-weight: bold; font-style: italic;">BACKUP_DIR</span>}/${<span style="font-weight: bold; font-style: italic;">DATE</span>}_${<span style="font-weight: bold; font-style: italic;">POSTGRES_DBNAME</span>}.custom || <span style="font-weight: bold;">exit</span> 1

<span style="font-weight: bold;">exit</span> 0
</pre>
</div></li>

<li><p>
MySQL
</p>
<div class="org-src-container">
<pre class="src src-shell"><span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">!/usr/bin/</span><span style="font-weight: bold;">env</span><span style="font-weight: bold; font-style: italic;"> bash</span>

<span style="font-weight: bold; font-style: italic;">BACKUP_DIR</span>=~/share/backups/mysql
<span style="font-weight: bold; font-style: italic;">RAW_SQL</span>=<span style="font-style: italic;">"$(date +%Y%m%d_%H%M)_backup.sql"</span>
<span style="font-weight: bold; font-style: italic;">TAR_SQL</span>=<span style="font-style: italic;">"${RAW_SQL}.txz"</span>

(
  <span style="font-weight: bold;">cd</span> <span style="font-style: italic;">"${BACKUP_DIR}"</span> || <span style="font-weight: bold;">exit</span> 1
  mysqldump --opt --all-databases --events --default-character-set=binary -u root &gt; <span style="font-style: italic;">"${RAW_SQL}"</span>
  tar cfJ <span style="font-style: italic;">"${TAR_SQL}"</span> <span style="font-style: italic;">"${RAW_SQL}"</span>
  rm -f <span style="font-style: italic;">"${RAW_SQL}"</span>
) || <span style="font-weight: bold;">exit</span> 1

<span style="font-weight: bold;">exit</span> 0
</pre>
</div></li>
</ul>
</div>
</div>

<div id="outline-container-orge64a70b" class="outline-3">
<h3 id="orge64a70b">Snapshots taking</h3>
<div class="outline-text-3" id="text-orge64a70b">
<ul class="org-ul">
<li><p>
snapshot.sh
</p>

<p>
A structure described below is expected under all devices.
</p>

<p>
<i>mountpoint</i>
├── backups
├── incumbents
└── snapshots
</p>

<div class="org-src-container">
<pre class="src src-shell"><span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">!/usr/bin/</span><span style="font-weight: bold;">env</span><span style="font-weight: bold; font-style: italic;"> bash</span>
<span style="font-weight: bold;">set</span> -euo pipefail

<span style="font-weight: bold; font-style: italic;">DATETIME</span>=<span style="font-weight: bold;">`date "+%Y%m%d-%H%M"`</span>
<span style="font-weight: bold; font-style: italic;">BTRFS_MNTS</span>=(<span style="font-style: italic;">"/mnt/ssd01"</span>
            <span style="font-style: italic;">"/mnt/nvme01"</span>)

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">back up server data beforehand</span>
rsync -arhv sv04:~/var/backup ~/share/sv04

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">take snapshots for all btrfs subvolumes</span>
<span style="font-weight: bold;">for</span> btrfs_mnt<span style="font-weight: bold;"> in</span> ${<span style="font-weight: bold; font-style: italic;">BTRFS_MNTS</span>[@]}; <span style="font-weight: bold;">do</span>
  <span style="font-weight: bold;">if</span> mountpoint ${<span style="font-weight: bold; font-style: italic;">btrfs_mnt</span>} &gt;/dev/null 2&gt;&amp;1; <span style="font-weight: bold;">then</span>
    <span style="font-weight: bold;">for</span> subv<span style="font-weight: bold;"> in</span> ${<span style="font-weight: bold; font-style: italic;">btrfs_mnt</span>}/incumbents/*; <span style="font-weight: bold;">do</span>
      <span style="font-weight: bold; font-style: italic;">subv_base</span>=$(basename ${<span style="font-weight: bold; font-style: italic;">subv</span>})
      <span style="font-weight: bold;">if</span> [ ! -d <span style="font-style: italic;">"${btrfs_mnt}/snapshots/${subv_base}"</span> ]; <span style="font-weight: bold;">then</span>
        mkdir -p <span style="font-style: italic;">"${btrfs_mnt}/snapshots/${subv_base}"</span>
      <span style="font-weight: bold;">fi</span>
      btrfs subvolume snapshot <span style="font-style: italic;">"${subv}"</span> <span style="font-style: italic;">"${btrfs_mnt}/snapshots/${subv_base}/${DATETIME}"</span>
    <span style="font-weight: bold;">done</span>
  <span style="font-weight: bold;">fi</span>
<span style="font-weight: bold;">done</span>
</pre>
</div></li>
</ul>
</div>
</div>

<div id="outline-container-orga8091b0" class="outline-3">
<h3 id="orga8091b0">git repo syncing</h3>
<div class="outline-text-3" id="text-orga8091b0">
<div class="org-src-container">
<pre class="src src-shell"><span style="font-weight: bold; font-style: italic;">repos_path</span>=$(ghq list --full-path --exact <span style="font-style: italic;">"${repo}"</span>)

<span style="font-weight: bold;">for</span> repo_path<span style="font-weight: bold;"> in</span> ${<span style="font-weight: bold; font-style: italic;">repos_path</span>[@]}; <span style="font-weight: bold;">do</span>
  <span style="font-weight: bold; font-style: italic;">repo</span>=$(basename $(dirname <span style="font-style: italic;">"${repo_path}"</span>))/$(basename <span style="font-style: italic;">"${repo_path}"</span>)
  ghq get --update ${<span style="font-weight: bold; font-style: italic;">repo</span>}
  <span style="font-weight: bold;">cd</span> ${<span style="font-weight: bold; font-style: italic;">repo_path</span>} &amp;&amp; <span style="font-style: italic;">\</span>
    (
      <span style="font-weight: bold;">if</span> [ ${<span style="font-weight: bold; font-style: italic;">repo</span>} == <span style="font-style: italic;">'p-snow/org'</span> ]; <span style="font-weight: bold;">then</span>
        <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Remove deleted files</span>
        git ls-files --deleted -z | xargs -0 git rm &gt;/dev/null 2&gt;&amp;1
        <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Add new files aaa</span>
        git add . &gt;/dev/null 2&gt;&amp;1
        git commit -m <span style="font-style: italic;">"$(date -R)"</span>
      <span style="font-weight: bold;">fi</span>
      git push origin
    )
<span style="font-weight: bold;">done</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-orga358cd6" class="outline-3">
<h3 id="orga358cd6">backup scripts</h3>
<div class="outline-text-3" id="text-orga358cd6">
<ul class="org-ul">
<li><p>
back<sub>btrfs.sh</sub>
</p>
<div class="org-src-container">
<pre class="src src-shell"><span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">!/usr/bin/</span><span style="font-weight: bold;">env</span><span style="font-weight: bold; font-style: italic;"> bash</span>
<span style="font-weight: bold;">set</span> -euo pipefail

<span style="font-weight: bold; font-style: italic;">MNT_SSD</span>=/mnt/ssd01
<span style="font-weight: bold; font-style: italic;">MNT_HDD</span>=/mnt/hdd01

<span style="font-weight: bold;">function</span> <span style="font-weight: bold;">backup_subvol</span>() {
  local <span style="font-weight: bold; font-style: italic;">_src_snap_dir</span>=$<span style="font-weight: bold; font-style: italic;">1</span>
  local <span style="font-weight: bold; font-style: italic;">_src_back_dir</span>=$<span style="font-weight: bold; font-style: italic;">2</span>
  local <span style="font-weight: bold; font-style: italic;">_dst_back_dir</span>=$<span style="font-weight: bold; font-style: italic;">3</span>

  <span style="font-weight: bold;">echo</span> <span style="font-style: italic;">"Name: $(basename ${_src_back_dir})"</span>

  mkdir -pv <span style="font-style: italic;">"${_src_back_dir}"</span>
  mkdir -pv <span style="font-style: italic;">"${_dst_back_dir}"</span>

  <span style="font-weight: bold; font-style: italic;">src_back_last</span>=$((ls -d <span style="font-style: italic;">"${_src_back_dir}"</span>/* 2&gt;/dev/null | sort | tail -1 | xargs basename) || <span style="font-weight: bold;">echo</span> -n <span style="font-style: italic;">""</span>)
  <span style="font-weight: bold; font-style: italic;">snap_last</span>=$(ls -d <span style="font-style: italic;">"${_src_snap_dir}"</span>/* 2&gt;/dev/null | sort | tail -1 | xargs basename || <span style="font-weight: bold;">echo</span> -n <span style="font-style: italic;">""</span>)

  <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">create readonly clone of last snapshot</span>
  <span style="font-weight: bold;">if</span> [[ <span style="font-style: italic;">"${src_back_last}"</span> &lt; <span style="font-style: italic;">"${snap_last}"</span> ]]; <span style="font-weight: bold;">then</span>
    btrfs subv snap -r <span style="font-style: italic;">"${_src_snap_dir}/${snap_last}"</span> <span style="font-style: italic;">"${_src_back_dir}/${src_back_last}"</span>
  <span style="font-weight: bold;">fi</span>

  <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">determine parent btrfs subvolume</span>
  <span style="font-weight: bold; font-style: italic;">parent</span>=
  <span style="font-weight: bold; font-style: italic;">dst_backs</span>=$(ls -d <span style="font-style: italic;">"${_dst_back_dir}"</span>/* 2&gt;/dev/null | sort || <span style="font-weight: bold;">echo</span> -n <span style="font-style: italic;">""</span>)
  <span style="font-weight: bold;">if</span> [ ${#<span style="font-weight: bold; font-style: italic;">dst_backs</span>} -ne 0 ]; <span style="font-weight: bold;">then</span>
    <span style="font-weight: bold;">for</span> dst_back<span style="font-weight: bold;"> in</span> <span style="font-style: italic;">"${dst_backs[@]}"</span>; <span style="font-weight: bold;">do</span>
      <span style="font-weight: bold; font-style: italic;">test</span>=$(basename ${<span style="font-weight: bold; font-style: italic;">dst_back</span>})
      <span style="font-weight: bold;">if</span> [ -d <span style="font-style: italic;">"${_src_back_dir}/${test}"</span> ]; <span style="font-weight: bold;">then</span>
        <span style="font-weight: bold; font-style: italic;">parent</span>=${<span style="font-weight: bold;">test</span>}
      <span style="font-weight: bold;">fi</span>
    <span style="font-weight: bold;">done</span>
  <span style="font-weight: bold;">fi</span>

  <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">determine subvolume to send in source device</span>
  <span style="font-weight: bold; font-style: italic;">subvol</span>=
  <span style="font-weight: bold;">if</span> [ ${#<span style="font-weight: bold; font-style: italic;">src_back_last</span>} -ne 0 ]; <span style="font-weight: bold;">then</span>
    <span style="font-weight: bold;">if</span> [[ <span style="font-style: italic;">"${parent}"</span> &lt; <span style="font-style: italic;">"${src_back_last}"</span> ]] &amp;&amp; [ ! -d <span style="font-style: italic;">"${_dst_back_dir}/${src_back_last}"</span> ]; <span style="font-weight: bold;">then</span>
      <span style="font-weight: bold; font-style: italic;">subvol</span>=${<span style="font-weight: bold; font-style: italic;">src_back_last</span>}
    <span style="font-weight: bold;">fi</span>
  <span style="font-weight: bold;">fi</span>

  <span style="font-weight: bold;">echo</span> <span style="font-style: italic;">"Parent: ${parent}"</span>
  <span style="font-weight: bold;">echo</span> <span style="font-style: italic;">"Subvol: ${subvol}"</span>

  <span style="font-weight: bold;">if</span> [ -n <span style="font-style: italic;">"${parent}"</span> ] &amp;&amp; [ -n <span style="font-style: italic;">"${subvol}"</span> ]; <span style="font-weight: bold;">then</span>
    <span style="font-weight: bold;">echo</span> <span style="font-style: italic;">"Invoke incremental backup"</span>
    pwsudo btrfs send -p <span style="font-style: italic;">"${_src_back_dir}/${parent}"</span> <span style="font-style: italic;">"${_src_back_dir}/${subvol}"</span> | sudo btrfs receive <span style="font-style: italic;">"${_dst_back_dir}"</span>
  <span style="font-weight: bold;">elif</span> [ -z <span style="font-style: italic;">"${parent}"</span> ] &amp;&amp; [ -n <span style="font-style: italic;">"${subvol}"</span> ]; <span style="font-weight: bold;">then</span>
    <span style="font-weight: bold;">echo</span> <span style="font-style: italic;">"Invoke full backup"</span>
    pwsudo btrfs send <span style="font-style: italic;">"${_src_back_dir}/${subvol}"</span> | sudo btrfs receive <span style="font-style: italic;">"${_dst_back_dir}"</span>
  <span style="font-weight: bold;">fi</span>

  <span style="font-weight: bold;">echo</span> <span style="font-style: italic;">"--------"</span>
}

backup_subvol <span style="font-style: italic;">"${MNT_SSD}"</span>/snapshots/doc <span style="font-style: italic;">"${MNT_SSD}"</span>/backups/doc <span style="font-style: italic;">"${MNT_HDD}"</span>/backups/doc
backup_subvol <span style="font-style: italic;">"${MNT_SSD}"</span>/snapshots/share <span style="font-style: italic;">"${MNT_SSD}"</span>/backups/share <span style="font-style: italic;">"${MNT_HDD}"</span>/backups/share
</pre>
</div></li>
<li><p>
back<sub>rsync.sh</sub>
</p>
<div class="org-src-container">
<pre class="src src-shell"><span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">!/usr/bin/</span><span style="font-weight: bold;">env</span><span style="font-weight: bold; font-style: italic;"> bash</span>

<span style="font-weight: bold; font-style: italic;">OPT</span>=<span style="font-style: italic;">"-aPh"</span>
<span style="font-weight: bold; font-style: italic;">LINK</span>=<span style="font-style: italic;">"--link-dest=../last/"</span>
<span style="font-weight: bold; font-style: italic;">DEST</span>=<span style="font-style: italic;">"ns01:~/share/backups"</span>
<span style="font-weight: bold; font-style: italic;">DATETIME</span>=<span style="font-weight: bold;">`date "+%Y%m%d-%H%M"`</span>

ssh -q -o <span style="font-weight: bold; font-style: italic;">BatchMode</span>=<span style="font-style: italic;">"yes"</span> -o <span style="font-weight: bold; font-style: italic;">ConnectTimeout</span>=10 ns01 <span style="font-style: italic;">"(cd ~/share/backups; mkdir -p pc01 sv04; exit)"</span> || <span style="font-weight: bold;">exit</span> 1

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">take a snapshot for pc01</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">if ssh ns01 "[ -h ~/share/backups/pc01/last ]"; then</span>
<span style="font-weight: bold; font-style: italic;">#   </span><span style="font-weight: bold; font-style: italic;">rsync -aPhrv $LINK --exclude-from=${HOME}/.config/rsync/exclude_pc01.txt ${HOME}/ ${DEST}/pc01/${DATETIME}</span>
<span style="font-weight: bold; font-style: italic;">#   </span><span style="font-weight: bold; font-style: italic;">ssh ns01 "(cd share/backups/pc01; unlink last; ln -s ${DATETIME} last)"</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">else</span>
<span style="font-weight: bold; font-style: italic;">#   </span><span style="font-weight: bold; font-style: italic;">rsync -aAXrv --exclude-from=${HOME}/.config/rsync/exclude_pc01.txt ${HOME}/ ${DEST}/pc01/${DATETIME}</span>
<span style="font-weight: bold; font-style: italic;">#   </span><span style="font-weight: bold; font-style: italic;">ssh ns01 "(cd share/backups/pc01; ln -s ${DATETIME} last)"</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">fi</span>

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">take a snapshot for sv04</span>
<span style="font-weight: bold;">if</span> mountpoint /mnt/sv04 &gt;/dev/null 2&gt;&amp;1; <span style="font-weight: bold;">then</span>
  <span style="font-weight: bold;">if</span> ssh ns01 <span style="font-style: italic;">"[ -h ~/share/backups/sv04/last ]"</span>; <span style="font-weight: bold;">then</span>
    rsync -aPhrv $<span style="font-weight: bold; font-style: italic;">LINK</span> --exclude-from=${<span style="font-weight: bold; font-style: italic;">HOME</span>}/.config/rsync/exclude_sv04.txt /mnt/sv04/ ${<span style="font-weight: bold; font-style: italic;">DEST</span>}/sv04/${<span style="font-weight: bold; font-style: italic;">DATETIME</span>}
    ssh ns01 <span style="font-style: italic;">"(cd share/backups/sv04; unlink last; ln -s ${DATETIME} last)"</span>
  <span style="font-weight: bold;">else</span>
    rsync -aAXrv --exclude-from=${<span style="font-weight: bold; font-style: italic;">HOME</span>}/.config/rsync/exclude_sv04.txt /mnt/sv04/ ${<span style="font-weight: bold; font-style: italic;">DEST</span>}/sv04/${<span style="font-weight: bold; font-style: italic;">DATETIME</span>}
    ssh ns01 <span style="font-style: italic;">"(cd share/backups/sv04; ln -s ${DATETIME} last)"</span>
  <span style="font-weight: bold;">fi</span>
<span style="font-weight: bold;">fi</span>
</pre>
</div>
<ul class="org-ul">
<li><p>
rsync exclude file for pc01
</p>
<div class="org-src-container">
<pre class="src src-conf">+ var
+ var/log
+ var/log/**
- var/lib/dash
+ var/lib
+ var/lib/**
+ work
+ work/**
+ git
+ git/**
- *
</pre>
</div></li>
<li><p>
rsync exclude file for sv04
</p>
<div class="org-src-container">
<pre class="src src-conf">+ var
+ var/backup
+ var/backup/**
- *
</pre>
</div></li>
</ul></li>
</ul>
</div>
</div>
<div id="outline-container-org0573985" class="outline-3">
<h3 id="org0573985">filetype</h3>
<div class="outline-text-3" id="text-org0573985">
<p>
This program determine type of the file.
</p>

<div class="org-src-container">
<pre class="src src-ruby"><span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">!/usr/bin/env ruby</span>

<span style="font-weight: bold;">require</span> <span style="font-style: italic;">'pathname'</span>
<span style="font-weight: bold;">require</span> <span style="font-style: italic;">'uri'</span>
<span style="font-weight: bold;">require</span> <span style="font-style: italic;">'shellwords'</span>

<span style="font-weight: bold;">class</span> <span style="font-weight: bold; text-decoration: underline;">FileType</span>
  <span style="font-weight: bold; text-decoration: underline;">ZIP_PREFIXES</span> = [<span style="font-style: italic;">'Zip archive data'</span>]

  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">self</span>.<span style="font-weight: bold;">type</span>(filename, file_cmd_opt = <span style="font-style: italic;">""</span>)
    <span style="font-weight: bold;">if</span>  <span style="font-weight: bold; text-decoration: underline;">File</span>.exists?(filename)
      local_opt = <span style="font-style: italic;">""</span>
      <span style="font-weight: bold;">if</span> <span style="font-weight: bold; text-decoration: underline;">File</span>.symlink?(filename)
        local_opt += <span style="font-style: italic;">"--dereference"</span>
      <span style="font-weight: bold;">end</span>
      <span style="font-style: italic;">`file --brief </span><span style="font-weight: bold; font-style: italic;">#{file_cmd_opt}</span><span style="font-style: italic;"> </span><span style="font-weight: bold; font-style: italic;">#{local_opt}</span><span style="font-style: italic;"> </span><span style="font-weight: bold; font-style: italic;">#{Shellwords.shellescape(filename)}</span><span style="font-style: italic;">`</span>.strip
    <span style="font-weight: bold;">elsif</span> filename =~ <span style="font-style: italic;">/https?:\/\/www\.youtube\.com.*/</span>
      <span style="font-style: italic;">`youtube-dl -f worst -q </span><span style="font-weight: bold; font-style: italic;">#{Shellwords.shellescape(filename)}</span><span style="font-style: italic;"> -o - 2&gt;/dev/null | file --brief </span><span style="font-weight: bold; font-style: italic;">#{file_cmd_opt}</span><span style="font-style: italic;"> -`</span>.strip
    <span style="font-weight: bold;">elsif</span> filename =~ <span style="font-weight: bold; text-decoration: underline;">URI</span>::<span style="font-weight: bold; text-decoration: underline;">DEFAULT_PARSER</span>.make_regexp
      <span style="font-style: italic;">`curl --location --range 0-9999 </span><span style="font-weight: bold; font-style: italic;">#{Shellwords.shellescape(filename)}</span><span style="font-style: italic;"> 2&gt;/dev/null | file --brief </span><span style="font-weight: bold; font-style: italic;">#{file_cmd_opt}</span><span style="font-style: italic;"> -`</span>.strip
    <span style="font-weight: bold;">else</span>
      <span style="font-style: italic;">''</span>
    <span style="font-weight: bold;">end</span>
  <span style="font-weight: bold;">end</span>

  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">self</span>.<span style="font-weight: bold;">mime_type</span>(filename)
    type(filename, <span style="font-style: italic;">"--mime-type"</span>)
  <span style="font-weight: bold;">end</span>

  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">self</span>.<span style="font-weight: bold;">block_device?</span>(file)
    type(file).start_with?(<span style="font-style: italic;">'block special'</span>) &amp;&amp;
      mime_type(file) == <span style="font-style: italic;">'inode/blockdevice'</span>
  <span style="font-weight: bold;">end</span>

  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">self</span>.<span style="font-weight: bold;">iso9660?</span>(file)
    mime_type(file) == <span style="font-style: italic;">'application/x-iso9660-image'</span>
  <span style="font-weight: bold;">end</span>

  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">self</span>.<span style="font-weight: bold;">video_dvd_image?</span>(file)
    iso9660?(file) &amp;&amp; type(file).start_with?(<span style="font-style: italic;">'UDF filesystem data'</span>)
  <span style="font-weight: bold;">end</span>

  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">self</span>.<span style="font-weight: bold;">html?</span>(file)
    type(file).start_with?(<span style="font-style: italic;">"HTML document"</span>)
  <span style="font-weight: bold;">end</span>

  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">self</span>.<span style="font-weight: bold;">pdf?</span>(file)
    type(file).start_with?(<span style="font-style: italic;">"PDF document"</span>)
  <span style="font-weight: bold;">end</span>

  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">self</span>.<span style="font-weight: bold;">epub?</span>(file)
    type(file) == <span style="font-style: italic;">"EPUB document"</span>
  <span style="font-weight: bold;">end</span>

  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">self</span>.<span style="font-weight: bold;">mobi?</span>(file)
    type(file).start_with?(<span style="font-style: italic;">"Mobipocket E-book"</span>)
  <span style="font-weight: bold;">end</span>

  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">self</span>.<span style="font-weight: bold;">pgp?</span>(file)
    type(file).start_with?(<span style="font-style: italic;">"PGP"</span>)
  <span style="font-weight: bold;">end</span>

  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">self</span>.<span style="font-weight: bold;">tarpgp?</span>(file)
    pgp?(file) &amp;&amp; file.end_with?(<span style="font-style: italic;">'.tar.gpg'</span>)
  <span style="font-weight: bold;">end</span>

  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">self</span>.<span style="font-weight: bold;">zip?</span>(file)
    type(file).start_with?(*<span style="font-weight: bold; text-decoration: underline;">ZIP_PREFIXES</span>)
  <span style="font-weight: bold;">end</span>

  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">self</span>.<span style="font-weight: bold;">video?</span>(file)
    mime_type(file).start_with?(<span style="font-style: italic;">"video/"</span>)
  <span style="font-weight: bold;">end</span>

  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">self</span>.<span style="font-weight: bold;">audio?</span>(file)
    mime_type(file).start_with?(<span style="font-style: italic;">'audio/'</span>)
  <span style="font-weight: bold;">end</span>

  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">self</span>.<span style="font-weight: bold;">image?</span>(file)
    mime_type(file).start_with?(<span style="font-style: italic;">"image/"</span>)
  <span style="font-weight: bold;">end</span>

  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">self</span>.<span style="font-weight: bold;">playable?</span>(file)
    <span style="font-weight: bold;">if</span> <span style="font-weight: bold; text-decoration: underline;">File</span>.directory?(file)
      <span style="font-weight: bold; text-decoration: underline;">Dir</span>.foreach(file) <span style="font-weight: bold;">do</span> |fname|
        <span style="font-weight: bold;">next</span> <span style="font-weight: bold;">if</span> [<span style="font-style: italic;">"."</span>, <span style="font-style: italic;">".."</span>].include?(fname)
        <span style="font-weight: bold;">return</span> <span style="font-weight: bold; text-decoration: underline;">false</span> <span style="font-weight: bold;">unless</span> playable?(<span style="font-style: italic;">"</span><span style="font-weight: bold; font-style: italic;">#{file}</span><span style="font-style: italic;">/</span><span style="font-weight: bold; font-style: italic;">#{fname}</span><span style="font-style: italic;">"</span>)
      <span style="font-weight: bold;">end</span>
      <span style="font-weight: bold; text-decoration: underline;">true</span>
    <span style="font-weight: bold;">elsif</span> file =~ <span style="font-style: italic;">/https?:\/\/www\.youtube\.com.*/</span>
      <span style="font-weight: bold; text-decoration: underline;">true</span>
    <span style="font-weight: bold;">else</span>
      type(file).start_with?(<span style="font-style: italic;">"ISO Media"</span>, <span style="font-style: italic;">"Audio file"</span>) ||
        mime_type(file).start_with?(<span style="font-style: italic;">"video"</span>, <span style="font-style: italic;">"audio"</span>, <span style="font-style: italic;">"image"</span>)
    <span style="font-weight: bold;">end</span>
  <span style="font-weight: bold;">end</span>

  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">self</span>.<span style="font-weight: bold;">dvd_dir?</span>(file)
    <span style="font-weight: bold; text-decoration: underline;">false</span> <span style="font-weight: bold;">unless</span> mime_type(file) == <span style="font-style: italic;">'inode/directory'</span>
    <span style="font-weight: bold; text-decoration: underline;">File</span>.exist?(<span style="font-weight: bold; text-decoration: underline;">Pathname</span>.new(file).join(<span style="font-style: italic;">"VIDEO_TS"</span>)) ||
      <span style="font-weight: bold; text-decoration: underline;">File</span>.exist?(<span style="font-weight: bold; text-decoration: underline;">Pathname</span>.new(file).join(<span style="font-style: italic;">"video_ts"</span>))
  <span style="font-weight: bold;">end</span>
<span style="font-weight: bold;">end</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-orgbb63ac2" class="outline-3">
<h3 id="orgbb63ac2">mediautil</h3>
<div class="outline-text-3" id="text-orgbb63ac2">
<p>
Utility ruby program for manipulating image, audio and video file.
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"dvd+rw-tools"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-ruby"><span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">!/usr/bin/env ruby</span>

<span style="font-weight: bold;">require</span> <span style="font-style: italic;">'thor'</span>
<span style="font-weight: bold;">require</span> <span style="font-style: italic;">'open3'</span>
<span style="font-weight: bold;">require</span> <span style="font-style: italic;">'fileutils'</span>
<span style="font-weight: bold;">require</span> <span style="font-style: italic;">'tempfile'</span>
<span style="font-weight: bold;">require</span> <span style="font-style: italic;">'tmpdir'</span>

<span style="font-weight: bold;">require</span> <span style="font-style: italic;">'filetype'</span>

<span style="font-weight: bold;">class</span> <span style="font-weight: bold; text-decoration: underline;">MediaUtil</span> &lt; <span style="font-weight: bold; text-decoration: underline;">Thor</span>
  <span style="font-weight: bold; text-decoration: underline;">OUTFILE_SUFFIX</span> = <span style="font-style: italic;">"_out"</span>
  <span style="font-weight: bold; text-decoration: underline;">DEFAULT_VIDEO_EXT</span> = <span style="font-style: italic;">".mkv"</span>

  <span style="font-weight: bold;">class</span> <span style="font-weight: bold; text-decoration: underline;">Names</span> &lt; <span style="font-weight: bold; text-decoration: underline;">Struct</span>.new(<span style="font-weight: bold; text-decoration: underline;">:in_f</span>, <span style="font-weight: bold; text-decoration: underline;">:out_f</span>)
    <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">in_file</span>()
      in_f
    <span style="font-weight: bold;">end</span>
    <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">out_file</span>(extension = <span style="font-weight: bold; text-decoration: underline;">nil</span>)
      <span style="font-weight: bold;">if</span> out_f
        out_f
      <span style="font-weight: bold;">else</span>
        bn = <span style="font-weight: bold; text-decoration: underline;">File</span>.basename(in_f, <span style="font-style: italic;">".*"</span>).gsub(<span style="font-style: italic;">/ /</span>, <span style="font-style: italic;">'_'</span>)
        ext = ((extension) ? extension : <span style="font-weight: bold; text-decoration: underline;">File</span>.extname(in_file))
        default_out = bn + ext
        <span style="font-weight: bold;">if</span> <span style="font-weight: bold; text-decoration: underline;">File</span>.file?(default_out)
          10.times <span style="font-weight: bold;">do</span> |i|
            try_name = bn + <span style="font-style: italic;">"_"</span> + (i+1).to_s + ext
            <span style="font-weight: bold;">unless</span> <span style="font-weight: bold; text-decoration: underline;">File</span>.file?(try_name)
              <span style="font-weight: bold;">return</span> try_name
            <span style="font-weight: bold;">end</span>
          <span style="font-weight: bold;">end</span>
        <span style="font-weight: bold;">end</span>
        default_out
      <span style="font-weight: bold;">end</span>
    <span style="font-weight: bold;">end</span>
    <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">title</span>()
      <span style="font-weight: bold; text-decoration: underline;">File</span>.basename(out_file, <span style="font-style: italic;">".*"</span>)
    <span style="font-weight: bold;">end</span>
  <span style="font-weight: bold;">end</span>
  <span style="font-weight: bold;">class</span> <span style="font-weight: bold; text-decoration: underline;">Commander</span> &lt; <span style="font-weight: bold; text-decoration: underline;">Struct</span>.new(<span style="font-weight: bold; text-decoration: underline;">:log</span>, <span style="font-weight: bold; text-decoration: underline;">:dry</span>)
    <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">execute</span>(command)
      <span style="font-weight: bold;">if</span> dry
        <span style="font-weight: bold;">puts</span> command
      <span style="font-weight: bold;">else</span>
        log_str, s_code = <span style="font-weight: bold; text-decoration: underline;">Open3</span>.capture2e(command)
        <span style="font-weight: bold;">if</span> log
          user_cmd = <span style="font-weight: bold;">caller</span>.first.scan(<span style="font-style: italic;">/`(.*)'/</span>).flatten.first.to_s
          log_fname = <span style="font-weight: bold; text-decoration: underline;">Time</span>.now.strftime(<span style="font-style: italic;">"%Y%m%d_%H%M%S_"</span>) + user_cmd + <span style="font-style: italic;">".log"</span>
          <span style="font-weight: bold; text-decoration: underline;">File</span>.open(log_fname, <span style="font-style: italic;">"w"</span>) <span style="font-weight: bold;">do</span> |f|
            f.puts(log_str)
          <span style="font-weight: bold;">end</span>
        <span style="font-weight: bold;">else</span>
          <span style="font-weight: bold;">puts</span> log_str
        <span style="font-weight: bold;">end</span>
        <span style="font-weight: bold;">exit</span> <span style="font-weight: bold; text-decoration: underline;">false</span> <span style="font-weight: bold;">unless</span> s_code.success?
        <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">exit false</span>
      <span style="font-weight: bold;">end</span>
    <span style="font-weight: bold;">end</span>
  <span style="font-weight: bold;">end</span>

  class_option <span style="font-weight: bold; text-decoration: underline;">:log</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"L"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:boolean</span>,
               <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">"log stdout and stderr instead they reveal in terminal"</span>
  class_option <span style="font-weight: bold; text-decoration: underline;">:dryrun</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"D"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:boolean</span>

  desc <span style="font-style: italic;">"info &lt;file&gt;"</span>, <span style="font-style: italic;">"show information about the video file or DVD directory"</span>
  option <span style="font-weight: bold; text-decoration: underline;">:short</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"s"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:boolean</span>
  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">info</span>(target)
    commander = <span style="font-weight: bold; text-decoration: underline;">Commander</span>.new(options[<span style="font-weight: bold; text-decoration: underline;">:log</span>], options[<span style="font-weight: bold; text-decoration: underline;">:dryrun</span>])

    <span style="font-weight: bold;">if</span> <span style="font-weight: bold; text-decoration: underline;">FileType</span>.video?(target) || <span style="font-weight: bold; text-decoration: underline;">FileType</span>.audio?(target)
      commander.execute(<span style="font-style: italic;">"ffprobe \"</span><span style="font-weight: bold; font-style: italic;">#{target}</span><span style="font-style: italic;">\" -hide_banner -show_entries format"</span>)
    <span style="font-weight: bold;">elsif</span> <span style="font-weight: bold; text-decoration: underline;">FileType</span>.image?(target)
      <span style="font-weight: bold;">if</span> options[<span style="font-weight: bold; text-decoration: underline;">:short</span>]
        commander.execute(<span style="font-style: italic;">"identify </span><span style="font-weight: bold; font-style: italic;">#{target}</span><span style="font-style: italic;">"</span>)
      <span style="font-weight: bold;">else</span>
        commander.execute(<span style="font-style: italic;">"identify -verbose </span><span style="font-weight: bold; font-style: italic;">#{target}</span><span style="font-style: italic;">"</span>)
      <span style="font-weight: bold;">end</span>
    <span style="font-weight: bold;">elsif</span> <span style="font-weight: bold; text-decoration: underline;">FileType</span>.block_device?(target) ||
          <span style="font-weight: bold; text-decoration: underline;">FileType</span>.video_dvd_image?(target) ||
          <span style="font-weight: bold; text-decoration: underline;">FileType</span>.dvd_dir?(target)
      commander.execute(<span style="font-style: italic;">"HandBrakeCLI -i \"</span><span style="font-weight: bold; font-style: italic;">#{target}</span><span style="font-style: italic;">\" --title 0"</span>)
    <span style="font-weight: bold;">else</span>
      <span style="font-weight: bold; text-decoration: underline;">STDERR</span>.puts <span style="font-style: italic;">"Unknown Media Format"</span>
      <span style="font-weight: bold;">exit</span> <span style="font-weight: bold; text-decoration: underline;">false</span>
    <span style="font-weight: bold;">end</span>
  <span style="font-weight: bold;">end</span>

  default_command <span style="font-weight: bold; text-decoration: underline;">:encode</span>
  desc <span style="font-style: italic;">"encode"</span>, <span style="font-style: italic;">"encode video file"</span>
  option <span style="font-weight: bold; text-decoration: underline;">:in</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"i"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>, <span style="font-weight: bold; text-decoration: underline;">:required</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">true</span>
  option <span style="font-weight: bold; text-decoration: underline;">:out</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"o"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>
  option <span style="font-weight: bold; text-decoration: underline;">:vencoder</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"e"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:banner</span> =&gt; <span style="font-style: italic;">"libx265|libx264"</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">"video encoder"</span>
  option <span style="font-weight: bold; text-decoration: underline;">:vquality</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"q"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:banner</span> =&gt; <span style="font-style: italic;">"24.0"</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">"video encoding quality"</span>
  option <span style="font-weight: bold; text-decoration: underline;">:vbitrate</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"b"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:banner</span> =&gt; <span style="font-style: italic;">"1000"</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">"video encoding bitrate in kbps"</span>
  option <span style="font-weight: bold; text-decoration: underline;">:aencoder</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"E"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:banner</span> =&gt; <span style="font-style: italic;">"fdk_aac"</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">"audio encoder"</span>
  option <span style="font-weight: bold; text-decoration: underline;">:aquality</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"Q"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:banner</span> =&gt; <span style="font-style: italic;">"100.0"</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">"audio encoding quality"</span>
  option <span style="font-weight: bold; text-decoration: underline;">:abitrate</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"B"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:banner</span> =&gt; <span style="font-style: italic;">"128"</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">"audio encoding bitrate in kbps"</span>
  option <span style="font-weight: bold; text-decoration: underline;">:display</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"d"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:banner</span> =&gt; <span style="font-style: italic;">"1920:1080"</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">'display (width:height) in which encoded video fit'</span>
  option <span style="font-weight: bold; text-decoration: underline;">:fps</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"f"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:banner</span> =&gt; <span style="font-style: italic;">"30"</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">'max frame rate'</span>
  option <span style="font-weight: bold; text-decoration: underline;">:ffmpeg</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>
  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">encode</span>()
    equip = <span style="font-weight: bold; text-decoration: underline;">Names</span>.new(options[<span style="font-weight: bold; text-decoration: underline;">:in</span>], options[<span style="font-weight: bold; text-decoration: underline;">:out</span>])
    commander = <span style="font-weight: bold; text-decoration: underline;">Commander</span>.new(options[<span style="font-weight: bold; text-decoration: underline;">:log</span>], options[<span style="font-weight: bold; text-decoration: underline;">:dryrun</span>])

    vconf = aconf = pconf = <span style="font-weight: bold; text-decoration: underline;">nil</span>
    <span style="font-weight: bold;">if</span> options[<span style="font-weight: bold; text-decoration: underline;">:vencoder</span>] || options[<span style="font-weight: bold; text-decoration: underline;">:vquality</span>]
      vconf = <span style="font-weight: bold; text-decoration: underline;">VideoConfig</span>.new(options[<span style="font-weight: bold; text-decoration: underline;">:vencoder</span>], options[<span style="font-weight: bold; text-decoration: underline;">:vquality</span>], options[<span style="font-weight: bold; text-decoration: underline;">:vbitrate</span>])
    <span style="font-weight: bold;">end</span>
    <span style="font-weight: bold;">if</span> options[<span style="font-weight: bold; text-decoration: underline;">:aencoder</span>] || options[<span style="font-weight: bold; text-decoration: underline;">:aquality</span>]
      aconf = <span style="font-weight: bold; text-decoration: underline;">AudioConfig</span>.new(options[<span style="font-weight: bold; text-decoration: underline;">:aencoder</span>], options[<span style="font-weight: bold; text-decoration: underline;">:aquality</span>], options[<span style="font-weight: bold; text-decoration: underline;">:abitrate</span>])
    <span style="font-weight: bold;">end</span>
    <span style="font-weight: bold;">if</span> options[<span style="font-weight: bold; text-decoration: underline;">:display</span>] || options[<span style="font-weight: bold; text-decoration: underline;">:fps</span>]
      pconf = <span style="font-weight: bold; text-decoration: underline;">PictureConfig</span>.new
      pconf.fit_size(options[<span style="font-weight: bold; text-decoration: underline;">:display</span>]) <span style="font-weight: bold;">if</span> options[<span style="font-weight: bold; text-decoration: underline;">:display</span>]
      pconf.decrease_framerate(options[<span style="font-weight: bold; text-decoration: underline;">:fps</span>]) <span style="font-weight: bold;">if</span> options[<span style="font-weight: bold; text-decoration: underline;">:fps</span>]
    <span style="font-weight: bold;">end</span>

    <span style="font-weight: bold;">if</span> <span style="font-weight: bold; text-decoration: underline;">FileType</span>.video?(equip.in_file) <span style="font-weight: bold;">then</span>
      commander.execute(<span style="font-weight: bold; text-decoration: underline;">FFMPEG</span>.command([<span style="font-weight: bold; text-decoration: underline;">FFMPEGOptSet</span>.new(equip.in_file, [])],
                                       [<span style="font-weight: bold; text-decoration: underline;">FFMPEGOptSet</span>.new(equip.out_file, [vconf, aconf, pconf, <span style="font-style: italic;">"-map_metadata 0"</span>, options[<span style="font-weight: bold; text-decoration: underline;">:ffmpeg</span>]])]))
    <span style="font-weight: bold;">elsif</span> <span style="font-weight: bold; text-decoration: underline;">FileType</span>.audio?(equip.in_file) <span style="font-weight: bold;">then</span>
      commander.execute(<span style="font-weight: bold; text-decoration: underline;">FFMPEG</span>.command([<span style="font-weight: bold; text-decoration: underline;">FFMPEGOptSet</span>.new(equip.in_file, [])],
                                       [<span style="font-weight: bold; text-decoration: underline;">FFMPEGOptSet</span>.new(equip.out_file, [aconf])]))
    <span style="font-weight: bold;">elsif</span> <span style="font-weight: bold; text-decoration: underline;">FileType</span>.image?(equip.in_file) <span style="font-weight: bold;">then</span>
      pconf = <span style="font-weight: bold; text-decoration: underline;">ImageConfig</span>.new
      commander.execute(<span style="font-weight: bold; text-decoration: underline;">ImageMagick</span>.command(equip.in_file,
                                            equip.out_file,
                                            pconf))
    <span style="font-weight: bold;">else</span>
      <span style="font-weight: bold; text-decoration: underline;">STDERR</span>.puts <span style="font-style: italic;">"Unknown Media Format"</span>
      <span style="font-weight: bold;">exit</span> <span style="font-weight: bold; text-decoration: underline;">false</span>
    <span style="font-weight: bold;">end</span>
  <span style="font-weight: bold;">end</span>

  desc <span style="font-style: italic;">'cdencode'</span>, <span style="font-style: italic;">'rip and encode CD contents'</span>
  option <span style="font-weight: bold; text-decoration: underline;">:device</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">'d'</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">'Device file'</span>
  option <span style="font-weight: bold; text-decoration: underline;">:format</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">'f'</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:banner</span> =&gt; <span style="font-style: italic;">'flac,ogg,m4a'</span>, <span style="font-weight: bold; text-decoration: underline;">:default</span> =&gt; <span style="font-style: italic;">'flac:-8'</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">'formats with additinal argument like compression level'</span>
  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">cdencode</span>()
    commander = <span style="font-weight: bold; text-decoration: underline;">Commander</span>.new(options[<span style="font-weight: bold; text-decoration: underline;">:log</span>], options[<span style="font-weight: bold; text-decoration: underline;">:dryrun</span>])

    abcde_args = []
    abcde_args &lt;&lt; <span style="font-style: italic;">"-d </span><span style="font-weight: bold; font-style: italic;">#{options[:device]}</span><span style="font-style: italic;">"</span> <span style="font-weight: bold;">if</span> options[<span style="font-weight: bold; text-decoration: underline;">:device</span>]
    abcde_args &lt;&lt; <span style="font-style: italic;">'-a default'</span>
    <span style="font-weight: bold;">if</span> options[<span style="font-weight: bold; text-decoration: underline;">:format</span>] <span style="font-weight: bold;">then</span>
      abcde_args &lt;&lt; <span style="font-style: italic;">"-o '</span><span style="font-weight: bold; font-style: italic;">#{options[:format]}</span><span style="font-style: italic;">'"</span>
    <span style="font-weight: bold;">end</span>
    abcde_args &lt;&lt; <span style="font-style: italic;">'-G'</span> <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">getalbumart</span>
    abcde_args &lt;&lt; <span style="font-style: italic;">'-x'</span> <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Eject CD</span>

    commander.execute(<span style="font-style: italic;">"abcde </span><span style="font-weight: bold; font-style: italic;">#{abcde_args.join(' ')}</span><span style="font-style: italic;">"</span>)
  <span style="font-weight: bold;">end</span>

  desc <span style="font-style: italic;">'dvdrip'</span>, <span style="font-style: italic;">'rip(backup) DVD contents'</span>
  option <span style="font-weight: bold; text-decoration: underline;">:device</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">'d'</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">'DVD device file'</span>
  option <span style="font-weight: bold; text-decoration: underline;">:out</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">'o'</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">'output directory name'</span>
  option <span style="font-weight: bold; text-decoration: underline;">:name</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">'n'</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">'root directory name of backup data'</span>
  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">dvdrip</span>()
    commander = <span style="font-weight: bold; text-decoration: underline;">Commander</span>.new(options[<span style="font-weight: bold; text-decoration: underline;">:log</span>], options[<span style="font-weight: bold; text-decoration: underline;">:dryrun</span>])

    dvdbackup_opts = [<span style="font-style: italic;">'dvdbackup'</span>]
    dvdbackup_opts &lt;&lt; <span style="font-style: italic;">'--input=%s'</span> % options[<span style="font-weight: bold; text-decoration: underline;">:device</span>] <span style="font-weight: bold;">if</span> options[<span style="font-weight: bold; text-decoration: underline;">:device</span>]
    dvdbackup_opts &lt;&lt; <span style="font-style: italic;">'--output=%s'</span> % options[<span style="font-weight: bold; text-decoration: underline;">:out</span>] <span style="font-weight: bold;">if</span> options[<span style="font-weight: bold; text-decoration: underline;">:out</span>]
    dvdbackup_opts &lt;&lt; <span style="font-style: italic;">'--name=%s'</span> % options[<span style="font-weight: bold; text-decoration: underline;">:name</span>] <span style="font-weight: bold;">if</span> options[<span style="font-weight: bold; text-decoration: underline;">:name</span>]
    dvdbackup_opts &lt;&lt; <span style="font-style: italic;">'--mirror'</span>
    dvdbackup_opts &lt;&lt; <span style="font-style: italic;">'--progress'</span>
    dvdbackup_opts &lt;&lt; <span style="font-style: italic;">'--verbose'</span>

    commander.execute(dvdbackup_opts.join(<span style="font-style: italic;">' '</span>))
  <span style="font-weight: bold;">end</span>

  desc <span style="font-style: italic;">'dvdencode'</span>, <span style="font-style: italic;">'encode DVD contents'</span>
  option <span style="font-weight: bold; text-decoration: underline;">:in</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">'i'</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>, <span style="font-weight: bold; text-decoration: underline;">:required</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">true</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">'input source, DVD device file or backuped DVD file'</span>
  option <span style="font-weight: bold; text-decoration: underline;">:out</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">'o'</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">'output directory name'</span>
  option <span style="font-weight: bold; text-decoration: underline;">:vencoder</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"e"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:banner</span> =&gt; <span style="font-style: italic;">"x265|x264"</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">"video encoder"</span>
  option <span style="font-weight: bold; text-decoration: underline;">:vquality</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"q"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:banner</span> =&gt; <span style="font-style: italic;">"24.0"</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">"video encoding quality"</span>
  option <span style="font-weight: bold; text-decoration: underline;">:vbitrate</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"b"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:banner</span> =&gt; <span style="font-style: italic;">"1000"</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">"video bitrate in kbps"</span>
  option <span style="font-weight: bold; text-decoration: underline;">:aencoder</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"E"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:banner</span> =&gt; <span style="font-style: italic;">"fdk_aac"</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">"audio encoder"</span>
  option <span style="font-weight: bold; text-decoration: underline;">:aquality</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"Q"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:banner</span> =&gt; <span style="font-style: italic;">"100.0"</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">"audio encoding quality"</span>
  option <span style="font-weight: bold; text-decoration: underline;">:abitrate</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"B"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:banner</span> =&gt; <span style="font-style: italic;">"128"</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">"audio bitrate in kbps"</span>
  option <span style="font-weight: bold; text-decoration: underline;">:title</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">'t'</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:banner</span> =&gt; <span style="font-style: italic;">'1|2|3|...'</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">'title number'</span>
  option <span style="font-weight: bold; text-decoration: underline;">:chapters</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">'c'</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:banner</span> =&gt; <span style="font-style: italic;">'1|1-3|1,3,5|...'</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">'chapter numbers'</span>
  option <span style="font-weight: bold; text-decoration: underline;">:audio</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">'a'</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:banner</span> =&gt; <span style="font-style: italic;">'1,2,3'</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">'audio channel'</span>
  option <span style="font-weight: bold; text-decoration: underline;">:subtitle</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">'s'</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:banner</span> =&gt; <span style="font-style: italic;">'1,2'</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">'subtitle channel'</span>
  option <span style="font-weight: bold; text-decoration: underline;">:handbrake</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:banner</span> =&gt; <span style="font-style: italic;">'--handbrake \"--mixdown 5point1,stereo\"'</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">'HandBrakeCLI options'</span>
  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">dvdencode</span>()
    equip = <span style="font-weight: bold; text-decoration: underline;">Names</span>.new(options[<span style="font-weight: bold; text-decoration: underline;">:in</span>], options[<span style="font-weight: bold; text-decoration: underline;">:out</span>])
    commander = <span style="font-weight: bold; text-decoration: underline;">Commander</span>.new(options[<span style="font-weight: bold; text-decoration: underline;">:log</span>], options[<span style="font-weight: bold; text-decoration: underline;">:dryrun</span>])

    <span style="font-weight: bold;">if</span> <span style="font-weight: bold; text-decoration: underline;">FileType</span>.block_device?(equip.in_file) ||
       <span style="font-weight: bold; text-decoration: underline;">FileType</span>.video_dvd_image?(equip.in_file) ||
       <span style="font-weight: bold; text-decoration: underline;">FileType</span>.dvd_dir?(equip.in_file)
      configs = []
      configs &lt;&lt; <span style="font-weight: bold; text-decoration: underline;">VideoConfig</span>.new(options[<span style="font-weight: bold; text-decoration: underline;">:vencoder</span>], options[<span style="font-weight: bold; text-decoration: underline;">:vquality</span>], options[<span style="font-weight: bold; text-decoration: underline;">:vbitrate</span>])
      configs &lt;&lt; <span style="font-weight: bold; text-decoration: underline;">AudioConfig</span>.new(options[<span style="font-weight: bold; text-decoration: underline;">:aencoder</span>], options[<span style="font-weight: bold; text-decoration: underline;">:aquality</span>], options[<span style="font-weight: bold; text-decoration: underline;">:abitrate</span>])
      dconf = <span style="font-weight: bold; text-decoration: underline;">DVDConfig</span>.new
      dconf.title = options[<span style="font-weight: bold; text-decoration: underline;">:title</span>] <span style="font-weight: bold;">if</span> options[<span style="font-weight: bold; text-decoration: underline;">:title</span>]
      dconf.chapters = options[<span style="font-weight: bold; text-decoration: underline;">:chapters</span>] <span style="font-weight: bold;">if</span> options[<span style="font-weight: bold; text-decoration: underline;">:chapters</span>]
      dconf.audio = options[<span style="font-weight: bold; text-decoration: underline;">:audio</span>] <span style="font-weight: bold;">if</span> options[<span style="font-weight: bold; text-decoration: underline;">:audio</span>]
      dconf.subtitle = options[<span style="font-weight: bold; text-decoration: underline;">:subtitle</span>] <span style="font-weight: bold;">if</span> options[<span style="font-weight: bold; text-decoration: underline;">:subtitle</span>]
      configs &lt;&lt; dconf
      commander.execute(<span style="font-weight: bold; text-decoration: underline;">HandBrakeCLI</span>.command(equip.in_file,
                                             equip.out_file(<span style="font-weight: bold; text-decoration: underline;">DEFAULT_VIDEO_EXT</span>),
                                             configs,
                                             options[<span style="font-weight: bold; text-decoration: underline;">:handbrake</span>]))
    <span style="font-weight: bold;">end</span>
  <span style="font-weight: bold;">end</span>

  desc <span style="font-style: italic;">'mount &lt;dir&gt;'</span>, <span style="font-style: italic;">'Mount CD/DVD media to dir.'</span>
  option <span style="font-weight: bold; text-decoration: underline;">:device</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"d"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>, <span style="font-weight: bold; text-decoration: underline;">:required</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">true</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">'device or iso file to mount'</span>,
         <span style="font-weight: bold; text-decoration: underline;">:banner</span> =&gt; <span style="font-style: italic;">'--mount /dev/dvd|image.iso'</span>
  option <span style="font-weight: bold; text-decoration: underline;">:type</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">'t'</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">'mount DVD-Video'</span>,
         <span style="font-weight: bold; text-decoration: underline;">:banner</span> =&gt; <span style="font-style: italic;">'--type data|video'</span>
  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">mount</span>(dir)
    commander = <span style="font-weight: bold; text-decoration: underline;">Commander</span>.new(options[<span style="font-weight: bold; text-decoration: underline;">:log</span>], options[<span style="font-weight: bold; text-decoration: underline;">:dryrun</span>])

    cmd_opts = [<span style="font-style: italic;">'mount'</span>]
    <span style="font-weight: bold;">if</span> options[<span style="font-weight: bold; text-decoration: underline;">:type</span>] == <span style="font-style: italic;">'video'</span> || <span style="font-weight: bold; text-decoration: underline;">FileType</span>.video_dvd_image?(options[<span style="font-weight: bold; text-decoration: underline;">:device</span>])
      cmd_opts &lt;&lt; [<span style="font-style: italic;">'-t'</span>, <span style="font-style: italic;">'iso9660'</span>, <span style="font-style: italic;">'-o'</span>, <span style="font-style: italic;">'loop'</span>]
    <span style="font-weight: bold;">end</span>
    cmd_opts &lt;&lt; options[<span style="font-weight: bold; text-decoration: underline;">:device</span>]
    cmd_opts &lt;&lt; dir

    <span style="font-weight: bold; text-decoration: underline;">Dir</span>.mkdir(dir) <span style="font-weight: bold;">if</span> !<span style="font-weight: bold; text-decoration: underline;">Dir</span>.exist?(dir) &amp;&amp; !options[<span style="font-weight: bold; text-decoration: underline;">:dryrun</span>]
    commander.execute(<span style="font-style: italic;">"sudo </span><span style="font-weight: bold; font-style: italic;">#{cmd_opts.join(' ')}</span><span style="font-style: italic;">"</span>)
  <span style="font-weight: bold;">end</span>

  desc <span style="font-style: italic;">'umount'</span>, <span style="font-style: italic;">'unmount dir'</span>
  option <span style="font-weight: bold; text-decoration: underline;">:remove</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">'r'</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:boolean</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">'remove dir after unmounting'</span>
  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">umount</span>(dir)
    commander = <span style="font-weight: bold; text-decoration: underline;">Commander</span>.new(options[<span style="font-weight: bold; text-decoration: underline;">:log</span>], options[<span style="font-weight: bold; text-decoration: underline;">:dryrun</span>])

    cmd_opts = [<span style="font-style: italic;">'umount'</span>]
    cmd_opts &lt;&lt; dir

    commander.execute(<span style="font-style: italic;">"sudo </span><span style="font-weight: bold; font-style: italic;">#{cmd_opts.join(' ')}</span><span style="font-style: italic;">"</span>)

    <span style="font-weight: bold;">if</span> options[<span style="font-weight: bold; text-decoration: underline;">:remove</span>]
      <span style="font-weight: bold; text-decoration: underline;">FileUtils</span>.rmdir(dir)
    <span style="font-weight: bold;">end</span>
  <span style="font-weight: bold;">end</span>

  desc <span style="font-style: italic;">'mkiso'</span>, <span style="font-style: italic;">'make ISO image file.'</span>
  option <span style="font-weight: bold; text-decoration: underline;">:type</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">'t'</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>, <span style="font-weight: bold; text-decoration: underline;">:required</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">true</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">'DVD image type. Data or Video DVD.'</span>,
         <span style="font-weight: bold; text-decoration: underline;">:banner</span> =&gt; <span style="font-style: italic;">'--type data|video'</span>
  option <span style="font-weight: bold; text-decoration: underline;">:volume</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">'V'</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">'Volume Label'</span>
  option <span style="font-weight: bold; text-decoration: underline;">:out</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">'o'</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">'ISO image file name.'</span>,
         <span style="font-weight: bold; text-decoration: underline;">:banner</span> =&gt; <span style="font-style: italic;">'--out movie.iso'</span>
  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">mkiso</span>(file)
    names = <span style="font-weight: bold; text-decoration: underline;">Names</span>.new(file, options[<span style="font-weight: bold; text-decoration: underline;">:out</span>])
    commander = <span style="font-weight: bold; text-decoration: underline;">Commander</span>.new(options[<span style="font-weight: bold; text-decoration: underline;">:log</span>], options[<span style="font-weight: bold; text-decoration: underline;">:dryrun</span>])

    mkisofs_opts = [<span style="font-style: italic;">'mkisofs'</span>]
    mkisofs_opts &lt;&lt; [<span style="font-style: italic;">"-V"</span>, <span style="font-style: italic;">"\"</span><span style="font-weight: bold; font-style: italic;">#{options[:volume]}</span><span style="font-style: italic;">\""</span>] <span style="font-weight: bold;">if</span> options[<span style="font-weight: bold; text-decoration: underline;">:volume</span>]
    <span style="font-weight: bold;">if</span> options[<span style="font-weight: bold; text-decoration: underline;">:type</span>] == <span style="font-style: italic;">"data"</span>
      mkisofs_opts &lt;&lt; [<span style="font-style: italic;">"-r"</span>, <span style="font-style: italic;">"-l"</span>, <span style="font-style: italic;">"-J"</span>]
    <span style="font-weight: bold;">elsif</span> options[<span style="font-weight: bold; text-decoration: underline;">:type</span>]
      mkisofs_opts &lt;&lt; <span style="font-style: italic;">"-dvd-video"</span>
    <span style="font-weight: bold;">else</span>
      <span style="font-weight: bold;">exit</span> 1
    <span style="font-weight: bold;">end</span>
    mkisofs_opts &lt;&lt; [<span style="font-style: italic;">"-o"</span>, <span style="font-style: italic;">"\"</span><span style="font-weight: bold; font-style: italic;">#{names.out_file('.iso')}</span><span style="font-style: italic;">\""</span>]
    mkisofs_opts &lt;&lt; <span style="font-style: italic;">"\"</span><span style="font-weight: bold; font-style: italic;">#{file}</span><span style="font-style: italic;">\""</span>

    commander.execute(mkisofs_opts.join(<span style="font-style: italic;">" "</span>))
  <span style="font-weight: bold;">end</span>

  desc <span style="font-style: italic;">'dvdburn &lt;file&gt;'</span>, <span style="font-style: italic;">'Burn file to DVD.'</span>
  option <span style="font-weight: bold; text-decoration: underline;">:iso</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">'I'</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:boolean</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">'Set this option if &lt;file&gt; is ISO 9660 compliant.'</span>
  option <span style="font-weight: bold; text-decoration: underline;">:volume</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">'V'</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>, <span style="font-weight: bold; text-decoration: underline;">:default</span> =&gt; <span style="font-style: italic;">'DVD_VIDEO'</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">'Volume Label'</span>
  option <span style="font-weight: bold; text-decoration: underline;">:video</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">'v'</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:boolean</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">'Create DVD video image file to burn.'</span>
  option <span style="font-weight: bold; text-decoration: underline;">:speed</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">'s'</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>, <span style="font-weight: bold; text-decoration: underline;">:default</span> =&gt; <span style="font-style: italic;">'4'</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">'Burning Speed'</span>,
         <span style="font-weight: bold; text-decoration: underline;">:banner</span> =&gt; <span style="font-style: italic;">'n'</span>
  option <span style="font-weight: bold; text-decoration: underline;">:device</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">'d'</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">'Device file'</span>, <span style="font-weight: bold; text-decoration: underline;">:default</span> =&gt; <span style="font-style: italic;">'/dev/sr0'</span>
  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">dvdburn</span>(file)
    commander = <span style="font-weight: bold; text-decoration: underline;">Commander</span>.new(options[<span style="font-weight: bold; text-decoration: underline;">:log</span>], options[<span style="font-weight: bold; text-decoration: underline;">:dryrun</span>])

    cmd_opts = [<span style="font-style: italic;">'growisofs'</span>]
    cmd_opts &lt;&lt; <span style="font-style: italic;">'-dvd-compat'</span>
    cmd_opts &lt;&lt; <span style="font-style: italic;">'-speed=%s'</span> % options[<span style="font-weight: bold; text-decoration: underline;">:speed</span>]
    <span style="font-weight: bold;">if</span> <span style="font-weight: bold; text-decoration: underline;">FileType</span>.iso9660?(file) || options[<span style="font-weight: bold; text-decoration: underline;">:iso</span>]
      cmd_opts &lt;&lt; <span style="font-style: italic;">'-Z %s=%s'</span> % [options[<span style="font-weight: bold; text-decoration: underline;">:device</span>], file]
    <span style="font-weight: bold;">else</span>
      cmd_opts &lt;&lt; <span style="font-style: italic;">'-Z %s'</span> % options[<span style="font-weight: bold; text-decoration: underline;">:device</span>]
      mkisofs_opts = []
      mkisofs_opts &lt;&lt; [<span style="font-style: italic;">'-V'</span>, <span style="font-style: italic;">"\"</span><span style="font-weight: bold; font-style: italic;">#{options[:volume]}</span><span style="font-style: italic;">\""</span>] <span style="font-weight: bold;">if</span> options[<span style="font-weight: bold; text-decoration: underline;">:volume</span>]
      <span style="font-weight: bold;">if</span> options[<span style="font-weight: bold; text-decoration: underline;">:video</span>]
        mkisofs_opts &lt;&lt; <span style="font-style: italic;">'-dvd-video'</span>
      <span style="font-weight: bold;">else</span> <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Data-DVD</span>
        mkisofs_opts &lt;&lt; [<span style="font-style: italic;">'-r'</span>, <span style="font-style: italic;">'-l'</span>, <span style="font-style: italic;">'-R'</span>]
      <span style="font-weight: bold;">end</span>
      mkisofs_opts &lt;&lt; file
      cmd_opts &lt;&lt; mkisofs_opts
    <span style="font-weight: bold;">end</span>

    commander.execute(cmd_opts.join(<span style="font-style: italic;">' '</span>))
  <span style="font-weight: bold;">end</span>

  desc <span style="font-style: italic;">"cdburn"</span>, <span style="font-style: italic;">"burn files to CD device"</span>
  option <span style="font-weight: bold; text-decoration: underline;">:in</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"i"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>, <span style="font-weight: bold; text-decoration: underline;">:required</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">true</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">"Root Directory for image file"</span>
  option <span style="font-weight: bold; text-decoration: underline;">:volume</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"v"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>, <span style="font-weight: bold; text-decoration: underline;">:required</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">true</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">"Volume ID"</span>
  option <span style="font-weight: bold; text-decoration: underline;">:device</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"d"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">"Device file"</span>, <span style="font-weight: bold; text-decoration: underline;">:default</span> =&gt; <span style="font-style: italic;">"/dev/sr0"</span>
  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">cdburn</span>()
    commander = <span style="font-weight: bold; text-decoration: underline;">Commander</span>.new(options[<span style="font-weight: bold; text-decoration: underline;">:log</span>], options[<span style="font-weight: bold; text-decoration: underline;">:dryrun</span>])

    commander.execute(<span style="font-style: italic;">"mkisofs -V \"</span><span style="font-weight: bold; font-style: italic;">#{options[:volume]}</span><span style="font-style: italic;">\" -J -r </span><span style="font-weight: bold; font-style: italic;">#{options[:in]}</span><span style="font-style: italic;"> | cdrecord -v dev=</span><span style="font-weight: bold; font-style: italic;">#{options[:device]}</span><span style="font-style: italic;"> -waiti -"</span>)
  <span style="font-weight: bold;">end</span>

  desc <span style="font-style: italic;">"screenshot"</span>, <span style="font-style: italic;">"take a screenshot of a video at a time"</span>
  option <span style="font-weight: bold; text-decoration: underline;">:in</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"i"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>, <span style="font-weight: bold; text-decoration: underline;">:required</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">true</span>
  option <span style="font-weight: bold; text-decoration: underline;">:out</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"o"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>
  option <span style="font-weight: bold; text-decoration: underline;">:time</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"t"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">"ex. 00:10:22.300"</span>
  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">screenshot</span>()
    equip = <span style="font-weight: bold; text-decoration: underline;">Names</span>.new(options[<span style="font-weight: bold; text-decoration: underline;">:in</span>], options[<span style="font-weight: bold; text-decoration: underline;">:out</span>])
    commander = <span style="font-weight: bold; text-decoration: underline;">Commander</span>.new(options[<span style="font-weight: bold; text-decoration: underline;">:log</span>], options[<span style="font-weight: bold; text-decoration: underline;">:dryrun</span>])
    <span style="font-weight: bold;">if</span> <span style="font-weight: bold; text-decoration: underline;">FileType</span>.video?(equip.in_file) <span style="font-weight: bold;">then</span>
      args = [<span style="font-style: italic;">'ffmpeg'</span>]
      args &lt;&lt; (<span style="font-style: italic;">'-ss %s'</span> % options[<span style="font-weight: bold; text-decoration: underline;">:time</span>]) <span style="font-weight: bold;">if</span> options[<span style="font-weight: bold; text-decoration: underline;">:time</span>]
      args &lt;&lt; <span style="font-style: italic;">'-i %s'</span> % equip.in_file
      args &lt;&lt; <span style="font-style: italic;">'-vframes 1'</span>
      args &lt;&lt; <span style="font-style: italic;">'-q:v 2'</span>
      args &lt;&lt; equip.out_file(<span style="font-style: italic;">'.jpg'</span>)
      commander.execute(args.join(<span style="font-style: italic;">' '</span>))
    <span style="font-weight: bold;">end</span>
  <span style="font-weight: bold;">end</span>

  desc <span style="font-style: italic;">"clip"</span>, <span style="font-style: italic;">"clip a video with specific time span"</span>
  option <span style="font-weight: bold; text-decoration: underline;">:in</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"i"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>, <span style="font-weight: bold; text-decoration: underline;">:required</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">true</span>
  option <span style="font-weight: bold; text-decoration: underline;">:out</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"o"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>
  option <span style="font-weight: bold; text-decoration: underline;">:time_begin</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"b"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">"ex. 00:10:22.300"</span>
  option <span style="font-weight: bold; text-decoration: underline;">:time_end</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"e"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>
  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">clip</span>()
    equip = <span style="font-weight: bold; text-decoration: underline;">Names</span>.new(options[<span style="font-weight: bold; text-decoration: underline;">:in</span>], options[<span style="font-weight: bold; text-decoration: underline;">:out</span>])
    commander = <span style="font-weight: bold; text-decoration: underline;">Commander</span>.new(options[<span style="font-weight: bold; text-decoration: underline;">:log</span>], options[<span style="font-weight: bold; text-decoration: underline;">:dryrun</span>])

    <span style="font-weight: bold;">if</span> <span style="font-weight: bold; text-decoration: underline;">FileType</span>.video?(equip.in_file) <span style="font-weight: bold;">then</span>
      <span style="font-weight: bold;">if</span> options[<span style="font-weight: bold; text-decoration: underline;">:time_begin</span>] <span style="font-weight: bold;">or</span> options[<span style="font-weight: bold; text-decoration: underline;">:time_end</span>] <span style="font-weight: bold;">then</span>
        in_opts = []
        in_opts &lt;&lt; <span style="font-style: italic;">"-ss </span><span style="font-weight: bold; font-style: italic;">#{options[:time_begin]}</span><span style="font-style: italic;">"</span> <span style="font-weight: bold;">if</span> options[<span style="font-weight: bold; text-decoration: underline;">:time_begin</span>]
        in_opts &lt;&lt; <span style="font-style: italic;">"-to </span><span style="font-weight: bold; font-style: italic;">#{options[:time_end]}</span><span style="font-style: italic;">"</span> <span style="font-weight: bold;">if</span> options[<span style="font-weight: bold; text-decoration: underline;">:time_end</span>]
        out_opts = []
        out_opts &lt;&lt; <span style="font-style: italic;">"-vcodec copy"</span>
        out_opts &lt;&lt; <span style="font-style: italic;">"-acodec copy"</span>
        out_opts &lt;&lt; <span style="font-style: italic;">"-map_metadata 0"</span>
        commander.execute(<span style="font-weight: bold; text-decoration: underline;">FFMPEG</span>.command([<span style="font-weight: bold; text-decoration: underline;">FFMPEGOptSet</span>.new(equip.in_file, in_opts)],
                                         [<span style="font-weight: bold; text-decoration: underline;">FFMPEGOptSet</span>.new(equip.out_file, out_opts)]))
      <span style="font-weight: bold;">end</span>
    <span style="font-weight: bold;">else</span>
      <span style="font-weight: bold; text-decoration: underline;">STDERR</span>.puts <span style="font-style: italic;">"This Media Format is not supported on this function"</span>
      <span style="font-weight: bold;">exit</span> <span style="font-weight: bold; text-decoration: underline;">false</span>
    <span style="font-weight: bold;">end</span>
  <span style="font-weight: bold;">end</span>

  desc <span style="font-style: italic;">"crop"</span>, <span style="font-style: italic;">"extract a specific rectangle of a image/video"</span>
  option <span style="font-weight: bold; text-decoration: underline;">:in</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"i"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>, <span style="font-weight: bold; text-decoration: underline;">:required</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">true</span>
  option <span style="font-weight: bold; text-decoration: underline;">:out</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"o"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>
  option <span style="font-weight: bold; text-decoration: underline;">:width</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"w"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:numeric</span>, <span style="font-weight: bold; text-decoration: underline;">:required</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">true</span>
  option <span style="font-weight: bold; text-decoration: underline;">:height</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"h"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:numeric</span>, <span style="font-weight: bold; text-decoration: underline;">:required</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">true</span>
  option <span style="font-weight: bold; text-decoration: underline;">:xpos</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"x"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:numeric</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">"x coordinate of an original image where cropped image of top-left corner overlaps"</span>
  option <span style="font-weight: bold; text-decoration: underline;">:ypos</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"y"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:numeric</span>
  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">crop</span>()
    names = <span style="font-weight: bold; text-decoration: underline;">Names</span>.new(options[<span style="font-weight: bold; text-decoration: underline;">:in</span>], options[<span style="font-weight: bold; text-decoration: underline;">:out</span>])
    commander = <span style="font-weight: bold; text-decoration: underline;">Commander</span>.new(options[<span style="font-weight: bold; text-decoration: underline;">:log</span>], options[<span style="font-weight: bold; text-decoration: underline;">:dryrun</span>])

    width = options[<span style="font-weight: bold; text-decoration: underline;">:width</span>]
    height = options[<span style="font-weight: bold; text-decoration: underline;">:height</span>]
    xpos = options[<span style="font-weight: bold; text-decoration: underline;">:xpos</span>] ? options[<span style="font-weight: bold; text-decoration: underline;">:xpos</span>] : 0
    ypos = options[<span style="font-weight: bold; text-decoration: underline;">:ypos</span>] ? options[<span style="font-weight: bold; text-decoration: underline;">:ypos</span>] : 0
    <span style="font-weight: bold;">if</span> <span style="font-weight: bold; text-decoration: underline;">FileType</span>.image?(names.in_file) <span style="font-weight: bold;">then</span>
      opt = <span style="font-style: italic;">'-crop %dx%d+%dx%d'</span> % [width, height, xpos, ypos]
      commander.execute(<span style="font-style: italic;">"convert </span><span style="font-weight: bold; font-style: italic;">#{opt}</span><span style="font-style: italic;"> </span><span style="font-weight: bold; font-style: italic;">#{names.in_file}</span><span style="font-style: italic;"> </span><span style="font-weight: bold; font-style: italic;">#{names.out_file}</span><span style="font-style: italic;">"</span>)
    <span style="font-weight: bold;">elsif</span> <span style="font-weight: bold; text-decoration: underline;">FileType</span>.video?(names.in_file) <span style="font-weight: bold;">then</span>
      args = [<span style="font-style: italic;">'ffmpeg'</span>]
      args &lt;&lt; <span style="font-style: italic;">'-i %s'</span> % names.in_file
      args &lt;&lt; <span style="font-style: italic;">'-vf crop=%d:%d:%d:%d'</span> % [width, height, xpos, ypos]
      args &lt;&lt; <span style="font-style: italic;">"-map_metadata 0"</span>
      args &lt;&lt; names.out_file
      commander.execute(args.join(<span style="font-style: italic;">' '</span>))
    <span style="font-weight: bold;">else</span>
      <span style="font-weight: bold; text-decoration: underline;">STDERR</span>.puts <span style="font-style: italic;">"This Media Format is not supported on this function"</span>
      <span style="font-weight: bold;">exit</span> <span style="font-weight: bold; text-decoration: underline;">false</span>
    <span style="font-weight: bold;">end</span>
  <span style="font-weight: bold;">end</span>

  desc <span style="font-style: italic;">"trim"</span>, <span style="font-style: italic;">"trim a image/video with automated detection"</span>
  option <span style="font-weight: bold; text-decoration: underline;">:in</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"i"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>, <span style="font-weight: bold; text-decoration: underline;">:required</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">true</span>
  option <span style="font-weight: bold; text-decoration: underline;">:out</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"o"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>
  option <span style="font-weight: bold; text-decoration: underline;">:threshold</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"t"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">"threshold where trimming begin and end"</span>
  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">trim</span>()
    names = <span style="font-weight: bold; text-decoration: underline;">Names</span>.new(options[<span style="font-weight: bold; text-decoration: underline;">:in</span>], options[<span style="font-weight: bold; text-decoration: underline;">:out</span>])
    commander = <span style="font-weight: bold; text-decoration: underline;">Commander</span>.new(options[<span style="font-weight: bold; text-decoration: underline;">:log</span>], options[<span style="font-weight: bold; text-decoration: underline;">:dryrun</span>])

    <span style="font-weight: bold;">if</span> <span style="font-weight: bold; text-decoration: underline;">FileType</span>.image?(names.in_file) <span style="font-weight: bold;">then</span>
      commander.execute(<span style="font-style: italic;">"convert -trim </span><span style="font-weight: bold; font-style: italic;">#{names.in_file}</span><span style="font-style: italic;"> </span><span style="font-weight: bold; font-style: italic;">#{names.out_file}</span><span style="font-style: italic;">"</span>)
    <span style="font-weight: bold;">elsif</span> <span style="font-weight: bold; text-decoration: underline;">FileType</span>.audio?(names.in_file) <span style="font-weight: bold;">then</span>
      threshold = (options[<span style="font-weight: bold; text-decoration: underline;">:threshold</span>]) ? options[<span style="font-weight: bold; text-decoration: underline;">:threshold</span>] : <span style="font-style: italic;">"-40dB"</span>
      commander.execute(<span style="font-style: italic;">"ffmpeg -i </span><span style="font-weight: bold; font-style: italic;">#{names.in_file}</span><span style="font-style: italic;"> -af \"silenceremove=start_periods=1:start_duration=0:start_threshold=</span><span style="font-weight: bold; font-style: italic;">#{threshold}</span><span style="font-style: italic;">:detection=peak\" </span><span style="font-weight: bold; font-style: italic;">#{names.out_file}</span><span style="font-style: italic;">"</span>)
    <span style="font-weight: bold;">end</span>
  <span style="font-weight: bold;">end</span>

  desc <span style="font-style: italic;">"resize"</span>, <span style="font-style: italic;">"resize the image"</span>
  option <span style="font-weight: bold; text-decoration: underline;">:in</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"i"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>, <span style="font-weight: bold; text-decoration: underline;">:required</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">true</span>
  option <span style="font-weight: bold; text-decoration: underline;">:out</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"o"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>
  option <span style="font-weight: bold; text-decoration: underline;">:width</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"w"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:banner</span> =&gt; <span style="font-style: italic;">"e.g. 300"</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">"resized image width"</span>
  option <span style="font-weight: bold; text-decoration: underline;">:height</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"h"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:banner</span> =&gt; <span style="font-style: italic;">"e.g. 200"</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">"resized image height"</span>
  option <span style="font-weight: bold; text-decoration: underline;">:operation</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"p"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:banner</span> =&gt; <span style="font-style: italic;">"enlarge|shrink"</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">"permitted operation for resizing"</span>
  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">resize</span>()
    names = <span style="font-weight: bold; text-decoration: underline;">Names</span>.new(options[<span style="font-weight: bold; text-decoration: underline;">:in</span>], options[<span style="font-weight: bold; text-decoration: underline;">:out</span>])
    commander = <span style="font-weight: bold; text-decoration: underline;">Commander</span>.new(options[<span style="font-weight: bold; text-decoration: underline;">:log</span>], options[<span style="font-weight: bold; text-decoration: underline;">:dryrun</span>])

    <span style="font-weight: bold;">if</span> <span style="font-weight: bold; text-decoration: underline;">FileType</span>.video?(names.in_file) <span style="font-weight: bold;">then</span>
      <span style="font-weight: bold;">if</span> options[<span style="font-weight: bold; text-decoration: underline;">:width</span>] <span style="font-weight: bold;">and</span> options[<span style="font-weight: bold; text-decoration: underline;">:height</span>]
        out_opts = []
        out_opts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"-vf scale=%s:%s,setsar=1:1"</span>, options[<span style="font-weight: bold; text-decoration: underline;">:width</span>], options[<span style="font-weight: bold; text-decoration: underline;">:height</span>])
        commander.execute(<span style="font-weight: bold; text-decoration: underline;">FFMPEG</span>.command([<span style="font-weight: bold; text-decoration: underline;">FFMPEGOptSet</span>.new(names.in_file, [])],
                                         [<span style="font-weight: bold; text-decoration: underline;">FFMPEGOptSet</span>.new(names.out_file, out_opts)]))
      <span style="font-weight: bold;">end</span>
    <span style="font-weight: bold;">elsif</span> <span style="font-weight: bold; text-decoration: underline;">FileType</span>.image?(names.in_file) <span style="font-weight: bold;">then</span>
      <span style="font-weight: bold;">return</span> <span style="font-weight: bold;">if</span> options[<span style="font-weight: bold; text-decoration: underline;">:width</span>] == <span style="font-weight: bold; text-decoration: underline;">nil</span> &amp;&amp; options[<span style="font-weight: bold; text-decoration: underline;">:height</span>] == <span style="font-weight: bold; text-decoration: underline;">nil</span>
      <span style="font-weight: bold;">if</span> options[<span style="font-weight: bold; text-decoration: underline;">:operation</span>] == <span style="font-style: italic;">"enlarge"</span>
        op = <span style="font-style: italic;">"&lt;"</span>
      <span style="font-weight: bold;">elsif</span> options[<span style="font-weight: bold; text-decoration: underline;">:operation</span>] == <span style="font-style: italic;">"shrink"</span>
        op = <span style="font-style: italic;">"&gt;"</span>
      <span style="font-weight: bold;">else</span>
        op = <span style="font-style: italic;">""</span>
      <span style="font-weight: bold;">end</span>
      geometry = <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"%sx%s%s"</span>, options[<span style="font-weight: bold; text-decoration: underline;">:width</span>], options[<span style="font-weight: bold; text-decoration: underline;">:height</span>], op)
      commander.execute(<span style="font-style: italic;">"convert -resize </span><span style="font-weight: bold; font-style: italic;">#{geometry}</span><span style="font-style: italic;"> </span><span style="font-weight: bold; font-style: italic;">#{names.in_file}</span><span style="font-style: italic;"> </span><span style="font-weight: bold; font-style: italic;">#{names.out_file}</span><span style="font-style: italic;">"</span>)
    <span style="font-weight: bold;">end</span>
  <span style="font-weight: bold;">end</span>

  desc <span style="font-style: italic;">"concat"</span>, <span style="font-style: italic;">"concat multiple files"</span>
  option <span style="font-weight: bold; text-decoration: underline;">:in</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"i"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:array</span>, <span style="font-weight: bold; text-decoration: underline;">:required</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">true</span>
  option <span style="font-weight: bold; text-decoration: underline;">:out</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"o"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>
  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">concat</span>()
    names = <span style="font-weight: bold; text-decoration: underline;">Names</span>.new(options[<span style="font-weight: bold; text-decoration: underline;">:in</span>][0], options[<span style="font-weight: bold; text-decoration: underline;">:out</span>])
    commander = <span style="font-weight: bold; text-decoration: underline;">Commander</span>.new(options[<span style="font-weight: bold; text-decoration: underline;">:log</span>], options[<span style="font-weight: bold; text-decoration: underline;">:dryrun</span>])

    srcs = options[<span style="font-weight: bold; text-decoration: underline;">:in</span>]
    output = names.out_file

    <span style="font-weight: bold;">if</span> srcs.all? { |src| <span style="font-weight: bold; text-decoration: underline;">FileType</span>.video?(src) }
      src_list = <span style="font-style: italic;">""</span>
      src_file = <span style="font-weight: bold; text-decoration: underline;">Tempfile</span>.open()
      chap_file = <span style="font-weight: bold; text-decoration: underline;">Tempfile</span>.open()
      chap_file.write(<span style="font-style: italic;">"### Create Chapterfile ###\n"</span>)
      files_to_remove = []
      time_accumulated = <span style="font-weight: bold; text-decoration: underline;">Time</span>.new(0)
      srcs.each_with_index <span style="font-weight: bold;">do</span> |src, index|
        valid_src =
          <span style="font-weight: bold;">if</span> src =~ <span style="font-style: italic;">/^\p{Ascii}+$/</span>
            src
          <span style="font-weight: bold;">else</span>
            <span style="font-weight: bold; text-decoration: underline;">Dir</span>::<span style="font-weight: bold; text-decoration: underline;">Tmpname</span>.create(<span style="font-style: italic;">'base'</span>) <span style="font-weight: bold;">do</span> |src_dup|
              <span style="font-weight: bold; text-decoration: underline;">FileUtils</span>.cp(src, src_dup)
              files_to_remove &lt;&lt; src_dup
              src_dup
            <span style="font-weight: bold;">end</span>
          <span style="font-weight: bold;">end</span>
        src_file.write(<span style="font-style: italic;">"file '</span><span style="font-weight: bold; font-style: italic;">#{File.expand_path(valid_src)}</span><span style="font-style: italic;">'\n"</span>)
        chap_file.write(<span style="font-style: italic;">"CHAPTER</span><span style="font-weight: bold; font-style: italic;">#{index + 1}</span><span style="font-style: italic;">=</span><span style="font-weight: bold; font-style: italic;">#{time_accumulated.strftime('%H:%M:%S.%L')}</span><span style="font-style: italic;">\n"</span>)
        chap_file.write(<span style="font-style: italic;">"CHAPTER</span><span style="font-weight: bold; font-style: italic;">#{index + 1}</span><span style="font-style: italic;">NAME=</span><span style="font-weight: bold; font-style: italic;">#{File.basename(src, File.extname(src))}</span><span style="font-style: italic;">\n"</span>)
        duration = <span style="font-style: italic;">`ffprobe -v error -show_entries format=duration -of default=noprint_wrappers=1:nokey=1 "</span><span style="font-weight: bold; font-style: italic;">#{src}</span><span style="font-style: italic;">"`</span>.strip().to_f()
        time_accumulated += duration
      <span style="font-weight: bold;">end</span>
      src_file.flush
      commander.execute(<span style="font-style: italic;">"ffmpeg -n -f concat -safe 0 -i </span><span style="font-weight: bold; font-style: italic;">#{src_file.path}</span><span style="font-style: italic;"> -c:v copy -c:a copy -c:s copy -map 0:v -map 0:a -map 0:s? </span><span style="font-weight: bold; font-style: italic;">#{output}</span><span style="font-style: italic;">"</span>)
      src_file.close
      chap_file.flush
      commander.execute(<span style="font-style: italic;">"MP4Box -chap </span><span style="font-weight: bold; font-style: italic;">#{chap_file.path}</span><span style="font-style: italic;"> </span><span style="font-weight: bold; font-style: italic;">#{output}</span><span style="font-style: italic;">"</span>)
      chap_file.close
      src_file.unlink
      chap_file.unlink
      <span style="font-weight: bold; text-decoration: underline;">FileUtils</span>.rm_f(files_to_remove)
    <span style="font-weight: bold;">elsif</span> srcs.all? { |src| <span style="font-weight: bold; text-decoration: underline;">FileType</span>.image?(src) }
      commander.execute <span style="font-style: italic;">"convert </span><span style="font-weight: bold; font-style: italic;">#{srcs.join(' ')}</span><span style="font-style: italic;"> </span><span style="font-weight: bold; font-style: italic;">#{output}</span><span style="font-style: italic;">"</span>
    <span style="font-weight: bold;">else</span>
      <span style="font-weight: bold; text-decoration: underline;">STDERR</span>.puts <span style="font-style: italic;">"This Media Format is not supported on this function"</span>
      <span style="font-weight: bold;">exit</span> <span style="font-weight: bold; text-decoration: underline;">false</span>
    <span style="font-weight: bold;">end</span>
  <span style="font-weight: bold;">end</span>

  desc <span style="font-style: italic;">"diff"</span>, <span style="font-style: italic;">"measure the difference by providing SSIM value"</span>
  option <span style="font-weight: bold; text-decoration: underline;">:out</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"o"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>
  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">diff</span>(file1, file2)
    commander = <span style="font-weight: bold; text-decoration: underline;">Commander</span>.new(options[<span style="font-weight: bold; text-decoration: underline;">:log</span>], options[<span style="font-weight: bold; text-decoration: underline;">:dryrun</span>])

    <span style="font-weight: bold;">if</span> ((<span style="font-weight: bold; text-decoration: underline;">FileType</span>.video?(file1) <span style="font-weight: bold;">and</span> <span style="font-weight: bold; text-decoration: underline;">FileType</span>.video?(file2)) <span style="font-weight: bold;">or</span>
        (<span style="font-weight: bold; text-decoration: underline;">FileType</span>.image?(file1) <span style="font-weight: bold;">and</span> <span style="font-weight: bold; text-decoration: underline;">FileType</span>.image?(file2))) <span style="font-weight: bold;">then</span>
      <span style="font-weight: bold;">if</span> options[<span style="font-weight: bold; text-decoration: underline;">:out</span>] <span style="font-weight: bold;">then</span>
        commander.execute(<span style="font-style: italic;">"ffmpeg -i </span><span style="font-weight: bold; font-style: italic;">#{file1}</span><span style="font-style: italic;"> -i </span><span style="font-weight: bold; font-style: italic;">#{file2}</span><span style="font-style: italic;"> -filter_complex ssim=</span><span style="font-weight: bold; font-style: italic;">#{options[:out]}</span><span style="font-style: italic;"> -an -f null -"</span>)
      <span style="font-weight: bold;">else</span>
        commander.execute(<span style="font-style: italic;">"ffmpeg -i </span><span style="font-weight: bold; font-style: italic;">#{file1}</span><span style="font-style: italic;"> -i </span><span style="font-weight: bold; font-style: italic;">#{file2}</span><span style="font-style: italic;"> -filter_complex ssim -an -f null -"</span>)
      <span style="font-weight: bold;">end</span>
    <span style="font-weight: bold;">end</span>
  <span style="font-weight: bold;">end</span>

  desc <span style="font-style: italic;">"mux"</span>, <span style="font-style: italic;">"mux to one file which has streams correspond with input files"</span>
  option <span style="font-weight: bold; text-decoration: underline;">:video</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"v"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>, <span style="font-weight: bold; text-decoration: underline;">:required</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">true</span>
  option <span style="font-weight: bold; text-decoration: underline;">:audio</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"a"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>, <span style="font-weight: bold; text-decoration: underline;">:required</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">true</span>
  option <span style="font-weight: bold; text-decoration: underline;">:audio_delay</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"d"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>
  option <span style="font-weight: bold; text-decoration: underline;">:out</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"o"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>
  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">mux</span>()
    names = <span style="font-weight: bold; text-decoration: underline;">Names</span>.new(options[<span style="font-weight: bold; text-decoration: underline;">:video</span>], options[<span style="font-weight: bold; text-decoration: underline;">:out</span>])
    commander = <span style="font-weight: bold; text-decoration: underline;">Commander</span>.new(options[<span style="font-weight: bold; text-decoration: underline;">:log</span>], options[<span style="font-weight: bold; text-decoration: underline;">:dryrun</span>])

    in_optsets = []
    in_optsets &lt;&lt; <span style="font-weight: bold; text-decoration: underline;">FFMPEGOptSet</span>.new(options[<span style="font-weight: bold; text-decoration: underline;">:video</span>], [])
    aconf = []
    aconf &lt;&lt; <span style="font-style: italic;">"-itsoffset </span><span style="font-weight: bold; font-style: italic;">#{options[:audio_delay]}</span><span style="font-style: italic;">"</span> <span style="font-weight: bold;">if</span> options[<span style="font-weight: bold; text-decoration: underline;">:audio_delay</span>]
    in_optsets &lt;&lt; <span style="font-weight: bold; text-decoration: underline;">FFMPEGOptSet</span>.new(options[<span style="font-weight: bold; text-decoration: underline;">:audio</span>], aconf)
    commander.execute(<span style="font-weight: bold; text-decoration: underline;">FFMPEG</span>.command(in_optsets,
                                     [<span style="font-weight: bold; text-decoration: underline;">FFMPEGOptSet</span>.new(names.out_file, [])]))
  <span style="font-weight: bold;">end</span>
<span style="font-weight: bold;">end</span>

<span style="font-weight: bold;">class</span> <span style="font-weight: bold; text-decoration: underline;">MainConfig</span>
  <span style="font-weight: bold;">attr_accessor</span> <span style="font-weight: bold; text-decoration: underline;">:start</span>, <span style="font-weight: bold; text-decoration: underline;">:end</span>
<span style="font-weight: bold;">end</span>

<span style="font-weight: bold;">class</span> <span style="font-weight: bold; text-decoration: underline;">VideoConfig</span>
  <span style="font-weight: bold;">attr_accessor</span> <span style="font-weight: bold; text-decoration: underline;">:encode</span>, <span style="font-weight: bold; text-decoration: underline;">:quality</span>, <span style="font-weight: bold; text-decoration: underline;">:bitrate</span>, <span style="font-weight: bold; text-decoration: underline;">:preset</span>, <span style="font-weight: bold; text-decoration: underline;">:tune</span>, <span style="font-weight: bold; text-decoration: underline;">:profile</span>, <span style="font-weight: bold; text-decoration: underline;">:level</span>

  <span style="font-weight: bold; text-decoration: underline;">DEFAULT_ENCODE</span> = <span style="font-style: italic;">'vp9'</span>
  <span style="font-weight: bold; text-decoration: underline;">DEFAULT_QUALITY</span> = <span style="font-style: italic;">'26'</span>
  <span style="font-weight: bold; text-decoration: underline;">DEFAULT_BITRATE</span> = <span style="font-style: italic;">'1000'</span>

  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">initialize</span>(encode, quality=<span style="font-weight: bold; text-decoration: underline;">nil</span>, bitrate=<span style="font-weight: bold; text-decoration: underline;">nil</span>)
    <span style="font-weight: bold; font-style: italic;">@encode</span> = encode
    <span style="font-weight: bold; font-style: italic;">@quality</span> = quality
    <span style="font-weight: bold; font-style: italic;">@bitrate</span> = bitrate

    <span style="font-weight: bold;">case</span> <span style="font-weight: bold; font-style: italic;">@encode</span>
    <span style="font-weight: bold;">when</span> <span style="font-style: italic;">"x265"</span>
      <span style="font-weight: bold; font-style: italic;">@preset</span> = <span style="font-style: italic;">"veryslow"</span>
      <span style="font-weight: bold; font-style: italic;">@tune</span> = <span style="font-style: italic;">"ssim"</span>
      <span style="font-weight: bold; font-style: italic;">@profile</span> = <span style="font-style: italic;">"main"</span>
      <span style="font-weight: bold; font-style: italic;">@level</span> = <span style="font-weight: bold; text-decoration: underline;">nil</span>
    <span style="font-weight: bold;">when</span> <span style="font-style: italic;">"x264"</span>
      <span style="font-weight: bold; font-style: italic;">@preset</span> = <span style="font-style: italic;">"veryslow"</span>
      <span style="font-weight: bold; font-style: italic;">@tune</span> = <span style="font-style: italic;">"film"</span>
      <span style="font-weight: bold; font-style: italic;">@profile</span> = <span style="font-style: italic;">"main"</span>
      <span style="font-weight: bold; font-style: italic;">@level</span> = <span style="font-style: italic;">"4.1"</span>
    <span style="font-weight: bold;">end</span>
  <span style="font-weight: bold;">end</span>
<span style="font-weight: bold;">end</span>

<span style="font-weight: bold;">class</span> <span style="font-weight: bold; text-decoration: underline;">PictureConfig</span>
  <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">conversion options</span>
  <span style="font-weight: bold;">attr_accessor</span> <span style="font-weight: bold; text-decoration: underline;">:vf_opts</span>, <span style="font-weight: bold; text-decoration: underline;">:fps</span>

  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">initialize</span>()
    <span style="font-weight: bold; font-style: italic;">@vf_opts</span> = []
    <span style="font-weight: bold; font-style: italic;">@vf_opts</span> &lt;&lt; <span style="font-style: italic;">"format=yuv420p"</span>
  <span style="font-weight: bold;">end</span>

  <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">down-size to fit to display (width:heigh) in keeping aspect ratio</span>
  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">fit_size</span>(display_size)
    <span style="font-weight: bold; font-style: italic;">@vf_opts</span> &lt;&lt; <span style="font-style: italic;">"scale=</span><span style="font-weight: bold; font-style: italic;">#{display_size}</span><span style="font-style: italic;">:force_original_aspect_ratio=decrease"</span>
    <span style="font-weight: bold; font-style: italic;">@vf_opts</span> &lt;&lt; <span style="font-style: italic;">"pad=((iw+1)/2)*2:((ih+1)/2)*2"</span> <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">avoid width/height to odd</span>
  <span style="font-weight: bold;">end</span>

  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">decrease_framerate</span>(fps)
    <span style="font-weight: bold; font-style: italic;">@fps</span> = fps
  <span style="font-weight: bold;">end</span>
<span style="font-weight: bold;">end</span>

<span style="font-weight: bold;">class</span> <span style="font-weight: bold; text-decoration: underline;">AudioConfig</span>
  <span style="font-weight: bold;">attr_accessor</span> <span style="font-weight: bold; text-decoration: underline;">:encode</span>, <span style="font-weight: bold; text-decoration: underline;">:quality</span>, <span style="font-weight: bold; text-decoration: underline;">:bitrate</span>

  <span style="font-weight: bold; text-decoration: underline;">DEFAULT_ENCODE</span> = <span style="font-style: italic;">'opus'</span>
  <span style="font-weight: bold; text-decoration: underline;">DEFAULT_QUALITY</span> = <span style="font-style: italic;">'100'</span>
  <span style="font-weight: bold; text-decoration: underline;">DEFAULT_BITRATE</span> = <span style="font-style: italic;">'128'</span>

  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">initialize</span>(encode, quality=<span style="font-weight: bold; text-decoration: underline;">nil</span>, bitrate=<span style="font-weight: bold; text-decoration: underline;">nil</span>)
    <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">@encode = (encode ? encode : DEFAULT_ENCODE)</span>
    <span style="font-weight: bold; font-style: italic;">@encode</span> = encode
    <span style="font-weight: bold; font-style: italic;">@quality</span> = quality
    <span style="font-weight: bold; font-style: italic;">@bitrate</span> = bitrate
  <span style="font-weight: bold;">end</span>

  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">quality</span>
    <span style="font-weight: bold;">case</span> <span style="font-weight: bold; font-style: italic;">@encode</span>
    <span style="font-weight: bold;">when</span> <span style="font-style: italic;">'opus'</span>
    <span style="font-weight: bold;">else</span>
      <span style="font-weight: bold; font-style: italic;">@quality</span>
    <span style="font-weight: bold;">end</span>
  <span style="font-weight: bold;">end</span>

  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">bitrate</span>
    <span style="font-weight: bold;">case</span> <span style="font-weight: bold; font-style: italic;">@encode</span>
    <span style="font-weight: bold;">when</span> <span style="font-style: italic;">'opus'</span>
      (<span style="font-weight: bold; font-style: italic;">@bitrate</span> ? <span style="font-weight: bold; font-style: italic;">@bitrate</span> : <span style="font-weight: bold; text-decoration: underline;">DEFAULT_BITRATE</span>)
    <span style="font-weight: bold;">else</span>
      <span style="font-weight: bold; font-style: italic;">@bitrate</span>
    <span style="font-weight: bold;">end</span>
  <span style="font-weight: bold;">end</span>
<span style="font-weight: bold;">end</span>

<span style="font-weight: bold;">class</span> <span style="font-weight: bold; text-decoration: underline;">DVDConfig</span>
  <span style="font-weight: bold;">attr_accessor</span> <span style="font-weight: bold; text-decoration: underline;">:title</span>, <span style="font-weight: bold; text-decoration: underline;">:chapters</span>, <span style="font-weight: bold; text-decoration: underline;">:audio</span>, <span style="font-weight: bold; text-decoration: underline;">:subtitle</span>, <span style="font-weight: bold; text-decoration: underline;">:options</span>
  <span style="font-weight: bold;">attr_accessor</span> <span style="font-weight: bold; text-decoration: underline;">:chapter_marker</span>

  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">initialize</span>
    <span style="font-weight: bold; font-style: italic;">@chapter_marker</span> = <span style="font-weight: bold; text-decoration: underline;">true</span>
  <span style="font-weight: bold;">end</span>
<span style="font-weight: bold;">end</span>

<span style="font-weight: bold;">class</span> <span style="font-weight: bold; text-decoration: underline;">ImageConfig</span>
  <span style="font-weight: bold;">attr_reader</span> <span style="font-weight: bold; text-decoration: underline;">:quality</span> <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">1~100</span>
<span style="font-weight: bold;">end</span>

<span style="font-weight: bold;">class</span> <span style="font-weight: bold; text-decoration: underline;">FFMPEGOptSet</span> &lt; <span style="font-weight: bold; text-decoration: underline;">Struct</span>.new(<span style="font-weight: bold; text-decoration: underline;">:fname</span>, <span style="font-weight: bold; text-decoration: underline;">:optset</span>)
<span style="font-weight: bold;">end</span>

<span style="font-weight: bold;">class</span> <span style="font-weight: bold; text-decoration: underline;">FFMPEG</span>
  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">self</span>.<span style="font-weight: bold;">command</span>(in_optsets, out_optsets)
    opts = [<span style="font-style: italic;">"ffmpeg"</span>]

    infilep = <span style="font-weight: bold;">proc</span> <span style="font-weight: bold;">do</span> |fname, optset|
      opt_arr = []
      optset.each <span style="font-weight: bold;">do</span> |opt|
        <span style="font-weight: bold;">if</span> opt.instance_of?(<span style="font-weight: bold; text-decoration: underline;">String</span>)
          opt_arr &lt;&lt; opt
        <span style="font-weight: bold;">end</span>
      <span style="font-weight: bold;">end</span>
      opt_arr &lt;&lt; [<span style="font-style: italic;">"-i"</span>, <span style="font-style: italic;">"\"</span><span style="font-weight: bold; font-style: italic;">#{fname}</span><span style="font-style: italic;">\""</span>]
      <span style="font-weight: bold;">next</span> opt_arr
    <span style="font-weight: bold;">end</span>
    in_optsets.each <span style="font-weight: bold;">do</span> |in_optset|
      opts &lt;&lt; infilep.call(in_optset.fname, in_optset.optset)
    <span style="font-weight: bold;">end</span>

    outfilep = <span style="font-weight: bold;">proc</span> <span style="font-weight: bold;">do</span> |fname, optset|
      oopts = []
      optset.each <span style="font-weight: bold;">do</span> |opt|
        <span style="font-weight: bold;">if</span> opt.instance_of?(<span style="font-weight: bold; text-decoration: underline;">VideoConfig</span>)
          <span style="font-weight: bold;">case</span> opt.encode
          <span style="font-weight: bold;">when</span> <span style="font-style: italic;">'av1'</span>
            oopts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"-c:v librav1e"</span>)
            <span style="font-weight: bold;">if</span> opt.bitrate
              oopts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"-b:v %sk"</span>, opt.bitrate)
            <span style="font-weight: bold;">end</span>
          <span style="font-weight: bold;">when</span> <span style="font-style: italic;">'vp9'</span>
            oopts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"-c:v libvpx-vp9"</span>)
            <span style="font-weight: bold;">if</span> opt.quality
              oopts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"-crf %s"</span>, opt.quality)
              oopts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"-b:v 0"</span>)
            <span style="font-weight: bold;">elsif</span> opt.bitrate
              oopts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"-b:v %s"</span>, opt.bitrate)
            <span style="font-weight: bold;">end</span>
          <span style="font-weight: bold;">when</span> <span style="font-style: italic;">'h265'</span>
            oopts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"-c:v libx265"</span>)
            oopts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"-crf %s"</span>, opt.quality)
            oopts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"-preset %s"</span>, opt.preset) <span style="font-weight: bold;">if</span> opt.preset
            oopts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"-tune %s"</span>, opt.tune) <span style="font-weight: bold;">if</span> opt.tune
            <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Currently, ffmpeg &#8203;does not support setting profiles on x265</span>
            oopts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"-profile:v %s"</span>, opt.profile) <span style="font-weight: bold;">if</span> opt.profile &amp;&amp; opt.encoder == <span style="font-style: italic;">'x264'</span>
            oopts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"-level %s"</span>, opt.level) <span style="font-weight: bold;">if</span> opt.level
          <span style="font-weight: bold;">else</span>
            oopts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"-c:v copy"</span>)
          <span style="font-weight: bold;">end</span>
        <span style="font-weight: bold;">elsif</span> opt.instance_of?(<span style="font-weight: bold; text-decoration: underline;">AudioConfig</span>)
          <span style="font-weight: bold;">case</span> opt.encode
          <span style="font-weight: bold;">when</span> <span style="font-style: italic;">'opus'</span>
            oopts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"-c:a lib%s"</span>, opt.encode)
            oopts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"-b:a %sk"</span>, opt.bitrate) <span style="font-weight: bold;">if</span> opt.bitrate
          <span style="font-weight: bold;">when</span> <span style="font-style: italic;">'aac'</span>
            oopts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"-c:a libfdk_aac"</span>)
            <span style="font-weight: bold;">if</span> opt.quality
              oopts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"-aq %s"</span>, opt.quality)
              oopts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"-b:a 0"</span>)
            <span style="font-weight: bold;">elsif</span> opt.bitrate
              oopts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"-b:a %s"</span>, opt.bitrate)
            <span style="font-weight: bold;">end</span>
          <span style="font-weight: bold;">else</span>
            oopts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"-c:a copy"</span>)
          <span style="font-weight: bold;">end</span>
        <span style="font-weight: bold;">elsif</span> opt.instance_of?(<span style="font-weight: bold; text-decoration: underline;">PictureConfig</span>)
          oopts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"-vf \"%s\""</span>, opt.vf_opts.join(<span style="font-style: italic;">","</span>)) <span style="font-weight: bold;">if</span> opt.vf_opts &amp;&amp; opt.vf_opts.any?
          oopts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"-r %s"</span>, opt.fps) <span style="font-weight: bold;">if</span> opt.fps
        <span style="font-weight: bold;">elsif</span> opt.instance_of?(<span style="font-weight: bold; text-decoration: underline;">String</span>)
          oopts &lt;&lt; opt
        <span style="font-weight: bold;">end</span>
      <span style="font-weight: bold;">end</span>
      oopts &lt;&lt; <span style="font-style: italic;">"\"</span><span style="font-weight: bold; font-style: italic;">#{fname}</span><span style="font-style: italic;">\""</span>
      <span style="font-weight: bold;">next</span> oopts
    <span style="font-weight: bold;">end</span>
    out_optsets.each <span style="font-weight: bold;">do</span> |out_optset|
      opts &lt;&lt; outfilep.call(out_optset.fname, out_optset.optset)
    <span style="font-weight: bold;">end</span>

    opts.join(<span style="font-style: italic;">" "</span>)
  <span style="font-weight: bold;">end</span>
<span style="font-weight: bold;">end</span>

<span style="font-weight: bold;">class</span> <span style="font-weight: bold; text-decoration: underline;">HandBrakeCLI</span>
  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">self</span>.<span style="font-weight: bold;">command</span>(input, output, configs, raw_option)
    cmd_opts = [<span style="font-style: italic;">"HandBrakeCLI"</span>]
    cmd_opts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"--input \"%s\""</span>, input)
    cmd_opts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"--output \"%s\""</span>, output)
    configs.each <span style="font-weight: bold;">do</span> |config|
      <span style="font-weight: bold;">if</span> config.instance_of?(<span style="font-weight: bold; text-decoration: underline;">VideoConfig</span>)
        <span style="font-weight: bold;">case</span> config.encode
        <span style="font-weight: bold;">when</span> <span style="font-style: italic;">'vp9'</span>
          cmd_opts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"--encoder VP9"</span>)
          <span style="font-weight: bold;">if</span> config.quality
            cmd_opts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"--quality %s"</span>, config.quality)
            cmd_opts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"--vb 0"</span>)
          <span style="font-weight: bold;">elsif</span> config.bitrate
            cmd_opts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"--vb %s"</span>, config.bitrate)
          <span style="font-weight: bold;">end</span>
          cmd_opts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"--encoder-preset veryslow"</span>)
        <span style="font-weight: bold;">when</span> <span style="font-style: italic;">'h265'</span> || <span style="font-style: italic;">'hevc'</span>
          cmd_opts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"--encoder x265"</span>)
          <span style="font-weight: bold;">if</span> config.quality
            cmd_opts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"--quality %s"</span>, config.quality)
            cmd_opts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"--vb 0"</span>)
          <span style="font-weight: bold;">elsif</span> config.bitrate
            cmd_opts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"--vb %s"</span>, config.bitrate)
          <span style="font-weight: bold;">end</span>
          cmd_opts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"--encoder-preset %s"</span>, config.preset) <span style="font-weight: bold;">if</span> config.preset
          cmd_opts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"--encoder-tune %s"</span>, config.tune) <span style="font-weight: bold;">if</span> config.tune
          cmd_opts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"--encoder-profile %s"</span>, config.profile) <span style="font-weight: bold;">if</span> config.profile
          cmd_opts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"--encoder-level %s"</span>, config.level) <span style="font-weight: bold;">if</span> config.level
        <span style="font-weight: bold;">else</span>
          cmd_opts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"--encoder %s"</span>, config.encode) <span style="font-weight: bold;">if</span> config.encode
          cmd_opts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"--quality %s"</span>, config.quality) <span style="font-weight: bold;">if</span> config.quality
          cmd_opts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"--vb %s"</span>, config.bitrate) <span style="font-weight: bold;">if</span> config.bitrate
        <span style="font-weight: bold;">end</span>
      <span style="font-weight: bold;">elsif</span> config.instance_of?(<span style="font-weight: bold; text-decoration: underline;">AudioConfig</span>)
        <span style="font-weight: bold;">case</span> config.encode
        <span style="font-weight: bold;">when</span> <span style="font-style: italic;">'opus'</span>
          cmd_opts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"--aencoder %s"</span>, config.encode)
          cmd_opts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"--aq %s"</span>, config.quality) <span style="font-weight: bold;">if</span> config.quality
          cmd_opts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"--ab %s"</span>, config.bitrate) <span style="font-weight: bold;">if</span> config.bitrate
        <span style="font-weight: bold;">when</span> <span style="font-style: italic;">'aac'</span>
          cmd_opts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"--aencoder ca_haac"</span>)
          <span style="font-weight: bold;">if</span> config.quality
            cmd_opts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"--aq %s"</span>, config.quality)
            cmd_opts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"--ab 0"</span>)
          <span style="font-weight: bold;">elsif</span> config.bitrate
            cmd_opts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"--ab %s"</span>, config.bitrate)
          <span style="font-weight: bold;">end</span>
        <span style="font-weight: bold;">else</span>
          cmd_opts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"--aencoder copy"</span>)
        <span style="font-weight: bold;">end</span>
      <span style="font-weight: bold;">elsif</span> config.instance_of?(<span style="font-weight: bold; text-decoration: underline;">DVDConfig</span>)
        cmd_opts &lt;&lt; (config.title ? <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"--title %s"</span>, config.title) : <span style="font-style: italic;">"--main-feature"</span>)
        cmd_opts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"--chapters %s"</span>, config.chapters) <span style="font-weight: bold;">if</span> config.chapters
        cmd_opts &lt;&lt; <span style="font-style: italic;">"--markers"</span> <span style="font-weight: bold;">if</span> config.chapter_marker
        cmd_opts &lt;&lt; (config.audio ? <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"--audio %s"</span>, config.audio) : <span style="font-style: italic;">"--all-audio"</span> )
        cmd_opts &lt;&lt; (config.subtitle ? <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"--subtitle %s"</span>, config.subtitle) : <span style="font-style: italic;">"--all-subtitles"</span> )
      <span style="font-weight: bold;">end</span>
    <span style="font-weight: bold;">end</span>

    cmd_opts &lt;&lt; raw_option <span style="font-weight: bold;">if</span> raw_option

    cmd_opts.join(<span style="font-style: italic;">" "</span>)
  <span style="font-weight: bold;">end</span>
<span style="font-weight: bold;">end</span>

<span style="font-weight: bold;">class</span> <span style="font-weight: bold; text-decoration: underline;">ImageMagick</span>
  <span style="font-weight: bold; text-decoration: underline;">COMMAND</span> = <span style="font-style: italic;">"convert %s %s %s %s "</span>

  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">self</span>.<span style="font-weight: bold;">command</span>(input, output, pconfig, raw_option=<span style="font-style: italic;">""</span>)
    input_opt = <span style="font-style: italic;">""</span>
    output_opt = <span style="font-style: italic;">""</span>
    <span style="font-weight: bold;">if</span> pconfig.instance_of?(<span style="font-weight: bold; text-decoration: underline;">ImageConfig</span>) <span style="font-weight: bold;">then</span>
      input_opt += <span style="font-style: italic;">"-quality %s"</span> % pconfig.quality <span style="font-weight: bold;">if</span> pconfig.quality
      s = <span style="font-weight: bold; text-decoration: underline;">COMMAND</span> % [input, input_opt, output, output_opt]
      s
    <span style="font-weight: bold;">end</span>
  <span style="font-weight: bold;">end</span>
<span style="font-weight: bold;">end</span>

<span style="font-weight: bold; text-decoration: underline;">MediaUtil</span>.start(<span style="font-weight: bold; text-decoration: underline;">ARGV</span>)
</pre>
</div>
</div>
</div>
<div id="outline-container-orge73e1f5" class="outline-3">
<h3 id="orge73e1f5">genalbum</h3>
<div class="outline-text-3" id="text-orge73e1f5">
<p>
Personal script for encoding family pictures and movies.
</p>

<div class="org-src-container">
<pre class="src src-ruby"><span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">!/usr/bin/env ruby</span>

<span style="font-weight: bold;">require</span> <span style="font-style: italic;">'fileutils'</span>
<span style="font-weight: bold;">require</span> <span style="font-style: italic;">'time'</span>
<span style="font-weight: bold;">require</span> <span style="font-style: italic;">'exifr'</span>
<span style="font-weight: bold;">require</span> <span style="font-style: italic;">'streamio-ffmpeg'</span>
<span style="font-weight: bold;">require</span> <span style="font-style: italic;">'pathname'</span>
<span style="font-weight: bold;">require</span> <span style="font-style: italic;">'thor'</span>

<span style="font-weight: bold; text-decoration: underline;">PICTURE_FILE_EXTS</span> = [<span style="font-style: italic;">".jpg"</span>]
<span style="font-weight: bold; text-decoration: underline;">MOVIE_FILE_EXTS</span> = [<span style="font-style: italic;">".mp4"</span>]
<span style="font-weight: bold; text-decoration: underline;">ALBUM_DIR_NAME</span> = <span style="font-style: italic;">"album/"</span>
<span style="font-weight: bold; text-decoration: underline;">RENAME_DIR_NAME</span> = <span style="font-style: italic;">"rename/"</span>
<span style="font-weight: bold; text-decoration: underline;">WEB_DIR_NAME</span> = <span style="font-style: italic;">"album_web/"</span>
<span style="font-weight: bold; text-decoration: underline;">IMG_PREFIX</span> = <span style="font-style: italic;">"img_"</span>

<span style="font-weight: bold;">class</span> <span style="font-weight: bold; text-decoration: underline;">GenAlbum</span> &lt; <span style="font-weight: bold; text-decoration: underline;">Thor</span>
  default_command <span style="font-weight: bold; text-decoration: underline;">:album</span>
  desc <span style="font-style: italic;">"[album] -i &lt;img_dir&gt;"</span>, <span style="font-style: italic;">"generate album"</span>
  option <span style="font-weight: bold; text-decoration: underline;">:in</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"i"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>, <span style="font-weight: bold; text-decoration: underline;">:required</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">true</span>
  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">album</span>
    src_path = <span style="font-weight: bold; text-decoration: underline;">File</span>.expand_path(options[<span style="font-weight: bold; text-decoration: underline;">:in</span>], <span style="font-weight: bold; text-decoration: underline;">Dir</span>.pwd)
    dest_path = <span style="font-weight: bold; text-decoration: underline;">ALBUM_DIR_NAME</span>

    <span style="font-weight: bold; text-decoration: underline;">FileUtils</span>.mkdir_p(dest_path) <span style="font-weight: bold;">unless</span> <span style="font-weight: bold; text-decoration: underline;">FileTest</span>.exist?(dest_path)

    <span style="font-weight: bold; text-decoration: underline;">Dir</span>.glob(src_path + <span style="font-style: italic;">"/*"</span>).each <span style="font-weight: bold;">do</span> |img_file|
      basename = <span style="font-weight: bold; text-decoration: underline;">File</span>::basename(img_file)
      src_file = src_path + <span style="font-style: italic;">"/"</span> + basename
      dest_file = dest_path + <span style="font-style: italic;">"/"</span> + basename
      ext = <span style="font-weight: bold; text-decoration: underline;">File</span>.extname(img_file)
      <span style="font-weight: bold;">if</span> <span style="font-weight: bold; text-decoration: underline;">PICTURE_FILE_EXTS</span>.index(ext.downcase) != <span style="font-weight: bold; text-decoration: underline;">nil</span> <span style="font-weight: bold;">then</span>
        <span style="font-weight: bold;">system</span>(<span style="font-style: italic;">"convert -resize \"4096x&gt;\" -quality 92 </span><span style="font-weight: bold; font-style: italic;">#{src_file}</span><span style="font-style: italic;"> </span><span style="font-weight: bold; font-style: italic;">#{dest_file}</span><span style="font-style: italic;">"</span>)
      <span style="font-weight: bold;">elsif</span> <span style="font-weight: bold; text-decoration: underline;">MOVIE_FILE_EXTS</span>.index(ext.downcase) != <span style="font-weight: bold; text-decoration: underline;">nil</span> <span style="font-weight: bold;">then</span>
        <span style="font-weight: bold;">system</span>(<span style="font-style: italic;">"mediautil encode -i </span><span style="font-weight: bold; font-style: italic;">#{src_file}</span><span style="font-style: italic;"> -o </span><span style="font-weight: bold; font-style: italic;">#{dest_file}</span><span style="font-style: italic;"> -q 22.0 -Q 100.0"</span>)
      <span style="font-weight: bold;">end</span>
    <span style="font-weight: bold;">end</span>
  <span style="font-weight: bold;">end</span>

  desc <span style="font-style: italic;">"web -i &lt;img_dir&gt;"</span>, <span style="font-style: italic;">"generate lightweight album for web"</span>
  option <span style="font-weight: bold; text-decoration: underline;">:in</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"i"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>, <span style="font-weight: bold; text-decoration: underline;">:required</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">true</span>
  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">web</span>
    src_path = <span style="font-weight: bold; text-decoration: underline;">File</span>.expand_path(options[<span style="font-weight: bold; text-decoration: underline;">:in</span>], <span style="font-weight: bold; text-decoration: underline;">Dir</span>.pwd)
    dest_path = <span style="font-weight: bold; text-decoration: underline;">WEB_DIR_NAME</span>

    <span style="font-weight: bold; text-decoration: underline;">FileUtils</span>.mkdir_p(dest_path) <span style="font-weight: bold;">unless</span> <span style="font-weight: bold; text-decoration: underline;">FileTest</span>.exist?(dest_path)

    <span style="font-weight: bold; text-decoration: underline;">Dir</span>.glob(src_path + <span style="font-style: italic;">"/*"</span>).each <span style="font-weight: bold;">do</span> |img_file|
      basename = <span style="font-weight: bold; text-decoration: underline;">File</span>::basename(img_file)
      src_file = src_path + <span style="font-style: italic;">"/"</span> + basename
      dest_file = dest_path + <span style="font-style: italic;">"/"</span> + basename
      ext = <span style="font-weight: bold; text-decoration: underline;">File</span>.extname(img_file)
      <span style="font-weight: bold;">if</span> <span style="font-weight: bold; text-decoration: underline;">PICTURE_FILE_EXTS</span>.index(ext.downcase) != <span style="font-weight: bold; text-decoration: underline;">nil</span> <span style="font-weight: bold;">then</span>
        <span style="font-weight: bold;">system</span>(<span style="font-style: italic;">"convert -resize \"1024x&gt;\" -quality 80 </span><span style="font-weight: bold; font-style: italic;">#{src_file}</span><span style="font-style: italic;"> </span><span style="font-weight: bold; font-style: italic;">#{dest_file}</span><span style="font-style: italic;">"</span>)
      <span style="font-weight: bold;">elsif</span> <span style="font-weight: bold; text-decoration: underline;">MOVIE_FILE_EXTS</span>.index(ext.downcase) != <span style="font-weight: bold; text-decoration: underline;">nil</span> <span style="font-weight: bold;">then</span>
        <span style="font-weight: bold;">system</span>(<span style="font-style: italic;">"mediautil encode -i </span><span style="font-weight: bold; font-style: italic;">#{src_file}</span><span style="font-style: italic;"> -o </span><span style="font-weight: bold; font-style: italic;">#{dest_file}</span><span style="font-style: italic;"> -q 26.0 -Q 100.0"</span>)
      <span style="font-weight: bold;">end</span>
    <span style="font-weight: bold;">end</span>
  <span style="font-weight: bold;">end</span>

  desc <span style="font-style: italic;">"renmae -i &lt;img_dir&gt;"</span>, <span style="font-style: italic;">"rename image files in chlonological order"</span>
  option <span style="font-weight: bold; text-decoration: underline;">:in</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"i"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>, <span style="font-weight: bold; text-decoration: underline;">:required</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">true</span>
  option <span style="font-weight: bold; text-decoration: underline;">:out</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"o"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>
  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">rename</span>
    src_path = <span style="font-weight: bold; text-decoration: underline;">File</span>.expand_path(options[<span style="font-weight: bold; text-decoration: underline;">:in</span>], <span style="font-weight: bold; text-decoration: underline;">Dir</span>.pwd)
    dest_path = ((options[<span style="font-weight: bold; text-decoration: underline;">:out</span>]) ? options[<span style="font-weight: bold; text-decoration: underline;">:out</span>] : <span style="font-weight: bold; text-decoration: underline;">RENAME_DIR_NAME</span>)

    <span style="font-weight: bold; text-decoration: underline;">FileUtils</span>.mkdir_p(dest_path) <span style="font-weight: bold;">unless</span> <span style="font-weight: bold; text-decoration: underline;">FileTest</span>.exist?(dest_path)

    img_time = {}
    <span style="font-weight: bold; text-decoration: underline;">Dir</span>.glob(src_path + <span style="font-style: italic;">"/*"</span>).each <span style="font-weight: bold;">do</span> |img_file|
      ext = <span style="font-weight: bold; text-decoration: underline;">File</span>.extname(img_file)
      <span style="font-weight: bold;">if</span> <span style="font-weight: bold; text-decoration: underline;">PICTURE_FILE_EXTS</span>.index(ext.downcase) != <span style="font-weight: bold; text-decoration: underline;">nil</span> <span style="font-weight: bold;">then</span>
        pic = <span style="font-weight: bold; text-decoration: underline;">EXIFR</span>::<span style="font-weight: bold; text-decoration: underline;">JPEG</span>.new(img_file)
        <span style="font-weight: bold;">if</span> pic.exif? &amp;&amp; pic.date_time_original <span style="font-weight: bold;">then</span>
          img_time[img_file] = pic.date_time_original
        <span style="font-weight: bold;">else</span>
          img_time[img_file] = <span style="font-weight: bold; text-decoration: underline;">Time</span>.now
        <span style="font-weight: bold;">end</span>
      <span style="font-weight: bold;">elsif</span> <span style="font-weight: bold; text-decoration: underline;">MOVIE_FILE_EXTS</span>.index(ext.downcase) != <span style="font-weight: bold; text-decoration: underline;">nil</span> <span style="font-weight: bold;">then</span>
        movie = <span style="font-weight: bold; text-decoration: underline;">FFMPEG</span>::<span style="font-weight: bold; text-decoration: underline;">Movie</span>.new(img_file)
        time = movie.creation_time
        <span style="font-weight: bold;">if</span> time <span style="font-weight: bold;">then</span>
          img_time[img_file] = time
        <span style="font-weight: bold;">else</span>
          img_time[img_file] = <span style="font-weight: bold; text-decoration: underline;">Time</span>.now
        <span style="font-weight: bold;">end</span>
      <span style="font-weight: bold;">end</span>
    <span style="font-weight: bold;">end</span>
    img_time = img_time.sort_by{ |_, v| v }

    digit = img_time.length.to_s.length
    digit = 2 <span style="font-weight: bold;">if</span> digit &lt; 2
    img_time.each_with_index <span style="font-weight: bold;">do</span> |(img, time), i|
      ext = <span style="font-weight: bold; text-decoration: underline;">File</span>.extname(img).downcase
      base = <span style="font-weight: bold; text-decoration: underline;">IMG_PREFIX</span> + <span style="font-style: italic;">"%0</span><span style="font-weight: bold; font-style: italic;">#{digit}</span><span style="font-style: italic;">d"</span> % (i + 1) + ext
      src_file = img
      dest_file = dest_path + <span style="font-style: italic;">"/"</span> + base
      <span style="font-weight: bold;">system</span>(<span style="font-style: italic;">"cp </span><span style="font-weight: bold; font-style: italic;">#{src_file}</span><span style="font-style: italic;"> </span><span style="font-weight: bold; font-style: italic;">#{dest_file}</span><span style="font-style: italic;">"</span>)
    <span style="font-weight: bold;">end</span>
  <span style="font-weight: bold;">end</span>
<span style="font-weight: bold;">end</span>

<span style="font-weight: bold; text-decoration: underline;">GenAlbum</span>.start(<span style="font-weight: bold; text-decoration: underline;">ARGV</span>)
</pre>
</div>
</div>
</div>

<div id="outline-container-orga2d88d3" class="outline-3">
<h3 id="orga2d88d3">nhp&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span></h3>
</div>

<div id="outline-container-orgf413940" class="outline-3">
<h3 id="orgf413940">sendmail.py</h3>
<div class="outline-text-3" id="text-orgf413940">
<p>
Utility for sendind email programatically
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">!/usr/bin/env python3</span>

<span style="font-weight: bold;">import</span> sys
<span style="font-weight: bold;">import</span> argparse
<span style="font-weight: bold;">import</span> subprocess
<span style="font-weight: bold;">import</span> smtplib
<span style="font-weight: bold;">import</span> ssl
<span style="font-weight: bold;">from</span> email.mime.text <span style="font-weight: bold;">import</span> MIMEText
<span style="font-weight: bold;">from</span> email.utils <span style="font-weight: bold;">import</span> formatdate

<span style="font-weight: bold;">def</span> <span style="font-weight: bold;">sendmail</span>(mail_to, mail_from, subject, message):
    <span style="font-weight: bold; font-style: italic;">smtp_host</span> = <span style="font-style: italic;">'smtp.daisychain.jp'</span>
    <span style="font-weight: bold; font-style: italic;">smtp_port</span> = <span style="font-style: italic;">'465'</span>
    <span style="font-weight: bold; font-style: italic;">smtp_user</span> = <span style="font-style: italic;">'&lt;&lt;email()&gt;&gt;'</span>.split(sep=<span style="font-style: italic;">'@'</span>)[0]
    <span style="font-weight: bold; font-style: italic;">smtp_pass</span> = subprocess.run([<span style="font-style: italic;">"pass {}:{}/{} | head -1"</span>.<span style="font-weight: bold;">format</span>(smtp_host, smtp_port, smtp_user)], stdout=subprocess.PIPE, shell=<span style="font-weight: bold; text-decoration: underline;">True</span>).stdout.decode().strip()

    <span style="font-weight: bold; font-style: italic;">mime_msg</span> = MIMEText(message)
    <span style="font-weight: bold; font-style: italic;">mime_msg</span>[<span style="font-style: italic;">'Subject'</span>] = subject
    <span style="font-weight: bold; font-style: italic;">mime_msg</span>[<span style="font-style: italic;">'From'</span>] = mail_from
    <span style="font-weight: bold; font-style: italic;">mime_msg</span>[<span style="font-style: italic;">'To'</span>] = mail_to
    <span style="font-weight: bold; font-style: italic;">mime_msg</span>[<span style="font-style: italic;">"Date"</span>] = formatdate(<span style="font-weight: bold; text-decoration: underline;">None</span>, <span style="font-weight: bold; text-decoration: underline;">True</span>)

    <span style="font-weight: bold;">if</span> smtp_port == <span style="font-style: italic;">'465'</span>:
        <span style="font-weight: bold; font-style: italic;">context</span> = ssl.create_default_context()
        <span style="font-weight: bold; font-style: italic;">smtp</span> = smtplib.SMTP_SSL(smtp_host, smtp_port, context=context)

    <span style="font-weight: bold;">if</span> smtp <span style="font-weight: bold;">is</span> <span style="font-weight: bold;">not</span> <span style="font-weight: bold; text-decoration: underline;">None</span>:
        smtp.login(smtp_user, smtp_pass)
        smtp.sendmail(mail_from, mail_to, mime_msg.as_string())
        smtp.<span style="font-weight: bold; text-decoration: underline;">quit</span>()


<span style="font-weight: bold; font-style: italic;">DESC</span> = <span style="font-style: italic;">'sendmail.py sends mail'</span>
<span style="font-weight: bold; font-style: italic;">parser</span> = argparse.ArgumentParser(description=DESC)
parser.add_argument(<span style="font-style: italic;">'-s'</span>, <span style="font-style: italic;">'--subject'</span>)
parser.add_argument(<span style="font-style: italic;">'-f'</span>, <span style="font-style: italic;">'--mailfrom'</span>)
parser.add_argument(<span style="font-style: italic;">'to'</span>)
<span style="font-weight: bold; font-style: italic;">args</span> = parser.parse_args()

<span style="font-weight: bold; font-style: italic;">message</span> = sys.stdin.read()
sendmail(args.to, args.mailfrom, args.subject, message)
</pre>
</div>
</div>
</div>

<div id="outline-container-org8d7e750" class="outline-3">
<h3 id="org8d7e750">pwsudo</h3>
<div class="outline-text-3" id="text-org8d7e750">
<div class="org-src-container">
<pre class="src src-shell"><span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">!/usr/bin/</span><span style="font-weight: bold;">env</span><span style="font-weight: bold; font-style: italic;"> bash</span>

<span style="font-weight: bold; font-style: italic;">_userid</span>=$(whoami)
<span style="font-weight: bold; font-style: italic;">_hostname</span>=$(hostname)

<span style="font-weight: bold;">if</span> pass show <span style="font-style: italic;">"${_hostname}/${_userid}"</span> &gt;/dev/null 2&gt;&amp;1; <span style="font-weight: bold;">then</span>
  pass show <span style="font-style: italic;">"${_hostname}/${_userid}"</span> | head -1 | sudo -S $<span style="font-weight: bold; font-style: italic;">*</span>
<span style="font-weight: bold;">else</span>
  sudo $<span style="font-weight: bold; font-style: italic;">*</span>
<span style="font-weight: bold;">fi</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgba117d0" class="outline-3">
<h3 id="orgba117d0">gitsync</h3>
<div class="outline-text-3" id="text-orgba117d0">
<ul class="org-ul">
<li><p>
gitsync-local
</p>
<div class="org-src-container">
<pre class="src src-shell"><span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">!/usr/bin/</span><span style="font-weight: bold;">env</span><span style="font-weight: bold; font-style: italic;"> bash</span>

<span style="font-weight: bold;">function</span> <span style="font-weight: bold;">usage</span>() {
  cat &lt;&lt;_EOT_
<span style="font-weight: bold;">Usage:</span>
<span style="font-weight: bold;">  $0 &lt;prj_root&gt;</span>

<span style="font-weight: bold;">Description:</span>
<span style="font-weight: bold;">  $0 adds file changes in git projects under root_dir to the repository</span>

<span style="font-weight: bold;">Options:</span>
<span style="font-weight: bold;">  prj_root:  a root directory that has git projects as children</span>

<span style="font-weight: bold;">_EOT_</span>
  <span style="font-weight: bold;">exit</span> 1
}

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">parameter check</span>
<span style="font-weight: bold;">if</span> [ $<span style="font-weight: bold; font-style: italic;">#</span> -ne 1 ]; <span style="font-weight: bold;">then</span>
  usage
  <span style="font-weight: bold;">exit</span> 1
<span style="font-weight: bold;">fi</span>
<span style="font-weight: bold; font-style: italic;">root_dir</span>=$<span style="font-weight: bold; font-style: italic;">1</span>

<span style="font-weight: bold;">if</span> find ${<span style="font-weight: bold; font-style: italic;">root_dir</span>} -mindepth 1 -maxdepth 1 <span style="font-style: italic;">\(</span> -type l -o -type d <span style="font-style: italic;">\)</span> | {
    <span style="font-weight: bold;">while </span><span style="font-weight: bold;">read</span> repo
    <span style="font-weight: bold;">do</span>
      <span style="font-weight: bold;">cd</span> ${<span style="font-weight: bold; font-style: italic;">repo</span>} || <span style="font-weight: bold;">continue</span>

      <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">skip if this is not git repo</span>
      git rev-parse || <span style="font-weight: bold;">continue</span>

      <span style="font-weight: bold;">echo</span> <span style="font-style: italic;">"repository: ${repo}"</span>

      <span style="font-weight: bold;">cd</span> <span style="font-weight: bold;">`git rev-parse --show-toplevel`</span>
      <span style="font-weight: bold; font-style: italic;">sync_mode</span>=<span style="font-weight: bold;">`git config sync.mode`</span>
      <span style="font-weight: bold;">case</span> <span style="font-style: italic;">"${sync_mode}"</span><span style="font-weight: bold;"> in</span>
      <span style="font-style: italic;">"auto"</span> )
        <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Remove deleted files</span>
        git ls-files --deleted -z | xargs -0 git rm &gt;/dev/null 2&gt;&amp;1
        <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Add new files</span>
        git add . &gt;/dev/null 2&gt;&amp;1
        git commit -m <span style="font-style: italic;">"$(date)"</span>;;
      <span style="font-style: italic;">"manual"</span> )
        git add -u &gt;/dev/null 2&gt;&amp;1
        git commit -m <span style="font-style: italic;">"$(date)"</span>;;
      <span style="font-style: italic;">"none"</span> )
      ;;
      <span style="font-weight: bold;">esac</span>
    <span style="font-weight: bold;">done</span>
  }
<span style="font-weight: bold;">then</span>
  printf <span style="font-style: italic;">"\nAll done.\n"</span>
<span style="font-weight: bold;">else</span>
  printf <span style="font-style: italic;">"\nFix and redo.\n"</span>
<span style="font-weight: bold;">fi</span>
</pre>
</div></li>

<li><p>
gitsync-remote
</p>
<div class="org-src-container">
<pre class="src src-shell"><span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">!/usr/bin/</span><span style="font-weight: bold;">env</span><span style="font-weight: bold; font-style: italic;"> bash</span>

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Local bare repository name</span>
<span style="font-weight: bold; font-style: italic;">syncrepo</span>=origin

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Display repository name only once</span>
<span style="font-weight: bold;">log_repo</span>() {
  [ <span style="font-style: italic;">"x$lastrepo"</span> == <span style="font-style: italic;">"x$repo"</span> ] || {
    printf <span style="font-style: italic;">"\nREPO: ${repo}\n"</span>
    <span style="font-weight: bold; font-style: italic;">lastrepo</span>=<span style="font-style: italic;">"$repo"</span>
  }
}

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Log a message for a repository</span>
<span style="font-weight: bold;">log_msg</span>() {
  log_repo
  printf <span style="font-style: italic;">"  $1\n"</span>
}

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">fast-forward reference $1 to $syncrepo/$1</span>
<span style="font-weight: bold;">fast_forward_ref</span>() {
  log_msg <span style="font-style: italic;">"fast-forwarding ref $1"</span>
  <span style="font-weight: bold; font-style: italic;">current_ref</span>=$(cat .git/HEAD)
  <span style="font-weight: bold;">if</span> [ <span style="font-style: italic;">"x$current_ref"</span> = <span style="font-style: italic;">"xref: refs/heads/$1"</span> ]
  <span style="font-weight: bold;">then</span>
    <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Check for dirty index</span>
    <span style="font-weight: bold; font-style: italic;">files</span>=$(git diff-index --name-only HEAD --)
    git merge refs/remotes/$<span style="font-weight: bold; font-style: italic;">syncrepo</span>/$<span style="font-weight: bold; font-style: italic;">1</span>
  <span style="font-weight: bold;">else</span>
    git branch -f $<span style="font-weight: bold; font-style: italic;">1</span> refs/remotes/$<span style="font-weight: bold; font-style: italic;">syncrepo</span>/$<span style="font-weight: bold; font-style: italic;">1</span>
  <span style="font-weight: bold;">fi</span>
}

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Push reference $1 to $syncrepo</span>
<span style="font-weight: bold;">push_ref</span>() {
  log_msg <span style="font-style: italic;">"Pushing ref $1"</span>
  <span style="font-weight: bold;">if</span> ! git push --tags --quiet $<span style="font-weight: bold; font-style: italic;">syncrepo</span> $<span style="font-weight: bold; font-style: italic;">1</span>
  <span style="font-weight: bold;">then</span>
    <span style="font-weight: bold;">exit</span> 1
  <span style="font-weight: bold;">fi</span>
}

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Check if a ref can be moved</span>
<span style="font-weight: bold; font-style: italic;">#   </span><span style="font-weight: bold; font-style: italic;">- fast-forwards if behind the sync repo and is fast-forwardable</span>
<span style="font-weight: bold; font-style: italic;">#   </span><span style="font-weight: bold; font-style: italic;">- Does nothing if ref is up to date</span>
<span style="font-weight: bold; font-style: italic;">#   </span><span style="font-weight: bold; font-style: italic;">- Pushes ref to $syncrepo if ref is ahead of syncrepo and fastforwardable</span>
<span style="font-weight: bold; font-style: italic;">#   </span><span style="font-weight: bold; font-style: italic;">- Fails if ref and $syncrop/ref have diverged</span>
<span style="font-weight: bold;">check_ref</span>() {
  <span style="font-weight: bold; font-style: italic;">revlist1</span>=$(git rev-list refs/remotes/$<span style="font-weight: bold; font-style: italic;">syncrepo</span>/$<span style="font-weight: bold; font-style: italic;">1</span>..$<span style="font-weight: bold; font-style: italic;">1</span>)
  <span style="font-weight: bold; font-style: italic;">revlist2</span>=$(git rev-list $<span style="font-weight: bold; font-style: italic;">1</span>..refs/remotes/$<span style="font-weight: bold; font-style: italic;">syncrepo</span>/$<span style="font-weight: bold; font-style: italic;">1</span>)
  <span style="font-weight: bold;">if</span> [ <span style="font-style: italic;">"x$revlist1"</span> = <span style="font-style: italic;">"x"</span> -a <span style="font-style: italic;">"x$revlist2"</span> = <span style="font-style: italic;">"x"</span> ]
  <span style="font-weight: bold;">then</span>
    <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Ref $1 is up to date.</span>
    :
  <span style="font-weight: bold;">elif</span> [ <span style="font-style: italic;">"x$revlist1"</span> = <span style="font-style: italic;">"x"</span> ]
  <span style="font-weight: bold;">then</span>
    <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Ref $1 is behind $syncrepo/$1 and can be fast-forwarded.</span>
    fast_forward_ref $<span style="font-weight: bold; font-style: italic;">1</span> || <span style="font-weight: bold;">exit</span> 1
  <span style="font-weight: bold;">elif</span> [ <span style="font-style: italic;">"x$revlist2"</span> = <span style="font-style: italic;">"x"</span> ]
  <span style="font-weight: bold;">then</span>
    <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Ref $1 is ahead of $syncrepo/$1 and can be pushed.</span>
    push_ref $<span style="font-weight: bold; font-style: italic;">1</span> || <span style="font-weight: bold;">exit</span> 1
  <span style="font-weight: bold;">else</span>
    log_msg <span style="font-style: italic;">"Ref $1 and $syncrepo/$1 have diverged."</span>
    <span style="font-weight: bold;">exit</span> 1
  <span style="font-weight: bold;">fi</span>
}

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Check all local refs with matching refs in the $syncrepo</span>
<span style="font-weight: bold;">check_refs</span> () {
  git for-each-ref refs/heads/* | <span style="font-weight: bold;">while </span><span style="font-weight: bold;">read</span> sha1 commit ref
  <span style="font-weight: bold;">do</span>
    <span style="font-weight: bold; font-style: italic;">ref</span>=${<span style="font-weight: bold; font-style: italic;">ref</span>/refs<span style="font-style: italic;">\/</span>heads<span style="font-style: italic;">\/</span>/}
    git for-each-ref refs/remotes/$<span style="font-weight: bold; font-style: italic;">syncrepo</span>/$<span style="font-weight: bold; font-style: italic;">ref</span> | <span style="font-weight: bold;">while </span><span style="font-weight: bold;">read</span> sha2 commit ref2
    <span style="font-weight: bold;">do</span>
      <span style="font-weight: bold;">if</span> [ <span style="font-style: italic;">"x$sha1"</span> != <span style="font-style: italic;">"x"</span> -a <span style="font-style: italic;">"x$sha2"</span> != <span style="font-style: italic;">"x"</span> ]
      <span style="font-weight: bold;">then</span>
        check_ref $<span style="font-weight: bold; font-style: italic;">ref</span> || <span style="font-weight: bold;">exit</span> 1
      <span style="font-weight: bold;">fi</span>
    <span style="font-weight: bold;">done</span>
  <span style="font-weight: bold;">done</span>
}

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">parameter check</span>
<span style="font-weight: bold;">if</span> [ $<span style="font-weight: bold; font-style: italic;">#</span> -ne 1 ]; <span style="font-weight: bold;">then</span>
  usage
  <span style="font-weight: bold;">exit</span> 1
<span style="font-weight: bold;">fi</span>
<span style="font-weight: bold; font-style: italic;">root_dir</span>=$<span style="font-weight: bold; font-style: italic;">1</span>

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">For all repositories under $reporoot</span>
<span style="font-weight: bold; font-style: italic;">#   </span><span style="font-weight: bold; font-style: italic;">Check all refs matching $syncrepo and fast-forward, or push as necessary</span>
<span style="font-weight: bold; font-style: italic;">#   </span><span style="font-weight: bold; font-style: italic;">to synchronize the ref with $syncrepo</span>
<span style="font-weight: bold; font-style: italic;">#   </span><span style="font-weight: bold; font-style: italic;">Bail out if ref is not fastforwardable so user can fix and rerun</span>
<span style="font-weight: bold; font-style: italic;">retval</span>=0
<span style="font-weight: bold;">if</span> find ${<span style="font-weight: bold; font-style: italic;">root_dir</span>} -mindepth 1 -maxdepth 1 <span style="font-style: italic;">\(</span> -type l -o -type d <span style="font-style: italic;">\)</span> | {
    <span style="font-weight: bold;">while </span><span style="font-weight: bold;">read</span> repo
    <span style="font-weight: bold;">do</span>
      <span style="font-weight: bold;">cd</span> ${<span style="font-weight: bold; font-style: italic;">repo</span>}

      <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">continue if this is not git repo</span>
      git rev-parse 2&gt; /dev/null || <span style="font-weight: bold;">continue</span>

      <span style="font-weight: bold; font-style: italic;">upd</span>=$(git remote update $<span style="font-weight: bold; font-style: italic;">syncrepo</span> 2&gt;&amp;1 || <span style="font-weight: bold; font-style: italic;">retval</span>=1)
      [ <span style="font-style: italic;">"x$upd"</span> = <span style="font-style: italic;">"xFetching $syncrepo"</span> ] || {
        log_repo
        printf <span style="font-style: italic;">"$upd\n"</span>
      }
      check_refs || <span style="font-weight: bold; font-style: italic;">retval</span>=1
    <span style="font-weight: bold;">done</span>
    <span style="font-weight: bold;">exit</span> $<span style="font-weight: bold; font-style: italic;">retval</span>
  }
<span style="font-weight: bold;">then</span>
  printf <span style="font-style: italic;">"\nAll done.\n"</span>
<span style="font-weight: bold;">else</span>
  printf <span style="font-style: italic;">"\nFix and redo.\n"</span>
<span style="font-weight: bold;">fi</span>

<span style="font-weight: bold;">exit</span> $<span style="font-weight: bold; font-style: italic;">retval</span>
</pre>
</div></li>
</ul>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="creator"><a href="https://www.gnu.org/software/emacs/">Emacs</a> 26.3 (<a href="https://orgmode.org">Org</a> mode 9.1.9)</p>
<p class="validation"></p>
</div>
</body>
</html>
