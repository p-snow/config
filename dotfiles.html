<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>My Configuration Collection</title>
<meta name="generator" content="Org mode" />
<link rel="stylesheet" href="https://cdn.simplecss.org/simple.min.css" />
</head>
<body>
<div id="content">
<h1 class="title">My Configuration Collection</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org78e4630">Personal Information</a>
<ul>
<li><a href="#org7cfbbae">Local Directories</a></li>
<li><a href="#org0a3f108">Email</a></li>
</ul>
</li>
<li><a href="#org7c5a893">Distributions</a>
<ul>
<li><a href="#org4d2b83e">Ubuntu</a></li>
<li><a href="#org2495f81">Linux Mint (Cinnamon Desktop)</a></li>
<li><a href="#org6a4079e">GNU Guix</a>
<ul>
<li><a href="#orga67fac7">Channel definitions</a></li>
<li><a href="#org565cbf6">Manifests</a></li>
<li><a href="#orga304c97">Activating Profiles</a></li>
<li><a href="#org255cb75">Updating Channels</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org12abf2d">System Components</a>
<ul>
<li><a href="#org03314c9">Font</a>
<ul>
<li><a href="#orgc097a7b">Fontconfig</a></li>
<li><a href="#orga309d36">Font Viewer</a></li>
</ul>
</li>
<li><a href="#org7f9e5cd">Bash</a></li>
<li><a href="#org6a8f0bb">Systemd</a>
<ul>
<li><a href="#orgc30f7a2">systemd-tmpfiles</a></li>
</ul>
</li>
<li><a href="#orgd2c13b0">Vixie Cron</a></li>
<li><a href="#orgf46678b">Btrfs</a>
<ul>
<li><a href="#org6be7b23">btrbk</a></li>
<li><a href="#org6827486">snapshots management&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span></a></li>
<li><a href="#org6da2511">backup to another device&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span></a></li>
</ul>
</li>
<li><a href="#orgb1c2801">XDG</a>
<ul>
<li><a href="#orga1b01ab">xdg-mime</a></li>
</ul>
</li>
<li><a href="#org6234f5b">GnuPG (gpg)</a></li>
</ul>
</li>
<li><a href="#org284e99d">Application Configurations</a>
<ul>
<li><a href="#orge7afd68">GNU Emacs</a>
<ul>
<li><a href="#org4a69630">general configuration</a></li>
<li><a href="#org7e176fe">further customization</a></li>
</ul>
</li>
<li><a href="#orgd237347">Findutils</a></li>
<li><a href="#orgd3650e4">plocate</a></li>
<li><a href="#org7cad4d5">OpenSSH</a></li>
<li><a href="#orgf58cb46">Git</a>
<ul>
<li><a href="#org816d81a">git-annex</a></li>
</ul>
</li>
<li><a href="#org385f92a">ghq</a></li>
<li><a href="#org1c98128">Pass</a></li>
<li><a href="#orgc23a7ba">mpv</a></li>
<li><a href="#orgf2c5a2e">unison</a></li>
<li><a href="#orgf912610">Aspell</a></li>
<li><a href="#orgc787e56">textlint</a></li>
<li><a href="#orge5fb78e">xkeysnail</a></li>
<li><a href="#org949dd4a">SKK</a>
<ul>
<li><a href="#orgd99163b">derive unique entries in user-jisyo</a></li>
</ul>
</li>
<li><a href="#org8844e7e">Festival</a></li>
<li><a href="#orgac320d5">Open JTalk</a></li>
<li><a href="#org8637013">Jack</a></li>
<li><a href="#org3acfb56">XRandR</a></li>
<li><a href="#org3e6d30f">C/Migemo</a></li>
<li><a href="#org0af8d24">LilyPond</a></li>
<li><a href="#org545657a">Rsync</a>
<ul>
<li><a href="#org6b21b40">sync server data</a></li>
<li><a href="#org9ee7f74">backup script&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span></a></li>
</ul>
</li>
<li><a href="#orgd23c699">libvirt</a></li>
<li><a href="#org1f8e808">Calibre</a></li>
<li><a href="#org2b4cdaf">yt-dlp</a></li>
<li><a href="#orgbf4e530">rTorrent</a></li>
<li><a href="#org2a61565">Ledger</a></li>
<li><a href="#org36d9655">ripgrep-all</a></li>
</ul>
</li>
<li><a href="#orgfed704c">Development Infrastructures</a>
<ul>
<li><a href="#org78abf69">Python</a></li>
<li><a href="#org4717981">Ruby</a></li>
<li><a href="#org4a6571a">Node.js</a></li>
<li><a href="#org2e9268a">asdf-vm&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span></a></li>
<li><a href="#orgba43cc9">Tree Sitter</a></li>
<li><a href="#org4df0485">Language Servers</a>
<ul>
<li><a href="#org2c88a58">Bash Language Server</a></li>
<li><a href="#org4ab567e">Solargraph</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgc34a7b5">Utility Scripts</a>
<ul>
<li><a href="#org6453aa1">Declutters&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span></a></li>
<li><a href="#org7674404">Database back-up scripts</a></li>
<li><a href="#org4bfd4b2">filetype</a></li>
<li><a href="#orgba8fe58">mediautil</a></li>
<li><a href="#org5cacef4">genalbum</a></li>
<li><a href="#org0363143">nhp&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span></a></li>
<li><a href="#org9104e93">sendmail.py</a></li>
<li><a href="#orgea88b7b">pwsudo</a></li>
<li><a href="#orgd9af54f">gitsync&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span></a></li>
<li><a href="#org7373e98">filetype-cli&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span></a></li>
<li><a href="#org5285808">strip ruby</a></li>
</ul>
</li>
<li><a href="#org482700c">Workflows</a>
<ul>
<li><a href="#orgd3ab986">Transcode Video Files</a>
<ul>
<li><a href="#org9613f99">vp9 transcoding</a></li>
<li><a href="#org2ba8f20">av1 transcoding</a></li>
</ul>
</li>
<li><a href="#orgef17c4e">Transcode Audio Files</a></li>
<li><a href="#org5027d5b">DVD Packing</a></li>
<li><a href="#org072fa58">CD Ripping</a></li>
<li><a href="#org86e140e">Tutorial Video Creation</a></li>
<li><a href="#org6718a91">Sync Git Repos Automatically</a>
<ul>
<li><a href="#orgd10e329">git-sync</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-org78e4630" class="outline-2">
<h2 id="org78e4630">Personal Information</h2>
<div class="outline-text-2" id="text-org78e4630">
</div>
<div id="outline-container-org7cfbbae" class="outline-3">
<h3 id="org7cfbbae">Local Directories</h3>
<div class="outline-text-3" id="text-org7cfbbae">
<ul class="org-ul">
<li><p>
home directory
</p>
<div class="org-src-container">
<pre class="src src-shell" id="org5271cb6"><span style="font-weight: bold;">echo</span> <span style="font-style: italic;">"${HOME}"</span>
</pre>
</div></li>
<li><p>
share directory
</p>
<div class="org-src-container">
<pre class="src src-shell" id="org28fb654"><span style="font-weight: bold;">echo</span> <span style="font-style: italic;">"${HOME}/data/share"</span>
</pre>
</div></li>
<li><p>
video directory
</p>
<div class="org-src-container">
<pre class="src src-shell" id="org97ffd03"><span style="font-weight: bold;">echo</span> <span style="font-style: italic;">"${HOME}/data/videos"</span>
</pre>
</div></li>
<li><p>
audio directory
</p>
<div class="org-src-container">
<pre class="src src-shell" id="org15dfa3e"><span style="font-weight: bold;">echo</span> <span style="font-style: italic;">"${HOME}/data/audios"</span>
</pre>
</div></li>
</ul>
</div>
</div>
<div id="outline-container-org0a3f108" class="outline-3">
<h3 id="org0a3f108">Email</h3>
<div class="outline-text-3" id="text-org0a3f108">
<div class="org-src-container">
<pre class="src src-bash" id="org96341b7"><span style="font-weight: bold;">echo</span> -n <span style="font-style: italic;">"${EMAIL}"</span>
</pre>
</div>
<ul class="org-ul">
<li><p>
account name
</p>
<div class="org-src-container">
<pre class="src src-shell" id="orgeacdc5e"><span style="font-weight: bold;">echo</span> -n <span style="font-style: italic;">"${EMAIL}"</span> | cut -d<span style="font-style: italic;">'@'</span> -f1
</pre>
</div></li>
<li><p>
network name
</p>
<div class="org-src-container">
<pre class="src src-shell" id="org11feee1"><span style="font-weight: bold;">echo</span> -n <span style="font-style: italic;">"${EMAIL}"</span> | cut -d<span style="font-style: italic;">'@'</span> -f2
</pre>
</div></li>
</ul>
</div>
</div>
</div>
<div id="outline-container-org7c5a893" class="outline-2">
<h2 id="org7c5a893">Distributions</h2>
<div class="outline-text-2" id="text-org7c5a893">
</div>
<div id="outline-container-org4d2b83e" class="outline-3">
<h3 id="org4d2b83e">Ubuntu</h3>
<div class="outline-text-3" id="text-org4d2b83e">
<p>
initialization script for a ubuntu account
</p>

<div class="org-src-container">
<pre class="src src-shell">install-apt-packages
start-systemd-services

&lt;&lt;ubuntu-setup&gt;&gt;
</pre>
</div>

<div class="org-src-container">
<pre class="src src-shell">sudo apt-get install -y <span style="font-style: italic;">\</span>
     &lt;&lt;apt-pkgs&gt;&gt;
</pre>
</div>
</div>
</div>

<div id="outline-container-org2495f81" class="outline-3">
<h3 id="org2495f81"><a id="ID-f3cd9a3b-9ff5-4cc8-807e-846f3f04c97a"></a>Linux Mint (Cinnamon Desktop)</h3>
<div class="outline-text-3" id="text-org2495f81">
<p>
initialization script for a linuxmint account
</p>

<div class="org-src-container">
<pre class="src src-shell">initialize-ubuntu-desktop

&lt;&lt;linuxmint-setup&gt;&gt;
</pre>
</div>

<ul class="org-ul">
<li><p>
Back-up Cinnamon Desktop Configuration
</p>
<div class="org-src-container">
<pre class="src src-conf">30 1 */2 * * env bash -ci <span style="font-style: italic;">"dconf dump /org/cinnamon/ &gt; ~/.config/linuxmint/cinnamon.conf"</span>
</pre>
</div>

<p>
To thaw backed up config
</p>
<div class="org-src-container">
<pre class="src src-conf">dconf load /org/cinnamon/ &lt; &lt;&lt;home-dir()&gt;&gt;/.config/linuxmint/cinnamon.conf
</pre>
</div></li>
</ul>
</div>
</div>

<div id="outline-container-org6a4079e" class="outline-3">
<h3 id="org6a4079e">GNU Guix</h3>
<div class="outline-text-3" id="text-org6a4079e">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-style: italic;">"https://github.com/SystemCrafters/guix-installer/releases.atom"</span> soft_update)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-shell"><span style="font-weight: bold; font-style: italic;">GUIX_EXTRA_PROFILES</span>=$<span style="font-weight: bold; font-style: italic;">HOME</span>/.guix-extra-profiles

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">fill in a variable below like a comment line</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">if you'd like to acticate specific profiles under GUIX_EXTRA_PROFILES</span>
<span style="font-weight: bold; font-style: italic;">ACTIVE_PROFILE_NAMES</span>=()
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">ACTIVE_PROFILE_NAMES=(base emacs)</span>

<span style="font-weight: bold; font-style: italic;">profiles</span>=()
<span style="font-weight: bold;">if</span> [ ${#<span style="font-weight: bold; font-style: italic;">ACTIVE_PROFILE_NAMES</span>[@]} -eq 0 ]; <span style="font-weight: bold;">then</span>
  <span style="font-weight: bold; font-style: italic;">profiles</span>=<span style="font-style: italic;">"${GUIX_EXTRA_PROFILES}/*"</span>
<span style="font-weight: bold;">else</span>
  <span style="font-weight: bold;">for</span> name<span style="font-weight: bold;"> in</span> ${<span style="font-weight: bold; font-style: italic;">ACTIVE_PROFILE_NAMES</span>[@]}; <span style="font-weight: bold;">do</span>
    profiles+=(<span style="font-style: italic;">"${GUIX_EXTRA_PROFILES}/${name}"</span>)
  <span style="font-weight: bold;">done</span>
<span style="font-weight: bold;">fi</span>

<span style="font-weight: bold;">for</span> profile<span style="font-weight: bold;"> in</span> ${<span style="font-weight: bold; font-style: italic;">profiles</span>[@]}; <span style="font-weight: bold;">do</span>
  <span style="font-weight: bold; font-style: italic;">GUIX_PROFILE</span>=<span style="font-style: italic;">"${profile}/$(basename ${profile})"</span>
  <span style="font-weight: bold;">if</span> [ -f ${<span style="font-weight: bold; font-style: italic;">GUIX_PROFILE</span>}/etc/profile ]; <span style="font-weight: bold;">then</span>
    . <span style="font-style: italic;">"${GUIX_PROFILE}"</span>/etc/profile
  <span style="font-weight: bold;">fi</span>
<span style="font-weight: bold;">done</span>

<span style="font-weight: bold;">export</span> <span style="font-weight: bold; font-style: italic;">GUIX_PROFILE</span>=<span style="font-style: italic;">"$HOME/.guix-profile"</span>
. <span style="font-style: italic;">"$GUIX_PROFILE/etc/profile"</span>

<span style="font-weight: bold;">export</span> <span style="font-weight: bold; font-style: italic;">GUIX_PROFILE</span>=<span style="font-style: italic;">"$HOME/.config/guix/current"</span>
. <span style="font-style: italic;">"$GUIX_PROFILE/etc/profile"</span>

<span style="font-weight: bold;">export</span> <span style="font-weight: bold; font-style: italic;">GUIX_LOCPATH</span>=<span style="font-style: italic;">"$HOME/.guix-profile/lib/locale"</span>


<span style="font-weight: bold;">if</span> [ -n <span style="font-style: italic;">"$GUIX_ENVIRONMENT"</span> ]; <span style="font-weight: bold;">then</span>
    <span style="font-weight: bold;">if</span> [[ $<span style="font-weight: bold; font-style: italic;">PS1</span> =~ (.*)<span style="font-style: italic;">"\\$"</span> ]]; <span style="font-weight: bold;">then</span>
        <span style="font-weight: bold; font-style: italic;">PS1</span>=<span style="font-style: italic;">"${BASH_REMATCH[1]} [env]\\\$ "</span>
    <span style="font-weight: bold;">fi</span>
<span style="font-weight: bold;">fi</span>
</pre>
</div>
</div>

<div id="outline-container-orga67fac7" class="outline-4">
<h4 id="orga67fac7">Channel definitions</h4>
<div class="outline-text-4" id="text-orga67fac7">
<div class="org-src-container">
<pre class="src src-scheme">(list (channel
       (name 'nonguix)
       (url <span style="font-style: italic;">"https://gitlab.com/nonguix/nonguix"</span>))
      (channel
       (name 'guix)
       (url <span style="font-style: italic;">"https://git.savannah.gnu.org/git/guix.git"</span>)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org565cbf6" class="outline-4">
<h4 id="org565cbf6">Manifests</h4>
<div class="outline-text-4" id="text-org565cbf6">
<ul class="org-ul">
<li><p>
base
</p>
<div class="org-src-container">
<pre class="src src-scheme">(specifications-&gt;manifest
 '(<span style="font-style: italic;">"coreutils"</span>
   <span style="font-style: italic;">"busybox"</span>
   <span style="font-style: italic;">"diffutils"</span>
   <span style="font-style: italic;">"parallel"</span>
   <span style="font-style: italic;">"gawk"</span>
   <span style="font-style: italic;">"sed"</span>
   <span style="font-style: italic;">"tar"</span>
   <span style="font-style: italic;">"zip"</span>
   <span style="font-style: italic;">"unzip"</span>
   <span style="font-style: italic;">"zstd"</span>
   <span style="font-style: italic;">"shadow"</span>
   <span style="font-style: italic;">"sshfs"</span>
   <span style="font-style: italic;">"grep"</span>
   <span style="font-style: italic;">"ripgrep"</span>
   <span style="font-style: italic;">"less"</span>
   <span style="font-style: italic;">"gnupg"</span>
   <span style="font-style: italic;">"pwgen"</span>
   <span style="font-style: italic;">"file"</span>
   <span style="font-style: italic;">"nkf"</span>
   <span style="font-style: italic;">"lsof"</span>
   <span style="font-style: italic;">"tree"</span>
   <span style="font-style: italic;">"poppler"</span>
   <span style="font-style: italic;">"pass-git-helper"</span>
   <span style="font-style: italic;">"stow"</span>
   <span style="font-style: italic;">"pandoc"</span>
   <span style="font-style: italic;">"nss-certs"</span>
   <span style="font-style: italic;">"openssl"</span>
   <span style="font-style: italic;">"glibc"</span>
   <span style="font-style: italic;">"glibc-locales"</span>
   <span style="font-style: italic;">"procps"</span>
   <span style="font-style: italic;">"time"</span>
   <span style="font-style: italic;">"htop"</span>
   <span style="font-style: italic;">"net-tools"</span>
   <span style="font-style: italic;">"curl"</span>
   <span style="font-style: italic;">"wget"</span>
   <span style="font-style: italic;">"ghc-tldr"</span>
   <span style="font-style: italic;">"speedtest-cli"</span>
   <span style="font-style: italic;">"parted"</span>
   <span style="font-style: italic;">"fdisk"</span>
   <span style="font-style: italic;">"gptfdisk"</span>
   <span style="font-style: italic;">"smartmontools"</span>
   <span style="font-style: italic;">"ddrescue"</span>
   <span style="font-style: italic;">"sqlite"</span>
   <span style="font-style: italic;">"libarchive"</span>
   <span style="font-style: italic;">"ffmpeg"</span>
   <span style="font-style: italic;">"dav1d"</span>
   <span style="font-weight: bold; text-decoration: underline;">&lt;&lt;base-pkgs&gt;&gt;</span>))
</pre>
</div></li>
<li><p>
desktop
</p>
<div class="org-src-container">
<pre class="src src-scheme">(specifications-&gt;manifest
 '(<span style="font-style: italic;">"font-adobe-source-han-sans"</span>
   <span style="font-style: italic;">"imagemagick"</span>
   <span style="font-style: italic;">"pulseaudio"</span>
   <span style="font-style: italic;">"gparted"</span>
   <span style="font-style: italic;">"vlc"</span>
   <span style="font-style: italic;">"gcompris-qt"</span>
   <span style="font-style: italic;">"gnome-disk-utility"</span>
   <span style="font-weight: bold; text-decoration: underline;">&lt;&lt;desktop-pkgs&gt;&gt;</span>))
</pre>
</div></li>
<li><p>
creative
</p>
<div class="org-src-container">
<pre class="src src-scheme">(specifications-&gt;manifest
 '(<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">"krita"</span>
   <span style="font-weight: bold; text-decoration: underline;">&lt;&lt;creative-pkgs&gt;&gt;</span>))
</pre>
</div></li>
<li><p>
devel (software development)
</p>
<div class="org-src-container">
<pre class="src src-scheme">(specifications-&gt;manifest
 '(<span style="font-style: italic;">"binutils"</span>
   <span style="font-style: italic;">"make"</span>
   <span style="font-style: italic;">"llvm"</span>
   <span style="font-style: italic;">"cmake"</span>
   <span style="font-style: italic;">"libtool"</span>
   <span style="font-style: italic;">"texinfo"</span>
   <span style="font-style: italic;">"shellcheck"</span>
   <span style="font-style: italic;">"global"</span>
   <span style="font-style: italic;">"perl"</span>
   <span style="font-weight: bold; text-decoration: underline;">&lt;&lt;devel-pkgs&gt;&gt;</span>))
</pre>
</div></li>
<li><p>
emacs
</p>
<div class="org-src-container">
<pre class="src src-scheme">(specifications-&gt;manifest
 '(<span style="font-style: italic;">"isync"</span>
   <span style="font-weight: bold; text-decoration: underline;">&lt;&lt;emacs-pkgs&gt;&gt;</span>
   <span style="font-style: italic;">"stunnel"</span>
   <span style="font-style: italic;">"wordnet"</span>))
</pre>
</div></li>
<li><p>
wine
</p>
<div class="org-src-container">
<pre class="src src-scheme">(specifications-&gt;manifest
 '(<span style="font-style: italic;">"wine64"</span>
   <span style="font-style: italic;">"winetricks"</span>))
</pre>
</div></li>
</ul>
</div>
</div>
<div id="outline-container-orga304c97" class="outline-4">
<h4 id="orga304c97">Activating Profiles</h4>
<div class="outline-text-4" id="text-orga304c97">
<p>
This script accepts a space-separated list of manifest file names (without extension) under the <code>~/.config/guix/manifests</code> folder and then installs those profiles for the first time.  For example:
</p>

<pre class="example">
activate-profiles base emacs

</pre>

<div class="org-src-container">
<pre class="src src-sh"><span style="font-weight: bold; font-style: italic;">GREEN</span>=<span style="font-style: italic;">'\033[1;32m'</span>
<span style="font-weight: bold; font-style: italic;">RED</span>=<span style="font-style: italic;">'\033[1;30m'</span>
<span style="font-weight: bold; font-style: italic;">NC</span>=<span style="font-style: italic;">'\033[0m'</span>
<span style="font-weight: bold; font-style: italic;">GUIX_EXTRA_PROFILES</span>=$<span style="font-weight: bold; font-style: italic;">HOME</span>/.guix-extra-profiles

<span style="font-weight: bold; font-style: italic;">profiles</span>=$<span style="font-weight: bold; font-style: italic;">*</span>
<span style="font-weight: bold;">if</span> [ $<span style="font-weight: bold; font-style: italic;">#</span> -eq 0 ]; <span style="font-weight: bold;">then</span>
    <span style="font-weight: bold; font-style: italic;">profiles</span>=<span style="font-style: italic;">"$HOME/.config/guix/manifests/*.scm"</span>;
<span style="font-weight: bold;">fi</span>

<span style="font-weight: bold;">for</span> profile<span style="font-weight: bold;"> in</span> $<span style="font-weight: bold; font-style: italic;">profiles</span>; <span style="font-weight: bold;">do</span>
  <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Remove the path and file extension, if any</span>
  <span style="font-weight: bold; font-style: italic;">profileName</span>=$(basename $<span style="font-weight: bold; font-style: italic;">profile</span>)
  <span style="font-weight: bold; font-style: italic;">profileName</span>=<span style="font-style: italic;">"${profileName%.*}"</span>
  <span style="font-weight: bold; font-style: italic;">profilePath</span>=<span style="font-style: italic;">"$GUIX_EXTRA_PROFILES/$profileName"</span>
  <span style="font-weight: bold; font-style: italic;">manifestPath</span>=$<span style="font-weight: bold; font-style: italic;">HOME</span>/.config/guix/manifests/$<span style="font-weight: bold; font-style: italic;">profileName</span>.scm

  <span style="font-weight: bold;">if</span> [ -f $<span style="font-weight: bold; font-style: italic;">manifestPath</span> ]; <span style="font-weight: bold;">then</span>
    <span style="font-weight: bold;">echo</span>
    <span style="font-weight: bold;">echo</span> -e <span style="font-style: italic;">"${GREEN}Activating profile:"</span> $<span style="font-weight: bold; font-style: italic;">manifestPath</span> <span style="font-style: italic;">"${NC}"</span>
    <span style="font-weight: bold;">echo</span>

    mkdir -p $<span style="font-weight: bold; font-style: italic;">profilePath</span>
    guix package --manifest=$<span style="font-weight: bold; font-style: italic;">manifestPath</span> --profile=<span style="font-style: italic;">"$profilePath/$profileName"</span>

    <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Source the new profile</span>
    <span style="font-weight: bold; font-style: italic;">GUIX_PROFILE</span>=<span style="font-style: italic;">"$profilePath/$profileName"</span>
    <span style="font-weight: bold;">if</span> [ -f $<span style="font-weight: bold; font-style: italic;">GUIX_PROFILE</span>/etc/profile ]; <span style="font-weight: bold;">then</span>
        . <span style="font-style: italic;">"$GUIX_PROFILE"</span>/etc/profile
    <span style="font-weight: bold;">else</span>
        <span style="font-weight: bold;">echo</span> -e <span style="font-style: italic;">"${RED}Couldn't find profile:"</span> $<span style="font-weight: bold; font-style: italic;">GUIX_PROFILE</span>/etc/profile <span style="font-style: italic;">"${NC}"</span>
    <span style="font-weight: bold;">fi</span>
  <span style="font-weight: bold;">else</span>
    <span style="font-weight: bold;">echo</span> <span style="font-style: italic;">"No profile found at path"</span> $<span style="font-weight: bold; font-style: italic;">profilePath</span>
  <span style="font-weight: bold;">fi</span>
<span style="font-weight: bold;">done</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org255cb75" class="outline-4">
<h4 id="org255cb75">Updating Channels</h4>
<div class="outline-text-4" id="text-org255cb75">
<p>
This script makes it easy to update all channels to the latest commit based on an original channel file.
</p>

<pre class="example">
update-channels

</pre>

<p>
You can use ~/.config/guix/channels.scm to replicate exact packages on another machine with
</p>

<pre class="example">
guix pull -C ~/.config/guix/channels.scm

</pre>

<div class="org-src-container">
<pre class="src src-sh">guix pull --channels=$<span style="font-weight: bold; font-style: italic;">HOME</span>/.config/guix/base-channels.scm
guix describe --format=channels &gt; ~/.config/guix/channels.scm
</pre>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-org12abf2d" class="outline-2">
<h2 id="org12abf2d">System Components</h2>
<div class="outline-text-2" id="text-org12abf2d">
</div>
<div id="outline-container-org03314c9" class="outline-3">
<h3 id="org03314c9">Font</h3>
<div class="outline-text-3" id="text-org03314c9">
</div>

<div id="outline-container-orgc097a7b" class="outline-4">
<h4 id="orgc097a7b">Fontconfig</h4>
<div class="outline-text-4" id="text-orgc097a7b">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"fontconfig"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"font-ipa-ex"</span>
<span style="font-style: italic;">"font-google-noto"</span>
<span style="font-style: italic;">"font-inconsolata"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-shell">fonts-ipafont-mincho fonts-ipafont-gothic
</pre>
</div>

<div class="org-src-container">
<pre class="src src-xml"><span style="font-style: italic;">&lt;?</span><span style="font-weight: bold; font-style: italic;">xml</span><span style="font-style: italic;"> </span><span style="font-style: italic;">version='1.0'</span><span style="font-style: italic;">?&gt;</span>
<span style="font-style: italic;">&lt;!</span><span style="font-style: italic;">DOCTYPE fontconfig SYSTEM 'fonts.dtd'&gt;</span>
&lt;<span style="font-weight: bold;">fontconfig</span>&gt;
  &lt;<span style="font-weight: bold;">dir</span>&gt;&lt;&lt;<span style="font-weight: bold;">home-dir</span>()&gt;&gt;/.guix-extra-profiles/desktop/desktop/share/fonts&lt;/<span style="font-weight: bold;">dir</span>&gt;
&lt;/<span style="font-weight: bold;">fontconfig</span>&gt;
</pre>
</div>

<p>
install available fonts by rescanning font directories
</p>
<div class="org-src-container">
<pre class="src src-conf">fc-cache -rvf
</pre>
</div>
</div>
</div>

<div id="outline-container-orga309d36" class="outline-4">
<h4 id="orga309d36">Font Viewer</h4>
<div class="outline-text-4" id="text-orga309d36">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"gnome-font-viewer"</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org7f9e5cd" class="outline-3">
<h3 id="org7f9e5cd">Bash</h3>
<div class="outline-text-3" id="text-org7f9e5cd">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"bash"</span>
</pre>
</div>

<ul class="org-ul">
<li><p>
bash profile
</p>
<div class="org-src-container">
<pre class="src src-shell"><span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">!/usr/bin/</span><span style="font-weight: bold;">env</span><span style="font-weight: bold; font-style: italic;"> bash</span>

<span style="font-weight: bold;">if</span> [ -f ~/.bashrc ]; <span style="font-weight: bold;">then</span>
   source ~/.bashrc
<span style="font-weight: bold;">fi</span>
</pre>
</div></li>
<li><p>
bashrc
</p>
<div class="org-src-container">
<pre class="src src-shell"><span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">!/usr/bin/</span><span style="font-weight: bold;">env</span><span style="font-weight: bold; font-style: italic;"> bash</span>

<span style="font-weight: bold;">if</span> [ -f ~/.bashrc.secret ]; <span style="font-weight: bold;">then</span>
   source ~/.bashrc.secret
<span style="font-weight: bold;">fi</span>

<span style="font-weight: bold;">export</span> <span style="font-weight: bold; font-style: italic;">VIEWER</span>=less

<span style="font-weight: bold; font-style: italic;">USER_PATHS</span>=(
  <span style="font-style: italic;">"${HOME}/usr/bin"</span>
  <span style="font-style: italic;">"${HOME}/.local/bin"</span>
)
<span style="font-weight: bold;">for</span> path<span style="font-weight: bold;"> in</span> <span style="font-style: italic;">"${USER_PATHS[@]}"</span>; <span style="font-weight: bold;">do</span>
  <span style="font-weight: bold;">if</span> [ -d <span style="font-style: italic;">"${path}"</span> ]; <span style="font-weight: bold;">then</span>
    <span style="font-weight: bold;">export</span> <span style="font-weight: bold; font-style: italic;">PATH</span>=<span style="font-style: italic;">"${path}:$PATH"</span>
  <span style="font-weight: bold;">fi</span>
<span style="font-weight: bold;">done</span>

<span style="font-weight: bold;">if</span> [ -e $<span style="font-weight: bold; font-style: italic;">HOME</span>/.bash_aliases ]; <span style="font-weight: bold;">then</span>
  source $<span style="font-weight: bold; font-style: italic;">HOME</span>/.bash_aliases
<span style="font-weight: bold;">fi</span>
<span style="font-weight: bold;">if</span> [ -e $<span style="font-weight: bold; font-style: italic;">HOME</span>/.bash_functions ]; <span style="font-weight: bold;">then</span>
  source $<span style="font-weight: bold; font-style: italic;">HOME</span>/.bash_functions
<span style="font-weight: bold;">fi</span>

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">prompt</span>
<span style="font-weight: bold; font-style: italic;">MACHINE</span>=$(<span style="font-weight: bold;">echo</span> $(uname -n) | awk -F . <span style="font-style: italic;">'{print $1}'</span>)
<span style="font-weight: bold; font-style: italic;">PS1</span>=<span style="font-style: italic;">"[\u@${MACHINE}:\\W]\n\$ "</span>

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">function/variable used in libvterm/emacs</span>
<span style="font-weight: bold;">vterm_printf</span>(){
  <span style="font-weight: bold;">if</span> [ -n <span style="font-style: italic;">"$TMUX"</span> ]; <span style="font-weight: bold;">then</span>
    <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Tell tmux to pass the escape sequences through</span>
    <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">(Source: http://permalink.gmane.org/gmane.comp.terminal-emulators.tmux.user/1324)</span>
    printf <span style="font-style: italic;">"\ePtmux;\e\e]%s\007\e\\"</span> <span style="font-style: italic;">"$1"</span>
  <span style="font-weight: bold;">elif</span> [ <span style="font-style: italic;">"${TERM%%-*}"</span> = <span style="font-style: italic;">"screen"</span> ]; <span style="font-weight: bold;">then</span>
    <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">GNU screen (screen, screen-256color, screen-256color-bce)</span>
    printf <span style="font-style: italic;">"\eP\e]%s\007\e\\"</span> <span style="font-style: italic;">"$1"</span>
  <span style="font-weight: bold;">else</span>
    printf <span style="font-style: italic;">"\e]%s\e\\"</span> <span style="font-style: italic;">"$1"</span>
  <span style="font-weight: bold;">fi</span>
}

<span style="font-weight: bold;">vterm_prompt_end</span>(){
  vterm_printf <span style="font-style: italic;">"51;A$(whoami)@$(hostname):$(pwd)"</span>
}

<span style="font-weight: bold; font-style: italic;">PROMPT_COMMAND</span>=<span style="font-style: italic;">'echo -ne "\033]0;${HOSTNAME}:${PWD}\007"'</span>

<span style="font-weight: bold;">case</span> ${<span style="font-weight: bold; font-style: italic;">TERM</span>} <span style="font-weight: bold;">in</span>
dumb)
  ;;
xterm-256color)
  <span style="font-weight: bold;">export</span> <span style="font-weight: bold; font-style: italic;">LANG</span>=en_US.UTF-8
  <span style="font-weight: bold; font-style: italic;">PS1</span>=$<span style="font-weight: bold; font-style: italic;">PS1</span><span style="font-style: italic;">'\[$(vterm_prompt_end)\]'</span>
  ;;
*)
  <span style="font-weight: bold;">export</span> <span style="font-weight: bold; font-style: italic;">LANG</span>=ja_JP.UTF-8
  ;;
<span style="font-weight: bold;">esac</span>

<span style="font-weight: bold;">export</span> <span style="font-weight: bold; font-style: italic;">WINEARCH</span>=win64
<span style="font-weight: bold;">export</span> <span style="font-weight: bold; font-style: italic;">WINEPREFIX</span>=~/.wine

&lt;&lt;bashrc&gt;&gt;
</pre>
</div></li>
<li><p>
aliases
</p>
<div class="org-src-container">
<pre class="src src-shell">alias ..=<span style="font-style: italic;">"cd ../"</span>
alias <span style="font-weight: bold; font-style: italic;">l</span>=<span style="font-style: italic;">"ls -F"</span>
alias <span style="font-weight: bold; font-style: italic;">ll</span>=<span style="font-style: italic;">"l -lh"</span>
alias <span style="font-weight: bold; font-style: italic;">la</span>=<span style="font-style: italic;">"l -a"</span>
alias <span style="font-weight: bold; font-style: italic;">lal</span>=<span style="font-style: italic;">"l -alh"</span>
alias <span style="font-weight: bold; font-style: italic;">lld</span>=<span style="font-style: italic;">"l -ld"</span>
alias <span style="font-weight: bold; font-style: italic;">cp</span>=<span style="font-style: italic;">"cp -i"</span>
alias <span style="font-weight: bold; font-style: italic;">mv</span>=<span style="font-style: italic;">"mv -i"</span>
alias <span style="font-weight: bold; font-style: italic;">rm</span>=<span style="font-style: italic;">"rm -i"</span>
alias <span style="font-weight: bold; font-style: italic;">rmf</span>=<span style="font-style: italic;">"rm -rf"</span>
alias <span style="font-weight: bold; font-style: italic;">mkdir</span>=<span style="font-style: italic;">"mkdir -pv"</span>
alias <span style="font-weight: bold; font-style: italic;">rmdir</span>=<span style="font-style: italic;">"rmdir -v"</span>
alias <span style="font-weight: bold; font-style: italic;">ff</span>=<span style="font-style: italic;">'find . -type f -iname'</span>

alias <span style="font-weight: bold; font-style: italic;">cputemp</span>=<span style="font-style: italic;">'cat /sys/class/thermal/thermal_zone0/temp'</span>
alias <span style="font-weight: bold; font-style: italic;">ipaddr</span>=<span style="font-style: italic;">"hostname -I | cut -f1 -d' '"</span>
</pre>
</div></li>
<li><p>
functions
</p>
<div class="org-src-container">
<pre class="src src-shell"><span style="font-weight: bold;">function</span> <span style="font-weight: bold;">cl</span>() {
    <span style="font-weight: bold; font-style: italic;">DIR</span>=<span style="font-style: italic;">"$*"</span>;
        <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">if no DIR given, go home</span>
        <span style="font-weight: bold;">if</span> [ $<span style="font-weight: bold; font-style: italic;">#</span> -lt 1 ]; <span style="font-weight: bold;">then</span>
          <span style="font-weight: bold; font-style: italic;">DIR</span>=$<span style="font-weight: bold; font-style: italic;">HOME</span>;
    <span style="font-weight: bold;">fi</span>;

    builtin cd <span style="font-style: italic;">"${DIR}"</span> &amp;&amp; <span style="font-style: italic;">\</span>
      <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">use your preferred ls command</span>
      ls -F --color=auto
}

<span style="font-weight: bold;">function</span> <span style="font-weight: bold;">cpuinfo</span> {
  <span style="font-weight: bold; font-style: italic;">cores</span>=$(nproc)
  <span style="font-weight: bold; font-style: italic;">frequency</span>=$(grep MHz /proc/cpuinfo | head -1 | awk -F <span style="font-style: italic;">' '</span> <span style="font-style: italic;">'{print $4" MHz"}'</span>)
  <span style="font-weight: bold; font-style: italic;">model</span>=$(grep <span style="font-style: italic;">"model name"</span> /proc/cpuinfo | head -1 | sed -r <span style="font-style: italic;">'s/^.{13}//'</span>)
  <span style="font-weight: bold;">echo</span> <span style="font-style: italic;">"CPU Model: $model"</span>
  <span style="font-weight: bold;">echo</span> <span style="font-style: italic;">"CPU Cores: $cores"</span>
  <span style="font-weight: bold;">echo</span> <span style="font-style: italic;">"Frequency: $frequency"</span>
}

<span style="font-weight: bold;">function</span> <span style="font-weight: bold;">dual</span>() {
  <span style="font-weight: bold;">if</span> [ $<span style="font-weight: bold; font-style: italic;">#</span> -eq 0 ]; <span style="font-weight: bold;">then</span>
    <span style="font-weight: bold; font-style: italic;">du_arg</span>=<span style="font-style: italic;">"./* ./.[^.]*"</span>
  <span style="font-weight: bold;">else</span>
    <span style="font-weight: bold; font-style: italic;">du_arg</span>=<span style="font-style: italic;">""</span>
    <span style="font-weight: bold;">for</span> v<span style="font-weight: bold;"> in</span> <span style="font-style: italic;">"$@"</span>
    <span style="font-weight: bold;">do</span>
      <span style="font-weight: bold;">if</span> [ -f ${<span style="font-weight: bold; font-style: italic;">v</span>} ]; <span style="font-weight: bold;">then</span>
        <span style="font-weight: bold; font-style: italic;">du_arg</span>=<span style="font-style: italic;">"${du_arg} ${v}"</span>
      <span style="font-weight: bold;">elif</span> [ -d ${<span style="font-weight: bold; font-style: italic;">v</span>} ]; <span style="font-weight: bold;">then</span>
        <span style="font-weight: bold; font-style: italic;">du_arg</span>=<span style="font-style: italic;">"${du_arg} ${v}/* ${v}/.[^.]*"</span>
      <span style="font-weight: bold;">fi</span>
    <span style="font-weight: bold;">done</span>
  <span style="font-weight: bold;">fi</span>

  ionice -c2 -n7 nice -n19 du -scD ${<span style="font-weight: bold; font-style: italic;">du_arg</span>} 2&gt;/dev/null
}
<span style="font-weight: bold;">export</span> -f dual

<span style="font-weight: bold;">function</span> <span style="font-weight: bold;">mkcdir</span>() {
  mkdir -p -- <span style="font-style: italic;">"$1"</span> &amp;&amp; <span style="font-weight: bold;">cd</span> -P -- <span style="font-style: italic;">"$1"</span>
}

<span style="font-weight: bold;">function</span> <span style="font-weight: bold;">rms</span>() {
  <span style="font-weight: bold;">read</span> -p <span style="font-style: italic;">'shred all files - are you sure (y/n) ? '</span> ans
  <span style="font-weight: bold;">test</span> x$<span style="font-weight: bold; font-style: italic;">ans</span> == xy &amp;&amp; (
    <span style="font-weight: bold;">for</span> file<span style="font-weight: bold;"> in</span> <span style="font-style: italic;">"$@"</span>; <span style="font-weight: bold;">do</span>
      <span style="font-weight: bold;">if</span> [ -f <span style="font-style: italic;">"${file}"</span> ]; <span style="font-weight: bold;">then</span>
        shred -uzv <span style="font-style: italic;">"${file}"</span>
      <span style="font-weight: bold;">elif</span> [ -d <span style="font-style: italic;">"${file}"</span> ]; <span style="font-weight: bold;">then</span>
        find <span style="font-style: italic;">"${file}"</span> -type f -exec shred -uzv {} <span style="font-style: italic;">\;</span>
        rm -rf <span style="font-style: italic;">"${file}"</span>
      <span style="font-weight: bold;">fi</span>
    <span style="font-weight: bold;">done</span>
  )
}

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">A simple script to check on system resources</span>
<span style="font-weight: bold;">function</span> <span style="font-weight: bold;">chksys</span>() {
  clear

  <span style="font-weight: bold;">echo</span> <span style="font-style: italic;">"Memory Usage:"</span>
  /usr/bin/free -h

  <span style="font-weight: bold;">echo</span> $<span style="font-style: italic;">'\n'</span>$<span style="font-style: italic;">"Disk Usage:"</span>
  /bin/df -h /dev/sd[a-z][1-9] 2&gt;/dev/null

  <span style="font-weight: bold;">echo</span> $<span style="font-style: italic;">'\n'</span>$<span style="font-style: italic;">"Uptime:"</span>
  /usr/bin/uptime
}
</pre>
</div></li>
<li><p>
profile
</p>
<div class="org-src-container">
<pre class="src src-shell"><span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">~/.profile: executed by the command interpreter for login shells.</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">This file is not read by bash(1), if ~/.bash_profile or ~/.bash_login</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">exists.</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">see /usr/share/doc/bash/examples/startup-files for examples.</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">the files are located in the bash-doc package.</span>

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">the default umask is set in /etc/profile; for setting the umask</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">for ssh logins, install and configure the libpam-umask package.</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">umask 022</span>

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">if running bash</span>
<span style="font-weight: bold;">if</span> [ -n <span style="font-style: italic;">"$BASH_VERSION"</span> ]; <span style="font-weight: bold;">then</span>
    <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">include .bash_profile if it exists</span>
    <span style="font-weight: bold;">if</span> [ -f <span style="font-style: italic;">"$HOME/.bash_profile"</span> ]; <span style="font-weight: bold;">then</span>
        . <span style="font-style: italic;">"$HOME/.bash_profile"</span>
    <span style="font-weight: bold;">fi</span>
<span style="font-weight: bold;">fi</span>

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">set PATH so it includes user's private bin if it exists</span>
<span style="font-weight: bold;">if</span> [ -d <span style="font-style: italic;">"$HOME/bin"</span> ] ; <span style="font-weight: bold;">then</span>
    <span style="font-weight: bold; font-style: italic;">PATH</span>=<span style="font-style: italic;">"$HOME/bin:$PATH"</span>
<span style="font-weight: bold;">fi</span>

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">set PATH so it includes user's private bin if it exists</span>
<span style="font-weight: bold;">if</span> [ -d <span style="font-style: italic;">"$HOME/.local/bin"</span> ] ; <span style="font-weight: bold;">then</span>
    <span style="font-weight: bold; font-style: italic;">PATH</span>=<span style="font-style: italic;">"$HOME/.local/bin:$PATH"</span>
<span style="font-weight: bold;">fi</span>
</pre>
</div></li>
</ul>
</div>
</div>
<div id="outline-container-org6a8f0bb" class="outline-3">
<h3 id="org6a8f0bb">Systemd</h3>
<div class="outline-text-3" id="text-org6a8f0bb">
<div class="org-src-container">
<pre class="src src-shell">&lt;&lt;systemd-service&gt;&gt;
</pre>
</div>
</div>

<div id="outline-container-orgc30f7a2" class="outline-4">
<h4 id="orgc30f7a2">systemd-tmpfiles</h4>
<div class="outline-text-4" id="text-orgc30f7a2">
<p>
<a href="https://www.freedesktop.org/software/systemd/man/systemd-tmpfiles-setup.service.html">systemd-tmpfiles</a> manages file creation and deletion. In this section, all settings focus on user level file cleanup and deletion under /home directory.
</p>

<p>
You may need to enable systemd-tmpfiles service for user
</p>
<pre class="example">
$ cd /usr/lib/systemd/user
$ cp systemd-tmpfiles-* ~/.config/systemd/user/

</pre>
<div class="org-src-container">
<pre class="src src-conf">systemctl --user enable systemd-tmpfiles-setup.service systemd-tmpfiles-clean.timer
</pre>
</div>

<div class="org-src-container">
<pre class="src src-conf">D &lt;&lt;home-dir()&gt;&gt;/.local/share/Trash/files 0700 - - 1w
d &lt;&lt;home-dir()&gt;&gt;/tmp 0755 - - 5d
d &lt;&lt;home-dir()&gt;&gt;/Downloads 0755 - - 4w
&lt;&lt;tmpfiles-cleanup&gt;&gt;
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgd2c13b0" class="outline-3">
<h3 id="orgd2c13b0">Vixie Cron</h3>
<div class="outline-text-3" id="text-orgd2c13b0">
<div class="org-src-container">
<pre class="src src-conf">crontab -r
crontab &lt;&lt;home-dir()&gt;&gt;/.config/crontab/pc
</pre>
</div>

<div class="org-src-container">
<pre class="src src-conf"><span style="font-weight: bold; font-style: italic;">MAILTO</span>=<span style="font-style: italic;">"&lt;&lt;email()&gt;&gt;"</span>

<span style="font-weight: bold; font-style: italic;">BIN_DIR</span>=<span style="font-style: italic;">"&lt;&lt;home-dir()&gt;&gt;/bin"</span>
<span style="font-weight: bold; font-style: italic;">LOG_DIR</span>=<span style="font-style: italic;">"&lt;&lt;home-dir()&gt;&gt;/.local/state/log"</span>

&lt;&lt;cronjob-pc&gt;&gt;
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf46678b" class="outline-3">
<h3 id="orgf46678b">Btrfs</h3>
<div class="outline-text-3" id="text-orgf46678b">
<p>
Btrfs is a CoW (Copy on Write) file system supports snapshot and send/recv mechanism.
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"btrfs-progs"</span>
</pre>
</div>
</div>

<div id="outline-container-org6be7b23" class="outline-4">
<h4 id="org6be7b23">btrbk</h4>
<div class="outline-text-4" id="text-org6be7b23">
<p>
<a href="https://digint.ch/btrbk/doc/btrbk.1.html">Btrbk</a> supports for taking snapshots and backups
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"btrbk"</span>
</pre>
</div>
</div>

<ul class="org-ul">
<li><a id="org4c3cc78"></a>btrbk.conf<br />
<div class="outline-text-5" id="text-org4c3cc78">
<p>
<a href="https://digint.ch/btrbk/doc/btrbk.conf.5.html">btrbk.conf documentation</a>
</p>

<div class="org-src-container">
<pre class="src src-conf">snapshot_dir snapshots
timestamp_format long
incremental yes

volume /mnt/home
  subvolume incumbents/home
    snapshot_name home-local
    snapshot_preserve 36h 3d 2w
    snapshot_preserve_min 6h
  subvolume incumbents/home
    snapshot_name home-backup
    target send-receive /mnt/exbak/backups
    target_preserve 10w 6m 1y
    target_preserve_min latest
</pre>
</div>
</div>
</li>

<li><a id="orgeda2360"></a>snapshot/backup script<br />
<div class="outline-text-5" id="text-orgeda2360">
<ul class="org-ul">
<li><p>
snapshot
</p>
<div class="org-src-container">
<pre class="src src-conf">*/15 * * * * /bin/bash -ci <span style="font-style: italic;">"pwsudo btrbk --config ~/.config/btrbk/btrbk.conf --loglevel error snapshot *-local &gt;&gt; $LOG_DIR/snaphome.log 2&gt;&amp;1"</span>
</pre>
</div></li>

<li><p>
backup
</p>

<div class="org-src-container">
<pre class="src src-shell"><span style="font-weight: bold; font-style: italic;">BTRBK_CONF</span>=~/.config/btrbk/btrbk.conf

pwsudo btrbk --config <span style="font-style: italic;">"${BTRBK_CONF}"</span> --dry-run run *-backup <span style="font-style: italic;">\</span>
 &amp;&amp; pwsudo btrbk --config <span style="font-style: italic;">"${BTRBK_CONF}"</span> run *-backup
</pre>
</div>

<div class="org-src-container">
<pre class="src src-conf">30 * * * * /bin/bash -ci <span style="font-style: italic;">"bkhome &gt;&gt; $LOG_DIR/bkhome.log 2&gt;&amp;1"</span>
</pre>
</div></li>
</ul>
</div>
</li>
</ul>
</div>

<div id="outline-container-org6827486" class="outline-4">
<h4 id="org6827486">snapshots management&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span></h4>
</div>

<div id="outline-container-org6da2511" class="outline-4">
<h4 id="org6da2511">backup to another device&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span></h4>
</div>
</div>
<div id="outline-container-orgb1c2801" class="outline-3">
<h3 id="orgb1c2801">XDG</h3>
<div class="outline-text-3" id="text-orgb1c2801">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"xdg-utils"</span>
</pre>
</div>
</div>

<div id="outline-container-orga1b01ab" class="outline-4">
<h4 id="orga1b01ab">xdg-mime</h4>
<div class="outline-text-4" id="text-orga1b01ab">
<ul class="org-ul">
<li><p>
ask default application for text/plain
</p>
<pre class="example">
$ xdg-mime query default text/plain

</pre></li>
</ul>

<div class="org-src-container">
<pre class="src src-conf">[<span style="font-weight: bold; text-decoration: underline;">Added Associations</span>]
<span style="font-weight: bold; font-style: italic;">inode/directory</span>=io.github.celluloid_player.Celluloid.desktop;nemo.desktop;

[<span style="font-weight: bold; text-decoration: underline;">Default Applications</span>]
<span style="font-weight: bold; font-style: italic;">inode/directory</span>=nemo.desktop
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org6234f5b" class="outline-3">
<h3 id="org6234f5b">GnuPG (gpg)</h3>
<div class="outline-text-3" id="text-org6234f5b">
<p>
<a href="https://wiki.archlinux.org/title/GnuPG">
GnuPG - ArchWiki</a>
</p>

<ul class="org-ul">
<li><p>
gpg config
</p>
<div class="org-src-container">
<pre class="src src-conf">with-keygrip
</pre>
</div></li>
<li><p>
gpg-agent config
</p>
<div class="org-src-container">
<pre class="src src-conf"><span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">pinentry-program /usr/bin/pinentry-curses</span>
pinentry-program /usr/bin/pinentry
allow-emacs-pinentry
allow-loopback-pinentry
enable-ssh-support
<span style="font-weight: bold; font-style: italic;">max-cache-ttl &lt;&lt;hours-in-sec(h</span>=700)&gt;&gt;
<span style="font-weight: bold; font-style: italic;">default-cache-ttl &lt;&lt;hours-in-sec(h</span>=700)&gt;&gt;
<span style="font-weight: bold; font-style: italic;">default-cache-ttl-ssh &lt;&lt;hours-in-sec(h</span>=48)&gt;&gt;
</pre>
</div></li>
<li><p>
mandatory config to use pinentry-curses for gpg-agent
</p>

<div class="org-src-container">
<pre class="src src-shell"><span style="font-weight: bold;">export</span> <span style="font-weight: bold; font-style: italic;">GPG_TTY</span>=$(tty)

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Refresh gpg-agent tty in case user switches into an X session</span>
gpg-connect-agent updatestartuptty /bye &gt;/dev/null
</pre>
</div>

<div class="org-src-container">
<pre class="src src-conf">Match host * exec <span style="font-style: italic;">"gpg-connect-agent UPDATESTARTUPTTY /bye"</span>
</pre>
</div></li>
<li><p>
utility
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp" id="org0ececc2">(* h 60 60)
</pre>
</div></li>
</ul>
</div>
</div>
</div>

<div id="outline-container-org284e99d" class="outline-2">
<h2 id="org284e99d">Application Configurations</h2>
<div class="outline-text-2" id="text-org284e99d">
</div>

<div id="outline-container-orge7afd68" class="outline-3">
<h3 id="orge7afd68">GNU Emacs</h3>
<div class="outline-text-3" id="text-orge7afd68">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-shell"><span style="font-weight: bold;">export</span> <span style="font-weight: bold; font-style: italic;">EDITOR</span>=<span style="font-style: italic;">"emacsclient -c -a emacs"</span>
</pre>
</div>
</div>

<div id="outline-container-org4a69630" class="outline-4">
<h4 id="org4a69630">general configuration</h4>
<div class="outline-text-4" id="text-org4a69630">
</div>
<ul class="org-ul">
<li><a id="org3859a36"></a>early-init.el<br />
<div class="outline-text-5" id="text-org3859a36">
<p>
These process must be evaluated beforehand.
</p>
</div>

<ul class="org-ul">
<li><a id="orgd2ec705"></a>global variable definitions<br />
<div class="outline-text-6" id="text-orgd2ec705">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">setf</span> user-emacs-directory
      (expand-file-name <span style="font-style: italic;">"emacs"</span> <span style="font-style: italic;">"&lt;&lt;share-dir()&gt;&gt;"</span>))
(<span style="font-weight: bold;">setf</span> user-emacs-directory-default
      (expand-file-name (file-name-as-directory <span style="font-style: italic;">"~/.emacs.d"</span>)))

(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my/user-share-directory</span> <span style="font-style: italic;">"&lt;&lt;share-dir()&gt;&gt;"</span>)
</pre>
</div>
</div>
</li>
<li><a id="orgbfc69ab"></a>package.el<br />
<div class="outline-text-6" id="text-orgbfc69ab">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">package</span>)

(customize-set-variable
 'package-archives
 '((<span style="font-style: italic;">"gnu"</span> . <span style="font-style: italic;">"http://elpa.gnu.org/packages/"</span>)
   (<span style="font-style: italic;">"melpa"</span> . <span style="font-style: italic;">"http://melpa.org/packages/"</span>)))
(customize-set-variable 'package-enable-at-startup nil)
(customize-set-variable 'package-user-dir
                        (expand-file-name <span style="font-style: italic;">"elpa"</span> user-emacs-directory-default))

(package-initialize t)
</pre>
</div>
</div>
</li>

<li><a id="org5eabde0"></a>straight.el<br />
<div class="outline-text-6" id="text-org5eabde0">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-style: italic;">"https://github.com/raxod502/straight.el/releases.atom"</span> soft_update)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(customize-set-variable 'straight-recipes-gnu-elpa-use-mirror t)
(customize-set-variable 'straight-base-dir user-emacs-directory-default)
(customize-set-variable 'straight-vc-git-default-clone-depth 1)

(<span style="font-weight: bold;">let</span> ((bootstrap-file
       (expand-file-name <span style="font-style: italic;">"straight/repos/straight.el/bootstrap.el"</span> user-emacs-directory-default))
      (bootstrap-version 5))
  (<span style="font-weight: bold;">unless</span> (file-exists-p bootstrap-file)
    (<span style="font-weight: bold;">with-current-buffer</span>
        (url-retrieve-synchronously
         <span style="font-style: italic;">"https://raw.githubusercontent.com/raxod502/straight.el/develop/install.el"</span>
         'silent 'inhibit-cookies)
      (goto-char (point-max))
      (eval-print-last-sexp)))
  (load bootstrap-file nil 'nomessage))

(<span style="font-weight: bold;">with-eval-after-load</span> 'hydra
  (defhydra hydra-straight (global-map <span style="font-style: italic;">"C-x -"</span>
                                       <span style="font-weight: bold;">:color</span> blue)
    <span style="font-style: italic;">"Straight"</span>
    (<span style="font-style: italic;">"c"</span> straight-check-package)
    (<span style="font-style: italic;">"C"</span> straight-check-all)
    (<span style="font-style: italic;">"r"</span> straight-rebuild-package)
    (<span style="font-style: italic;">"R"</span> straight-rebuild-all)
    (<span style="font-style: italic;">"f"</span> straight-fetch-package)
    (<span style="font-style: italic;">"F"</span> straight-fetch-all)
    (<span style="font-style: italic;">"p"</span> straight-pull-package-and-deps)
    (<span style="font-style: italic;">"P"</span> straight-pull-all)
    (<span style="font-style: italic;">"m"</span> straight-merge-package)
    (<span style="font-style: italic;">"M"</span> straight-merge-all)
    (<span style="font-style: italic;">"n"</span> straight-normalize-package)
    (<span style="font-style: italic;">"N"</span> straight-normalize-all)
    (<span style="font-style: italic;">"u"</span> straight-push-package)
    (<span style="font-style: italic;">"U"</span> straight-push-all)
    (<span style="font-style: italic;">"v"</span> straight-freeze-versions)
    (<span style="font-style: italic;">"V"</span> straight-thaw-versions)
    (<span style="font-style: italic;">"w"</span> straight-watcher-start)
    (<span style="font-style: italic;">"W"</span> straight-watcher-quit)
    (<span style="font-style: italic;">"g"</span> straight-get-recipe)
    (<span style="font-style: italic;">"e"</span> straight-prune-build)
    (<span style="font-style: italic;">"q"</span> nil)))
</pre>
</div>
</div>
</li>

<li><a id="org55cf230"></a>use-package<br />
<div class="outline-text-6" id="text-org55cf230">
<p>
<a href="https://jwiegley.github.io/use-package/">Official manual</a> is handy especially when you look up <a href="https://jwiegley.github.io/use-package/keywords/">Keywords</a>.
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-use-package"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-style: italic;">"https://github.com/jwiegley/use-package/releases.atom"</span> soft_update)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">use-package</span>)

(customize-set-variable
 'use-package-ensure-function 'straight-use-package-ensure-function)
</pre>
</div>

<p>
use-package depends on following packages internally
</p>
</div>

<ul class="org-ul">
<li><a id="orgd384114"></a>diminish<br />
<div class="outline-text-7" id="text-orgd384114">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-diminish"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package diminish)
</pre>
</div>
</div>
</li>

<li><a id="orgf3ecca8"></a>delight<br />
<div class="outline-text-7" id="text-orgf3ecca8">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-delight"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package delight)
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="org70911c2"></a>load cl-lib<br />
<div class="outline-text-6" id="text-org70911c2">
<p>
Use 'cl-lib' rather than 'cl' package since it is <a href="https://www.gnu.org/savannah-checkouts/gnu/emacs/news/NEWS.27.1">officially deprecated</a>.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">cl-lib</span>)
</pre>
</div>
</div>
</li>
</ul>
</li>
<li><a id="org911fa23"></a>init.el<br />
<div class="outline-text-5" id="text-org911fa23">
<p>
init.el devote itself to call for remaining config files.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(customize-set-variable
 'custom-file
 (expand-file-name <span style="font-style: italic;">"custom.el"</span> user-emacs-directory-default))
(<span style="font-weight: bold;">when</span> (file-exists-p custom-file)
  (load custom-file))

(<span style="font-weight: bold;">dolist</span> (file (directory-files <span style="font-style: italic;">"~/.emacs.d/lisp"</span> t <span style="font-style: italic;">"</span><span style="font-weight: bold; font-style: italic;">\</span><span style="font-style: italic;">.el$"</span>))
  (funcall #'load-file file))
(<span style="font-weight: bold;">dolist</span> (file (directory-files <span style="font-style: italic;">"~/.emacs.d/site-lisp"</span> t <span style="font-style: italic;">"</span><span style="font-weight: bold; font-style: italic;">\</span><span style="font-style: italic;">.el$"</span>))
  (funcall #'load-file file))
(<span style="font-weight: bold;">dolist</span> (file (directory-files <span style="font-style: italic;">"~/.emacs.d/secrets"</span> t <span style="font-style: italic;">"</span><span style="font-weight: bold; font-style: italic;">\</span><span style="font-style: italic;">.el$"</span>))
  (funcall #'load-file file))
(<span style="font-weight: bold;">dolist</span> (file (directory-files <span style="font-style: italic;">"~/.emacs.d/user"</span> t <span style="font-style: italic;">"</span><span style="font-weight: bold; font-style: italic;">\</span><span style="font-style: italic;">.el$"</span>))
  (funcall #'load-file file))
</pre>
</div>
</div>
</li>
<li><a id="orge06502c"></a>Personal Preferences<br />
<div class="outline-text-5" id="text-orge06502c">
<p>
Settings in this section are influenced a great deal by my personal preference. Please be meticulous when you borrow.
</p>
</div>

<ul class="org-ul">
<li><a id="orga8ea7f7"></a>Key Bindings<br />
<div class="outline-text-6" id="text-orga8ea7f7">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(global-set-key (kbd <span style="font-style: italic;">"C-M-o"</span>) #'open-line)
(global-set-key (kbd <span style="font-style: italic;">"M-SPC"</span>) #'cycle-spacing)
(global-set-key (kbd <span style="font-style: italic;">"C-c k"</span>) #'kill-this-buffer)
(global-set-key (kbd <span style="font-style: italic;">"&lt;f5&gt;"</span>) #'revert-buffer-quick)
(global-set-key (kbd <span style="font-style: italic;">"M-z"</span>) #'zap-up-to-char)
(global-set-key (kbd <span style="font-style: italic;">"C-c d"</span>) #'copy-from-above-command)

<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">M-u for `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">universal-argument</span><span style="font-weight: bold; font-style: italic;">'</span>
(substitute-key-definition 'upcase-word
                           'universal-argument
                           global-map)

(substitute-key-definition 'upcase-region
                           'upcase-dwim
                           global-map)
(substitute-key-definition 'downcase-region
                           'downcase-dwim
                           global-map)
(global-set-key (kbd <span style="font-style: italic;">"C-x C-c"</span>) #'capitalize-dwim)

<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">suppress prompting in (up/down)case-region</span>
(put 'upcase-region 'disabled nil)
(put 'downcase-region 'disabled nil)
</pre>
</div>

<ul class="org-ul">
<li><p>
Bind for C-x C-b, use <a href="ibuffer">ibuffer</a> which has more features than <a href="list-buffers">list-buffers</a> based on <a href="https://irreal.org/blog/?p=10329">this advice</a>.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(substitute-key-definition 'list-buffers
                           'ibuffer
                           global-map)
</pre>
</div></li>
<li><p>
lambda-key
<a href="https://www.emacswiki.org/emacs/DocumentingKeyBindingToLambda">lambda-key</a> is nice idea to remedy lambda bindings with define-key.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">lambda-key</span> (keymap key def)
  <span style="font-style: italic;">"Wrap`</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">define-key</span><span style="font-style: italic;">' to provide documentation."</span>
  (set 'sym (make-symbol (documentation def)))
  (fset sym def)
  (define-key keymap key sym))
</pre>
</div></li>
</ul>
</div>
</li>

<li><a id="org4016146"></a>Language<br />
<div class="outline-text-6" id="text-org4016146">
<p>
<a href="https://www.gnu.org/software/emacs/manual/html_mono/emacs.html#Language-Environments">emacs#Language Environments</a>
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">language and locale</span>
(set-language-environment <span style="font-style: italic;">"Japanese"</span>)
(<span style="font-weight: bold;">setq</span> system-time-locale <span style="font-style: italic;">"C"</span>)

<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">coding system</span>
(set-default-coding-systems 'utf-8-unix)
(prefer-coding-system 'utf-8-unix)
(set-selection-coding-system 'utf-8-unix)

<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">prefer-coding-system take effect equally to follows</span>
(set-buffer-file-coding-system 'utf-8-unix)
(set-file-name-coding-system 'utf-8-unix)
(set-terminal-coding-system 'utf-8-unix)
(set-keyboard-coding-system 'utf-8-unix)
(<span style="font-weight: bold;">setq</span> locale-coding-system 'utf-8-unix)
</pre>
</div>
</div>
</li>
<li><a id="org27d6b99"></a>Startup Conditions<br />
<div class="outline-text-6" id="text-org27d6b99">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">do not use basic GUI facets</span>
(tool-bar-mode -1)
(menu-bar-mode -1)
(scroll-bar-mode -1)
(tooltip-mode -1)

<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">fringe is preferably as thin as possible</span>
(set-fringe-mode 15)

<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">do not use visual bell</span>
(<span style="font-weight: bold;">setf</span> visible-bell nil)

<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">conceal distractions at startup</span>
(<span style="font-weight: bold;">setf</span> initial-scratch-message <span style="font-style: italic;">""</span>)
(<span style="font-weight: bold;">setf</span> inhibit-startup-screen t)

<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">use emacs in full screen mode</span>
(use-package emacs
  <span style="font-weight: bold;">:no-require</span> t
  <span style="font-weight: bold;">:hook</span>
  ((after-init server-after-make-frame) .
   (<span style="font-weight: bold;">lambda</span> ()
     (<span style="font-weight: bold;">when</span> (member (window-system) '(x ns w32))
       (set-frame-parameter nil 'fullscreen 'fullboth)))))

<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">enable subword-mode by default</span>
(global-subword-mode 1)
</pre>
</div>
</div>
</li>
<li><a id="orgef1f9aa"></a>Fontsets<br />
<div class="outline-text-6" id="text-orgef1f9aa">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(create-fontset-from-ascii-font <span style="font-style: italic;">"IPAGothic"</span> nil <span style="font-style: italic;">"default"</span>)
(set-fontset-font <span style="font-style: italic;">"fontset-default"</span> 'japanese-jisx0208 <span style="font-style: italic;">"IPAGothic"</span>)

(create-fontset-from-ascii-font <span style="font-style: italic;">"IPAexMincho"</span> nil <span style="font-style: italic;">"exmincho"</span>)
(set-fontset-font <span style="font-style: italic;">"fontset-exmincho"</span> 'japanese-jisx0208 <span style="font-style: italic;">"IPAexMincho"</span>)

(create-fontset-from-ascii-font <span style="font-style: italic;">"IPAexGothic"</span> nil <span style="font-style: italic;">"exgothic"</span>)
(set-fontset-font <span style="font-style: italic;">"fontset-exgothic"</span> 'japanese-jisx0208 <span style="font-style: italic;">"IPAexGothic"</span>)

(create-fontset-from-ascii-font <span style="font-style: italic;">"IPAMincho"</span> nil <span style="font-style: italic;">"mincho"</span>)
(set-fontset-font <span style="font-style: italic;">"fontset-mincho"</span> 'japanese-jisx0208 <span style="font-style: italic;">"IPAMincho"</span>)

(create-fontset-from-ascii-font <span style="font-style: italic;">"Inconsolata"</span> nil <span style="font-style: italic;">"code"</span>)
(set-fontset-font <span style="font-style: italic;">"fontset-code"</span> 'latin (font-spec <span style="font-weight: bold;">:family</span> <span style="font-style: italic;">"Inconsolata"</span> <span style="font-weight: bold;">:weight</span> 'Regular <span style="font-weight: bold;">:width</span> 'SemiCondensed))

<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">foreign fonts for all fontsets</span>
(set-fontset-font t 'emoji <span style="font-style: italic;">"Noto Color Emoji"</span>)
(set-fontset-font t 'symbol <span style="font-style: italic;">"Noto Color Emoji"</span>)
(set-fontset-font t 'symbol <span style="font-style: italic;">"Noto Sans CJK JP"</span> nil 'append)
(set-fontset-font t 'symbol <span style="font-style: italic;">"Noto Sans Symbols"</span> nil 'append)
(set-fontset-font t 'symbol <span style="font-style: italic;">"Noto Sans Symbols2"</span> nil 'append)
</pre>
</div>
</div>
</li>

<li><a id="org2af6034"></a>Faces<br />
<div class="outline-text-6" id="text-org2af6034">
<p>
Caveat: There are some face definitions which use an extra large font since I am <a href="https://en.wikipedia.org/wiki/Visual_impairment">visually impaired</a>.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my/default-pixel-width</span> 2560 <span style="font-style: italic;">"Default display width in pixel."</span>)
(<span style="font-weight: bold;">defmacro</span> <span style="font-weight: bold;">my/normalized-font-size</span> (original-size)
  <span style="font-style: italic;">"THis macro culculates normalized font size for display resolution at runtime.</span>
<span style="font-style: italic;">It tries to proportionate ORIGINAL-SIZE in `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">my/default-pixel-width</span><span style="font-style: italic;">' in the display at runtime."</span>
  `(truncate (* ,original-size (/ (float (x-display-pixel-width))
                                  ,my/default-pixel-width))))

(set-face-attribute 'default
                    nil
                    <span style="font-weight: bold;">:font</span> <span style="font-style: italic;">"fontset-default"</span>
                    <span style="font-weight: bold;">:height</span> (my/normalized-font-size 630))
(set-face-attribute 'fixed-pitch
                    nil
                    <span style="font-weight: bold;">:font</span> <span style="font-style: italic;">"fontset-default"</span>)
(set-face-attribute 'variable-pitch
                    nil
                    <span style="font-weight: bold;">:font</span> <span style="font-style: italic;">"fontset-exmincho"</span>)

(use-package face
  <span style="font-weight: bold;">:no-require</span> t
  <span style="font-weight: bold;">:hook</span>
  ((eww-mode twittering-mode nov-mode mu4e-view-mode elfeed-show-mode)
   . (<span style="font-weight: bold;">lambda</span> ()
       (buffer-face-set
        (<span style="font-weight: bold;">or</span> (<span style="font-weight: bold;">ignore-errors</span> (check-face 'my/reading-face))
            (<span style="font-weight: bold;">defface</span> <span style="font-weight: bold; font-style: italic;">my/reading-face</span> `((t . (<span style="font-weight: bold;">:font</span> <span style="font-style: italic;">"fontset-exgothic"</span>
                                                   <span style="font-weight: bold;">:height</span> ,(my/normalized-font-size 850))))
              <span style="font-style: italic;">"My customized face offers great legibility for reading articles."</span>)))))
  ((Info-mode help-mode helpful-mode woman-mode)
   . (<span style="font-weight: bold;">lambda</span> ()
       (buffer-face-set
        (<span style="font-weight: bold;">or</span> (<span style="font-weight: bold;">ignore-errors</span> (check-face 'my/document-face))
            (<span style="font-weight: bold;">defface</span> <span style="font-weight: bold; font-style: italic;">my/document-face</span> `((t . (<span style="font-weight: bold;">:font</span> <span style="font-style: italic;">"fontset-default"</span>
                                                    <span style="font-weight: bold;">:height</span> ,(my/normalized-font-size 720))))
              <span style="font-style: italic;">"My customized face offers large fixed fonts for documentations."</span>)))))
  ((org-mode text-mode mu4e-compose-mode)
   . (<span style="font-weight: bold;">lambda</span> ()
       (buffer-face-set
        (<span style="font-weight: bold;">or</span> (<span style="font-weight: bold;">ignore-errors</span> (check-face 'my/writing-face))
            (<span style="font-weight: bold;">defface</span> <span style="font-weight: bold; font-style: italic;">my/writing-face</span> `((t . (<span style="font-weight: bold;">:font</span> <span style="font-style: italic;">"fontset-default"</span>
                                                   <span style="font-weight: bold;">:height</span> ,(my/normalized-font-size 655))))
              <span style="font-style: italic;">"My customized face offers relatively small fixed fonts for writing."</span>)))))
  ((prog-mode shell-mode term-mode vterm-mode eshell-mode calendar-mode)
   . (<span style="font-weight: bold;">lambda</span> ()
       (buffer-face-set
        (<span style="font-weight: bold;">or</span> (<span style="font-weight: bold;">ignore-errors</span> (check-face 'my/code-face))
            (<span style="font-weight: bold;">defface</span> <span style="font-weight: bold; font-style: italic;">my/code-face</span> `((t . (<span style="font-weight: bold;">:font</span> <span style="font-style: italic;">"fontset-code"</span>
                                                <span style="font-weight: bold;">:height</span> ,(my/normalized-font-size 640))))
              <span style="font-style: italic;">"My customized face offers condensed fonts for programming code."</span>)))))
  ((dired-mode mu4e-headers-mode elfeed-search-update)
   . (<span style="font-weight: bold;">lambda</span> ()
       (buffer-face-set
        (<span style="font-weight: bold;">or</span> (<span style="font-weight: bold;">ignore-errors</span> (check-face 'my/list-face))
            (<span style="font-weight: bold;">defface</span> <span style="font-weight: bold; font-style: italic;">my/list-face</span> `((t . (<span style="font-weight: bold;">:font</span> <span style="font-style: italic;">"fontset-mincho"</span>
                                                <span style="font-weight: bold;">:height</span> ,(my/normalized-font-size 670))))
              <span style="font-style: italic;">"My customized face offers variable pitch fonts for displaying lists."</span>))))))
</pre>
</div>
</div>
</li>

<li><a id="orgf4c69c6"></a>Modifier Keys<br />
<div class="outline-text-6" id="text-orgf4c69c6">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">cond</span>
 ((string= window-system <span style="font-style: italic;">"x"</span>)
  (<span style="font-weight: bold;">setf</span> x-alt-keysym  'alt
        x-meta-keysym 'meta))
 ((string= window-system <span style="font-style: italic;">"ns"</span>)
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">IME inline patch</span>
  (<span style="font-weight: bold;">setf</span> mac-use-input-method-on-system nil)
  (<span style="font-weight: bold;">setf</span> mac-control-modifier       'control
        mac-command-modifier       'meta
        mac-option-modifier        'super
        mac-right-option-modifier  'alt
        mac-right-control-modifier 'super
        mac-function-modifier      'hyper)))
</pre>
</div>
</div>
</li>

<li><a id="orgb5b0132"></a>Performance Tuning<br />
<div class="outline-text-6" id="text-orgb5b0132">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">setq-default</span> bidi-display-reordering nil)
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="org361dd99"></a><a id="ID-587bc395-6321-4f59-97e6-6f0b62518b20"></a>Custom Variables<br />
<div class="outline-text-5" id="text-org361dd99">
<p>
Entries in this section represnets <a href="https://www.gnu.org/software/emacs/manual/html_mono/emacs.html#Customization-Groups">Customization Groups</a> hierarchy.
</p>
</div>

<ul class="org-ul">
<li><a id="orgefda7b4"></a>Files<br />
<div class="outline-text-6" id="text-orgefda7b4">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(customize-set-variable 'create-lockfiles nil)
(customize-set-variable 'remote-file-name-inhibit-locks t)
</pre>
</div>
</div>

<ul class="org-ul">
<li><a id="orgd3c52ae"></a>Auto Revert<br />
<div class="outline-text-7" id="text-orgd3c52ae">
<p>
<a href="https://www.gnu.org/software/emacs/manual/html_mono/emacs.html#Auto-Revert">Auto Revert</a>: Keeping buffers automatically up-to-date.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package autorevert
  <span style="font-weight: bold;">:diminish</span> (global-auto-revert-mode auto-revert-mode)
  <span style="font-weight: bold;">:custom</span>
  (auto-revert-verbose nil)
  (global-auto-revert-non-file-buffers t)
  (auto-revert-interval 3)
  (global-auto-revert-mode t))
</pre>
</div>
</div>
</li>

<li><a id="orgec9e696"></a>Auto Save<br />
<div class="outline-text-7" id="text-orgec9e696">
<p>
System crashing jeopardizes our precious text data. Emacs <a href="https://www.gnu.org/software/emacs/manual/html_mono/emacs.html#Auto-Save">auto saving mechanism</a> come to the rescue.
</p>

<div class="org-src-container">
<pre class="src src-conf">d &lt;&lt;share-dir()&gt;&gt;/emacs/auto-save-list 0755 - - 2w
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(customize-set-variable 'auto-save-interval 200)
(customize-set-variable 'auto-save-timeout 25)
(customize-set-variable 'auto-save-default nil)
(customize-set-variable 'auto-save-list-file-prefix
                        (file-name-concat user-emacs-directory <span style="font-style: italic;">"auto-save-list/.saves-"</span>))

(customize-set-variable 'auto-save-visited-mode t)
(customize-set-variable 'auto-save-visited-interval 900)
(put 'auto-save-visited-mode 'disabled nil)

(customize-set-variable 'delete-by-moving-to-trash t)
(customize-set-variable 'delete-auto-save-files t)
(customize-set-variable 'kill-buffer-delete-auto-save-files t)
(customize-set-variable 'save-some-buffers-default-predicate 'save-some-buffers-root)
</pre>
</div>
</div>
</li>

<li><a id="org82794a4"></a>Uniquify<br />
<div class="outline-text-7" id="text-org82794a4">
<p>
<a href="https://www.gnu.org/software/emacs/manual/html_mono/emacs.html#Uniquify">Uniquify</a> shows buffer name easy to distinguish.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package uniquify
  <span style="font-weight: bold;">:custom</span>
  (uniquify-buffer-name-style 'post-forward))
</pre>
</div>
</div>
</li>

<li><a id="org982f3da"></a>Recentf<br />
<div class="outline-text-7" id="text-org982f3da">
<p>
<a href="https://www.gnu.org/software/emacs/manual/html_mono/emacs.html#File-Conveniences">emacs#File Conveniences</a>
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package recentf
  <span style="font-weight: bold;">:custom</span>
  (recentf-exclude '(<span style="font-style: italic;">".gz"</span> <span style="font-style: italic;">".xz"</span> <span style="font-style: italic;">".zip"</span> <span style="font-style: italic;">".gpg"</span>))
  (recentf-max-saved-items 200)
  (recentf-max-menu-items 15)
  (recentf-auto-cleanup <span style="font-style: italic;">"1:23am"</span>)
  <span style="font-weight: bold;">:config</span>
  (recentf-mode 1))
</pre>
</div>
</div>
</li>
<li><a id="org60b41e1"></a>Tramp<br />
<div class="outline-text-7" id="text-org60b41e1">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package tramp
  <span style="font-weight: bold;">:defer</span> t
  <span style="font-weight: bold;">:custom</span>
  (tramp-default-method <span style="font-style: italic;">"ssh"</span>)
  <span style="font-weight: bold;">:config</span>
  (add-to-list 'tramp-remote-path 'tramp-own-remote-path)
  (add-to-list 'tramp-remote-path <span style="font-style: italic;">"~/bin"</span>))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">sudo</span> ()
  <span style="font-style: italic;">"Use TRAMP to `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">sudo</span><span style="font-style: italic;">' the current buffer"</span>
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">when</span> buffer-file-name
    (find-alternate-file
     (concat <span style="font-style: italic;">"/sudo:root@localhost:"</span>
             buffer-file-name))))
</pre>
</div>
</div>
</li>
<li><a id="org3d5baeb"></a>Find File<br />
<div class="outline-text-7" id="text-org3d5baeb">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(customize-set-variable
 'revert-buffer-quick-short-answers t)

(add-to-list 'safe-local-eval-forms
             '(add-hook 'after-save-hook
                        #'my/compile-default-command nil t))
(add-to-list 'safe-local-eval-forms
             '(add-hook 'magit-mode-hook
                        #'my/compile-default-command nil t))
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="org07d1b82"></a>Environment<br />
<ul class="org-ul">
<li><a id="org01c2613"></a>Frames<br />
<ul class="org-ul">
<li><a id="org388422a"></a>Cursor<br />
<div class="outline-text-8" id="text-org388422a">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(customize-set-variable 'blink-cursor-blinks 15)
(customize-set-variable 'blink-cursor-delay 0.7)
(customize-set-variable 'blink-cursor-interval 0.35)
(customize-set-variable 'blink-cursor-mode t)
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="org68571c6"></a>Display<br />
<div class="outline-text-7" id="text-org68571c6">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(customize-set-variable 'text-scale-mode-step 1.0625)
(customize-set-variable 'highlight-nonselected-windows t)
(customize-set-variable 'truncate-lines t)
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">avoid to break at whitespace in Japanese</span>
(customize-set-variable 'word-wrap-by-category t)
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">suppress curved quotes in docstring (for emacs25)</span>
(customize-set-variable 'text-quoting-style 'straight)
</pre>
</div>
</div>
</li>

<li><a id="orga9ccff2"></a>Windows<br />
<div class="outline-text-7" id="text-orga9ccff2">
<p>
<a href="https://www.masteringemacs.org/article/demystifying-emacs-window-manager?utm_source=newsletter&amp;utm_medium=email&amp;utm_campaign=rss">This blog post</a> is must-read when you tweak display-buffer facilities or something related to display settings.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(customize-set-variable 'scroll-step 1)
(customize-set-variable 'next-screen-context-lines 2)
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">display buffer</span>
(customize-set-variable 'display-buffer-base-action
                        '((display-buffer-same-window
                           display-buffer-reuse-window
                           display-buffer-reuse-mode-window
                           display-buffer-in-previous-window)))
</pre>
</div>
</div>

<ul class="org-ul">
<li><a id="orgec7ad83"></a>Winner<br />
<div class="outline-text-8" id="text-orgec7ad83">
<p>
Triple Escape (M-ESC ESC) has got to reset window layout by tweaking buffer-quit-function.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package winner
  <span style="font-weight: bold;">:bind</span> ((<span style="font-style: italic;">"C-z"</span> . winner-undo)
         (<span style="font-style: italic;">"C-M-z"</span> . winner-redo))
  <span style="font-weight: bold;">:custom</span>
  (winner-mode t)
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">setq</span> buffer-quit-function 'winner-undo))
</pre>
</div>
</div>
</li>

<li><a id="org4f47ff1"></a>Windmove<br />
<div class="outline-text-8" id="text-org4f47ff1">
<p>
You can now switch windows with your shift key by pressing S-&lt;left&gt;, S-&lt;right&gt;, S-&lt;up&gt;, S-&lt;down&gt;.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package windmove
  <span style="font-weight: bold;">:custom</span>
  (windmove-mode t)
  (windmove-wrap-around t)
  <span style="font-weight: bold;">:config</span>
  (windmove-default-keybindings '(control shift)))
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="org4192b34"></a>Minibuffer<br />
<div class="outline-text-7" id="text-org4192b34">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(define-key minibuffer-mode-map
  (kbd <span style="font-style: italic;">"C-h"</span>) #'delete-backward-char)
(define-key minibuffer-mode-map
  (kbd <span style="font-style: italic;">"M-h"</span>) #'backward-kill-word)

(customize-set-variable 'history-length 300)
(customize-set-variable 'history-delete-duplicates t)
(customize-set-variable 'enable-recursive-minibuffers t)
(customize-set-variable 'minibuffer-depth-indicate-mode t)
(customize-set-variable 'read-file-name-completion-ignore-case t)
(customize-set-variable 'read-minibuffer-restore-windows t)
(customize-set-variable 'minibuffer-default-prompt-format <span style="font-style: italic;">" [%s]"</span>)

(add-hook 'minibuffer-setup-hook 'my/minibuffer-setup-function)
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/minibuffer-setup-function</span> ()
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">disable input method in mini buffer</span>
  (<span style="font-weight: bold;">when</span> current-input-method
    (deactivate-input-method))
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">decrease font size to 90% in minibuffer</span>
  (<span style="font-weight: bold;">setq-local</span> face-remapping-alist '((default <span style="font-weight: bold;">:height</span> 0.9))))
</pre>
</div>
</div>


<ul class="org-ul">
<li><a id="org9d40b06"></a>Savehist<br />
<div class="outline-text-8" id="text-org9d40b06">
<p>
<a href="savehist-mode">savehist-mode</a> saves minibuffer history and additionals.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package savehist
  <span style="font-weight: bold;">:custom</span>
  (savehist-save-minibuffer-history t)
  (savehist-additional-variables '(kill-ring))
  <span style="font-weight: bold;">:config</span>
  (savehist-mode 1))
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="org42e14d4"></a>Menu<br />
<div class="outline-text-7" id="text-org42e14d4">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(customize-set-variable 'use-short-answers t)
</pre>
</div>
</div>
</li>

<li><a id="org6d5191e"></a>Mode Line<br />
<div class="outline-text-7" id="text-org6d5191e">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my/mode-line-buffer-name-length-max</span> 15
  <span style="font-style: italic;">"Fixed length for displaying buffer name in mode line."</span>)

(customize-set-variable 'line-number-mode nil)
(customize-set-variable 'column-number-mode nil)
(customize-set-variable 'mode-line-compact t)
(customize-set-variable
 'mode-line-format
 '(<span style="font-style: italic;">"%e"</span>
   mode-line-front-space
   (<span style="font-weight: bold;">:eval</span>
    (<span style="font-weight: bold;">let</span> ((mode-line-buffer-name
           (replace-regexp-in-string <span style="font-style: italic;">" %</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">[[:ascii:]]</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">"</span> <span style="font-style: italic;">" %%\\1"</span>
                                     (truncate-string-to-width
                                      (buffer-name) my/mode-line-buffer-name-length-max nil ? t))))
      (<span style="font-weight: bold;">cond</span>
       (buffer-read-only
        (propertize mode-line-buffer-name 'face 'underline))
       ((buffer-modified-p)
        (propertize mode-line-buffer-name 'face 'warning))
       (mode-line-buffer-name))))
   (<span style="font-weight: bold;">:eval</span>
    (<span style="font-weight: bold;">cond</span>
     ((<span style="font-weight: bold;">and</span> line-number-mode
           column-number-mode)
      mode-line-position-column-line-format)
     (line-number-mode mode-line-position-line-format)
     (column-number-mode mode-line-position-column-format)))
   <span style="font-style: italic;">" "</span>
   global-mode-string))
</pre>
</div>
</div>

<ul class="org-ul">
<li><a id="org91106ea"></a>Display Time<br />
<div class="outline-text-8" id="text-org91106ea">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(customize-set-variable
 'display-time-string-forms
 '((propertize (format-time-string <span style="font-style: italic;">"%H:%M"</span> now) 'face 'mode-line-highlight)))
(customize-set-variable 'display-time-mode t)
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="org947ae9c"></a>Mouse<br />
<div class="outline-text-7" id="text-org947ae9c">
<p>
Mouse needs to be unobtrusive in my Emacs experience.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package mouse
  <span style="font-weight: bold;">:custom</span>
  (mouse-1-click-follows-link nil)
  (mouse-highlight nil)
  (mouse-wheel-mode nil))
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="org82317f3"></a>Convenience<br />
<div class="outline-text-6" id="text-org82317f3">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">repeat</span>)

(customize-set-variable 'repeat-mode t)
</pre>
</div>
</div>

<ul class="org-ul">
<li><a id="org37b8c62"></a>Abbreviations<br />
<div class="outline-text-7" id="text-org37b8c62">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package abbrev
  <span style="font-weight: bold;">:diminish</span> abbrev-mode
  <span style="font-weight: bold;">:custom</span>
  (save-abbrevs t)
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">setq-default</span> abbrev-mode t)
  (<span style="font-weight: bold;">setf</span> abbrev-file-name (expand-file-name <span style="font-style: italic;">"abbrev_defs"</span> user-emacs-directory))
  (quietly-read-abbrev-file))
</pre>
</div>
</div>
</li>

<li><a id="org6756e6f"></a>Hippie Expand<br />
<div class="outline-text-7" id="text-org6756e6f">
<p>
<a href="https://www.masteringemacs.org/article/text-expansion-hippie-expand">As this post mentions</a>, Hippie Expansion is superior for auto typing to dabbrev, skeleton, and even company.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package hippie-exp
  <span style="font-weight: bold;">:config</span>
  (global-set-key [remap dabbrev-expand] 'hippie-expand))
</pre>
</div>
</div>
</li>

<li><a id="org00f85cd"></a>Hl Line<br />
<div class="outline-text-7" id="text-org00f85cd">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package hl-line
  <span style="font-weight: bold;">:hook</span> (vterm-mode . (<span style="font-weight: bold;">lambda</span> () (hl-line-mode -1)))
  <span style="font-weight: bold;">:config</span>
  (hl-line-mode 1))
</pre>
</div>
</div>
</li>
<li><a id="orgbede37e"></a>Visual Line<br />
<div class="outline-text-7" id="text-orgbede37e">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package visual-line
  <span style="font-weight: bold;">:no-require</span> t
  <span style="font-weight: bold;">:after</span> adaptive-wrap
  <span style="font-weight: bold;">:hook</span>
  ((feed-show-mode eww-after-render help-mode helpful-mode Info-mode woman-mode mu4e-view-mode nov-mode twittering-mode)
   . visual-line-mode)
  ((feed-show-mode eww-after-render help-mode helpful-mode Info-mode woman-mode mu4e-view-mode nov-mode twittering-mode)
   . adaptive-wrap-prefix-mode)
  <span style="font-weight: bold;">:custom</span>
  (global-visual-line-mode nil))
</pre>
</div>
</div>
</li>

<li><a id="org430757b"></a>Whitespace<br />
<div class="outline-text-7" id="text-org430757b">
<p>
<a href="https://www.gnu.org/software/emacs/manual/html_mono/emacs.html#Useless-Whitespace">emacs#Useless Whitespace</a>
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package whitespace
  <span style="font-weight: bold;">:diminish</span> ((global-whitespace-mode . <span style="font-style: italic;">"Ws"</span>)
             (whitespace-mode . <span style="font-style: italic;">"ws"</span>))
  <span style="font-weight: bold;">:hook</span>
  ((org-mode prog-mode dired-mode) . whitespace-mode)
  (eww-mode . whitespace-turn-off)
  (before-save . delete-trailing-whitespace)
  <span style="font-weight: bold;">:custom</span>
  (whitespace-style
   '(face trailing tabs tab-mark spaces space-mark empty missing-newline-at-eof))
  (whitespace-space-regexp <span style="font-style: italic;">"</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">\x3000+</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">"</span>)
  (whitespace-trailing-regexp <span style="font-style: italic;">"</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">[ \t\u00A0]+</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">$"</span>)
  (whitespace-display-mappings
   '((space-mark ?\x3000 [?\u2423])
     (tab-mark   ?\t   [?\u00BB ?\t])))
  (global-whitespace-mode nil))
</pre>
</div>
</div>
</li>

<li><a id="org74a7bb1"></a>So Long<br />
<div class="outline-text-7" id="text-org74a7bb1">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">so-long</span>)

(customize-set-variable 'global-so-long-mode t)
</pre>
</div>
</div>
</li>

<li><a id="orgbfb4b2e"></a>Tab Bar<br />
<div class="outline-text-7" id="text-orgbfb4b2e">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package tab-bar
  <span style="font-weight: bold;">:hook</span> (after-init . (<span style="font-weight: bold;">lambda</span> ()
                        (define-key ctl-x-map <span style="font-style: italic;">"t"</span> tab-prefix-map)))
  <span style="font-weight: bold;">:custom</span>
  (tab-bar-mode t)
  (tab-bar-show 2)
  (tab-bar-history-mode t)
  (tab-bar-tab-hints t)
  <span style="font-weight: bold;">:config</span>
  (global-set-key (kbd <span style="font-style: italic;">"M-["</span>) 'tab-bar-history-back)
  (global-set-key (kbd <span style="font-style: italic;">"M-]"</span>) 'tab-bar-history-forward))
</pre>
</div>
</div>
</li>

<li><a id="orgadb788b"></a>Ffap<br />
<div class="outline-text-7" id="text-orgadb788b">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">ffap</span>)

(ffap-bindings)
</pre>
</div>
</div>
</li>

<li><a id="orgac37201"></a>Kmacro<br />
<div class="outline-text-7" id="text-orgac37201">
<p>
The power of keyboard macro is more than repeating editing commands. <a href="https://masteringemacs.org/article/keyboard-macros-are-misunderstood">This post explains fluently</a>.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">kmacro</span>)

(<span style="font-weight: bold;">defalias</span> '<span style="font-weight: bold;">kmacro-insert-macro</span> 'insert-kbd-macro)
(define-key kmacro-keymap (kbd <span style="font-style: italic;">"I"</span>) #'kmacro-insert-macro)
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="org7fa9a70"></a>Editing<br />
<ul class="org-ul">
<li><a id="orgcaaf2be"></a>Indent<br />
<div class="outline-text-7" id="text-orgcaaf2be">
<p>
See also [BROKEN LINK: id:4a58219c-74dd-4135-b56d-876b0db2cd83]
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(customize-set-variable 'tab-always-indent 'complete)
(customize-set-variable 'indent-tabs-mode nil)
(customize-set-variable 'tab-first-completion 'word-or-paren-or-punct)
</pre>
</div>
</div>
</li>

<li><a id="orgfb5ba50"></a>Electricity<br />
<div class="outline-text-7" id="text-orgfb5ba50">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(customize-set-variable 'electric-indent-mode 1)
</pre>
</div>
</div>
</li>

<li><a id="orge23aa58"></a>Fill<br />
<div class="outline-text-7" id="text-orge23aa58">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(customize-set-variable 'fill-column 80)
(customize-set-variable 'sentence-end-double-space nil)
</pre>
</div>
</div>
</li>

<li><a id="orgd4b5918"></a>Killing<br />
<div class="outline-text-7" id="text-orgd4b5918">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(customize-set-variable 'yank-pop-change-selection t)
</pre>
</div>
</div>
</li>

<li><a id="org5b17d21"></a>Undo<br />
<div class="outline-text-7" id="text-org5b17d21">
<p>
The older undo step which exceeds <a href="undo-limit">undo-limit</a> in byte is eliminated at garbage collection.
The oldest undo step, if undo info exceeds <a href="undo-strong-limit">undo-strong-limit</a> in total, is removed instantaneously.
No more new undo step than <a href="undo-outer-limit">undo-outer-limit</a> could not be registered.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(customize-set-variable 'undo-limit 320000)
(customize-set-variable 'undo-strong-limit 480000)
(customize-set-variable 'undo-outer-limit 48000000)
(customize-set-variable 'undo-no-redo t)
</pre>
</div>
</div>
</li>

<li><a id="org24e4d2f"></a>Matching<br />
<ul class="org-ul">
<li><a id="org07f247d"></a>Isearch<br />
<div class="outline-text-8" id="text-org07f247d">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">provide</span> '<span style="font-weight: bold; text-decoration: underline;">isearch</span>)

(customize-set-variable 'isearch-allow-motion t)

(define-key isearch-mode-map (kbd <span style="font-style: italic;">"C-j"</span>) #'isearch-exit)
</pre>
</div>
</div>
</li>

<li><a id="orgd3aeb76"></a>Bookmark<br />
<div class="outline-text-8" id="text-orgd3aeb76">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package bookmark
  <span style="font-weight: bold;">:bind</span> (<span style="font-style: italic;">"C-c b"</span> . bookmark-jump)
  <span style="font-weight: bold;">:custom</span>
  (bookmark-menu-confirm-deletion t)
  (bookmark-watch-bookmark-file 'silent))
</pre>
</div>
</div>
</li>
</ul>
</li>
</ul>
</li>

<li><a id="orgc5493c2"></a>Multimedia<br />
<ul class="org-ul">
<li><a id="orgb2bd1ce"></a>Image<br />
<div class="outline-text-7" id="text-orgb2bd1ce">
<p>
<a href="https://xenodium.com/emacs-viewing-webp-images/">This post</a> teaches me how to enable converting external formats (i.e. webp) to internal ones.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package image
  <span style="font-weight: bold;">:custom</span>
  (image-use-external-converter t))
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="org382f9c6"></a>Development<br />
<ul class="org-ul">
<li><a id="orgf5e175d"></a>Internal<br />
<ul class="org-ul">
<li><a id="orgabe7b73"></a>Storage Allocation<br />
<div class="outline-text-8" id="text-orgabe7b73">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(customize-set-variable 'gc-cons-threshold (* 10 gc-cons-threshold))
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="org9750a37"></a>Lisp<br />
<ul class="org-ul">
<li><a id="org6b44bb4"></a>Shortdoc<br />
<div class="outline-text-8" id="text-org6b44bb4">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package shortdoc
  <span style="font-weight: bold;">:bind</span> (<span style="font-style: italic;">"&lt;help&gt; D"</span> . shortdoc-display-group))
</pre>
</div>
</div>
</li>

<li><a id="orgc1fc61b"></a>Re Builder<br />
<div class="outline-text-8" id="text-orgc1fc61b">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package re-builder
  <span style="font-weight: bold;">:custom</span>
  (reb-re-syntax 'string))
</pre>
</div>
</div>
</li>

<li><a id="org4bc4322"></a>Comp<br />
<div class="outline-text-8" id="text-org4bc4322">
<p>
For <a href="https://www.gnu.org/software/emacs/manual/html_mono/elisp.html#Native-Compilation">native compilation feature</a> introduced at Emacs 28.1.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package comp
  <span style="font-weight: bold;">:custom</span>
  (native-comp-async-report-warnings-errors 'silent)
  (native-comp-async-query-on-exit t))
</pre>
</div>
</div>
</li>

<li><a id="orgc1d5d4d"></a>Eldoc<br />
<div class="outline-text-8" id="text-orgc1d5d4d">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">eldoc</span>)

(customize-set-variable 'eldoc-echo-area-display-truncation-message nil)
(customize-set-variable 'eldoc-echo-area-prefer-doc-buffer 'maybe)
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="orgc3cbb98"></a>Debug<br />
<div class="outline-text-7" id="text-orgc3cbb98">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(customize-set-variable 'message-log-max 10000)
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="org544b6d6"></a>Data<br />
<ul class="org-ul">
<li><a id="org59bd1ff"></a>Save Place<br />
<div class="outline-text-7" id="text-org59bd1ff">
<p>
File-related tweaks including <a href="https://www.gnu.org/software/emacs/manual/html_mono/emacs.html#Customize-Save">Customizing Saving of Files</a>.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">saveplace</span>)

(customize-set-variable 'save-place-abbreviate-file-names t)
(customize-set-variable 'save-place-version-control t)
(customize-set-variable 'save-place-mode t)
</pre>
</div>
</div>
</li>

<li><a id="org9d4a864"></a>Compression<br />
<div class="outline-text-7" id="text-org9d4a864">
<ul class="org-ul">
<li><p>
Jka Compr (auto compression mode)
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(customize-set-variable 'auto-compression-mode t)
</pre>
</div></li>
</ul>
</div>
</li>

<li><a id="org5070e48"></a>Tar<br />
<div class="outline-text-7" id="text-org5070e48">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">tar-mode</span>)
</pre>
</div>
</div>
</li>

<li><a id="org99b6c62"></a>Archive<br />
<div class="outline-text-7" id="text-org99b6c62">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">archive-mode</span>)
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="org6cf8986"></a>Editing Basics<br />
<div class="outline-text-6" id="text-org6cf8986">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(customize-set-variable 'seft-mark-command-repeat-pop t)
(customize-set-variable 'mark-ring-max 32)
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">delsel</span>
(customize-set-variable 'delete-selection-mode t) <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">inserted text replaces the text in region</span>
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">files</span>
(customize-set-variable 'mode-require-final-newline 'visit-save)
(customize-set-variable 'make-backup-files nil)
(customize-set-variable 'delete-auto-save-files t)
(customize-set-variable 'enable-remote-dir-locals t)
</pre>
</div>
</div>
</li>

<li><a id="org91c9bfb"></a>External<br />
<ul class="org-ul">
<li><a id="org179a4b3"></a>EasyPG (epg)<br />
<div class="outline-text-7" id="text-org179a4b3">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package epg
  <span style="font-weight: bold;">:custom</span>
  (epg-pinentry-mode 'loopback))
</pre>
</div>
</div>
</li>

<li><a id="org033c2e3"></a>Server<br />
<div class="outline-text-7" id="text-org033c2e3">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package server
  <span style="font-weight: bold;">:custom</span>
  (server-client-instructions t)
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">unless</span> (server-running-p)
    (server-start)))
</pre>
</div>
</div>
</li>

<li><a id="orgf218fee"></a>Processes<br />
<ul class="org-ul">
<li><a id="org54e0789"></a>Proced<br />
<div class="outline-text-8" id="text-org54e0789">
<p>
<a href="https://www.masteringemacs.org/article/displaying-interacting-processes-proced">This blog post</a> explains how to use proced, process monitoring package for emacs.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package proced
  <span style="font-weight: bold;">:no-require</span> t
  <span style="font-weight: bold;">:custom</span>
  (proced-auto-update-flag t)
  (proced-auto-update-interval 3))
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="orgc677b86"></a>Browse Url<br />
<div class="outline-text-7" id="text-orgc677b86">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(global-set-key (kbd <span style="font-style: italic;">"C-c C-o"</span>) #'browse-url-at-point)
</pre>
</div>
</div>
</li>

<li><a id="org71861f1"></a>locate<br />
<div class="outline-text-7" id="text-org71861f1">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package locate
  <span style="font-weight: bold;">:custom</span>
  (locate-command <span style="font-style: italic;">"plocate"</span>)
  (locate-make-command-line #'my/plocate-make-command-line)
  (locate-fcodes-file <span style="font-style: italic;">"&lt;&lt;plocate-db()&gt;&gt;"</span>)
  (locate-update-path (expand-file-name <span style="font-style: italic;">"~/"</span>)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/plocate-make-command-line</span> (search-string)
  (list locate-command <span style="font-style: italic;">"-d"</span> <span style="font-style: italic;">"&lt;&lt;plocate-db()&gt;&gt;"</span> <span style="font-style: italic;">"--ignore-case"</span> <span style="font-style: italic;">"--existing"</span> <span style="font-style: italic;">"--regexp"</span> search-string))
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="orga120d55"></a>Applications<br />
<ul class="org-ul">
<li><a id="org6fcebe8"></a>Ispell<br />
<div class="outline-text-7" id="text-org6fcebe8">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package flyspell
  <span style="font-weight: bold;">:diminish</span> <span style="font-style: italic;">"fs"</span>
  <span style="font-weight: bold;">:if</span> (executable-find <span style="font-style: italic;">"aspell"</span>)
  <span style="font-weight: bold;">:after</span> (hydra)
  <span style="font-weight: bold;">:custom</span>
  (ispell-program-name <span style="font-style: italic;">"aspell"</span>)
  (flyspell-issue-message-flag nil)
  <span style="font-weight: bold;">:config</span>
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">avoid checking for Japanese characters</span>
  (add-to-list 'ispell-skip-region-alist '(<span style="font-style: italic;">"[</span><span style="font-style: italic;">^</span><span style="font-style: italic;">\000-\377]+"</span>))
  (<span style="font-weight: bold;">setq-default</span> ispell-extra-args '(<span style="font-style: italic;">"--sug-mode=ultra"</span>
                                    <span style="font-style: italic;">"--lang=en_US"</span>))
  (<span style="font-weight: bold;">when</span> (string-match-p <span style="font-style: italic;">"--camel-case"</span>
                        (shell-command-to-string (concat ispell-program-name <span style="font-style: italic;">" --help"</span>)))
    (<span style="font-weight: bold;">push</span> <span style="font-style: italic;">"--camel-case"</span> ispell-extra-args))
  (bind-keys <span style="font-weight: bold;">:map</span> flyspell-mode-map
             (<span style="font-style: italic;">"C-,"</span>   . nil)
             (<span style="font-style: italic;">"C-."</span>   . nil)
             (<span style="font-style: italic;">"C-;"</span>   . nil)
             (<span style="font-style: italic;">"C-c $"</span> . nil)
             (<span style="font-style: italic;">"C-M-i"</span> . nil))
  (defhydra hydra-flyspell (flyspell-mode-map <span style="font-style: italic;">"C-c $"</span>
                                              <span style="font-weight: bold;">:color</span> red)
    <span style="font-style: italic;">"Flyspell"</span>
    (<span style="font-style: italic;">"c"</span> flyspell-buffer)
    (<span style="font-style: italic;">"n"</span> flyspell-goto-next-error)
    (<span style="font-style: italic;">"."</span> flyspell-auto-correct-word)
    (<span style="font-style: italic;">"q"</span> nil <span style="font-style: italic;">"quit"</span>)))
</pre>
</div>
</div>
</li>

<li><a id="org567c8bb"></a>News<br />
<ul class="org-ul">
<li><a id="org66d60c9"></a>Gnus<br />
<ul class="org-ul">
<li><a id="org6b9ef86"></a>Auth Source<br />
<div class="outline-text-9" id="text-org6b9ef86">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package auth-source
  <span style="font-weight: bold;">:custom</span>
  (auth-source-gpg-encrypt-to `(,user-mail-address))
  <span style="font-weight: bold;">:config</span>
  (add-to-list 'auth-sources <span style="font-style: italic;">"~/.netrc.gpg"</span>))

(use-package auth-source-pass
  <span style="font-weight: bold;">:config</span>
  (auth-source-pass-enable))
</pre>
</div>
</div>
</li>
</ul>
</li>
</ul>
</li>

<li><a id="orgeb6d759"></a>Calc (The GNU Emacs Calculator)<br />
<div class="outline-text-7" id="text-orgeb6d759">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package calc
  <span style="font-weight: bold;">:bind</span> (<span style="font-style: italic;">"&lt;f7&gt;"</span> . calc)
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">setf</span> calc-display-trail nil))
</pre>
</div>
</div>
</li>
<li><a id="orga507d2e"></a>Calendar<br />
<div class="outline-text-7" id="text-orga507d2e">
<p>
<a href="https://github.com/emacs-jp/japanese-holidays/releases.atom">japanese-holidays</a>
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package calendar
  <span style="font-weight: bold;">:commands</span> calendar
  <span style="font-weight: bold;">:straight</span> japanese-holidays
  <span style="font-weight: bold;">:hook</span>
  ((calendar-today-visible calendar-today-invisible) . japanese-holiday-mark-weekend)
  (calendar-today-visible . calendar-mark-today)
  (calendar-move . my/japanese-holiday-show)
  <span style="font-weight: bold;">:custom</span>
  (calendar-left-margin 0)
  (calendar-right-margin 0)
  (calendar-intermonth-spacing 1)
  (calendar-mark-holidays-flag t)
  (japanese-holiday-weekend '(0 6))
  (japanese-holiday-weekend-marker
   '(holiday nil nil nil nil nil japanese-holiday-saturday))
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">japanese-holidays</span>)
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">add 'holiday-general-holidays to calendar-holidays</span>
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">if you want holidays in the U.S. to be counted as your holidays.</span>
  (<span style="font-weight: bold;">setf</span> calendar-holidays
        (append japanese-holidays holiday-local-holidays holiday-other-holidays))
  (bind-keys <span style="font-weight: bold;">:map</span> calendar-mode-map
             (<span style="font-style: italic;">"v"</span> . my/calendar-show-items)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/japanese-holiday-show</span> (<span style="font-weight: bold; text-decoration: underline;">&amp;rest</span> _args)
  <span style="font-style: italic;">"Show holiday information in mini buffer if date on which the cursor is any holidays."</span>
  (<span style="font-weight: bold;">let*</span> ((date (calendar-cursor-to-date t))
         (calendar-date-display-form '((format <span style="font-style: italic;">"%s&#24180; %s&#26376; %s&#26085;&#65288;%s&#65289;"</span> year month day dayname)))
         (date-string (calendar-date-string date))
         (holiday-list (calendar-check-holidays date)))
    (<span style="font-weight: bold;">when</span> holiday-list
      (message <span style="font-style: italic;">"%s: %s"</span> date-string (mapconcat #'identity holiday-list <span style="font-style: italic;">"; "</span>)))))
</pre>
</div>
</div>
</li>
<li><a id="org212eb1a"></a>Package<br />
<div class="outline-text-7" id="text-org212eb1a">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(customize-set-variable 'package-native-compile t)
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="org471033c"></a>Text<br />
<ul class="org-ul">
<li><a id="orgc2d223d"></a>View<br />
<div class="outline-text-7" id="text-orgc2d223d">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package view
  <span style="font-weight: bold;">:diminish</span> view-mode <span style="font-style: italic;">"vw"</span>)
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="orgdadd98d"></a>Hypermedia<br />
<div class="outline-text-6" id="text-orgdadd98d">
</div>
<ul class="org-ul">
<li><a id="orgae06148"></a>Dictionary<br />
<div class="outline-text-7" id="text-orgae06148">
<div class="org-src-container">
<pre class="src src-shell">dictd dict <span style="font-style: italic;">\</span>
      dict-gcide dict-wn <span style="font-style: italic;">\</span>
      dict-jargon dict-foldoc dict-vera <span style="font-style: italic;">\</span>
      dict-freedict-eng-jpn dict-freedict-jpn-eng
</pre>
</div>

<div class="org-src-container">
<pre class="src src-conf">systemctl start dictd
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(customize-set-variable 'dictionary-use-single-buffer t)
(customize-set-variable 'dictionary-server nil)

(<span style="font-weight: bold;">with-eval-after-load</span> 'dictionary
  (<span style="font-weight: bold;">setq</span> switch-to-buffer-obey-display-actions t)
  (add-to-list 'display-buffer-alist
               '(<span style="font-style: italic;">"^\\*Dictionary\\*"</span>
                 display-buffer-in-tab))
  (add-hook 'dictionary-mode-hook
            #'my/lazy-view-enter))
</pre>
</div>
</div>
</li>
</ul>
</li>
</ul>
</li>

<li><a id="org289d208"></a>Input Methods<br />
<div class="outline-text-5" id="text-org289d208">
</div>

<ul class="org-ul">
<li><a id="org5d41574"></a>ddskk<br />
<div class="outline-text-6" id="text-org5d41574">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-ddskk"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-style: italic;">"https://github.com/skk-dev/ddskk/releases.atom"</span> soft_update)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">skk-dir</span> (expand-file-name <span style="font-style: italic;">"skk"</span> my/user-share-directory))
(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">skk-dotemacs-dir</span> (expand-file-name <span style="font-style: italic;">"ddskk"</span> user-emacs-directory-default))

(use-package ddskk
  <span style="font-weight: bold;">:defer</span> t
  <span style="font-weight: bold;">:bind</span> (<span style="font-style: italic;">"C-x j"</span> . skk-mode)
  <span style="font-weight: bold;">:init</span>
  (customize-set-variable 'default-input-method <span style="font-style: italic;">"japanese-skk"</span>)
  (<span style="font-weight: bold;">defface</span> <span style="font-weight: bold; font-style: italic;">skk-candidate</span> `((t . (<span style="font-weight: bold;">:font</span> <span style="font-style: italic;">"fontset-default"</span>
                                       <span style="font-weight: bold;">:height</span> ,(my/normalized-font-size 860))))
    <span style="font-style: italic;">"Default face for ddskk candidates."</span>
    <span style="font-weight: bold;">:group</span> 'skk-dcomp)
  <span style="font-weight: bold;">:custom</span>
  (skk-kakutei-key (kbd <span style="font-style: italic;">"C-x j"</span>))
  (skk-user-directory (expand-file-name <span style="font-style: italic;">"ddskk"</span> user-emacs-directory))
  (skk-init-file (expand-file-name <span style="font-style: italic;">"skk-init.el"</span> skk-dotemacs-dir))
  (skk-byte-compile-init-file t)
  (skk-tut-file
   (expand-file-name <span style="font-style: italic;">"etc/SKK.tut"</span> (straight--repos-dir <span style="font-style: italic;">"ddskk"</span>)))
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">cursor color</span>
  (skk-use-color-cursor t)
  (skk-cursor-hiragana-color <span style="font-style: italic;">"orange"</span>)
  (skk-cursor-katakana-color <span style="font-style: italic;">"SpringGreen3"</span>)
  (skk-cursor-latin-color <span style="font-style: italic;">"DodgerBlue3"</span>)
  (skk-cursor-jisx0201-color <span style="font-style: italic;">"purple3"</span>)
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">mode line string</span>
  (skk-latin-mode-string <span style="font-style: italic;">"A"</span>)
  (skk-hiragana-mode-string <span style="font-style: italic;">"&#12354;"</span>)
  (skk-katakana-mode-string <span style="font-style: italic;">"&#12450;"</span>)
  (skk-jisx0201-mode-string <span style="font-style: italic;">"&#65393;"</span>)
  (skk-jisx0208-latin-mode-string <span style="font-style: italic;">"&#65313;"</span>)
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">AZIK</span>
  (skk-use-azik t)
  (skk-azik-keyboard-type 'us101)
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">conversion</span>
  (skk-egg-like-newline t)
  (skk-henkan-strict-okuri-precedence t)
  (skk-check-okurigana-on-touroku t)
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">annotation</span>
  (skk-show-annotation t)
  (skk-annotation-delay 0.3)
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">how candidates behave</span>
  (skk-show-candidates-always-pop-to-buffer t)
  (skk-henkan-number-to-display-candidates 10)
  (skk-show-candidates-nth-henkan-char 3)
  (skk-henkan-show-candidates-keys
   '(?1 ?2 ?3 ?4 ?5 ?6 ?7 ?8 ?9 ?0))
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">set face for candidates list</span>
  (skk-treat-candidate-appearance-function
   (<span style="font-weight: bold;">lambda</span> (candidate listing-p)
     (<span style="font-weight: bold;">cond</span>
      ((string-match <span style="font-style: italic;">";"</span> candidate)
       (put-text-property 0 (match-beginning 0)
                          'face 'skk-candidate
                          candidate)
       (put-text-property (match-beginning 0)
                          (length candidate) 'face 'shadow candidate))
      (t
       (put-text-property 0 (length candidate)
                          'face 'skk-candidate
                          candidate)))
     candidate))
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">bind C-q for hankaku-kana input mode</span>
  (skk-use-jisx0201-input-method t)
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">dynamic conversion</span>
  (skk-dcomp-activate nil)
  (skk-dcomp-multiple-activate nil)
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">config file</span>
  (skk-record-file (expand-file-name <span style="font-style: italic;">"record"</span> skk-dir))
  (skk-emacs-id-file (expand-file-name <span style="font-style: italic;">"emacs-id"</span> skk-dir))
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">jisyo</span>
  (skk-share-private-jisyo t)
  (skk-compare-jisyo-size-when-saving t)
  (skk-save-jisyo-instantly t)
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">jisyo file/directory</span>
  (skk-get-jisyo-directory (expand-file-name <span style="font-style: italic;">"get-jisyo"</span> skk-dir))
  (skk-jisyo `(,(expand-file-name <span style="font-style: italic;">"jisyo"</span> skk-dir) . utf-8))
  (skk-backup-jisyo (expand-file-name <span style="font-style: italic;">"jisyo.bak"</span> skk-dir))
  (skk-large-jisyo (expand-file-name <span style="font-style: italic;">"SKK-JISYO.L"</span> skk-get-jisyo-directory))
  (skk-itaiji-jisyo (expand-file-name <span style="font-style: italic;">"SKK-JISYO.itaiji"</span> skk-get-jisyo-directory))
  (skk-extra-jisyo-file-list
   (seq-remove (<span style="font-weight: bold;">lambda</span> (dic)
                 (seq-some (<span style="font-weight: bold;">lambda</span> (suffix)
                             (string-suffix-p (symbol-name suffix) dic))
                           '(L itaiji tar)))
               (append (file-expand-wildcards (expand-file-name <span style="font-style: italic;">"SKK-JISYO.*"</span> skk-get-jisyo-directory))
                       (file-expand-wildcards (expand-file-name <span style="font-style: italic;">"open-jisyo/SKK-JISYO.*"</span> skk-dir)))))
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">jisyo server</span>
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(skk-server-host "localhost")</span>
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(skk-server-portnum 1178)</span>
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(skk-server-inhibit-startup-server t)</span>
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">study</span>
  (skk-study-file (expand-file-name <span style="font-style: italic;">"study"</span> skk-dir))
  (skk-study-backup-file (expand-file-name <span style="font-style: italic;">"study.bak"</span> skk-dir)))
</pre>
</div>
</div>
</li>

<li><a id="org2372df8"></a>skk init file<br />
<div class="outline-text-6" id="text-org2372df8">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">-*- mode:emacs-lisp; -*-</span>
(<span style="font-weight: bold;">setq</span> skk-rom-kana-rule-list
      (append skk-rom-kana-rule-list
              '((<span style="font-style: italic;">"!"</span> nil skk-purge-from-jisyo)
                (<span style="font-style: italic;">"xka"</span> nil (<span style="font-style: italic;">"&#12533;"</span> . <span style="font-style: italic;">"&#12533;"</span>))
                (<span style="font-style: italic;">"xke"</span> nil (<span style="font-style: italic;">"&#12534;"</span> . <span style="font-style: italic;">"&#12534;"</span>))
                (<span style="font-style: italic;">"n"</span> nil nil)
                (<span style="font-style: italic;">"nn"</span> nil (<span style="font-style: italic;">"&#12490;&#12494;"</span> . <span style="font-style: italic;">"&#12394;&#12398;"</span>))
                (<span style="font-style: italic;">"nm"</span> nil (<span style="font-style: italic;">"&#12494;&#12511;"</span> . <span style="font-style: italic;">"&#12398;&#12415;"</span>))
                (<span style="font-style: italic;">"ks"</span> nil (<span style="font-style: italic;">"&#12467;&#12477;"</span> . <span style="font-style: italic;">"&#12371;&#12381;"</span>))
                (<span style="font-style: italic;">"kna"</span> nil (<span style="font-style: italic;">"&#12459;&#12490;"</span> . <span style="font-style: italic;">"&#12363;&#12394;"</span>))
                (<span style="font-style: italic;">"kno"</span> nil (<span style="font-style: italic;">"&#12467;&#12494;"</span> . <span style="font-style: italic;">"&#12371;&#12398;"</span>))
                (<span style="font-style: italic;">"ym"</span> nil (<span style="font-style: italic;">"&#12516;&#12510;"</span> . <span style="font-style: italic;">"&#12420;&#12414;"</span>))
                (<span style="font-style: italic;">"yk"</span> nil (<span style="font-style: italic;">"&#12518;&#12461;"</span> . <span style="font-style: italic;">"&#12422;&#12365;"</span>))
                (<span style="font-style: italic;">"tga"</span> nil (<span style="font-style: italic;">"&#12479;&#12460;"</span> . <span style="font-style: italic;">"&#12383;&#12364;"</span>))
                (<span style="font-style: italic;">"vj"</span> nil (<span style="font-style: italic;">"&#12532;&#12531;"</span> . <span style="font-style: italic;">"&#12406;&#12435;"</span>))
                (<span style="font-style: italic;">"hm"</span> nil (<span style="font-style: italic;">"&#12495;&#12510;"</span> . <span style="font-style: italic;">"&#12399;&#12414;"</span>))
                <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">followings are for preventing from changing to zenkaku eisu mode by pressing 'L'</span>
                (<span style="font-style: italic;">"bL"</span> nil (<span style="font-style: italic;">"&#12508;&#12531;"</span> . <span style="font-style: italic;">"&#12412;&#12435;"</span>))
                (<span style="font-style: italic;">"byL"</span> nil (<span style="font-style: italic;">"&#12499;&#12519;&#12531;"</span> . <span style="font-style: italic;">"&#12403;&#12423;&#12435;"</span>))
                (<span style="font-style: italic;">"cL"</span> nil (<span style="font-style: italic;">"&#12481;&#12519;&#12531;"</span> . <span style="font-style: italic;">"&#12385;&#12423;&#12435;"</span>))
                (<span style="font-style: italic;">"dL"</span> nil (<span style="font-style: italic;">"&#12489;&#12531;"</span> . <span style="font-style: italic;">"&#12393;&#12435;"</span>))
                (<span style="font-style: italic;">"fL"</span> nil (<span style="font-style: italic;">"&#12501;&#12457;&#12531;"</span> . <span style="font-style: italic;">"&#12405;&#12361;&#12435;"</span>))
                (<span style="font-style: italic;">"gL"</span> nil (<span style="font-style: italic;">"&#12468;&#12531;"</span> . <span style="font-style: italic;">"&#12372;&#12435;"</span>))
                (<span style="font-style: italic;">"gyL"</span> nil (<span style="font-style: italic;">"&#12462;&#12519;&#12531;"</span> . <span style="font-style: italic;">"&#12366;&#12423;&#12435;"</span>))
                (<span style="font-style: italic;">"hL"</span> nil (<span style="font-style: italic;">"&#12507;&#12531;"</span> . <span style="font-style: italic;">"&#12411;&#12435;"</span>))
                (<span style="font-style: italic;">"hgL"</span> nil (<span style="font-style: italic;">"&#12498;&#12519;&#12531;"</span> . <span style="font-style: italic;">"&#12402;&#12423;&#12435;"</span>))
                (<span style="font-style: italic;">"hyL"</span> nil (<span style="font-style: italic;">"&#12498;&#12519;&#12531;"</span> . <span style="font-style: italic;">"&#12402;&#12423;&#12435;"</span>))
                (<span style="font-style: italic;">"jL"</span> nil (<span style="font-style: italic;">"&#12472;&#12519;&#12531;"</span> . <span style="font-style: italic;">"&#12376;&#12423;&#12435;"</span>))
                (<span style="font-style: italic;">"kL"</span> nil (<span style="font-style: italic;">"&#12467;&#12531;"</span> . <span style="font-style: italic;">"&#12371;&#12435;"</span>))
                (<span style="font-style: italic;">"kgL"</span> nil (<span style="font-style: italic;">"&#12461;&#12519;&#12531;"</span> . <span style="font-style: italic;">"&#12365;&#12423;&#12435;"</span>))
                (<span style="font-style: italic;">"kyL"</span> nil (<span style="font-style: italic;">"&#12461;&#12519;&#12531;"</span> . <span style="font-style: italic;">"&#12365;&#12423;&#12435;"</span>))
                (<span style="font-style: italic;">"mL"</span> nil (<span style="font-style: italic;">"&#12514;&#12531;"</span> . <span style="font-style: italic;">"&#12418;&#12435;"</span>))
                (<span style="font-style: italic;">"mgL"</span> nil (<span style="font-style: italic;">"&#12511;&#12519;&#12531;"</span> . <span style="font-style: italic;">"&#12415;&#12423;&#12435;"</span>))
                (<span style="font-style: italic;">"myL"</span> nil (<span style="font-style: italic;">"&#12511;&#12519;&#12531;"</span> . <span style="font-style: italic;">"&#12415;&#12423;&#12435;"</span>))
                (<span style="font-style: italic;">"nL"</span> nil (<span style="font-style: italic;">"&#12494;&#12531;"</span> . <span style="font-style: italic;">"&#12398;&#12435;"</span>))
                (<span style="font-style: italic;">"ngL"</span> nil (<span style="font-style: italic;">"&#12491;&#12519;&#12531;"</span> . <span style="font-style: italic;">"&#12395;&#12423;&#12435;"</span>))
                (<span style="font-style: italic;">"nyL"</span> nil (<span style="font-style: italic;">"&#12491;&#12519;&#12531;"</span> . <span style="font-style: italic;">"&#12395;&#12423;&#12435;"</span>))
                (<span style="font-style: italic;">"pL"</span> nil (<span style="font-style: italic;">"&#12509;&#12531;"</span> . <span style="font-style: italic;">"&#12413;&#12435;"</span>))
                (<span style="font-style: italic;">"pgL"</span> nil (<span style="font-style: italic;">"&#12500;&#12519;&#12531;"</span> . <span style="font-style: italic;">"&#12404;&#12423;&#12435;"</span>))
                (<span style="font-style: italic;">"pyL"</span> nil (<span style="font-style: italic;">"&#12500;&#12519;&#12531;"</span> . <span style="font-style: italic;">"&#12404;&#12423;&#12435;"</span>))
                (<span style="font-style: italic;">"rL"</span> nil (<span style="font-style: italic;">"&#12525;&#12531;"</span> . <span style="font-style: italic;">"&#12429;&#12435;"</span>))
                (<span style="font-style: italic;">"ryL"</span> nil (<span style="font-style: italic;">"&#12522;&#12519;&#12531;"</span> . <span style="font-style: italic;">"&#12426;&#12423;&#12435;"</span>))
                (<span style="font-style: italic;">"sL"</span> nil (<span style="font-style: italic;">"&#12477;&#12531;"</span> . <span style="font-style: italic;">"&#12381;&#12435;"</span>))
                (<span style="font-style: italic;">"syL"</span> nil (<span style="font-style: italic;">"&#12471;&#12519;&#12531;"</span> . <span style="font-style: italic;">"&#12375;&#12423;&#12435;"</span>))
                (<span style="font-style: italic;">"tL"</span> nil (<span style="font-style: italic;">"&#12488;&#12531;"</span> . <span style="font-style: italic;">"&#12392;&#12435;"</span>))
                (<span style="font-style: italic;">"tyL"</span> nil (<span style="font-style: italic;">"&#12481;&#12519;&#12531;"</span> . <span style="font-style: italic;">"&#12385;&#12423;&#12435;"</span>))
                (<span style="font-style: italic;">"vL"</span> nil (<span style="font-style: italic;">"&#12532;&#12457;&#12531;"</span> . <span style="font-style: italic;">"&#12358;&#12443;&#12361;&#12435;"</span>))
                (<span style="font-style: italic;">"wL"</span> nil (<span style="font-style: italic;">"&#12454;&#12457;&#12531;"</span> . <span style="font-style: italic;">"&#12358;&#12361;&#12435;"</span>))
                (<span style="font-style: italic;">"xL"</span> nil (<span style="font-style: italic;">"&#12471;&#12519;&#12531;"</span> . <span style="font-style: italic;">"&#12375;&#12423;&#12435;"</span>))
                (<span style="font-style: italic;">"xxL"</span> nil (<span style="font-style: italic;">"&#8594;"</span> . <span style="font-style: italic;">"&#8594;"</span>))
                (<span style="font-style: italic;">"yL"</span> nil (<span style="font-style: italic;">"&#12520;&#12531;"</span> . <span style="font-style: italic;">"&#12424;&#12435;"</span>))
                (<span style="font-style: italic;">"zL"</span> nil (<span style="font-style: italic;">"&#12478;&#12531;"</span> . <span style="font-style: italic;">"&#12382;&#12435;"</span>))
                (<span style="font-style: italic;">"zyL"</span> nil (<span style="font-style: italic;">"&#12472;&#12519;&#12531;"</span> . <span style="font-style: italic;">"&#12376;&#12423;&#12435;"</span>)))))

(add-hook 'skk-azik-load-hook
          (<span style="font-weight: bold;">lambda</span> ()
            (<span style="font-weight: bold;">dolist</span> (key '(<span style="font-style: italic;">"kA"</span> <span style="font-style: italic;">"kE"</span> <span style="font-style: italic;">"tU"</span> <span style="font-style: italic;">"wA"</span>))
              (<span style="font-weight: bold;">setq</span> skk-rom-kana-rule-list
                    (skk-del-alist key skk-rom-kana-rule-list)))))
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="orgdf91d83"></a>Themes<br />
<div class="outline-text-5" id="text-orgdf91d83">
</div>
<ul class="org-ul">
<li><a id="org88190c5"></a>modus-themes<br />
<div class="outline-text-6" id="text-org88190c5">
<p>
I love modus-theme which <a href="https://protesilaos.com/codelog/2019-08-07-emacs-modus-themes/">conforms to WCAG AAA</a>
<a href="https://protesilaos.com/codelog/2022-04-21-modus-themes-colour-theory/">This blog post</a> explains how the package determines colors theoretically and perceptually.
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-modus-themes"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package modus-themes
  <span style="font-weight: bold;">:init</span>
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Add all your customizations prior to loading the themes</span>
  (<span style="font-weight: bold;">setq</span> modus-themes-region '(bg-only no-extend)
        modus-themes-bold-constructs t
        modus-themes-italic-constructs t
        modus-themes-paren-match '(bold intense underline)
        modus-themes-syntax '(alt-syntax)
        modus-themes-headings
        '(((1 . (background overline background 1.0))
           (2 . (overline rainbow 1.0))
           (3 . (overline 1.0))
           (t . (monochrome))))
        modus-themes-org-blocks 'tinted-background)
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Load the theme files before enabling a theme</span>
  (modus-themes-load-themes)
  <span style="font-weight: bold;">:config</span>
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Load the theme of your choice:</span>
  (modus-themes-load-vivendi)
  <span style="font-weight: bold;">:bind</span> (<span style="font-style: italic;">"&lt;f6&gt;"</span> . modus-themes-toggle))
</pre>
</div>
</div>
</li>
</ul>
</li>
<li><a id="org50bafbb"></a>Dired<br />
<div class="outline-text-5" id="text-org50bafbb">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package dired
  <span style="font-weight: bold;">:bind</span> (<span style="font-weight: bold;">:map</span> dired-mode-map
              <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">workaround against dired-find-file for cdr</span>
              (<span style="font-style: italic;">"C-j"</span> . (<span style="font-weight: bold;">lambda</span> ()
                         (<span style="font-weight: bold;">interactive</span>)
                         (call-interactively #'dired-find-file)))
              (<span style="font-style: italic;">"^"</span> . dired-up-directory)
              (<span style="font-style: italic;">"("</span> . dired-hide-details-mode)
              (<span style="font-style: italic;">")"</span> . dired-hide-details-mode)
              (<span style="font-style: italic;">"E"</span> . dired-create-empty-file)
              (<span style="font-style: italic;">"Y"</span> . dired-do-relsymlink)
              (<span style="font-style: italic;">"e"</span> . wdired-change-to-wdired-mode)
              (<span style="font-style: italic;">"C-o"</span> . nil)
              (<span style="font-style: italic;">"o"</span> . dired-open-file)
              (<span style="font-style: italic;">"C-c C-o"</span> . dired-open-file)
              (<span style="font-style: italic;">"C-c C-s"</span> . my/dired-share))
  <span style="font-weight: bold;">:hook</span> (dired-mode . dired-hide-details-mode)
  <span style="font-weight: bold;">:custom</span>
  (dired-kill-when-opening-new-dired-buffer t)
  (dired-do-revert-buffer t)
  (dired-auto-revert-buffer t)
  (dired-copy-dereference t)
  (dired-recursive-copies 'always)
  (dired-recursive-deletes 'top)
  (dired-listing-switches <span style="font-style: italic;">"-ahgG --time-style=iso --group-directories-first"</span>)
  (dired-dwim-target 'dired-dwim-target-recent)
  (dired-hide-details-hide-information-lines nil)
  (dired-compress-file-default-suffix <span style="font-style: italic;">".zst"</span>)
  (dired-isearch-filenames t)
  (dired-open-use-nohup t)
  (dired-open-query-before-exit nil)
  (completion-ignored-extensions nil)
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">dired-x</span>)
  (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">dired-open</span>)
  (advice-add #'dired-do-delete <span style="font-weight: bold;">:around</span> #'my/advice-dired-control-deletion)
  (advice-add #'dired-do-flagged-delete <span style="font-weight: bold;">:around</span> #'my/advice-dired-control-deletion)
  (put 'dired-find-alternate-file 'disabled nil))

(use-package dired-aux
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">setq</span> dired-compress-files-alist
        (append dired-compress-files-alist
                '((<span style="font-style: italic;">"\\.tar\\.7z\\'"</span> . <span style="font-style: italic;">"tar cf - %i | 7z a -si %o"</span>)
                  (<span style="font-style: italic;">"\\.7z\\'"</span> . <span style="font-style: italic;">"7z a %o %i"</span>))))
  (add-to-list 'dired-compress-file-suffixes
               '(<span style="font-style: italic;">"\\.tar\\.7z\\'"</span> <span style="font-style: italic;">""</span> <span style="font-style: italic;">"7z x -so %i | tar xf -"</span>)))

(use-package dired-async
  <span style="font-weight: bold;">:config</span>
  (dired-async-mode 1))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/advice-dired-control-deletion</span> (oldfun <span style="font-weight: bold; text-decoration: underline;">&amp;rest</span> r)
  <span style="font-style: italic;">"Enable file deleting functions to control deleting procedure</span>
<span style="font-style: italic;">whether files are going to be in trash box."</span>
  (<span style="font-weight: bold;">let</span> ((delete-by-moving-to-trash
         (<span style="font-weight: bold;">if</span> (equal current-prefix-arg '(4))
             nil t)))
    (apply oldfun (cdr r))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/dired-share</span> ()
  <span style="font-style: italic;">"Share file with remote device via KDE Connect."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">let</span> ((files (dired-get-marked-files nil nil)))
    (mapc (<span style="font-weight: bold;">lambda</span> (file)
            (shell-command
             (mapconcat 'identity
                        (list <span style="font-style: italic;">"kdeconnect-cli"</span> <span style="font-style: italic;">"-d"</span> <span style="font-style: italic;">"a30587ededf4c2d2"</span>
                              <span style="font-style: italic;">"--share"</span> (shell-quote-argument
                                         file)) <span style="font-style: italic;">" "</span>)))
          files)))
</pre>
</div>
</div>
<ul class="org-ul">
<li><a id="org5e11b2b"></a>dired-rsync<br />
<div class="outline-text-6" id="text-org5e11b2b">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-dired-rsync"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package dired-rsync
  <span style="font-weight: bold;">:after</span> dired
  <span style="font-weight: bold;">:bind</span> (<span style="font-weight: bold;">:map</span> dired-mode-map
              (<span style="font-style: italic;">"C-c C-r"</span> . dired-rsync))
  <span style="font-weight: bold;">:custom</span>
  (dired-rsync-options <span style="font-style: italic;">"-auz --info=progress2"</span>))
</pre>
</div>
</div>
</li>

<li><a id="orgd822af3"></a>dired-single&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span><br /></li>

<li><a id="org44424ad"></a>dired-hacks<br />
<div class="outline-text-6" id="text-org44424ad">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-dired-hacks"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package dired-subtree
  <span style="font-weight: bold;">:after</span> dired
  <span style="font-weight: bold;">:bind</span> (<span style="font-weight: bold;">:map</span> dired-mode-map
              (<span style="font-style: italic;">"TAB"</span> . dired-subtree-cycle)))

(use-package dired-narrow
  <span style="font-weight: bold;">:after</span> dired
  <span style="font-weight: bold;">:bind</span>
  (<span style="font-weight: bold;">:map</span> dired-mode-map
        (<span style="font-style: italic;">"z"</span> . dired-narrow))
  (<span style="font-weight: bold;">:map</span> dired-narrow-map
        (<span style="font-style: italic;">"C-j"</span> . exit-minibuffer)))
</pre>
</div>
</div>
</li>

<li><a id="orgd4fc07a"></a>dired-hide-dotfiles<br />
<div class="outline-text-6" id="text-orgd4fc07a">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-style: italic;">"https://github.com/mattiasb/dired-hide-dotfiles/releases.atom"</span> soft_update)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package dired-hide-dotfiles
  <span style="font-weight: bold;">:straight</span> t
  <span style="font-weight: bold;">:after</span> dired
  <span style="font-weight: bold;">:bind</span> (<span style="font-weight: bold;">:map</span> dired-mode-map
              (<span style="font-style: italic;">","</span> . dired-clean-directory)
              (<span style="font-style: italic;">"."</span> . dired-hide-dotfiles-mode))
  <span style="font-weight: bold;">:config</span>
  (dired-hide-dotfiles-mode -1))
</pre>
</div>
</div>
</li>

<li><a id="orge6a1779"></a>find-dired<br />
<div class="outline-text-6" id="text-orge6a1779">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package find-dired
  <span style="font-weight: bold;">:custom</span>
  (find-grep-options <span style="font-style: italic;">"-n -H --no-heading -q"</span>)
  (find-ls-option '(<span style="font-style: italic;">"-print0 | xargs -0 ls -ldN"</span> . <span style="font-style: italic;">"-ldN"</span>)))

(<span style="font-weight: bold;">with-eval-after-load</span> 'hydra
  (defhydra hydra-find-dired (global-map <span style="font-style: italic;">"M-s d"</span>
                                         <span style="font-weight: bold;">:color</span> teal)
    <span style="font-style: italic;">"find dired"</span>
    (<span style="font-style: italic;">"f"</span> find-dired)
    (<span style="font-style: italic;">"F"</span> find-lisp-find-dired)
    (<span style="font-style: italic;">"g"</span> find-grep-dired)
    (<span style="font-style: italic;">"n"</span> find-name-dired)
    (<span style="font-style: italic;">"d"</span> find-lisp-find-dired-subdirectories)
    (<span style="font-style: italic;">"q"</span> nil <span style="font-style: italic;">"quit"</span>)))
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="org665e239"></a>EWW<br />
<div class="outline-text-5" id="text-org665e239">
<div class="org-src-container">
<pre class="src src-conf">d &lt;&lt;share-dir()&gt;&gt;/emacs/eww-view-in-org 0755 - - 3d
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">with-eval-after-load</span> 'shr
  (customize-set-variable 'shr-width 10000)
  (customize-set-variable 'shr-use-fonts nil)
  (customize-set-variable 'shr-image-animate t)
  (customize-set-variable 'shr-use-colors nil)
  (customize-set-variable 'shr-max-image-proportion 0.4)
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">never use cookies</span>
  (customize-set-variable 'shr-cookie-policy nil))

(use-package eww
  <span style="font-weight: bold;">:delight</span> <span style="font-style: italic;">" EW"</span>
  <span style="font-weight: bold;">:defer</span> t
  <span style="font-weight: bold;">:hook</span>
  (eww-after-render . my/eww-rename-buffer)
  <span style="font-weight: bold;">:custom</span>
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">set enough large column number to prevent from inserting line break</span>
  (eww-header-line-format nil)
  <span style="font-weight: bold;">:config</span>
  (bind-keys <span style="font-weight: bold;">:map</span> eww-mode-map
             (<span style="font-style: italic;">"C"</span> . eww-set-character-encoding)
             (<span style="font-style: italic;">"C-j"</span> . eww-follow-link)
             (<span style="font-style: italic;">"T"</span> . eww-goto-title-heading)
             (<span style="font-style: italic;">"L"</span> . my/eww-goto-heading)
             (<span style="font-style: italic;">"O"</span> . my/eww-view-in-org)
             <span style="font-weight: bold;">:map</span> eww-bookmark-mode-map
             (<span style="font-style: italic;">"C-j"</span> . eww-bookmark-browse)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/eww-rename-buffer</span> ()
  <span style="font-style: italic;">"Rename the name of current EWW buffer.</span>

<span style="font-style: italic;">If associated HTML file have a title tag, use title as a buffer name.</span>
<span style="font-style: italic;">Otherwise, use a current URL."</span>
  (<span style="font-weight: bold;">let</span> ((title (plist-get eww-data <span style="font-weight: bold;">:title</span>))
        (url (file-name-base (eww-current-url))))
    (rename-buffer (format <span style="font-style: italic;">"eww: %s"</span> (<span style="font-weight: bold;">or</span> (<span style="font-weight: bold;">if</span> (<span style="font-weight: bold;">and</span> title (&gt; (length title) 0))
                                             title nil)
                                         url <span style="font-style: italic;">""</span>)) <span style="font-weight: bold;">t)))</span>

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/eww-view-in-org</span> ()
  <span style="font-style: italic;">"Convert current html page into one org file and show it.</span>

<span style="font-style: italic;">This is handy if you would like to check a page index comfortably."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">let</span> ((source (plist-get eww-data <span style="font-weight: bold;">:source</span>))
        (src-html (make-temp-file <span style="font-style: italic;">"source-"</span>))
        (dst-org (file-name-concat user-emacs-directory
                                   <span style="font-style: italic;">"eww-view-in-org"</span>
                                   (format <span style="font-style: italic;">"%s.org"</span> (org-id-uuid))))
        (coding-system-for-write 'utf-8-unix)
        (org-startup-folded t))
    (<span style="font-weight: bold;">with-temp-buffer</span>
      (insert source)
      (make-directory
       (file-name-directory (directory-file-name dst-org)) t)
      (write-region (point-min) (point-max) src-html nil)
      (call-process-shell-command (format <span style="font-style: italic;">"pandoc %s -f html -t org -o %s"</span>
                                          (shell-quote-argument src-html)
                                          (shell-quote-argument dst-org)))
      (delete-file src-html))
    (find-file dst-org t)
    (goto-char (point-min))
    (org-ctrl-c-tab)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">eww-headings-dom</span> ()
  <span style="font-style: italic;">"Return heading list as a dom from xml."</span>
  (<span style="font-weight: bold;">let</span> ((source (plist-get eww-data <span style="font-weight: bold;">:source</span>))
        (dom nil))
    (<span style="font-weight: bold;">with-temp-buffer</span>
      (<span style="font-weight: bold;">let</span> ((source-file (make-temp-file <span style="font-style: italic;">"source-"</span>))
            (coding-system-for-write 'utf-8-unix))
        (insert source)
        (write-region (point-min) (point-max) source-file nil)
        (erase-buffer)
        (call-process <span style="font-style: italic;">"extract_headings"</span> source-file t)
        (delete-file source-file)
        (libxml-parse-xml-region (point-min) (point-max))))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">eww-goto-title-heading</span> ()
  <span style="font-style: italic;">"Set point to a line which contaings the possible heading."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (when-let* ((headings-dom (eww-headings-dom))
              (possible-heading (cl-reduce (<span style="font-weight: bold;">lambda</span> (node-a node-b)
                                             (<span style="font-weight: bold;">if</span> (not (<span style="font-weight: bold;">bound-and-true-p</span> node-a))
                                                 (<span style="font-weight: bold;">if</span> (not (<span style="font-weight: bold;">bound-and-true-p</span> node-b))
                                                     nil
                                                   node-b)
                                               (<span style="font-weight: bold;">if</span> (&gt;= (string-to-number (<span style="font-weight: bold;">dom-attr</span> node-a 'proximity))
                                                       (string-to-number (<span style="font-weight: bold;">dom-attr</span> node-b 'proximity)))
                                                   node-a node-b)))
                                           (dom-children headings-dom)
                                           <span style="font-weight: bold;">:initial-value</span> nil))
              (possible-text (dom-text possible-heading))
              (match-pos (<span style="font-weight: bold;">or</span> (re-search-forward (format <span style="font-style: italic;">"^*?[[:blank:]]*%s[[:blank:]]*$"</span> (regexp-quote possible-text)) nil t 1)
                             (re-search-backward (format <span style="font-style: italic;">"^*?[[:blank:]]*%s[[:blank:]]*$"</span> (regexp-quote possible-text)) nil t 1))))
    (beginning-of-line)
    (recenter-top-bottom 0)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/eww-goto-heading</span> ()
  <span style="font-style: italic;">"Go to selected heading line."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">setq</span> lexical-binding t)
  (when-let* ((headings-root (eww-headings-dom))
              (cur-buf (current-buffer))
              (heading (completing-read
                        <span style="font-style: italic;">"Heading : "</span>
                        (mapcar (<span style="font-weight: bold;">lambda</span> (heading-node)
                                  (when-let* ((heading (dom-text heading-node))
                                              (tag (symbol-name (dom-tag heading-node)))
                                              (match-pos (string-match <span style="font-style: italic;">"h</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">[1-6]\\{1\\}</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">"</span> tag))
                                              (indent (- (string-to-number (match-string 1 tag)) 1)))
                                    (format <span style="font-style: italic;">"%s%s"</span>
                                            (apply 'concat (make-list indent <span style="font-style: italic;">"  "</span>))
                                            heading)))
                                (dom-children headings-root))))
              (match (string-match <span style="font-style: italic;">"</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(?:</span><span style="font-style: italic;">  </span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">*</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">.*</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">"</span> heading))
              (heading (match-string 1 heading))
              (match-pos (<span style="font-weight: bold;">or</span> (re-search-forward (build-regex heading) nil t 1)
                             (re-search-backward (build-regex heading) nil t 1))))
    (<span style="font-weight: bold;">with-current-buffer</span> cur-buf
      (switch-to-buffer cur-buf)
      (beginning-of-line)
      (recenter-top-bottom 0))))

(<span style="font-weight: bold;">defmacro</span> <span style="font-weight: bold;">build-regex</span> (str)
  <span style="font-style: italic;">"Return a regexp representation for `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">STR</span><span style="font-style: italic;">'."</span>
  `(format <span style="font-style: italic;">"^[[:blank:]SVG Image]*%s[[:blank:]]*$"</span>
           ,str))
</pre>
</div>
</div>

<ul class="org-ul">
<li><a id="org6f5ac00"></a>extract<sub>headings</sub><br />
<div class="outline-text-6" id="text-org6f5ac00">
<div class="org-src-container">
<pre class="src src-python"><span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">!/usr/bin/env python3</span>

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">This script extract most probable page heading.</span>

<span style="font-weight: bold;">import</span> sys
<span style="font-weight: bold;">import</span> lxml.html <span style="font-weight: bold;">as</span> html
<span style="font-weight: bold;">from</span> lxml <span style="font-weight: bold;">import</span> etree
<span style="font-weight: bold;">import</span> difflib

<span style="font-weight: bold;">if</span> <span style="font-weight: bold;">len</span>(sys.argv) == 1:
    <span style="font-weight: bold; font-style: italic;">INPUT_STR</span> = sys.stdin.read()
    <span style="font-weight: bold; font-style: italic;">ROOT</span> = html.fromstring(INPUT_STR).getroottree()
<span style="font-weight: bold;">else</span>:
    sys.<span style="font-weight: bold; text-decoration: underline;">exit</span>(1)

<span style="font-weight: bold; font-style: italic;">OUT_ROOT</span> = etree.Element(<span style="font-style: italic;">"headings"</span>)

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">extract title text</span>
<span style="font-weight: bold; font-style: italic;">title</span> = <span style="font-style: italic;">''</span>
<span style="font-weight: bold; font-style: italic;">title_text_arr</span> = ROOT.xpath(<span style="font-style: italic;">'//title[1]//text()'</span>)
<span style="font-weight: bold;">if</span> <span style="font-weight: bold;">len</span>(title_text_arr):
    <span style="font-weight: bold; font-style: italic;">title</span> = title_text_arr[0]
    OUT_ROOT.<span style="font-weight: bold;">set</span>(<span style="font-style: italic;">"title"</span>, title.strip())

<span style="font-weight: bold; font-style: italic;">htag_text_arr</span> = ROOT.xpath(<span style="font-style: italic;">'//*[self::h1 or self::h2 or self::h3 or self::h4 or self::h5 or self::h6]'</span>)
<span style="font-weight: bold;">for</span> i <span style="font-weight: bold;">in</span> <span style="font-weight: bold;">range</span>(<span style="font-weight: bold;">len</span>(htag_text_arr)):
    <span style="font-weight: bold; font-style: italic;">text</span> = <span style="font-style: italic;">''</span>
    <span style="font-weight: bold; font-style: italic;">texts</span> = htag_text_arr[i].xpath(<span style="font-style: italic;">'.//text()'</span>)
    <span style="font-weight: bold;">if</span> <span style="font-weight: bold;">len</span>(texts) == 1:
        <span style="font-weight: bold; font-style: italic;">text</span> = texts[0].strip()
    <span style="font-weight: bold;">elif</span> <span style="font-weight: bold;">len</span>(texts) &gt; 1:
        <span style="font-weight: bold; font-style: italic;">text</span> = <span style="font-style: italic;">''</span>.join(<span style="font-weight: bold;">map</span>(<span style="font-weight: bold;">str</span>.strip, texts))
    <span style="font-weight: bold;">else</span>:
        <span style="font-weight: bold;">continue</span>
    <span style="font-weight: bold; font-style: italic;">proximity</span> = difflib.SequenceMatcher(<span style="font-weight: bold; text-decoration: underline;">None</span>, title, text).ratio()
    <span style="font-weight: bold; font-style: italic;">heading</span> = etree.Element(htag_text_arr[i].tag)
    <span style="font-weight: bold; font-style: italic;">heading.text</span> = text
    heading.<span style="font-weight: bold;">set</span>(<span style="font-style: italic;">'proximity'</span>, <span style="font-weight: bold;">str</span>(proximity))
    OUT_ROOT.append(heading)

<span style="font-weight: bold; font-style: italic;">out_root_str</span> = etree.tostring(OUT_ROOT, encoding=<span style="font-style: italic;">'utf-8'</span>, method=<span style="font-style: italic;">'xml'</span>, pretty_print=<span style="font-weight: bold; text-decoration: underline;">True</span>)
<span style="font-weight: bold;">if</span> <span style="font-weight: bold;">type</span>(out_root_str) <span style="font-weight: bold;">is</span> <span style="font-weight: bold;">bytes</span>:
    <span style="font-weight: bold; font-style: italic;">out_root_str</span> = out_root_str.decode()
    <span style="font-weight: bold;">print</span>(out_root_str)
</pre>
</div>
</div>
</li>
</ul>
</li>
<li><a id="org3ccbc89"></a>Info<br />
<div class="outline-text-5" id="text-org3ccbc89">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">with-eval-after-load</span> 'info
  (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">info-look</span>)
  (autoload 'info-lookup-add-help <span style="font-style: italic;">"info-look"</span>)
  (customize-set-variable 'Info-use-header-line nil)
  (customize-set-variable
   'Info-additional-directory-list
   `(,(expand-file-name <span style="font-style: italic;">"~/.local/share/info"</span>)
     ,@(<span style="font-weight: bold;">let</span> ((guix-custom-dir <span style="font-style: italic;">"~/.guix-extra-profiles"</span>)
             custom-info-path)
         (remq nil (mapcar (<span style="font-weight: bold;">lambda</span> (prof)
                             (<span style="font-weight: bold;">setq</span> custom-info-path (file-name-concat guix-custom-dir prof prof <span style="font-style: italic;">"share/info"</span>))
                             (<span style="font-weight: bold;">when</span> (file-directory-p custom-info-path)
                               custom-info-path))
                           (directory-files guix-custom-dir))))))
  (define-key Info-mode-map (kbd <span style="font-style: italic;">"C-j"</span>) #'Info-follow-nearest-node)
  (define-key Info-mode-map (kbd <span style="font-style: italic;">"a"</span>) #'info-apropos))
</pre>
</div>
</div>
</li>

<li><a id="org3988305"></a>Magit<br />
<div class="outline-text-5" id="text-org3988305">
<p>
<a href="https://github.com/magit/magit">Magit</a> is git front end for emacs which is outstandingly powerful.
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-magit"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-style: italic;">"https://github.com/magit/magit/releases.atom"</span> soft_update)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package magit
  <span style="font-weight: bold;">:delight</span>
  (magit-status-mode <span style="font-style: italic;">" MG"</span>)
  (magit-revision-mode <span style="font-style: italic;">" MG"</span>)
  <span style="font-weight: bold;">:bind</span> (<span style="font-weight: bold;">:map</span> magit-status-mode-map
              (<span style="font-style: italic;">"C-j"</span> . magit-visit-thing)
              (<span style="font-style: italic;">"/"</span>   . magit-file-checkout)
              (<span style="font-style: italic;">";"</span>   . magit-list-repositories)
              <span style="font-weight: bold;">:map</span> magit-log-mode-map
              (<span style="font-style: italic;">"C-j"</span> . magit-visit-thing)
              <span style="font-weight: bold;">:map</span> magit-repolist-mode-map
              (<span style="font-style: italic;">"C-j"</span> . magit-repolist-status))
  <span style="font-weight: bold;">:custom</span>
  (magit-repository-directories '((<span style="font-style: italic;">"~/git"</span> . 1))))
</pre>
</div>
</div>

<ul class="org-ul">
<li><a id="orgf88dd76"></a>git-modes<br />
<div class="outline-text-6" id="text-orgf88dd76">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-git-modes"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package git-modes)
</pre>
</div>
</div>
</li>

<li><a id="org5a1a3b9"></a>orgit<br />
<div class="outline-text-6" id="text-org5a1a3b9">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-orgit"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package orgit
  <span style="font-weight: bold;">:after</span> (magit org)
  <span style="font-weight: bold;">:custom</span>
  (orgit-remote <span style="font-style: italic;">"github"</span>))
</pre>
</div>
</div>
</li>

<li><a id="org6c5503f"></a>git-annex<br />
<div class="outline-text-6" id="text-org6c5503f">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-git-annex"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-style: italic;">"https://github.com/jwiegley/git-annex-el/releases.atom"</span> soft_update)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package git-annex
  <span style="font-weight: bold;">:custom-face</span>
  (git-annex-dired-annexed-available ((t (<span style="font-weight: bold;">:foreground</span> <span style="font-style: italic;">"green yellow"</span>))))
  (git-annex-dired-annexed-unavailable ((t (<span style="font-weight: bold;">:foreground</span> <span style="font-style: italic;">"red3"</span>)))))
</pre>
</div>
</div>
</li>

<li><a id="orgde24d65"></a>magit-annex<br />
<div class="outline-text-6" id="text-orgde24d65">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-magit-annex"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-style: italic;">"https://github.com/magit/magit-annex/releases.atom"</span> soft_update)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package magit-annex)
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="orgf9a5cec"></a>Mu4e<br />
<div class="outline-text-5" id="text-orgf9a5cec">
<p>
You need to <a href="https://www.djcbsoftware.nl/code/mu/mu4e/Initializing-the-message-store.html">issue 'mu init' command</a> before using mu4e.
Command in practice presumably looks like:
</p>
<pre class="example">
mu init --maildir=~/data/share/mail --muhome=~/data/share/mu --my-address=jim@example.com --my-address=bob@example.com

</pre>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"mu"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package mu4e
  <span style="font-weight: bold;">:delight</span>
  (mu4e-main-mode    <span style="font-style: italic;">" MU"</span>)
  (mu4e-headers-mode <span style="font-style: italic;">" MU"</span>)
  (mu4e-view-mode    <span style="font-style: italic;">" MU"</span>)
  (mu4e-compose-mode <span style="font-style: italic;">" MU"</span>)
  <span style="font-weight: bold;">:custom</span>
  (mail-user-agent 'mu4e-user-agent)
  (mu4e-hide-index-messages t)
  (mu4e-context-policy 'pick-first)
  (mu4e-compose-context-policy 'ask)
  (mu4e-update-interval 300)
  (mu4e-split-view t)
  (mu4e-headers-date-format <span style="font-style: italic;">"%y%m%d"</span>)
  (mu4e-headers-time-format <span style="font-style: italic;">" %R"</span>)
  (mu4e-headers-fields
   '((<span style="font-weight: bold;">:human-date</span> . 6)
     (<span style="font-weight: bold;">:flags</span>      . 3)
     (<span style="font-weight: bold;">:from</span>       . 16)
     (<span style="font-weight: bold;">:subject</span>)))
  (mu4e-headers-results-limit 1000)
  (mu4e-headers-advance-after-mark t)
  (mu4e-change-filenames-when-moving t)
  (mu4e-view-show-images t)
  (mu4e-html2text-command (<span style="font-weight: bold;">lambda</span> (msg)
                            (plist-put msg <span style="font-weight: bold;">:body-html</span>
                                       (<span style="font-weight: bold;">with-temp-buffer</span>
                                         (insert (<span style="font-weight: bold;">or</span> (mu4e-message-field msg <span style="font-weight: bold;">:body-html</span>) <span style="font-style: italic;">""</span>))
                                         (shell-command-on-region (point-min) (point-max) <span style="font-style: italic;">"nkf -w -Lu"</span> (current-buffer) t)
                                         (<span style="font-weight: bold;">or</span> (buffer-string) <span style="font-style: italic;">""</span>)))
                            (mu4e-shr2text msg)))
  (message-send-mail-function 'smtpmail-send-it)
  (mm-sign-option nil)
  (mml-secure-openpgp-sign-with-sender t)
  (mml-default-sign-method 'pgpmime)
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">mu4e</span>)
  (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">org-mu4e</span>)
  (bind-keys <span style="font-weight: bold;">:map</span> mu4e-headers-mode-map
             (<span style="font-style: italic;">"C-j"</span> . mu4e-headers-view-message)
             <span style="font-weight: bold;">:map</span> mu4e-view-mode-map
             (<span style="font-style: italic;">"C-j"</span> . push-button)
             (<span style="font-style: italic;">"C-c C-a"</span> . mu4e-view-attachment-action)
             <span style="font-weight: bold;">:map</span> mu4e-compose-mode-map
             (<span style="font-style: italic;">"C-x C-o"</span> . org-mu4e-compose-org-mode))
  (add-to-list 'mu4e-view-actions
               '(<span style="font-style: italic;">"external browser"</span> . mu4e-action-view-in-browser) t)
  (add-to-list 'mu4e-view-actions
               '(<span style="font-style: italic;">"XWidget View"</span> . mu4e-action-view-with-xwidget) t)
  (<span style="font-weight: bold;">when</span> (fboundp 'imagemagick-register-types)
    (imagemagick-register-types))
  (add-hook 'after-init-hook (<span style="font-weight: bold;">lambda</span> () (mu4e t))))
</pre>
</div>
</div>

<ul class="org-ul">
<li><a id="orgf23de45"></a>mu4e-alert<br />
<div class="outline-text-6" id="text-orgf23de45">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-mu4e-alert"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package mu4e-alert
  <span style="font-weight: bold;">:commands</span> mu4e-alert-view-unread-mails
  <span style="font-weight: bold;">:defer</span> 5
  <span style="font-weight: bold;">:custom</span>
  (mu4e-alert-modeline-formatter
   (<span style="font-weight: bold;">lambda</span> (count)
     (<span style="font-weight: bold;">if</span> (&gt; count 0)
         (format <span style="font-style: italic;">" M:%d"</span> count)
       <span style="font-style: italic;">""</span>)))
  <span style="font-weight: bold;">:config</span>
  (mu4e-alert-set-default-style 'fringe)
  (mu4e-alert-enable-notifications)
  (mu4e-alert-enable-mode-line-display))
</pre>
</div>
</div>
</li>

<li><a id="orgc33403c"></a>additional tweaks<br />
<div class="outline-text-6" id="text-orgc33403c">
<ul class="org-ul">
<li><p>
file attachment in dired (<a href="https://www.djcbsoftware.nl/code/mu/mu4e/Dired.html">source</a>)
</p>
<pre class="example">
gnus-dired-attach (C-c RET C-a)

</pre>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package gnus-dired
  <span style="font-weight: bold;">:after</span> mu4e-compose
  <span style="font-weight: bold;">:hook</span>
  (dired-mode . turn-on-gnus-dired-mode)
  <span style="font-weight: bold;">:custom</span>
  (gnus-dired-mail-mode 'mu4e-user-agent))
</pre>
</div></li>

<li><p>
use contact info from org-contacts
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package mu4e-actions
  <span style="font-weight: bold;">:after</span> (mu4e org-contacts)
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">setq</span> mu4e-org-contacts-file (car org-contacts-files))
  (add-to-list 'mu4e-headers-actions
               '(<span style="font-style: italic;">"Contact to add"</span> . mu4e-action-add-org-contact) t)
  (add-to-list 'mu4e-view-actions
               '(<span style="font-style: italic;">"Contact to add"</span> . mu4e-action-add-org-contact) t))
</pre>
</div></li>
</ul>
</div>
</li>
</ul>
</li>

<li><a id="org807af3e"></a>Elfeed<br />
<div class="outline-text-5" id="text-org807af3e">
<p>
<a href="https://github.com/skeeto/elfeed">Elfeed</a> is a powerful RSS feed reader with tag capability that is one of core software in my input workflow.
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-elfeed"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-style: italic;">"https://github.com/skeeto/elfeed/releases.atom"</span> soft_update)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package elfeed
  <span style="font-weight: bold;">:delight</span>
  (elfeed-show-mode   <span style="font-style: italic;">" EF"</span>)
  (elfeed-search-mode <span style="font-style: italic;">" EF"</span>)
  <span style="font-weight: bold;">:commands</span> (elfeed)
  <span style="font-weight: bold;">:init</span>
  (<span style="font-weight: bold;">defface</span> <span style="font-weight: bold; font-style: italic;">elfeed-search-unchecked-title-face</span>
    nil
    <span style="font-style: italic;">"Face used in search mode for unchecked entry titles."</span>
    <span style="font-weight: bold;">:group</span> 'elfeed)
  (<span style="font-weight: bold;">defface</span> <span style="font-weight: bold; font-style: italic;">elfeed-search-checked-title-face</span>
    nil
    <span style="font-style: italic;">"Face used in search mode for checked entry titles."</span>
    <span style="font-weight: bold;">:group</span> 'elfeed)
  <span style="font-weight: bold;">:custom-face</span>
  (elfeed-search-title-face ((t (<span style="font-weight: bold;">:foreground</span> <span style="font-style: italic;">"#4D4D4D"</span>))))
  (elfeed-search-unchecked-title-face ((t (<span style="font-weight: bold;">:foreground</span> <span style="font-style: italic;">"cornflowerblue"</span>))))
  (elfeed-search-checked-title-face ((t (<span style="font-weight: bold;">:foreground</span> <span style="font-style: italic;">"darkblue"</span>))))
  <span style="font-weight: bold;">:custom</span>
  (elfeed-use-curl t)
  (elfeed-db-directory (expand-file-name <span style="font-style: italic;">"elfeed"</span> user-emacs-directory))
  (elfeed-search-date-format '(<span style="font-style: italic;">"%Y%m%d"</span> 8 <span style="font-weight: bold;">:left</span>))
  (elfeed-search-title-min-width 100)
  (elfeed-search-title-max-width 120)
  (elfeed-search-trailing-width 160)
  (elfeed-sort-order 'ascending)
  (elfeed-enclosure-default-dir <span style="font-style: italic;">"~/Downloads/"</span>)
  (elfeed-save-multiple-enclosures-without-asking t)
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">setf</span> elfeed-search-print-entry-function
        'my/elfeed-search-print-entry)
  (<span style="font-weight: bold;">defalias</span> '<span style="font-weight: bold;">elfeed-search-tag-all-unchecked</span>
    (elfeed-expose #'elfeed-search-tag-all 'unchecked)
    <span style="font-style: italic;">"Add the `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">unchecked</span><span style="font-style: italic;">' tag to all selected entries."</span>)
  (<span style="font-weight: bold;">defalias</span> '<span style="font-weight: bold;">elfeed-search-untag-all-unchecked</span>
    (elfeed-expose #'elfeed-search-untag-all 'unchecked)
    <span style="font-style: italic;">"Remove the `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">unchecked</span><span style="font-style: italic;">' tag from all selected entries."</span>)
  (<span style="font-weight: bold;">defalias</span> '<span style="font-weight: bold;">elfeed-search-tag-all-checked</span>
    (elfeed-expose #'elfeed-search-tag-all 'checked)
    <span style="font-style: italic;">"Add the `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">checked</span><span style="font-style: italic;">' tag to all selected entries."</span>)
  (<span style="font-weight: bold;">defalias</span> '<span style="font-weight: bold;">elfeed-search-untag-all-checked</span>
    (elfeed-expose #'elfeed-search-untag-all 'checked)
    <span style="font-style: italic;">"Remove the `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">checked</span><span style="font-style: italic;">' tag from all selected entries."</span>)
  (bind-keys <span style="font-weight: bold;">:map</span> elfeed-search-mode-map
             (<span style="font-style: italic;">"C-j"</span> . elfeed-search-show-entry)
             (<span style="font-style: italic;">"o"</span> . elfeed-search-open-url)
             (<span style="font-style: italic;">"C-c C-o"</span> . elfeed-search-open-url)
             (<span style="font-style: italic;">"f"</span> . scroll-up-line)
             (<span style="font-style: italic;">"e"</span> . scroll-down-line)
             (<span style="font-style: italic;">"q"</span> . elfeed-kill-buffer)
             (<span style="font-style: italic;">"Q"</span> . quit-window)
             (<span style="font-style: italic;">"x"</span> . elfeed-search-update--force)
             (<span style="font-style: italic;">"c"</span> . (<span style="font-weight: bold;">lambda</span> () (<span style="font-weight: bold;">interactive</span>)
                      (elfeed-search-untag-all-unread)
                      (<span style="font-weight: bold;">unless</span> (use-region-p) (forward-line -1))
                      (elfeed-search-tag-all-unchecked)))
             (<span style="font-style: italic;">"C"</span> . elfeed-search-untag-all-unchecked)
             (<span style="font-style: italic;">"r"</span> . (<span style="font-weight: bold;">lambda</span> () (<span style="font-weight: bold;">interactive</span>)
                      (elfeed-search-untag-all-unread)
                      (<span style="font-weight: bold;">unless</span> (use-region-p) (forward-line -1))
                      (elfeed-search-untag-all-unchecked)
                      (<span style="font-weight: bold;">unless</span> (use-region-p) (forward-line -1))
                      (elfeed-search-tag-all-checked)
                      (<span style="font-weight: bold;">unless</span> (use-region-p) (forward-line -1))
                      (elfeed-search-tag-all (intern (format-time-string <span style="font-style: italic;">"%Y%m%d"</span>)))))
             (<span style="font-style: italic;">"R"</span> . elfeed-search-untag-all-checked)
             (<span style="font-style: italic;">"d"</span> . elfeed-search-untag-all-unread)
             (<span style="font-style: italic;">"Dv"</span> . elfeed-search-download-video)
             (<span style="font-style: italic;">"Da"</span> . elfeed-search-download-audio)
             (<span style="font-style: italic;">"D="</span> . elfeed-search-show-media-duration))
  (add-to-list 'elfeed-search-face-alist '(unchecked elfeed-search-unchecked-title-face))
  (add-to-list 'elfeed-search-face-alist '(checked elfeed-search-checked-title-face)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/elfeed-search-print-entry</span> (entry)
  <span style="font-style: italic;">"Print ENTRY to the buffer with my style."</span>
  (<span style="font-weight: bold;">let*</span> ((date (elfeed-search-format-date (elfeed-entry-date entry)))
         (title (<span style="font-weight: bold;">or</span> (elfeed-meta entry <span style="font-weight: bold;">:title</span>) (elfeed-entry-title entry) <span style="font-style: italic;">""</span>))
         (title-faces (elfeed-search--faces (elfeed-entry-tags entry)))
         (feed (elfeed-entry-feed entry))
         (feed-title
          (<span style="font-weight: bold;">when</span> feed
            (<span style="font-weight: bold;">or</span> (elfeed-meta feed <span style="font-weight: bold;">:title</span>) (elfeed-feed-title feed))))
         (tags (mapcar #'symbol-name (elfeed-entry-tags entry)))
         (tags-str (mapconcat
                    (<span style="font-weight: bold;">lambda</span> (s) (propertize s 'face 'elfeed-search-tag-face))
                    tags <span style="font-style: italic;">","</span>))
         (title-width (- (window-width) 10 elfeed-search-trailing-width))
         (title-column (elfeed-format-column
                        title (elfeed-clamp
                               elfeed-search-title-min-width
                               title-width
                               elfeed-search-title-max-width)
                        <span style="font-weight: bold;">:left</span>)))
    (<span style="font-weight: bold;">when</span> feed-title
      (insert (propertize (elfeed-format-column feed-title 6 <span style="font-weight: bold;">:left</span>)
                          'face 'elfeed-search-feed-face) <span style="font-style: italic;">" "</span>))
    (insert (propertize title-column 'face title-faces 'kbd-help title) <span style="font-style: italic;">" "</span>)
    (insert (propertize date 'face 'elfeed-search-date-face) <span style="font-style: italic;">" "</span>)
    (<span style="font-weight: bold;">when</span> tags
      (insert <span style="font-style: italic;">"("</span> tags-str <span style="font-style: italic;">")"</span>))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">elfeed-search-open-url</span> ()
  <span style="font-style: italic;">"Visit the current entry in your browser using 'eww-browse-url'."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (elfeed-search-untag-all-unchecked)
  (<span style="font-weight: bold;">unless</span> (use-region-p) (forward-line -1))
  (elfeed-search-tag-all-checked)
  (<span style="font-weight: bold;">unless</span> (use-region-p) (forward-line -1))
  (elfeed-search-tag-all (intern (format-time-string <span style="font-style: italic;">"%Y%m%d"</span>)))
  (<span style="font-weight: bold;">unless</span> (use-region-p) (forward-line -1))
  (elfeed-search-browse-url))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">elfeed-search-download-video</span> ()
  <span style="font-style: italic;">"Downlaod video file."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">let</span> ((entries (elfeed-search-selected)))
    (<span style="font-weight: bold;">cl-loop</span> for entry in entries
             when (<span style="font-weight: bold;">or</span> (caar (elfeed-entry-enclosures entry))
                      (elfeed-entry-link entry))
             do (<span style="font-weight: bold;">let</span> ((title (elfeed-entry-title entry)))
                  (my/download-video it title)))
    (mapc #'elfeed-search-update-entry entries)
    (<span style="font-weight: bold;">unless</span> (<span style="font-weight: bold;">or</span> elfeed-search-remain-on-entry (use-region-p))
      (forward-line))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">elfeed-search-download-audio</span> ()
  <span style="font-style: italic;">"Download audio file."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">let</span> ((entries (elfeed-search-selected)))
    (<span style="font-weight: bold;">cl-loop</span> for entry in entries
             when (<span style="font-weight: bold;">or</span> (caar (elfeed-entry-enclosures entry))
                      (elfeed-entry-link entry))
             do (<span style="font-weight: bold;">let</span> ((title (elfeed-entry-title entry)))
                  (my/download-audio it title)))
    (mapc #'elfeed-search-update-entry entries)
    (<span style="font-weight: bold;">unless</span> (<span style="font-weight: bold;">or</span> elfeed-search-remain-on-entry (use-region-p))
      (forward-line))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">elfeed-search-show-media-duration</span> ()
  <span style="font-style: italic;">"Show duration of media attached to current entry."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">let*</span> ((entry (elfeed-search-selected <span style="font-weight: bold;">:single</span>))
         (url (<span style="font-weight: bold;">or</span> (caar (elfeed-entry-enclosures entry))
                  (elfeed-entry-link entry))))
    (show-media-duration url)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">elfeed-search-org-capture-derived</span> (<span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> arg)
  <span style="font-style: italic;">"Create actionable org task derived from current elfeed entry.</span>

<span style="font-style: italic;">If called with C-u prefix, ask user to specify tags and target."</span>
  (<span style="font-weight: bold;">interactive</span> <span style="font-style: italic;">"P"</span>)
  (<span style="font-weight: bold;">let</span> ((entries (elfeed-search-selected)))
    (<span style="font-weight: bold;">save-window-excursion</span>
      (<span style="font-weight: bold;">cl-loop</span> for entry in entries
               do (<span style="font-weight: bold;">progn</span>
                    (elfeed-show-entry entry)
                    (<span style="font-weight: bold;">let</span> ((org-capture-derived-tags (format <span style="font-style: italic;">":web:%s"</span>
                                                            (<span style="font-weight: bold;">cond</span>
                                                             ((<span style="font-weight: bold;">or</span> (member 'video (elfeed-entry-tags entry))
                                                                  (member 'audio (elfeed-entry-tags entry)))
                                                              <span style="font-style: italic;">"ac_watch:"</span>)
                                                             (t <span style="font-style: italic;">"ac_read:"</span>))))
                          (org-capture-derived-target <span style="font-style: italic;">"f215ba42-6610-4019-a0a5-f790ebb26e29"</span>)
                          (org-capture-derived-deadline-in-day 7))
                      (call-interactively #'org-capture-derived))
                    (elfeed-kill-buffer))))
    (elfeed-search-untag-all-unchecked)
    (<span style="font-weight: bold;">unless</span> (use-region-p) (forward-line -1))
    (elfeed-search-tag-all-checked)
    (mapc #'elfeed-search-update-entry entries)))
</pre>
</div>
</div>

<ul class="org-ul">
<li><a id="orge7646c5"></a>elfeed-org<br />
<div class="outline-text-6" id="text-orge7646c5">
<p>
<a href="https://github.com/remyhonig/elfeed-org">elfeed-org</a> allow me to express feeds for elfeed in org file.
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-elfeed-org"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package elfeed-org
  <span style="font-weight: bold;">:after</span> (elfeed org)
  <span style="font-weight: bold;">:custom</span>
  (rmh-elfeed-org-files '(<span style="font-style: italic;">"~/org/lists/feeds.org"</span>))
  (rmh-elfeed-org-ignore-tag <span style="font-style: italic;">"ignore"</span>)
  (rmh-elfeed-org-auto-ignore-invalid-feeds t)
  <span style="font-weight: bold;">:config</span>
  (elfeed-org))
</pre>
</div>

<p>
Packages managed by other than guix (i.e. straight.el or apt) are encouraged to register feed since updating information channel is desirable to exist.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(advice-add #'rmh-elfeed-org-process
            <span style="font-weight: bold;">:after</span> #'my/elfeed-org-add-feeds)

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/elfeed-org-add-feeds</span> (rmh-elfeed-org-files rmh-elfeed-org-tree-id)
  <span style="font-style: italic;">"Add feeds in addition to feeds in `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">rmh-elfeed-org-files</span><span style="font-style: italic;">'.</span>

<span style="font-style: italic;">This function needs to be invoked after `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">rmh-elfeed-org-process</span><span style="font-style: italic;">' which clear all feeds."</span>
  (<span style="font-weight: bold;">setf</span> elfeed-feeds
        (append elfeed-feeds
                '(<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">s-exps for feeds will be inserted here</span>
                  &lt;&lt;elfeed-feeds&gt;&gt;))))
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="org667a030"></a>Terminal emulators (Shells)<br />
<div class="outline-text-5" id="text-org667a030">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">setf</span> shell-command-switch <span style="font-style: italic;">"-c"</span>)
(customize-set-variable 'shell-command-prompt-show-cwd t)

(shell-command-with-editor-mode 1)
</pre>
</div>
</div>

<ul class="org-ul">
<li><a id="orgc80e18b"></a>shell<br />
<div class="outline-text-6" id="text-orgc80e18b">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package shell
  <span style="font-weight: bold;">:delight</span> <span style="font-style: italic;">" SM"</span>
  <span style="font-weight: bold;">:commands</span> (shell)
  <span style="font-weight: bold;">:custom</span>
  (shell-has-auto-cd t)
  <span style="font-weight: bold;">:config</span>
  (bind-keys <span style="font-weight: bold;">:map</span> shell-mode-map
             (<span style="font-style: italic;">"C-j"</span> . comint-send-input)))
</pre>
</div>
</div>
</li>

<li><a id="org2895ce9"></a>term<br />
<div class="outline-text-6" id="text-org2895ce9">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package term
  <span style="font-weight: bold;">:delight</span>
  (term-mode <span style="font-style: italic;">" TR"</span>)
  <span style="font-weight: bold;">:config</span>
  (bind-keys <span style="font-weight: bold;">:map</span> term-mode-map
             (<span style="font-style: italic;">"C-j"</span> . term-send-input)))
</pre>
</div>
</div>
</li>

<li><a id="orgd3d2375"></a>vterm<br />
<div class="outline-text-6" id="text-orgd3d2375">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-vterm"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-style: italic;">"https://github.com/akermu/emacs-libvterm/releases.atom"</span> soft_update)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package vterm
  <span style="font-weight: bold;">:delight</span> <span style="font-style: italic;">" VT"</span>
  <span style="font-weight: bold;">:diminish</span> ((vterm-copy-mode . <span style="font-style: italic;">"vc"</span>))
  <span style="font-weight: bold;">:custom</span>
  (vterm-min-window-width 55)
  (vterm-buffer-name-string <span style="font-style: italic;">"vterm %s"</span>)
  <span style="font-weight: bold;">:config</span>
  (bind-keys <span style="font-weight: bold;">:map</span> vterm-mode-map
             (<span style="font-style: italic;">"C-h"</span> . vterm-send-backspace)
             (<span style="font-style: italic;">"M-h"</span> . vterm-send-meta-backspace)
             (<span style="font-style: italic;">"C-y"</span> . vterm-yank)
             (<span style="font-style: italic;">"M-y"</span> . vterm-yank-pop)
             (<span style="font-style: italic;">"C-o"</span> . nil)
             (<span style="font-style: italic;">"M-l"</span> . nil)
             <span style="font-weight: bold;">:map</span> vterm-copy-mode-map
             (<span style="font-style: italic;">"C-j"</span> . vterm-copy-mode-done))
  (advice-add 'consult-yank-from-kill-ring <span style="font-weight: bold;">:around</span> #'advice/vterm-yank-pop))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">advice/vterm-yank-pop</span> (orig-fun <span style="font-weight: bold; text-decoration: underline;">&amp;rest</span> args)
  (<span style="font-weight: bold;">if</span> (eq major-mode 'vterm-mode)
      (<span style="font-weight: bold;">let</span> ((inhibit-read-only t)
            (yank-undo-function (<span style="font-weight: bold;">lambda</span> (_start _end) (vterm-undo))))
        (<span style="font-weight: bold;">cl-letf</span> (((symbol-function 'insert-for-yank)
                   (<span style="font-weight: bold;">lambda</span> (str) (vterm-send-string str t))))
          (apply orig-fun args)))
    (apply orig-fun args)))
</pre>
</div>
</div>

<ul class="org-ul">
<li><a id="org352a448"></a>multi-vterm<br />
<div class="outline-text-7" id="text-org352a448">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-multi-vterm"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-style: italic;">"https://github.com/suonlight/multi-vterm/releases.atom"</span> soft_update)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package multi-vterm
  <span style="font-weight: bold;">:after</span> vterm
  <span style="font-weight: bold;">:bind</span> (<span style="font-weight: bold;">:map</span> vterm-mode-map
              (<span style="font-style: italic;">"C-c M-n"</span> . multi-vterm-next)
              (<span style="font-style: italic;">"C-c M-p"</span> . multi-vterm-prev)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/multi-vterm</span> (<span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> arg)
  <span style="font-style: italic;">"Switch between existing vterm buffers.</span>

<span style="font-style: italic;">Spawn a new vterm buffer if there's no available vterm buffer.</span>
<span style="font-style: italic;">If command prefix ARG is simgle `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">C-u</span><span style="font-style: italic;">', spawn a vterm buffer forcibly regardless of condition."</span>
  (<span style="font-weight: bold;">interactive</span> <span style="font-style: italic;">"P"</span>)
  (<span style="font-weight: bold;">if</span> (equal arg '(4))
      (multi-vterm)
    (multi-vterm-next)))
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="org6463c70"></a>eshell<br />
<div class="outline-text-6" id="text-org6463c70">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package eshell
  <span style="font-weight: bold;">:delight</span> <span style="font-style: italic;">" ES"</span>
  <span style="font-weight: bold;">:hook</span>
  (eshell-kill . eshell-command-alert)
  <span style="font-weight: bold;">:custom</span>
  (eshell-prompt-function
   #'(lambda ()
       (format <span style="font-style: italic;">"[%s]\n%s"</span>
               (eshell/basename (eshell/pwd))
               (<span style="font-weight: bold;">if</span> (= (user-uid) 0) <span style="font-style: italic;">"# "</span> <span style="font-style: italic;">"$ "</span>))))
  (eshell-prompt-regexp <span style="font-style: italic;">"[#$] "</span>)
  (eshell-visual-subcommands '((<span style="font-style: italic;">"git"</span> <span style="font-style: italic;">"log"</span> <span style="font-style: italic;">"diff"</span> <span style="font-style: italic;">"show"</span>)))
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">setq</span> eshell-path-env (getenv <span style="font-style: italic;">"PATH"</span>)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">eshell-command-alert</span> (process status)
  <span style="font-style: italic;">"Send `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">alert</span><span style="font-style: italic;">' with severity based on STATUS when PROCESS finished."</span>
  (<span style="font-weight: bold;">let*</span> ((cmd (process-command process))
         (buffer (process-buffer process))
         (msg (format <span style="font-style: italic;">"%s: %s"</span> (mapconcat 'identity cmd <span style="font-style: italic;">" "</span>)  status)))
    (<span style="font-weight: bold;">if</span> (string-prefix-p <span style="font-style: italic;">"finished"</span> status)
        (alert msg <span style="font-weight: bold;">:buffer</span> buffer <span style="font-weight: bold;">:severity</span>  'normal)
      (alert msg <span style="font-weight: bold;">:buffer</span> buffer <span style="font-weight: bold;">:severity</span> 'urgent))))
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="orgd6d8abf"></a>Org-mode<br />
<div class="outline-text-5" id="text-orgd6d8abf">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-org"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-style: italic;">"https://updates.orgmode.org/feed/releases"</span> soft_update)
</pre>
</div>
</div>

<ul class="org-ul">
<li><a id="org4b57ead"></a>basic preference for org core features<br />
<div class="outline-text-6" id="text-org4b57ead">
<p>
Basic settings for built-in Org features. Similar to [BROKEN LINK: id:587bc395-6321-4f59-97e6-6f0b62518b20], all entries obey customize group hierarchy for Org mode.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package org
  <span style="font-weight: bold;">:defer</span> t
  <span style="font-weight: bold;">:mode</span> ((<span style="font-style: italic;">"\\.org$"</span> . org-mode))
  <span style="font-weight: bold;">:interpreter</span> ((<span style="font-style: italic;">"org"</span> . org-mode))
  <span style="font-weight: bold;">:config</span>
  (add-hook 'org-log-buffer-setup-hook
            (<span style="font-weight: bold;">lambda</span> ()
              (<span style="font-weight: bold;">setq</span> skk-dcomp-activate 'eolp)
              (<span style="font-weight: bold;">setq</span> skk-dcomp-multiple-activate nil))))

(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">org-warning-keyword-0</span> <span style="font-style: italic;">"UG"</span> <span style="font-style: italic;">"TODO keyword acronym standing for 'UrGent'"</span>)
(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">org-todo-keyword-0</span> <span style="font-style: italic;">"TD"</span> <span style="font-style: italic;">"TODO keyword acronym standing for 'To Do'"</span>)
(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">org-todo-keyword-1</span> <span style="font-style: italic;">"GO"</span> <span style="font-style: italic;">"TODO keyword acronym standing for 'Get On'"</span>)
(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">org-todo-keyword-2</span> <span style="font-style: italic;">"IP"</span> <span style="font-style: italic;">"TODO keyword acronym standing for 'In Progressn'"</span>)
(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">org-todo-keyword-4</span> <span style="font-style: italic;">"SD"</span> <span style="font-style: italic;">"TODO keyword acronym standing for 'SomeDay'"</span>)
(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">org-done-keyword-0</span> <span style="font-style: italic;">"DN"</span> <span style="font-style: italic;">"TODO keyword acronym standing for 'DoNe'"</span>)
(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">org-done-keyword-1</span> <span style="font-style: italic;">"CX"</span> <span style="font-style: italic;">"TODO keyword acronym standing for 'Cancel'"</span>)
(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">org-done-keyword-2</span> <span style="font-style: italic;">"PD"</span> <span style="font-style: italic;">"TODO keyword acronym standing for 'PenDing'"</span>)
</pre>
</div>
</div>

<ul class="org-ul">
<li><a id="org565ae7f"></a>Org Agenda<br />
<div class="outline-text-7" id="text-org565ae7f">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package org-agenda
  <span style="font-weight: bold;">:after</span> (org org-ql)
  <span style="font-weight: bold;">:bind</span> (<span style="font-weight: bold;">:map</span> org-agenda-mode-map
              (<span style="font-style: italic;">"C-j"</span> . org-agenda-switch-to)
              (<span style="font-style: italic;">"M"</span> . org-agenda-month-view))
  <span style="font-weight: bold;">:hook</span>
  (org-agenda-mode . (<span style="font-weight: bold;">lambda</span> ()
                       (delete-other-windows)
                       (org-agenda-to-appt t '((category <span style="font-style: italic;">"appt"</span>)))))
  <span style="font-weight: bold;">:custom</span>
  (org-agenda-start-on-weekday 1)
  (org-agenda-skip-deadline-if-done t)
  (org-agenda-include-diary t)
  (org-stuck-projects `(,(concat <span style="font-style: italic;">"+"</span> my/org-project-tag)
                        (,org-todo-keyword-0 ,org-todo-keyword-1 ,org-todo-keyword-2)
                        nil <span style="font-style: italic;">""</span>))
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">next 3 custom settings contribute to build agenda view fast</span>
  (org-agenda-inhibit-startup t)
  (org-agenda-dim-blocked-tasks nil)
  (org-agenda-use-tag-inheritance nil)
  (org-agenda-files
   (list (file-name-as-directory (file-name-concat org-directory <span style="font-style: italic;">"agenda"</span>))))
  (org-agenda-prefix-format '((agenda   . <span style="font-style: italic;">"%?-12t% s"</span>)
                              (timeline . <span style="font-style: italic;">"  %s"</span>)
                              (todo     . <span style="font-style: italic;">" "</span>)
                              (tags     . <span style="font-style: italic;">" "</span>)
                              (search   . <span style="font-style: italic;">" "</span>)))
  (org-agenda-custom-commands
   `((<span style="font-style: italic;">"a"</span> <span style="font-style: italic;">"Week-agenda"</span>
      agenda <span style="font-style: italic;">""</span>
      ((org-agenda-skip-function
        (<span style="font-weight: bold;">lambda</span> ()
          <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">skip entries whose tag is 'web' and does not have todo state</span>
          (<span style="font-weight: bold;">and</span> (<span style="font-weight: bold;">save-excursion</span>
                 (<span style="font-weight: bold;">and</span> (member <span style="font-style: italic;">"web"</span> (org-get-tags))
                      (not (member (org-get-todo-state)
                                   `(,org-todo-keyword-0
                                     ,org-todo-keyword-1
                                     ,org-todo-keyword-2)))))
               (<span style="font-weight: bold;">progn</span> (outline-next-heading) (point)))))))
     (<span style="font-style: italic;">"l"</span> <span style="font-style: italic;">"Log entries in a week"</span>
      agenda <span style="font-style: italic;">""</span>
      ((org-agenda-span (<span style="font-weight: bold;">if</span> (equal current-prefix-arg '(4))
                            'day 'week))
       (org-agenda-start-with-log-mode t)
       (org-agenda-include-inactive-timestamps nil)
       (org-agenda-include-diary t)
       (org-agenda-sorting-strategy
        '(time-up
          deadline-up
          todo-state-up
          priority-down))))
     (<span style="font-style: italic;">"L"</span> <span style="font-style: italic;">"Log entry timeline on today with default org-agenda-prefix-format"</span>
      agenda <span style="font-style: italic;">""</span>
      ((org-agenda-prefix-format (eval (car (get 'org-agenda-prefix-format 'standard-value))))
       (org-agenda-span (<span style="font-weight: bold;">if</span> (equal current-prefix-arg '(4))
                            'day 'week))
       (org-agenda-start-with-log-mode t)
       (org-agenda-include-inactive-timestamps nil)
       (org-agenda-include-diary t)
       (org-agenda-sorting-strategy
        '(time-up
          deadline-up
          todo-state-up
          priority-down))))
     <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">KEEP IN MIND</span>
     <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">invoking `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">org-clock-sum-all</span><span style="font-weight: bold; font-style: italic;">' is required before showing effort table</span>
     (<span style="font-style: italic;">"e"</span> . <span style="font-style: italic;">"Effort table"</span>)
     (<span style="font-style: italic;">"ei"</span> <span style="font-style: italic;">"today"</span>
      ((org-ql-search-block `(<span style="font-weight: bold;">or</span> (todo ,org-warning-keyword-0)
                                 (todo ,org-todo-keyword-2)
                                 (<span style="font-weight: bold;">and</span> (clocked <span style="font-weight: bold;">:on</span> today)
                                      (<span style="font-weight: bold;">or</span> (todo) (done))
                                      (not (habit))
                                      (not (tags <span style="font-style: italic;">"web"</span>))))
                            ((org-ql-block-header <span style="font-style: italic;">"Today's task"</span>))))
      ((org-agenda-overriding-header <span style="font-style: italic;">"Today's Task"</span>)
       (org-overriding-columns-format <span style="font-style: italic;">"%26ITEM(Task) %Effort(Effort){:} %CLOCKSUM_T(Today){:} %CLOCKSUM(Total)"</span>)
       (org-agenda-view-columns-initially t)
       (org-agenda-sorting-strategy '(todo-state-up priority-down deadline-up))))
     (<span style="font-style: italic;">"eg"</span> <span style="font-style: italic;">"this week"</span>
      ((org-ql-search-block `(<span style="font-weight: bold;">or</span> (todo ,org-warning-keyword-0)
                                 (todo ,org-todo-keyword-1)
                                 (todo ,org-todo-keyword-2))
                            ((org-ql-block-header <span style="font-style: italic;">"This Week's task"</span>))))
      ((org-agenda-overriding-header <span style="font-style: italic;">"This Week's Task"</span>)
       (org-overriding-columns-format <span style="font-style: italic;">"%26ITEM(Task) %Effort(Effort){:} %CLOCKSUM_T(Today){:} %CLOCKSUM(Total)"</span>)
       (org-agenda-view-columns-initially t)
       (org-agenda-sorting-strategy '(todo-state-up priority-down deadline-up))))
     (<span style="font-style: italic;">"ed"</span> <span style="font-style: italic;">"done task"</span>
      ((org-ql-search-block `(<span style="font-weight: bold;">or</span> (todo ,org-done-keyword-0)
                                 (todo ,org-done-keyword-1)
                                 (todo ,org-done-keyword-2))
                            ((org-ql-block-header <span style="font-style: italic;">"Done task"</span>))))
      ((org-agenda-overriding-header <span style="font-style: italic;">"Done Task"</span>)
       (org-overriding-columns-format <span style="font-style: italic;">"%26ITEM(Task) %Effort(Effort){:} %CLOCKSUM(Total){:}"</span>)
       (org-agenda-view-columns-initially t)
       (org-agenda-sorting-strategy '(todo-state-up priority-down deadline-up))))
     (<span style="font-style: italic;">"i"</span> <span style="font-style: italic;">"Today's agenda"</span>
      ((todo <span style="font-style: italic;">"Today's agenda"</span>
             ((org-agenda-sorting-strategy '(priority-up))))
       (org-ql-search-block `(heading ,(format-time-string <span style="font-style: italic;">"%Y-%m-%d %A"</span>))
                            ((org-agenda-files `(,(file-name-concat org-directory <span style="font-style: italic;">"archive"</span> (format-time-string <span style="font-style: italic;">"archive_%Y.org"</span>))))
                             (org-ql-block-header <span style="font-style: italic;">"Today in datetree archive"</span>)))
       (org-ql-search-block `(<span style="font-weight: bold;">or</span> (todo ,org-warning-keyword-0)
                                 (todo ,org-todo-keyword-2))
                            ((org-ql-block-header <span style="font-style: italic;">"Today's task"</span>)))
       (org-ql-search-block `(<span style="font-weight: bold;">and</span> (planning <span style="font-weight: bold;">:on</span> today)
                                  (not (todo ,org-todo-keyword-2
                                             ,org-done-keyword-0
                                             ,org-done-keyword-1
                                             ,org-done-keyword-2))
                                  (not (tags <span style="font-style: italic;">"web"</span>))
                                  (not (habit)))
                            ((org-ql-block-header <span style="font-style: italic;">"Scheduled/Deadlined on today"</span>)))
       (org-ql-search-block `(<span style="font-weight: bold;">and</span> (habit)
                                  (todo ,org-todo-keyword-0)
                                  (scheduled <span style="font-weight: bold;">:to</span> today)
                                  (not (tags <span style="font-style: italic;">"bad_habit"</span>))
                                  (not (tags-inherited <span style="font-style: italic;">"ARCHIVE"</span>)))
                            ((org-ql-block-header <span style="font-style: italic;">"Habits to take"</span>)))
       (org-ql-search-block `(<span style="font-weight: bold;">and</span> (ts-active <span style="font-weight: bold;">:on</span> today)
                                  (not (<span style="font-weight: bold;">or</span> (todo ,org-todo-keyword-2)
                                           (habit) (done))))
                            ((org-ql-block-header <span style="font-style: italic;">"Today's common event"</span>)))
       (org-ql-search-block '(<span style="font-weight: bold;">and</span> (done)
                                  (closed <span style="font-weight: bold;">:on</span> today))
                            ((org-ql-block-header <span style="font-style: italic;">"Completed tasks on today"</span>)))))
     (<span style="font-style: italic;">"g"</span> <span style="font-style: italic;">"This Week's agenda"</span>
      ((org-ql-search-block `(heading ,(format-time-string <span style="font-style: italic;">"%G-W%V"</span>))
                            ((org-agenda-files `(,(file-name-concat org-directory <span style="font-style: italic;">"archive"</span> (format-time-string <span style="font-style: italic;">"archive_%Y.org"</span>))))
                             (org-ql-block-header <span style="font-style: italic;">"This week in datetree archive"</span>)))
       (org-ql-search-block `(<span style="font-weight: bold;">or</span> (todo ,org-todo-keyword-1))
                            ((org-ql-block-header <span style="font-style: italic;">"This week's tasks"</span>)))
       (org-ql-search-block `(<span style="font-weight: bold;">or</span> (todo ,org-warning-keyword-0)
                                 (todo ,org-todo-keyword-2))
                            ((org-ql-block-header <span style="font-style: italic;">"Today's tasks"</span>)))
       (org-ql-search-block `(<span style="font-weight: bold;">and</span> (planning <span style="font-weight: bold;">:from</span> 0 <span style="font-weight: bold;">:to</span> 6)
                                  (not (todo ,org-todo-keyword-2
                                             ,org-done-keyword-0
                                             ,org-done-keyword-1
                                             ,org-done-keyword-2))
                                  (not (tags <span style="font-style: italic;">"web"</span>))
                                  (not (habit)))
                            ((org-ql-block-header <span style="font-style: italic;">"Scheduled/Deadlined this week"</span>)))
       (org-ql-search-block `(<span style="font-weight: bold;">and</span> (<span style="font-weight: bold;">and</span> (ts-active <span style="font-weight: bold;">:from</span> 0 <span style="font-weight: bold;">:to</span> 6)
                                       (not (deadline))
                                       (not (scheduled))
                                       (not (closed)))
                                  (not (<span style="font-weight: bold;">or</span> (todo ,org-todo-keyword-1
                                                 ,org-todo-keyword-2)
                                           (done))))
                            ((org-ql-block-header <span style="font-style: italic;">"This week's common event"</span>))))
      ((org-agenda-sorting-strategy
        '(todo-state-up priority-down deadline-up))))
     (<span style="font-style: italic;">"t"</span> <span style="font-style: italic;">"All tasks"</span>
      ((org-ql-search-block `(todo ,org-warning-keyword-0)
                            ((org-ql-block-header <span style="font-style: italic;">"Urgent task"</span>)))
       (org-ql-search-block `(todo ,org-todo-keyword-2)
                            ((org-ql-block-header <span style="font-style: italic;">"Today's task"</span>)))
       (org-ql-search-block `(todo ,org-todo-keyword-1)
                            ((org-ql-block-header <span style="font-style: italic;">"This week's task"</span>)))
       (org-ql-search-block `(<span style="font-weight: bold;">and</span> (todo ,org-todo-keyword-0)
                                  (not (habit)))
                            ((org-ql-block-header <span style="font-style: italic;">"Remaining task"</span>)))))
     (<span style="font-style: italic;">"d"</span> <span style="font-style: italic;">"Done tasks"</span>
      ((org-ql-search-block '(done)
                            ((org-ql-block-header <span style="font-style: italic;">"Done/Canceled/Pending task"</span>)))))
     (<span style="font-style: italic;">"p"</span> <span style="font-style: italic;">"Projects"</span> tags ,(concat <span style="font-style: italic;">"+"</span> my/org-project-tag))
     (<span style="font-style: italic;">"h"</span> <span style="font-style: italic;">"Habits in consistency graph"</span>
      agenda <span style="font-style: italic;">""</span>
      ((org-agenda-span 'day)
       (org-agenda-use-time-grid nil)
       (org-agenda-prefix-format '((agenda . <span style="font-style: italic;">""</span>)))
       (org-habit-show-all-today t)
       (org-habit-graph-column 32)
       (org-habit-preceding-days 14)
       (org-habit-following-days 21)
       (org-agenda-sorting-strategy '(scheduled-up))
       <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">display habits only</span>
       (org-agenda-skip-function
        (<span style="font-weight: bold;">lambda</span> ()
          (<span style="font-weight: bold;">and</span> (<span style="font-weight: bold;">save-excursion</span>
                 (not (org-is-habit-p)))
               (<span style="font-weight: bold;">progn</span> (outline-next-heading) (point)))))))
     (<span style="font-style: italic;">"H"</span> <span style="font-style: italic;">"show all habits"</span>
      ((org-ql-search-block '(habit)
                            ((org-ql-block-header <span style="font-style: italic;">"All Habits"</span>))))
      ((org-agenda-sorting-strategy '(scheduled-up))))))
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">dolist</span> (dir '(<span style="font-style: italic;">"archive"</span> <span style="font-style: italic;">"lists"</span> <span style="font-style: italic;">"wiki"</span> <span style="font-style: italic;">"notes"</span>))
    (mapc (<span style="font-weight: bold;">lambda</span> (org-file)
            (add-to-list 'org-agenda-text-search-extra-files
                         org-file))
          (directory-files (expand-file-name dir org-directory)
                           t
                           (<span style="font-weight: bold;">rx</span> (one-or-more not-newline)
                               (<span style="font-weight: bold;">or</span> <span style="font-style: italic;">".org"</span> <span style="font-style: italic;">".org.gpg"</span>)
                               line-end)))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">org-agenda-cmp-latest-clock-log</span> (a b)
  <span style="font-style: italic;">"Compare two org entry A and B in terms of clock log.</span>

<span style="font-style: italic;">This function can be used as `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">org-agenda-cmp-user-defined</span><span style="font-style: italic;">' in `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">org-agenda-sorting-strategy</span><span style="font-style: italic;">'."</span>
  (<span style="font-weight: bold;">let*</span> ((marker-a (get-text-property 1 'org-marker a))
         (time-a (org-get-latest-clock-log-time marker-a))
         (marker-b (get-text-property 1 'org-marker b))
         (time-b (org-get-latest-clock-log-time marker-b)))
    (<span style="font-weight: bold;">if</span> (time-less-p time-a time-b) -1 +1)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">org-clock-sum-all</span> ()
  <span style="font-style: italic;">"Sum the times for all agenda files."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">save-excursion</span>
    (mapc (<span style="font-weight: bold;">lambda</span> (file)
            (<span style="font-weight: bold;">with-current-buffer</span> (<span style="font-weight: bold;">or</span> (org-find-base-buffer-visiting file)
                                     (find-file-noselect file))
              (org-clock-sum)
              (org-clock-sum-today)))
          (org-agenda-files))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">org-get-latest-clock-log-time</span> (pom)
  <span style="font-style: italic;">"Get the latest clock log time stamp in org entry at POM as a time object.</span>

<span style="font-style: italic;">If entry at POM has no clock log time stamp, this function returns 0."</span>
  (<span style="font-weight: bold;">org-with-point-at</span> pom
    (<span style="font-weight: bold;">save-excursion</span>
      (<span style="font-weight: bold;">setq</span> end-of-subtree (org-end-of-subtree))
      (<span style="font-weight: bold;">setq</span> latest-time 0)
      (org-back-to-heading t)
      (org-show-all)
      (<span style="font-weight: bold;">while</span> (re-search-forward org-drawer-regexp end-of-subtree t)
        (<span style="font-weight: bold;">when</span> (string= (match-string 1) (org-clock-drawer-name))
          (<span style="font-weight: bold;">while</span> (<span style="font-weight: bold;">progn</span>
                   (forward-line 1)
                   (<span style="font-weight: bold;">when</span> (org-match-line (concat <span style="font-style: italic;">"^[ \t]*"</span> org-clock-string <span style="font-style: italic;">"[ \t]*"</span> org-tsr-regexp-both))
                     (<span style="font-weight: bold;">setq</span> match-ts
                           (<span style="font-weight: bold;">if</span> (match-string 3)
                               (match-string 3) (match-string 1)))
                     (<span style="font-weight: bold;">when</span> (time-less-p latest-time
                                        (apply 'encode-time (parse-time-string match-ts)))
                       (<span style="font-weight: bold;">setq</span> latest-time (apply 'encode-time (parse-time-string match-ts)))))
                   (not (org-match-line org-clock-drawer-end-re))))))))
  latest-time)
</pre>
</div>
</div>
</li>

<li><a id="orgfd04e34"></a>Org Capture<br />
<div class="outline-text-7" id="text-orgfd04e34">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package org-capture
  <span style="font-weight: bold;">:after</span> org
  <span style="font-weight: bold;">:hook</span>
  (org-capture-mode . (<span style="font-weight: bold;">lambda</span> ()
                        (skk-mode 1)
                        (delete-other-windows)))
  <span style="font-weight: bold;">:custom</span>
  (org-directory (expand-file-name <span style="font-style: italic;">"~/org"</span>))
  (org-reverse-note-order nil)
  (org-capture-bookmark nil)
  (org-capture-templates
   `((<span style="font-style: italic;">"e"</span> <span style="font-style: italic;">"Entry"</span>
      entry (id <span style="font-style: italic;">"58e12e3e-da50-4089-9d22-565986637121"</span>)
      <span style="font-style: italic;">"* %?"</span>)
     (<span style="font-style: italic;">"t"</span> <span style="font-style: italic;">"Task"</span>
      entry (id <span style="font-style: italic;">"58e12e3e-da50-4089-9d22-565986637121"</span>)
      ,(format <span style="font-style: italic;">"* %s %%?\n"</span>
               org-todo-keyword-0))
     (<span style="font-style: italic;">"p"</span> <span style="font-style: italic;">"Project"</span>
      entry (id <span style="font-style: italic;">"58e12e3e-da50-4089-9d22-565986637121"</span>)
      <span style="font-style: italic;">"* %? [/] :project:\n- [ ] insert ID property if necessary"</span>
      <span style="font-weight: bold;">:jump-to-captured</span> t)
     (<span style="font-style: italic;">"M"</span> <span style="font-style: italic;">"Append memo to clocking task"</span>
      item (clock)
      <span style="font-style: italic;">"- %i%?"</span>))))
</pre>
</div>
</div>
</li>

<li><a id="org9d5a7f7"></a>Org Startup<br />
<div class="outline-text-7" id="text-org9d5a7f7">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(customize-set-variable 'org-startup-folded t)
(customize-set-variable 'org-startup-truncated t)
(customize-set-variable 'org-startup-with-inline-images t)
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">allow _{}/^{} format for sub/super script</span>
(customize-set-variable 'org-use-sub-superscripts '{})
</pre>
</div>
</div>
</li>

<li><a id="orgbf95688"></a>Org TODO<br />
<div class="outline-text-7" id="text-orgbf95688">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">with-eval-after-load</span> 'org
  (customize-set-variable 'org-enforce-todo-dependencies t)
  (customize-set-variable
   'org-todo-keywords
   `((sequence ,(format <span style="font-style: italic;">"%s(t/!)"</span> org-todo-keyword-0)
               ,(format <span style="font-style: italic;">"%s(u/!)"</span> org-warning-keyword-0)
               ,(format <span style="font-style: italic;">"%s(g/!)"</span> org-todo-keyword-1)
               ,(format <span style="font-style: italic;">"%s(i/!)"</span> org-todo-keyword-2)
               <span style="font-style: italic;">"|"</span>
               ,(format <span style="font-style: italic;">"%s(d/@)"</span> org-done-keyword-0)
               ,(format <span style="font-style: italic;">"%s(x/@)"</span> org-done-keyword-1)
               ,(format <span style="font-style: italic;">"%s(p/@)"</span> org-done-keyword-2))
     (sequence ,(format <span style="font-style: italic;">"%s(t/!)"</span> org-todo-keyword-0)
               ,(format <span style="font-style: italic;">"%s(s/!)"</span> org-todo-keyword-4)
               <span style="font-style: italic;">"|"</span>
               ,(format <span style="font-style: italic;">"%s(x/@)"</span> org-done-keyword-1)
               ,(format <span style="font-style: italic;">"%s(p/@)"</span> org-done-keyword-2))))
  (customize-set-variable
   'org-todo-keyword-faces
   `((,org-warning-keyword-0 . <span style="font-style: italic;">"red1"</span>)
     (,org-todo-keyword-0    . <span style="font-style: italic;">"green1"</span>)
     (,org-todo-keyword-1    . <span style="font-style: italic;">"DeepPink1"</span>)
     (,org-todo-keyword-2    . <span style="font-style: italic;">"DodgerBlue1"</span>)
     (,org-todo-keyword-4    . <span style="font-style: italic;">"SpringGreen"</span>)
     (,org-done-keyword-0    . <span style="font-style: italic;">"gray30"</span>)
     (,org-done-keyword-1    . <span style="font-style: italic;">"dark gray"</span>)
     (,org-done-keyword-2    . <span style="font-style: italic;">"sea green"</span>)))
  (customize-set-variable 'org-log-done 'time)
  (customize-set-variable 'org-log-into-drawer t)
  (customize-set-variable 'org-log-states-order-reversed t)
  (add-hook 'org-after-todo-state-change-hook
            #'my/org-remove-priority-if-done)
  (add-hook 'org-after-todo-state-change-hook
            #'my/org-remove-done-if-nonrepeated-habit)
  (add-hook 'org-after-todo-state-change-hook
            #'my/org-close-project))

<span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/org-remove-priority-if-done</span> ()
  <span style="font-style: italic;">"Remove priority if todo state of the entry at point has changed to `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">org-done-keywords</span><span style="font-style: italic;">'."</span>
  (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">and</span>
         <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">the entry has one of org-done-keywords</span>
         (string-match-p
          (eval `(<span style="font-weight: bold;">rx</span> (<span style="font-weight: bold;">or</span> ,org-done-keyword-0
                         ,org-done-keyword-1
                         ,org-done-keyword-2)))
          org-state)
         <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">the entry has been set any priority</span>
         (/= 21000 (<span style="font-weight: bold;">save-excursion</span>
                     (<span style="font-weight: bold;">save-match-data</span>
                       (beginning-of-line)
                       (<span style="font-weight: bold;">and</span> (looking-at org-heading-regexp)
                            (org-get-priority (match-string 0)))))))
    (org-priority 'remove)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/org-remove-done-if-nonrepeated-habit</span> ()
  <span style="font-style: italic;">"Reset todo state of the entry at point if it is habit without repeats."</span>
  (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">and</span> (string-match-p org-done-keyword-0
                             org-state)
             (org-is-habit-p)
             (not (org-get-scheduled-time (point))))
    (org-todo <span style="font-style: italic;">""</span>)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/org-close-project</span> ()
  <span style="font-style: italic;">"Try to close the project entry which this entry belongs.</span>

<span style="font-style: italic;">If the project entry has BLOCKER property, Ord EDNA prohibit the entry to close."</span>
  (<span style="font-weight: bold;">when</span> (member org-state
                `(,org-done-keyword-0 ,org-done-keyword-1 ,org-done-keyword-2))
    (<span style="font-weight: bold;">save-excursion</span>
      (org-back-to-heading t)
      (org-speed-move-safe 'outline-up-heading)
      (<span style="font-weight: bold;">and</span> (member my/org-project-tag (org-get-tags))
           (org-todo org-done-keyword-0)))))
</pre>
</div>
</div>
</li>

<li><a id="org166b7e5"></a>Org Structure<br />
<div class="outline-text-7" id="text-org166b7e5">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(add-hook 'org-mode-hook 'org-indent-mode)

(customize-set-variable 'org-startup-indented t)
(customize-set-variable 'org-bookmark-names-plist nil)
(customize-set-variable 'org-M-RET-may-split-line '((default . nil)))
</pre>
</div>
</div>

<ul class="org-ul">
<li><a id="org3f02fd5"></a>Org Edit Structure<br />
<div class="outline-text-8" id="text-org3f02fd5">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package org
  <span style="font-weight: bold;">:custom</span>
  (org-edit-src-auto-save-idle-delay 30)
  (org-adapt-indentation nil)
  (org-special-ctrl-a/e t)
  (org-catch-invisible-edits 'smart)
  <span style="font-weight: bold;">:config</span>
  (add-to-list 'org-structure-template-alist (cons <span style="font-style: italic;">"sh"</span> <span style="font-style: italic;">"src shell"</span>))
  (add-to-list 'org-structure-template-alist (cons <span style="font-style: italic;">"tx"</span> <span style="font-style: italic;">"src text"</span>))
  (add-to-list 'org-structure-template-alist (cons <span style="font-style: italic;">"el"</span> <span style="font-style: italic;">"src emacs-lisp"</span>))
  (add-to-list 'org-structure-template-alist (cons <span style="font-style: italic;">"py"</span> <span style="font-style: italic;">"src python"</span>)))

(use-package org-src
  <span style="font-weight: bold;">:after</span> org
  <span style="font-weight: bold;">:custom</span>
  (org-src-window-setup 'current-window)
  <span style="font-weight: bold;">:config</span>
  (advice-add #'org-edit-src-save
              <span style="font-weight: bold;">:before</span>
              (<span style="font-weight: bold;">lambda</span> ()
                <span style="font-style: italic;">"Delete trailing whitespace."</span>
                (delete-trailing-whitespace))))
</pre>
</div>
</div>
</li>

<li><a id="orgadb9e5d"></a>Org Plain lists<br />
<div class="outline-text-8" id="text-orgadb9e5d">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package org-list
  <span style="font-weight: bold;">:after</span> org
  <span style="font-weight: bold;">:custom</span>
  (org-list-demote-modify-bullet '((<span style="font-style: italic;">"-"</span> . <span style="font-style: italic;">"+"</span>) (<span style="font-style: italic;">"+"</span> . <span style="font-style: italic;">"-"</span>) (<span style="font-style: italic;">"*"</span> . <span style="font-style: italic;">"-"</span>)
                                   (<span style="font-style: italic;">"1."</span> . <span style="font-style: italic;">"1)"</span>) (<span style="font-style: italic;">"1)"</span> . <span style="font-style: italic;">"1."</span>) (<span style="font-style: italic;">"*"</span> . <span style="font-style: italic;">"1."</span>)))
  (org-cycle-include-plain-lists 'integrate)
  (org-list-use-circular-motion t)
  (org-list-allow-alphabetical t))
</pre>
</div>
</div>
</li>

<li><a id="orgc2764ff"></a>Org Archive<br />
<div class="outline-text-8" id="text-orgc2764ff">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">with-eval-after-load</span> 'org
  (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">org-archive</span>)
  (customize-set-variable 'org-archive-default-command 'org-archive-set-tag)
  (customize-set-variable 'org-cycle-open-archived-trees t))

(advice-add #'org-archive-subtree <span style="font-weight: bold;">:around</span>
            #'my/org-archive-subtree--iso-datetree)

<span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/org-archive-subtree--iso-datetree</span> (oldfun <span style="font-weight: bold; text-decoration: underline;">&amp;rest</span> r)
  <span style="font-style: italic;">"Move the current subtree to the archive.</span>

<span style="font-style: italic;">If archiving location is datetree, it supposed to be iso week tree."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">let*</span> ((todo-state (org-get-todo-state))
         (org-archive-location
          (<span style="font-weight: bold;">cond</span>
           ((member todo-state
                    `(,org-warning-keyword-0 ,org-todo-keyword-0 ,org-todo-keyword-1 ,org-todo-keyword-2))
            (org-todo org-done-keyword-1)
            (format <span style="font-style: italic;">"%s::datetree/"</span> (file-name-concat org-directory <span style="font-style: italic;">"archive"</span> (format-time-string <span style="font-style: italic;">"archive_%Y.org"</span>))))
           ((member todo-state
                    `(nil ,org-done-keyword-0 ,org-done-keyword-1))
            (format <span style="font-style: italic;">"%s::datetree/"</span> (file-name-concat org-directory <span style="font-style: italic;">"archive"</span> (format-time-string <span style="font-style: italic;">"archive_%Y.org"</span>))))
           ((member todo-state
                    `(,org-todo-keyword-4 ,org-done-keyword-2))
            (format <span style="font-style: italic;">"%s::* suspended tasks"</span> (file-name-concat org-directory <span style="font-style: italic;">"archive"</span> (format-time-string <span style="font-style: italic;">"archive_%Y.org"</span>)))))))
    (<span style="font-weight: bold;">when</span> (stringp org-archive-location)
      (org-relate-interrelate)
      (advice-add #'org-datetree-find-date-create <span style="font-weight: bold;">:override</span>
                  #'org-datetree-find-iso-week-create)
      (apply oldfun r)
      (advice-remove #'org-datetree-find-date-create
                     #'org-datetree-find-iso-week-create))))

(<span style="font-weight: bold;">with-eval-after-load</span> 'org-ql-view
  (<span style="font-weight: bold;">push</span> '(<span style="font-style: italic;">"Archive entries"</span> .
          (<span style="font-weight: bold;">lambda</span> ()
            <span style="font-style: italic;">"Search for matched entries in archive files.</span>
<span style="font-style: italic;">User is supposed to select 'org-agenda-files as buffers-files in `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">org-ql-search</span><span style="font-style: italic;">' command."</span>
            (<span style="font-weight: bold;">interactive</span>)
            (<span style="font-weight: bold;">let</span> ((org-agenda-files (file-expand-wildcards (file-name-concat org-directory <span style="font-style: italic;">"archive"</span> <span style="font-style: italic;">"archive_*.org"</span>))))
              (call-interactively 'org-ql-search))))
        org-ql-views))

(<span style="font-weight: bold;">with-eval-after-load</span> 'org-agenda
  (define-key org-agenda-mode-map (kbd <span style="font-style: italic;">"C"</span>) #'my/org-archive-find--iso-datetree))

(<span style="font-weight: bold;">with-eval-after-load</span> 'calendar
  (define-key calendar-mode-map (kbd <span style="font-style: italic;">"C"</span>) #'my/org-archive-find--iso-datetree))

<span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/org-archive-find--iso-datetree</span> (date)
  <span style="font-style: italic;">"Find and visit the location of DATE in archivee file.</span>

<span style="font-style: italic;">DATE must be a string representing the date to find and parsable with `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">format-time-string</span><span style="font-style: italic;">'.</span>

<span style="font-style: italic;">If called interactively, it prompt the user to select the date to find."</span>
  (<span style="font-weight: bold;">interactive</span>
   (<span style="font-weight: bold;">cond</span>
    ((eq major-mode 'calendar-mode)
     (list (calendar-date-string (calendar-cursor-to-date))))
    ((eq major-mode 'org-agenda-mode)
     (<span style="font-weight: bold;">let*</span> ((day (<span style="font-weight: bold;">or</span> (get-text-property (min (1- (point-max)) (point)) 'day)
                     (<span style="font-weight: bold;">user-error</span> <span style="font-style: italic;">"Don't know which date to open in calendar"</span>)))
            (date (calendar-gregorian-from-absolute day)))
       (list (calendar-date-string date))))
    (t (<span style="font-weight: bold;">let</span> ((date-select (org-read-date)))
         (list date-select)))))
  (<span style="font-weight: bold;">let*</span> ((d (parse-time-string date))
         (day (decoded-time-day d))
         (month (decoded-time-month d))
         (year (decoded-time-year d)))
    (find-file (file-name-concat org-directory <span style="font-style: italic;">"archive"</span> (format <span style="font-style: italic;">"archive_%d.org"</span> year)))
    (org-datetree-find-iso-week-create `(,month ,day ,year))))
</pre>
</div>
</div>
</li>

<li><a id="orgd4985bb"></a>Org Inline Tasks<br />
<div class="outline-text-8" id="text-orgd4985bb">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package org-inlinetask
  <span style="font-weight: bold;">:after</span> org
  <span style="font-weight: bold;">:custom</span>
  (org-inlinetask-default-state org-todo-keyword-0)
  (org-inlinetask-min-level 10))
</pre>
</div>
</div>
</li>
</ul>
</li>
<li><a id="org9569414"></a>Org Tags<br />
<div class="outline-text-7" id="text-org9569414">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(customize-set-variable 'org-use-tag-inheritance <span style="font-style: italic;">"ARCHIVE"</span>)
(customize-set-variable 'org-tags-column -57)

(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my/org-project-tag</span> <span style="font-style: italic;">"project"</span> <span style="font-style: italic;">"A tag for projects"</span>)
</pre>
</div>
</div>
</li>

<li><a id="orgd8679fb"></a>Org Properties<br />
<div class="outline-text-7" id="text-orgd8679fb">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(customize-set-variable 'org-use-property-inheritance <span style="font-style: italic;">"TIMELIMIT.*"</span>)
(customize-set-variable 'org-highest-priority ?A)
(customize-set-variable 'org-lowest-priority ?Z)
(customize-set-variable 'org-default-priority ?E)
(customize-set-variable 'org-global-properties
                        '((<span style="font-style: italic;">"Effort_ALL"</span>. <span style="font-style: italic;">"0 0:10 0:20 0:30 1:00 1:30 2:00 3:00 4:00 6:00 8:00"</span>)))
</pre>
</div>
</div>
</li>

<li><a id="orgf49fe69"></a>Org Refile<br />
<div class="outline-text-7" id="text-orgf49fe69">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package org-refile
  <span style="font-weight: bold;">:after</span> org
  <span style="font-weight: bold;">:custom</span>
  (org-refile-targets
   `((org-agenda-files <span style="font-weight: bold;">:tag</span> . ,my/org-project-tag)
     (,(directory-files-recursively org-directory <span style="font-style: italic;">"\\.org$"</span>) <span style="font-weight: bold;">:tag</span> . <span style="font-style: italic;">"refile"</span>))))
</pre>
</div>
</div>
</li>
<li><a id="org2b1e24b"></a>Org Time<br />
<div class="outline-text-7" id="text-org2b1e24b">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(customize-set-variable 'org-time-stamp-custom-formats
                        '(<span style="font-style: italic;">"&lt;%m-%d %a&gt;"</span> . <span style="font-style: italic;">"&lt;%H:%M&gt;"</span>))
</pre>
</div>
</div>

<ul class="org-ul">
<li><a id="orgb4f9ff3"></a>Org Progress<br />
<ul class="org-ul">
<li><a id="orgf84d017"></a>Org Clock<br />
<div class="outline-text-9" id="text-orgf84d017">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package org-clock
  <span style="font-weight: bold;">:after</span> org
  <span style="font-weight: bold;">:custom</span>
  (org-clock-into-drawer <span style="font-style: italic;">"CLOCK"</span>)
  (org-clock-out-when-done t)
  (org-clock-persist t)
  (org-clock-persist-file (file-name-concat user-emacs-directory <span style="font-style: italic;">"org-clock-save.el"</span>))
  (org-clock-persist-query-resume nil)
  (org-clock-string-limit 20)
  (org-clock-continuously t)
  (org-clock-ask-before-exiting nil)
  (org-clock-out-remove-zero-time-clocks t)
  <span style="font-weight: bold;">:config</span>
  (org-clock-persistence-insinuate))
</pre>
</div>
</div>
</li>
</ul>
</li>
</ul>
</li>

<li><a id="org80491f4"></a>Org Appearance<br />
<div class="outline-text-7" id="text-org80491f4">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package org
  <span style="font-weight: bold;">:custom</span>
  (org-hide-leading-stars t)
  (org-hide-emphasis-markers t)
  (org-pretty-entities t)
  (org-image-actual-width 100)
  (org-display-remote-inline-images 'cache))
</pre>
</div>
</div>
</li>

<li><a id="org02ac7ec"></a>Babel<br />
<div class="outline-text-7" id="text-org02ac7ec">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"graphviz"</span>
<span style="font-style: italic;">"plantuml"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package ob-core
  <span style="font-weight: bold;">:after</span> org
  <span style="font-weight: bold;">:custom</span>
  (org-confirm-babel-evaluate nil)
  (org-babel-load-languages
   '((C        . t)
     (java     . t)
     (R        . t)
     (shell    . t)
     (ruby     . t)
     (python   . t)
     (org      . t)
     (lua      . t)
     (ledger   . t)
     (gnuplot  . t)
     (dot      . t)
     (plantuml . t)
     (lilypond . t)))
  (org-babel-python-command (executable-find <span style="font-style: italic;">"python3"</span>))
  (org-babel-ruby-command (executable-find <span style="font-style: italic;">"ruby"</span>))
  <span style="font-weight: bold;">:config</span>
  (add-hook 'org-babel-after-execute-hook 'org-display-inline-images)
  (<span style="font-weight: bold;">cond</span>
   ((string= system-type <span style="font-style: italic;">"gnu/linux"</span>)
    (customize-set-variable `org-plantuml-jar-path (expand-file-name <span style="font-style: italic;">"plantuml.jar"</span> <span style="font-style: italic;">"~/.guix-profile/share/java"</span>)))
   ((string= system-type <span style="font-style: italic;">"darwin"</span>)
    (customize-set-variable 'org-plantuml-jar-path <span style="font-style: italic;">"/usr/local/Cellar/plantuml/8041/plantuml.8041.jar"</span>))))
</pre>
</div>
</div>
</li>

<li><a id="orge7f9575"></a>Org ID<br />
<div class="outline-text-7" id="text-orge7f9575">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package org-id
  <span style="font-weight: bold;">:after</span> org
  <span style="font-weight: bold;">:custom</span>
  (org-id-locations-file
   (expand-file-name <span style="font-style: italic;">".org-id-locations"</span> org-directory))
  (org-id-track-globally t)
  (org-id-link-to-org-use-id 'create-if-interactive))
</pre>
</div>
</div>
</li>

<li><a id="org7cac079"></a>Org Crypt<br />
<div class="outline-text-7" id="text-org7cac079">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package org-crypt
  <span style="font-weight: bold;">:after</span> org
  <span style="font-weight: bold;">:custom</span>
  (org-crypt-key user-mail-address)
  (org-tags-exclude-from-inheritance '(<span style="font-style: italic;">"crypt"</span>))
  <span style="font-weight: bold;">:config</span>
  (org-crypt-use-before-save-magic))
</pre>
</div>
</div>
</li>

<li><a id="orgee45646"></a>Org Attach<br />
<div class="outline-text-7" id="text-orgee45646">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">org-attach</span>)

(customize-set-variable 'org-attach-preferred-new-method nil)
</pre>
</div>
</div>
</li>

<li><a id="org939d820"></a>Org Link<br />
<div class="outline-text-7" id="text-org939d820">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">ol</span>)

(org-link-set-parameters <span style="font-style: italic;">"src"</span> <span style="font-weight: bold;">:follow</span> #'org-babel-ref-resolve)
(org-link-set-parameters
 <span style="font-style: italic;">"sudo"</span>
 (<span style="font-weight: bold;">lambda</span> (cmd)
   <span style="font-style: italic;">"Run CMD with sudo."</span>
   (shell-command
    (concat <span style="font-style: italic;">"echo "</span> (shell-quote-argument (read-passwd <span style="font-style: italic;">"Password? "</span>))
            <span style="font-style: italic;">" | sudo -S "</span> cmd))))
</pre>
</div>
</div>

<ul class="org-ul">
<li><a id="org21f548a"></a>Org Follow Link<br />
<div class="outline-text-8" id="text-org21f548a">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package ol
  <span style="font-weight: bold;">:custom</span>
  (org-link-elisp-confirm-function nil)
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">setf</span> (alist-get 'file org-link-frame-setup) 'find-file))
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="orgd4f83a4"></a>Org Export<br />
<ul class="org-ul">
<li><a id="orga5242a3"></a>Org Export General<br />
<div class="outline-text-8" id="text-orga5242a3">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package ox
  <span style="font-weight: bold;">:defer</span> t
  <span style="font-weight: bold;">:after</span> org
  <span style="font-weight: bold;">:custom</span>
  (org-export-with-smart-quotes t)
  (org-export-with-emphasize t)
  (org-export-with-special-strings t)
  (org-export-with-fixed-width t)
  (org-export-with-timestamps t)
  (org-export-preserve-breaks nil)
  (org-export-with-sub-superscripts nil)
  (org-export-with-archived-trees 'headline)
  (org-export-with-author nil)
  (org-export-with-broken-links 'mark)
  (org-export-with-clocks nil)
  (org-export-with-creator nil)
  (org-export-with-drawers '(not <span style="font-style: italic;">"LOGBOOK"</span>))
  (org-export-with-date nil)
  (org-export-with-entities t)
  (org-export-with-email nil)
  (org-export-with-footnotes t)
  (org-export-headline-levels 5)
  (org-export-with-inlinetasks t)
  (org-export-with-section-numbers nil)
  (org-export-with-planning nil)
  (org-export-with-priority nil)
  (org-export-with-properties nil)
  (org-export-with-statistics-cookies t)
  (org-export-with-tags nil)
  (org-export-with-tasks t)
  (org-export-with-latex t)
  (org-export-time-stamp-file nil)
  (org-export-with-title t)
  (org-export-with-toc nil)
  (org-export-with-todo-keywords nil)
  (org-export-with-tables t)
  (org-export-default-language <span style="font-style: italic;">"ja"</span>)
  (org-export-dispatch-use-expert-ui nil))
</pre>
</div>
</div>
</li>

<li><a id="org9f48cde"></a>Org Export HTML<br />
<div class="outline-text-8" id="text-org9f48cde">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package ox-html
  <span style="font-weight: bold;">:defer</span> t
  <span style="font-weight: bold;">:after</span> ox
  <span style="font-weight: bold;">:custom</span>
  (org-html-preamble t)
  (org-html-postamble 'auto)
  (org-html-with-latex t)
  (org-html-container-element <span style="font-style: italic;">"div"</span>)
  (org-html-doctype <span style="font-style: italic;">"xhtml-strict"</span>))
</pre>
</div>
</div>
</li>

<li><a id="org6703fa9"></a>Org Export LaTeX<br />
<div class="outline-text-8" id="text-org6703fa9">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package ox-latex
  <span style="font-weight: bold;">:defer</span> t
  <span style="font-weight: bold;">:after</span> ox
  <span style="font-weight: bold;">:custom</span>
  (org-latex-pdf-process '(<span style="font-style: italic;">"platex %f"</span>
                           <span style="font-style: italic;">"platex %f"</span>
                           <span style="font-style: italic;">"bibtex %b"</span>
                           <span style="font-style: italic;">"platex %f"</span>
                           <span style="font-style: italic;">"platex %f"</span>
                           <span style="font-style: italic;">"dvipdfmx %b.dvi"</span>))
  (org-latex-default-class <span style="font-style: italic;">"jsarticle"</span>)
  <span style="font-weight: bold;">:config</span>
  (add-to-list 'org-latex-classes
               '(<span style="font-style: italic;">"jsarticle"</span>
                 <span style="font-style: italic;">"\\documentclass[dvipdfmx,12pt]{jsarticle}"</span>
                 (<span style="font-style: italic;">"\\section{%s}"</span> . <span style="font-style: italic;">"\\section*{%s}"</span>)
                 (<span style="font-style: italic;">"\\subsection{%s}"</span> . <span style="font-style: italic;">"\\subsection*{%s}"</span>)
                 (<span style="font-style: italic;">"\\subsubsection{%s}"</span> . <span style="font-style: italic;">"\\subsubsection*{%s}"</span>)
                 (<span style="font-style: italic;">"\\paragraph{%s}"</span> . <span style="font-style: italic;">"\\paragraph*{%s}"</span>)
                 (<span style="font-style: italic;">"\\subparagraph{%s}"</span> . <span style="font-style: italic;">"\\subparagraph*{%s}"</span>)))
  (add-to-list 'org-latex-classes
               `(<span style="font-style: italic;">"beamer"</span>
                 <span style="font-style: italic;">"\\documentclass[presentation,dvipdfmx,18pt]{beamer}\n"</span>
                 (<span style="font-style: italic;">"\\section{%s}"</span> . <span style="font-style: italic;">"\\section*{%s}"</span>)
                 (<span style="font-style: italic;">"\\subsection{%s}"</span> . <span style="font-style: italic;">"\\subsection*{%s}"</span>)
                 (<span style="font-style: italic;">"\\subsubsection{%s}"</span> . <span style="font-style: italic;">"\\subsubsection*{%s}"</span>))))
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="orgc96df3d"></a>Org Plot<br />
<div class="outline-text-7" id="text-orgc96df3d">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"gnuplot"</span>
<span style="font-style: italic;">"emacs-gnuplot"</span>
<span style="font-style: italic;">"emacs-mkmcc-gnuplot-mode"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package org-plot
  <span style="font-weight: bold;">:after</span> org)
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="org639bd5d"></a>external packages for org<br />
<ul class="org-ul">
<li><a id="org186ffd7"></a>org-edna<br />
<div class="outline-text-7" id="text-org186ffd7">
<p>
<a href="https://www.nongnu.org/org-edna-el/">Org Edna</a> allows to org entries to be blockers and action triggers, which is very intresting feature especially for managing successive set of tasks or any correlated tasks.
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-org-edna"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">with-eval-after-load</span> 'org
  (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">org-edna</span>)
  (org-edna-mode 1))
</pre>
</div>
</div>
</li>

<li><a id="org70b4301"></a>org-contacts<br />
<div class="outline-text-7" id="text-org70b4301">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-org-contacts"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">with-eval-after-load</span> 'org
  (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">org-contacts</span>)
  (customize-set-variable 'org-contacts-files
                          `(,(file-name-concat org-directory <span style="font-style: italic;">"lists"</span> <span style="font-style: italic;">"contacts.org.gpg"</span>))))
</pre>
</div>
</div>
</li>
<li><a id="orgd6c8417"></a>org-drill<br />
<div class="outline-text-7" id="text-orgd6c8417">
<p>
<a href="https://gitlab.com/phillord/org-drill">org-drill</a> helps me to learn english words and phrases. <a href="https://youtu.be/SGzdFtN_NqE">This video</a> introduces how I use org-drill.
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-org-drill"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-style: italic;">"https://gitlab.com/phillord/org-drill/-/tags?format=atom"</span> soft_update)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package org-drill
  <span style="font-weight: bold;">:after</span> org
  <span style="font-weight: bold;">:custom</span>
  (org-drill-spaced-repetition-algorithm 'sm5)
  (org-drill-sm5-initial-interval 10.0)
  (org-drill-add-random-noise-to-intervals-p t)
  (org-drill-adjust-intervals-for-early-and-late-repetitions-p t)
  (org-drill-days-before-old 20)
  (org-drill-learn-fraction 0.65)
  (org-drill-overdue-interval-factor 1.6))
</pre>
</div>
</div>
</li>

<li><a id="org95d8951"></a>org-ql<br />
<div class="outline-text-7" id="text-org95d8951">
<p>
<a href="https://github.com/alphapapa/org-ql">Org QL</a> enables me to issue queries to search org entries with either SQL-like format or plain search strings.
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-org-ql"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-style: italic;">"https://github.com/alphapapa/org-ql/releases.atom"</span> soft_update)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">with-eval-after-load</span> 'org
  (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">org-ql</span>)
  (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">org-ql-search</span>)
  (customize-set-variable 'org-ql-search-directories-files-recursive t)
  (org-ql-defpred (tags-expanded expanded-tags tags-x xtags) (<span style="font-weight: bold; text-decoration: underline;">&amp;rest</span> tags)
    <span style="font-style: italic;">"Return non-nil if current heading has one or more of TAGS.</span>
<span style="font-style: italic;">If TAGS contains a group tag, all tags in the group is used to match.</span>
<span style="font-style: italic;">Both inherited and local tags is tested."</span>
    <span style="font-weight: bold;">:normalizers</span> ((`(,predicate-names . ,tags)
                   `(tags-expanded ,@tags)))
    <span style="font-weight: bold;">:body</span> (apply #'org-ql--predicate-tags
                 (seq-uniq (--mapcat (org-tags-expand it t)
                                     tags))))
  (org-ql-defpred (category-inherited) (<span style="font-weight: bold; text-decoration: underline;">&amp;rest</span> categories)
    <span style="font-style: italic;">"Return non-nil if current heading has CATEGORY.</span>
<span style="font-style: italic;">Ancestors are looked up If current heading has no CATEGORY."</span>
    <span style="font-weight: bold;">:body</span> (when-let ((category (<span style="font-weight: bold;">or</span> (org-get-category (point))
                                   (org-entry-get (point) <span style="font-style: italic;">"CATEGORY"</span> t))))
            (<span style="font-weight: bold;">cl-typecase</span> categories
              (null t)
              (otherwise (member category categories)))))
  (<span style="font-weight: bold;">with-eval-after-load</span> 'org-expiry
    (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">org-element</span>)
    (org-ql-defpred expired ()
      <span style="font-style: italic;">"Return non-nil if the entry is expired."</span>
      <span style="font-weight: bold;">:body</span> (org-expiry-expired-p))))
</pre>
</div>
</div>
</li>

<li><a id="org4a4fab0"></a>org-ml<br />
<div class="outline-text-7" id="text-org4a4fab0">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-style: italic;">"https://github.com/ndwarshuis/org-ml/releases.atom"</span> soft_update)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package org-ml
  <span style="font-weight: bold;">:straight</span> t
  <span style="font-weight: bold;">:after</span> org)
</pre>
</div>
</div>
</li>

<li><a id="org80c7ddf"></a>org-roam<br />
<div class="outline-text-7" id="text-org80c7ddf">
<p>
org-roam v2
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-org-roam"</span>
<span style="font-style: italic;">"emacs-emacsql-sqlite3"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-style: italic;">"https://github.com/org-roam/org-roam/releases.atom"</span> soft_update)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package org-roam
  <span style="font-weight: bold;">:after</span> org
  <span style="font-weight: bold;">:bind</span> ((<span style="font-style: italic;">"C-c n l"</span> . org-roam-buffer-toggle)
         (<span style="font-style: italic;">"C-c n f"</span> . org-roam-node-find)
         (<span style="font-style: italic;">"C-c n i"</span> . org-roam-node-insert)
         (<span style="font-style: italic;">"C-c n S"</span> . org-roam-db-sync))
  <span style="font-weight: bold;">:custom</span>
  (org-roam-directory org-directory)
  (org-roam-db-location (file-name-concat user-emacs-directory <span style="font-style: italic;">"org-roam.db"</span>))
  (org-roam-database-connector 'sqlite3)
  (org-roam-db-update-on-save nil)
  (org-roam-db-extra-links-exclude-keys
   '((node-property <span style="font-style: italic;">"ROAM_REFS"</span>)
     (node-property <span style="font-style: italic;">"PARENT"</span>)
     (keyword <span style="font-style: italic;">"transclude"</span>)))
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">setq</span> org-roam-mode-sections
        (list #'org-roam-backlinks-section
              #'org-roam-reflinks-section
              #'org-roam-unlinked-references-section)))
</pre>
</div>
</div>
</li>
<li><a id="org170ec13"></a>org-mime<br />
<div class="outline-text-7" id="text-org170ec13">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-org-mime"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package org-mime
  <span style="font-weight: bold;">:after</span> org
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">push</span> '(<span style="font-style: italic;">"Send An Email"</span>) org-speed-commands))
</pre>
</div>
</div>
</li>

<li><a id="org65a28f1"></a>org-web-tools<br />
<div class="outline-text-7" id="text-org65a28f1">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-org-web-tools"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package org-web-tools
  <span style="font-weight: bold;">:after</span> org
  <span style="font-weight: bold;">:demand</span> t
  <span style="font-weight: bold;">:bind</span> ((<span style="font-style: italic;">"C-c C-;"</span> . org-web-tools-insert-link-for-url)))
</pre>
</div>
</div>
</li>

<li><a id="org25e091a"></a>org-volume<br />
<div class="outline-text-7" id="text-org25e091a">
<p>
<a href="https://github.com/akirak/org-volume">org-volume</a> can be used to insert book information in dynamic block.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-style: italic;">"https://github.com/akirak/org-volume/releases.atom"</span> soft_update)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package org-volume
  <span style="font-weight: bold;">:straight</span> (org-volume
             <span style="font-weight: bold;">:host</span> github
             <span style="font-weight: bold;">:repo</span> <span style="font-style: italic;">"akirak/org-volume"</span>
             <span style="font-weight: bold;">:branch</span> <span style="font-style: italic;">"master"</span>))
</pre>
</div>
</div>
</li>

<li><a id="orgf491327"></a>org-clock-convenience<br />
<div class="outline-text-7" id="text-orgf491327">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-style: italic;">"https://github.com/dfeich/org-clock-convenience/releases.atom"</span> soft_update)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package org-clock-convenience
  <span style="font-weight: bold;">:straight</span> t
  <span style="font-weight: bold;">:after</span> (org)
  <span style="font-weight: bold;">:bind</span> (<span style="font-weight: bold;">:map</span> org-agenda-mode-map
              (<span style="font-style: italic;">"@"</span>   . org-clock-convenience-fill-gap)
              (<span style="font-style: italic;">"C-@"</span> . org-clock-convenience-fill-gap-both)))
</pre>
</div>
</div>
</li>

<li><a id="org7f47d8c"></a>org-reveal<br />
<div class="outline-text-7" id="text-org7f47d8c">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-org-reveal"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package ox-reveal
  <span style="font-weight: bold;">:after</span> ox)
</pre>
</div>
</div>
</li>

<li><a id="orga56fc43"></a>org-expiry<br />
<div class="outline-text-7" id="text-orga56fc43">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-org-contrib"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">org-expiry</span>)

(customize-set-variable 'org-expiry-inactive-timestamps t)
(customize-set-variable 'org-expiry-handler-function
                        'org-expiry-archive-subtree)

(add-hook 'org-capture-prepare-finalize-hook
          #'org-expiry-insert-created)

(org-expiry-insinuate)
</pre>
</div>
</div>
</li>

<li><a id="org1121369"></a>ob-async<br />
<div class="outline-text-7" id="text-org1121369">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-ob-async"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package ob-async
  <span style="font-weight: bold;">:after</span> ob-core)
</pre>
</div>
</div>
</li>
<li><a id="org80b8917"></a>ob-lilypond<br />
<div class="outline-text-7" id="text-org80b8917">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package ob-lilypond
  <span style="font-weight: bold;">:after</span> (org lilypond-mode)
  <span style="font-weight: bold;">:custom</span>
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(org-babel-lilypond-commands '("lilypond" "firefox" "fluidsynth -a alsa -m alsa_seq -l"))</span>
  (org-babel-lilypond-commands '(<span style="font-style: italic;">"lilypond"</span> <span style="font-style: italic;">"firefox"</span> <span style="font-style: italic;">"xdg-open"</span>))
  (org-babel-lilypond-arrange-mode t))
</pre>
</div>
</div>
</li>

<li><a id="org66c0365"></a>ox-hugo<br />
<div class="outline-text-7" id="text-org66c0365">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-ox-hugo"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package ox-hugo
  <span style="font-weight: bold;">:defer</span> t
  <span style="font-weight: bold;">:after</span> ox)
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="orge921389"></a>utility functions for org<br />
<div class="outline-text-6" id="text-orge921389">
<div class="org-src-container">
<pre class="src src-conf">d &lt;&lt;share-dir()&gt;&gt;/emacs/org-readable 0755 - - 3d
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/org-babel-lob-ingest-batch</span> ()
  (<span style="font-weight: bold;">interactive</span>)
  (mapc (<span style="font-weight: bold;">lambda</span> (dir)
          (<span style="font-weight: bold;">dolist</span> (f (directory-files (expand-file-name dir org-directory) <span style="font-style: italic;">"</span><span style="font-weight: bold; font-style: italic;">\</span><span style="font-style: italic;">.org$"</span>))
            (org-babel-lob-ingest f)))
        '(<span style="font-style: italic;">"agenda"</span> <span style="font-style: italic;">"lists"</span> <span style="font-style: italic;">"wiki"</span> <span style="font-style: italic;">"notes"</span>)))

(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">org-readable-directory</span>
  (expand-file-name <span style="font-style: italic;">"org-readable"</span>
                    user-emacs-directory)
  <span style="font-style: italic;">"A directory where generated html files are located in org-readable."</span>)

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">org-readable</span> ()
  <span style="font-style: italic;">"Show current org subtree in EWW."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">let*</span> ((heading (org-get-heading t t t t))
         (org-export-show-temporary-export-buffer nil)
         (export-buf-name <span style="font-style: italic;">"*Org HTML Export*"</span>)
         (org-export-with-broken-links 'mark)
         (org-export-babel-evaluate nil)
         (id (org-id-get))
         (uuid (downcase (<span style="font-weight: bold;">if</span> id id (org-id-uuid))))
         (org-readable-file (format <span style="font-style: italic;">"%s/%s.html"</span> org-readable-directory uuid)))
    (org-html-export-as-html nil t nil)
    (<span style="font-weight: bold;">with-current-buffer</span> export-buf-name
      (write-file org-readable-file)
      (eww-open-file org-readable-file))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">org-property-copy-as-kill</span> ()
  <span style="font-style: italic;">"Prompt user to select property to append to the kill ring.</span>

<span style="font-style: italic;">If property's value matches $(...) format, ... is interpreted as shell command and execute it."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">let*</span> ((properties (org-entry-properties))
         (prop-key-to-copy
          (completing-read <span style="font-style: italic;">"Property name: "</span>
                           (mapcar #'(lambda (var) (car var)) properties))))
    (<span style="font-weight: bold;">when</span> (stringp prop-key-to-copy)
      (<span style="font-weight: bold;">let*</span> ((prop-value (cdr (assoc prop-key-to-copy properties)))
             (str-to-copy
              (<span style="font-weight: bold;">cond</span>
               ((string-match <span style="font-style: italic;">"$(</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">.+</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">)"</span> prop-value)
                (shell-command-to-string (match-string 1 prop-value)))
               (t prop-value))))
        (kill-new str-to-copy)))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/org-reset-dwim</span> ()
  <span style="font-style: italic;">"Do reset procedure in each context."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">cond</span>
   ((org-at-table-p) (org-table-blank-field))
   ((org-in-subtree-not-table-p)
    (<span style="font-weight: bold;">org-save-outline-visibility</span> t
      (org-reset-checkbox-state-subtree)))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/org-clock-remove-old-clock-entries</span> (n <span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> min)
  <span style="font-style: italic;">"Remove clock entries whose end is older than N weeks in current subtree.</span>
<span style="font-style: italic;">Skip over dangling clock entries."</span>
  (<span style="font-weight: bold;">interactive</span> <span style="font-style: italic;">"nnumber of weeks: "</span>)
  (<span style="font-weight: bold;">org-save-outline-visibility</span> t
    (<span style="font-weight: bold;">save-excursion</span>
      (org-back-to-heading t)
      (org-show-all)
      (<span style="font-weight: bold;">let</span> ((drawer (re-search-forward org-clock-drawer-start-re (<span style="font-weight: bold;">save-excursion</span> (org-end-of-subtree)) t))
            (case-fold-search t))
        (<span style="font-weight: bold;">when</span> drawer
          (<span style="font-weight: bold;">let*</span> ((min-applied min)
                 (re org-clock-line-re)
                 (end (<span style="font-weight: bold;">save-excursion</span> (re-search-forward org-clock-drawer-end-re (<span style="font-weight: bold;">save-excursion</span> (org-end-of-subtree)) nil)))
                 (end-mkr (set-marker (mark-marker) end)))
            (<span style="font-weight: bold;">while</span> (re-search-forward re (marker-position end-mkr) t)
              (skip-chars-forward <span style="font-style: italic;">" \t\r"</span>)
              (looking-at org-tr-regexp-both)
              (<span style="font-weight: bold;">unless</span> (<span style="font-weight: bold;">and</span> (numberp min-applied)
                           (natnump (<span style="font-weight: bold;">setq</span> min-applied (1- min-applied))))
                (<span style="font-weight: bold;">when</span> (&gt;= (/ (time-to-number-of-days (org-time-since (match-string-no-properties 2))) 7)
                          (float n))
                  (kill-whole-line)))))))
      (org-clock-remove-empty-clock-drawer))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/org-remove-old-state-change-entries</span> (n)
  <span style="font-style: italic;">"Remove state change entries whose inactive timestamp is older than N weeks in current subtree.</span>

<span style="font-style: italic;">This command remove all lines that have an old inactive timestamp regardless</span>
<span style="font-style: italic;"> whether it is a state change log or not."</span>
  (<span style="font-weight: bold;">interactive</span> <span style="font-style: italic;">"nnumber of weeks: "</span>)
  (<span style="font-weight: bold;">org-save-outline-visibility</span> t
    (<span style="font-weight: bold;">save-excursion</span>
      (org-back-to-heading t)
      (org-show-all)
      (<span style="font-weight: bold;">let*</span> ((drawer-end (<span style="font-weight: bold;">save-excursion</span> (re-search-forward org-logbook-drawer-re (<span style="font-weight: bold;">save-excursion</span> (org-end-of-subtree)) t)))
             (case-fold-search t)
             (re org-ts-regexp-inactive)
             (end-mkr (set-marker (mark-marker) drawer-end)))
        (goto-char (match-beginning 0))
        (<span style="font-weight: bold;">while</span> (re-search-forward re (marker-position end-mkr) t)
          (<span style="font-weight: bold;">when</span> (&gt;= (/ (time-to-number-of-days (org-time-since (match-string-no-properties 0))) 7)
                    (float n))
            (kill-whole-line))))
      (org-clock-remove-empty-clock-drawer))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">org-download-video-link-at-point</span> (<span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> playlistp)
  <span style="font-style: italic;">"Download video file at point.</span>
<span style="font-style: italic;">With `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">C-u</span><span style="font-style: italic;">' prefix arg, try to download all videos in playlist.</span>

<span style="font-style: italic;">Video file is expected to appear in org-link."</span>
  (<span style="font-weight: bold;">interactive</span> <span style="font-style: italic;">"P"</span>)
  (org-link-at-point-map (<span style="font-weight: bold;">lambda</span> (url title)
                           (my/download-video url title playlistp))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">org-download-audio-link-at-point</span> ()
  <span style="font-style: italic;">"Download audio file at point.</span>

<span style="font-style: italic;">Audio file is expected to appear in org-link."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (org-link-at-point-map (<span style="font-weight: bold;">lambda</span> (url title)
                           (my/download-audio url title))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">org-show-media-duration-at-point</span> ()
  <span style="font-style: italic;">"Show duration of media at point."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (org-link-at-point-map (<span style="font-weight: bold;">lambda</span> (url title)
                           (show-media-duration url))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">org-link-at-point-map</span> (<span style="font-weight: bold;">function</span>)
  <span style="font-style: italic;">"Call `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">FUNCTION</span><span style="font-style: italic;">' with url and title obtained from org-link at point."</span>
  (<span style="font-weight: bold;">let*</span> ((context (org-element-lineage
                   (org-element-context)
                   '(link)
                   t))
         (type (org-element-property <span style="font-weight: bold;">:type</span> context))
         (path (org-element-property <span style="font-weight: bold;">:path</span> context))
         (desc (when-let ((begin (org-element-property <span style="font-weight: bold;">:contents-begin</span> context))
                          (end (org-element-property <span style="font-weight: bold;">:contents-end</span> context)))
                 (buffer-substring begin end))))
    (<span style="font-weight: bold;">cond</span>
     ((string-match-p <span style="font-style: italic;">"https?"</span> type)
      (funcall function (org-link-unescape (concat type <span style="font-style: italic;">":"</span> path)) desc))
     ((string-match-p <span style="font-style: italic;">"elfeed"</span> type)
      (<span style="font-weight: bold;">save-excursion</span>
        (org-open-at-point)
        (<span style="font-weight: bold;">when</span> (eq major-mode 'elfeed-show-mode)
          (when-let ((url (<span style="font-weight: bold;">or</span> (caar (elfeed-entry-enclosures elfeed-show-entry))
                              (elfeed-entry-link elfeed-show-entry)))
                     (title (elfeed-entry-title elfeed-show-entry)))
            (funcall function url title))
          (quit-window)))))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">org-send-email</span> (<span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> arg)
  <span style="font-style: italic;">"Send a html email extracted from current org entry.</span>

<span style="font-style: italic;">Given a `\\[</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">universal-argument</span><span style="font-style: italic;">]' prefix `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">ARG</span><span style="font-style: italic;">', send an ascii email instead."</span>
  (<span style="font-weight: bold;">interactive</span> <span style="font-style: italic;">"P"</span>)
  (<span style="font-weight: bold;">cond</span>
   ((equal arg '(4))
    (call-interactively #'org-send-email-ascii))
   (t
    (<span style="font-weight: bold;">let</span> ((org-mime-use-property-inheritance t))
      (call-interactively #'org-mime-org-subtree-htmlize)))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">org-send-email-ascii</span> ()
  <span style="font-style: italic;">"Send a mail whose contents converted from current org entry.</span>

<span style="font-style: italic;">Format of mail contents is plain text."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">let</span> ((heading (org-get-heading t t t t))
        (org-export-show-temporary-export-buffer nil)
        (export-buf-name <span style="font-style: italic;">"*Org ASCII Export*"</span>)
        (org-export-with-toc nil)
        (org-export-with-author nil))
    (org-ascii-export-as-ascii nil t t t)
    (mail-simple-send (<span style="font-weight: bold;">or</span> (org-entry-get (point) <span style="font-style: italic;">"MAIL_TO"</span> t)
                          (read-string <span style="font-style: italic;">"MAIL_TO: "</span>))
                      heading
                      (<span style="font-weight: bold;">with-current-buffer</span> export-buf-name
                        (buffer-string)))
    (kill-buffer export-buf-name)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">org-display-iso-week-at-point</span> ()
  <span style="font-style: italic;">"Display ISO 8601 week number correspoinds to time stamp at point."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">let</span> ((ts (org-timestamp-at-point)))
    (<span style="font-weight: bold;">when</span> ts
      (message <span style="font-style: italic;">"W%s"</span> (format-time-string <span style="font-style: italic;">"%V"</span> (org-read-date nil t ts nil))))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">org-timestamp-at-point</span> ()
  <span style="font-style: italic;">"Return time stamp string at point."</span>
  (<span style="font-weight: bold;">let</span> ((ts-bound (org-in-regexp (org-re-timestamp 'all))))
    (<span style="font-weight: bold;">when</span> ts-bound
      (buffer-substring (car ts-bound) (cdr ts-bound)))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/org-alter-heading</span> ()
  <span style="font-style: italic;">"Interpolate heading for this org entry."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">let*</span> ((old-heading (org-get-heading t t t t))
         (new-heading (read-string <span style="font-style: italic;">"Heading: "</span> old-heading)))
    (<span style="font-weight: bold;">save-excursion</span>
      (org-back-to-heading t)
      (replace-string old-heading new-heading nil
                      (line-beginning-position) (line-end-position))
      (org-align-tags))
    (org-add-log-setup 'state new-heading old-heading 'state)))
</pre>
</div>
</div>
</li>

<li><a id="orge3c817d"></a>keybindings for org<br />
<div class="outline-text-6" id="text-orge3c817d">
<p>
speed commands and hydra-org.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package org-keys
  <span style="font-weight: bold;">:after</span> org
  <span style="font-weight: bold;">:custom</span>
  (org-use-speed-commands
   (<span style="font-weight: bold;">lambda</span> () (<span style="font-weight: bold;">and</span> (looking-at org-outline-regexp) (looking-back <span style="font-style: italic;">"^</span><span style="font-weight: bold; font-style: italic;">\</span><span style="font-style: italic;">**"</span>))))
  (org-speed-commands
   '((<span style="font-style: italic;">"Outline Navigation"</span>)
     (<span style="font-style: italic;">"n"</span> . (org-speed-move-safe 'org-next-visible-heading))
     (<span style="font-style: italic;">"p"</span> . (org-speed-move-safe 'org-previous-visible-heading))
     (<span style="font-style: italic;">"f"</span> . (org-speed-move-safe 'org-forward-heading-same-level))
     (<span style="font-style: italic;">"b"</span> . (org-speed-move-safe 'org-backward-heading-same-level))
     (<span style="font-style: italic;">"F"</span> . org-next-block)
     (<span style="font-style: italic;">"B"</span> . org-previous-block)
     (<span style="font-style: italic;">"u"</span> . (org-speed-move-safe 'outline-up-heading))
     (<span style="font-style: italic;">"j"</span> . org-goto)
     (<span style="font-style: italic;">"g"</span> . (org-refile t))
     (<span style="font-style: italic;">"Outline Visibility"</span>)
     (<span style="font-style: italic;">"c"</span> . org-ctrl-c-tab)
     (<span style="font-style: italic;">"C"</span> . org-shifttab)
     (<span style="font-style: italic;">" "</span> . org-display-outline-path)
     (<span style="font-style: italic;">"N"</span> . my/toggle-narrow-dwim)
     (<span style="font-style: italic;">"z"</span> . org-toggle-narrow-to-subtree)
     (<span style="font-style: italic;">"="</span> . org-columns)
     (<span style="font-style: italic;">"/"</span> . org-sparse-tree)
     (<span style="font-style: italic;">"Outline Structure Editing"</span>)
     (<span style="font-style: italic;">"U"</span> . org-metaup)
     (<span style="font-style: italic;">"D"</span> . org-metadown)
     (<span style="font-style: italic;">"r"</span> . org-metaright)
     (<span style="font-style: italic;">"l"</span> . org-metaleft)
     (<span style="font-style: italic;">"R"</span> . org-shiftmetaright)
     (<span style="font-style: italic;">"L"</span> . org-shiftmetaleft)
     (<span style="font-style: italic;">"i"</span> . (<span style="font-weight: bold;">progn</span> (forward-char 1) (call-interactively 'org-insert-heading-respect-content)))
     (<span style="font-style: italic;">"^"</span> . org-sort)
     (<span style="font-style: italic;">"w"</span> . org-refile)
     (<span style="font-style: italic;">"a"</span> . org-archive-subtree-default-with-confirmation)
     (<span style="font-style: italic;">"@"</span> . org-mark-subtree)
     (<span style="font-style: italic;">"#"</span> . org-toggle-comment)
     (<span style="font-style: italic;">"x"</span> . org-expiry-process-entry)
     (<span style="font-style: italic;">"Clock Commands"</span>)
     (<span style="font-style: italic;">"I"</span> . org-clock-in)
     (<span style="font-style: italic;">"O"</span> . (<span style="font-weight: bold;">lambda</span> ()
              (<span style="font-weight: bold;">interactive</span>)
              (<span style="font-weight: bold;">let</span> ((org-clock-out-remove-zero-time-clocks nil))
                (org-clock-out nil t))))
     (<span style="font-style: italic;">"X"</span> . org-clock-cancel)
     (<span style="font-style: italic;">"Meta Data Editing"</span>)
     (<span style="font-style: italic;">"t"</span> . org-todo)
     (<span style="font-style: italic;">","</span> . (org-priority))
     (<span style="font-style: italic;">"0"</span> . (org-priority ?\ ))
     (<span style="font-style: italic;">":"</span> . org-set-tags-command)
     (<span style="font-style: italic;">"P"</span> . org-set-property)
     (<span style="font-style: italic;">"e"</span> . org-set-effort)
     (<span style="font-style: italic;">"E"</span> . org-inc-effort)
     (<span style="font-style: italic;">"s"</span> . org-schedule)
     (<span style="font-style: italic;">"d"</span> . org-deadline)
     (<span style="font-style: italic;">"v"</span> . org-property-copy-as-kill)
     (<span style="font-style: italic;">"W"</span> . (<span style="font-weight: bold;">lambda</span> (m) (<span style="font-weight: bold;">interactive</span> <span style="font-style: italic;">"sMinutes before warning: "</span>) (org-entry-put (point) <span style="font-style: italic;">"APPT_WARNTIME"</span> m)))
     (<span style="font-style: italic;">"Org Capture"</span>)
     (<span style="font-style: italic;">"Misc"</span>)
     (<span style="font-style: italic;">"$"</span> . org-archive-subtree)
     (<span style="font-style: italic;">"!"</span> . org-readable)
     (<span style="font-style: italic;">"o"</span> . org-open-at-point)
     (<span style="font-style: italic;">"M"</span> . org-send-email)
     (<span style="font-style: italic;">"?"</span> . org-speed-command-help)
     (<span style="font-style: italic;">"&lt;"</span> . (org-agenda-set-restriction-lock 'subtree))
     (<span style="font-style: italic;">"&gt;"</span> . (org-agenda-remove-restriction-lock)))))

(<span style="font-weight: bold;">with-eval-after-load</span> 'hydra
  (defhydra hydra-org (global-map <span style="font-style: italic;">"C-o"</span>
                                  <span style="font-weight: bold;">:color</span> teal)
    <span style="font-style: italic;">"Org Search"</span>
    (<span style="font-style: italic;">"a"</span> org-agenda)
    (<span style="font-style: italic;">"c"</span> org-capture)
    (<span style="font-style: italic;">"t"</span> org-set-tags-command)
    (<span style="font-style: italic;">"j"</span> org-clock-goto)
    (<span style="font-style: italic;">"g"</span> consult-org-agenda)
    (<span style="font-style: italic;">"h"</span> consult-outline)
    (<span style="font-style: italic;">"ee"</span> my/org-english-capture)
    (<span style="font-style: italic;">"ed"</span> my/org-english-drill)
    (<span style="font-style: italic;">"eD"</span> my/org-english-drill-resume)
    (<span style="font-style: italic;">"ec"</span> my/cloze-deletion-replace)
    (<span style="font-style: italic;">"s"</span> org-store-link)
    (<span style="font-style: italic;">"C-s"</span> org-save-all-org-buffers)
    (<span style="font-style: italic;">"TAB"</span> org-indent-mode)
    (<span style="font-style: italic;">"i"</span> org-info-find-node)
    (<span style="font-style: italic;">"&amp;"</span> org-mark-ring-goto)
    (<span style="font-style: italic;">"I"</span> org-clock-in)
    (<span style="font-style: italic;">"O"</span> org-clock-out)
    (<span style="font-style: italic;">"X"</span> org-clock-cancel)
    (<span style="font-style: italic;">"qq"</span> org-ql-search)
    (<span style="font-style: italic;">"qv"</span> org-ql-view)
    (<span style="font-style: italic;">"r"</span> my/org-archive-find--iso-datetree)
    (<span style="font-style: italic;">"le"</span> my/org-english-lookup)
    (<span style="font-style: italic;">"bi"</span> my/org-babel-lob-ingest-batch)
    (<span style="font-style: italic;">"@"</span> org-mark-subtree)
    (<span style="font-style: italic;">"="</span> org-clock-sum-all)
    (<span style="font-style: italic;">"SPC"</span> my/org-reset-dwim)
    (<span style="font-style: italic;">"C-g"</span> nil <span style="font-style: italic;">"quit"</span>)))
</pre>
</div>
</div>

<ul class="org-ul">
<li><a id="orgd37ba39"></a>org mode map<br />
<div class="outline-text-7" id="text-orgd37ba39">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">let</span> ((map org-mode-map))
  (define-key map (kbd <span style="font-style: italic;">"C-j"</span>) #'org-return)
  (define-key map (kbd <span style="font-style: italic;">"C-M-j"</span>) #'org-return-indent)
  (define-key map (kbd <span style="font-style: italic;">"M-j"</span>) #'org-meta-return)
  (define-key map (kbd <span style="font-style: italic;">"C-S-p"</span>) #'org-previous-item)
  (define-key map (kbd <span style="font-style: italic;">"C-S-n"</span>) #'org-next-item)
  (define-key map (kbd <span style="font-style: italic;">"C-S-u"</span>) #'org-up-element)
  (define-key map (kbd <span style="font-style: italic;">"C-$"</span>) #'org-down-element)
  (define-key map (kbd <span style="font-style: italic;">"C-&lt;"</span>) #'org-previous-link)
  (define-key map (kbd <span style="font-style: italic;">"C-&gt;"</span>) #'org-next-link)
  (define-key map (kbd <span style="font-style: italic;">"C-c @"</span>) #'org-mark-element)
  (define-key map (kbd <span style="font-style: italic;">"C-c C-SPC"</span>) #'org-mark-subtree)
  (define-key map (kbd <span style="font-style: italic;">"C-c D v"</span>) #'org-download-video-link-at-point)
  (define-key map (kbd <span style="font-style: italic;">"C-c D a"</span>) #'org-download-audio-link-at-point)
  (define-key map (kbd <span style="font-style: italic;">"C-c D ="</span>) #'org-show-media-duration-at-point)
  (define-key map (kbd <span style="font-style: italic;">"C-c !"</span>) #'org-readable)
  (define-key map (kbd <span style="font-style: italic;">"C-c C-a"</span>) nil)
  (define-key map (kbd <span style="font-style: italic;">"C-,"</span>) nil)
  (define-key map (kbd <span style="font-style: italic;">"M-h"</span>) nil))
</pre>
</div>
</div>
</li>
</ul>
</li>
</ul>
</li>

<li><a id="org419bd11"></a>Completion framework<br />
<div class="outline-text-5" id="text-org419bd11">
</div>

<ul class="org-ul">
<li><a id="org5cc7bc0"></a>vertico<br />
<div class="outline-text-6" id="text-org5cc7bc0">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-vertico"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-style: italic;">"https://github.com/minad/vertico/releases.atom"</span> soft_update)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package vertico
  <span style="font-weight: bold;">:config</span>
  (bind-keys <span style="font-weight: bold;">:map</span> vertico-map
             (<span style="font-style: italic;">"M-w"</span> . vertico-save))
  (vertico-mode))
</pre>
</div>
</div>
</li>

<li><a id="org841da05"></a>consult<br />
<div class="outline-text-6" id="text-org841da05">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-consult"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-style: italic;">"https://github.com/minad/consult/releases.atom"</span> soft_update)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package consult
  <span style="font-weight: bold;">:after</span> vertico
  <span style="font-weight: bold;">:bind</span>
  (<span style="font-weight: bold;">:map</span> global-map
        (<span style="font-style: italic;">"C-;"</span> . consult-buffer)
        (<span style="font-style: italic;">"C-c m"</span> . consult-mode-command)
        (<span style="font-style: italic;">"C-c r"</span> . consult-recent-file)
        (<span style="font-style: italic;">"C-c g"</span> . consult-outline)
        (<span style="font-style: italic;">"C-x M-:"</span> . consult-complex-command)
        (<span style="font-style: italic;">"M-y"</span> . consult-yank-pop)
        (<span style="font-style: italic;">"C-M-y"</span> . consult-yank-from-kill-ring)
        (<span style="font-style: italic;">"M-g M-g"</span> . consult-goto-line)
        (<span style="font-style: italic;">"M-g m"</span> . consult-mark)
        (<span style="font-style: italic;">"M-g M"</span> . consult-global-mark)
        (<span style="font-style: italic;">"M-g i"</span> . consult-imenu)
        (<span style="font-style: italic;">"M-g I"</span> . consult-imenu-multi)
        (<span style="font-style: italic;">"M-s e"</span> . consult-isearch)
        (<span style="font-style: italic;">"M-s \\"</span> . consult-locate)
        (<span style="font-style: italic;">"M-s g"</span> . consult-grep)
        (<span style="font-style: italic;">"M-s G"</span> . consult-git-grep)
        (<span style="font-style: italic;">"M-s r"</span> . consult-ripgrep)
        (<span style="font-style: italic;">"M-s l"</span> . consult-line)
        (<span style="font-style: italic;">"M-s L"</span> . consult-line-multi)
        (<span style="font-style: italic;">"M-s m"</span> . consult-multi-occur)
        (<span style="font-style: italic;">"M-s k"</span> . consult-keep-lines)
        (<span style="font-style: italic;">"M-s u"</span> . consult-focus-lines)
        <span style="font-weight: bold;">:map</span> isearch-mode-map
        (<span style="font-style: italic;">"M-n"</span> . consult-isearch)
        (<span style="font-style: italic;">"M-l"</span> . consult-line)
        (<span style="font-style: italic;">"M-L"</span> . consult-line-multi)
        <span style="font-weight: bold;">:map</span> minibuffer-local-map
        (<span style="font-style: italic;">"C-M-n"</span> . consult-history)
        <span style="font-weight: bold;">:map</span> help-map
        (<span style="font-style: italic;">"a"</span> . consult-apropos)
        <span style="font-weight: bold;">:map</span> org-mode-map
        (<span style="font-style: italic;">"C-c h"</span> . consult-org-heading))
  <span style="font-weight: bold;">:custom</span>
  (consult-line-start-from-top t)
  (consult-project-root-function #'project-root-function)
  (consult-locate-args <span style="font-style: italic;">"plocate -d &lt;&lt;plocate-db()&gt;&gt; --ignore-case --existing --regexp"</span>))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">project-root-function</span> ()
  (when-let (project (project-current))
    (car (project-roots project))))
</pre>
</div>
</div>

<ul class="org-ul">
<li><a id="org137b0a8"></a>consult-dir<br />
<div class="outline-text-7" id="text-org137b0a8">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-consult-dir"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package consult-dir
  <span style="font-weight: bold;">:bind</span> ((<span style="font-style: italic;">"C-x C-d"</span> . consult-dir)
         <span style="font-weight: bold;">:map</span> vertico-map
         (<span style="font-style: italic;">"C-x C-d"</span> . consult-dir)
         (<span style="font-style: italic;">"C-x C-j"</span> . consult-dir-jump-file)))
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="org539fcaf"></a>embark<br />
<div class="outline-text-6" id="text-org539fcaf">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-embark"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-style: italic;">"https://github.com/oantolin/embark/releases.atom"</span> soft_update)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package embark
  <span style="font-weight: bold;">:bind</span> ((<span style="font-style: italic;">"C-."</span> . embark-act)
         (<span style="font-style: italic;">"M-."</span> . embark-dwim)
         (<span style="font-style: italic;">"&lt;help&gt; B"</span> . embark-bindings)
         <span style="font-weight: bold;">:map</span> embark-file-map
         (<span style="font-style: italic;">"b"</span> . browse-url))
  <span style="font-weight: bold;">:init</span>
  (<span style="font-weight: bold;">setq</span> prefix-help-command #'embark-prefix-help-command) <span style="font-weight: bold; font-style: italic;">;</span>
  <span style="font-weight: bold;">:custom</span>
  (embark-mixed-indicator-delay 3)
  <span style="font-weight: bold;">:hook</span>
  (embark-collect-mode . consult-preview-at-point-mode)
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">embark-consult</span>)
  (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">embark-org</span>)
  (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">avy-embark-collect</span>)
  (<span style="font-weight: bold;">push</span> 'embark--allow-edit
        (alist-get 'shell-command-on-region embark-target-injection-hooks)))
</pre>
</div>
</div>
</li>

<li><a id="org463b51c"></a>marginalia<br />
<div class="outline-text-6" id="text-org463b51c">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-marginalia"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-style: italic;">"https://github.com/minad/marginalia/releases.atom"</span> soft_update)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package marginalia
  <span style="font-weight: bold;">:custom</span>
  (marginalia-field-width 180)
  <span style="font-weight: bold;">:config</span>
  (marginalia-mode))
</pre>
</div>
</div>
</li>

<li><a id="orgfc4f647"></a>orderless<br />
<div class="outline-text-6" id="text-orgfc4f647">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-orderless"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-style: italic;">"https://github.com/oantolin/orderless/releases.atom"</span> soft_update)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package orderless
  <span style="font-weight: bold;">:custom</span> (completion-styles '(orderless)))
</pre>
</div>
</div>

<ul class="org-ul">
<li><a id="orgc796b06"></a>migemo support<br />
<div class="outline-text-7" id="text-orgc796b06">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">orderless-migemo</span> (component)
  (<span style="font-weight: bold;">let</span> ((pattern (migemo-get-pattern component)))
    (<span style="font-weight: bold;">condition-case</span> nil
        (<span style="font-weight: bold;">progn</span> (string-match-p pattern <span style="font-style: italic;">""</span>) pattern)
      (invalid-regexp nil))))

(orderless-define-completion-style orderless-default-style
  (orderless-matching-styles '(orderless-literal
                               orderless-regexp)))

(orderless-define-completion-style orderless-migemo-style
  (orderless-matching-styles '(orderless-literal
                               orderless-regexp
                               orderless-migemo)))

<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">uncomment below if you wish to apply migemo globally</span>
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(setq orderless-matching-styles '(orderless-literal orderless-regexp orderless-migemo))</span>

(<span style="font-weight: bold;">setq</span> completion-category-overrides
      '((command (styles orderless-default-style))
        (file (styles orderless-migemo-style))
        (project-file (styles orderless-migemo-style))
        (buffer (styles orderless-migemo-style))
        (symbol (styles orderless-default-style))
        (consult-location (styles orderless-migemo-style))
        (multi-category (styles orderless-migemo-style))
        (consult-org-heading (styles orderless-migemo-style))
        (consult-location (styles orderless-migemo-style))
        (org-roam-node (styles orderless-migemo-style))
        (unicode-name (styles orderless-migemo-style))
        (variable (styles orderless-default-style))))
</pre>
</div>
</div>
</li>
</ul>
</li>
</ul>
</li>

<li><a id="orga6bdca1"></a>text-mode derivatives<br />
<div class="outline-text-5" id="text-orga6bdca1">
</div>

<ul class="org-ul">
<li><a id="org2084a21"></a>text-mode<br />
<div class="outline-text-6" id="text-org2084a21">
<ul class="org-ul">
<li>subword-mode enables to recognize 'RSS' and 'Feed' are separate words in 'RSSFeed'</li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(add-hook 'text-mode-hook #'my/turn-on-input-method)

<span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/turn-on-input-method</span> ()
  <span style="font-style: italic;">"Turn on `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">default-input-method</span><span style="font-style: italic;">' if buffer text does not seem to consist of ASCII."</span>
  (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">and</span>
         <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">this function should be applied to text-mode rather than its inheritor</span>
         (eq major-mode 'text-mode)
         <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">target buffer must be front not buried</span>
         (eq (current-buffer) (window-buffer)))
    (<span style="font-weight: bold;">if</span> (my/ascii-string-p (buffer-string))
        (activate-input-method nil)
      (activate-input-method default-input-method))
    (visual-line-mode 1)
    (toggle-truncate-lines -1)))
</pre>
</div>
</div>
</li>

<li><a id="org95241d9"></a>nxml-mode<br />
<div class="outline-text-6" id="text-org95241d9">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package nxml-mode
  <span style="font-weight: bold;">:delight</span> (nxml-mode <span style="font-style: italic;">" XM"</span>)
  <span style="font-weight: bold;">:mode</span> ((<span style="font-style: italic;">"</span><span style="font-weight: bold; font-style: italic;">\</span><span style="font-style: italic;">.xml$"</span>   . nxml-mode)
         (<span style="font-style: italic;">"</span><span style="font-weight: bold; font-style: italic;">\</span><span style="font-style: italic;">.xsl$"</span>   . nxml-mode)
         (<span style="font-style: italic;">"</span><span style="font-weight: bold; font-style: italic;">\</span><span style="font-style: italic;">.xhtml$"</span> . nxml-mode)
         (<span style="font-style: italic;">"</span><span style="font-weight: bold; font-style: italic;">\</span><span style="font-style: italic;">.page$"</span>  . nxml-mode)
         (<span style="font-style: italic;">"</span><span style="font-weight: bold; font-style: italic;">\</span><span style="font-style: italic;">.plist$"</span> . nxml-mode))
  <span style="font-weight: bold;">:hook</span> (nxml-mode . my/prog-mode-hook-function)
  <span style="font-weight: bold;">:custom</span>
  (nxml-child-indent 2)
  (nxml-attribute-indent 2)
  (nxml-slash-auto-complete-flag t)
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">setq-local</span> tab-width 2)
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">pattern in hideshow mode for nxml mode</span>
  (add-to-list 'hs-special-modes-alist
               (list 'nxml-mode
                     <span style="font-style: italic;">"&lt;!--</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">|</span><span style="font-style: italic;">&lt;[</span><span style="font-style: italic;">^</span><span style="font-style: italic;">/&gt;]*[</span><span style="font-style: italic;">^</span><span style="font-style: italic;">/]&gt;"</span>
                     <span style="font-style: italic;">"--&gt;</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">|</span><span style="font-style: italic;">&lt;/[</span><span style="font-style: italic;">^</span><span style="font-style: italic;">/&gt;]*[</span><span style="font-style: italic;">^</span><span style="font-style: italic;">/]&gt;"</span>
                     <span style="font-style: italic;">"&lt;!--"</span>
                     'nxml-forward-element
                     nil)))
</pre>
</div>
</div>
</li>

<li><a id="orge11a9b2"></a>yaml-mode<br />
<div class="outline-text-6" id="text-orge11a9b2">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-yaml-mode"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">yaml-mode</span>)
</pre>
</div>
</div>
</li>

<li><a id="org76b52da"></a>json-mode<br />
<div class="outline-text-6" id="text-org76b52da">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-json-mode"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">json-mode</span>)
</pre>
</div>
</div>
</li>

<li><a id="org86a7767"></a>tex-mode<br />
<div class="outline-text-6" id="text-org86a7767">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package tex-mode
  <span style="font-weight: bold;">:mode</span> (<span style="font-style: italic;">"\\.tex$"</span> . latex-mode)
  <span style="font-weight: bold;">:hook</span> ((tex-mode . (<span style="font-weight: bold;">lambda</span> () (<span style="font-weight: bold;">setq</span> ispell-parser 'tex))))
  <span style="font-weight: bold;">:config</span>
  (my/add-dash-docsets-hook 'latex-mode-hook '(<span style="font-style: italic;">"LaTeX"</span>)))
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="org03606b6"></a>prog-mode derivatives<br />
<div class="outline-text-5" id="text-org03606b6">
</div>

<ul class="org-ul">
<li><a id="org8086f2e"></a>prog-mode<br />
<div class="outline-text-6" id="text-org8086f2e">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(add-hook 'prog-mode-hook
          #'my/prog-mode-hook-function)

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/prog-mode-hook-function</span> ()
  (hl-line-mode -1)
  (hs-minor-mode -1)
  (flyspell-prog-mode)
  (display-fill-column-indicator-mode 1))
</pre>
</div>
</div>
</li>

<li><a id="org2a1f882"></a>sh-mode<br />
<div class="outline-text-6" id="text-org2a1f882">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package sh-script
  <span style="font-weight: bold;">:delight</span> <span style="font-style: italic;">" SH"</span>
  <span style="font-weight: bold;">:commands</span> sh-mode
  <span style="font-weight: bold;">:mode</span> (<span style="font-style: italic;">"\\.sh$"</span> . sh-mode)
  <span style="font-weight: bold;">:custom</span>
  (sh-basic-offset 2)
  (sh-indent-after-if '+)
  (sh-indent-for-case-label 0)
  (sh-indent-for-case-alt '+)
  <span style="font-weight: bold;">:config</span>
  (my/add-dash-docsets-hook 'sh-mode-hook '(<span style="font-style: italic;">"Bash"</span>)))
</pre>
</div>
</div>
</li>

<li><a id="org1dffd4d"></a>emacs-lisp-mode<br />
<div class="outline-text-6" id="text-org1dffd4d">
<p>
I'm in the trial of pp-eval-last-sexp instead of eval-last-sexp adviced from <a href="https://karthinks.com/software/an-elisp-editing-tip/">this blog post</a>
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package elisp-mode
  <span style="font-weight: bold;">:commands</span> emacs-lisp-mode
  <span style="font-weight: bold;">:hook</span> (emacs-lisp-mode . (<span style="font-weight: bold;">lambda</span> ()
                             (<span style="font-weight: bold;">setq-local</span> tab-width 8)
                             (eldoc-mode 1)))
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">eldoc</span>)
  (substitute-key-definition 'eval-last-sexp
                             'pp-eval-last-sexp
                             global-map)
  (my/add-dash-docsets-hook 'emacs-lisp-mode-hook
                            '(<span style="font-style: italic;">"Emacs Lisp"</span>)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/elisp-mode-eval-buffer</span> ()
  (<span style="font-weight: bold;">interactive</span>)
  (message <span style="font-style: italic;">"Evaluated buffer"</span>)
  (eval-buffer))

(define-key emacs-lisp-mode-map (kbd <span style="font-style: italic;">"C-c C-c"</span>) #'my/elisp-mode-eval-buffer)
(define-key lisp-interaction-mode-map (kbd <span style="font-style: italic;">"C-c C-c"</span>) #'my/elisp-mode-eval-buffer)
</pre>
</div>
</div>
</li>

<li><a id="org0b048db"></a>scheme-mode<br />
<div class="outline-text-6" id="text-org0b048db">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"mit-scheme"</span>
</pre>
</div>
</div>
</li>

<li><a id="org46c5774"></a>c-mode<br />
<div class="outline-text-6" id="text-org46c5774">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package cc-mode
  <span style="font-weight: bold;">:custom</span>
  (c-tab-always-indent t)
  (c-auto-align-backslashes nil)
  (c-echo-syntactic-information-p t)
  (c-default-style <span style="font-style: italic;">"my/c-style"</span>)
  <span style="font-weight: bold;">:config</span>
  (my/add-dash-docsets-hook 'c-mode-common-hook
                            '(<span style="font-style: italic;">"C"</span>))
  (c-toggle-auto-newline 1)
  (c-add-style <span style="font-style: italic;">"my/c-style"</span>
               '((c-basic-offset . 4)
                 (c-comment-only-line-offset . 0)
                 (c-hanging-braces-alist
                  . ((brace-if-brace before after)
                     (substatement-open before after)))
                 (c-hanging-colons-alist
                  . ((case-label after)))
                 (c-cleanup-list
                  . (brace-else-brace
                     brace-elseif-brace
                     empty-defun-braces
                     defun-close-semi
                     list-close-comma
                     scope-operator))
                 (c-offsets-alist
                  . ((arglist-intro . +)
                     (arglist-cont-nonempty . c-lineup-arglist)))))
  (c-add-style <span style="font-style: italic;">"my/objc-style"</span>
               '((c-basic-offset . 2)
                 (c-comment-only-line-offset . 0)
                 (c-hanging-braces-alist
                  . ((brace-if-brace before after)
                     (substatement-open before after)))
                 (c-hanging-colons-alist
                  . ((case-label after)))
                 (c-cleanup-list
                  . (brace-else-brace
                     brace-elseif-brace
                     empty-defun-braces
                     defun-close-semi
                     list-close-comma
                     scope-operator))
                 (c-offsets-alist
                  . ((arglist-intro . +)
                     (arglist-cont-nonempty . c-lineup-arglist))))))
</pre>
</div>
</div>
</li>

<li><a id="org4ed8d06"></a>python-mode<br />
<div class="outline-text-6" id="text-org4ed8d06">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package python
  <span style="font-weight: bold;">:mode</span> <span style="font-style: italic;">"\\.py\\'"</span>
  <span style="font-weight: bold;">:interpreter</span> <span style="font-style: italic;">"python"</span>
  <span style="font-weight: bold;">:delight</span> <span style="font-style: italic;">" PY"</span>
  <span style="font-weight: bold;">:hook</span>
  ((python-mode inferior-python-mode) . my-python-mode-hook)
  (lsp-mode . (<span style="font-weight: bold;">lambda</span> ()
                (add-to-list 'lsp-disabled-clients 'jedi)
                (add-to-list 'lsp-enabled-clients 'pyls)))
  <span style="font-weight: bold;">:config</span>
  (my/add-dash-docsets-hook 'python-mode-hook
                            '(<span style="font-style: italic;">"Python 3"</span>))
  (my/add-dash-docsets-hook 'inferior-python-mode-hook
                            '(<span style="font-style: italic;">"Python 3"</span>)))

(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">python-mode-initialized</span> nil)

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-python-mode-hook</span> ()
  (<span style="font-weight: bold;">setq-local</span> flycheck-checker 'python-pylint)
  (jedi:setup)
  (jedi-mode 1)
  (<span style="font-weight: bold;">unless</span> python-mode-initialized
    (<span style="font-weight: bold;">setq</span> python-mode-initialized t)
    (info-lookup-add-help
     <span style="font-weight: bold;">:mode</span> 'python-mode
     <span style="font-weight: bold;">:regexp</span> <span style="font-style: italic;">"[a-zA-Z_0-9.]+"</span>
     <span style="font-weight: bold;">:doc-spec</span>
     '((<span style="font-style: italic;">"(python)Python Module Index"</span> )
       (<span style="font-style: italic;">"(python)Index"</span>
        (<span style="font-weight: bold;">lambda</span>
          (item)
          (<span style="font-weight: bold;">cond</span>
           ((string-match
             <span style="font-style: italic;">"</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">[A-Za-z0-9_]+</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">() (in module </span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">[A-Za-z0-9_.]+</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">)"</span> item)
            (format <span style="font-style: italic;">"%s.%s"</span> (match-string 2 item)
                    (match-string 1 item))))))))))
</pre>
</div>
</div>

<ul class="org-ul">
<li><a id="org08d1f44"></a>emacs-project<br />
<div class="outline-text-7" id="text-org08d1f44">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-company-jedi"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package company-jedi
  <span style="font-weight: bold;">:after</span> python
  <span style="font-weight: bold;">:hook</span> (python-mode . my/python-mode-hook)
  <span style="font-weight: bold;">:custom</span>
  (jedi:tooltip-method nil)
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/python-mode-hook</span> ()
    (add-to-list 'company-backends 'company-jedi)))
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="org21d8eb9"></a>ruby-mode<br />
<div class="outline-text-6" id="text-org21d8eb9">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package ruby-mode
  <span style="font-weight: bold;">:delight</span> <span style="font-style: italic;">" RB"</span>
  <span style="font-weight: bold;">:mode</span> ((<span style="font-style: italic;">"\\.rb$"</span>   . ruby-mode)
         (<span style="font-style: italic;">"Capfile$"</span> . ruby-mode)
         (<span style="font-style: italic;">"Gemfile$"</span> . ruby-mode))
  <span style="font-weight: bold;">:interpreter</span> ((<span style="font-style: italic;">"ruby"</span>    . ruby-mode)
                (<span style="font-style: italic;">"rbx"</span>     . ruby-mode)
                (<span style="font-style: italic;">"jruby"</span>   . ruby-mode))
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">setq</span> ruby-indent-level 2)
  (<span style="font-weight: bold;">setq</span> ruby-insert-encoding-magic-comment nil)
  (add-hook 'ruby-mode-hook
            '(lambda ()
               (<span style="font-weight: bold;">setq-local</span> flycheck-checker 'ruby-rubocop)))
  (add-to-list 'hs-special-modes-alist
               `(ruby-mode
                 ,(<span style="font-weight: bold;">rx</span> (<span style="font-weight: bold;">or</span> <span style="font-style: italic;">"def"</span> <span style="font-style: italic;">"class"</span> <span style="font-style: italic;">"module"</span> <span style="font-style: italic;">"do"</span> <span style="font-style: italic;">"if"</span> <span style="font-style: italic;">"{"</span> <span style="font-style: italic;">"["</span>)) <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">Block start</span>
                 ,(<span style="font-weight: bold;">rx</span> (<span style="font-weight: bold;">or</span> <span style="font-style: italic;">"}"</span> <span style="font-style: italic;">"]"</span> <span style="font-style: italic;">"end"</span>))                       <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">Block end</span>
                 ,(<span style="font-weight: bold;">rx</span> (<span style="font-weight: bold;">or</span> <span style="font-style: italic;">"#"</span> <span style="font-style: italic;">"=begin"</span>))                        <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">Comment start</span>
                 ruby-forward-sexp nil))
  (my/add-dash-docsets-hook 'ruby-mode-hook '(<span style="font-style: italic;">"Ruby"</span>)))
</pre>
</div>
</div>

<ul class="org-ul">
<li><a id="orgd2c9cc5"></a>inf-ruby<br />
<div class="outline-text-7" id="text-orgd2c9cc5">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-inf-ruby"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package inf-ruby
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">setq</span> inf-ruby-default-implementation <span style="font-style: italic;">"pry"</span>)
  (add-to-list 'inf-ruby-implementations '(<span style="font-style: italic;">"pry"</span> . <span style="font-style: italic;">"pry"</span>))
  (<span style="font-weight: bold;">setq</span> inf-ruby-eval-binding <span style="font-style: italic;">"Pry.toplevel_binding"</span>)
  (<span style="font-weight: bold;">setq</span> inf-ruby-first-prompt-pattern <span style="font-style: italic;">"^\\[[0-9]+\\] pry</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">(.*)</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">&gt; *"</span>)
  (<span style="font-weight: bold;">setq</span> inf-ruby-prompt-pattern <span style="font-style: italic;">"^\\[[0-9]+\\] pry</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">(.*)</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">[&gt;*\"'] *"</span>))
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="org82b4da3"></a>lua-mode<br />
<div class="outline-text-6" id="text-org82b4da3">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(add-to-list 'auto-mode-alist '(<span style="font-style: italic;">"\\.lua\\'"</span> . lua-mode))
</pre>
</div>
</div>
</li>

<li><a id="org3729d8d"></a>perl-mode<br />
<div class="outline-text-6" id="text-org3729d8d">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package perl-mode
  <span style="font-weight: bold;">:delight</span> <span style="font-style: italic;">" PL"</span>)
</pre>
</div>
</div>
</li>

<li><a id="org53925a5"></a>web-mode<br />
<div class="outline-text-6" id="text-org53925a5">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-web-mode"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package web-mode
  <span style="font-weight: bold;">:delight</span> <span style="font-style: italic;">" WB"</span>
  <span style="font-weight: bold;">:mode</span> ((<span style="font-style: italic;">"\\.phtml$"</span>     . web-mode)
         (<span style="font-style: italic;">"\\.tpl\\.php$"</span> . web-mode)
         (<span style="font-style: italic;">"\\.jsp$"</span>       . web-mode)
         (<span style="font-style: italic;">"\\.as[cp]x$"</span>   . web-mode)
         (<span style="font-style: italic;">"\\.erb$"</span>       . web-mode)
         (<span style="font-style: italic;">"\\.html?$"</span>     . web-mode))
  <span style="font-weight: bold;">:custom</span>
  (web-mode-attr-indent-offset        2)
  (web-mode-attr-value-indent-offset  2)
  (web-mode-code-indent-offset        2)
  (web-mode-css-offset                2)
  (web-mode-markup-indent-offset      2)
  (web-mode-sql-indent-offset         2)
  (web-mode-block-padding             2)
  (web-mode-script-padding            2)
  <span style="font-weight: bold;">:config</span>
  (my/add-dash-docsets-hook 'web-mode-hook '(<span style="font-style: italic;">"HTML"</span>)))
</pre>
</div>
</div>
</li>

<li><a id="orgcd05e30"></a>css-mode<br />
<div class="outline-text-6" id="text-orgcd05e30">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">with-eval-after-load</span> 'css-mode
  (customize-set-variable 'css-indent-offset 2)
  (my/add-dash-docsets-hook 'css-mode-hook '(<span style="font-style: italic;">"CSS"</span>)))
</pre>
</div>
</div>
</li>

<li><a id="org40ab6e1"></a>js2-mode<br />
<div class="outline-text-6" id="text-org40ab6e1">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-js2-mode"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package js2-mode
  <span style="font-weight: bold;">:delight</span> <span style="font-style: italic;">" J2"</span>
  <span style="font-weight: bold;">:mode</span> ((<span style="font-style: italic;">"\\.js</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">on</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">?\\'"</span> . js2-mode)
         (<span style="font-style: italic;">"\\.eslintrc\\'"</span>    . js2-mode))
  <span style="font-weight: bold;">:hook</span> (js2-mode . (<span style="font-weight: bold;">lambda</span> ()
                      (<span style="font-weight: bold;">setq-local</span> flycheck-checker 'javascript-eslint)
                      (<span style="font-weight: bold;">setq-local</span> flycheck-disabled-checkers '(javascript-jshint javascript-jscs))))
  <span style="font-weight: bold;">:custom</span>
  (flycheck-javascript-eslint-executable <span style="font-style: italic;">"eslint"</span>)
  (my/add-dash-docsets-hook 'js2-mode-hook '(<span style="font-style: italic;">"JavaScript"</span>)))

(use-package js
  <span style="font-weight: bold;">:delight</span> <span style="font-style: italic;">" JS"</span>
  <span style="font-weight: bold;">:custom</span>
  (js-indent-level 2))
</pre>
</div>
</div>
</li>

<li><a id="org7d306ed"></a>sql-mode<br />
<div class="outline-text-6" id="text-org7d306ed">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package sql
  <span style="font-weight: bold;">:delight</span> <span style="font-style: italic;">" SQ"</span>
  <span style="font-weight: bold;">:commands</span> (sql-mode)
  <span style="font-weight: bold;">:mode</span> ((<span style="font-style: italic;">"\\.sql$"</span> . sql-mode))
  <span style="font-weight: bold;">:bind</span> (<span style="font-weight: bold;">:map</span> sql-interactive-mode-map
              (<span style="font-style: italic;">"C-j"</span> . comint-send-input))
  <span style="font-weight: bold;">:hook</span> (sql-mode . (<span style="font-weight: bold;">lambda</span> ()
                      (<span style="font-weight: bold;">setq-local</span> flycheck-checker 'sql-sqlint))))
</pre>
</div>
</div>
</li>

<li><a id="org12daaf9"></a>plantuml-mode<br />
<div class="outline-text-6" id="text-org12daaf9">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-plantuml-mode"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package plantuml-mode
  <span style="font-weight: bold;">:delight</span> <span style="font-style: italic;">" UM"</span>
  <span style="font-weight: bold;">:custom</span>
  (plantuml-jar-path <span style="font-style: italic;">"/usr/share/plantuml/plantuml.jar"</span>)
  <span style="font-weight: bold;">:config</span>
  (my/add-dash-docsets-hook 'plantuml-mode-hook '(<span style="font-style: italic;">"PlantUML"</span>)))
</pre>
</div>
</div>
</li>

<li><a id="org0970696"></a>conf<br />
<div class="outline-text-6" id="text-org0970696">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package conf-mode
  <span style="font-weight: bold;">:delight</span> <span style="font-style: italic;">" CF"</span>)
</pre>
</div>
</div>
</li>

<li><a id="org868136e"></a>generic-x<br />
<div class="outline-text-6" id="text-org868136e">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package generic-x
  <span style="font-weight: bold;">:mode</span> ((<span style="font-style: italic;">"\\.conf$"</span>     . apache-conf-generic-mode)
         (<span style="font-style: italic;">"\\.htaccess$"</span> . apache-conf-generic-mode)))
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="orgea837c8"></a>special-mode derivatives<br />
<div class="outline-text-5" id="text-orgea837c8">
</div>

<ul class="org-ul">
<li><a id="org21c2187"></a>special mode<br />
<div class="outline-text-6" id="text-org21c2187">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(define-key special-mode-map (kbd <span style="font-style: italic;">"C-j"</span>) #'push-button)
</pre>
</div>
</div>
</li>

<li><a id="org4317e78"></a><a id="ID-a55da7a2-6525-4788-ba56-085eb61928d4"></a>help<br />
<div class="outline-text-6" id="text-org4317e78">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(customize-set-variable 'help-enable-symbol-autoload t)
(customize-set-variable 'describe-bindings-outline t)

(<span style="font-weight: bold;">with-eval-after-load</span> 'help
  (define-key help-map (kbd <span style="font-style: italic;">"C-?"</span>) #'help-for-help)
  (define-key help-map (kbd <span style="font-style: italic;">"c"</span>) #'describe-face)
  (define-key help-map (kbd <span style="font-style: italic;">"K"</span>) #'describe-keymap)
  (define-key help-map (kbd <span style="font-style: italic;">"C-l"</span>) #'find-library))
</pre>
</div>
</div>
</li>

<li><a id="org9d3323f"></a>woman<br />
<div class="outline-text-6" id="text-org9d3323f">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(autoload #'woman <span style="font-style: italic;">"woman"</span> nil t)
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="org39ce758"></a>Programming<br />
<div class="outline-text-5" id="text-org39ce758">
</div>

<ul class="org-ul">
<li><a id="orgad1d5fd"></a>sMerge<br />
<div class="outline-text-6" id="text-orgad1d5fd">
<p>
sMerge can be used to solve merging problems. The code below kicks off sMerge if there is a collision sign.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(autoload 'smerge-mode <span style="font-style: italic;">"smerge-mode"</span> nil t)

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/try-smerge</span> ()
  (<span style="font-weight: bold;">save-excursion</span>
    (goto-char (point-min))
    (<span style="font-weight: bold;">when</span> (re-search-forward <span style="font-style: italic;">"^&lt;&lt;&lt;&lt;&lt;&lt;&lt; "</span> nil t)
      (smerge-mode 1))))
(add-hook 'find-file-hook 'my/try-smerge t)
</pre>
</div>
</div>
</li>

<li><a id="orgdfd0263"></a>Next Error<br />
<div class="outline-text-6" id="text-orgdfd0263">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(customize-set-variable 'next-error-message-highlight t)
</pre>
</div>
</div>
</li>

<li><a id="orgf4c94a4"></a>Hideshow<br />
<div class="outline-text-6" id="text-orgf4c94a4">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package hideshow
  <span style="font-weight: bold;">:diminish</span> <span style="font-style: italic;">"hs"</span>
  <span style="font-weight: bold;">:bind</span> ((<span style="font-style: italic;">"C-c TAB"</span> . hs-toggle-hiding)))
</pre>
</div>
</div>
</li>

<li><a id="org3d5af5e"></a>imenu<br />
<div class="outline-text-6" id="text-org3d5af5e">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package imenu
  <span style="font-weight: bold;">:custom</span>
  (imenu-auto-rescan t))
</pre>
</div>
</div>
</li>
<li><a id="org770ea62"></a>compile<br />
<div class="outline-text-6" id="text-org770ea62">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package compile
  <span style="font-weight: bold;">:bind</span> (<span style="font-weight: bold;">:map</span> compilation-mode-map
              (<span style="font-style: italic;">"C-j"</span> . compile-goto-error)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/compile-default-command</span> ()
  <span style="font-style: italic;">"Compile `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">compile-command</span><span style="font-style: italic;">'."</span>
  (funcall #'compile compile-command)
  (quit-window))
</pre>
</div>
</div>
</li>

<li><a id="orgd7904e0"></a>grep<br />
<div class="outline-text-6" id="text-orgd7904e0">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package grep
  <span style="font-weight: bold;">:custom</span>
  (grep-program <span style="font-style: italic;">"rg"</span>)
  <span style="font-weight: bold;">:config</span>
  (bind-keys <span style="font-weight: bold;">:map</span> grep-mode-map
             (<span style="font-style: italic;">"C-j"</span> . compile-goto-error)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/grep-ripgrep-all</span> ()
  <span style="font-style: italic;">"Grep many kind of files like pdf, epub and more."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">let</span> ((grep-find-command '(<span style="font-style: italic;">"rga --with-filename --no-heading --line-number --color never -e '' ./* ./**/*"</span> . 66)))
    (call-interactively 'grep-find)))

(global-set-key (kbd <span style="font-style: italic;">"M-s R"</span>) 'my/grep-ripgrep-all)
</pre>
</div>
</div>
</li>

<li><a id="org35f165f"></a>executable<br />
<div class="outline-text-6" id="text-org35f165f">
<p>
This customization is based on <a href="https://emacsredux.com/blog/2021/09/29/make-script-files-executable-automatically/">this advice</a>
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package executable
  <span style="font-weight: bold;">:hook</span> (after-save
         . executable-make-buffer-file-executable-if-script-p))
</pre>
</div>
</div>
</li>

<li><a id="org53e16bb"></a>paren<br />
<div class="outline-text-6" id="text-org53e16bb">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">paren</span>)

(customize-set-variable 'show-paren-style 'parenthesis)
(customize-set-variable 'show-paren-delay 0.25)
(customize-set-variable 'show-paren-mode nil)
</pre>
</div>
</div>
</li>

<li><a id="org56bdbfd"></a>project<br />
<div class="outline-text-6" id="text-org56bdbfd">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package project)
</pre>
</div>
</div>
</li>

<li><a id="org2df165a"></a>log-view<br />
<div class="outline-text-6" id="text-org2df165a">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package log-view
  <span style="font-weight: bold;">:delight</span>
  (log-view-mode <span style="font-style: italic;">" LV"</span>)
  <span style="font-weight: bold;">:mode</span> (<span style="font-style: italic;">"\\.log$"</span> . log-view-mode)
  <span style="font-weight: bold;">:hook</span> ((log-view-mode . my/prog-mode-hook-function )
         (log-view-mode . auto-revert-tail-mode)))
</pre>
</div>
</div>
</li>

<li><a id="orgded7a64"></a>vc (version control)<br />
<div class="outline-text-6" id="text-orgded7a64">
</div>
</li>
<li><a id="org6b9bbbd"></a>ediff<br />
<div class="outline-text-6" id="text-org6b9bbbd">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package ediff
  <span style="font-weight: bold;">:commands</span> ediff-files
  <span style="font-weight: bold;">:custom</span>
  (ediff-window-setup-function 'ediff-setup-windows-default)
  (ediff-split-window-function 'split-window-horizontally))
</pre>
</div>
</div>
</li>
<li><a id="org39b3088"></a>vc-hooks<br />
<div class="outline-text-6" id="text-org39b3088">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package vc-hooks
  <span style="font-weight: bold;">:custom</span>
  (vc-follow-symlinks t))
</pre>
</div>
</div>
</li>
</ul>
</li>
<li><a id="org46236e9"></a>other third-party packages<br />
<div class="outline-text-5" id="text-org46236e9">
</div>

<ul class="org-ul">
<li><a id="org7170667"></a>iedit<br />
<div class="outline-text-6" id="text-org7170667">
<p>
<a href="https://github.com/victorhge/iedit">IEdit</a> is not only replacement for M-%/C-M-% but it highlights symbol occurences to change. <a href="https://www.masteringemacs.org/article/iedit-interactive-multi-occurrence-editing-in-your-buffer">An adviced</a> custom function 'my/iedit-dwim' replaces symbols in defun unless prefix arg is given.
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-iedit"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(customize-set-variable 'iedit-toggle-key-default (kbd <span style="font-style: italic;">"C-\""</span>))
(customize-set-variable 'iedit-auto-narrow t)

<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">require clause sits here to supress key occupation warning</span>
(<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">iedit</span>)

(global-set-key (kbd <span style="font-style: italic;">"C-\""</span>) 'my/iedit-dwim)

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/iedit-dwim</span> (arg)
  <span style="font-style: italic;">"Starts iedit but uses \\[</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">narrow-to-defun</span><span style="font-style: italic;">] to limit its scope."</span>
  (<span style="font-weight: bold;">interactive</span> <span style="font-style: italic;">"P"</span>)
  (<span style="font-weight: bold;">if</span> arg
      (iedit-mode)
    (<span style="font-weight: bold;">save-excursion</span>
      (<span style="font-weight: bold;">save-restriction</span>
        (widen)
        <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">this function determines the scope of `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">iedit-start</span><span style="font-weight: bold; font-style: italic;">'.</span>
        (<span style="font-weight: bold;">if</span> iedit-mode
            (iedit-done)
          <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">`</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">current-word</span><span style="font-weight: bold; font-style: italic;">' can of course be replaced by other</span>
          <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">functions.</span>
          (narrow-to-defun)
          (iedit-start (current-word) (point-min) (point-max)))))))
</pre>
</div>
</div>
</li>

<li><a id="org35a7606"></a>ledger-mode / flycheck-ledger<br />
<div class="outline-text-6" id="text-org35a7606">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-ledger-mode"</span>
<span style="font-style: italic;">"emacs-flycheck-ledger"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(add-to-list 'auto-mode-alist '(<span style="font-style: italic;">"\\.ledger$"</span> . ledger-mode))

(autoload 'ledger-mode <span style="font-style: italic;">"ledger-mode"</span> <span style="font-style: italic;">"A major mode for Ledger"</span> t)
(<span style="font-weight: bold;">with-eval-after-load</span> 'ledger-mode
  (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">flycheck-ledger</span>))
</pre>
</div>
</div>
</li>

<li><a id="orgcd7649a"></a>mentor<br />
<div class="outline-text-6" id="text-orgcd7649a">
<p>
<a href="https://github.com/skangas/mentor">mentor</a> is a [BROKEN LINK: id:bdc987ad-419b-4f36-922d-de75207d85c0] client for emacs.
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-mentor"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(autoload #'mentor <span style="font-style: italic;">"mentor"</span> nil t)

(<span style="font-weight: bold;">with-eval-after-load</span> 'mentor
  (customize-set-variable 'mentor-rtorrent-download-directory
                          (expand-file-name <span style="font-style: italic;">"data/media/torrent"</span>
                                            <span style="font-style: italic;">"&lt;&lt;home-dir()&gt;&gt;"</span>))
  (customize-set-variable 'mentor-rtorrent-keep-session t)
  (customize-set-variable 'mentor-rtorrent-external-rpc
                          <span style="font-style: italic;">"&lt;&lt;rtorrent-sock()&gt;&gt;"</span>))
</pre>
</div>
</div>
</li>

<li><a id="org67125e7"></a>Geiser<br />
<div class="outline-text-6" id="text-org67125e7">
<p>
<a href="guix.html#The-Perfect-Setup">guix#The Perfect Setup</a>
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"guile"</span>
<span style="font-style: italic;">"emacs-geiser"</span>
<span style="font-style: italic;">"emacs-geiser-guile"</span>
</pre>
</div>
</div>
</li>

<li><a id="orgd12bec0"></a>consult-dash<br />
<div class="outline-text-6" id="text-orgd12bec0">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-dash-docs"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package dash-docs
  <span style="font-weight: bold;">:custom</span>
  (dash-docs-docsets-path
   (file-name-concat my/user-share-directory <span style="font-style: italic;">"dash/docsets"</span>)))

(add-to-list 'load-path
             (expand-file-name <span style="font-style: italic;">"elpa/consult-dash-20220621.226"</span> user-emacs-directory-default))

(use-package consult-dash
  <span style="font-weight: bold;">:after</span> dash-docs
  <span style="font-weight: bold;">:bind</span> (<span style="font-style: italic;">"M-s M-d"</span> . consult-dash))

(<span style="font-weight: bold;">defmacro</span> <span style="font-weight: bold;">my/add-dash-docsets-hook</span> (hook docsets)
  `(add-hook ,hook
             (<span style="font-weight: bold;">lambda</span> ()
               (<span style="font-weight: bold;">when</span> (functionp 'consult-dash)
                 (<span style="font-weight: bold;">setq-local</span> consult-dash-docsets ,docsets)))))
</pre>
</div>
</div>
</li>

<li><a id="org2092121"></a>eglot<br />
<div class="outline-text-6" id="text-org2092121">
<p>
<a href="https://github.com/joaotavora/eglot">Eglot</a>
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-eglot"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package eglot
  <span style="font-weight: bold;">:hook</span> ((sh-mode ruby-mode) . eglot-ensure)
  <span style="font-weight: bold;">:custom</span>
  (eglot-extend-to-xref t))
</pre>
</div>
</div>
</li>

<li><a id="orgfabc7c0"></a>denote<br />
<div class="outline-text-6" id="text-orgfabc7c0">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-denote"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">denote</span>)

(customize-set-variable 'denote-directory
                        (file-name-concat org-directory <span style="font-style: italic;">"notes"</span>))

(<span style="font-weight: bold;">with-eval-after-load</span> 'org-capture
  (<span style="font-weight: bold;">setq</span> denote-org-capture-specifiers <span style="font-style: italic;">"%l\n%i\n%?"</span>)
  (add-to-list 'org-capture-templates
               '(<span style="font-style: italic;">"n"</span> <span style="font-style: italic;">"New note (with denote.el)"</span> plain
                 (file denote-last-path)
                 #'denote-org-capture
                 <span style="font-weight: bold;">:no-save</span> t
                 <span style="font-weight: bold;">:immediate-finish</span> nil
                 <span style="font-weight: bold;">:kill-buffer</span> t
                 <span style="font-weight: bold;">:jump-to-captured</span> t)))
</pre>
</div>
</div>
</li>

<li><a id="orgd0faf2b"></a>tree-sitter<br />
<div class="outline-text-6" id="text-orgd0faf2b">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-style: italic;">"https://github.com/emacs-tree-sitter/elisp-tree-sitter/releases.atom"</span> soft_update)
(<span style="font-style: italic;">"https://github.com/emacs-tree-sitter/tree-sitter-langs/releases.atom"</span> soft_update)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package tree-sitter-langs
  <span style="font-weight: bold;">:straight</span> t)

(use-package tree-sitter
  <span style="font-weight: bold;">:straight</span> t
  <span style="font-weight: bold;">:after</span> tree-sitter-langs
  <span style="font-weight: bold;">:hook</span> ((tree-sitter-after-on . tree-sitter-hl-mode))
  <span style="font-weight: bold;">:config</span>
  (global-tree-sitter-mode 1))
</pre>
</div>
</div>
</li>

<li><a id="orgf7c5b03"></a>xr<br />
<div class="outline-text-6" id="text-orgf7c5b03">
<p>
<a href="https://elpa.gnu.org/packages/xr.html">XR</a> converts Emacs regular expressions to the structured rx form, thus being an inverse of rx.
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-xr"</span>
</pre>
</div>
</div>
</li>

<li><a id="orgb5b561a"></a>Whole Line Or Region<br />
<div class="outline-text-6" id="text-orgb5b561a">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-style: italic;">"https://github.com/purcell/whole-line-or-region/releases.atom"</span> soft_update)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package whole-line-or-region
  <span style="font-weight: bold;">:straight</span> t
  <span style="font-weight: bold;">:config</span>
  (whole-line-or-region-global-mode 1))
</pre>
</div>
</div>
</li>
<li><a id="org4d5d74a"></a>projectile&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span>&#xa0;<span class="ignore">ignore</span></span><br /></li>

<li><a id="orgb16bf4f"></a>counsel-projectile&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span>&#xa0;<span class="ignore">ignore</span></span><br /></li>
<li><a id="org0218e9a"></a>ag.el&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span>&#xa0;<span class="ignore">ignore</span></span><br /></li>

<li><a id="orga6ffc04"></a>ripgrep.el&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span>&#xa0;<span class="ignore">ignore</span></span><br /></li>

<li><a id="org251b665"></a>wgrep<br />
<div class="outline-text-6" id="text-org251b665">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-wgrep"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package wgrep
  <span style="font-weight: bold;">:custom</span>
  (wgrep-auto-save-buffer t)
  (wgrep-enable-key <span style="font-style: italic;">"e"</span>))
</pre>
</div>
</div>
</li>

<li><a id="orgebb3bb5"></a>dumb-jump<br />
<div class="outline-text-6" id="text-orgebb3bb5">
<p>
<a href="https://github.com/jacktasia/dumb-jump">dumb-jump</a> is "jump to definition" package without tagging.
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-dumb-jump"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package dumb-jump
  <span style="font-weight: bold;">:bind</span> ((<span style="font-style: italic;">"M-g o"</span> . dumb-jump-go-other-window)
         (<span style="font-style: italic;">"M-g j"</span> . dumb-jump-go)
         (<span style="font-style: italic;">"M-g x"</span> . dumb-jump-go-prefer-external)
         (<span style="font-style: italic;">"M-g z"</span> . dumb-jump-go-prefer-external-other-window)
         (<span style="font-style: italic;">"M-g /"</span> . dumb-jump-back)
         (<span style="font-style: italic;">"M-g l"</span> . dumb-jump-quick-look)))
</pre>
</div>
</div>
</li>

<li><a id="orgf996966"></a>visual-regexp&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span><br /></li>

<li><a id="orgf1b6d6c"></a>avy<br />
<div class="outline-text-6" id="text-orgf1b6d6c">
<p>
<a href="https://karthinks.com/software/avy-can-do-anything/">This post</a> tell me how we can concoct efficient editing workflow with avy.
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-avy"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package avy
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">setf</span> (alist-get ?. avy-dispatch-alist) 'avy-action-embark))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">avy-action-embark</span> (pt)
  (<span style="font-weight: bold;">unwind-protect</span>
      (<span style="font-weight: bold;">save-excursion</span>
        (goto-char pt)
        (embark-act))
    (select-window
     (cdr (ring-ref avy-ring 0))))
  t)
</pre>
</div>
</div>

<ul class="org-ul">
<li><a id="org84afd2b"></a>avy-migemo<br />
<div class="outline-text-7" id="text-org84afd2b">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package avy-migemo
  <span style="font-weight: bold;">:straight</span> t
  <span style="font-weight: bold;">:bind</span> ((<span style="font-style: italic;">"M-g M-a"</span> . avy-migemo-goto-char-timer)
         (<span style="font-style: italic;">"M-g a"</span> . avy-migemo-goto-char-timer)
         <span style="font-weight: bold;">:map</span> isearch-mode-map
         (<span style="font-style: italic;">"M-a"</span> . avy-migemo-isearch)))
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="org2919e92"></a>paredit<br />
<div class="outline-text-6" id="text-org2919e92">
<p>
Handy commands
</p>
<ul class="org-ul">
<li>press '(' to insert '()' pair</li>
<li>C-&lt;left/right&gt; to barf and slurp s-expressions</li>
<li>call paredit-splice-sexp to strip embracing parenthes</li>
<li>press M-&lt;up&gt; or M-r to delete upper sexp except pointing one</li>
<li>DEL, C-d, C-k act like originals but care for parenthes</li>
<li>press DEL to remedy unbalanced parenthes</li>
<li>press C-q ( to insert ( char manually</li>
</ul>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-paredit"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package paredit
  <span style="font-weight: bold;">:bind</span> (<span style="font-weight: bold;">:map</span> paredit-mode-map
              (<span style="font-style: italic;">"&lt;backspace&gt;"</span> . paredit-backward-delete)
              (<span style="font-style: italic;">"C-M-g"</span> .  paredit-splice-sexp)
              (<span style="font-style: italic;">"M-s"</span> . nil)
              (<span style="font-style: italic;">"C-M-;"</span> . paredit-comment-dwim)
              (<span style="font-style: italic;">"M-;"</span> . nil))
  <span style="font-weight: bold;">:hook</span> (((emacs-lisp-mode scheme-mode) . enable-paredit-mode)
         (paredit-mode . show-paren-local-mode)))
</pre>
</div>

<ul class="org-ul">
<li><p>
workaround
Thanks to <a href="https://andreyorst.gitlab.io/posts/2021-09-30-why-is-paredit-is-so-un-emacsy/">this blog post</a>, a couple of commands in paredit.el are fixed with transient-mark-mode
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my/paredit-delete-region-functions</span>
  '(paredit-forward-delete
    paredit-backward-delete)
  <span style="font-style: italic;">"List of `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">paredit-mode</span><span style="font-style: italic;">' functions that should support tmm region deletion."</span>)

(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my/paredit-kill-region-functions</span>
  '(paredit-forward-kill-word
    paredit-backward-kill-word)
  <span style="font-style: italic;">"List of `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">paredit-mode</span><span style="font-style: italic;">' functions that should support tmm region killing."</span>)

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/paredit-fix-transient-mark-mode</span> (orig-fn <span style="font-weight: bold; text-decoration: underline;">&amp;rest</span> args)
  <span style="font-style: italic;">"Allow deleting/killing a region if expression is balanced."</span>
  (<span style="font-weight: bold;">if</span> (<span style="font-weight: bold;">and</span> transient-mark-mode
           mark-active)
      (<span style="font-weight: bold;">cond</span> ((memq this-command my/paredit-delete-region-functions)
             (paredit-delete-region (region-beginning) (region-end)))
            ((memq this-command my/paredit-kill-region-functions)
             (paredit-kill-region (region-beginning) (region-end)))
            (t (apply orig-fn args)))
    (apply orig-fn args)))

(<span style="font-weight: bold;">dolist</span> (fun (append my/paredit-delete-region-functions
                     my/paredit-kill-region-functions))
  (advice-add fun <span style="font-weight: bold;">:around</span> #'my/paredit-fix-transient-mark-mode))
</pre>
</div></li>
</ul>
</div>
</li>

<li><a id="orgf2b35e4"></a>lsp-mode<br />
<div class="outline-text-6" id="text-orgf2b35e4">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-lsp-mode"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package lsp-mode
  <span style="font-weight: bold;">:commands</span> (lsp lsp-deferred)
  <span style="font-weight: bold;">:hook</span> ((python-mode) . lsp-deferred))
</pre>
</div>
</div>

<ul class="org-ul">
<li><a id="org9b96f9b"></a>lsp-ivy&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span>&#xa0;<span class="ignore">ignore</span></span><br /></li>
</ul>
</li>

<li><a id="org97fc492"></a>company-mode<br />
<div class="outline-text-6" id="text-org97fc492">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-company"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package company
  <span style="font-weight: bold;">:hook</span> (prog-mode . company-mode)
  <span style="font-weight: bold;">:bind</span> (<span style="font-weight: bold;">:map</span> company-active-map
              (<span style="font-style: italic;">"C-j"</span> . company-complete-selection)
              (<span style="font-style: italic;">"&lt;backspace&gt;"</span> . backward-delete-char-untabify)
              (<span style="font-style: italic;">"C-h"</span> . company-show-doc-buffer)
              (<span style="font-style: italic;">"C-n"</span> . company-select-next)
              (<span style="font-style: italic;">"C-p"</span> . company-select-previous)))
</pre>
</div>
</div>
</li>

<li><a id="org3756c6e"></a>flycheck<br />
<div class="outline-text-6" id="text-org3756c6e">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-flycheck"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package flycheck
  <span style="font-weight: bold;">:diminish</span>
  <span style="font-weight: bold;">:hook</span> (prog-mode . flycheck-mode-on-safe)
  <span style="font-weight: bold;">:custom</span>
  (global-flycheck-mode t)
  (flycheck-check-syntax-automatically
   '(save new-line idle-change))
  (flycheck-display-errors-delay 10.0)
  (flycheck-checker-error-threshold 1000)
  (flycheck-textlint-config <span style="font-style: italic;">".textlintrc"</span>)
  <span style="font-weight: bold;">:config</span>
  (add-to-list 'flycheck-textlint-plugin-alist
               '(org-mode . <span style="font-style: italic;">"org"</span>))
  (add-hook 'flycheck-mode-hook
            (<span style="font-weight: bold;">lambda</span> ()
              (<span style="font-weight: bold;">if</span> (my/ascii-string-p (buffer-string))
                  (<span style="font-weight: bold;">setq</span> flycheck-textlint-config <span style="font-style: italic;">".textlintrc"</span>)
                (<span style="font-weight: bold;">setq</span> flycheck-textlint-config <span style="font-style: italic;">".config/textlint/textlintrc_ja"</span>))))
  (add-to-list 'display-buffer-alist
               `(,flycheck-error-message-buffer
                 . (display-buffer-reuse-window
                    display-buffer-in-previous-window
                    display-buffer-pop-up-window
                    . ((window-height . 5))))))
</pre>
</div>
</div>
</li>

<li><a id="orga9c664f"></a>twittering-mode<br />
<div class="outline-text-6" id="text-orga9c664f">
<p>
useful tips:
</p>
<ul class="org-ul">
<li>invoke twittering-toggle-show-replied-statuses on "in reply to" state to show replied messages</li>
<li>invoke twittering-view-user-page (C-c C-v) on user name to jump to user profile page in default browser</li>
</ul>

<p>
Disclaimers: An unexpected incident might occur if twittering-icon-mode call lay at :config section of use-package
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-style: italic;">"https://github.com/hayamiz/twittering-mode/releases.atom"</span> soft_update)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my/twittering-resource-dir</span>
  (expand-file-name <span style="font-style: italic;">"twmode"</span> user-emacs-directory))

(use-package twittering-mode
  <span style="font-weight: bold;">:straight</span> (twittering-mode
             <span style="font-weight: bold;">:host</span> github
             <span style="font-weight: bold;">:repo</span> <span style="font-style: italic;">"hayamiz/twittering-mode"</span>
             <span style="font-weight: bold;">:fork</span> (<span style="font-weight: bold;">:host</span> github
                          <span style="font-weight: bold;">:repo</span> <span style="font-style: italic;">"p-snow/twittering-mode"</span>))
  <span style="font-weight: bold;">:delight</span> <span style="font-style: italic;">" TW"</span>
  <span style="font-weight: bold;">:after</span> hydra
  <span style="font-weight: bold;">:commands</span> twit
  <span style="font-weight: bold;">:hook</span>
  (twittering-mode . twittering-icon-mode)
  <span style="font-weight: bold;">:custom</span>
  (twittering-private-info-file
   (expand-file-name <span style="font-style: italic;">"twittering-mode.gpg"</span> my/twittering-resource-dir))
  (twittering-user-id-db-file
   (expand-file-name <span style="font-style: italic;">"user-info.gz"</span> my/twittering-resource-dir))
  (twittering-use-master-password t)
  (twittering-use-ssl t)
  (twittering-number-of-tweets-on-retrieval 50)
  (twittering-use-icon-storage t)
  (twittering-icon-storage-file
   (expand-file-name <span style="font-style: italic;">"icons.gz"</span> my/twittering-resource-dir))
  (twittering-icon-storage-limit 2000)
  (twittering-convert-fix-size 24)
  (twittering-initial-timeline-spec-string '(<span style="font-style: italic;">":home"</span> <span style="font-style: italic;">":mentions"</span>))
  (twittering-edit-skeleton 'inherit-any)
  (twittering-display-remaining t)
  (twittering-timeline-header <span style="font-style: italic;">""</span>)
  (twittering-timeline-footer <span style="font-style: italic;">""</span>)
  (twittering-status-format
   (concat <span style="font-style: italic;">"%RT{%FACE[bold]{RT by %S\n}}"</span>
           <span style="font-style: italic;">"%i %S,"</span>
           <span style="font-style: italic;">"%FACE[font-lock-constant-face]{%FIELD-IF-NONZERO[ &#8634;%d]{retweet_count}}"</span>
           <span style="font-style: italic;">"%FACE[font-lock-warning-face]{%FIELD-IF-NONZERO[ &#9825;%d]{favorite_count}}"</span>
           <span style="font-style: italic;">" %@{}:\n"</span>
           <span style="font-style: italic;">"%T %r%QT{\n+----\n%i %S, %@{}:\n%T %r%R\n+----}\n "</span>))
  <span style="font-weight: bold;">:config</span>
  (bind-keys <span style="font-weight: bold;">:map</span> twittering-mode-map
             (<span style="font-style: italic;">"C-c C-l"</span> . nil)
             <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">move cursor</span>
             (<span style="font-style: italic;">"f"</span> . scroll-up-line)
             (<span style="font-style: italic;">"e"</span> . scroll-down-line)
             (<span style="font-style: italic;">"E"</span> . my/twittering-previous-status-and-top)
             (<span style="font-style: italic;">"SPC"</span> . my/twittering-next-status-and-top)
             <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">create/delete tweets(messages)</span>
             (<span style="font-style: italic;">"u"</span> . twittering-update-status-interactive)
             (<span style="font-style: italic;">"j"</span> . twittering-enter)
             (<span style="font-style: italic;">"J"</span> . twittering-reply-to-user)
             (<span style="font-style: italic;">"RET"</span> . twittering-enter)
             (<span style="font-style: italic;">"o"</span> . my/twittering-open)
             (<span style="font-style: italic;">"C-c C-o"</span> . my/twittering-open)
             (<span style="font-style: italic;">"d"</span> . twittering-direct-message)
             (<span style="font-style: italic;">"k"</span> . twittering-delete-status)
             (<span style="font-style: italic;">"y"</span> . twittering-push-uri-onto-kill-ring)
             (<span style="font-style: italic;">"Y"</span> . twittering-push-tweet-onto-kill-ring)
             <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">response to tweets</span>
             (<span style="font-style: italic;">"r"</span> . twittering-native-retweet)
             (<span style="font-style: italic;">"R"</span> . my/twittering-quote-retweet)
             (<span style="font-style: italic;">"b"</span> . twittering-favorite)
             (<span style="font-style: italic;">"B"</span> . twittering-unfavorite)
             (<span style="font-style: italic;">"l"</span> . twittering-follow)
             (<span style="font-style: italic;">"L"</span> . twittering-unfollow)
             (<span style="font-style: italic;">"t"</span> . twittering-toggle-show-replied-statuses)
             (<span style="font-style: italic;">"T"</span> . twittering-toggle-or-retrieve-replied-statuses)
             <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">switch between timelines</span>
             (<span style="font-style: italic;">"n"</span> . twittering-switch-to-next-timeline)
             (<span style="font-style: italic;">"p"</span> . twittering-switch-to-previous-timeline)
             (<span style="font-style: italic;">"."</span> . twittering-visit-timeline)
             (<span style="font-style: italic;">"@"</span> . twittering-other-user-timeline)
             (<span style="font-style: italic;">"/"</span> . my/twittering-search)
             (<span style="font-style: italic;">"?"</span> . twittering-search)
             (<span style="font-style: italic;">"c1"</span> . twittering-home-timeline)
             (<span style="font-style: italic;">"c2"</span> . (<span style="font-weight: bold;">lambda</span> ()
                       (<span style="font-weight: bold;">interactive</span>)
                       (twittering-visit-timeline <span style="font-style: italic;">":mentions"</span>)))
             (<span style="font-style: italic;">"c3"</span> . (<span style="font-weight: bold;">lambda</span> ()
                       (<span style="font-weight: bold;">interactive</span>)
                       (twittering-visit-timeline <span style="font-style: italic;">":retweets_of_me"</span>)))
             (<span style="font-style: italic;">"c4"</span> . (<span style="font-weight: bold;">lambda</span> ()
                       (<span style="font-weight: bold;">interactive</span>)
                       (twittering-search <span style="font-style: italic;">"from:_p_snow"</span>)))
             (<span style="font-style: italic;">"c5"</span> . (<span style="font-weight: bold;">lambda</span> ()
                       (<span style="font-weight: bold;">interactive</span>)
                       (twittering-visit-timeline <span style="font-style: italic;">":favorites"</span>)))
             (<span style="font-style: italic;">"c6"</span> . (<span style="font-weight: bold;">lambda</span> ()
                       (<span style="font-weight: bold;">interactive</span>)
                       (twittering-visit-timeline <span style="font-style: italic;">":direct_message_events"</span>)))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/twittering-next-status-and-top</span> ()
  <span style="font-style: italic;">"docstring"</span>
  (<span style="font-weight: bold;">interactive</span>)
  (twittering-goto-next-status)
  (recenter-top-bottom 0))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/twittering-previous-status-and-top</span> ()
  <span style="font-style: italic;">"docstring"</span>
  (<span style="font-weight: bold;">interactive</span>)
  (twittering-goto-previous-status)
  (recenter-top-bottom 0))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/twittering-quote-retweet</span> ()
  <span style="font-style: italic;">"docstring"</span>
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">let</span> ((orig-tweet-uri (twittering-push-uri-onto-kill-ring)))
    (twittering-update-status (format <span style="font-style: italic;">"\n%s"</span> orig-tweet-uri))
    (next-line -1 t)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/twittering-search</span> (<span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> arg)
  <span style="font-style: italic;">""</span>
  (<span style="font-weight: bold;">interactive</span> <span style="font-style: italic;">"P"</span>)
  (<span style="font-weight: bold;">let*</span> ((spec (get-text-property (point) 'goto-spec))
         (username (get-text-property (point) 'username))
         (word (<span style="font-weight: bold;">cond</span>
                ((use-region-p) (buffer-substring (region-beginning) (region-end)))
                ((stringp spec) spec)
                ((eq (car spec) 'user) (format <span style="font-style: italic;">"@%s"</span> (cadr spec)))
                ((stringp username) username))))
    (twittering-search (<span style="font-weight: bold;">and</span> (not arg) word))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/twittering-open</span> (<span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> arg)
  <span style="font-style: italic;">""</span>
  (<span style="font-weight: bold;">interactive</span> <span style="font-style: italic;">"P"</span>)
  (<span style="font-weight: bold;">let</span> ((uri (<span style="font-weight: bold;">or</span> (get-text-property (point) 'uri)
                 (<span style="font-weight: bold;">if</span> (get-text-property (point) 'field)
                     (<span style="font-weight: bold;">let*</span> ((id (get-text-property (point) 'id))
                            (status (twittering-find-status id)))
                       (twittering-get-status-url-from-alist status))
                   nil))))
    (browse-url uri)))
</pre>
</div>
</div>
</li>

<li><a id="org8e74947"></a>comment-dwim-2&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span><br /></li>

<li><a id="org19b57df"></a>undo-tree<br />
<div class="outline-text-6" id="text-org19b57df">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-undo-tree"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-conf">d &lt;&lt;share-dir()&gt;&gt;/emacs/undo-tree 0755 - - 3w
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package undo-tree
  <span style="font-weight: bold;">:diminish</span> undo-tree-mode
  <span style="font-weight: bold;">:init</span>
  (<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">undo-tree-excludes</span> '(<span style="font-style: italic;">"/gnu/store"</span>))
  <span style="font-weight: bold;">:hook</span>
  ((text-mode prog-mode) .
   (<span style="font-weight: bold;">lambda</span> ()
     (when-let ((file-visited (<span style="font-weight: bold;">or</span> buffer-file-name
                                  org-src-source-file-name)))
       (<span style="font-weight: bold;">unless</span> (seq-some (<span style="font-weight: bold;">lambda</span> (exclude)
                           (string-match-p exclude
                                           file-visited))
                         undo-tree-excludes)
         (undo-tree-mode 1)))))
  <span style="font-weight: bold;">:custom</span>
  (undo-tree-enable-undo-in-region t)
  (undo-tree-auto-save-history nil)
  (undo-tree-limit 320000)
  (undo-tree-strong-limit 480000)
  (undo-tree-outer-limit 64000000)
  <span style="font-weight: bold;">:config</span>
  (define-key undo-tree-map (kbd <span style="font-style: italic;">"C-?"</span>) nil)
  (add-to-list 'undo-tree-history-directory-alist `(<span style="font-style: italic;">"."</span> . ,(expand-file-name <span style="font-style: italic;">"undo-tree"</span> user-emacs-directory)))
  (<span style="font-weight: bold;">setq</span> undo-tree-visualizer-buffer-name <span style="font-style: italic;">"*undo tree*"</span>)
  (add-to-list 'display-buffer-alist
               `(,undo-tree-visualizer-buffer-name . (display-buffer-in-side-window
                                                      . ((side . right)
                                                         (window-width . 15))))))
</pre>
</div>
</div>
</li>

<li><a id="org6f7b2be"></a>quickrun&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span><br /></li>

<li><a id="orgc72e3c9"></a>expand-region<br />
<div class="outline-text-6" id="text-orgc72e3c9">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-expand-region"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package expand-region
  <span style="font-weight: bold;">:bind</span> ((<span style="font-style: italic;">"C-,"</span>   . er/expand-region)
         (<span style="font-style: italic;">"C-M-,"</span> . er/contract-region))
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">push</span> 'er/mark-outside-pairs er/try-expand-list))
</pre>
</div>
</div>
</li>

<li><a id="org14d0948"></a>helpful&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span><br /></li>

<li><a id="orgd4afba4"></a>define-word<br />
<div class="outline-text-6" id="text-orgd4afba4">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-style: italic;">"https://github.com/abo-abo/define-word/releases.atom"</span> soft_update)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package define-word
  <span style="font-weight: bold;">:straight</span> t
  <span style="font-weight: bold;">:custom</span>
  (define-word-displayfn-alist
    '((wordnik . my/define-word--display-in-buffer)
      (openthesaurus . my/define-word--display-in-buffer)
      (webster . my/define-word--display-in-buffer)
      (weblio . my/define-word--display-in-buffer)))
  (define-word-default-service 'wordnik)
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">setf</span> (cdr (assoc 'wordnik define-word-services))
        '(<span style="font-style: italic;">"http://wordnik.com/words/%s"</span> my/define-word--parse-wordnik-all))
  (<span style="font-weight: bold;">push</span> '(weblio <span style="font-style: italic;">"https://ejje.weblio.jp/content/%s"</span>
                 my/define-word--parse-weblio)
        define-word-services)
  (<span style="font-weight: bold;">push</span> '(<span style="font-style: italic;">"&lt;b&gt;</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">.*?</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">&lt;/b&gt;"</span> bold)
        define-word--tag-faces)
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">fix issue #31 temporally</span>
  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/define-word--fix-31</span> (define-word-orig <span style="font-weight: bold; text-decoration: underline;">&amp;rest</span> args)
    <span style="font-style: italic;">"Fix `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">define-word</span><span style="font-style: italic;">' backends that require a user agent (like wordnik)."</span>
    (<span style="font-weight: bold;">let</span> ((url-request-extra-headers
           '((<span style="font-style: italic;">"User-Agent"</span> .
              <span style="font-style: italic;">"Mozilla/5.0 (Macintosh; Intel Mac OS X 11_5_2) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/93.0.4577.63 Safari/537.36"</span>))))
      (apply define-word-orig args)))
  (advice-add #'define-word <span style="font-weight: bold;">:around</span> #'my/define-word--fix-31))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/define-word</span> ()
  <span style="font-style: italic;">"docstring"</span>
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">if</span> (use-region-p)
      (call-interactively #'define-word-at-point)
    (call-interactively #'define-word)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/define-word--display-in-buffer</span> (definition)
  <span style="font-style: italic;">"docstring"</span>
  (<span style="font-weight: bold;">let*</span> ((buf-name <span style="font-style: italic;">"*DEFINE WORD*"</span>)
         (buffer (get-buffer-create buf-name))
         (display-buffer-alist
          `((,buf-name
             (display-buffer-same-window)))))
    (<span style="font-weight: bold;">with-current-buffer</span> buffer
      (read-only-mode -1)
      (erase-buffer)
      (insert definition)
      (goto-char (point-min))
      (<span style="font-weight: bold;">save-excursion</span> (xml-parse-string))
      (read-only-mode 1))
    (display-buffer buffer)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/define-word--parse-wordnik-example</span> ()
  (<span style="font-weight: bold;">save-excursion</span>
    (<span style="font-weight: bold;">let</span> (beg
          results
          (define-word-limit 10))
      (re-search-forward <span style="font-style: italic;">"&lt;h2&gt;Examples"</span> nil t)
      (<span style="font-weight: bold;">save-excursion</span>
        (<span style="font-weight: bold;">setq</span> beg (re-search-forward <span style="font-style: italic;">"&lt;div class=\"relatedWords-module\"&gt;"</span> nil t)))
      (<span style="font-weight: bold;">while</span> (re-search-forward <span style="font-style: italic;">"&lt;p class=\"text\"&gt;</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">.*</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">&lt;/p&gt;"</span> beg t)
        (<span style="font-weight: bold;">push</span> <span style="font-style: italic;">"---"</span> results)
        (<span style="font-weight: bold;">push</span> (match-string 1) results))
      (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">setq</span> results (nreverse results))
        (define-word--convert-html-tag-to-face (define-word--join-results results))))))

(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my/define-word-part-map-alist</span> '((<span style="font-style: italic;">"adjective"</span> <span style="font-style: italic;">"adj."</span>)
                                        (<span style="font-style: italic;">"adverb"</span> <span style="font-style: italic;">"adv."</span>)
                                        (<span style="font-style: italic;">"intransitive verb"</span> <span style="font-style: italic;">"v.i."</span>)
                                        (<span style="font-style: italic;">"transitive verb"</span> <span style="font-style: italic;">"v.t."</span>)))


(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/define-word--parse-wordnik</span> ()
  (<span style="font-weight: bold;">let</span> ((str (define-word--parse-wordnik)))
    (<span style="font-weight: bold;">with-temp-buffer</span>
      (insert str)
      (mapc (<span style="font-weight: bold;">lambda</span> (abbrev-map)
              (goto-char (point-min))
              (<span style="font-weight: bold;">while</span> (re-search-forward (format <span style="font-style: italic;">"</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">%s</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">"</span> (car abbrev-map)) nil t)
                (<span style="font-weight: bold;">let</span> ((match (match-string 1)))
                  (replace-match
                   (propertize (cadr abbrev-map) 'face (text-properties-at (point)))))))
            my/define-word-part-map-alist)
      (buffer-string))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/define-word--parse-wordnik-related-word</span> ()
  <span style="font-style: italic;">"docstring"</span>
  (<span style="font-weight: bold;">save-excursion</span>
    (<span style="font-weight: bold;">save-match-data</span>
      (seq-reduce
       (<span style="font-weight: bold;">lambda</span> (accum group)
         (<span style="font-weight: bold;">let</span> (results
               (define-word-limit 20))
           (<span style="font-weight: bold;">if</span> (re-search-forward (format <span style="font-style: italic;">"&lt;h3&gt;%s"</span> group) nil t)
               (<span style="font-weight: bold;">progn</span> (<span style="font-weight: bold;">save-excursion</span>
                        (<span style="font-weight: bold;">setq</span> beg (re-search-forward <span style="font-style: italic;">"&lt;div class=\"related-group-header clearfix\"&gt;"</span> nil t)))
                      (<span style="font-weight: bold;">push</span> (concat group <span style="font-style: italic;">":"</span>) results)
                      (<span style="font-weight: bold;">while</span> (re-search-forward <span style="font-style: italic;">"&lt;span data-definition-for=\"</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">[</span><span style="font-style: italic;">^</span><span style="font-style: italic;">\"]*</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">\""</span> beg t)
                        (<span style="font-weight: bold;">push</span> (concat <span style="font-style: italic;">"- "</span> (match-string 1)) results)
                        (re-search-forward <span style="font-style: italic;">"&lt;/span&gt;"</span>))
                      (concat (<span style="font-weight: bold;">when</span> accum (concat accum <span style="font-style: italic;">"\n\n"</span>))
                              (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">setq</span> results (nreverse results))
                                (define-word--convert-html-tag-to-face (define-word--join-results results)))))
             accum)))
       '(<span style="font-style: italic;">"antonym"</span> <span style="font-style: italic;">"equivalents"</span> <span style="font-style: italic;">"hypernyms"</span> <span style="font-style: italic;">"hyponyms"</span> <span style="font-style: italic;">"same context"</span>)
       nil))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/define-word--parse-wordnik-all</span> ()
  <span style="font-style: italic;">""</span>
  (<span style="font-weight: bold;">let*</span> ((def (funcall #'my/define-word--parse-wordnik))
         (rel (funcall #'my/define-word--parse-wordnik-related-word))
         (exp (funcall #'my/define-word--parse-wordnik-example)))
    (concat <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">"Definitions:\n" (funcall #'define-word--parse-wordnik) "\n\n"</span>
     (<span style="font-weight: bold;">when</span> def (format <span style="font-style: italic;">"Definitions:\n%s\n\n"</span> def))
     (<span style="font-weight: bold;">when</span> rel (format <span style="font-style: italic;">"%s\n\n"</span> rel))
     (<span style="font-weight: bold;">when</span> exp (format <span style="font-style: italic;">"Examples:\n%s\n"</span> exp)))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/define-word--parse-weblio</span> ()
  (<span style="font-weight: bold;">save-excursion</span>
    (<span style="font-weight: bold;">let</span> (beg
          results
          (define-word-limit 10))
      (re-search-forward <span style="font-style: italic;">"&lt;span class=\"squareCircle description\"&gt;\n[[:blank:]]*&#24847;&#21619;&#12539;&#23550;&#35379;&lt;/span&gt;"</span> nil t)
      (<span style="font-weight: bold;">save-excursion</span>
        (<span style="font-weight: bold;">setq</span> beg (re-search-forward <span style="font-style: italic;">"&lt;/div&gt;"</span> nil t)))
      (<span style="font-weight: bold;">while</span> (re-search-forward <span style="font-style: italic;">"&lt;span class=\"content-explanation  ej\"&gt;\n[[:blank:]]*</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">[</span><span style="font-style: italic;">^</span><span style="font-style: italic;">&lt;]*</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">&lt;/span&gt;"</span> beg t)
        (<span style="font-weight: bold;">push</span> (match-string 1) results))
      (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">setq</span> results (nreverse results))
        (define-word--convert-html-tag-to-face (define-word--join-results results))))))
</pre>
</div>
</div>
</li>

<li><a id="orgb2e8366"></a>synosaurus<br />
<div class="outline-text-6" id="text-orgb2e8366">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-synosaurus"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package synosaurus
  <span style="font-weight: bold;">:custom</span>
  (synosaurus-choose-method 'default))
</pre>
</div>
</div>
</li>

<li><a id="orgf652418"></a>exec-path-from-shell<br />
<div class="outline-text-6" id="text-orgf652418">
<p>
A GNU Emacs library to ensure environment variables inside Emacs look the same as in the user's shell.
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-exec-path-from-shell"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package exec-path-from-shell
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">when</span> (memq window-system '(mac))
    (exec-path-from-shell-initialize)))
</pre>
</div>
</div>
</li>

<li><a id="org0d5abda"></a>migemo.el<br />
<div class="outline-text-6" id="text-org0d5abda">
<p>
migemo allows me to search incrementally Japanese words using roma-ji expression.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-style: italic;">"https://github.com/emacs-jp/migemo/releases.atom"</span> soft_update)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package migemo
  <span style="font-weight: bold;">:straight</span> t
  <span style="font-weight: bold;">:ensure-system-package</span> cmigemo
  <span style="font-weight: bold;">:custom</span>
  (migemo-command <span style="font-style: italic;">"cmigemo"</span>)
  (migemo-options '(<span style="font-style: italic;">"-q"</span> <span style="font-style: italic;">"--emacs"</span>))
  (migemo-directory <span style="font-style: italic;">"/usr/share/cmigemo/utf-8"</span>)
  (migemo-dictionary <span style="font-style: italic;">"/usr/share/cmigemo/utf-8/migemo-dict"</span>)
  (migemo-user-dictionary nil)
  (migemo-coding-system 'utf-8-unix)
  (migemo-regex-dictionary nil)
  <span style="font-weight: bold;">:config</span>
  (migemo-init))
</pre>
</div>
</div>

<ul class="org-ul">
<li><a id="org6ec2d77"></a>ivy-migemo&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span>&#xa0;<span class="ignore">ignore</span></span><br /></li>
</ul>
</li>

<li><a id="orge437d3d"></a>jaword<br />
<div class="outline-text-6" id="text-orge437d3d">
<p>
Jaword.elbackward-wordforward-wordjaword.el
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-style: italic;">"https://github.com/zk-phi/jaword/releases.atom"</span> soft_update)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package jaword
  <span style="font-weight: bold;">:straight</span> t
  <span style="font-weight: bold;">:custom</span>
  (jaword-enable-subword t)
  <span style="font-weight: bold;">:hook</span> ((skk-mode
          . (<span style="font-weight: bold;">lambda</span> ()
              (jaword-mode 1)))
         (input-method-activate
          . (<span style="font-weight: bold;">lambda</span> ()
              (<span style="font-weight: bold;">when</span> (string= current-input-method <span style="font-style: italic;">"japanese-skk"</span>)
                (jaword-mode 1))))
         (input-method-deactivate
          . (<span style="font-weight: bold;">lambda</span> ()
              (<span style="font-weight: bold;">when</span> (string= current-input-method <span style="font-style: italic;">"japanese-skk"</span>)
                (jaword-mode -1))))))
</pre>
</div>
</div>
</li>

<li><a id="org0bfb22d"></a>hungry-delete&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span><br /></li>

<li><a id="org040d697"></a><a id="ID-4a58219c-74dd-4135-b56d-876b0db2cd83"></a>aggressive-indent-mode<br />
<div class="outline-text-6" id="text-org040d697">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-aggressive-indent"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package aggressive-indent
  <span style="font-weight: bold;">:diminish</span> (aggressive-indent-mode . <span style="font-style: italic;">"ai"</span>)
  <span style="font-weight: bold;">:hook</span> (emacs-lisp-mode . aggressive-indent-mode))
</pre>
</div>
</div>
</li>
<li><a id="orga190d1c"></a>adaptive-wrap<br />
<div class="outline-text-6" id="text-orga190d1c">
<p>
adaptive-wrap and visual-line-mode are active in a bundle in a bunch of major modes.
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-adaptive-wrap"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package adaptive-wrap)
</pre>
</div>
</div>
</li>

<li><a id="orgcbdd0fa"></a>restart-emacs<br />
<div class="outline-text-6" id="text-orgcbdd0fa">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-restart-emacs"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package restart-emacs
  <span style="font-weight: bold;">:bind</span> ((<span style="font-style: italic;">"C-M-&lt;delete&gt;"</span>   . restart-emacs)
         (<span style="font-style: italic;">"C-M-S-&lt;delete&gt;"</span> . save-buffers-kill-emacs)))
</pre>
</div>
</div>
</li>
<li><a id="org9cd346c"></a>pangu-spacing&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span><br /></li>
<li><a id="org68c8acb"></a>which-key&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span><br /></li>
<li><a id="org9f8b8ba"></a>hydra<br />
<div class="outline-text-6" id="text-org9f8b8ba">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-hydra"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package hydra
  <span style="font-weight: bold;">:custom</span>
  (hydra-is-helpful nil))
</pre>
</div>
</div>
</li>
<li><a id="org609ca42"></a>pass<br />
<div class="outline-text-6" id="text-org609ca42">
<p>
Major mode for manupulating password store file.
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-pass"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package pass
  <span style="font-weight: bold;">:config</span>
  (bind-keys <span style="font-weight: bold;">:map</span> pass-mode-map
             (<span style="font-style: italic;">"C-j"</span> . pass-view)))
</pre>
</div>
</div>
</li>

<li><a id="org5e80b77"></a>password-store<br />
<div class="outline-text-6" id="text-org5e80b77">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-password-store"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package password-store
  <span style="font-weight: bold;">:custom</span>
  (password-store-time-before-clipboard-restore 25))
</pre>
</div>
</div>
</li>

<li><a id="org064c821"></a>nov.el<br />
<div class="outline-text-6" id="text-org064c821">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-nov-el"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package nov
  <span style="font-weight: bold;">:demand</span> t
  <span style="font-weight: bold;">:mode</span> (<span style="font-style: italic;">"\\.epub$"</span> . nov-mode)
  <span style="font-weight: bold;">:hook</span> (nov-mode . nov-abbreviate-file-name)
  <span style="font-weight: bold;">:custom</span>
  (nov-variable-pitch nil)
  (nov-text-width t)
  <span style="font-weight: bold;">:config</span>
  (bind-keys <span style="font-weight: bold;">:map</span> nov-mode-map
             (<span style="font-style: italic;">"C-j"</span> . nov-browse-url)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">nov-abbreviate-file-name</span> ()
  <span style="font-style: italic;">"Shorten `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">nov-file-name</span><span style="font-style: italic;">' using `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">directory-abbrev-alist</span><span style="font-style: italic;">'."</span>
  (<span style="font-weight: bold;">setq</span> nov-file-name (abbreviate-file-name nov-file-name)))
</pre>
</div>
</div>
</li>
<li><a id="org60dc6ac"></a>yasnippet<br />
<div class="outline-text-6" id="text-org60dc6ac">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-yasnippet"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package yasnippet
  <span style="font-weight: bold;">:delight</span> (snippet-mode <span style="font-style: italic;">" SN"</span>)
  <span style="font-weight: bold;">:diminish</span> (yas-minor-mode . <span style="font-style: italic;">"ys"</span>)
  <span style="font-weight: bold;">:hook</span>
  ((prog-mode org-mode shell-mode) . yas-minor-mode-on)
  <span style="font-weight: bold;">:custom</span>
  (yas-triggers-in-field t)
  (yas-snippet-dirs
   `(,(expand-file-name <span style="font-style: italic;">"snippets"</span> user-emacs-directory-default)))
  <span style="font-weight: bold;">:config</span>
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">work around code</span>
  (yas-reload-all))
</pre>
</div>
</div>
<ul class="org-ul">
<li><a id="org0f21574"></a>yasnippet-snippets<br />
<div class="outline-text-7" id="text-org0f21574">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-yasnippet-snippets"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package yasnippet-snippets
  <span style="font-weight: bold;">:after</span> yasnippet)
</pre>
</div>
</div>
</li>
</ul>
</li>
<li><a id="org696bd92"></a>pdf-tools<br />
<div class="outline-text-6" id="text-org696bd92">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-pdf-tools"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package pdf-tools
  <span style="font-weight: bold;">:delight</span>
  (pdf-view-mode <span style="font-style: italic;">" PV"</span>)
  <span style="font-weight: bold;">:mode</span> (<span style="font-style: italic;">"\\.pdf$"</span> . pdf-view-mode)
  <span style="font-weight: bold;">:hook</span>
  (pdf-view-mode . pdf-view-midnight-minor-mode)
  (pdf-view-mode . pdf-view-fit-page-to-window)
  <span style="font-weight: bold;">:custom</span>
  (pdf-view-display-size 'fit-width))
</pre>
</div>
</div>
</li>

<li><a id="orgc824326"></a>rainbow-mode<br />
<div class="outline-text-6" id="text-orgc824326">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-rainbow-mode"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package rainbow-mode
  <span style="font-weight: bold;">:diminish</span>
  (rainbow-mode . <span style="font-style: italic;">"rb"</span>)
  <span style="font-weight: bold;">:hook</span>
  ((css-mode scss-mode php-mode html-mode) . rainbow-mode)
  <span style="font-weight: bold;">:custom</span>
  (rainbow-html-colors t)
  (rainbow-x-colors t)
  (rainbow-latex-colors t)
  (rainbow-ansi-colors t))
</pre>
</div>
</div>
</li>
<li><a id="org0086253"></a>alert<br />
<div class="outline-text-6" id="text-org0086253">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"mpg321"</span>
<span style="font-style: italic;">"emacs-alert"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package alert
  <span style="font-weight: bold;">:config</span>
  (set-face-background 'alert-saved-fringe-face nil)
  (alert-add-rule <span style="font-weight: bold;">:status</span> '(buried)
                  <span style="font-weight: bold;">:mode</span>   'mu4e-alert
                  <span style="font-weight: bold;">:style</span>  'fringe)
  (alert-add-rule <span style="font-weight: bold;">:status</span> '(buried)
                  <span style="font-weight: bold;">:mode</span>   'dired-mode
                  <span style="font-weight: bold;">:style</span>  'fringe)
  (alert-add-rule <span style="font-weight: bold;">:status</span> '(buried)
                  <span style="font-weight: bold;">:mode</span>   'org-mode
                  <span style="font-weight: bold;">:style</span>  'libnotify))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-shell"><span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">!/usr/bin/</span><span style="font-weight: bold;">env</span><span style="font-weight: bold; font-style: italic;"> bash</span>

pactl list sinks | grep <span style="font-style: italic;">'^[[:space:]]Volume:'</span> | head -n $(($<span style="font-weight: bold; font-style: italic;">SINK</span> + 1 )) | tail -n 1 | sed -e <span style="font-style: italic;">'s,.* \([0-9][0-9]*\)%.*,\1,'</span>
</pre>
</div>
</div>
</li>

<li><a id="org1371c6b"></a>ts<br />
<div class="outline-text-6" id="text-org1371c6b">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-ts"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package ts)
</pre>
</div>
</div>
</li>

<li><a id="org9a4e7bf"></a>app-launcher&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span><br /></li>

<li><a id="orge46ca1d"></a>tldr<br />
<div class="outline-text-6" id="text-orge46ca1d">
<p>
I ran into a problem with downloading TL;DR document. I forcibly download, uncompress and locate that to `tldr-directory-path'.
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-tldr"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package tldr
  <span style="font-weight: bold;">:custom</span>
  (tldr-use-word-at-point t))
</pre>
</div>
</div>
</li>

<li><a id="orgeab144c"></a>burly<br />
<div class="outline-text-6" id="text-orgeab144c">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-burly"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">burly</span>)
</pre>
</div>
</div>
</li>
</ul>
</li>
</ul>
</div>

<div id="outline-container-org7e176fe" class="outline-4">
<h4 id="org7e176fe">further customization</h4>
<div class="outline-text-4" id="text-org7e176fe">
</div>
<ul class="org-ul">
<li><a id="org902257e"></a>handy functionalities<br />
<div class="outline-text-5" id="text-org902257e">
</div>

<ul class="org-ul">
<li><a id="org6dc7ea8"></a>power management<br />
<div class="outline-text-6" id="text-org6dc7ea8">
<p>
Shut down emacs automatically when remaining power of laptop PC lower than <a href="battery-load-low">battery-load-low</a>
to avoid accidental data loss.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">battery</span>)

(run-with-timer 60 60 #'kill-emacs-auto)

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">kill-emacs-auto</span> ()
  <span style="font-style: italic;">"Kill Emacs if remaining machine power lower than `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">battery-load-low</span><span style="font-style: italic;">'."</span>
  (when-let* ((data (<span style="font-weight: bold;">and</span> battery-status-function (funcall battery-status-function)))
              (percentage (car (read-from-string (cdr (assq ?p data)))))
              (power (cdr (assq ?L data))))
    (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">and</span> (numberp percentage)
               (&lt; percentage battery-load-low)
               (stringp power)
               (string= power <span style="font-style: italic;">"BAT"</span>))
      (save-buffers-kill-emacs t))))
</pre>
</div>
</div>
</li>

<li><a id="org6d63cf4"></a>lazy viewing<br />
<div class="outline-text-6" id="text-org6d63cf4">
<p>
It's confortable to read long material such as web page , epub file or email with snappy control. Lazy View offers transient keymap that allow users to move cursor and scroll page with simple key stroke.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package emacs
  <span style="font-weight: bold;">:bind</span> (<span style="font-style: italic;">"C-c v"</span> . my/lazy-view-enter)
  <span style="font-weight: bold;">:hook</span> ((help-mode Info-mode eww-mode nov-mode mu4e-view-mode woman-mode)
         . my/lazy-view-enter))

(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my/lazy-view-map</span>
  (<span style="font-weight: bold;">let</span> ((map (make-sparse-keymap)))
    (define-key map (kbd <span style="font-style: italic;">"&lt;SPC&gt;"</span>) #'my/forward-paragraph)
    (define-key map (kbd <span style="font-style: italic;">"E"</span>) #'my/backward-paragraph)
    (define-key map (kbd <span style="font-style: italic;">"f"</span>) #'scroll-up-line)
    (define-key map (kbd <span style="font-style: italic;">"e"</span>) #'scroll-down-line)
    (define-key map (kbd <span style="font-style: italic;">"F"</span>) #'forward-char)
    (define-key map (kbd <span style="font-style: italic;">"B"</span>) #'backward-char)
    (define-key map (kbd <span style="font-style: italic;">"N"</span>) #'next-line)
    (define-key map (kbd <span style="font-style: italic;">"P"</span>) #'previous-line)
    (define-key map (kbd <span style="font-style: italic;">"C-a"</span>) #'move-beginning-of-line)
    (define-key map (kbd <span style="font-style: italic;">"C-e"</span>) #'move-end-of-line)
    (define-key map (kbd <span style="font-style: italic;">"C-v"</span>) #'scroll-up-command)
    (define-key map (kbd <span style="font-style: italic;">"M-v"</span>) #'scroll-down-command)
    (lambda-key map (kbd <span style="font-style: italic;">"&gt;"</span>) '(lambda () <span style="font-style: italic;">"Scroll right one column."</span> (<span style="font-weight: bold;">interactive</span>)
                                 (scroll-left 1)))
    (define-key map (kbd <span style="font-style: italic;">"C-&gt;"</span>) #'scroll-left)
    (lambda-key map (kbd <span style="font-style: italic;">"&lt;"</span>) '(lambda () <span style="font-style: italic;">"Scroll left one column."</span> (<span style="font-weight: bold;">interactive</span>)
                                 (scroll-right 1)))
    (define-key map (kbd <span style="font-style: italic;">"C-&lt;"</span>) #'scroll-right)
    (define-key map (kbd <span style="font-style: italic;">"+"</span>) #'text-scale-adjust)
    (define-key map (kbd <span style="font-style: italic;">"-"</span>) #'text-scale-adjust)
    (define-key map (kbd <span style="font-style: italic;">"="</span>) #'text-scale-adjust)
    (define-key map (kbd <span style="font-style: italic;">"0"</span>) #'text-scale-adjust)
    (define-key map (kbd <span style="font-style: italic;">"\\"</span>) #'toggle-truncate-lines)
    (define-key map (kbd <span style="font-style: italic;">"|"</span>) #'visual-line-mode)
    map))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/lazy-view-enter</span> ()
  <span style="font-style: italic;">"Activate my/lazy-view-map in current buffer."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (set-transient-map my/lazy-view-map
                     #'my/lazy-view-keep
                     #'my/lazy-view-exit)
  (set-face-attribute 'fringe nil <span style="font-weight: bold;">:background</span> <span style="font-style: italic;">"LightSeaGreen"</span>))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/lazy-view-keep</span> ()
  (<span style="font-weight: bold;">if</span> (member this-command
              `(beginning-of-visual-line
                end-of-visual-line
                recenter-top-bottom
                reposition-window
                Info-next-reference
                Info-prev-reference
                Info-up
                Info-history-back
                Info-history-forward
                Info-follow-nearest-node
                Info-forward-node
                Info-backward-node
                forward-button
                backward-button
                shr-next-link
                shr-previous-link
                eww-follow-link
                eww-back-url
                eww-forward-url
                eww-goto-title-heading
                eww-reload
                nov-browse-url
                nov-next-document
                nov-previous-document
                ,@(mapcar (<span style="font-weight: bold;">lambda</span> (key-command)
                            (<span style="font-weight: bold;">let</span> ((cmd (cdr key-command)))
                              (<span style="font-weight: bold;">and</span> (commandp cmd)
                                   cmd)))
                          (cdr my/lazy-view-map))))
      t nil))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/lazy-view-exit</span> ()
  (set-face-attribute 'fringe nil <span style="font-weight: bold;">:background</span> nil))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/forward-paragraph</span> ()
  (<span style="font-weight: bold;">interactive</span>)
  (forward-paragraph 2)
  (backward-paragraph 1)
  (forward-line 1)
  (recenter-top-bottom 0))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/backward-paragraph</span> ()
  (<span style="font-weight: bold;">interactive</span>)
  (backward-paragraph 2)
  (forward-paragraph 1)
  (backward-paragraph 1)
  (forward-line 1)
  (recenter-top-bottom 0))
</pre>
</div>
</div>
</li>

<li><a id="org6dc37ff"></a>lookup functions<br />
<div class="outline-text-6" id="text-org6dc37ff">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defmacro</span> <span style="font-weight: bold;">define-lookup-function</span> (fun search-prefix)
  <span style="font-style: italic;">"Create lookup function named FUN using SEARCH-PREFIX for querying.</span>

<span style="font-style: italic;">if WORD-FIXED is given, use it as a search word."</span>
  (<span style="font-weight: bold;">declare</span> (indent 1))
  `(<span style="font-weight: bold;">defun</span> ,fun (word <span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> arg)
     <span style="font-style: italic;">"Issue search query with WORD.</span>

<span style="font-style: italic;">Use a string in region for WORD if region is active.</span>
<span style="font-style: italic;">If called with prefix argument, prompt the user to input WORD regardless region is active or not."</span>
     (<span style="font-weight: bold;">interactive</span> (<span style="font-weight: bold;">let</span> ((region-str (<span style="font-weight: bold;">when</span> (use-region-p)
                                      (buffer-substring (region-beginning) (region-end)))))
                    (list (<span style="font-weight: bold;">cond</span>
                           ((<span style="font-weight: bold;">and</span> (stringp region-str)
                                 (equal current-prefix-arg nil))
                            region-str)
                           (t
                            (read-string <span style="font-style: italic;">"Enter URL or keywords: "</span> region-str))))))
     (<span style="font-weight: bold;">let</span> ((eww-search-prefix ,search-prefix))
       (eww word 4))))

(define-lookup-function lookup-google <span style="font-style: italic;">"https://www.google.com/search?q="</span>)
(define-lookup-function lookup-wikipedia-en <span style="font-style: italic;">"https://en.wikipedia.org/wiki/"</span>)
(define-lookup-function lookup-wikipedia-ja <span style="font-style: italic;">"https://ja.wikipedia.org/wiki/"</span>)
(define-lookup-function lookup-amazon <span style="font-style: italic;">"https://www.amazon.co.jp/gp/search/?field-keywords="</span>)
(define-lookup-function lookup-melpa <span style="font-style: italic;">"https://melpa.org/#/?q="</span>)
(define-lookup-function lookup-duckduckgo <span style="font-style: italic;">"https://duckduckgo.com/html/?kl=jp-jp&amp;k1=-1&amp;kc=1&amp;kf=-1&amp;q="</span>)
(define-lookup-function lookup-eijiro <span style="font-style: italic;">"https://eow.alc.co.jp/search?q="</span>)
(define-lookup-function lookup-weblio <span style="font-style: italic;">"https://www.weblio.jp/content/"</span>)
(define-lookup-function lookup-youtube <span style="font-style: italic;">"https://www.youtube.com/results?search_query="</span>)

(<span style="font-weight: bold;">with-eval-after-load</span> 'hydra
  (defhydra hydra-lookup (global-map <span style="font-style: italic;">"C-c l"</span>
                                     <span style="font-weight: bold;">:color</span> blue)
    <span style="font-style: italic;">"Lookup"</span>
    (<span style="font-style: italic;">"g"</span> lookup-google)
    (<span style="font-style: italic;">"G"</span> lookup-duckduckgo <span style="font-style: italic;">"duckduckgo"</span>)
    (<span style="font-style: italic;">"w"</span> lookup-wikipedia-ja)
    (<span style="font-style: italic;">"W"</span> lookup-wikipedia-en)
    (<span style="font-style: italic;">"d"</span> (<span style="font-weight: bold;">lambda</span> (<span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> arg)
           (<span style="font-weight: bold;">interactive</span> <span style="font-style: italic;">"P"</span>)
           (<span style="font-weight: bold;">if</span> (equal arg '(4))
               (funcall-interactively #'dictionary-search nil)
             (dictionary-lookup-definition))))
    (<span style="font-style: italic;">"a"</span> lookup-amazon <span style="font-style: italic;">"amazon.co.jp"</span>)
    (<span style="font-style: italic;">"m"</span> lookup-melpa <span style="font-style: italic;">"melpa"</span>)
    (<span style="font-style: italic;">"l"</span> lookup-weblio <span style="font-style: italic;">"weblio"</span>)
    (<span style="font-style: italic;">"y"</span> lookup-youtube <span style="font-style: italic;">"youtube"</span>)
    (<span style="font-style: italic;">"e"</span> my/define-word)
    (<span style="font-style: italic;">"j"</span> (<span style="font-weight: bold;">lambda</span> ()
           (<span style="font-weight: bold;">interactive</span>)
           (<span style="font-weight: bold;">let</span> ((define-word-default-service 'weblio))
             (my/define-word)))
     <span style="font-style: italic;">"japanese translation"</span>)
    (<span style="font-style: italic;">"J"</span> lookup-eijiro)
    (<span style="font-style: italic;">"s"</span> synosaurus-lookup <span style="font-style: italic;">"synosaurus-lookup"</span>)
    (<span style="font-style: italic;">"S"</span> synosaurus-choose-and-replace <span style="font-style: italic;">"synosaurus-replace"</span>)
    (<span style="font-style: italic;">"oe"</span> my/org-english-lookup)
    (<span style="font-style: italic;">"q"</span> nil <span style="font-style: italic;">"quit"</span>)))
</pre>
</div>
</div>
</li>

<li><a id="org630a07f"></a>tldr<br />
<div class="outline-text-6" id="text-org630a07f">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/tldr</span> (command)
  <span style="font-style: italic;">"Show the output of tldr for COMMAND in a dedicated buffer."</span>
  (<span style="font-weight: bold;">interactive</span> (list (read-string <span style="font-style: italic;">"Coomand: "</span>)))
  (<span style="font-weight: bold;">let*</span> ((buf-name <span style="font-style: italic;">"*TL;DR*"</span>)
         (buffer (get-buffer-create buf-name)))
    (<span style="font-weight: bold;">with-current-buffer</span> buffer
      (read-only-mode -1)
      (erase-buffer)
      (insert (shell-command-to-string (format <span style="font-style: italic;">"tldr %s"</span>
                                               (shell-quote-argument command))))
      (ansi-color-apply-on-region (point-min) (point-max))
      (goto-char (point-min))
      (read-only-mode 1))
    (display-buffer buffer '((display-buffer-pop-up-window)
                             . ((window-height . 8))))
    (switch-to-buffer-other-window buffer)))
</pre>
</div>
</div>
</li>

<li><a id="org0479a5e"></a>sending email<br />
<div class="outline-text-6" id="text-org0479a5e">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">mail-simple-send</span> (mailto subject body)
  <span style="font-style: italic;">"Default function to send a mail with SUBJECT and BODY to myself."</span>
  (<span style="font-weight: bold;">save-excursion</span>
    (<span style="font-weight: bold;">let</span> ((message-kill-buffer-on-exit t))
      (message-mail mailto subject)
      (message-goto-body)
      (insert body)
      (message-send-and-exit))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">mail-buffer</span> (mailto)
  <span style="font-style: italic;">"Send the current buffer contents as a email.</span>

<span style="font-style: italic;">If region is active, send the string in the region instead."</span>
  (<span style="font-weight: bold;">let</span> ((mail-subj (buffer-name))
        (mail-body (<span style="font-weight: bold;">if</span> (use-region-p)
                       (buffer-substring (region-beginning) (region-end))
                     (buffer-string))))
    (mail-simple-send mailto mail-subj mail-body)))
</pre>
</div>
</div>
</li>

<li><a id="org87f4417"></a>download media file<br />
<div class="outline-text-6" id="text-org87f4417">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my/download-video-dir</span>
  (file-name-concat <span style="font-style: italic;">"&lt;&lt;video-dir()&gt;&gt;"</span> <span style="font-style: italic;">"downloads"</span>)
  <span style="font-style: italic;">"Directory where downloaded video locate."</span>)

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/download-video</span> (url <span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> filename playlistp)
  <span style="font-style: italic;">"Download video from `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">URL</span><span style="font-style: italic;">'.</span>

<span style="font-style: italic;">If optional argument `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">FILENAME</span><span style="font-style: italic;">' is passed, try to use this as filename.</span>
<span style="font-style: italic;">If optional argument `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">PLAYLISTP</span><span style="font-style: italic;">' is passed, try to download all videos in playlist</span>
<span style="font-style: italic;">instead of single video."</span>
  (<span style="font-weight: bold;">interactive</span> (list (read-string <span style="font-style: italic;">"URL: "</span>)))
  (<span style="font-weight: bold;">when</span> (string-match <span style="font-style: italic;">"https?://www.youtube.com.+"</span> url)
    (<span style="font-weight: bold;">let*</span> ((url-orig (match-string 0 url))
           (urlobj-orig (url-generic-parse-url url-orig))
           (pq-orig (url-path-and-query urlobj-orig))
           (yt-url
            (<span style="font-weight: bold;">if</span> (<span style="font-weight: bold;">and</span> (not playlistp)
                     (string= (car pq-orig) <span style="font-style: italic;">"/watch"</span>)
                     (assoc-string <span style="font-style: italic;">"list"</span> (url-parse-query-string (cdr pq-orig))))
                (url-recreate-url
                 (url-parse-make-urlobj (url-type urlobj-orig)
                                        (url-user urlobj-orig)
                                        (url-password urlobj-orig)
                                        (url-host urlobj-orig)
                                        (url-portspec urlobj-orig)
                                        (concat (car pq-orig) <span style="font-style: italic;">"?"</span>
                                                (url-build-query-string
                                                 (list (assoc <span style="font-style: italic;">"v"</span> (url-parse-query-string (cdr pq-orig))))))
                                        (url-target urlobj-orig)
                                        (url-attributes urlobj-orig)
                                        (url-fullness urlobj-orig)))
              url)))
      (<span style="font-weight: bold;">setq</span> lexical-binding t)
      (<span style="font-weight: bold;">setq</span> url-lex url)
      (<span style="font-weight: bold;">setq</span> filename-lex (<span style="font-weight: bold;">if</span> filename
                             (replace-regexp-in-string
                              <span style="font-style: italic;">"[\\?\"/:|&#8217;]"</span> <span style="font-style: italic;">""</span> filename)
                           nil))
      (message <span style="font-style: italic;">"Downloading: %s"</span> (<span style="font-weight: bold;">or</span> filename-lex url))
      (set-process-sentinel
       (start-process-shell-command
        <span style="font-style: italic;">"download video"</span> nil
        (format <span style="font-style: italic;">"cd \"%1$s\" &amp;&amp; nohup yt-dlp %2$s \"%3$s\" &gt;/dev/null 2&gt;&amp;1"</span>
                (expand-file-name my/download-video-dir)
                (mapconcat #'identity
                           (list (format <span style="font-style: italic;">"--format \"%s\""</span> (ytdl-format))
                                 (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">and</span> filename-lex
                                            (not playlistp)
                                            (not (string= (car pq-orig) <span style="font-style: italic;">"/playlist"</span>)))
                                   (format <span style="font-style: italic;">"--output %s"</span> (shell-quote-argument filename-lex)))
                                 (<span style="font-weight: bold;">when</span> playlistp <span style="font-style: italic;">"--yes-playlist --ignore-errors --download-archive downloaded.txt"</span>))
                           <span style="font-style: italic;">" "</span>)
                yt-url))
       (<span style="font-weight: bold;">lambda</span> (process desc)
         (<span style="font-weight: bold;">when</span> (eq (process-status process) 'exit)
           (<span style="font-weight: bold;">let</span> ((exit-status (process-exit-status process)))
             (<span style="font-weight: bold;">if</span> (= exit-status 0)
                 (alert (format <span style="font-style: italic;">"Downloaded: %s"</span> (<span style="font-weight: bold;">or</span> filename-lex url-lex)) <span style="font-weight: bold;">:severity</span> 'normal <span style="font-weight: bold;">:style</span> 'fringe)
               (alert (format <span style="font-style: italic;">"Failed(%d): %s"</span> exit-status (<span style="font-weight: bold;">or</span> filename-lex url-lex)) <span style="font-weight: bold;">:severity</span> 'urgent <span style="font-weight: bold;">:style</span> 'fringe)))))))))

(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my/download-audio-dir</span>
  (file-name-concat <span style="font-style: italic;">"&lt;&lt;audio-dir()&gt;&gt;"</span> <span style="font-style: italic;">"downloads"</span>)
  <span style="font-style: italic;">"Directory where downloaded audio locate."</span>)

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/download-audio</span> (url <span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> filename)
  <span style="font-style: italic;">"Download audio from `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">URL</span><span style="font-style: italic;">'.</span>

<span style="font-style: italic;">If optional argument `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">FILENAME</span><span style="font-style: italic;">' is given use this as a filename."</span>
  (<span style="font-weight: bold;">interactive</span> (list (read-string <span style="font-style: italic;">"URL: "</span>)))
  (<span style="font-weight: bold;">setq</span> lexical-binding t)
  (<span style="font-weight: bold;">setq</span> url-lex url)
  (<span style="font-weight: bold;">setq</span> filename-lex (<span style="font-weight: bold;">if</span> filename
                         (replace-regexp-in-string
                          <span style="font-style: italic;">"[\\?\"/:|&#8217;]"</span> <span style="font-style: italic;">""</span> filename)
                       nil))
  (message <span style="font-style: italic;">"Downloading: %s"</span> (<span style="font-weight: bold;">or</span> filename-lex url))
  (set-process-sentinel
   (start-process-shell-command
    <span style="font-style: italic;">"download audio"</span> nil
    (format <span style="font-style: italic;">"cd %s &amp;&amp; nohup %s &gt;/dev/null 2&gt;&amp;1"</span>
            (shell-quote-argument (expand-file-name my/download-audio-dir))
            (<span style="font-weight: bold;">if</span> (string-match-p <span style="font-style: italic;">"https?://www.youtube.com.+"</span> url)
                (format <span style="font-style: italic;">"yt-dlp --extract-audio %s"</span> url)
              (concat (format <span style="font-style: italic;">"curl -LJs %s"</span> url)
                      (<span style="font-weight: bold;">and</span> filename-lex
                           (format <span style="font-style: italic;">" -o %s.%s"</span> filename-lex
                                   (file-name-extension url)))))))
   (<span style="font-weight: bold;">lambda</span> (process desc)
     (<span style="font-weight: bold;">when</span> (eq (process-status process) 'exit)
       (<span style="font-weight: bold;">let</span> ((exit-status (process-exit-status process)))
         (<span style="font-weight: bold;">if</span> (= exit-status 0)
             (alert (format <span style="font-style: italic;">"Downloaded: %s"</span> (<span style="font-weight: bold;">or</span> filename-lex url-lex)) <span style="font-weight: bold;">:severity</span> 'normal <span style="font-weight: bold;">:style</span> 'fringe)
           (alert (format <span style="font-style: italic;">"Failed(%d): %s"</span> exit-status (<span style="font-weight: bold;">or</span> filename-lex url-lex)) <span style="font-weight: bold;">:severity</span> 'urgent <span style="font-weight: bold;">:style</span> 'fringe)))))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">show-media-duration</span> (url)
  <span style="font-style: italic;">"Return a duration value for media located at URL."</span>
  (when-let ((duration (<span style="font-weight: bold;">cond</span>
                        ((string-match <span style="font-style: italic;">"https?://www.youtube.com.+"</span> url)
                         (car (split-string (shell-command-to-string
                                             (format <span style="font-style: italic;">"yt-dlp --get-duration %s"</span> url)))))
                        ((string-match <span style="font-style: italic;">"https?://.+"</span> url)
                         (car (split-string (shell-command-to-string
                                             (format <span style="font-style: italic;">"ffmpeg -i \"%s\" 2&gt;&amp;1 | grep Duration | awk -F '[ ]+' '{print substr($3, 0, length($3)-1)}'"</span> url))))))))
    (message <span style="font-style: italic;">"Duration: %s"</span> (<span style="font-weight: bold;">if</span> (stringp duration)
                                duration <span style="font-style: italic;">"N/A"</span>))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/download-video-at-point</span> ()
  <span style="font-style: italic;">"Download video file from url currently pointed."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (when-let ((url (thing-at-point-url-at-point)))
    (my/download-video url)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/download-audio-at-point</span> ()
  <span style="font-style: italic;">"Download audio file from url currently pointed."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">let</span> ((url (thing-at-point-url-at-point)))
    (<span style="font-weight: bold;">when</span> url
      (my/download-audio url))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/show-media-duration-at-point</span> ()
  <span style="font-style: italic;">"Show duration of media file which cursor currently pointed."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (if-let* ((url (thing-at-point-url-at-point)))
      (show-media-duration url)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">ytdl-format</span> ()
  <span style="font-style: italic;">"Return appropriate format option value for youtube-dl command."</span>
  (<span style="font-weight: bold;">let*</span> ((ipv4-addr (shell-command-to-string <span style="font-style: italic;">"hostname -I | cut -f1 -d' ' | tr -d '\n'"</span>))
         (wifi-ssid (shell-command-to-string <span style="font-style: italic;">"iwgetid -r | tr -d '\n'"</span>))
         (fmt-quality (<span style="font-weight: bold;">cond</span>
                       <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">using mobile Wi-Fi</span>
                       ((string-prefix-p <span style="font-style: italic;">"192.168.179."</span> ipv4-addr)
                        <span style="font-style: italic;">"b[filesize&lt;20M] / w"</span>)
                       <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">using wired network or broad wifi</span>
                       ((<span style="font-weight: bold;">or</span> (string-prefix-p <span style="font-style: italic;">"192.168.100."</span> ipv4-addr)
                            (member wifi-ssid '(<span style="font-style: italic;">"saint_laurent_ap"</span> <span style="font-style: italic;">"FREE_SPOT"</span>)))
                        <span style="font-style: italic;">"bv*[height&lt;=720]+ba/b"</span>)
                       <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">using unknown network</span>
                       (t
                        <span style="font-style: italic;">"wv*+wa/w"</span>))))
    (format <span style="font-style: italic;">"%s"</span> fmt-quality)))

(global-set-key (kbd <span style="font-style: italic;">"C-c D v"</span>) 'my/download-video-at-point)
(global-set-key (kbd <span style="font-style: italic;">"C-c D a"</span>) 'my/download-audio-at-point)
(global-set-key (kbd <span style="font-style: italic;">"C-c D ="</span>) 'my/show-media-duration-at-point)
</pre>
</div>
</div>
</li>

<li><a id="org54ec9e4"></a>text to speech<br />
<div class="outline-text-6" id="text-org54ec9e4">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">festival</span>)

(<span style="font-weight: bold;">defcustom</span> <span style="font-weight: bold; font-style: italic;">my/say-maximum-duration</span> 30
  <span style="font-style: italic;">"Maximum speech duration in second for `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">my/say</span><span style="font-style: italic;">'."</span>)
(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my/say--timer</span> nil <span style="font-style: italic;">"Timer used to cancel speech process."</span>)
(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my/say--open-jtalk-process</span> <span style="font-style: italic;">"Say&lt;Open-JTalk&gt;"</span>
  <span style="font-style: italic;">"Fixed name for a process running Open JTalk."</span>)

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/say</span> (string)
  <span style="font-style: italic;">"Say out `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">STRING</span><span style="font-style: italic;">'.</span>

<span style="font-style: italic;">If an argument is given as `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">STRING</span><span style="font-style: italic;">', speech that text. Otherwise the buffer text</span>
<span style="font-style: italic;"> is spoken unless region is active.</span>

<span style="font-style: italic;">As of now, English and Japanese are supported for speech. Spoken language is</span>
<span style="font-style: italic;"> determined by a string, specifically a string entirely consists of ASCII</span>
<span style="font-style: italic;"> characters is identified as English. Otherwise the string is spoken in Japanese."</span>
  (<span style="font-weight: bold;">interactive</span> (list (<span style="font-weight: bold;">if</span> (region-active-p)
                         (buffer-substring (region-beginning) (region-end))
                       (buffer-string))))
  (<span style="font-weight: bold;">let</span> ((my/say-lang 'en))
    (<span style="font-weight: bold;">if</span> (string-match-p
         (format <span style="font-style: italic;">"\\`[%s]+\\'"</span> <span style="font-style: italic;">"[:ascii:]&#8217;&#8220;&#8221;&#8211;"</span>) string)
        <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">festival-say-string is unusable if region is active</span>
        (<span style="font-weight: bold;">if</span> (region-active-p)
            (festival-say-region (region-beginning) (region-end))
          (festival-say-string string))
      (my/say--open-jtalk string)
      (<span style="font-weight: bold;">setq</span> my/say-lang 'ja))
    (<span style="font-weight: bold;">setq</span> my/say--timer
          (<span style="font-weight: bold;">cond</span>
           ((eq my/say-lang 'en)
            (run-with-timer my/say-maximum-duration nil
                            (<span style="font-weight: bold;">lambda</span> ()
                              (festival-kill-process)
                              (<span style="font-weight: bold;">setq</span> my/say--timer nil))))
           ((eq my/say-lang 'ja)
            (run-with-timer my/say-maximum-duration nil
                            (<span style="font-weight: bold;">lambda</span> ()
                              (<span style="font-weight: bold;">and</span> (get-process my/say--open-jtalk-process)
                                   (interrupt-process my/say--open-jtalk-process))
                              (<span style="font-weight: bold;">setq</span> my/say--timer nil))))))))
(global-set-key (kbd <span style="font-style: italic;">"C-x \""</span>) #'my/say)

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/say-cancel</span> ()
  <span style="font-style: italic;">"Cancel speech process that has started by `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">my/say</span><span style="font-style: italic;">'."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">and</span> my/say--timer
       (<span style="font-weight: bold;">progn</span> (cancel-timer my/say--timer)
              (<span style="font-weight: bold;">setq</span> my/say--timer nil)))
  (<span style="font-weight: bold;">if</span> (<span style="font-weight: bold;">and</span> festival-process
           (string= (process-status festival-process)
                    <span style="font-style: italic;">"run"</span>))
      (festival-kill-process)
    (<span style="font-weight: bold;">and</span> (get-process my/say--open-jtalk-process)
         (interrupt-process my/say--open-jtalk-process))))
(global-set-key (kbd <span style="font-style: italic;">"C-x C-\""</span>) #'my/say-cancel)
(<span style="font-weight: bold;">with-eval-after-load</span> 'embark
  (define-key embark-region-map <span style="font-style: italic;">"\""</span> #'my/say))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/say--open-jtalk</span> (text)
  <span style="font-style: italic;">"Speech TEXT in Japanese using Open JTalk."</span>
  (start-process-shell-command
   my/say--open-jtalk-process nil
   (format <span style="font-style: italic;">"echo %s | open_jtalk -x /var/lib/mecab/dic/open-jtalk/naist-jdic -m &lt;&lt;hts-voice-dir()&gt;&gt;/Voice/mei/mei_angry.htsvoice -ow /tmp/a.wav &amp;&amp; aplay /tmp/a.wav"</span>
           (replace-regexp-in-string <span style="font-style: italic;">"[\t\r\n\v\f]+"</span> <span style="font-style: italic;">" "</span> text))))
</pre>
</div>
</div>

<ul class="org-ul">
<li><a id="org2d21b75"></a>jsay&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span><br /></li>

<li><a id="orgb93ac5a"></a>esay&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span><br /></li>
</ul>
</li>

<li><a id="orge066792"></a>collective hydra definitions<br />
<div class="outline-text-6" id="text-orge066792">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">with-eval-after-load</span> 'hydra
  (defhydra hydra-launcher (global-map <span style="font-style: italic;">"M-o"</span>
                                       <span style="font-weight: bold;">:color</span> blue)
    <span style="font-style: italic;">"Launch"</span>
    (<span style="font-style: italic;">"e"</span> eshell)
    (<span style="font-style: italic;">"v"</span> my/multi-vterm)
    (<span style="font-style: italic;">"V"</span> multi-vterm-project)
    (<span style="font-style: italic;">"D"</span> dired-jump)
    (<span style="font-style: italic;">"="</span> ediff)
    (<span style="font-style: italic;">"@"</span> twit)
    (<span style="font-style: italic;">"g"</span> magit-status)
    (<span style="font-style: italic;">"r"</span> re-builder)
    (<span style="font-style: italic;">"w"</span> eww)
    (<span style="font-style: italic;">"W"</span> eww-switch-to-buffer)
    (<span style="font-style: italic;">"m"</span> mu4e)
    (<span style="font-style: italic;">"M"</span> mu4e-alert-view-unread-mails)
    (<span style="font-style: italic;">"p"</span> proced)
    (<span style="font-style: italic;">"P"</span> list-processes)
    (<span style="font-style: italic;">"d"</span> run-dig)
    (<span style="font-style: italic;">"if"</span> ifconfig)
    (<span style="font-style: italic;">"iw"</span> iwconfig)
    (<span style="font-style: italic;">"I"</span> ping)
    (<span style="font-style: italic;">"b"</span> battery)
    (<span style="font-style: italic;">"c"</span> calendar)
    (<span style="font-style: italic;">"%"</span> calc)
    (<span style="font-style: italic;">"?"</span> woman)
    (<span style="font-style: italic;">"t"</span> mentor)
    (<span style="font-style: italic;">"\\"</span> locate-with-filter)
    (<span style="font-style: italic;">";"</span> my/tldr)
    (<span style="font-style: italic;">"q"</span> quickrun)
    (<span style="font-style: italic;">"C-g"</span> nil <span style="font-style: italic;">"cancel"</span>))
  (defhydra hydra-toggle
    (global-map <span style="font-style: italic;">"C-c t"</span>
                <span style="font-weight: bold;">:color</span> pink
                <span style="font-weight: bold;">:pre</span> (set-face-background 'mode-line <span style="font-style: italic;">"DarkOrange4"</span>)
                <span style="font-weight: bold;">:post</span> (set-face-background 'mode-line <span style="font-style: italic;">"gray10"</span>))
    <span style="font-style: italic;">"Toggle"</span>
    (<span style="font-style: italic;">"t"</span> visual-line-mode)
    (<span style="font-style: italic;">"T"</span> toggle-truncate-lines)
    (<span style="font-style: italic;">"i"</span> adaptive-wrap-prefix-mode)
    (<span style="font-style: italic;">"p"</span> variable-pitch-mode)
    (<span style="font-style: italic;">"w"</span> whitespace-mode)
    (<span style="font-style: italic;">"l"</span> display-line-numbers-mode)
    (<span style="font-style: italic;">"L"</span> line-number-mode)
    (<span style="font-style: italic;">"C"</span> column-number-mode)
    (<span style="font-style: italic;">"v"</span> view-mode)
    (<span style="font-style: italic;">"r"</span> rainbow-mode)
    (<span style="font-style: italic;">"\\"</span> toggle-input-method)
    (<span style="font-style: italic;">"F"</span> toggle-frame-fullscreen)
    (<span style="font-style: italic;">"SPC"</span> pangu-spacing-mode)
    (<span style="font-style: italic;">"q"</span> nil <span style="font-style: italic;">"quit"</span>)))
</pre>
</div>
</div>
</li>

<li><a id="org1726f63"></a>show the day in calendar<br />
<div class="outline-text-6" id="text-org1726f63">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/calendar-show-items</span> ()
  <span style="font-style: italic;">"Show items on the day pointed in calendar view."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">let*</span> ((calendar-date-display-form calendar-iso-date-display-form)
         (date (calendar-date-string (calendar-cursor-to-date)))
         (d (parse-time-string date))
         (year (decoded-time-year d))
         (files (file-expand-wildcards (file-name-concat org-directory <span style="font-style: italic;">"archive"</span> <span style="font-style: italic;">"archive_*.org"</span>)))
         (buffer-name-prefix <span style="font-style: italic;">"=="</span>)
         (buffer-name (concat buffer-name-prefix date))
         (display-buffer-alist
          `((,buffer-name-prefix
             (display-buffer-reuse-mode-window
              display-buffer-pop-up-window)))))
    (org-ql-search files `(<span style="font-weight: bold;">and</span> (<span style="font-weight: bold;">or</span> (parent (heading ,date))
                                   (ts-a <span style="font-weight: bold;">:on</span> ,date))
                               (not (tags <span style="font-style: italic;">"web"</span> <span style="font-style: italic;">"drill"</span>)))
      <span style="font-weight: bold;">:buffer</span> buffer-name)
    (other-window 1)))
</pre>
</div>
</div>
</li>

<li><a id="orgf6bde9b"></a>disable external IME (fcitx)<br />
<div class="outline-text-6" id="text-orgf6bde9b">
<p>
As of 28.1, Emacs won't steal keyboard focus at startup which means we can use external input methods. But I'm confortable with shutting out external IM, fcitx in my case. Restarting fcitx makes my desire come true.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(add-hook 'emacs-startup-hook
          (<span style="font-weight: bold;">lambda</span> ()
            (call-process-shell-command <span style="font-style: italic;">"fcitx -r"</span>)))
</pre>
</div>
</div>
</li>

<li><a id="org5bc24ad"></a>replace regexp with re-builder and query-replace-regexp trick<br />
<div class="outline-text-6" id="text-org5bc24ad">
<p>
Great idea using re-builder when query-replace-regexp borrowed from <a href="https://karthinks.com/software/bridging-islands-in-emacs-1/">this post</a>.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my/re-builder-positions</span> nil
  <span style="font-style: italic;">"Store point and region bounds before calling re-builder"</span>)

(advice-add 're-builder
            <span style="font-weight: bold;">:before</span>
            (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/re-builder-save-state</span> (<span style="font-weight: bold; text-decoration: underline;">&amp;rest</span> _)
              <span style="font-style: italic;">"Save into `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">my/re-builder-positions</span><span style="font-style: italic;">' the point and region</span>
<span style="font-style: italic;">positions before calling `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">re-builder</span><span style="font-style: italic;">'."</span>
              (<span style="font-weight: bold;">setq</span> my/re-builder-positions
                    (cons (point)
                          (<span style="font-weight: bold;">when</span> (region-active-p)
                            (list (region-beginning)
                                  (region-end)))))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">reb-replace-regexp</span> (<span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> delimited)
  <span style="font-style: italic;">"Run `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">query-replace-regexp</span><span style="font-style: italic;">' with the contents of re-builder. With</span>
<span style="font-style: italic;">non-nil optional argument DELIMITED, only replace matches</span>
<span style="font-style: italic;">surrounded by word boundaries."</span>
  (<span style="font-weight: bold;">interactive</span> <span style="font-style: italic;">"P"</span>)
  (reb-update-regexp)
  (<span style="font-weight: bold;">let*</span> ((re (reb-target-binding reb-regexp))
         (replacement (query-replace-read-to
                       re
                       (concat <span style="font-style: italic;">"Query replace"</span>
                               (<span style="font-weight: bold;">if</span> current-prefix-arg
                                   (<span style="font-weight: bold;">if</span> (eq current-prefix-arg '-) <span style="font-style: italic;">" backward"</span> <span style="font-style: italic;">" word"</span>)
                                 <span style="font-style: italic;">""</span>)
                               <span style="font-style: italic;">" regexp"</span>
                               (<span style="font-weight: bold;">if</span> (<span style="font-weight: bold;">with-selected-window</span> reb-target-window
                                     (region-active-p)) <span style="font-style: italic;">" in region"</span> <span style="font-style: italic;">""</span>))
                       t))
         (pnt (car my/re-builder-positions))
         (beg (cadr my/re-builder-positions))
         (end (caddr my/re-builder-positions)))
    (<span style="font-weight: bold;">with-selected-window</span> reb-target-window
      (goto-char pnt) <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">replace with (goto-char (match-beginning 0)) if you want</span>
                                        <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">to control where in the buffer the replacement starts</span>
                                        <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">with re-builder</span>
      (<span style="font-weight: bold;">setq</span> my/re-builder-positions nil)
      (reb-quit)
      (query-replace-regexp re replacement delimited beg end))))

(define-key reb-mode-map (kbd <span style="font-style: italic;">"RET"</span>) #'reb-replace-regexp)
(define-key reb-lisp-mode-map (kbd <span style="font-style: italic;">"RET"</span>) #'reb-replace-regexp)
(global-set-key (kbd <span style="font-style: italic;">"C-%"</span>) #'re-builder)
</pre>
</div>
</div>
</li>

<li><a id="org238a731"></a>repeat maps<br />
<div class="outline-text-6" id="text-org238a731">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my/delete-repeat-map</span>
  (<span style="font-weight: bold;">let</span> ((map (make-sparse-keymap)))
    (define-key map <span style="font-style: italic;">"\C-d"</span> (<span style="font-weight: bold;">lambda</span> ()
                             (<span style="font-weight: bold;">interactive</span>)
                             (<span style="font-weight: bold;">setq</span> repeat-map 'my/delete-repeat-map)
                             (<span style="font-weight: bold;">if</span> (eq major-mode 'org-mode)
                                 (org-delete-char 1)
                               (delete-char 1))))
    (define-key map <span style="font-style: italic;">"\M-d"</span> (<span style="font-weight: bold;">lambda</span> ()
                             (<span style="font-weight: bold;">interactive</span>)
                             (<span style="font-weight: bold;">setq</span> repeat-map 'my/delete-repeat-map)
                             (<span style="font-weight: bold;">if</span> jaword-mode
                                 (jaword-kill 1)
                               (kill-word 1))))
    (define-key map <span style="font-style: italic;">"\C-h"</span> (<span style="font-weight: bold;">lambda</span> ()
                             (<span style="font-weight: bold;">interactive</span>)
                             (<span style="font-weight: bold;">setq</span> repeat-map 'my/delete-repeat-map)
                             (<span style="font-weight: bold;">if</span> (eq major-mode 'org-mode)
                                 (org-delete-backward-char 1)
                               (delete-backward-char 1))))
    (define-key map <span style="font-style: italic;">"\M-h"</span> (<span style="font-weight: bold;">lambda</span> ()
                             (<span style="font-weight: bold;">interactive</span>)
                             (<span style="font-weight: bold;">setq</span> repeat-map 'my/delete-repeat-map)
                             (<span style="font-weight: bold;">if</span> jaword-mode
                                 (jaword-kill -1)
                               (backward-kill-word 1))))
    map)
  <span style="font-style: italic;">"Keymap to repeat `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">next-error</span><span style="font-style: italic;">' key sequences.  Used in `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">repeat-mode</span><span style="font-style: italic;">'."</span>)
(put 'delete-char 'repeat-map 'my/delete-repeat-map)
(put 'org-delete-char 'repeat-map 'my/delete-repeat-map)
(put 'kill-word 'repeat-map 'my/delete-repeat-map)
(put 'jaword-kill 'repeat-map 'my/delete-repeat-map)
</pre>
</div>
</div>
</li>

<li><a id="org8e65669"></a>utility lisp functions/commands<br />
<div class="outline-text-6" id="text-org8e65669">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/copy-line-number</span> ()
  <span style="font-style: italic;">"Copy the line number of current point into the kill ring."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">let</span> ((line-number (number-to-string (line-number-at-pos))))
    (message <span style="font-style: italic;">"Line number: %s"</span> line-number)
    (kill-new line-number)))
(global-set-key (kbd <span style="font-style: italic;">"C-M-S-w"</span>) 'my/copy-line-number)

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/insert-time-stamp</span> (<span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> arg)
  <span style="font-style: italic;">"Insert date string with format derived in deterministic way with ARG."</span>
  (<span style="font-weight: bold;">interactive</span> <span style="font-style: italic;">"P"</span>)
  (<span style="font-weight: bold;">let*</span> ((simple-fmt <span style="font-style: italic;">"%Y%m%d"</span>)
         (concise-fmt <span style="font-style: italic;">"%Y-%m-%d"</span>)
         (verbose-fmt <span style="font-style: italic;">"%Y-%m-%d %H:%M:%S"</span>)
         (fmt-in-use (<span style="font-weight: bold;">cond</span>
                      ((equal arg '(16))
                       (read-string <span style="font-style: italic;">"time format: "</span>
                                    <span style="font-style: italic;">"%Y-%m-%d %H:%M:%S"</span>))
                      ((equal arg '(4))
                       verbose-fmt)
                      (t (<span style="font-weight: bold;">cond</span>
                          ((eq major-mode 'text-mode) concise-fmt)
                          ((eq major-mode 'dired-mode) simple-fmt)
                          (t simple-fmt))))))
    (insert (format-time-string fmt-in-use))))
(global-set-key (kbd <span style="font-style: italic;">"C-c ."</span>) 'my/insert-time-stamp)

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/drag-line-backward</span> ()
  <span style="font-style: italic;">"Drag up current line for one."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (transpose-lines 1)
  (previous-line 2))
(global-set-key (kbd <span style="font-style: italic;">"M-S-&lt;up&gt;"</span>) 'my/drag-line-backward)

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/drag-line-forward</span> ()
  <span style="font-style: italic;">"Drag down current line for one."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (next-line 1)
  (transpose-lines 1)
  (previous-line 1))
(global-set-key (kbd <span style="font-style: italic;">"M-S-&lt;down&gt;"</span>) 'my/drag-line-forward)

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/comment-box</span> (b e)
  <span style="font-style: italic;">"Draw a box comment around the region but arrange for the region</span>
<span style="font-style: italic;">  to extend to at least the fill column. Place the point after the</span>
<span style="font-style: italic;">  comment box."</span>
  (<span style="font-weight: bold;">interactive</span> <span style="font-style: italic;">"r"</span>)
  (<span style="font-weight: bold;">let</span> ((e (copy-marker e t)))
    (goto-char b)
    (end-of-line)
    (insert-char ?  (- fill-column (current-column)))
    (comment-box b e 1)
    (goto-char e)
    (set-marker e nil)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/ascii-string-p</span> (string)
  <span style="font-style: italic;">"Return non-nil if `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">STRING</span><span style="font-style: italic;">' seems to be made of ASCII."</span>
  (<span style="font-weight: bold;">if</span> (length&gt; string 0)
      (string-match-p
       (format <span style="font-style: italic;">"\\`[%s]+\\'"</span> <span style="font-style: italic;">"[:ascii:]&#8217;&#8220;&#8221;&#8211;"</span>)
       string)
    t))
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="orge7d0178"></a>original features<br />
<ul class="org-ul">
<li><a id="org5d6d2df"></a>org-password-store<br />
<div class="outline-text-6" id="text-org5d6d2df">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">password-store</span>)

(<span style="font-weight: bold;">defcustom</span> <span style="font-weight: bold; font-style: italic;">my/org-password-store-property</span> <span style="font-style: italic;">"PASSWORD_STORE"</span>
  <span style="font-style: italic;">"Property used in my/password-store feature to get password-store entry name attached to current org entry."</span>)

(<span style="font-weight: bold;">defmacro</span> <span style="font-weight: bold;">with-password-store-entry</span> (entry <span style="font-weight: bold; text-decoration: underline;">&amp;rest</span> body)
  <span style="font-style: italic;">"Eval BODY that can refer password-store ENTRY."</span>
  (<span style="font-weight: bold;">declare</span> (indent defun))
  `(<span style="font-weight: bold;">let</span> ((entry (<span style="font-weight: bold;">or</span> ,entry
                    (<span style="font-weight: bold;">when</span> (derived-mode-p 'org-mode) (org-entry-get (point) my/org-password-store-property))
                    (password-store--completing-read t))))
     ,@body))

(<span style="font-weight: bold;">defmacro</span> <span style="font-weight: bold;">with-password-store-entry-field</span> (entry field <span style="font-weight: bold; text-decoration: underline;">&amp;rest</span> body)
  <span style="font-style: italic;">"Eval BODY which can refer password-store ENTRY and FIELD..</span>

<span style="font-style: italic;">Plus, OBDY can refer value of FIELD named field-value."</span>
  (<span style="font-weight: bold;">declare</span> (indent defun))
  `(<span style="font-weight: bold;">let*</span> ((entry (<span style="font-weight: bold;">or</span> ,entry
                     (<span style="font-weight: bold;">when</span> (derived-mode-p 'org-mode) (org-entry-get (point) my/org-password-store-property))
                     (password-store--completing-read t)))
          (field (<span style="font-weight: bold;">or</span> ,field
                     (password-store-read-field entry)))
          (field-value (password-store-get-field entry field)))
     ,@body))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/password-store-copy</span> ()
  <span style="font-style: italic;">"Add the secret to system clipboard and the username to primary `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">x-selection</span><span style="font-style: italic;">'.</span>

<span style="font-style: italic;">`</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">password-store-copy</span><span style="font-style: italic;">' is responsible for managing the kill ring."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (with-password-store-entry-field nil <span style="font-style: italic;">"username"</span>
    (password-store-copy entry)
    (gui-set-selection 'PRIMARY
                       (<span style="font-weight: bold;">or</span> (password-store-get-field entry <span style="font-style: italic;">"username"</span>)
                           (password-store-get-field entry <span style="font-style: italic;">"email"</span>)
                           (nth 1 (password-store-parse-entry entry))))
    (message <span style="font-style: italic;">"USERNAME =&gt; X-SEL, SECRET =&gt; CLIPBOARD"</span>)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/password-store-copy-field</span> ()
  <span style="font-style: italic;">"Add field for entry into the kill ring.</span>

<span style="font-style: italic;">entry and field is determined by appropriate manner."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (with-password-store-entry-field nil nil
    (password-store-copy-field entry field)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/password-store-url</span> (<span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> arg)
  <span style="font-style: italic;">"Browse url stored in entry by appropriate manner determined by ARG."</span>
  (<span style="font-weight: bold;">interactive</span> <span style="font-style: italic;">"P"</span>)
  (with-password-store-entry-field nil <span style="font-style: italic;">"url"</span>
    (browse-url field-value)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/password-store-show-field</span> ()
  <span style="font-style: italic;">"Show a field value in the minibuffer.</span>

<span style="font-style: italic;">Password-store entry and field used to derive this value are from org property</span>
<span style="font-style: italic;">or selected by user."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (with-password-store-entry-field nil nil
    (message <span style="font-style: italic;">"%s: %s"</span> field field-value)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/password-store-create</span> ()
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">let*</span> ((input (read-string <span style="font-style: italic;">"Entry-name or URL: "</span>))
         (domain (<span style="font-weight: bold;">when</span> (string-match-p browse-url-button-regexp input)
                   (string-trim-right
                    (shell-command-to-string (format <span style="font-style: italic;">"echo %s | awk -F[/:] '{print $4}'"</span>
                                                     (shell-quote-argument input)))))))
    (with-password-store-entry (<span style="font-weight: bold;">cond</span>
                                ((&gt; (length domain) 0) domain)
                                (input))
      (<span style="font-weight: bold;">when</span> (derived-mode-p 'org-mode)
        (org-entry-put (point) my/org-password-store-property entry))
      (password-store-edit entry))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/password-store-edit</span> ()
  (<span style="font-weight: bold;">interactive</span>)
  (with-password-store-entry nil
    (password-store-edit entry)))

<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">TODO: make my/password-store-insert as soon after</span>
<span style="font-weight: bold; font-style: italic;">;;     </span><span style="font-weight: bold; font-style: italic;">: password-store--run-insert has been implemented</span>

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/password-store-remove</span> ()
  (<span style="font-weight: bold;">interactive</span>)
  (with-password-store-entry nil
    (password-store-remove entry)
    (<span style="font-weight: bold;">when</span> (derived-mode-p 'org-mode)
      (org-entry-delete (point) my/org-password-store-property))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/password-store-web-login</span> ()
  <span style="font-style: italic;">"Open url for the entry at point.</span>

<span style="font-style: italic;">Additionally the username and the secret are saved in X selection and clipboard respectively."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (my/password-store-copy)
  (funcall-interactively #'my/password-store-url '(16)))

(advice-add #'password-store-clear <span style="font-weight: bold;">:before</span> #'my/password-store-clear)

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/password-store-clear</span> (<span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> field)
  <span style="font-style: italic;">"Overwrite clipboard data so that password once saved in clipboard is deleted</span>
<span style="font-style: italic;"> for security risk.</span>

<span style="font-style: italic;">FIELD originally for messaging is ignored in this function."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">when</span> password-store-kill-ring-pointer
    (kill-new <span style="font-style: italic;">""</span>)
    (setcar kill-ring-yank-pointer <span style="font-style: italic;">""</span>)))

(<span style="font-weight: bold;">with-eval-after-load</span> 'hydra
  (defhydra hydra-password-store (global-map <span style="font-style: italic;">"C-o p"</span>
                                             <span style="font-weight: bold;">:color</span> teal)
    <span style="font-style: italic;">"Password store"</span>
    (<span style="font-style: italic;">"cc"</span> my/password-store-copy)
    (<span style="font-style: italic;">"cf"</span> my/password-store-copy-field)
    (<span style="font-style: italic;">"s"</span> my/password-store-show-field)
    (<span style="font-style: italic;">"w"</span> my/password-store-url)
    (<span style="font-style: italic;">"l"</span> my/password-store-web-login)
    (<span style="font-style: italic;">"n"</span> my/password-store-create)
    (<span style="font-style: italic;">"e"</span> my/password-store-edit)
    (<span style="font-style: italic;">"v"</span> my/password-store-edit)
    (<span style="font-style: italic;">"k"</span> my/password-store-remove)
    (<span style="font-style: italic;">"q"</span> nil <span style="font-style: italic;">"quit"</span>)))
</pre>
</div>
</div>
</li>

<li><a id="orgb1790ea"></a>org-archive-datetree&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span><br /></li>

<li><a id="orgc36db48"></a>org-capture-derived<br />
<div class="outline-text-6" id="text-orgc36db48">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">thingatpt</span>)
(<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">whitespace</span>)

(<span style="font-weight: bold;">with-eval-after-load</span> 'org-capture
  (mapc (<span style="font-weight: bold;">lambda</span> (template)
          (add-to-list 'org-capture-templates
                       template))
        '((<span style="font-style: italic;">"x"</span> <span style="font-style: italic;">"actionable entry for manual input"</span>
           entry
           (<span style="font-weight: bold;">function</span> org-capture-derived-target-function)
           <span style="font-style: italic;">"* %(org-capture-derived-insert-todo)%? %(org-set-tags org-capture-derived-tags)\n%(org-capture-derived-insert-deadline)"</span>)
          (<span style="font-style: italic;">"X"</span> <span style="font-style: italic;">"Actionable entry for automated input"</span>
           entry
           (<span style="font-weight: bold;">function</span> org-capture-derived-target-function)
           <span style="font-style: italic;">"* %(org-capture-derived-insert-todo)%a %(org-set-tags org-capture-derived-tags)\n%(org-capture-derived-insert-deadline)"</span>
           <span style="font-weight: bold;">:immediate-finish</span> t))))

(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">org-capture-derived-todo</span> nil
  <span style="font-style: italic;">"Todo state to be set to an org entry which org-capture-derived creates.</span>

<span style="font-style: italic;">User should set this value locally, otherwise unexpected results occur."</span>)
(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">org-capture-derived-tags</span> nil
  <span style="font-style: italic;">"Tags represented with colon(:) to be set to an org entry which org-capture-derived creates.</span>

<span style="font-style: italic;">User should set this value locally, otherwise unexpected results occur."</span>)
(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">org-capture-derived-target</span> nil <span style="font-style: italic;">"docstring"</span>)
(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">org-capture-derived-deadline-in-day</span> nil <span style="font-style: italic;">"docstring"</span>)

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">org-capture-derived-target-function</span> ()
  <span style="font-style: italic;">""</span>
  (<span style="font-weight: bold;">cond</span>
   ((listp org-capture-derived-target)
    (set-buffer (org-capture-target-buffer (nth 1 org-capture-derived-target)))
    (org-capture-put-target-region-and-position)
    (widen)
    (goto-char (nth 3 org-capture-derived-target)))
   ((<span style="font-weight: bold;">and</span> (stringp org-capture-derived-target)
         (string-match-p thing-at-point-uuid-regexp org-capture-derived-target))
    (org-id-goto org-capture-derived-target))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">org-capture-derived</span> (<span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> arg)
  <span style="font-style: italic;">"C-u user is asked for all arguments</span>
<span style="font-style: italic;">C-u C-u create manually"</span>
  (<span style="font-weight: bold;">interactive</span> <span style="font-style: italic;">"P"</span>)
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">insert ID property unless existing</span>
  (<span style="font-weight: bold;">cond</span>
   ((<span style="font-weight: bold;">and</span> (eq major-mode 'org-mode)
         (not (equal arg '(16))))
    (org-id-get nil t)))
  (<span style="font-weight: bold;">let*</span> ((todo-in-org
          (<span style="font-weight: bold;">when</span> (derived-mode-p 'org-mode)
            (org-entry-get (point) <span style="font-style: italic;">"DERIVED_TODO"</span> t)))
         (org-capture-derived-todo
          (<span style="font-weight: bold;">or</span> todo-in-org
              org-capture-derived-todo))
         (tags-in-org
          (<span style="font-weight: bold;">when</span> (derived-mode-p 'org-mode)
            (org-entry-get (point) <span style="font-style: italic;">"DERIVED_TAGS"</span> t)))
         (org-capture-derived-tags
          (<span style="font-weight: bold;">or</span> (<span style="font-weight: bold;">when</span> (not (equal arg '(4)))
                (<span style="font-weight: bold;">or</span> tags-in-org
                    org-capture-derived-tags))
              (read-string <span style="font-style: italic;">"Tags: "</span> tags-in-org)))
         (target-in-org
          (<span style="font-weight: bold;">when</span> (derived-mode-p 'org-mode)
            (org-entry-get (point) <span style="font-style: italic;">"DERIVED_TARGET"</span> t)))
         (org-capture-derived-target
          (<span style="font-weight: bold;">or</span> (<span style="font-weight: bold;">when</span> (not (equal arg '(4)))
                (<span style="font-weight: bold;">or</span> target-in-org
                    org-capture-derived-target))
              (org-refile-get-location)))
         (deadline-str-in-org
          (<span style="font-weight: bold;">when</span> (derived-mode-p 'org-mode)
            (org-entry-get (point) <span style="font-style: italic;">"DERIVED_DEADLINE_IN_DAY"</span> t)))
         (deadline-num-in-org
          (<span style="font-weight: bold;">if</span> (stringp deadline-str-in-org) (string-to-number deadline-str-in-org) nil))
         (org-capture-derived-deadline-in-day
          (<span style="font-weight: bold;">if</span> (equal arg '(4))
              (read-number <span style="font-style: italic;">"Deadline in day: "</span>
                           deadline-num-in-org)
            (<span style="font-weight: bold;">or</span> deadline-num-in-org
                org-capture-derived-deadline-in-day))))
    (<span style="font-weight: bold;">if</span> (equal arg '(16))
        (org-capture nil <span style="font-style: italic;">"x"</span>)
      (org-capture nil <span style="font-style: italic;">"X"</span>))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">org-capture-derived-insert-todo</span> ()
  <span style="font-style: italic;">""</span>
  (<span style="font-weight: bold;">if</span> (stringp org-capture-derived-todo)
      (<span style="font-weight: bold;">if</span> (string-match-p whitespace-trailing-regexp
                          org-capture-derived-todo)
          org-capture-derived-todo
        (format <span style="font-style: italic;">"%s "</span> org-capture-derived-todo))
    <span style="font-style: italic;">""</span>))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">org-capture-derived-insert-deadline</span> ()
  <span style="font-style: italic;">""</span>
  (<span style="font-weight: bold;">if</span> (numberp org-capture-derived-deadline-in-day)
      (<span style="font-weight: bold;">let</span> ((week-ahead (encode-time
                         (seq-map-indexed (<span style="font-weight: bold;">lambda</span> (element index)
                                            (<span style="font-weight: bold;">if</span> (= index 3)
                                                (+ element org-capture-derived-deadline-in-day)
                                              element))
                                          (decode-time (current-time))))))
        (format-time-string <span style="font-style: italic;">"DEADLINE: &lt;%Y-%m-%d %a&gt;"</span> week-ahead))
    <span style="font-style: italic;">""</span>))
</pre>
</div>
</div>
</li>

<li><a id="org1ea5d42"></a>org-relate<br />
<div class="outline-text-6" id="text-org1ea5d42">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">thingatpt</span>)
(<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">org-ql-search</span>)

(<span style="font-weight: bold;">defconst</span> <span style="font-weight: bold; font-style: italic;">org-relate-property</span> <span style="font-style: italic;">"PARENT"</span>
  <span style="font-style: italic;">"Property name for child nodes to look up parent node."</span>)
(<span style="font-weight: bold;">defcustom</span> <span style="font-weight: bold; font-style: italic;">org-relate-parent-tag-list</span>
  `(,my/org-project-tag <span style="font-style: italic;">"refile"</span>)
  <span style="font-style: italic;">"A list of tags all parent nodes must have one of them."</span>)
(<span style="font-weight: bold;">defcustom</span> <span style="font-weight: bold; font-style: italic;">org-relate-target-files</span>
  (directory-files-recursively org-directory <span style="font-style: italic;">"\\.org$"</span>)
  <span style="font-style: italic;">"A list of target files to search relation nodes."</span>)

(<span style="font-weight: bold;">with-eval-after-load</span> 'org
  (bind-key <span style="font-style: italic;">"C-c %"</span> #'org-relate-search
            org-mode-map))

(<span style="font-weight: bold;">with-eval-after-load</span> 'org-keys
  (<span style="font-weight: bold;">setf</span> (map-elt org-speed-commands <span style="font-style: italic;">"%"</span>) #'org-relate-search)
  (<span style="font-weight: bold;">setf</span> (map-elt org-speed-commands <span style="font-style: italic;">"&amp;"</span>) #'org-relate-interrelate)
  (<span style="font-weight: bold;">push</span> '(<span style="font-style: italic;">"Org-Relate Operation"</span>) org-speed-commands))

(<span style="font-weight: bold;">with-eval-after-load</span> 'org-agenda
  (bind-keys <span style="font-weight: bold;">:map</span> org-agenda-mode-map
             (<span style="font-style: italic;">"&amp;"</span> . org-agenda-relation-interrelate)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">org-relate-search</span> ()
  <span style="font-style: italic;">"Search for entries related to the entry at point.</span>

<span style="font-style: italic;">User who would like to search for parent and children of that, namely siblings,</span>
<span style="font-style: italic;"> must press 'p'.</span>
<span style="font-style: italic;">User who would like to search for children of this entry must press 'c'.</span>
<span style="font-style: italic;">User who would like to search for friends either pointing to this entry</span>
<span style="font-style: italic;"> or pointed from this entry must be press 'f'.</span>
<span style="font-style: italic;">User who would like to search for all listed above must press 'a'."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">let*</span> ((org-super-agenda-properties-inherit nil)
         (char (read-char-from-minibuffer <span style="font-style: italic;">"Target: [a]ll [p]arent [c]hild [f]riend"</span>))
         (queries (seq-remove 'null
                              (<span style="font-weight: bold;">cond</span>
                               ((equal char ?a) (list (org-relate--search-parent-org-ql-query)
                                                      (org-relate--search-children-org-ql-query)
                                                      (org-relate--search-friends-refer-org-ql-query)
                                                      (org-relate--search-friends-referred-org-ql-query)
                                                      (org-relate--search-siblings-org-ql-query)))
                               ((equal char ?p) (list (org-relate--search-parent-org-ql-query)
                                                      (org-relate--search-siblings-org-ql-query)))
                               ((equal char ?c) (list (org-relate--search-children-org-ql-query)))
                               ((equal char ?f) (list (org-relate--search-friends-refer-org-ql-query)
                                                      (org-relate--search-friends-referred-org-ql-query)))))))
    (<span style="font-weight: bold;">if</span> queries
        (org-ql-search org-relate-target-files
          (seq-reduce (<span style="font-weight: bold;">lambda</span> (accum elem)
                        (<span style="font-weight: bold;">push</span> elem (cdr (last accum)))
                        accum)
                      (mapcar 'car queries)
                      '(<span style="font-weight: bold;">or</span>))
          <span style="font-weight: bold;">:super-groups</span> (mapcar 'cdr queries))
      (message <span style="font-style: italic;">"No query found"</span>))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">org-relate--search-children-org-ql-query</span> ()
  (when-let* ((id (org-id-get))
              (rel-prop-link (format <span style="font-style: italic;">"[[id:%s]]"</span> id)))
    `((<span style="font-weight: bold;">or</span> (property ,org-relate-property ,id)
          (property ,org-relate-property ,rel-prop-link)) <span style="font-weight: bold;">.</span>
          (<span style="font-weight: bold;">:name</span> <span style="font-style: italic;">"Children"</span> <span style="font-weight: bold;">:auto-property</span> ,org-relate-property))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">org-relate--search-parent-org-ql-query</span> ()
  (if-let* ((prop-ref (org-entry-get (point) org-relate-property))
            (index (string-match (format <span style="font-style: italic;">"</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">%s</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">"</span> thing-at-point-uuid-regexp) prop-ref))
            (parent-id (match-string 0 prop-ref)))
      `((property <span style="font-style: italic;">"ID"</span> ,parent-id) .
        (<span style="font-weight: bold;">:name</span> <span style="font-style: italic;">"Parent"</span> <span style="font-weight: bold;">:auto-property</span> <span style="font-style: italic;">"ID"</span>))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">org-relate--search-siblings-org-ql-query</span> ()
  (if-let* ((prop-ref (org-entry-get (point) org-relate-property))
            (index (string-match (format <span style="font-style: italic;">"</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">%s</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">"</span> thing-at-point-uuid-regexp) prop-ref))
            (parent-id (match-string 0 prop-ref))
            (parent-id-link (format <span style="font-style: italic;">"[[id:%s]]"</span> parent-id)))
      `((<span style="font-weight: bold;">or</span> (property ,org-relate-property ,parent-id)
            (property ,org-relate-property ,parent-id-link)) <span style="font-weight: bold;">.</span>
            (<span style="font-weight: bold;">:name</span> <span style="font-style: italic;">"Siblings"</span> <span style="font-weight: bold;">:auto-property</span> ,org-relate-property))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">org-relate--search-friends-refer-org-ql-query</span> ()
  (when-let* ((id (org-id-get))
              (ref-re (format <span style="font-style: italic;">"\\[\\[</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">id:%s\\</span><span style="font-style: italic;">].*\\]"</span> id)))
    `((regexp ,ref-re) .
      (<span style="font-weight: bold;">:name</span> <span style="font-style: italic;">"Friends pointing to this entry"</span> <span style="font-weight: bold;">:regexp</span> ,ref-re))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">org-relate--search-friends-referred-org-ql-query</span> ()
  (<span style="font-weight: bold;">let*</span> ((id-link-re (format <span style="font-style: italic;">"\\[\\[id:</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">%s</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">\\].*\\]"</span> thing-at-point-uuid-regexp))
         (end (<span style="font-weight: bold;">or</span> (<span style="font-weight: bold;">save-excursion</span>
                    (outline-next-heading))
                  (point-max))))
    (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">save-excursion</span>
            (re-search-forward id-link-re end t))
      `((property <span style="font-style: italic;">"ID"</span> ,(match-string 1)) .
        (<span style="font-weight: bold;">:name</span> <span style="font-style: italic;">"Friends to whom this entry is pointing"</span> <span style="font-weight: bold;">:auto-property</span> (<span style="font-style: italic;">"ID"</span> ,(match-string 1)))))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">org-relate-interrelate</span> ()
  <span style="font-style: italic;">"Make parent-child relationship by inserting property.</span>

<span style="font-style: italic;">This command must be called in parent node which should have one of `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">org-relate-parent-tag-list</span><span style="font-style: italic;">'."</span>
  (<span style="font-weight: bold;">interactive</span>)
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">relate the entry at point and its children if the entry has some of `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">org-relate-parent-tag-list</span><span style="font-weight: bold; font-style: italic;">'</span>
  (<span style="font-weight: bold;">save-excursion</span>
    (org-back-to-heading)
    (<span style="font-weight: bold;">when</span> (cl-some (<span style="font-weight: bold;">lambda</span> (parent-tag)
                     (member parent-tag (org-get-tags)))
                   org-relate-parent-tag-list)
      (<span style="font-weight: bold;">let*</span> ((ref-id (org-id-get-create))
             (ent-link (format <span style="font-style: italic;">"[[id:%s]]"</span> ref-id)))
        (<span style="font-weight: bold;">and</span> (org-goto-first-child)
             (<span style="font-weight: bold;">cl-labels</span> ((set-ref-id-to-siblings
                          (ref-link)
                          (org-set-property org-relate-property
                                            ref-link)
                          (<span style="font-weight: bold;">and</span> (org-goto-sibling)
                               (set-ref-id-to-siblings ref-link))))
               (set-ref-id-to-siblings ent-link))))))
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">relate the entry at point and a parent if the parent has some of `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">org-relate-parent-tag-list</span><span style="font-weight: bold; font-style: italic;">'</span>
  (<span style="font-weight: bold;">let</span> (parent-link)
    (<span style="font-weight: bold;">save-excursion</span>
      (org-up-heading-safe)
      (<span style="font-weight: bold;">when</span> (seq-some (<span style="font-weight: bold;">lambda</span> (parent-tag)
                        (member parent-tag (org-get-tags)))
                      org-relate-parent-tag-list)
        (<span style="font-weight: bold;">setq</span> parent-link (format <span style="font-style: italic;">"[[id:%s]]"</span> (org-id-get-create)))))
    (<span style="font-weight: bold;">and</span> parent-link
         (org-set-property org-relate-property
                           parent-link))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">org-agenda-relation-interrelate</span> ()
  <span style="font-style: italic;">"Invoke `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">org-relate-interrelate</span><span style="font-style: italic;">' in agenda view."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (org-agenda-check-no-diary)
  (<span style="font-weight: bold;">let*</span> ((hdmarker (<span style="font-weight: bold;">or</span> (org-get-at-bol 'org-hd-marker)
                       (org-agenda-error)))
         (buffer (marker-buffer hdmarker))
         (pos (marker-position hdmarker))
         (inhibit-read-only t)
         newhead)
    (<span style="font-weight: bold;">org-with-remote-undo</span> buffer
      (<span style="font-weight: bold;">with-current-buffer</span> buffer
        (widen)
        (goto-char pos)
        (org-show-context 'agenda)
        (call-interactively 'org-relate-interrelate)
        (end-of-line 1)
        (<span style="font-weight: bold;">setq</span> newhead (org-get-heading))))))

(<span style="font-weight: bold;">provide</span> '<span style="font-weight: bold; text-decoration: underline;">org-relate</span>)
</pre>
</div>
</div>
</li>

<li><a id="orgc68d2ad"></a>clocktable-by-tag with org-clock<br />
<div class="outline-text-6" id="text-orgc68d2ad">
<p>
Provide a function to Build a clock table summing up time by tag.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">org-table</span>)
(<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">org-clock</span>)

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">clocktable-by-tag/shift-cell</span> (n)
  (<span style="font-weight: bold;">let</span> ((str <span style="font-style: italic;">""</span>))
    (<span style="font-weight: bold;">dotimes</span> (i n)
      (<span style="font-weight: bold;">setq</span> str (concat str <span style="font-style: italic;">"| "</span>)))
    str))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">clocktable-by-tag/insert-tag</span> (params)
  (<span style="font-weight: bold;">let</span> ((match (plist-get params <span style="font-weight: bold;">:match</span>)))
    (insert <span style="font-style: italic;">"|--\n"</span>)
    (insert (format <span style="font-style: italic;">"| %s | *Tag time* |\n"</span> match))
    (<span style="font-weight: bold;">let</span> ((total 0))
      (mapcar
       (<span style="font-weight: bold;">lambda</span> (file)
         (<span style="font-weight: bold;">let</span> ((clock-data (<span style="font-weight: bold;">with-current-buffer</span> (find-file-noselect file)
                             (org-clock-get-table-data (buffer-name) params))))
           (<span style="font-weight: bold;">when</span> (&gt; (nth 1 clock-data) 0)
             (<span style="font-weight: bold;">setq</span> total (+ total (nth 1 clock-data)))
             (insert (format <span style="font-style: italic;">"| | File *%s* | %.2f |\n"</span>
                             (file-name-nondirectory file)
                             (/ (nth 1 clock-data) 60.0)))
             (<span style="font-weight: bold;">dolist</span> (entry (nth 2 clock-data))
               (insert (format <span style="font-style: italic;">"| | . %s%s | %s %.2f |\n"</span>
                               (org-clocktable-indent-string (nth 0 entry))
                               (replace-regexp-in-string <span style="font-style: italic;">"|"</span> <span style="font-style: italic;">"\\vert</span><span style="font-weight: bold; font-style: italic;">\</span><span style="font-style: italic;">{</span><span style="font-weight: bold; font-style: italic;">\</span><span style="font-style: italic;">}"</span> (nth 1 entry) nil t)
                               (clocktable-by-tag/shift-cell (nth 0 entry))
                               (/ (nth 4 entry) 60.0)))))))
       (org-agenda-files))
      (<span style="font-weight: bold;">if</span> (= total 0)
          (<span style="font-weight: bold;">save-excursion</span>
            (re-search-backward <span style="font-style: italic;">"*Tag time*"</span>)
            (forward-line -1)
            (<span style="font-weight: bold;">dotimes</span> (i 2)
              (org-table-kill-row)))
        (<span style="font-weight: bold;">save-excursion</span>
          (re-search-backward <span style="font-style: italic;">"*Tag time*"</span>)
          (org-table-next-field)
          (org-table-blank-field)
          (insert (format <span style="font-style: italic;">"*%.2f*"</span> (/ total 60.0))))))
    (org-table-align)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">org-dblock-write:clocktable-by-tag</span> (params)
  (funcall indent-line-function)
  (insert <span style="font-style: italic;">"| Tag | Headline | Time (h) |\n"</span>)
  (insert <span style="font-style: italic;">"|     |          | &lt;r&gt;  |\n"</span>)
  (<span style="font-weight: bold;">let</span> ((matches
         (org-global-tags-completion-table)))
    (mapcar (<span style="font-weight: bold;">lambda</span> (match)
              (<span style="font-weight: bold;">let</span> ((match-str (car match))
                    (case-fold-search nil))
                (<span style="font-weight: bold;">when</span> (string-match-p <span style="font-style: italic;">"^AC_"</span> match-str)
                  (<span style="font-weight: bold;">setq</span> params (plist-put params <span style="font-weight: bold;">:match</span> match-str))
                  (clocktable-by-tag/insert-tag params))))
            matches)))

(<span style="font-weight: bold;">provide</span> '<span style="font-weight: bold; text-decoration: underline;">clocktable-by-tag</span>)
</pre>
</div>
</div>
</li>

<li><a id="orgaa9fd03"></a>narrow-dwim<br />
<div class="outline-text-6" id="text-orgaa9fd03">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(bind-key* <span style="font-style: italic;">"C-x n"</span> 'my/toggle-narrow-dwim)

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/toggle-narrow-dwim</span> (arg)
  <span style="font-style: italic;">"If the buffer is narrowed, it widens. Otherwise, it narrows intelligently.</span>
<span style="font-style: italic;">Intelligently means: region, org-src-block, org-subtree, or defun,</span>
<span style="font-style: italic;">whichever applies first.</span>
<span style="font-style: italic;">Narrowing to org-src-block actually calls `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">org-edit-src-code</span><span style="font-style: italic;">'.</span>

<span style="font-style: italic;">With prefix ARG, don't widen, just narrow even if buffer is already narrowed."</span>
  (<span style="font-weight: bold;">interactive</span> <span style="font-style: italic;">"P"</span>)
  (<span style="font-weight: bold;">declare</span> (interactive-only))
  (<span style="font-weight: bold;">cond</span> ((<span style="font-weight: bold;">and</span> (buffer-narrowed-p) (not arg))
         (<span style="font-weight: bold;">when</span> (org-buffer-narrowed-p)
           (<span style="font-weight: bold;">when</span> org-startup-indented
             (org-indent-mode 1))
           (visual-line-mode -1)
           (adaptive-wrap-prefix-mode -1))
         (widen)
         (<span style="font-weight: bold;">setq-local</span> truncate-lines t))
        ((region-active-p)
         (narrow-to-region (region-beginning) (region-end)))
        ((<span style="font-weight: bold;">and</span> (boundp 'org-src-mode) org-src-mode (not arg))
         (org-edit-src-exit))
        ((<span style="font-weight: bold;">condition-case</span> err
             (org-edit-src-code)
           (<span style="font-weight: bold;">user-error</span> nil)))
        ((derived-mode-p 'org-mode)
         (<span style="font-weight: bold;">cond</span> ((org-at-block-p)
                (org-narrow-to-block))
               ((org-at-heading-p)
                (org-narrow-to-subtree)
                (adaptive-wrap-prefix-mode))
               (t (org-narrow-to-element)))
         (org-indent-mode -1)
         (visual-line-mode 1))
        ((eq major-mode 'dired-mode)
         (dired-subtree-narrow))
        (t (narrow-to-defun))))

<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(add-hook 'post-command-hook 'highlight-narrowed-buffer)</span>
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(defun highlight-narrowed-buffer ()</span>
<span style="font-weight: bold; font-style: italic;">;;   </span><span style="font-weight: bold; font-style: italic;">"Highlight narrowed buffer.</span>

<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Narrowed buffer have a fringe with highlighting color.</span>
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Plus text size in the buffer becomes a little bit larger."</span>
<span style="font-weight: bold; font-style: italic;">;;   </span><span style="font-weight: bold; font-style: italic;">(unless (or (member last-command</span>
<span style="font-weight: bold; font-style: italic;">;;                       </span><span style="font-weight: bold; font-style: italic;">'(text-scale-adjust))</span>
<span style="font-weight: bold; font-style: italic;">;;               </span><span style="font-weight: bold; font-style: italic;">(eq major-mode 'Info-mode)</span>
<span style="font-weight: bold; font-style: italic;">;;               </span><span style="font-weight: bold; font-style: italic;">(string-match-p (rx (seq line-start "CAPTURE-" (one-or-more ascii) line-end))</span>
<span style="font-weight: bold; font-style: italic;">;;                               </span><span style="font-weight: bold; font-style: italic;">(buffer-name)))</span>
<span style="font-weight: bold; font-style: italic;">;;     </span><span style="font-weight: bold; font-style: italic;">(let ((hl-fringe-color "purple2")</span>
<span style="font-weight: bold; font-style: italic;">;;           </span><span style="font-weight: bold; font-style: italic;">(hl-text-scale (sqrt 2)))</span>
<span style="font-weight: bold; font-style: italic;">;;       </span><span style="font-weight: bold; font-style: italic;">(set-face-attribute</span>
<span style="font-weight: bold; font-style: italic;">;;        </span><span style="font-weight: bold; font-style: italic;">'fringe nil :background (if (buffer-narrowed-p)</span>
<span style="font-weight: bold; font-style: italic;">;;                                    </span><span style="font-weight: bold; font-style: italic;">(progn</span>
<span style="font-weight: bold; font-style: italic;">;;                                      </span><span style="font-weight: bold; font-style: italic;">(text-scale-set hl-text-scale)</span>
<span style="font-weight: bold; font-style: italic;">;;                                      </span><span style="font-weight: bold; font-style: italic;">hl-fringe-color)</span>
<span style="font-weight: bold; font-style: italic;">;;                                  </span><span style="font-weight: bold; font-style: italic;">(progn</span>
<span style="font-weight: bold; font-style: italic;">;;                                    </span><span style="font-weight: bold; font-style: italic;">(when (= text-scale-mode-amount hl-text-scale)</span>
<span style="font-weight: bold; font-style: italic;">;;                                      </span><span style="font-weight: bold; font-style: italic;">(text-scale-set 0))</span>
<span style="font-weight: bold; font-style: italic;">;;                                    </span><span style="font-weight: bold; font-style: italic;">nil))))))</span>
</pre>
</div>
</div>
</li>
<li><a id="org083bcfe"></a>weather<br />
<div class="outline-text-6" id="text-org083bcfe">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#27671;&#35937;&#24193;&#37197;&#20449;&#12398;&#22825;&#27671;&#24773;&#22577;&#12434;&#21152;&#24037;&#12375;&#12390;&#34920;&#31034;</span>

(<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">request</span>)
(<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">cl-lib</span>)

(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">weather-areas</span>
  '(((url . <span style="font-style: italic;">"http://www.drk7.jp/weather/xml/14.xml"</span>)
     (pref . <span style="font-style: italic;">"&#31070;&#22856;&#24029;&#30476;"</span>)
     (area . <span style="font-style: italic;">"&#35199;&#37096;"</span>))
    ((url . <span style="font-style: italic;">"http://www.drk7.jp/weather/xml/22.xml"</span>)
     (pref . <span style="font-style: italic;">"&#38745;&#23713;&#30476;"</span>)
     (area . <span style="font-style: italic;">"&#20013;&#37096;"</span>))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">weather-area-show</span> (weather-area-alist weather-buffer)
  (lexical-let ((url (assoc-default 'url weather-area-alist))
                (pref (assoc-default 'pref weather-area-alist))
                (area (assoc-default 'area weather-area-alist))
                (buffer weather-buffer))
    (request
      url
      <span style="font-weight: bold;">:parser</span>
      (<span style="font-weight: bold;">lambda</span> ()
        (<span style="font-weight: bold;">let</span> ((xml-string (string-as-multibyte (string-as-unibyte (buffer-string)))))
          (<span style="font-weight: bold;">with-temp-buffer</span>
            (erase-buffer)
            (insert xml-string)
            (libxml-parse-xml-region (point-min) (point-max)))))
      <span style="font-weight: bold;">:success</span>
      (<span style="font-weight: bold;">cl-function</span>
       (<span style="font-weight: bold;">lambda</span> (<span style="font-weight: bold; text-decoration: underline;">&amp;key</span> data <span style="font-weight: bold; text-decoration: underline;">&amp;allow-other-keys</span>)
         (<span style="font-weight: bold;">when</span> data
           (<span style="font-weight: bold;">with-current-buffer</span> buffer
             (insert (format <span style="font-style: italic;">"%s %s\n"</span> pref area))
             (mapcar
              (<span style="font-weight: bold;">lambda</span> (info-node)
                (insert
                 (format <span style="font-style: italic;">"%s %s %s %s\n"</span>
                         (<span style="font-weight: bold;">dom-attr</span> info-node 'date)
                         (apply (<span style="font-weight: bold;">lambda</span> (max-temp-node min-temp-node)
                                  (format <span style="font-style: italic;">"%2d/%2d&#8451;"</span>
                                          (string-to-number (dom-text min-temp-node))
                                          (string-to-number (dom-text max-temp-node))))
                                (dom-by-tag (dom-child-by-tag info-node 'temperature) 'range))
                         (apply (<span style="font-weight: bold;">lambda</span> (node-1 node-2 node-3 node-4)
                                  (format <span style="font-style: italic;">"%2d-%2d-%2d-%2d&#65285;"</span>
                                          (string-to-number (dom-text node-1))
                                          (string-to-number (dom-text node-2))
                                          (string-to-number (dom-text node-3))
                                          (string-to-number (dom-text node-4))))
                                (dom-by-tag (dom-child-by-tag info-node 'rainfallchance) 'period))
                         (dom-text (dom-child-by-tag info-node 'weather)))))
              (dom-by-tag (dom-by-id data area) 'info))
             (insert <span style="font-style: italic;">"\n"</span>))))))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">weather</span> ()
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">let</span> ((buffer (get-buffer-create <span style="font-style: italic;">"weather"</span>)))
    (mapcar (<span style="font-weight: bold;">lambda</span> (weather-area)
              (weather-area-show weather-area buffer))
            weather-areas)
    (switch-to-buffer buffer)))

(<span style="font-weight: bold;">provide</span> '<span style="font-weight: bold; text-decoration: underline;">weather</span>)
</pre>
</div>
</div>
</li>
<li><a id="orgff9543a"></a>view-file (deprecated)&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span><br /></li>

<li><a id="orgda52b2b"></a>open-file<br />
<div class="outline-text-6" id="text-orgda52b2b">
<p>
This set of code (open-file) offers file opener functionality in my liking. With open-file, PDF and EPUB, which is either local or on the web, is viewed in EWW (text browser in Emacs) after the process of converted into html. Video and audio is played in MPV media player. Open-file is available in elisp commands for opening files (e.g. org-open-at-point for org links, browse-url and dired-open-file). With any command above, invoking with single prefix (C-u) inflict to open file in Emacs, and invoking with double prefix (C-u C-u) inflict to open files in default application.
</p>

<div class="org-src-container">
<pre class="src src-conf">d &lt;&lt;share-dir()&gt;&gt;/emacs/open-file 0755 - - 14d
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">general functions</span>

(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my/open-file-dir</span>
  (expand-file-name <span style="font-style: italic;">"open-file"</span>
                    user-emacs-directory)
  <span style="font-style: italic;">"Directory where html file is converted into."</span>)

(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my/open-file-media-player</span> <span style="font-style: italic;">"mpv"</span>
  <span style="font-style: italic;">"Media player used to play media file in open-file."</span>)

(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my/open-file-media-extensions</span>
  '(<span style="font-style: italic;">"mpg"</span> <span style="font-style: italic;">"mpeg"</span> <span style="font-style: italic;">"mp3"</span> <span style="font-style: italic;">"mp4"</span> <span style="font-style: italic;">"m4v"</span> <span style="font-style: italic;">"m4a"</span>
    <span style="font-style: italic;">"avi"</span> <span style="font-style: italic;">"wmv"</span> <span style="font-style: italic;">"wav"</span> <span style="font-style: italic;">"mov"</span> <span style="font-style: italic;">"flv"</span> <span style="font-style: italic;">"mkv"</span> <span style="font-style: italic;">"webm"</span>
    <span style="font-style: italic;">"ogv"</span> <span style="font-style: italic;">"oga"</span> <span style="font-style: italic;">"ogx"</span> <span style="font-style: italic;">"ogg"</span> <span style="font-style: italic;">"spx"</span>
    <span style="font-style: italic;">"xbm"</span> <span style="font-style: italic;">"pbm"</span> <span style="font-style: italic;">"pgm"</span> <span style="font-style: italic;">"ppm"</span> <span style="font-style: italic;">"pnm"</span> <span style="font-style: italic;">"png"</span> <span style="font-style: italic;">"gif"</span> <span style="font-style: italic;">"bmp"</span> <span style="font-style: italic;">"tif"</span> <span style="font-style: italic;">"jpeg"</span> <span style="font-style: italic;">"jpg"</span>)
  <span style="font-style: italic;">"Extensions files which can play with media player must have."</span>)

(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my/open-file-compressed-media-extensions</span>
  '(<span style="font-style: italic;">"tar.gz"</span> <span style="font-style: italic;">"tgz"</span> <span style="font-style: italic;">"tar.xz"</span> <span style="font-style: italic;">"txz"</span> <span style="font-style: italic;">"zip"</span> <span style="font-style: italic;">"7z"</span>)
  <span style="font-style: italic;">"Extensions compressed files which can play with media player must have."</span>)

(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my/open-file-yt-regexp</span>
  (<span style="font-weight: bold;">rx</span> (? (<span style="font-weight: bold;">or</span> <span style="font-style: italic;">"https://"</span> <span style="font-style: italic;">"http://"</span> <span style="font-style: italic;">"//"</span>))
      (? <span style="font-style: italic;">"www"</span>)
      (<span style="font-weight: bold;">or</span> <span style="font-style: italic;">"youtube.com"</span> <span style="font-style: italic;">"youtu.be"</span>))
  <span style="font-style: italic;">"Regexp for youtube url."</span>)

(<span style="font-weight: bold;">defmacro</span> <span style="font-weight: bold;">my/open-file-as-html</span> (file convert-cmd)
  `(<span style="font-weight: bold;">let*</span> ((cap-command (<span style="font-weight: bold;">if</span> (string-match-p url-handler-regexp ,file)
                           <span style="font-style: italic;">"curl"</span>
                         (<span style="font-weight: bold;">if</span> (string-suffix-p <span style="font-style: italic;">".gpg"</span> ,file)
                             <span style="font-style: italic;">"gpg -d"</span>
                           <span style="font-style: italic;">"cat"</span>)))
          (dir-name
           (seq-reduce (<span style="font-weight: bold;">lambda</span> (str rep)
                         (string-replace (car rep) (cdr rep) str))
                       '((<span style="font-style: italic;">"/"</span> . <span style="font-style: italic;">"!"</span>)
                         (<span style="font-style: italic;">"~"</span> . <span style="font-style: italic;">"`"</span>)
                         (<span style="font-style: italic;">" "</span> . <span style="font-style: italic;">"_"</span>))
                       ,file))
          (dirname-html
           (expand-file-name
            (file-name-sans-extension dir-name)
            my/open-file-dir))
          (filename-html
           (concat (file-name-as-directory dirname-html)
                   <span style="font-style: italic;">"index.html"</span>))
          (command ,convert-cmd))
     (<span style="font-weight: bold;">unless</span> (file-exists-p filename-html)
       (make-directory dirname-html t)
       (call-process-shell-command command))
     (browse-url filename-html)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/open-pdf-as-html</span> (pdf)
  <span style="font-style: italic;">"Open PDF in `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">eww</span><span style="font-style: italic;">' after the process of convertion into html."</span>
  (my/open-file-as-html
   pdf
   (format <span style="font-style: italic;">"%1$s %2$s 2&gt;/dev/null | pdftohtml -p -s -noframes -nomerge -nodrm - %3$s"</span>
           cap-command
           (shell-quote-argument pdf)
           (shell-quote-argument filename-html))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/open-epub-as-html</span> (epub)
  <span style="font-style: italic;">"Open EPUB in `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">eww</span><span style="font-style: italic;">' after the process of convertion into html."</span>
  (my/open-file-as-html
   epub
   (format <span style="font-style: italic;">"%1$s %2$s 2&gt;/dev/null | pandoc --from=epub --to=html --extract-media=%3$s - | strip_ruby &gt; %4$s"</span>
           cap-command
           (shell-quote-argument epub)
           (shell-quote-argument dirname-html)
           (shell-quote-argument filename-html))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/open-media</span> (media <span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> start-time)
  <span style="font-style: italic;">"Open MEDIA in `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">my/open-file-media-player</span><span style="font-style: italic;">' at the point of START-TIME."</span>
  (<span style="font-weight: bold;">let</span> ((ask-file (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">or</span> (file-directory-p media)
                            (string-match-p (eval `(<span style="font-weight: bold;">rx</span> (<span style="font-weight: bold;">or</span> ,@my/open-file-compressed-media-extensions)))
                                            media))
                    (file-name-nondirectory media))))
    (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">or</span> (not ask-file)
              (<span style="font-weight: bold;">and</span> ask-file
                   (y-or-n-p (format <span style="font-style: italic;">"Play %s?: "</span> ask-file))))
      (start-process-shell-command
       my/open-file-media-player nil
       (<span style="font-weight: bold;">let</span> ((cap-cmd (<span style="font-weight: bold;">and</span> (string-suffix-p <span style="font-style: italic;">".gpg"</span> media)
                           (format <span style="font-style: italic;">"gpg -d %s | "</span> media))))
         (mapconcat #'identity
                    (list (<span style="font-weight: bold;">or</span> cap-cmd <span style="font-style: italic;">""</span>)
                          <span style="font-style: italic;">"nohup"</span> my/open-file-media-player
                          <span style="font-style: italic;">"--force-window"</span>
                          (<span style="font-weight: bold;">or</span> (<span style="font-weight: bold;">and</span> start-time
                                   (format <span style="font-style: italic;">"--start=%s"</span> start-time))
                              <span style="font-style: italic;">""</span>)
                          (<span style="font-weight: bold;">if</span> cap-cmd
                              <span style="font-style: italic;">"-"</span>
                            (shell-quote-argument media))
                          <span style="font-style: italic;">"2&gt;&amp;1"</span> <span style="font-style: italic;">"&gt;/dev/null"</span>)
                    <span style="font-style: italic;">" "</span>))))))

<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">==============================================</span>
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">browse-url handling</span>

(<span style="font-weight: bold;">with-eval-after-load</span> 'browse-url
  (<span style="font-weight: bold;">let</span> ((search-suffix <span style="font-style: italic;">"</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(?:</span><span style="font-style: italic;">::.*</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">?"</span>))
    (customize-set-variable
     'browse-url-handlers
     `(((<span style="font-weight: bold;">lambda</span> (url)
          (equal current-prefix-arg '(16)))
        . my/browse-url-external)
       ((<span style="font-weight: bold;">lambda</span> (url)
          (equal current-prefix-arg '(4)))
        . my/browse-url-emacs)
       (,(format <span style="font-style: italic;">"\\.html%s\\'"</span> search-suffix)
        . my/browse-url-html)
       (,(format <span style="font-style: italic;">"\\.pdf</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">\\.gpg</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">?%s\\'"</span> search-suffix)
        . my/browse-url-pdf)
       (,(format <span style="font-style: italic;">"\\.epub%s\\'"</span> search-suffix)
        . my/browse-url-epub)
       (,(eval `(concat (<span style="font-weight: bold;">rx</span> <span style="font-style: italic;">"."</span> (<span style="font-weight: bold;">or</span> ,@my/open-file-media-extensions
                                    ,@my/open-file-compressed-media-extensions)
                            (opt <span style="font-style: italic;">".gpg"</span>))
                        search-suffix))
        . my/browse-url-media)
       (,(concat my/open-file-yt-regexp search-suffix)
        . my/browse-url-media)))
    (customize-set-variable
     'browse-url-browser-function 'eww-browse-url)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/browse-url-html</span> (url <span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> same-window)
  <span style="font-style: italic;">"A handler for `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">browse-url</span><span style="font-style: italic;">' responsible for html at URL."</span>
  (<span style="font-weight: bold;">cond</span>
   ((file-exists-p url)
    (eww-open-file url))
   ((string-match-p url-handler-regexp url)
    (browse-web url))
   (t
    (eww url))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/browse-url-pdf</span> (url <span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> same-window)
  <span style="font-style: italic;">"A handler for `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">browse-url</span><span style="font-style: italic;">' responsible for a pdf file at URL."</span>
  (<span style="font-weight: bold;">let*</span> ((query-list (my/browse-url-break-down url))
         (search-str (cadr query-list)))
    (my/open-pdf-as-html (car query-list))
    (<span style="font-weight: bold;">and</span> (stringp search-str)
         (org-link-search search-str))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/browse-url-epub</span> (url <span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> same-window)
  <span style="font-style: italic;">"A handler for `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">browse-url</span><span style="font-style: italic;">' responsible for an epub file at URL."</span>
  (<span style="font-weight: bold;">let*</span> ((query-list (my/browse-url-break-down url))
         (search-str (cadr query-list)))
    (my/open-epub-as-html (car query-list))
    (<span style="font-weight: bold;">and</span> (stringp search-str)
         (org-link-search search-str))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/browse-url-media</span> (url <span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> same-window)
  <span style="font-style: italic;">"A handler for `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">browse-url</span><span style="font-style: italic;">' responsible for a media file at URL."</span>
  (<span style="font-weight: bold;">let*</span> ((query-list (my/browse-url-break-down url))
         (search-str (cadr query-list)))
    (my/open-media (car query-list) search-str)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/browse-url-emacs</span> (url <span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> same-window)
  <span style="font-style: italic;">"A handler for `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">browse-url</span><span style="font-style: italic;">' invoked with `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">C-u</span><span style="font-style: italic;">' responsible for a file at URL."</span>
  (browse-url-emacs (car (my/browse-url-break-down url))
                    same-window))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/browse-url-external</span> (url <span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> same-window)
  <span style="font-style: italic;">"A handler for `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">browse-url</span><span style="font-style: italic;">' invoked with `C-u C-u' responsible for a file at URL."</span>
  (browse-url-xdg-open (car (my/browse-url-break-down url))
                       same-window))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/browse-url-break-down</span> (query)
  (<span style="font-weight: bold;">let*</span> ((search-opt-regexp <span style="font-style: italic;">"::</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">.*</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">\\'"</span>)
         (matcher nil)
         (url-or-file
          (<span style="font-weight: bold;">cond</span> ((string-match-p url-handler-regexp query)
                 (<span style="font-weight: bold;">setq</span> matcher (format <span style="font-style: italic;">"</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">%s.*</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">%s"</span>
                                       url-handler-regexp
                                       search-opt-regexp))
                 query)
                (t
                 (<span style="font-weight: bold;">setq</span> matcher (format <span style="font-style: italic;">"</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">.*</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">%s"</span>
                                       search-opt-regexp))
                 (expand-file-name
                  (<span style="font-weight: bold;">and</span> (not (string-match-p <span style="font-style: italic;">"^file://"</span> query))
                       (replace-regexp-in-string <span style="font-style: italic;">"^</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(?:</span><span style="font-style: italic;">/</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">?file:"</span> <span style="font-style: italic;">""</span> query)))))))
    (<span style="font-weight: bold;">if</span> (string-match matcher url-or-file)
        `(,(match-string 1 url-or-file) ,(match-string 2 url-or-file))
      `(,url-or-file nil))))

<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">==============================================</span>
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">org-open handling</span>

(<span style="font-weight: bold;">with-eval-after-load</span> 'org
  (customize-set-variable
   `org-file-apps
   `((<span style="font-style: italic;">"\\.html\\'"</span> . my/org-open-html)
     (<span style="font-style: italic;">"\\.pdf</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">\\.gpg</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">?\\'"</span> . my/org-open-pdf)
     (<span style="font-style: italic;">"\\.epub\\'"</span> . my/org-open-epub)
     (,(eval `(<span style="font-weight: bold;">rx</span> <span style="font-style: italic;">"."</span> (<span style="font-weight: bold;">or</span> ,@my/open-file-media-extensions
                          ,@my/open-file-compressed-media-extensions)
                  (opt <span style="font-style: italic;">".gpg"</span>) string-end))
      . my/org-open-media)
     (auto-mode . emacs)
     (directory . my/org-open-media)
     (system . browse-url-default-browser))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/org-open-html</span> (file-path link-string)
  <span style="font-style: italic;">"Open a html file at FILE-PATH via org-open command."</span>
  (browse-url file-path)
  (when-let ((search (my/org-link-search link-string)))
    (org-link-search search)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/org-open-pdf</span> (file-path link-string)
  <span style="font-style: italic;">"Open a pdf file at FILE-PATH via org-open command."</span>
  (my/open-pdf-as-html file-path)
  (when-let ((search (my/org-link-search link-string)))
    (org-link-search search)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/org-open-epub</span> (file-path link-string)
  <span style="font-style: italic;">"Open an epub file at FILE-PATH via org-open command."</span>
  (my/open-epub-as-html file-path)
  (when-let ((search (my/org-link-search link-string)))
    (org-link-search search)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/org-open-media</span> (file-path link-string)
  <span style="font-style: italic;">"Open a media file at FILE-PATH via org-open command."</span>
  (my/open-media file-path
                 (my/org-link-search link-string)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/org-link-search</span> (link-string)
  (<span style="font-weight: bold;">and</span> (stringp link-string)
       (string-match <span style="font-style: italic;">"::</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">.*</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">\\'"</span> link-string)
       (match-string 1 link-string)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/org-execute-file-search-line-number</span> (s)
  <span style="font-style: italic;">"A search function responsible for line number inside of S."</span>
  (<span style="font-weight: bold;">and</span> (string-match <span style="font-style: italic;">"^l=</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">[-+[:digit:]]+</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">\\'"</span> s)
       (goto-line (string-to-number (match-string 1 s)))))

(add-hook 'org-execute-file-search-functions
          'my/org-execute-file-search-line-number)

<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">==============================================</span>
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">dired-open handling</span>

(<span style="font-weight: bold;">with-eval-after-load</span> 'dired-open
  (customize-set-variable
   'dired-open-functions
   '(dired-open-call-function-by-extension
     dired-open-guess-shell-alist
     dired-open-by-extension
     dired-open-subdir))
  (customize-set-variable
   'dired-open-extensions-elisp
   `((<span style="font-style: italic;">"pdf"</span> . my/open-pdf-as-html)
     (<span style="font-style: italic;">"pdf.gpg"</span> . my/open-pdf-as-html)
     (<span style="font-style: italic;">"epub"</span> . my/open-epub-as-html)
     (<span style="font-style: italic;">"jpg.gpg"</span> . my/open-media)
     ,@(mapcar (<span style="font-weight: bold;">lambda</span> (ext)
                 (cons ext 'my/open-media))
               my/open-file-media-extensions)))
  (customize-set-variable
   'dired-open-find-file-function 'my/dired-find-file))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/dired-find-file</span> ()
  <span style="font-style: italic;">"A function for `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">dired-open-find-file-function</span><span style="font-style: italic;">' dealing with</span>
<span style="font-style: italic;">a `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">dired-open-file</span><span style="font-style: italic;">' call with `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">C-u</span><span style="font-style: italic;">' or `C-u C-u'."</span>
  (<span style="font-weight: bold;">let</span> ((file-for-visit (dired-get-file-for-visit)))
    (<span style="font-weight: bold;">cond</span>
     ((equal current-prefix-arg '(16))
      (browse-url-default-browser file-for-visit))
     ((equal current-prefix-arg '(4))
      (dired--find-possibly-alternative-file file-for-visit))
     ((<span style="font-weight: bold;">or</span> (file-directory-p file-for-visit)
          (string-match-p (eval `(<span style="font-weight: bold;">rx</span> (<span style="font-weight: bold;">or</span> ,@my/open-file-compressed-media-extensions)))
                          file-for-visit))
      (my/open-media file-for-visit)))))
</pre>
</div>
</div>
</li>

<li><a id="org6f6044c"></a>lfile (org-link type for files on the machine)<br />
<div class="outline-text-6" id="text-org6f6044c">
<p>
lfile is a custom org link type inspired by <a href="https://karl-voit.at/2022/02/10/lfile/">Kerl Voit's implementation</a>.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defcustom</span> <span style="font-weight: bold; font-style: italic;">my/lfile-root</span> <span style="font-style: italic;">"~/"</span> <span style="font-style: italic;">"docstring"</span>)

(<span style="font-weight: bold;">defmacro</span> <span style="font-weight: bold;">my/expand-lfile</span> (file body exclude-search)
  <span style="font-style: italic;">"Evaluate BODY with resolving a path from FILE.</span>

<span style="font-style: italic;">In BODY, caller could refer a resolved file path as `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">file-resolved</span><span style="font-style: italic;">'.</span>
<span style="font-style: italic;">If exclude-search is non-nil, search specifier after \"::\" will be removed in `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">file-resolved</span><span style="font-style: italic;">'."</span>
  `(<span style="font-weight: bold;">let*</span> ((paths (my/lfile--locate ,file ,exclude-search))
          (file-resolved (car paths)))
     (<span style="font-weight: bold;">cond</span>
      ((= 0 (length paths))
       (message <span style="font-style: italic;">"Sorry, no results found for query: %s"</span> file))
      ((&lt;= 1 (length paths))
       ,body
       ))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/lfile-follow-link</span> (file _)
  <span style="font-style: italic;">"Open FILE given in lfile org link type."</span>
  (my/expand-lfile file
                   (org-link-open-as-file file-resolved current-prefix-arg)
                   nil))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/lfile-follow-link--emacs</span> (file _)
  <span style="font-style: italic;">"Open FILE in Emacs given in lfile+emacs org link type."</span>
  (my/expand-lfile file
                   (org-open-file file-resolved t)
                   t))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/lfile-follow-link--sys</span> (file _)
  <span style="font-style: italic;">"Open FILE out of Emacs given in lfile+sys org link type."</span>
  (my/expand-lfile file
                   (org-open-file file-resolved 'system)
                   t))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/lfile-store-link</span> ()
  <span style="font-style: italic;">"Store a link to the file.</span>

<span style="font-style: italic;">Prefix argument does matter in this function call.</span>
<span style="font-style: italic;">If `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">C-u</span><span style="font-style: italic;">' prefix is given, file link is stored instead of lfile link."</span>
  (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">and</span> (derived-mode-p 'dired-mode)
             (string-match-p
              (format <span style="font-style: italic;">"^%s"</span> (expand-file-name my/lfile-root))
              (dired-current-directory nil)))
    (<span style="font-weight: bold;">let</span> ((path (dired-get-filename nil t)))
      (<span style="font-weight: bold;">if</span> (equal current-prefix-arg '(4))
          (org-link-store-props
           <span style="font-weight: bold;">:type</span> <span style="font-style: italic;">"file"</span>
           <span style="font-weight: bold;">:link</span> (concat <span style="font-style: italic;">"file:"</span> (abbreviate-file-name
                                  (expand-file-name path))))
        (org-link-store-props
         <span style="font-weight: bold;">:type</span> <span style="font-style: italic;">"lfile"</span>
         <span style="font-weight: bold;">:link</span> (concat <span style="font-style: italic;">"lfile:"</span> (file-name-nondirectory path)))))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/lfile-completing-read</span> (<span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> arg)
  <span style="font-style: italic;">"Create a lfile link using completion."</span>
  (<span style="font-weight: bold;">let*</span> ((paths (my/lfile--locate nil))
         (files (mapcar #'file-name-nondirectory paths))
         (file (completing-read <span style="font-style: italic;">"Local file: "</span> files nil 'confirm)))
    (concat <span style="font-style: italic;">"lfile:"</span> file)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/lfile-export</span> (link description format)
  <span style="font-style: italic;">"Return an exported string from lfile link for format FORMAT.</span>
<span style="font-style: italic;">A link consists of LINK and DESCRIPTION."</span>
  (when-let* ((paths (my/lfile--locate link))
              (path (org-export-file-uri (expand-file-name (car paths))))
              (desc (<span style="font-weight: bold;">or</span> description link)))
    (<span style="font-weight: bold;">when</span> (stringp path)
      (<span style="font-weight: bold;">cond</span>
       ((eq format 'html) (format <span style="font-style: italic;">"&lt;a href=\"%s\"&gt;%s&lt;/a&gt;"</span> path desc))
       ((eq format 'latex) (format <span style="font-style: italic;">"\\href{%s}{%s}"</span> path desc))
       ((eq format 'ascii) (format <span style="font-style: italic;">"%s (%s)"</span> desc path))
       (t path)))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/lfile-from-file-link</span> ()
  <span style="font-style: italic;">"Replace file link type with lfile link type only if hte path in my/lfile-root."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">let*</span> ((context (org-element-lineage
                   (org-element-context)
                   '(link desc)
                   t))
         (type (org-element-property <span style="font-weight: bold;">:type</span> context))
         (path (org-element-property <span style="font-weight: bold;">:path</span> context))
         (app (org-element-property <span style="font-weight: bold;">:application</span> context))
         (search-option (org-element-property <span style="font-weight: bold;">:search-option</span> context))
         (desc-begin (org-element-property <span style="font-weight: bold;">:contents-begin</span> context))
         (desc-end (org-element-property <span style="font-weight: bold;">:contents-end</span> context))
         (desc (<span style="font-weight: bold;">and</span> (<span style="font-weight: bold;">and</span> (integerp desc-begin) (integerp desc-begin))
                    (substring-no-properties (buffer-substring desc-begin desc-end)))))
    (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">and</span> (string= type <span style="font-style: italic;">"file"</span>)
               (string-match-p
                (format <span style="font-style: italic;">"^%s"</span> (expand-file-name my/lfile-root))
                (expand-file-name path)))
      (delete-region (org-element-property <span style="font-weight: bold;">:begin</span> context)
                     (org-element-property <span style="font-weight: bold;">:end</span> context))
      (insert (org-link-make-string (concat <span style="font-style: italic;">"lfile"</span> (<span style="font-weight: bold;">and</span> app (concat <span style="font-style: italic;">"+"</span> app)) <span style="font-style: italic;">":"</span>
                                            (file-name-nondirectory path)
                                            (<span style="font-weight: bold;">and</span> search-option (concat <span style="font-style: italic;">"::"</span> search-option)))
                                    desc)))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/lfile--locate</span> (pattern <span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> exclude-search)
  <span style="font-style: italic;">"Determine an absolute path from given FILE name using `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">locate</span><span style="font-style: italic;">' program."</span>
  (<span style="font-weight: bold;">if</span> pattern
      (<span style="font-weight: bold;">save-match-data</span>
        (<span style="font-weight: bold;">let</span> ((match-idx (string-match <span style="font-style: italic;">"</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">.+</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">::.+</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">\\'"</span>
                                       pattern))
              (data (match-data)))
          (mapcar (<span style="font-weight: bold;">lambda</span> (resolved-path)
                    (set-match-data data)
                    (concat resolved-path
                            (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">and</span> match-idx
                                       (not exclude-search))
                              (match-string 2 pattern))
                            ))
                  (split-string
                   (shell-command-to-string
                    (format <span style="font-style: italic;">"plocate -d &lt;&lt;plocate-db()&gt;&gt; -ie \"%s\""</span>
                            (<span style="font-weight: bold;">or</span> (<span style="font-weight: bold;">and</span> match-idx
                                     (match-string 1 pattern))
                                pattern)
                            ))
                   <span style="font-style: italic;">"\n"</span> t))))
    <span style="font-style: italic;">""</span>))

(<span style="font-weight: bold;">with-eval-after-load</span> 'org
  (org-link-set-parameters <span style="font-style: italic;">"lfile"</span>
                           <span style="font-weight: bold;">:follow</span> #'my/lfile-follow-link
                           <span style="font-weight: bold;">:store</span> #'my/lfile-store-link
                           <span style="font-weight: bold;">:complete</span> #'my/lfile-completing-read
                           <span style="font-weight: bold;">:export</span> #'my/lfile-export)
  (org-link-set-parameters <span style="font-style: italic;">"lfile+emacs"</span>
                           <span style="font-weight: bold;">:follow</span> #'my/lfile-follow-link--emacs)
  (org-link-set-parameters <span style="font-style: italic;">"lfile+sys"</span>
                           <span style="font-weight: bold;">:follow</span> #'my/lfile-follow-link--sys))
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="org1448491"></a>org workflows<br />
<div class="outline-text-5" id="text-org1448491">
</div>

<ul class="org-ul">
<li><a id="orgbc48876"></a>notification count down timer finished<br />
<div class="outline-text-6" id="text-orgbc48876">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">org-timer</span>)

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/notify-timer-completed</span> ()
  <span style="font-style: italic;">"docstring"</span>
  (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">and</span> (org-clocking-p)
             org-clock-marker)
    (<span style="font-weight: bold;">let</span> ((alert (org-entry-get org-clock-marker
                                <span style="font-style: italic;">"ALERT"</span>)))
      (<span style="font-weight: bold;">if</span> (<span style="font-weight: bold;">and</span> (stringp alert)
               (string= alert <span style="font-style: italic;">"alarm"</span>))
          (alert <span style="font-style: italic;">"Timer Done!"</span> <span style="font-weight: bold;">:style</span> 'alarm)
        (alert <span style="font-style: italic;">"Timer Done!"</span> <span style="font-weight: bold;">:style</span> 'fringe <span style="font-weight: bold;">:mode</span> 'org-mode <span style="font-weight: bold;">:buffer</span> (org-clocking-buffer) <span style="font-weight: bold;">:severity</span> 'trivial)))))

(add-hook 'org-timer-done-hook
          'my/notify-timer-completed)

(<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">alert</span>)

(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">alarm-sound</span> (expand-file-name <span style="font-style: italic;">"~/data/media/music/levelup.mp3"</span>))
(alert-define-style 'alarm
                    <span style="font-weight: bold;">:title</span> <span style="font-style: italic;">"alarm"</span>
                    <span style="font-weight: bold;">:notifier</span>
                    (<span style="font-weight: bold;">lambda</span> (info)
                      (<span style="font-weight: bold;">let</span> ((message (plist-get info <span style="font-weight: bold;">:message</span>))
                            (severity (plist-get info <span style="font-weight: bold;">:severity</span>))
                            (title (plist-get info <span style="font-weight: bold;">:title</span>))
                            (icon (plist-get info <span style="font-weight: bold;">:icon</span>))
                            (category (plist-get info <span style="font-weight: bold;">:category</span>))
                            (buffer (plist-get info <span style="font-weight: bold;">:buffer</span>))
                            (mode (plist-get info <span style="font-weight: bold;">:mode</span>))
                            (data (plist-get info <span style="font-weight: bold;">:data</span>))
                            (style (plist-get info <span style="font-weight: bold;">:style</span>))
                            (persistent (plist-get info <span style="font-weight: bold;">:persistent</span>))
                            (id (plist-get info <span style="font-weight: bold;">:id</span>))
                            (system-volume (string-trim (shell-command-to-string <span style="font-style: italic;">"volget"</span>))))
                        (<span style="font-weight: bold;">if</span> (string= system-volume <span style="font-style: italic;">"0"</span>)
                            (alert message <span style="font-weight: bold;">:severity</span> severity <span style="font-weight: bold;">:title</span> title <span style="font-weight: bold;">:icon</span> icon <span style="font-weight: bold;">:category</span> category <span style="font-weight: bold;">:buffer</span> buffer <span style="font-weight: bold;">:mode</span> mode <span style="font-weight: bold;">:data</span> data <span style="font-weight: bold;">:style</span> 'fringe <span style="font-weight: bold;">:persistent</span> persistent <span style="font-weight: bold;">:id</span> id)
                          (start-process-shell-command <span style="font-style: italic;">"system-alarm"</span> nil
                                                       (mapconcat #'shell-quote-argument
                                                                  (list <span style="font-style: italic;">"mpg321"</span> alarm-sound)
                                                                  <span style="font-style: italic;">" "</span>))))))
</pre>
</div>
</div>
</li>

<li><a id="orgd55af6b"></a>clock in/out trigger invocation<br />
<div class="outline-text-6" id="text-orgd55af6b">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">with-eval-after-load</span> 'org
  (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">org-clock</span>)
  (add-hook 'org-clock-in-prepare-hook #'my/org-clock-in-set-timer)
  (add-hook 'org-clock-out-hook #'my/org-clock-out-have-a-break)
  (add-hook 'org-clock-cancel-hook #'my/org-clock-out-have-a-break))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/org-clock-in-set-timer</span> ()
  <span style="font-style: italic;">"Start count down timer for a clocked in entry.</span>

<span style="font-style: italic;">If the entry has ATTENTION_SPAN property, use it for `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">org-timer-default-timer</span><span style="font-style: italic;">'.</span>
<span style="font-style: italic;">Otherwise count down time is Effort property value.</span>
<span style="font-style: italic;">In neither case, count down time is 25 min which is suggested in the Pomodoro-technique."</span>
  (<span style="font-weight: bold;">let</span> ((todo (org-get-todo-state))
        (attention-span (org-entry-get (point) <span style="font-style: italic;">"ATTENTION_SPAN"</span> 'selective))
        (effort (org-entry-get (point) <span style="font-style: italic;">"Effort"</span> 'selective)))
    (<span style="font-weight: bold;">when</span> org-clock-clocking-in
      (org-clock-out))
    (<span style="font-weight: bold;">cond</span>
     ((stringp attention-span)
      (<span style="font-weight: bold;">let</span> ((org-timer-default-timer attention-span))
        (org-timer-set-timer '(64))))
     ((<span style="font-weight: bold;">and</span> (stringp effort)
           (ts&lt; (ts-parse effort) (ts-parse <span style="font-style: italic;">"01:40"</span>)))
      (org-timer-set-timer '(16)))
     (todo
      (<span style="font-weight: bold;">let</span> ((org-timer-default-timer <span style="font-style: italic;">"25"</span>))
        (org-timer-set-timer '(64)))))))

<span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/org-clock-out-have-a-break</span> ()
  <span style="font-style: italic;">"Clock in the 'Break' task if the previous task has clocked out."</span>
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">remove old clock entries if the entry is neither habit nor have any todo keywords</span>
  (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">or</span> (org-is-habit-p)
            (not (org-get-todo-state)))
    (my/org-clock-remove-old-clock-entries 4 5))
  (<span style="font-weight: bold;">and</span> org-timer-countdown-timer
       (org-timer-stop))
  (<span style="font-weight: bold;">save-excursion</span>
    (<span style="font-weight: bold;">let</span> ((break-entry-id <span style="font-style: italic;">"d49d97de-58ec-4e41-b58c-491a9e216e1c"</span>))
      (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">and</span> (not org-clock-clocking-in)
                 (not (string= (<span style="font-weight: bold;">or</span> (org-id-get) <span style="font-style: italic;">""</span>)
                               break-entry-id)))
        (org-id-goto break-entry-id)
        (org-clock-in)))))
</pre>
</div>
</div>
</li>

<li><a id="orga6a7e19"></a>jotting down (memo)<br />
<div class="outline-text-6" id="text-orga6a7e19">
<p>
Memo file (memo.org) is useful for jotting down fragmented pieces of text, code and more.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">org-capture</span>)

(add-to-list 'org-capture-templates
             '(<span style="font-style: italic;">"m"</span> <span style="font-style: italic;">"Memo"</span>
               entry (file <span style="font-style: italic;">"~/org/sandbox/memo.org"</span>)
               <span style="font-style: italic;">"* %U\n#+begin_src %^{Lnaguage|text}\n%(my-org-capture-filter-memo \"%i\")\n#+end_src"</span>
               <span style="font-weight: bold;">:jump-to-captured</span> t
               <span style="font-weight: bold;">:immediate-finish</span> t)
             t)

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-org-capture-filter-memo</span> (<span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> str)
  <span style="font-style: italic;">"Replace semantic representation in `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">org-mode</span><span style="font-style: italic;">' with plain string in STR."</span>
  (<span style="font-weight: bold;">cond</span>
   ((stringp str)
    (replace-regexp-in-string <span style="font-style: italic;">"^</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">*+ </span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">"</span> <span style="font-style: italic;">",\\1"</span> str))
   (t <span style="font-style: italic;">""</span>)))
</pre>
</div>
</div>
</li>

<li><a id="orgd12e3a3"></a>list someday tasks<br />
<div class="outline-text-6" id="text-orgd12e3a3">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">with-eval-after-load</span> 'org-ql-view
  (<span style="font-weight: bold;">push</span> `(<span style="font-style: italic;">"Someday tasks"</span>
          <span style="font-weight: bold;">:buffers-files</span> org-agenda-files
          <span style="font-weight: bold;">:query</span> (todo ,org-todo-keyword-4)
          <span style="font-weight: bold;">:super-groups</span> ((<span style="font-weight: bold;">:auto-outline-path</span>))
          <span style="font-weight: bold;">:sort</span> (priority date))
        org-ql-views))
</pre>
</div>
</div>
</li>

<li><a id="org3d7e017"></a>list suspended tasks<br />
<div class="outline-text-6" id="text-org3d7e017">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">with-eval-after-load</span> 'org-ql-view
  (<span style="font-weight: bold;">push</span> `(<span style="font-style: italic;">"Suspended tasks"</span>
          <span style="font-weight: bold;">:buffers-files</span>
          ,(file-expand-wildcards
            (file-name-concat org-directory <span style="font-style: italic;">"archive"</span> (format-time-string <span style="font-style: italic;">"archive_*.org"</span>)))
          <span style="font-weight: bold;">:query</span> (parent (heading <span style="font-style: italic;">"suspended tasks"</span>))
          <span style="font-weight: bold;">:super-groups</span> ((<span style="font-weight: bold;">:auto-property</span> <span style="font-style: italic;">"ARCHIVE_FILE"</span>))
          <span style="font-weight: bold;">:sort</span> (priority date))
        org-ql-views))
</pre>
</div>
</div>
</li>

<li><a id="orgf3cc68f"></a>learning english words/phrases<br />
<div class="outline-text-6" id="text-orgf3cc68f">
<ol class="org-ol">
<li>Capture an word to study by invoking my/org-english-capture</li>
<li>Review words periodically with my/org-english-drill-test-display or its variants</li>
</ol>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my/org-english-file</span> (file-name-concat org-directory <span style="font-style: italic;">"lists"</span> <span style="font-style: italic;">"english.org"</span>)
  <span style="font-style: italic;">"A file where all english words to learn locate."</span>)

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/org-english-capture</span> (word)
  <span style="font-style: italic;">"Capture an english WORD as a `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">org-mode</span><span style="font-style: italic;">' entry suitable for org-drill.</span>

<span style="font-style: italic;">Capture URL or file currently visiting as well as a sentence at point."</span>
  (<span style="font-weight: bold;">interactive</span> (list (<span style="font-weight: bold;">if</span> (use-region-p)
                         (buffer-substring (region-beginning) (region-end))
                       (read-string <span style="font-style: italic;">"Phrase: "</span>))))
  (<span style="font-weight: bold;">let*</span> ((sentence-end-double-space nil)
         (org-english-word word)
         (match-entry (org-ql-select
                        `(,my/org-english-file)
                        `(<span style="font-weight: bold;">and</span> (heading ,(format <span style="font-style: italic;">"%s"</span> word))
                              (tags <span style="font-style: italic;">"drill"</span>))
                        <span style="font-weight: bold;">:action</span> 'element-with-markers))
         (sentence (replace-regexp-in-string word
                                             (my/cloze-deletion word)
                                             (sentence-at-point))))
    (kill-new (<span style="font-weight: bold;">if</span> (stringp sentence) sentence <span style="font-style: italic;">""</span>))
    (<span style="font-weight: bold;">cond</span>
     (match-entry (org-capture nil <span style="font-style: italic;">"!1"</span>))
     (t (org-capture nil <span style="font-style: italic;">"!0"</span>)))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/cloze-deletion</span> (word)
  <span style="font-style: italic;">"Build cloze deletion string from WORD."</span>
  (seq-reduce (<span style="font-weight: bold;">lambda</span> (string chunk)
                (replace-regexp-in-string chunk (format <span style="font-style: italic;">"[%s||%c]"</span> chunk (string-to-char chunk))
                                          string))
              (split-string word <span style="font-style: italic;">"[ -]+"</span>)
              word))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/cloze-deletion-replace</span> (word start end)
  <span style="font-style: italic;">"Convert WORD into cloze deletion.</span>
<span style="font-style: italic;">OWRD can be determined a string between START and END.</span>

<span style="font-style: italic;">When called Interactively, WORD is either a word at point or a string in region."</span>
  (<span style="font-weight: bold;">interactive</span> (<span style="font-weight: bold;">cond</span>
                ((region-active-p)
                 `(,(buffer-substring (region-beginning) (region-end))
                   ,(region-beginning)
                   ,(region-end)))
                (t
                 (<span style="font-weight: bold;">let</span> ((bounds (bounds-of-thing-at-point 'word)))
                   `(,(thing-at-point 'word)
                     ,(car bounds)
                     ,(cdr bounds))))))
  (replace-string word
                  (my/cloze-deletion word)
                  nil
                  start
                  end))

(<span style="font-weight: bold;">with-eval-after-load</span> 'org-ql-view
  (<span style="font-weight: bold;">push</span> `(<span style="font-style: italic;">"English words to learn"</span>
          <span style="font-weight: bold;">:buffers-files</span> ,(list my/org-english-file)
          <span style="font-weight: bold;">:query</span> (<span style="font-weight: bold;">and</span> (tags <span style="font-style: italic;">"drill"</span>)
                      (tags <span style="font-style: italic;">"fd_en"</span>))
          <span style="font-weight: bold;">:sort</span> (scheduled date))
        org-ql-views))

(<span style="font-weight: bold;">with-eval-after-load</span> 'org-capture
  (add-to-list 'org-capture-templates
               '(<span style="font-style: italic;">"!0"</span> <span style="font-style: italic;">"drill entry for english word"</span>
                 entry (id <span style="font-style: italic;">"de0983a7-9d1a-4ef8-b882-148c401e862d"</span>)
                 <span style="font-style: italic;">"* %i :drill:fd_en:</span>
<span style="font-style: italic;">[%(my/org-english-insert-japanese-translation) %(my/org-english-insert-japanese-pronunciation org-english-word)]</span>
<span style="font-style: italic;">%(my/org-english-insert-english-translation)</span>
<span style="font-style: italic;">- %a</span>
<span style="font-style: italic;">  %c"</span>))
  (add-to-list 'org-capture-templates
               '(<span style="font-style: italic;">"!1"</span> <span style="font-style: italic;">"drill entry for english word"</span>
                 item (<span style="font-weight: bold;">function</span> my/org-english-goto-match)
                 <span style="font-style: italic;">"- %a</span>
<span style="font-style: italic;">  %c"</span>)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/org-english-goto-match</span> ()
  <span style="font-style: italic;">"Goto function for org-capture-template designed to insert an edditional example</span>
<span style="font-style: italic;">to existing english word entry."</span>
  (org-goto-marker-or-bmk
   (plist-get (cadar match-entry) <span style="font-weight: bold;">:org-marker</span>)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/org-english-insert-english-translation</span> ()
  <span style="font-style: italic;">"Insert English translation into org capture entry."</span>
  (<span style="font-weight: bold;">let*</span> ((url (format <span style="font-style: italic;">"http://wordnik.com/words/%s"</span> (downcase org-english-word)))
         (buffer (url-retrieve-synchronously url t t))
         (vertico-sort-function nil))
    (<span style="font-weight: bold;">with-temp-buffer</span>
      (url-insert-buffer-contents buffer url)
      (completing-read <span style="font-style: italic;">"match"</span> (split-string (funcall 'my/define-word--parse-wordnik) <span style="font-style: italic;">"\n"</span>)))))

(advice-add #'my/org-english-insert-english-translation <span style="font-weight: bold;">:around</span> #'my/define-word--fix-31)

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/org-english-insert-japanese-translation</span> ()
  <span style="font-style: italic;">"Insert Japanese translation into org capture entry."</span>
  (<span style="font-weight: bold;">let*</span> ((url (format <span style="font-style: italic;">"https://ejje.weblio.jp/content/%s"</span> (downcase org-english-word)))
         (buffer (url-retrieve-synchronously url t t)))
    (<span style="font-weight: bold;">with-temp-buffer</span>
      (url-insert-buffer-contents buffer url)
      (funcall 'my/define-word--parse-weblio))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/org-english-insert-japanese-pronunciation</span> (w)
  <span style="font-style: italic;">"Return and add to the kill ring (if interactive) Japanese pronunciation info for word `W'."</span>
  (<span style="font-weight: bold;">interactive</span> `(,(<span style="font-weight: bold;">or</span> (<span style="font-weight: bold;">when</span> (region-active-p)
                        (buffer-substring (region-beginning) (region-end)))
                      (read-string <span style="font-style: italic;">"Word: "</span>))))
  (<span style="font-weight: bold;">let</span> (pron)
    (request
      (concat <span style="font-style: italic;">"https://eow.alc.co.jp/search?q="</span> (string-replace <span style="font-style: italic;">" "</span> <span style="font-style: italic;">"+"</span> (downcase w)))
      <span style="font-weight: bold;">:sync</span> t
      <span style="font-weight: bold;">:parser</span>
      (<span style="font-weight: bold;">lambda</span> ()
        (<span style="font-weight: bold;">let</span> ((str (buffer-string)))
          (<span style="font-weight: bold;">with-temp-buffer</span>
            (insert str)
            (shr-render-region (point-min) (point-max))
            (<span style="font-weight: bold;">let</span> ((str (buffer-substring-no-properties (point-min) (point-max))))
              (<span style="font-weight: bold;">if</span> (string-match
                   (<span style="font-weight: bold;">rx</span> (seq (opt <span style="font-style: italic;">"&#12304;&#12524;&#12505;&#12523;&#12305;"</span> (** 1 2 digit) <span style="font-style: italic;">"&#12289;"</span>)
                            <span style="font-style: italic;">"&#12304;&#30330;&#38899;"</span> (opt <span style="font-style: italic;">"&#65281;"</span>) <span style="font-style: italic;">"&#12305;"</span>
                            (+ (<span style="font-weight: bold;">or</span> (category combining-diacritic)
                                   (category latin)
                                   (category japanese-katakana-two-byte)
                                   (category korean)
                                   (category greek)))
                            <span style="font-style: italic;">"&#12289;"</span>
                            (? (<span style="font-weight: bold;">or</span> (seq <span style="font-style: italic;">"&#12304;&#65312;&#12305;"</span> (opt <span style="font-style: italic;">"[US]"</span>)
                                        (+ (<span style="font-weight: bold;">or</span> (category japanese-katakana-two-byte)
                                               <span style="font-style: italic;">"&#65288;"</span> <span style="font-style: italic;">"&#65289;"</span>))
                                        (? <span style="font-style: italic;">"&#12289;"</span>))
                                   (seq (+ any) <span style="font-style: italic;">"*"</span>)))))
                   str)
                  (match-string 0 str)
                <span style="font-style: italic;">""</span>)))))
      <span style="font-weight: bold;">:success</span>
      (<span style="font-weight: bold;">cl-function</span>
       (<span style="font-weight: bold;">lambda</span> (<span style="font-weight: bold; text-decoration: underline;">&amp;key</span> data <span style="font-weight: bold; text-decoration: underline;">&amp;allow-other-keys</span>)
         (<span style="font-weight: bold;">setq</span> pron (replace-regexp-in-string
                     <span style="font-style: italic;">"\\[</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">.\\{2\\}</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">\\]"</span> <span style="font-style: italic;">"&#12304;\\1&#12305;"</span>
                     (string-trim-right (substring-no-properties data)
                                        <span style="font-style: italic;">"&#12289;"</span>))))))
    (<span style="font-weight: bold;">when</span> (interactive-p)
      (kill-new (princ pron)))
    pron))

(<span style="font-weight: bold;">defmacro</span> <span style="font-weight: bold;">with-org-drill-english-config</span> (<span style="font-weight: bold; text-decoration: underline;">&amp;rest</span> body)
  <span style="font-style: italic;">"Evaluate BODY with config for Org-Drill for english words review."</span>
  `(<span style="font-weight: bold;">progn</span>
     (org-id-goto <span style="font-style: italic;">"de0983a7-9d1a-4ef8-b882-148c401e862d"</span>)
     (<span style="font-weight: bold;">let</span> ((org-drill-scope 'tree)
           (org-drill-question-tag <span style="font-style: italic;">"drill"</span>)
           (org-drill-maximum-items-per-session 25)
           (org-drill-hide-item-headings-p t)
           (org-startup-indented nil))
       (org-indent-mode -1)
       (visual-line-mode 1)
       ,@body)
     (save-buffer)
     (org-indent-mode 1)
     (visual-line-mode -1)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/org-english-drill</span> ()
  <span style="font-style: italic;">"Invoke Org-Drill for English word review."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (with-org-drill-english-config (org-drill)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/org-english-drill-resume</span> ()
  <span style="font-style: italic;">"Resume Org-Drill session for english word review."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (with-org-drill-english-config (org-drill-resume)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/org-english-drill-nontrivial</span> ()
  <span style="font-style: italic;">""</span>
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">let</span> ((org-drill-match <span style="font-style: italic;">"-trivial"</span>))
    (with-org-drill-english-config (org-drill))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/org-english-drill-new</span> ()
  <span style="font-style: italic;">""</span>
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">let</span> ((org-drill-match <span style="font-style: italic;">"-DRILL_TOTAL_REPEATS&gt;0"</span>))
    (with-org-drill-english-config (org-drill))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/org-english-lookup</span> (word)
  <span style="font-style: italic;">"Look up WORD in my archive files using `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">org-ql-search</span><span style="font-style: italic;">'."</span>
  (<span style="font-weight: bold;">interactive</span> (list (<span style="font-weight: bold;">if</span> (use-region-p)
                         (buffer-substring (region-beginning) (region-end))
                       (read-string <span style="font-style: italic;">"Word: "</span>))))
  (org-ql-search
    my/org-english-file
    `(heading ,word)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/org-english-level</span> (word)
  <span style="font-style: italic;">"Return difficulty level of `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">WORD</span><span style="font-style: italic;">' in number."</span>
  (<span style="font-weight: bold;">cl-labels</span> ((parse-level (text)
                           (<span style="font-weight: bold;">if</span> (string-match
                                (<span style="font-weight: bold;">rx</span> (seq <span style="font-style: italic;">"&#12304;&#12524;&#12505;&#12523;&#12305;"</span>
                                         (group-n 1 (repeat 1 2 digit))))
                                text)
                               (match-string 1 text)
                             nil)))
    (<span style="font-weight: bold;">let</span> ((local-str (<span style="font-weight: bold;">with-current-buffer</span> (find-file-noselect my/org-english-file)
                       (<span style="font-weight: bold;">let</span> ((headline (org-ql-select
                                         `(,my/org-english-file)
                                         `(<span style="font-weight: bold;">and</span> (heading ,word)
                                               (tags <span style="font-style: italic;">"drill"</span>))
                                         <span style="font-weight: bold;">:action</span> 'element-with-markers)))
                         (<span style="font-weight: bold;">org-with-point-at</span> (plist-get (cadar headline) <span style="font-weight: bold;">:org-marker</span>)
                           (org-get-entry))))))
      (string-to-number (<span style="font-weight: bold;">or</span> (<span style="font-weight: bold;">and</span> local-str
                                 (parse-level local-str))
                            <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">CAVEAT: getting level from web costs a lot</span>
                            <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(when-let ((remote-str (my/org-english-insert-japanese-pronunciation word)))</span>
                            <span style="font-weight: bold; font-style: italic;">;;   </span><span style="font-weight: bold; font-style: italic;">(parse-level remote-str))</span>
                            <span style="font-style: italic;">"99"</span>)))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/org-ql--english-level&lt;</span> (a b)
  <span style="font-style: italic;">"Return non-nil if A's difficulty level is higher than B's.</span>
<span style="font-style: italic;">A and B are Org headline elements."</span>
  (<span style="font-weight: bold;">cl-macrolet</span> ((level (item)
                       `(my/org-english-level
                         (org-element-property <span style="font-weight: bold;">:raw-value</span> ,item))))
    (<span style="font-weight: bold;">let</span> ((a-level (level a))
          (b-level (level b)))
      (<span style="font-weight: bold;">cond</span> ((<span style="font-weight: bold;">and</span> (numberp a-level) (numberp b-level))
             (&lt; a-level b-level))
            (a-level t)
            (b-level nil)))))

(<span style="font-weight: bold;">provide</span> '<span style="font-weight: bold; text-decoration: underline;">my/org-english</span>)
</pre>
</div>

<p>
test code
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">ert</span>)

(<span style="font-weight: bold;">ert-deftest</span> <span style="font-weight: bold;">test-org-english-pron</span> ()
  <span style="font-style: italic;">"Tests the output string of `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">my/org-english-insert-japanese-pronunciation</span><span style="font-style: italic;">'."</span>
  (should (string= (my/org-english-insert-japanese-pronunciation <span style="font-style: italic;">"rife"</span>)
                   <span style="font-style: italic;">"&#12304;&#12524;&#12505;&#12523;&#12305;11&#12289;&#12304;&#30330;&#38899;&#12305;ra&#769;if&#12289;&#12304;&#65312;&#12305;&#12521;&#12452;&#12501;"</span>))
  (should (string= (my/org-english-insert-japanese-pronunciation <span style="font-style: italic;">"congregate"</span>)
                   <span style="font-style: italic;">"&#12304;&#12524;&#12505;&#12523;&#12305;12&#12289;&#12304;&#30330;&#38899;&#65281;&#12305;&#12304;US&#12305;&#12298;&#21205;&#12299;k&#593;&#769;ngr&#601;ge&#768;it &#12298;&#24418;&#12299;k&#593;&#769;&#331;gr&#601;git &#65372; &#12304;UK&#12305;&#12298;&#21205;&#12299;k&#596;&#769;&#331;grige&#768;it &#12298;&#24418;&#12299;k&#596;&#769;&#331;grigit"</span>))
  (should (string= (my/org-english-insert-japanese-pronunciation <span style="font-style: italic;">"unleash"</span>)
                   <span style="font-style: italic;">"&#12304;&#12524;&#12505;&#12523;&#12305;9&#12289;&#12304;&#30330;&#38899;&#12305;&#652;&#768;nli&#769;&#720;&#643;&#12289;&#12304;&#65312;&#12305;&#12450;&#12531;&#12522;&#12540;&#12471;&#12517;"</span>))
  (should (string= (my/org-english-insert-japanese-pronunciation <span style="font-style: italic;">"homage"</span>)
                   <span style="font-style: italic;">"&#12304;&#12524;&#12505;&#12523;&#12305;11&#12289;&#12304;&#30330;&#38899;&#12305;&#12304;US&#12305; h&#593;&#769;mid&#658; &#65372; &#12304;UK&#12305; h&#596;&#769;mid&#658;&#12289;&#12304;&#65312;&#12305;&#12304;US&#12305;&#12495;&#12511;&#12472;&#12289;&#12304;UK&#12305;&#12507;&#12511;&#12472;"</span>))
  (should (string= (my/org-english-insert-japanese-pronunciation <span style="font-style: italic;">"interstitial"</span>)
                   <span style="font-style: italic;">"&#12304;&#30330;&#38899;&#12305;i&#768;nt&#601;rsti&#769;&#643;&#601;l&#12289;&#12304;&#65312;&#12305;&#12452;&#12531;&#12479;&#65288;&#12540;&#65289;&#12473;&#12486;&#12451;&#12471;&#12515;&#12523;"</span>))
  (should (string= (my/org-english-insert-japanese-pronunciation <span style="font-style: italic;">"veterinarian"</span>)
                   <span style="font-style: italic;">"&#12304;&#12524;&#12505;&#12523;&#12305;12&#12289;&#12304;&#30330;&#38899;&#12305;ve&#768;t&#601;r&#601;n&#8051;&#601;ri&#601;n&#12289;&#12304;&#65312;&#12305;&#12532;&#12455;&#12488;&#12521;&#12493;&#12450;&#12522;&#12450;&#12531;"</span>))
  (should (string= (my/org-english-insert-japanese-pronunciation <span style="font-style: italic;">"warehouse"</span>)
                   <span style="font-style: italic;">"&#12304;&#12524;&#12505;&#12523;&#12305;8&#12289;&#12304;&#30330;&#38899;&#65281;&#12305;&#12298;&#21205;&#12299;w&#8051;&#601;rha&#768;uz &#12298;&#21517;&#12299;w&#8051;&#601;rha&#768;us&#12289;&#12304;&#65312;&#12305;&#12454;&#12455;&#12450;&#12495;&#12454;&#12473;&#12289;&#12454;&#12456;&#12450;&#12495;&#12454;&#12473;"</span>))
  (should (string= (my/org-english-insert-japanese-pronunciation <span style="font-style: italic;">"lambaste"</span>)
                   <span style="font-style: italic;">""</span>))
  (should (string= (my/org-english-insert-japanese-pronunciation <span style="font-style: italic;">"in a nutshell"</span>)
                   <span style="font-style: italic;">""</span>))
  (should (string= (my/org-english-insert-japanese-pronunciation <span style="font-style: italic;">"traverse"</span>)
                   <span style="font-style: italic;">"&#12304;&#12524;&#12505;&#12523;&#12305;8&#12289;&#12304;&#30330;&#38899;&#65281;&#12305;&#12298;&#21517;&#12539;&#24418;&#12299;tr&#230;&#769;v&#601;&#720;rs &#12298;&#21205;&#12299;tr&#601;v&#652;&#769;rs&#12289;&#12304;&#65312;&#12305;&#12488;&#12453;&#12521;&#12532;&#12449;&#12540;&#12473;&#12289;&#12488;&#12521;&#12496;&#12540;&#12473;"</span>)))
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="orgd47922f"></a>additional emacs lisp code<br />
<div class="outline-text-5" id="text-orgd47922f">
<p>
This section mainly for elisp code associated with some other programs.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">&lt;&lt;additional-elisp&gt;&gt;
</pre>
</div>
</div>
</li>
</ul>
</div>
</div>

<div id="outline-container-orgd237347" class="outline-3">
<h3 id="orgd237347">Findutils</h3>
<div class="outline-text-3" id="text-orgd237347">
<p>
<a href="https://www.gnu.org/software/findutils/">GNU Findutils</a> offers following commands
</p>
<ul class="org-ul">
<li>find</li>
<li>locate</li>
<li>updatedb</li>
<li>xargs</li>
</ul>

<p>
'locate' is GNU implementation of mlocate. I prefer '[BROKEN LINK: id:c56e19dd-d3b1-4595-be74-0ff7c6558bc8]', which is fast than mlocate, for indexed file searching,
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"findutils"</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd3650e4" class="outline-3">
<h3 id="orgd3650e4"><a id="ID-c56e19dd-d3b1-4595-be74-0ff7c6558bc8"></a>plocate</h3>
<div class="outline-text-3" id="text-orgd3650e4">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"plocate"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp" id="orgd0a0b03">(file-name-concat <span style="font-style: italic;">"&lt;&lt;share-dir()&gt;&gt;"</span> <span style="font-style: italic;">"plocate/plocate.db"</span>)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-shell"><span style="font-weight: bold;">export</span> <span style="font-weight: bold; font-style: italic;">LOCATE_PATH</span>=&lt;&lt;plocate-db()&gt;&gt;
</pre>
</div>

<div class="org-src-container">
<pre class="src src-shell"><span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">!/usr/bin/</span><span style="font-weight: bold;">env</span><span style="font-weight: bold; font-style: italic;"> bash</span>

[[ -d $(dirname &lt;&lt;plocate-db()&gt;&gt;) ]] <span style="font-style: italic;">\</span>
 || mkdir -p $(dirnmae &lt;&lt;plocate-db()&gt;&gt;) <span style="font-style: italic;">\</span>
   &amp;&amp; which -a updatedb | grep sbin | xargs -I{} sh -c <span style="font-style: italic;">'{} -l 0 -U '</span>&lt;&lt;home-dir()&gt;&gt;<span style="font-style: italic;">' -o &lt;&lt;plocate-db()&gt;&gt;'</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-conf">30 4 * * * /bin/bash -ci <span style="font-style: italic;">"updatedb-home &gt;&gt; $LOG_DIR/updatedb-home.log 2&gt;&amp;1"</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org7cad4d5" class="outline-3">
<h3 id="org7cad4d5">OpenSSH</h3>
<div class="outline-text-3" id="text-org7cad4d5">
<p>
<a href="https://www.openssh.com/">OpenSSH</a> is client and server side of ssh implementation.
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"openssh"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-conf">Include config.d/*
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf58cb46" class="outline-3">
<h3 id="orgf58cb46">Git</h3>
<div class="outline-text-3" id="text-orgf58cb46">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"git"</span>
</pre>
</div>

<ul class="org-ul">
<li><p>
git ignore
</p>
<div class="org-src-container">
<pre class="src src-conf"><span style="font-weight: bold; font-style: italic;">#</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">~/.gitignote</span>
<span style="font-weight: bold; font-style: italic;">#</span>
<span style="font-weight: bold; font-style: italic;">## </span><span style="font-weight: bold; font-style: italic;">Compiled object files ##</span>
*.slo
*.lo
*.o
*.obj

<span style="font-weight: bold; font-style: italic;">## </span><span style="font-weight: bold; font-style: italic;">Compiled Dynamic libraries ##</span>
*.so
*.dylib
*.dll

<span style="font-weight: bold; font-style: italic;">## </span><span style="font-weight: bold; font-style: italic;">Compiled Static libraries ##</span>
*.lai
*.la
*.a
*.lib

<span style="font-weight: bold; font-style: italic;">## </span><span style="font-weight: bold; font-style: italic;">Executables ##</span>
*.out
*.app

<span style="font-weight: bold; font-style: italic;">## </span><span style="font-weight: bold; font-style: italic;">Windows ##</span>
Thumbs.db
ehthumbs.db
Desktop.ini
$RECYCLE.BIN/
*.cab
*.msm
*.msp

<span style="font-weight: bold; font-style: italic;">## </span><span style="font-weight: bold; font-style: italic;">Mac ##</span>
.DS_Store
.AppleDouble
.LSOverride
.Spotlight-V100
.Trashes
._*

<span style="font-weight: bold; font-style: italic;">## </span><span style="font-weight: bold; font-style: italic;">Linux ##</span>
locate.db

<span style="font-weight: bold; font-style: italic;">## </span><span style="font-weight: bold; font-style: italic;">version control system ##</span>
.git/
.hg/
.svn/

<span style="font-weight: bold; font-style: italic;">## </span><span style="font-weight: bold; font-style: italic;">backup,log ##</span>
*~
~*
*.swp
.swp.*
*.tmp
*.bak
*.old
*.log
.cache/
*.autosave

<span style="font-weight: bold; font-style: italic;">## </span><span style="font-weight: bold; font-style: italic;">Emacs ##</span>
*.elc

<span style="font-weight: bold; font-style: italic;">## </span><span style="font-weight: bold; font-style: italic;">Vim ##</span>
*.un~
Session.vim
.netrwhist

<span style="font-weight: bold; font-style: italic;">## </span><span style="font-weight: bold; font-style: italic;">GNU GLOBAL ##</span>
GPATH
GRTAGS
GTAGS

<span style="font-weight: bold; font-style: italic;">## </span><span style="font-weight: bold; font-style: italic;">netbeans ##</span>
nbproject/
<span style="font-weight: bold; font-style: italic;">## </span><span style="font-weight: bold; font-style: italic;">intellij idea ##</span>
.idea/
<span style="font-weight: bold; font-style: italic;">## </span><span style="font-weight: bold; font-style: italic;">eclipse ##</span>
.settings/
.project
.classpath
.buildpath
<span style="font-weight: bold; font-style: italic;">## </span><span style="font-weight: bold; font-style: italic;">XCode ##</span>
*.xcodeproj/*

<span style="font-weight: bold; font-style: italic;">## </span><span style="font-weight: bold; font-style: italic;">Build dir ##</span>
build/
</pre>
</div></li>
<li><p>
git config
</p>

<p>
<a href="https://magit.vc/manual/magit/How-to-show-diffs-for-gpg_002dencrypted-files_003f.html">This page</a> show you how to get diffs of gpg files in Magit.
</p>

<div class="org-src-container">
<pre class="src src-gitconfig">[core]
        excludesfile = &lt;&lt;home-dir()&gt;&gt;/.config/git/info/ignore
        attributesfile = &lt;&lt;home-dir()&gt;&gt;/.config/git/info/attributes
        editor = emacs
        symlinks = true
        # Unicode
        precomposeunicode = true
        quotepath = true
        autocrlf = false
[push]
        # simple,matching,upstream,current
        default = simple
[color]
        ui = auto
        status = auto
        diff = auto
        branch = auto
        interactive = auto
        grep = auto
[diff]
        patience = true
[diff "gpg"]
        textconv = gpg --no-tty --decrypt
[help]
        autocorrect = 0
[alias]
        co = checkout
        ca = commit -a -v
        ce = commit -v --amend
        st = status --branch --short
        si = status --ignored --short
        branches = branch -a
        remotes = remote -v
        tags = tag -l
        lg = log --graph --all --decorate --abbrev-commit --branches --date=short --pretty=format:\"%C(red)%h%C(reset) %C(green)[%ad]%C(reset) %s %C(cyan)@%an%C(reset) %C(yellow)%d%C(reset)\"
        fp = fetch --prune
        di = diff
        dh = diff --histogram
        dw = diff --word-diff
        dc = diff --cached
        wc = whatchanged
[user]
        email = 6841207+p-snow@users.noreply.github.com
        name = p-snow
[credential]
        helper = &lt;&lt;home-dir()&gt;&gt;/.guix-extra-profiles/base/base/bin/pass-git-helper -m &lt;&lt;home-dir()&gt;&gt;/.config/pass-git-helper/git-pass-mapping.ini
&lt;&lt;git-config&gt;&gt;
</pre>
</div></li>
<li><p>
git attributes
</p>
<div class="org-src-container">
<pre class="src src-gitattributes">*.c diff=cpp
*.h diff=cpp
*.cpp diff=cpp
*.hpp diff=cpp
*.cs diff=csharp
*.m diff=objc
*.java diff=java
*.html diff=html
*.xml diff=html
*.pl diff=perl
*.pm diff=perl
*.t diff=perl
*.php diff=php
*.ptml diff=php
*.py diff=python
*.rb diff=ruby
*.js diff=java
*.csv encoding=cp932
*.json diff=json
*.gpg filter=gpg diff=gpg
</pre>
</div></li>
</ul>
</div>

<div id="outline-container-org816d81a" class="outline-4">
<h4 id="org816d81a">git-annex</h4>
<div class="outline-text-4" id="text-org816d81a">
<p>
<a href="https://git-annex.branchable.com/git-annex/">git-annex</a> aims to manage large files based on git system. It is alse designed to manage copies of binary in distributed repositories. <a href="https://git-annex.branchable.com/walkthrough/">walkthrough</a> offers handy instruction.
</p>

<p>
<a href="https://git-lfs.github.com/">Git-LFS</a> is alse designed to manage large files. <a href="https://lwn.net/Articles/774125/">This article</a> compares Git-LFS and git-annex precisely.
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"git-annex"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-style: italic;">"https://git-annex.branchable.com/news/index.rss"</span> soft_update)
(<span style="font-style: italic;">"https://git-annex.branchable.com/devblog/index.rss"</span> soft_update)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-gitconfig">[annex]
        youtube-dl-command = yt-dlp
[annex.security]
        allowed-ip-addresses = all
[safe]
        directory = /mnt/ns01/doc
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org385f92a" class="outline-3">
<h3 id="org385f92a">ghq</h3>
<div class="outline-text-3" id="text-org385f92a">
<p>
<a href="https://github.com/x-motemen/ghq">ghq</a> is management system for remote git repositories.
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"ghq"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-gitconfig">[ghq]
        root = ~/ghq
</pre>
</div>

<div class="org-src-container">
<pre class="src src-conf">[<span style="font-weight: bold; text-decoration: underline;">github.com*</span>]
<span style="font-weight: bold; font-style: italic;">username_extractor</span>=specific_line
<span style="font-weight: bold; font-style: italic;">line_username</span>=2
<span style="font-weight: bold; font-style: italic;">target</span>=github.com
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">username_extractor=entry_name</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org1c98128" class="outline-3">
<h3 id="org1c98128">Pass</h3>
<div class="outline-text-3" id="text-org1c98128">
<p>
<a href="https://www.passwordstore.org/">Pass</a> is a simple password manager.
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"password-store"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-conf">[<span style="font-weight: bold; text-decoration: underline;">github.com*</span>]
<span style="font-weight: bold; font-style: italic;">username_extractor</span>=specific_line
<span style="font-weight: bold; font-style: italic;">line_username</span>=2
<span style="font-weight: bold; font-style: italic;">target</span>=github.com
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">username_extractor=entry_name</span>
</pre>
</div>

<ul class="org-ul">
<li><p>
additional environment variables
</p>
<div class="org-src-container">
<pre class="src src-shell"><span style="font-weight: bold;">export</span> <span style="font-weight: bold; font-style: italic;">PASSWORD_STORE_CLIP_TIME</span>=25
</pre>
</div></li>
</ul>
</div>
</div>
<div id="outline-container-orgc23a7ba" class="outline-3">
<h3 id="orgc23a7ba">mpv</h3>
<div class="outline-text-3" id="text-orgc23a7ba">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"mpv"</span>
</pre>
</div>

<ul class="org-ul">
<li><p>
mpv.conf
</p>
<div class="org-src-container">
<pre class="src src-conf"><span style="font-weight: bold; font-style: italic;">##################</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">video settings #</span>
<span style="font-weight: bold; font-style: italic;">##################</span>

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Start in fullscreen mode by default.</span>
<span style="font-weight: bold; font-style: italic;">fs</span>=yes


<span style="font-weight: bold; font-style: italic;">###########</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">General #</span>
<span style="font-weight: bold; font-style: italic;">###########</span>

save-position-on-quit
no-border                               <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">no window title bar</span>
msg-module                              <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">prepend module name to log messages</span>
msg-color                               <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">color log messages on terminal</span>
term-osd-bar                            <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">display a progress bar on the terminal</span>
use-filedir-conf                        <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">look for additional config files in the directory of the opened file</span>
pause                                   <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">no autoplay</span>
<span style="font-weight: bold; font-style: italic;">force-window</span>=immediate
keep-open                               <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">keep the player open when a file's end is reached</span>
<span style="font-weight: bold; font-style: italic;">autofit-larger</span>=100%x95%                 <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">resize window in case it's larger than W%xH% of the screen</span>
cursor-autohide-fs-only                 <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">don't autohide the cursor in window mode, only fullscreen</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">input-media-keys=no                     # enable/disable OSX media keys</span>
<span style="font-weight: bold; font-style: italic;">cursor-autohide</span>=1000                    <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">autohide the curser after 1s</span>

<span style="font-weight: bold; font-style: italic;">screenshot-format</span>=png
<span style="font-weight: bold; font-style: italic;">screenshot-png-compression</span>=8
<span style="font-weight: bold; font-style: italic;">screenshot-template</span>=<span style="font-style: italic;">'~/Desktop/%F (%P) %n'</span>

<span style="font-weight: bold; font-style: italic;">hls-bitrate</span>=max                         <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">use max quality for HLS streams</span>


<span style="font-weight: bold; font-style: italic;">#########</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Cache #</span>
<span style="font-weight: bold; font-style: italic;">#########</span>

<span style="font-weight: bold; font-style: italic;">cache</span>=yes
<span style="font-weight: bold; font-style: italic;">cache-secs</span>=10                           <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">how many seconds of audio/video to prefetch if the cache is active</span>


<span style="font-weight: bold; font-style: italic;">#############</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">OSD / OSC #</span>
<span style="font-weight: bold; font-style: italic;">#############</span>

<span style="font-weight: bold; font-style: italic;">osd-level</span>=1                             <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">enable osd and display --osd-status-msg on interaction</span>
<span style="font-weight: bold; font-style: italic;">osd-duration</span>=2500                       <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">hide the osd after x ms</span>
<span style="font-weight: bold; font-style: italic;">osd-status-msg</span>=<span style="font-style: italic;">'${time-pos} / ${duration}${?percent-pos: (${percent-pos}%)}${?frame-drop-count:${!frame-drop-count==0: Dropped: ${frame-drop-count}}}\n${?chapter:Chapter: ${chapter}}'</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">osd-status-msg='${=time-pos}'         # show raw position</span>

<span style="font-weight: bold; font-style: italic;">osd-font</span>=<span style="font-style: italic;">'Source Sans Pro'</span>
<span style="font-weight: bold; font-style: italic;">osd-font-size</span>=64
<span style="font-weight: bold; font-style: italic;">osd-color</span>=<span style="font-style: italic;">'#CCFFFFFF'</span>                   <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">ARGB format</span>
<span style="font-weight: bold; font-style: italic;">osd-border-color</span>=<span style="font-style: italic;">'#DD322640'</span>            <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">ARGB format</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">osd-shadow-offset=1                    # pixel width for osd text and progress bar</span>
<span style="font-weight: bold; font-style: italic;">osd-bar-align-y</span>=0                       <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">progress bar y alignment (-1 top, 0 centered, 1 bottom)</span>
<span style="font-weight: bold; font-style: italic;">osd-border-size</span>=2                       <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">size for osd text and progress bar</span>
<span style="font-weight: bold; font-style: italic;">osd-bar-h</span>=2                             <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">height of osd bar as a fractional percentage of your screen height</span>
<span style="font-weight: bold; font-style: italic;">osd-bar-w</span>=60                            <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">width of " " "</span>


<span style="font-weight: bold; font-style: italic;">#############</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Subtitles #</span>
<span style="font-weight: bold; font-style: italic;">#############</span>

sub-use-margins
sub-ass-force-margins

demuxer-mkv-subtitle-preroll            <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">try to correctly show embedded subs when seeking</span>
<span style="font-weight: bold; font-style: italic;">sub-auto</span>=fuzzy                          <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">external subs don't have to match the file name exactly to autoload</span>
<span style="font-weight: bold; font-style: italic;">embeddedfonts</span>=yes                       <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">use embedded fonts for SSA/ASS subs</span>
<span style="font-weight: bold; font-style: italic;">sub-fix-timing</span>=no                       <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">do not try to fix gaps (which might make it worse in some cases)</span>
<span style="font-weight: bold; font-style: italic;">sub-ass-force-style</span>=Kerning=yes         <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">allows you to override style parameters of ASS scripts</span>

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">the following options only apply to subtitles without own styling (i.e. not ASS but e.g. SRT)</span>
<span style="font-weight: bold; font-style: italic;">sub-font</span>=<span style="font-style: italic;">"Source Sans Pro Semibold"</span>
<span style="font-weight: bold; font-style: italic;">sub-font-size</span>=36
<span style="font-weight: bold; font-style: italic;">sub-color</span>=<span style="font-style: italic;">"#FFFFFFFF"</span>
<span style="font-weight: bold; font-style: italic;">sub-border-color</span>=<span style="font-style: italic;">"#FF262626"</span>
<span style="font-weight: bold; font-style: italic;">sub-border-size</span>=3.2
<span style="font-weight: bold; font-style: italic;">sub-shadow-offset</span>=1
<span style="font-weight: bold; font-style: italic;">sub-shadow-color</span>=<span style="font-style: italic;">"#33000000"</span>
<span style="font-weight: bold; font-style: italic;">sub-spacing</span>=0.5


<span style="font-weight: bold; font-style: italic;">#############</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Languages #</span>
<span style="font-weight: bold; font-style: italic;">#############</span>

<span style="font-weight: bold; font-style: italic;">slang</span>=enm,en,eng,de,deu,ger             <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">automatically select these subtitles (decreasing priority)</span>
<span style="font-weight: bold; font-style: italic;">alang</span>=ja,jp,jpn,en,eng,de,deu,ger       <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">automatically select these audio tracks (decreasing priority)</span>

<span style="font-weight: bold; font-style: italic;">#########</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Image #</span>
<span style="font-weight: bold; font-style: italic;">#########</span>

<span style="font-weight: bold; font-style: italic;">image-display-duration</span>=4

<span style="font-weight: bold; font-style: italic;">#########</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Audio #</span>
<span style="font-weight: bold; font-style: italic;">#########</span>

<span style="font-weight: bold; font-style: italic;">audio-file-auto</span>=fuzzy                   <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">external audio doesn't has to match the file name exactly to autoload</span>
<span style="font-weight: bold; font-style: italic;">audio-pitch-correction</span>=yes              <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">automatically insert scaletempo when playing with higher speed</span>
<span style="font-weight: bold; font-style: italic;">volume-max</span>=200                          <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">maximum volume in %, everything above 100 results in amplification</span>
<span style="font-weight: bold; font-style: italic;">volume</span>=100                              <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">default volume, 100 = unchanged</span>


<span style="font-weight: bold; font-style: italic;">################</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Video Output #</span>
<span style="font-weight: bold; font-style: italic;">################</span>

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Active VOs (and some other options) are set conditionally</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">See here for more information: https://github.com/wm4/mpv-scripts/blob/master/auto-profiles.lua</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">The script was modified to import functions from scripts/auto-profiles-functions.lua</span>

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Defaults for all profiles</span>
<span style="font-weight: bold; font-style: italic;">tscale</span>=catmull_rom                      <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">sharp: oversample &lt;-&gt; linear (triangle) &lt;-&gt; catmull_rom &lt;-&gt; mitchell &lt;-&gt; gaussian &lt;-&gt; bicubic : smooth</span>
<span style="font-weight: bold; font-style: italic;">opengl-early-flush</span>=no
<span style="font-weight: bold; font-style: italic;">opengl-pbo</span>=yes


[<span style="font-weight: bold; text-decoration: underline;">high-quality</span>]
<span style="font-weight: bold; font-style: italic;">profile-desc</span>=cond:is_desktop() and get(<span style="font-style: italic;">'width'</span>, math.huge) &lt; 3840
<span style="font-weight: bold; font-style: italic;">scale</span>=ewa_lanczossharp
<span style="font-weight: bold; font-style: italic;">cscale</span>=ewa_lanczossoft
<span style="font-weight: bold; font-style: italic;">dscale</span>=mitchell
<span style="font-weight: bold; font-style: italic;">scale-antiring</span>=0.7
<span style="font-weight: bold; font-style: italic;">cscale-antiring</span>=0.7
<span style="font-weight: bold; font-style: italic;">dither-depth</span>=auto
<span style="font-weight: bold; font-style: italic;">correct-downscaling</span>=yes
<span style="font-weight: bold; font-style: italic;">sigmoid-upscaling</span>=yes
<span style="font-weight: bold; font-style: italic;">deband</span>=yes
<span style="font-weight: bold; font-style: italic;">hwdec</span>=no

[<span style="font-weight: bold; text-decoration: underline;">mid-quality</span>]
<span style="font-weight: bold; font-style: italic;">profile-desc</span>=cond:(is_laptop() and not on_battery() and get(<span style="font-style: italic;">'width'</span>, math.huge) &lt; 1920) or (is_desktop() and get(<span style="font-style: italic;">'width'</span>, math.huge) &gt;= 3840)
<span style="font-weight: bold; font-style: italic;">scale</span>=spline36
<span style="font-weight: bold; font-style: italic;">cscale</span>=bilinear
<span style="font-weight: bold; font-style: italic;">dscale</span>=mitchell
<span style="font-weight: bold; font-style: italic;">scale-antiring</span>=1.0
<span style="font-weight: bold; font-style: italic;">cscale-antiring</span>=1.0
<span style="font-weight: bold; font-style: italic;">dither-depth</span>=auto
<span style="font-weight: bold; font-style: italic;">correct-downscaling</span>=yes
<span style="font-weight: bold; font-style: italic;">sigmoid-upscaling</span>=yes
<span style="font-weight: bold; font-style: italic;">deband</span>=yes
<span style="font-weight: bold; font-style: italic;">hwdec</span>=no

[<span style="font-weight: bold; text-decoration: underline;">low-quality</span>]
<span style="font-weight: bold; font-style: italic;">profile-desc</span>=cond:is_laptop() and (on_battery() or get(<span style="font-style: italic;">'width'</span>, math.huge) &gt;= 1920)
<span style="font-weight: bold; font-style: italic;">scale</span>=bilinear
<span style="font-weight: bold; font-style: italic;">cscale</span>=bilinear
<span style="font-weight: bold; font-style: italic;">dscale</span>=bilinear
<span style="font-weight: bold; font-style: italic;">scale-antiring</span>=0.0
<span style="font-weight: bold; font-style: italic;">cscale-antiring</span>=0.0
<span style="font-weight: bold; font-style: italic;">dither-depth</span>=no
<span style="font-weight: bold; font-style: italic;">correct-downscaling</span>=no
<span style="font-weight: bold; font-style: italic;">sigmoid-upscaling</span>=no
<span style="font-weight: bold; font-style: italic;">deband</span>=no
<span style="font-weight: bold; font-style: italic;">hwdec</span>=auto

[<span style="font-weight: bold; text-decoration: underline;">60FPS</span>]
<span style="font-weight: bold; font-style: italic;">profile-desc</span>=cond:is_laptop() and get(<span style="font-style: italic;">'container-fps'</span>, 0) &gt;= 59
<span style="font-weight: bold; font-style: italic;">scale</span>=bilinear
<span style="font-weight: bold; font-style: italic;">cscale</span>=bilinear

[<span style="font-weight: bold; text-decoration: underline;">4K</span>]
<span style="font-weight: bold; font-style: italic;">profile-desc</span>=cond:get(<span style="font-style: italic;">'width'</span>, -math.huge) &gt;= 3840
<span style="font-weight: bold; font-style: italic;">vd-lavc-threads</span>=32

[<span style="font-weight: bold; text-decoration: underline;">4K-inverted</span>]
<span style="font-weight: bold; font-style: italic;">profile-desc</span>=cond:get(<span style="font-style: italic;">'width'</span>, -math.huge) &lt; 3840
<span style="font-weight: bold; font-style: italic;">vd-lavc-threads</span>=0


[<span style="font-weight: bold; text-decoration: underline;">default</span>]


<span style="font-weight: bold; font-style: italic;">###################################</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Protocol Specific Configuration #</span>
<span style="font-weight: bold; font-style: italic;">###################################</span>

[<span style="font-weight: bold; text-decoration: underline;">protocol.https</span>]
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">cache=yes</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">cache-default=500000                    # size in KB</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">cache-backbuffer=250000                 # size in KB</span>
<span style="font-weight: bold; font-style: italic;">cache-secs</span>=100                          <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">how many seconds of audio/video to prefetch</span>
<span style="font-weight: bold; font-style: italic;">user-agent</span>=<span style="font-style: italic;">'Mozilla/5.0 (Macintosh; Intel Mac OS X 10.11; rv:47.0) Gecko/20100101 Firefox/47.0'</span>

[<span style="font-weight: bold; text-decoration: underline;">protocol.http</span>]
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">cache=yes</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">cache-default=500000                    # size in KB</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">cache-backbuffer=250000                 # size in KB</span>
<span style="font-weight: bold; font-style: italic;">cache-secs</span>=100                          <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">how many seconds of audio/video to prefetch</span>
<span style="font-weight: bold; font-style: italic;">user-agent</span>=<span style="font-style: italic;">'Mozilla/5.0 (Macintosh; Intel Mac OS X 10.11; rv:47.0) Gecko/20100101 Firefox/47.0'</span>

[<span style="font-weight: bold; text-decoration: underline;">extension.gif</span>]
<span style="font-weight: bold; font-style: italic;">cache</span>=no
no-pause
<span style="font-weight: bold; font-style: italic;">loop-file</span>=yes

[<span style="font-weight: bold; text-decoration: underline;">extension.webm</span>]
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">cache=no</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">no-pause</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">loop-file=yes</span>
</pre>
</div></li>
<li><p>
input.conf
</p>
<div class="org-src-container">
<pre class="src src-conf"><span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">mpv keybindings</span>
<span style="font-weight: bold; font-style: italic;">#</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Location of user-defined bindings: ~/.config/mpv/input.conf</span>
<span style="font-weight: bold; font-style: italic;">#</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Lines starting with # are comments. Use SHARP to assign the # key.</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Copy this file and uncomment and edit the bindings you want to change.</span>
<span style="font-weight: bold; font-style: italic;">#</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">List of commands and further details: DOCS/man/input.rst</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">List of special keys: --input-keylist</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Keybindings testing mode: mpv --input-test --force-window --idle</span>
<span style="font-weight: bold; font-style: italic;">#</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Use 'ignore' to unbind a key fully (e.g. 'ctrl+a ignore').</span>
<span style="font-weight: bold; font-style: italic;">#</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Strings need to be quoted and escaped:</span>
<span style="font-weight: bold; font-style: italic;">#   </span><span style="font-weight: bold; font-style: italic;">KEY show-text "This is a single backslash: \\ and a quote: \" !"</span>
<span style="font-weight: bold; font-style: italic;">#</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">You can use modifier-key combinations like Shift+Left or Ctrl+Alt+x with</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">the modifiers Shift, Ctrl, Alt and Meta (may not work on the terminal).</span>
<span style="font-weight: bold; font-style: italic;">#</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">The default keybindings are hardcoded into the mpv binary.</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">You can disable them completely with: --no-input-default-bindings</span>

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Developer note:</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">On compilation, this file is baked into the mpv binary, and all lines are</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">uncommented (unless '#' is followed by a space) - thus this file defines the</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">default key bindings.</span>

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">If this is enabled, treat all the following bindings as default.</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">default-bindings start</span>

<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">MOUSE_BTN0 ignore                      # don't do anything</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">MOUSE_BTN0_DBL cycle fullscreen        # toggle fullscreen on/off</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">MOUSE_BTN2 cycle pause                 # toggle pause on/off</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">MOUSE_BTN3 seek 10</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">MOUSE_BTN4 seek -10</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">MOUSE_BTN5 add volume -2</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">MOUSE_BTN6 add volume 2</span>

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Mouse wheels, touchpad or other input devices that have axes</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">if the input devices supports precise scrolling it will also scale the</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">numeric value accordingly</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">AXIS_UP    seek 10</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">AXIS_DOWN  seek -10</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">AXIS_LEFT  seek 5</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">AXIS_RIGHT seek -5</span>

<span style="font-weight: bold; font-style: italic;">## </span><span style="font-weight: bold; font-style: italic;">Seek units are in seconds, but note that these are limited by keyframes</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">RIGHT seek  5</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">LEFT  seek -5</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">UP    seek  60</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">DOWN  seek -60</span>
RIGHT  seek  5
LEFT   seek -5
UP     seek -60
DOWN   seek  60
Ctrl+f seek  3
Ctrl+b seek -3
Ctrl+p seek -60
Ctrl+n seek  60
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Do smaller, always exact (non-keyframe-limited), seeks with shift.</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Don't show them on the OSD (no-osd).</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">Shift+RIGHT no-osd seek  1 exact</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">Shift+LEFT  no-osd seek -1 exact</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">Shift+UP    no-osd seek  5 exact</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">Shift+DOWN  no-osd seek -5 exact</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Skip to previous/next subtitle (subject to some restrictions; see manpage)</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">Ctrl+LEFT   no-osd sub-seek -1</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">Ctrl+RIGHT  no-osd sub-seek  1</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">PGUP add chapter 1                     # skip to next chapter</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">PGDWN add chapter -1                   # skip to previous chapter</span>
PGUP add chapter -1                     <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">skip to next chapter</span>
PGDWN add chapter 1                     <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">skip to previous chapter</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">Shift+PGUP seek 600</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">Shift+PGDWN seek -600</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">[ multiply speed 0.9091                # scale playback speed</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">] multiply speed 1.1</span>
<span style="font-weight: bold; font-style: italic; text-decoration: underline;">#</span><span style="font-weight: bold; font-style: italic;">{ multiply speed 0.5</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">} multiply speed 2.0</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">BS set speed 1.0                       # reset speed to normal</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">q quit</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">Q quit-watch-later</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">q {encode} quit 4</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">ESC set fullscreen no</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">ESC {encode} quit 4</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">p cycle pause                          # toggle pause/playback mode</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">. frame-step                           # advance one frame and pause</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">, frame-back-step                      # go back by one frame and pause</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">SPACE cycle pause</span>
? playlist-shuffle                      <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">skip to random file</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">&gt; playlist-next                        # skip to next file</span>
ENTER playlist-next                     <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">skip to next file</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">&lt; playlist-prev                        # skip to previous file</span>
Shift+ENTER playlist-prev               <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">skip to next file</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">O no-osd cycle-values osd-level 3 1    # cycle through OSD mode</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">o show-progress</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">P show-progress</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">I show-text "${filename}"              # display filename in osd</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">z add sub-delay -0.1                   # subtract 100 ms delay from subs</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">x add sub-delay +0.1                   # add</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">ctrl++ add audio-delay 0.100           # this changes audio/video sync</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">ctrl+- add audio-delay -0.100</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">9 add volume -2</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">/ add volume -2</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">0 add volume 2</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">* add volume 2</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">m cycle mute</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">1 add contrast -1</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">2 add contrast 1</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">3 add brightness -1</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">4 add brightness 1</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">5 add gamma -1</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">6 add gamma 1</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">7 add saturation -1</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">8 add saturation 1</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">Alt+0 set window-scale 0.5</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">Alt+1 set window-scale 1.0</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">Alt+2 set window-scale 2.0</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">toggle deinterlacer (automatically inserts or removes required filter)</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">d cycle deinterlace</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">r add sub-pos -1                       # move subtitles up</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">t add sub-pos +1                       #                down</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">v cycle sub-visibility</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">stretch SSA/ASS subtitles with anamorphic videos to match historical</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">V cycle sub-ass-vsfilter-aspect-compat</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">switch between applying no style overrides to SSA/ASS subtitles, and</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">overriding them almost completely with the normal subtitle style</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">u cycle-values sub-ass-style-override "force" "no"</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">j cycle sub                            # cycle through subtitles</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">J cycle sub down                       # ...backwards</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">SHARP cycle audio                      # switch audio streams</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">_ cycle video</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">T cycle ontop                          # toggle video window ontop of other windows</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">f cycle fullscreen                     # toggle fullscreen</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">s async screenshot                     # take a screenshot</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">S async screenshot video               # ...without subtitles</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">Ctrl+s async screenshot window         # ...with subtitles and OSD, and scaled</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">Alt+s screenshot each-frame            # automatically screenshot every frame</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">w add panscan -0.1                     # zoom out with -panscan 0 -fs</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">e add panscan +0.1                     #      in</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">cycle video aspect ratios; "-1" is the container aspect</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">A cycle-values video-aspect "16:9" "4:3" "2.35:1" "-1"</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">POWER quit</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">PLAY cycle pause</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">PAUSE cycle pause</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">PLAYPAUSE cycle pause</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">STOP quit</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">FORWARD seek 60</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">REWIND seek -60</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">NEXT playlist-next</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">PREV playlist-prev</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">VOLUME_UP add volume 2</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">VOLUME_DOWN add volume -2</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">MUTE cycle mute</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">CLOSE_WIN quit</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">CLOSE_WIN {encode} quit 4</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">E cycle edition                        # next edition</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">l ab-loop                              # Set/clear A-B loop points</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">L cycle-values loop-file "inf" "no"    # toggle infinite looping</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">ctrl+c quit 4</span>

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Apple Remote section</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">AR_PLAY cycle pause</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">AR_PLAY_HOLD quit</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">AR_CENTER cycle pause</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">AR_CENTER_HOLD quit</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">AR_NEXT seek 10</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">AR_NEXT_HOLD seek 120</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">AR_PREV seek -10</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">AR_PREV_HOLD seek -120</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">AR_MENU show-progress</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">AR_MENU_HOLD cycle mute</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">AR_VUP add volume 2</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">AR_VUP_HOLD add chapter 1</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">AR_VDOWN add volume -2</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">AR_VDOWN_HOLD add chapter -1</span>

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">For tv://</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">h cycle tv-channel -1                  # previous channel</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">k cycle tv-channel +1                  # next channel</span>

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">For dvb://</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">H cycle dvb-channel-name -1            # previous channel</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">K cycle dvb-channel-name +1            # next channel</span>

<span style="font-weight: bold; font-style: italic;">#</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Legacy bindings (may or may not be removed in the future)</span>
<span style="font-weight: bold; font-style: italic;">#</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">! add chapter -1                       # skip to previous chapter</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">@ add chapter 1                        #         next</span>

<span style="font-weight: bold; font-style: italic;">#</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Not assigned by default</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">(not an exhaustive list of unbound commands)</span>
<span style="font-weight: bold; font-style: italic;">#</span>

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">? add sub-scale +0.1                  # increase subtitle font size</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">? add sub-scale -0.1                  # decrease subtitle font size</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">? sub-step -1                         # immediately display next subtitle</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">? sub-step +1                         #                     previous</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">? cycle angle                         # switch DVD/Bluray angle</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">? add balance -0.1                    # adjust audio balance in favor of left</span>
Z add balance -0.1                    <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">adjust audio balance in favor of left</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">? add balance 0.1                     #                                  right</span>
X add balance 0.1                     <span style="font-weight: bold; font-style: italic;">#                                  </span><span style="font-weight: bold; font-style: italic;">right</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">? cycle sub-forced-only               # toggle DVD forced subs</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">? cycle program                       # cycle transport stream programs</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">? stop                                # stop playback (quit or enter idle mode)</span>
</pre>
</div></li>
<li><p>
scripts
</p>
<div class="org-src-container">
<pre class="src src-lua">local utils = require "mp.utils"

del_list = {}

function contains_item(l, i)
   for k, v in pairs(l) do
      if v == i then
         mp.osd_message("undeleting current file")
         l[k] = nil
         return true
      end
   end
   mp.osd_message("deleting current file")
   return false
end

function mark_delete()
   local work_dir = mp.get_property_native("working-directory")
   local file_path = mp.get_property_native("path")
   local s = file_path:find(work_dir, 0, true)
   local final_path
   if s and s == 0 then
      final_path = file_path
   else
      final_path = utils.join_path(work_dir, file_path)
   end
   if not contains_item(del_list, final_path) then
      table.insert(del_list, final_path)
   end
end

function delete(e)
   if e.reason == "quit" then
      for i, v in pairs(del_list) do
         print("deleting: "..v)
         os.remove(v)
      end
   end
end

mp.add_key_binding("ctrl+DEL", "delete_file", mark_delete)
mp.register_event("end-file", delete)
</pre>
</div></li>
</ul>
</div>
</div>

<div id="outline-container-orgf2c5a2e" class="outline-3">
<h3 id="orgf2c5a2e">unison</h3>
<div class="outline-text-3" id="text-orgf2c5a2e">
<ul class="org-ul">
<li><p>
music directory syncing
</p>
<div class="org-src-container">
<pre class="src src-conf"><span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Roots of the synchronization</span>
<span style="font-weight: bold; font-style: italic;">root</span> = &lt;&lt;home-dir()&gt;&gt;/mnt/ruizu/Music
<span style="font-weight: bold; font-style: italic;">root</span> = &lt;&lt;home-dir()&gt;&gt;/Audio

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Paths to synchronize</span>
<span style="font-weight: bold; font-style: italic;">path</span> = .

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Ruizu's file system is FAT</span>
<span style="font-weight: bold; font-style: italic;">fat</span> = true

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Overwrite by newer file on confliction</span>
<span style="font-weight: bold; font-style: italic;">prefer</span> = newer

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Show nothing</span>
<span style="font-weight: bold; font-style: italic;">silent</span> = true
<span style="font-weight: bold; font-style: italic;">confirmbigdel</span> = false

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Do fast checking</span>
<span style="font-weight: bold; font-style: italic;">fastcheck</span> = true

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Log settings</span>
<span style="font-weight: bold; font-style: italic;">log</span> = true
<span style="font-weight: bold; font-style: italic;">logfile</span> = &lt;&lt;home-dir()&gt;&gt;/.local/state/log/log/unison/music.log

</pre>
</div></li>
<li><p>
doc directory backup
</p>
<div class="org-src-container">
<pre class="src src-conf"><span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Roots of the synchronization</span>
<span style="font-weight: bold; font-style: italic;">root</span> = &lt;&lt;home-dir()&gt;&gt;/mnt/ns01
<span style="font-weight: bold; font-style: italic;">root</span> = &lt;&lt;home-dir()&gt;&gt;

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Paths to synchronize</span>
<span style="font-weight: bold; font-style: italic;">path</span> = doc

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Overwrite by newer file on confliction</span>
<span style="font-weight: bold; font-style: italic;">prefer</span> = newer

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Use this command for displaying diffs</span>
<span style="font-weight: bold; font-style: italic;">diff</span> = diff -y -W 79 --suppress-common-lines

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Write down synchronization activity on log file rather than show in stdout</span>
<span style="font-weight: bold; font-style: italic;">auto</span> = true
<span style="font-weight: bold; font-style: italic;">confirmbigdel</span> = false
<span style="font-weight: bold; font-style: italic;">silent</span> = true
<span style="font-weight: bold; font-style: italic;">log</span> = true
<span style="font-weight: bold; font-style: italic;">logfile</span> = &lt;&lt;home-dir()&gt;&gt;/.local/state/log/unison/doc.log

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Use inode number to verify identity rather than ckeck whole byte sequence</span>
<span style="font-weight: bold; font-style: italic;">fastcheck</span> = true

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Abort if device is not mounted</span>
<span style="font-weight: bold; font-style: italic;">mountpoint</span> = doc
</pre>
</div></li>
</ul>
</div>
</div>
<div id="outline-container-orgf912610" class="outline-3">
<h3 id="orgf912610">Aspell</h3>
<div class="outline-text-3" id="text-orgf912610">
<p>
aspell - interactive spell checker
</p>
<div class="org-src-container">
<pre class="src src-conf">lang en_US
</pre>
</div>
</div>
</div>
<div id="outline-container-orgc787e56" class="outline-3">
<h3 id="orgc787e56"><a id="ID-decef153-596d-4821-996e-53cfafe83c8f"></a>textlint</h3>
<div class="outline-text-3" id="text-orgc787e56">
<div class="org-src-container">
<pre class="src src-conf">install-textlint
</pre>
</div>

<div class="org-src-container">
<pre class="src src-shell">npm install -g <span style="font-style: italic;">\</span>
  textlint <span style="font-style: italic;">\</span>
  @textlint/ast-node-types <span style="font-style: italic;">\</span>
  textlint-rule-preset-ja-spacing <span style="font-style: italic;">\</span>
  textlint-rule-preset-ja-technical-writing <span style="font-style: italic;">\</span>
  textlint-rule-spellcheck-tech-word <span style="font-style: italic;">\</span>
  textlint-rule-ginger <span style="font-style: italic;">\</span>
  textlint-rule-write-good <span style="font-style: italic;">\</span>
  textlint-filter-rule-node-types <span style="font-style: italic;">\</span>
  textlint-plugin-org <span style="font-style: italic;">\</span>
  traverse
</pre>
</div>

<ul class="org-ul">
<li><p>
config for English
</p>
<div class="org-src-container">
<pre class="src src-json">{
  "rules": {
    "ginger": true,
    "write-good": true,
  }
}
</pre>
</div></li>

<li><p>
config for Japanese
</p>
<div class="org-src-container">
<pre class="src src-json">{
    "rules": {
        "preset-ja-technical-writing": {
            "no-exclamation-question-mark": false,
            "sentence-length": {
                "max": 200
            }
        },
        "spellcheck-tech-word": true,
        "textlint-rule-ginger": {
            "skipPatterns": [
                "`(.*)`"
            ]
        },
        "textlint-rule-write-good": true,
        "preset-ja-spacing": true
    }
}
</pre>
</div></li>
</ul>
</div>
</div>

<div id="outline-container-orge5fb78e" class="outline-3">
<h3 id="orge5fb78e">xkeysnail</h3>
<div class="outline-text-3" id="text-orge5fb78e">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"xkeysnail"</span>
</pre>
</div>

<ul class="org-ul">
<li><p>
config.py
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">-*- coding: utf-8 -*-</span>

<span style="font-weight: bold;">import</span> re
<span style="font-weight: bold;">from</span> xkeysnail.transform <span style="font-weight: bold;">import</span> *

define_multipurpose_modmap({
    <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">SandS</span>
    Key.SPACE: [Key.SPACE, Key.LEFT_SHIFT],

    <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Enter is enter when pressed and released. Control when held down.</span>
    Key.ENTER: [Key.ENTER, Key.RIGHT_CTRL],

    Key.LEFT_SHIFT: [Key.EQUAL, Key.LEFT_SHIFT],
    Key.RIGHT_SHIFT: [Key.MINUS, Key.RIGHT_SHIFT],
})

define_modmap({
    Key.LEFT_CTRL: Key.CAPSLOCK,
    Key.CAPSLOCK: Key.LEFT_CTRL,
    Key.SYSRQ: Key.RIGHT_META,
})

define_keymap(<span style="font-weight: bold; text-decoration: underline;">None</span>, {
    K(<span style="font-style: italic;">"C-Shift-a"</span>): K(<span style="font-style: italic;">"KEY_1"</span>),
    K(<span style="font-style: italic;">"C-Shift-s"</span>): K(<span style="font-style: italic;">"KEY_2"</span>),
    K(<span style="font-style: italic;">"C-Shift-d"</span>): K(<span style="font-style: italic;">"KEY_3"</span>),
    K(<span style="font-style: italic;">"C-Shift-f"</span>): K(<span style="font-style: italic;">"KEY_4"</span>),
    K(<span style="font-style: italic;">"C-Shift-g"</span>): K(<span style="font-style: italic;">"KEY_5"</span>),
    K(<span style="font-style: italic;">"C-Shift-h"</span>): K(<span style="font-style: italic;">"KEY_6"</span>),
    K(<span style="font-style: italic;">"C-Shift-j"</span>): K(<span style="font-style: italic;">"KEY_7"</span>),
    K(<span style="font-style: italic;">"C-Shift-k"</span>): K(<span style="font-style: italic;">"KEY_8"</span>),
    K(<span style="font-style: italic;">"C-Shift-l"</span>): K(<span style="font-style: italic;">"KEY_9"</span>),
    K(<span style="font-style: italic;">"C-Shift-semicolon"</span>): K(<span style="font-style: italic;">"KEY_0"</span>),
})


<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;"># [Conditional modmap] Change modifier keys in certain applications</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">define_conditional_modmap(re.compile(r'Emacs'), {</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;">Key.RIGHT_CTRL: Key.ESC,</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">})</span>

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;"># [Multipurpose modmap] Give a key two meanings. A normal key when pressed and</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;"># released, and a modifier key when held down with another key. See Xcape,</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;"># Carabiner and caps2esc for ideas and concept.</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">define_multipurpose_modmap(</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;"># Enter is enter when pressed and released. Control when held down.</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;">{Key.ENTER: [Key.ENTER, Key.RIGHT_CTRL]}</span>

<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;"># Capslock is escape when pressed and released. Control when held down.</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;"># {Key.CAPSLOCK: [Key.ESC, Key.LEFT_CTRL]</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;"># To use this example, you can't remap capslock with define_modmap.</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">)</span>


<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;"># Keybindings for Firefox/Chrome</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">define_keymap(re.compile("Firefox|Google-chrome"), {</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;"># Ctrl+Alt+j/k to switch next/previous tab</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;">K("C-M-j"): K("C-TAB"),</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;">K("C-M-k"): K("C-Shift-TAB"),</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;"># Type C-j to focus to the content</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;">K("C-j"): K("C-f6"),</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;"># very naive "Edit in editor" feature (just an example)</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;">K("C-o"): [K("C-a"), K("C-c"), launch(["gedit"]), sleep(0.5), K("C-v")]</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">}, "Firefox and Chrome")</span>

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;"># Keybindings for Zeal https://github.com/zealdocs/zeal/</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">define_keymap(re.compile("Zeal"), {</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;"># Ctrl+s to focus search area</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;">K("C-s"): K("C-k"),</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">}, "Zeal")</span>

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;"># Emacs-like keybindings in non-Emacs applications</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">define_keymap(lambda wm_class: wm_class not in ("Emacs", "URxvt"), {</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;"># Cursor</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;">K("C-b"): with_mark(K("left")),</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;">K("C-f"): with_mark(K("right")),</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;">K("C-p"): with_mark(K("up")),</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;">K("C-n"): with_mark(K("down")),</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;">K("C-h"): with_mark(K("backspace")),</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;"># Forward/Backward word</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;">K("M-b"): with_mark(K("C-left")),</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;">K("M-f"): with_mark(K("C-right")),</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;"># Beginning/End of line</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;">K("C-a"): with_mark(K("home")),</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;">K("C-e"): with_mark(K("end")),</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;"># Page up/down</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;">K("M-v"): with_mark(K("page_up")),</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;">K("C-v"): with_mark(K("page_down")),</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;"># Beginning/End of file</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;">K("M-Shift-comma"): with_mark(K("C-home")),</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;">K("M-Shift-dot"): with_mark(K("C-end")),</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;"># Newline</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;">K("C-m"): K("enter"),</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;">K("C-j"): K("enter"),</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;">K("C-o"): [K("enter"), K("left")],</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;"># Copy</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;">K("C-w"): [K("C-x"), set_mark(False)],</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;">K("M-w"): [K("C-c"), set_mark(False)],</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;">K("C-y"): [K("C-v"), set_mark(False)],</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;"># Delete</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;">K("C-d"): [K("delete"), set_mark(False)],</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;">K("M-d"): [K("C-delete"), set_mark(False)],</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;"># Kill line</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;">K("C-k"): [K("Shift-end"), K("C-x"), set_mark(False)],</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;"># Undo</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;">K("C-slash"): [K("C-z"), set_mark(False)],</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;">K("C-Shift-ro"): K("C-z"),</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;"># Mark</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;">K("C-space"): set_mark(True),</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;">K("C-M-space"): with_or_set_mark(K("C-right")),</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;"># Search</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;">K("C-s"): K("F3"),</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;">K("C-r"): K("Shift-F3"),</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;">K("M-Shift-key_5"): K("C-h"),</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;"># Cancel</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;">K("C-g"): [K("esc"), set_mark(False)],</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;"># Escape</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;">K("C-q"): escape_next_key,</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;"># C-x YYY</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;">K("C-x"): {</span>
<span style="font-weight: bold; font-style: italic;">#         </span><span style="font-weight: bold; font-style: italic;"># C-x h (select all)</span>
<span style="font-weight: bold; font-style: italic;">#         </span><span style="font-weight: bold; font-style: italic;">K("h"): [K("C-home"), K("C-a"), set_mark(True)],</span>
<span style="font-weight: bold; font-style: italic;">#         </span><span style="font-weight: bold; font-style: italic;"># C-x C-f (open)</span>
<span style="font-weight: bold; font-style: italic;">#         </span><span style="font-weight: bold; font-style: italic;">K("C-f"): K("C-o"),</span>
<span style="font-weight: bold; font-style: italic;">#         </span><span style="font-weight: bold; font-style: italic;"># C-x C-s (save)</span>
<span style="font-weight: bold; font-style: italic;">#         </span><span style="font-weight: bold; font-style: italic;">K("C-s"): K("C-s"),</span>
<span style="font-weight: bold; font-style: italic;">#         </span><span style="font-weight: bold; font-style: italic;"># C-x k (kill tab)</span>
<span style="font-weight: bold; font-style: italic;">#         </span><span style="font-weight: bold; font-style: italic;">K("k"): K("C-f4"),</span>
<span style="font-weight: bold; font-style: italic;">#         </span><span style="font-weight: bold; font-style: italic;"># C-x C-c (exit)</span>
<span style="font-weight: bold; font-style: italic;">#         </span><span style="font-weight: bold; font-style: italic;">K("C-c"): K("C-q"),</span>
<span style="font-weight: bold; font-style: italic;">#         </span><span style="font-weight: bold; font-style: italic;"># cancel</span>
<span style="font-weight: bold; font-style: italic;">#         </span><span style="font-weight: bold; font-style: italic;">K("C-g"): pass_through_key,</span>
<span style="font-weight: bold; font-style: italic;">#         </span><span style="font-weight: bold; font-style: italic;"># C-x u (undo)</span>
<span style="font-weight: bold; font-style: italic;">#         </span><span style="font-weight: bold; font-style: italic;">K("u"): [K("C-z"), set_mark(False)],</span>
<span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;">}</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">}, "Emacs-like keys")</span>
</pre>
</div></li>
<li><p>
xkeysnail.service
</p>

<div class="org-src-container">
<pre class="src src-conf">systemctl --user enable xkeysnail
systemctl --user start xkeysnail
</pre>
</div>

<div class="org-src-container">
<pre class="src src-conf">[<span style="font-weight: bold; text-decoration: underline;">Unit</span>]
<span style="font-weight: bold; font-style: italic;">Description</span>=xkeysnail

[<span style="font-weight: bold; text-decoration: underline;">Service</span>]
<span style="font-weight: bold; font-style: italic;">KillMode</span>=process
<span style="font-weight: bold; font-style: italic;">ExecStart</span>=/bin/bash -ic <span style="font-style: italic;">'pwsudo xkeysnail --watch --quiet %h/.config/xkeysnail/config.py'</span>
<span style="font-weight: bold; font-style: italic;">Type</span>=simple
<span style="font-weight: bold; font-style: italic;">Restart</span>=always
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Update DISPLAY to be the same as `echo $DISPLAY` on your graphical terminal.</span>
<span style="font-weight: bold; font-style: italic;">Environment</span>=DISPLAY=:0

[<span style="font-weight: bold; text-decoration: underline;">Install</span>]
<span style="font-weight: bold; font-style: italic;">WantedBy</span>=default.target
</pre>
</div></li>
</ul>
</div>
</div>

<div id="outline-container-org949dd4a" class="outline-3">
<h3 id="org949dd4a">SKK</h3>
<div class="outline-text-3" id="text-org949dd4a">
<p>
SKK is Simple Kana to Kanji conversion program, an input method of Japanese.
</p>

<ul class="org-ul">
<li>TODO: following programs have no guix package.
It is better to write my own one for my reproducible system.
<ul class="org-ul">
<li class="off"><code>[&#xa0;]</code> <a href="https://github.com/skk-dev/skktools">skktools</a></li>
<li class="off"><code>[&#xa0;]</code> ibus-skk</li>
</ul></li>
</ul>
</div>

<div id="outline-container-orgd99163b" class="outline-4">
<h4 id="orgd99163b">derive unique entries in user-jisyo</h4>
<div class="outline-text-4" id="text-orgd99163b">
<div class="org-src-container">
<pre class="src src-shell"><span style="font-weight: bold; font-style: italic;">tmp_euc</span>=$(mktemp)
<span style="font-weight: bold; font-style: italic;">tmp_utf8</span>=$(mktemp)
<span style="font-weight: bold; font-style: italic;">skk_dir</span>=&lt;&lt;share-dir()&gt;&gt;/skk
<span style="font-weight: bold;">skk_get_dir=${skk_dir}/get-jisyo</span>
<span style="font-weight: bold;">dic_orig=${skk_dir}/jisyo</span>
<span style="font-weight: bold;">dic_uniq=${skk_dir}/jisyo.uniq</span>

<span style="font-weight: bold;">skkdic-expr2 ${skk_get_dir}/SKK-JISYO.* &gt; ${tmp_euc}</span>
<span style="font-weight: bold;">nkf -w -Lu ${tmp_euc} &gt; ${tmp_utf8}</span>
<span style="font-weight: bold;">skkdic-expr2 ${dic_orig} - ${tmp_utf8} &gt; ${dic_uniq}</span>

<span style="font-weight: bold;">rm -f ${tmp_euc}</span>
<span style="font-weight: bold;">rm -f ${tmp_utf8}</span>

<span style="font-weight: bold;">echo ${dic_uniq}</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org8844e7e" class="outline-3">
<h3 id="org8844e7e"><a id="ID-379230e4-dec0-4f96-becf-7d62159ff598"></a>Festival</h3>
<div class="outline-text-3" id="text-org8844e7e">
<p>
<a href="http://festvox.org/festival/">Festival</a> is a framework for building and manipulating speech synthesis engine.
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"festival"</span>
</pre>
</div>

<ul class="org-ul">
<li><p>
configuration
</p>
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">-*- mode:scheme; -*-</span>
(Parameter.set 'Audio_Required_Format 'aiff)
(Parameter.set 'Audio_Method 'Audio_Command)
(Parameter.set 'Audio_Command <span style="font-style: italic;">"paplay $FILE --client-name=Festival --stream-name=Speech"</span>)

<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">add SLT voice and use it as a default one</span>
(voice-location 'cmu_us_slt_cg
                (path-as-directory <span style="font-style: italic;">"&lt;&lt;home-dir()&gt;&gt;/.local/share/festival/lib/voices/us/cmu_us_slt_cg"</span>)
                <span style="font-style: italic;">"English American Female"</span>)
(set! voice_default voice_cmu_us_slt_cg)
</pre>
</div></li>
<li><p>
a script to download voices
</p>

<div class="org-src-container">
<pre class="src src-conf">download-festival-voices
</pre>
</div>

<div class="org-src-container">
<pre class="src src-shell"><span style="font-weight: bold; font-style: italic;">work_dir</span>=~/.local/share/festival
<span style="font-weight: bold; font-style: italic;">voices</span>=(
  cmu_us_aew_cg
  cmu_us_rxr_cg
  cmu_us_slt_cg
)

<span style="font-weight: bold;">if</span> [ ! -d <span style="font-style: italic;">"${work_dir}"</span> ]; <span style="font-weight: bold;">then</span>
  mkdir -p <span style="font-style: italic;">"${work_dir}"</span>
<span style="font-weight: bold;">fi</span>

<span style="font-weight: bold;">cd</span> <span style="font-style: italic;">"${work_dir}"</span>
<span style="font-weight: bold;">for</span> voice<span style="font-weight: bold;"> in</span> <span style="font-style: italic;">"${voices[@]}"</span>; <span style="font-weight: bold;">do</span>
  <span style="font-weight: bold; font-style: italic;">voice_pack_file</span>=festvox_${<span style="font-weight: bold; font-style: italic;">voice</span>}.tar.gz
  <span style="font-weight: bold;">if</span> [ ! -e ${<span style="font-weight: bold; font-style: italic;">voice_pack_file</span>} ]; <span style="font-weight: bold;">then</span>
    wget -c http://festvox.org/packed/festival/2.5/voices/${<span style="font-weight: bold; font-style: italic;">voice_pack_file</span>}
    tar zxf <span style="font-style: italic;">"${voice_pack_file}"</span> -C ../../share
  <span style="font-weight: bold;">fi</span>
<span style="font-weight: bold;">done</span>

<span style="font-weight: bold;">echo</span> <span style="font-style: italic;">"${work_dir}"</span>
</pre>
</div></li>
<li><p>
festival.el
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package festival
  <span style="font-weight: bold;">:config</span>
  (say-minor-mode 1)
  (<span style="font-weight: bold;">setq</span> festival-tmp-file (make-temp-file <span style="font-style: italic;">"festival-"</span>)))
</pre>
</div></li>
</ul>
</div>
</div>
<div id="outline-container-orgac320d5" class="outline-3">
<h3 id="orgac320d5"><a id="ID-ce99b0cf-dd07-4b9e-86b3-b492a8cfb354"></a>Open JTalk</h3>
<div class="outline-text-3" id="text-orgac320d5">
<div class="org-src-container">
<pre class="src src-emacs-lisp" id="org3e32b77">(expand-file-name <span style="font-style: italic;">"~/.local/share/hts-voice"</span>)
</pre>
</div>

<ul class="org-ul">
<li><p>
install on Ubuntu
</p>
<div class="org-src-container">
<pre class="src src-shell">open-jtalk open-jtalk-mecab-naist-jdic hts-voice-nitech-jp-atr503-m001
</pre>
</div></li>
<li><p>
download hts voices
</p>

<div class="org-src-container">
<pre class="src src-conf">download-hts-voices
</pre>
</div>

<div class="org-src-container">
<pre class="src src-shell"><span style="font-weight: bold; font-style: italic;">data_dir</span>=&lt;&lt;hts-voice-dir()&gt;&gt;

<span style="font-weight: bold;">if [ ! -d "${data_dir}" ]; then</span>
<span style="font-weight: bold;">  mkdir -p "${data_dir}"</span>
<span style="font-weight: bold;">fi</span>

<span style="font-weight: bold;">curl -sL http://sourceforge.net/projects/mmdagent/files/MMDAgent_Example/MMDAgent_Example-1.8/MMDAgent_Example-1.8.zip \</span>
<span style="font-weight: bold;">  | busybox unzip -o -d ${data_dir} - \</span>
<span style="font-weight: bold;">  &amp;&amp; ln -sfv ${data_dir}/MMDAgent_Example-1.8/Voice ${data_dir}/</span>
</pre>
</div></li>
</ul>
</div>
</div>

<div id="outline-container-org8637013" class="outline-3">
<h3 id="org8637013">Jack</h3>
<div class="outline-text-3" id="text-org8637013">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"qjackctl"</span>
<span style="font-style: italic;">"qsynth"</span>
<span style="font-style: italic;">"jack-keyboard"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-conf">/usr/bin/jackd -dalsa -dhw:0 -r44100 -p1024 -n3 -Xseq
</pre>
</div>
</div>
</div>

<div id="outline-container-org3acfb56" class="outline-3">
<h3 id="org3acfb56">XRandR</h3>
<div class="outline-text-3" id="text-org3acfb56">
<p>
XRandR is a command line utility for changing display options without restarting X server.
</p>

<p>
<a href="https://wiki.archlinux.org/title/xrandr">xrandr - ArchWiki</a>
</p>

<ul class="org-ul">
<li><p>
show avaulable modes for all displays
</p>
<div class="org-src-container">
<pre class="src src-shell">xrandr
</pre>
</div></li>

<li><p>
change mode (resolution) to 1920x1080 for a display identified as "HDMI-2"
</p>
<div class="org-src-container">
<pre class="src src-shell">xrandr --output HDMI-2 --mode 1920x1080
</pre>
</div></li>

<li><p>
change mode back to preferred (maximum)
</p>
<div class="org-src-container">
<pre class="src src-shell">xrandr --output HDMI-2 --auto
</pre>
</div></li>
</ul>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"xrandr"</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org3e6d30f" class="outline-3">
<h3 id="org3e6d30f"><a id="ID-9ac77d59-90bd-4054-89c9-dcab29bd7462"></a>C/Migemo</h3>
<div class="outline-text-3" id="text-org3e6d30f">
<p>
<a href="https://github.com/koron/cmigemo">C/Migemo</a> allows me to search Japanese with incremental ASCII charactor input.
</p>

<div class="org-src-container">
<pre class="src src-shell">cmigemo
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-style: italic;">"https://github.com/koron/cmigemo/releases.atom"</span> soft_update)
</pre>
</div>

<p>
If you are AZIK lover, replace /usr/share/cmigemo/utf-8/roma2hira.dat with the content below to activate AZIK key assign in migemo.
</p>

<div class="org-src-container">
<pre class="src src-shell"><span style="font-weight: bold; font-style: italic;">MIGEMO_DAT_SYSTEM_DIR</span>=/usr/share/cmigemo/utf-8
<span style="font-weight: bold; font-style: italic;">MIGEMO_DAT_LOCAL_DIR</span>=~/.local/share/cmigemo/utf-8
<span style="font-weight: bold; font-style: italic;">ROMA_2_HIRA</span>=roma2hira.dat

<span style="font-weight: bold;">if</span> [ -f <span style="font-style: italic;">"${MIGEMO_DAT_SYSTEM_DIR}/${ROMA_2_HIRA}"</span> ]; <span style="font-weight: bold;">then</span>
  (
    <span style="font-weight: bold;">cd</span> <span style="font-style: italic;">"${MIGEMO_DAT_SYSTEM_DIR}"</span> <span style="font-style: italic;">\</span>
       &amp;&amp; sudo mv ${<span style="font-weight: bold; font-style: italic;">ROMA_2_HIRA</span>} ${<span style="font-weight: bold; font-style: italic;">ROMA_2_HIRA</span>}.orig
  )
<span style="font-weight: bold;">fi</span>
<span style="font-weight: bold;">if</span> [ -h <span style="font-style: italic;">"${MIGEMO_DAT_SYSTEM_DIR}/${ROMA_2_HIRA}"</span> ]; <span style="font-weight: bold;">then</span>
  sudo unlink <span style="font-style: italic;">"${MIGEMO_DAT_SYSTEM_DIR}/${ROMA_2_HIRA}"</span>
<span style="font-weight: bold;">fi</span>
sudo ln -s <span style="font-style: italic;">"${MIGEMO_DAT_LOCAL_DIR}/${ROMA_2_HIRA}"</span> ${<span style="font-weight: bold; font-style: italic;">MIGEMO_DAT_SYSTEM_DIR</span>}
</pre>
</div>

<div class="org-src-container">
<pre class="src src-text"># vi:set ts=8 sts=8 sw=8 tw=0:
#
# roma2hira.dat - &#12525;&#12540;&#12510;&#23383;&#8594;&#24179;&#20206;&#21517;&#22793;&#25563;&#34920;
#
# Last Change: 18-Oct-2003.
# Written By:  Muraoka Taro  <a href="mailto:koron%40tka.att.ne.jp">&lt;koron@tka.att.ne.jp&gt;</a>

# &#12371;&#12356;&#12388;&#12434;&#12459;&#12473;&#12479;&#12510;&#12452;&#12474;&#12377;&#12427;&#12371;&#12392;&#12391;&#12525;&#12540;&#12510;&#23383;&#12398;&#20837;&#21147;&#26041;&#24335;&#12364;&#22793;&#12431;&#12426;&#12414;&#12377;&#12290;
# &#29694;&#22312;&#12399;MS-IME2000&#12434;&#21442;&#32771;&#12395;&#27770;&#23450;&#12375;&#12390;&#12356;&#12414;&#12377;&#12290;
# &#28450;&#23383;&#12467;&#12540;&#12489;&#12398;&#36949;&#12356;&#12434;&#21560;&#21454;&#12377;&#12427;&#24441;&#21106;&#12418;&#26524;&#12383;&#12375;&#12414;&#12377;&#12290;
# xn&#12392;xtu&#12395;&#12399;&#12300;&#12435;&#12301;&#12392;&#12300;&#12387;&#12301;&#12434;&#25351;&#23450;&#12377;&#12427;&#24441;&#21106;&#12364;&#12354;&#12426;&#12414;&#12377;&#12290;
# {from} {to}&#12398;&#24418;&#24335;&#12391;&#12377;&#12290;
# &#29694;&#22312;&#12399;{from}&#12399;&#26368;&#22823;7&#12496;&#12452;&#12488;&#12414;&#12391;{to}&#12399;6&#12496;&#12452;&#12488;&#12414;&#12391;&#12392;&#12394;&#12387;&#12390;&#12356;&#12414;&#12377;&#12290;
# {from}&#12392;{to}&#12398;&#38291;&#12399;&#31354;&#30333;&#25991;&#23383;(isspace())&#12391;&#21306;&#20999;&#12426;&#12414;&#12377;&#12290;

# http://asiamoth.com/mt/archives/2006-08/05_2313.php

-       &#12540;
~       &#12316;
,       &#12289;
.       &#12290;
:       &#12540;
[       &#12300;
]       &#12301;
;       &#12387;
a       &#12354;
ba      &#12400;
bd      &#12409;&#12435;
be      &#12409;
bh      &#12406;&#12358;
bi      &#12403;
bj      &#12406;&#12435;
bk      &#12403;&#12435;
bl      &#12412;&#12435;
bn      &#12400;&#12435;
bo      &#12412;
bp      &#12412;&#12358;
bq      &#12400;&#12356;
bt      &#12403;&#12392;
bu      &#12406;
bv      &#12403;&#12421;&#12358;
bw      &#12409;&#12356;
bx      &#12403;&#12423;&#12358;
bya     &#12403;&#12419;
byj     &#12403;&#12421;&#12435;
byo     &#12403;&#12423;
byp     &#12403;&#12423;&#12358;
byu     &#12403;&#12421;
bz      &#12400;&#12435;
ca      &#12385;&#12419;
cd      &#12385;&#12359;&#12435;
ce      &#12385;&#12359;
cf      &#12385;&#12359;
ch      &#12385;&#12421;&#12358;
ci      &#12385;
cj      &#12385;&#12421;&#12435;
ck      &#12385;&#12435;
cl      &#12385;&#12423;&#12435;
cn      &#12385;&#12419;&#12435;
co      &#12385;&#12423;
cp      &#12385;&#12423;&#12358;
cq      &#12385;&#12419;&#12356;
cu      &#12385;&#12421;
cz      &#12385;&#12419;&#12435;
da      &#12384;
dch     &#12393;&#12357;&#12540;
dci     &#12391;&#12355;
dcj     &#12393;&#12357;&#12435;
dck     &#12391;&#12355;&#12435;
dcu     &#12393;&#12357;
dd      &#12391;&#12435;
de      &#12391;
df      &#12391;
dga     &#12386;&#12419;
dge     &#12386;&#12359;
dgj     &#12386;&#12421;&#12435;
dgl     &#12386;&#12423;&#12435;
dgo     &#12386;&#12423;
dgq     &#12386;&#12419;&#12356;
dgu     &#12386;&#12421;
dgz     &#12386;&#12419;&#12435;
dh      &#12389;&#12358;
di      &#12386;
dj      &#12389;&#12435;
dk      &#12386;&#12435;
dl      &#12393;&#12435;
dm      &#12391;&#12418;
dn      &#12384;&#12435;
do      &#12393;
dp      &#12393;&#12358;
dq      &#12384;&#12356;
dr      &#12391;&#12354;&#12427;
ds      &#12391;&#12377;
dt      &#12384;&#12385;
du      &#12389;
dv      &#12386;&#12421;&#12358;
dw      &#12391;&#12356;
dx      &#12386;&#12423;&#12358;
dya     &#12391;&#12419;
dyh     &#12391;&#12421;&#12540;
dyj     &#12391;&#12421;&#12435;
dyq     &#12391;&#12419;&#12356;
dyu     &#12391;&#12421;
dyz     &#12391;&#12419;&#12435;
dz      &#12384;&#12435;
e       &#12360;
fa      &#12405;&#12353;
fd      &#12405;&#12359;&#12435;
fe      &#12405;&#12359;
fh      &#12405;&#12358;
fi      &#12405;&#12355;
fj      &#12405;&#12435;
fk      &#12405;&#12355;&#12435;
fl      &#12405;&#12361;&#12435;
fn      &#12405;&#12353;&#12435;
fo      &#12405;&#12361;
fq      &#12405;&#12353;&#12356;
fu      &#12405;
fv      &#12405;&#12421;&#12540;
fw      &#12405;&#12359;&#12356;
fyh     &#12405;&#12421;&#12540;
fyj     &#12405;&#12421;&#12435;
fyu     &#12405;&#12421;
fz      &#12405;&#12353;&#12435;
ga      &#12364;
gd      &#12370;&#12435;
ge      &#12370;
gh      &#12368;&#12358;
gi      &#12366;
gj      &#12368;&#12435;
gk      &#12366;&#12435;
gl      &#12372;&#12435;
gn      &#12364;&#12435;
go      &#12372;
gp      &#12372;&#12358;
gq      &#12364;&#12356;
gr      &#12364;&#12425;
gt      &#12372;&#12392;
gu      &#12368;
gv      &#12366;&#12421;&#12358;
gw      &#12370;&#12356;
gx      &#12366;&#12423;&#12358;
gya     &#12366;&#12419;
gyh     &#12366;&#12421;&#12358;
gyj     &#12366;&#12421;&#12435;
gyl     &#12366;&#12423;&#12435;
gyo     &#12366;&#12423;
gyp     &#12366;&#12423;&#12358;
gyq     &#12366;&#12419;&#12356;
gyu     &#12366;&#12421;
gyz     &#12366;&#12419;&#12435;
gz      &#12364;&#12435;
ha      &#12399;
hd      &#12408;&#12435;
he      &#12408;
hf      &#12405;
hga     &#12402;&#12419;
hgd     &#12402;&#12359;&#12435;
hge     &#12402;&#12359;
hgh     &#12402;&#12421;&#12358;
hgj     &#12402;&#12421;&#12435;
hgl     &#12402;&#12423;&#12435;
hgn     &#12402;&#12419;&#12435;
hgo     &#12402;&#12423;
hgp     &#12402;&#12423;&#12358;
hgq     &#12402;&#12419;&#12356;
hgu     &#12402;&#12421;
hgz     &#12402;&#12419;&#12435;
hh      &#12405;&#12358;
hi      &#12402;
hj      &#12405;&#12435;
hk      &#12402;&#12435;
hl      &#12411;&#12435;
ho      &#12411;
hp      &#12411;&#12358;
hq      &#12399;&#12356;
ht      &#12402;&#12392;
hu      &#12405;
hv      &#12402;&#12421;&#12358;
hw      &#12408;&#12356;
hx      &#12402;&#12423;&#12358;
hya     &#12402;&#12419;
hyd     &#12402;&#12359;&#12435;
hye     &#12402;&#12359;
hyh     &#12402;&#12421;&#12358;
hyj     &#12402;&#12421;&#12435;
hyl     &#12402;&#12423;&#12435;
hyo     &#12402;&#12423;
hyp     &#12402;&#12423;&#12358;
hyq     &#12402;&#12419;&#12356;
hyu     &#12402;&#12421;
hyz     &#12402;&#12419;&#12435;
hz      &#12399;&#12435;
i       &#12356;
ja      &#12376;&#12419;
jd      &#12376;&#12359;&#12435;
je      &#12376;&#12359;
jf      &#12376;&#12421;
jh      &#12376;&#12421;&#12358;
ji      &#12376;
jj      &#12376;&#12421;&#12435;
jk      &#12376;&#12435;
jl      &#12376;&#12423;&#12435;
jo      &#12376;&#12423;
jp      &#12376;&#12423;&#12358;
jq      &#12376;&#12419;&#12356;
ju      &#12376;&#12421;
jw      &#12376;&#12359;&#12356;
jz      &#12376;&#12419;&#12435;
ka      &#12363;
kd      &#12369;&#12435;
ke      &#12369;
kf      &#12365;
kga     &#12365;&#12419;
kgh     &#12365;&#12421;&#12358;
kgj     &#12365;&#12421;&#12435;
kgl     &#12365;&#12423;&#12435;
kgn     &#12365;&#12419;&#12435;
kgo     &#12365;&#12423;
kgp     &#12365;&#12423;&#12358;
kgq     &#12365;&#12419;&#12356;
kgu     &#12365;&#12421;
kgz     &#12365;&#12419;&#12435;
kh      &#12367;&#12358;
ki      &#12365;
kj      &#12367;&#12435;
kk      &#12365;&#12435;
kl      &#12371;&#12435;
km      &#12363;&#12418;
kn      &#12363;&#12435;
ko      &#12371;
kp      &#12371;&#12358;
kq      &#12363;&#12356;
kr      &#12363;&#12425;
kt      &#12371;&#12392;
ku      &#12367;
kv      &#12365;&#12421;&#12358;
kw      &#12369;&#12356;
kx      &#12365;&#12423;&#12358;
kya     &#12365;&#12419;
kyh     &#12365;&#12421;&#12358;
kyj     &#12365;&#12421;&#12435;
kyl     &#12365;&#12423;&#12435;
kyo     &#12365;&#12423;
kyp     &#12365;&#12423;&#12358;
kyq     &#12365;&#12419;&#12356;
kyu     &#12365;&#12421;
kyz     &#12365;&#12419;&#12435;
kz      &#12363;&#12435;
la      &#12353;
le      &#12359;
li      &#12355;
lo      &#12361;
ltsu    &#12387;
ltu     &#12387;
lu      &#12357;
lwa     &#12430;
lya     &#12419;
lye     &#12359;
lyi     &#12355;
lyo     &#12423;
lyu     &#12421;
ma      &#12414;
md      &#12417;&#12435;
me      &#12417;
mf      &#12416;
mgn     &#12415;&#12419;&#12435;
mh      &#12416;&#12358;
mi      &#12415;
mj      &#12416;&#12435;
mk      &#12415;&#12435;
ml      &#12418;&#12435;
mn      &#12418;&#12398;
mo      &#12418;
mp      &#12418;&#12358;
mq      &#12414;&#12356;
ms      &#12414;&#12377;
mt      &#12414;&#12383;
mu      &#12416;
mv      &#12415;&#12421;&#12358;
mw      &#12417;&#12356;
mx      &#12415;&#12423;&#12358;
mya     &#12415;&#12419;
myh     &#12415;&#12421;&#12358;
myj     &#12415;&#12421;&#12435;
myl     &#12415;&#12423;&#12435;
myo     &#12415;&#12423;
myp     &#12415;&#12423;&#12358;
myq     &#12415;&#12419;&#12356;
myu     &#12415;&#12421;
myz     &#12415;&#12419;&#12435;
mz      &#12414;&#12435;
na      &#12394;
nb      &#12397;&#12400;
nd      &#12397;&#12435;
ne      &#12397;
nf      &#12396;
nga     &#12395;&#12419;
ngh     &#12395;&#12421;&#12358;
ngj     &#12395;&#12421;&#12435;
ngl     &#12395;&#12423;&#12435;
ngn     &#12395;&#12419;&#12435;
ngo     &#12395;&#12423;
ngp     &#12395;&#12423;&#12358;
ngq     &#12395;&#12419;&#12356;
ngu     &#12395;&#12421;
ngz     &#12395;&#12419;&#12435;
nh      &#12396;&#12358;
ni      &#12395;
nj      &#12396;&#12435;
nk      &#12395;&#12435;
nl      &#12398;&#12435;
nn      &#12435;
no      &#12398;
np      &#12398;&#12358;
nq      &#12394;&#12356;
nr      &#12394;&#12427;
nt      &#12395;&#12385;
nu      &#12396;
nv      &#12395;&#12421;&#12358;
nw      &#12397;&#12356;
nx      &#12395;&#12423;&#12358;
nya     &#12395;&#12419;
nyh     &#12395;&#12421;&#12358;
nyj     &#12395;&#12421;&#12435;
nyl     &#12395;&#12423;&#12435;
nyo     &#12395;&#12423;
nyp     &#12395;&#12423;&#12358;
nyq     &#12395;&#12419;&#12356;
nyu     &#12395;&#12421;
nyz     &#12395;&#12419;&#12435;
nz      &#12394;&#12435;
o       &#12362;
pa      &#12401;
pd      &#12410;&#12435;
pe      &#12410;
pf      &#12413;&#12435;
pga     &#12404;&#12419;
pgh     &#12404;&#12421;&#12358;
pgj     &#12404;&#12421;&#12435;
pgl     &#12404;&#12423;&#12435;
pgn     &#12404;&#12419;&#12435;
pgo     &#12404;&#12423;
pgp     &#12404;&#12423;&#12358;
pgq     &#12404;&#12419;&#12356;
pgu     &#12404;&#12421;
pgz     &#12404;&#12419;&#12435;
ph      &#12407;&#12358;
pi      &#12404;
pj      &#12407;&#12435;
pk      &#12404;&#12435;
pl      &#12413;&#12435;
po      &#12413;
pp      &#12413;&#12358;
pq      &#12401;&#12356;
pu      &#12407;
pv      &#12404;&#12421;&#12358;
pw      &#12410;&#12356;
px      &#12404;&#12423;&#12358;
pya     &#12404;&#12419;
pyh     &#12404;&#12421;&#12358;
pyj     &#12404;&#12421;&#12435;
pyl     &#12404;&#12423;&#12435;
pyo     &#12404;&#12423;
pyp     &#12404;&#12423;&#12358;
pyq     &#12404;&#12419;&#12356;
pyu     &#12404;&#12421;
pz      &#12401;&#12435;
q       &#12435;
ra      &#12425;
rd      &#12428;&#12435;
re      &#12428;
rh      &#12427;&#12358;
ri      &#12426;
rj      &#12427;&#12435;
rk      &#12426;&#12435;
rl      &#12429;&#12435;
rn      &#12425;&#12435;
ro      &#12429;
rp      &#12429;&#12358;
rq      &#12425;&#12356;
rr      &#12425;&#12428;
ru      &#12427;
rv      &#12426;&#12421;&#12358;
rw      &#12428;&#12356;
rx      &#12426;&#12423;&#12358;
rya     &#12426;&#12419;
ryh     &#12426;&#12421;&#12358;
ryj     &#12426;&#12421;&#12435;
ryl     &#12426;&#12423;&#12435;
ryo     &#12426;&#12423;
ryp     &#12426;&#12423;&#12358;
ryq     &#12426;&#12419;&#12356;
ryu     &#12426;&#12421;
ryz     &#12426;&#12419;&#12435;
rz      &#12425;&#12435;
sa      &#12373;
sd      &#12379;&#12435;
se      &#12379;
sf      &#12373;&#12356;
sh      &#12377;&#12358;
si      &#12375;
sj      &#12377;&#12435;
sk      &#12375;&#12435;
sl      &#12381;&#12435;
sn      &#12373;&#12435;
so      &#12381;
sp      &#12381;&#12358;
sq      &#12373;&#12356;
sr      &#12377;&#12427;
ss      &#12379;&#12356;
st      &#12375;&#12383;
su      &#12377;
sv      &#12375;&#12421;&#12358;
sw      &#12379;&#12356;
sx      &#12375;&#12423;&#12358;
syi     &#12377;&#12355;
syk     &#12377;&#12355;&#12435;
sz      &#12373;&#12435;
ta      &#12383;
tb      &#12383;&#12403;
td      &#12390;&#12435;
te      &#12390;
tgh     &#12392;&#12357;&#12540;
tgi     &#12390;&#12355;
tgj     &#12392;&#12357;&#12435;
tgk     &#12390;&#12355;&#12435;
tgu     &#12392;&#12357;
th      &#12388;&#12358;
ti      &#12385;
tj      &#12388;&#12435;
tk      &#12385;&#12435;
tl      &#12392;&#12435;
tm      &#12383;&#12417;
tn      &#12383;&#12435;
to      &#12392;
tp      &#12392;&#12358;
tq      &#12383;&#12356;
tr      &#12383;&#12425;
tsa     &#12388;&#12353;
tsd     &#12388;&#12359;&#12435;
tse     &#12388;&#12359;
tsh     &#12388;&#12358;
tsi     &#12388;&#12355;
tsj     &#12388;&#12435;
tsk     &#12388;&#12355;&#12435;
tsl     &#12388;&#12361;&#12435;
tso     &#12388;&#12361;
tsq     &#12388;&#12353;&#12356;
tst     &#12392;&#12375;&#12390;
tsu     &#12388;
tsz     &#12388;&#12353;&#12435;
tt      &#12383;&#12385;
tu      &#12388;
tw      &#12390;&#12356;
tya     &#12390;&#12419;
tyh     &#12390;&#12421;&#12540;
tyj     &#12390;&#12421;&#12435;
tyq     &#12390;&#12419;&#12356;
tyu     &#12390;&#12421;
tyz     &#12390;&#12419;&#12435;
tz      &#12383;&#12435;
u       &#12358;
va      &#12358;&#12443;&#12353;
vd      &#12358;&#12443;&#12359;&#12435;
ve      &#12358;&#12443;&#12359;
vh      &#12358;&#12443;&#12540;
vi      &#12358;&#12443;&#12355;
vj      &#12358;&#12443;&#12435;
vk      &#12358;&#12443;&#12355;&#12435;
vl      &#12358;&#12443;&#12361;&#12435;
vn      &#12358;&#12443;&#12353;&#12435;
vo      &#12358;&#12443;&#12361;
vp      &#12358;&#12443;&#12361;&#12358;
vq      &#12358;&#12443;&#12353;&#12356;
vu      &#12358;&#12443;
vv      &#12358;&#12443;&#12421;&#12540;
vw      &#12358;&#12443;&#12359;&#12356;
vyh     &#12358;&#12443;&#12421;&#12540;
vyj     &#12358;&#12443;&#12421;&#12435;
vyu     &#12358;&#12443;&#12421;
vz      &#12358;&#12443;&#12353;&#12435;
wa      &#12431;
wd      &#12358;&#12359;&#12435;
we      &#12358;&#12359;
wi      &#12358;&#12355;
wk      &#12358;&#12355;&#12435;
wl      &#12358;&#12361;&#12435;
wn      &#12431;&#12435;
wo      &#12434;
wp      &#12358;&#12361;&#12540;
wq      &#12431;&#12356;
wr      &#12431;&#12428;
wse     &#12433;
wsi     &#12432;
wso     &#12358;&#12361;
wt      &#12431;&#12383;
ww      &#12358;&#12359;&#12356;
wz      &#12431;&#12435;
xa      &#12375;&#12419;
xd      &#12375;&#12359;&#12435;
xe      &#12375;&#12359;
xh      &#12375;&#12421;&#12358;
xi      &#12375;
xj      &#12375;&#12421;&#12435;
xk      &#12375;&#12435;
xl      &#12375;&#12423;&#12435;
xn      &#12375;&#12419;&#12435;
xo      &#12375;&#12423;
xp      &#12375;&#12423;&#12358;
xq      &#12375;&#12419;&#12356;
xu      &#12375;&#12421;
xw      &#12375;&#12359;&#12356;
xz      &#12375;&#12419;&#12435;
ya      &#12420;
yd      &#12356;&#12359;&#12435;
ye      &#12356;&#12359;
yf      &#12422;
yh      &#12422;&#12358;
yj      &#12422;&#12435;
yl      &#12424;&#12435;
yo      &#12424;
yp      &#12424;&#12358;
yq      &#12420;&#12356;
yr      &#12424;&#12427;
yu      &#12422;
yw      &#12356;&#12359;&#12356;
yz      &#12420;&#12435;
za      &#12374;
zc      &#12374;
zd      &#12380;&#12435;
ze      &#12380;
zh      &#12378;&#12358;
zi      &#12376;
zj      &#12378;&#12435;
zk      &#12376;&#12435;
zl      &#12382;&#12435;
zn      &#12374;&#12435;
zo      &#12382;
zp      &#12382;&#12358;
zq      &#12374;&#12356;
zr      &#12374;&#12427;
zu      &#12378;
zv      &#12374;&#12356;
zw      &#12380;&#12356;
zx      &#12380;&#12356;
zyi     &#12378;&#12355;
zz      &#12374;&#12435;
</pre>
</div>
</div>
</div>
<div id="outline-container-org0af8d24" class="outline-3">
<h3 id="org0af8d24">LilyPond</h3>
<div class="outline-text-3" id="text-org0af8d24">
<p>
<a href="https://lilypond.org/unix.html">LilyPond</a> elisp package is included in source tarball available at <a href="https://lilypond.org/download/source">here</a>,
you are required to locate that package where emacs can search.
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"lilypond"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-style: italic;">"https://github.com/lilypond/lilypond/releases.atom"</span> soft_update)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package lilypond-mode
  <span style="font-weight: bold;">:delight</span> (LilyPond-mode <span style="font-style: italic;">" LP"</span>)
  <span style="font-weight: bold;">:mode</span> (<span style="font-style: italic;">"\\.ly$"</span> . LilyPond-mode)
  <span style="font-weight: bold;">:custom</span>
  (LilyPond-pdf-command <span style="font-style: italic;">"firefox"</span>)
  (LilyPond-midi-command <span style="font-style: italic;">"fluidsynth -a alsa -m alsa_seq -l"</span>))
</pre>
</div>
</div>
</div>
<div id="outline-container-org545657a" class="outline-3">
<h3 id="org545657a">Rsync</h3>
<div class="outline-text-3" id="text-org545657a">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"rsync"</span>
</pre>
</div>
</div>

<div id="outline-container-org6b21b40" class="outline-4">
<h4 id="org6b21b40">sync server data</h4>
<div class="outline-text-4" id="text-org6b21b40">
<div class="org-src-container">
<pre class="src src-conf">12 1 * * * /bin/bash -ci <span style="font-style: italic;">"sync_sv04 &gt;&gt; $LOG_DIR/sync_sv04.log 2&gt;&amp;1"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-shell">ssh -q -o <span style="font-weight: bold; font-style: italic;">BatchMode</span>=<span style="font-style: italic;">"yes"</span> -o <span style="font-weight: bold; font-style: italic;">ConnectTimeout</span>=10 sv04 <span style="font-style: italic;">"exit 0"</span> <span style="font-style: italic;">\</span>
  &amp;&amp; rsync -arhv sv04:~/var/backup &lt;&lt;share-dir()&gt;&gt;/sv04
</pre>
</div>
</div>
</div>

<div id="outline-container-org9ee7f74" class="outline-4">
<h4 id="org9ee7f74">backup script&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span></h4>
</div>
</div>
<div id="outline-container-orgd23c699" class="outline-3">
<h3 id="orgd23c699">libvirt</h3>
<div class="outline-text-3" id="text-orgd23c699">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"libvirt"</span>
<span style="font-style: italic;">"virt-manager"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-conf"><span style="font-weight: bold; font-style: italic;">uri_default</span> = <span style="font-style: italic;">"qemu:///system"</span>
</pre>
</div>

<ul class="org-ul">
<li><p>
how to set up local storage pool (named 'local')
</p>
<pre class="example">
$ virsh pool-define ~/.config/libvirt/pool.xml
$ virsh pool-autostart local
$ virsh pool-start local

</pre>

<div class="org-src-container">
<pre class="src src-xml">&lt;<span style="font-weight: bold;">pool</span> <span style="font-weight: bold; font-style: italic;">type</span>=<span style="font-style: italic;">'dir'</span>&gt;
  &lt;<span style="font-weight: bold;">name</span>&gt;local&lt;/<span style="font-weight: bold;">name</span>&gt;
  &lt;<span style="font-weight: bold;">source</span>&gt;
  &lt;/<span style="font-weight: bold;">source</span>&gt;
  &lt;<span style="font-weight: bold;">target</span>&gt;
    &lt;<span style="font-weight: bold;">path</span>&gt;&lt;&lt;<span style="font-weight: bold;">home-dir</span>()&gt;&gt;/media/libvirt/images&lt;/<span style="font-weight: bold;">path</span>&gt;
    &lt;<span style="font-weight: bold;">permissions</span>&gt;
      &lt;<span style="font-weight: bold;">mode</span>&gt;0711&lt;/<span style="font-weight: bold;">mode</span>&gt;
      &lt;<span style="font-weight: bold;">owner</span>&gt;0&lt;/<span style="font-weight: bold;">owner</span>&gt;
      &lt;<span style="font-weight: bold;">group</span>&gt;0&lt;/<span style="font-weight: bold;">group</span>&gt;
    &lt;/<span style="font-weight: bold;">permissions</span>&gt;
  &lt;/<span style="font-weight: bold;">target</span>&gt;
&lt;/<span style="font-weight: bold;">pool</span>&gt;
</pre>
</div></li>
</ul>
</div>
</div>
<div id="outline-container-org1f8e808" class="outline-3">
<h3 id="org1f8e808">Calibre</h3>
<div class="outline-text-3" id="text-org1f8e808">
<p>
<a href="https://calibre-ebook.com/download_linux">Calibre for linux</a> is a e-book reader. I use it in the mood of reading epub in GUI app.
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"calibre"</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org2b4cdaf" class="outline-3">
<h3 id="org2b4cdaf">yt-dlp</h3>
<div class="outline-text-3" id="text-org2b4cdaf">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"yt-dlp"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-conf">-o %(title)s.%(ext)s
--trim-filenames 80
</pre>
</div>
</div>
</div>

<div id="outline-container-orgbf4e530" class="outline-3">
<h3 id="orgbf4e530"><a id="ID-bdc987ad-419b-4f36-922d-de75207d85c0"></a>rTorrent</h3>
<div class="outline-text-3" id="text-orgbf4e530">
<p>
<a href="https://github.com/rakshasa/rtorrent/wiki">rTorrent</a> is a bittorrent client using ncurses.
</p>

<p>
As of now, rTorrent on guix does not support for XMLRPC. You need to install from another source, if you want rTorrent with RPC capability.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp" id="orga83e584">(expand-file-name <span style="font-style: italic;">"~/.local/share/rtorrent-rpc.socket"</span>)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-conf"><span style="font-weight: bold; font-style: italic;">network.scgi.open_local</span> = &lt;&lt;rtorrent-sock()&gt;&gt;
<span style="font-weight: bold; font-style: italic;">execute.nothrow</span> = chmod,770,&lt;&lt;rtorrent-sock()&gt;&gt;
<span style="font-weight: bold; font-style: italic;">encoding.add</span> = utf8
</pre>
</div>

<div class="org-src-container">
<pre class="src src-conf">systemctl --user enable rtorrent.service
systemctl --user start rtorrent.service
</pre>
</div>

<div class="org-src-container">
<pre class="src src-conf">[<span style="font-weight: bold; text-decoration: underline;">Unit</span>]
<span style="font-weight: bold; font-style: italic;">Description</span>=rTorrent
<span style="font-weight: bold; font-style: italic;">After</span>=network.target

[<span style="font-weight: bold; text-decoration: underline;">Service</span>]
<span style="font-weight: bold; font-style: italic;">Type</span>=simple
<span style="font-weight: bold; font-style: italic;">WorkingDirectory</span>=&lt;&lt;home-dir()&gt;&gt;/data/media/torrent
<span style="font-weight: bold; font-style: italic;">ExecStart</span>=/bin/bash -ic <span style="font-style: italic;">'rtorrent -o system.daemon.set=true'</span>
<span style="font-weight: bold; font-style: italic;">Restart</span>=on-failure
<span style="font-weight: bold; font-style: italic;">RestartSec</span>=3

[<span style="font-weight: bold; text-decoration: underline;">Install</span>]
<span style="font-weight: bold; font-style: italic;">WantedBy</span>=default.target
</pre>
</div>
</div>
</div>

<div id="outline-container-org2a61565" class="outline-3">
<h3 id="org2a61565">Ledger</h3>
<div class="outline-text-3" id="text-org2a61565">
<p>
<a href="https://www.ledger-cli.org/3.0/doc/ledger-mode.html">Ledger</a> is double-entry accounting cli tool. <a href="https://hledger.org/">hledger</a> is feature rich reimplementation of ledger in Haskell. User data in ledger is interoperable for hledger and vice versa.
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"ledger"</span>
<span style="font-style: italic;">"hledger"</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org36d9655" class="outline-3">
<h3 id="org36d9655">ripgrep-all</h3>
<div class="outline-text-3" id="text-org36d9655">
<p>
<a href="https://github.com/phiresky/ripgrep-all">ripgrep-all</a> or rga command enables to search media files such as pdf documents or epub files in grep-like way.
</p>

<div class="org-src-container">
<pre class="src src-shell"><span style="font-weight: bold; font-style: italic;">rga_url</span>=https://github.com/phiresky/ripgrep-all/releases/download/v0.9.6
<span style="font-weight: bold; font-style: italic;">rga_fname</span>=ripgrep_all-v0.9.6-x86_64-unknown-linux-musl.tar.gz
<span style="font-weight: bold; font-style: italic;">rga_workdir</span>=/tmp
<span style="font-weight: bold; font-style: italic;">rga_lbinpath</span>=&lt;&lt;home-dir()&gt;&gt;/.local/bin

<span style="font-weight: bold;">curl -sL "${rga_url}/${rga_fname}" | tar zxf - -C ${rga_workdir} \</span>
<span style="font-weight: bold;">  &amp;&amp; cp -fv ${rga_workdir}/${rga_fname%.tar.gz}/{rga,rga-preproc} ${rga_lbinpath}</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgfed704c" class="outline-2">
<h2 id="orgfed704c">Development Infrastructures</h2>
<div class="outline-text-2" id="text-orgfed704c">
</div>

<div id="outline-container-org78abf69" class="outline-3">
<h3 id="org78abf69">Python</h3>
<div class="outline-text-3" id="text-org78abf69">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"python"</span>
<span style="font-style: italic;">"python-sphinx"</span>
<span style="font-style: italic;">"python-lxml"</span>
<span style="font-style: italic;">"python-jedi"</span>
<span style="font-style: italic;">"python-send2trash"</span>
<span style="font-style: italic;">"python-matplotlib"</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org4717981" class="outline-3">
<h3 id="org4717981">Ruby</h3>
<div class="outline-text-3" id="text-org4717981">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"ruby"</span>
<span style="font-style: italic;">"ruby-pry"</span>
<span style="font-style: italic;">"ruby-rubocop"</span>
<span style="font-style: italic;">"ruby-thor"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-shell"><span style="font-weight: bold;">export</span> <span style="font-weight: bold; font-style: italic;">RUBYLIB</span>=${<span style="font-weight: bold; font-style: italic;">HOME</span>}/.local/lib
</pre>
</div>
</div>
</div>

<div id="outline-container-org4a6571a" class="outline-3">
<h3 id="org4a6571a">Node.js</h3>
<div class="outline-text-3" id="text-org4a6571a">
<div class="org-src-container">
<pre class="src src-shell" id="orga4d9d3f"><span style="font-weight: bold;">echo</span> ${<span style="font-weight: bold; font-style: italic;">HOME</span>}/.npm-global
</pre>
</div>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"node"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-shell"><span style="font-weight: bold; font-style: italic;">NODE_PATH</span>=<span style="font-style: italic;">"&lt;&lt;npm-prefix()&gt;&gt;/lib/node_modules:${NODE_PATH}"</span>
<span style="font-weight: bold; font-style: italic;">PATH</span>=<span style="font-style: italic;">"&lt;&lt;npm-prefix()&gt;&gt;/bin:${PATH}"</span>
<span style="font-weight: bold; font-style: italic;">MANPATH</span>=<span style="font-style: italic;">"&lt;&lt;npm-prefix()&gt;&gt;/share/man:${MANPATH}"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-shell"><span style="font-weight: bold; font-style: italic;">prefix</span>=&lt;&lt;npm-prefix()&gt;&gt;
</pre>
</div>

<ul class="org-ul">
<li><p>
make a directory for global npm packages
</p>
<div class="org-src-container">
<pre class="src src-shell">mkdir -pv &lt;&lt;npm-prefix()&gt;&gt;
</pre>
</div></li>
</ul>
</div>
</div>

<div id="outline-container-org2e9268a" class="outline-3">
<h3 id="org2e9268a">asdf-vm&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span></h3>
</div>
<div id="outline-container-orgba43cc9" class="outline-3">
<h3 id="orgba43cc9">Tree Sitter</h3>
<div class="outline-text-3" id="text-orgba43cc9">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"tree-sitter"</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org4df0485" class="outline-3">
<h3 id="org4df0485">Language Servers</h3>
<div class="outline-text-3" id="text-org4df0485">
</div>
<div id="outline-container-org2c88a58" class="outline-4">
<h4 id="org2c88a58">Bash Language Server</h4>
<div class="outline-text-4" id="text-org2c88a58">
<p>
<a href="https://github.com/bash-lsp/bash-language-server">Bash Language Server</a>
</p>

<ul class="org-ul">
<li><p>
how to install
</p>
<pre class="example">
$ npm install -g bash-language-server

</pre></li>
</ul>
</div>
</div>

<div id="outline-container-org4ab567e" class="outline-4">
<h4 id="org4ab567e">Solargraph</h4>
<div class="outline-text-4" id="text-org4ab567e">
<p>
<a href="https://github.com/castwide/solargraph">Solargraph</a> is Ruby Language Server.
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"ruby-solargraph"</span>
</pre>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-orgc34a7b5" class="outline-2">
<h2 id="orgc34a7b5">Utility Scripts</h2>
<div class="outline-text-2" id="text-orgc34a7b5">
</div>

<div id="outline-container-org6453aa1" class="outline-3">
<h3 id="org6453aa1">Declutters&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span></h3>
</div>

<div id="outline-container-org7674404" class="outline-3">
<h3 id="org7674404">Database back-up scripts</h3>
<div class="outline-text-3" id="text-org7674404">
<ul class="org-ul">
<li><p>
PostgreSQL
</p>
<div class="org-src-container">
<pre class="src src-bash"><span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">!/usr/bin/</span><span style="font-weight: bold;">env</span><span style="font-weight: bold; font-style: italic;"> bash</span>

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Usage: $ postgres_backup &lt;db_name&gt; &lt;backup_dir&gt;</span>

<span style="font-weight: bold; font-style: italic;">POSTGRES_DBNAME</span>=$<span style="font-weight: bold; font-style: italic;">1</span>
<span style="font-weight: bold; font-style: italic;">BACKUP_DIR</span>=$<span style="font-weight: bold; font-style: italic;">2</span>
<span style="font-weight: bold; font-style: italic;">DATE</span>=<span style="font-style: italic;">"$(date +%Y%m%d_%H%M)"</span>

pg_dump --format=custom ${<span style="font-weight: bold; font-style: italic;">POSTGRES_DBNAME</span>} &gt; ${<span style="font-weight: bold; font-style: italic;">BACKUP_DIR</span>}/${<span style="font-weight: bold; font-style: italic;">DATE</span>}_${<span style="font-weight: bold; font-style: italic;">POSTGRES_DBNAME</span>}.custom || <span style="font-weight: bold;">exit</span> 1

<span style="font-weight: bold;">exit</span> 0
</pre>
</div></li>

<li><p>
MySQL
</p>
<div class="org-src-container">
<pre class="src src-shell"><span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">!/usr/bin/</span><span style="font-weight: bold;">env</span><span style="font-weight: bold; font-style: italic;"> bash</span>

<span style="font-weight: bold; font-style: italic;">BACKUP_DIR</span>=~/data/share/backups/mysql
<span style="font-weight: bold; font-style: italic;">RAW_SQL</span>=<span style="font-style: italic;">"$(date +%Y%m%d_%H%M)_backup.sql"</span>
<span style="font-weight: bold; font-style: italic;">TAR_SQL</span>=<span style="font-style: italic;">"${RAW_SQL}.txz"</span>

(
  <span style="font-weight: bold;">cd</span> <span style="font-style: italic;">"${BACKUP_DIR}"</span> || <span style="font-weight: bold;">exit</span> 1
  mysqldump --opt --all-databases --events --default-character-set=binary -u root &gt; <span style="font-style: italic;">"${RAW_SQL}"</span>
  tar cfJ <span style="font-style: italic;">"${TAR_SQL}"</span> <span style="font-style: italic;">"${RAW_SQL}"</span>
  rm -f <span style="font-style: italic;">"${RAW_SQL}"</span>
) || <span style="font-weight: bold;">exit</span> 1

<span style="font-weight: bold;">exit</span> 0
</pre>
</div></li>
</ul>
</div>
</div>

<div id="outline-container-org4bfd4b2" class="outline-3">
<h3 id="org4bfd4b2">filetype</h3>
<div class="outline-text-3" id="text-org4bfd4b2">
<p>
This program determine type of the file.
</p>

<div class="org-src-container">
<pre class="src src-ruby"><span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">!/usr/bin/env ruby</span>

<span style="font-weight: bold;">require</span> <span style="font-style: italic;">'pathname'</span>
<span style="font-weight: bold;">require</span> <span style="font-style: italic;">'uri'</span>
<span style="font-weight: bold;">require</span> <span style="font-style: italic;">'shellwords'</span>

<span style="font-weight: bold;">class</span> <span style="font-weight: bold; text-decoration: underline;">FileType</span>
  <span style="font-weight: bold; text-decoration: underline;">ZIP_PREFIXES</span> = [<span style="font-style: italic;">'Zip archive data'</span>]

  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">self</span>.<span style="font-weight: bold;">type</span>(filename, file_cmd_opt = <span style="font-style: italic;">""</span>)
    <span style="font-weight: bold;">if</span>  <span style="font-weight: bold; text-decoration: underline;">File</span>.exists?(filename)
      local_opt = <span style="font-style: italic;">""</span>
      <span style="font-weight: bold;">if</span> <span style="font-weight: bold; text-decoration: underline;">File</span>.symlink?(filename)
        local_opt += <span style="font-style: italic;">"--dereference"</span>
      <span style="font-weight: bold;">end</span>
      <span style="font-style: italic;">`file --brief </span><span style="font-weight: bold; font-style: italic;">#{file_cmd_opt}</span><span style="font-style: italic;"> </span><span style="font-weight: bold; font-style: italic;">#{local_opt}</span><span style="font-style: italic;"> </span><span style="font-weight: bold; font-style: italic;">#{Shellwords.shellescape(filename)}</span><span style="font-style: italic;">`</span>.strip
    <span style="font-weight: bold;">elsif</span> filename =~ <span style="font-style: italic;">/https?:\/\/www\.youtube\.com.*/</span>
      <span style="font-style: italic;">`yt-dlp -f worst -q </span><span style="font-weight: bold; font-style: italic;">#{Shellwords.shellescape(filename)}</span><span style="font-style: italic;"> -o - 2&gt;/dev/null | file --brief </span><span style="font-weight: bold; font-style: italic;">#{file_cmd_opt}</span><span style="font-style: italic;"> -`</span>.strip
    <span style="font-weight: bold;">elsif</span> filename =~ <span style="font-weight: bold; text-decoration: underline;">URI</span>::<span style="font-weight: bold; text-decoration: underline;">DEFAULT_PARSER</span>.make_regexp
      <span style="font-style: italic;">`curl --location --range 0-9999 </span><span style="font-weight: bold; font-style: italic;">#{Shellwords.shellescape(filename)}</span><span style="font-style: italic;"> 2&gt;/dev/null | file --brief </span><span style="font-weight: bold; font-style: italic;">#{file_cmd_opt}</span><span style="font-style: italic;"> -`</span>.strip
    <span style="font-weight: bold;">else</span>
      <span style="font-style: italic;">''</span>
    <span style="font-weight: bold;">end</span>
  <span style="font-weight: bold;">end</span>

  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">self</span>.<span style="font-weight: bold;">mime_type</span>(filename)
    type(filename, <span style="font-style: italic;">"--mime-type"</span>)
  <span style="font-weight: bold;">end</span>

  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">self</span>.<span style="font-weight: bold;">block_device?</span>(file)
    type(file).start_with?(<span style="font-style: italic;">'block special'</span>) &amp;&amp;
      mime_type(file) == <span style="font-style: italic;">'inode/blockdevice'</span>
  <span style="font-weight: bold;">end</span>

  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">self</span>.<span style="font-weight: bold;">iso9660?</span>(file)
    mime_type(file) == <span style="font-style: italic;">'application/x-iso9660-image'</span>
  <span style="font-weight: bold;">end</span>

  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">self</span>.<span style="font-weight: bold;">video_dvd_image?</span>(file)
    iso9660?(file) &amp;&amp; type(file).start_with?(<span style="font-style: italic;">'UDF filesystem data'</span>)
  <span style="font-weight: bold;">end</span>

  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">self</span>.<span style="font-weight: bold;">html?</span>(file)
    type(file).start_with?(<span style="font-style: italic;">"HTML document"</span>)
  <span style="font-weight: bold;">end</span>

  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">self</span>.<span style="font-weight: bold;">pdf?</span>(file)
    type(file).start_with?(<span style="font-style: italic;">"PDF document"</span>)
  <span style="font-weight: bold;">end</span>

  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">self</span>.<span style="font-weight: bold;">epub?</span>(file)
    type(file) == <span style="font-style: italic;">"EPUB document"</span>
  <span style="font-weight: bold;">end</span>

  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">self</span>.<span style="font-weight: bold;">mobi?</span>(file)
    type(file).start_with?(<span style="font-style: italic;">"Mobipocket E-book"</span>)
  <span style="font-weight: bold;">end</span>

  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">self</span>.<span style="font-weight: bold;">pgp?</span>(file)
    type(file).start_with?(<span style="font-style: italic;">"PGP"</span>)
  <span style="font-weight: bold;">end</span>

  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">self</span>.<span style="font-weight: bold;">tarpgp?</span>(file)
    pgp?(file) &amp;&amp; file.end_with?(<span style="font-style: italic;">'.tar.gpg'</span>)
  <span style="font-weight: bold;">end</span>

  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">self</span>.<span style="font-weight: bold;">zip?</span>(file)
    type(file).start_with?(*<span style="font-weight: bold; text-decoration: underline;">ZIP_PREFIXES</span>)
  <span style="font-weight: bold;">end</span>

  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">self</span>.<span style="font-weight: bold;">video?</span>(file)
    mime_type(file).start_with?(<span style="font-style: italic;">"video/"</span>)
  <span style="font-weight: bold;">end</span>

  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">self</span>.<span style="font-weight: bold;">audio?</span>(file)
    mime_type(file).start_with?(<span style="font-style: italic;">'audio/'</span>)
  <span style="font-weight: bold;">end</span>

  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">self</span>.<span style="font-weight: bold;">image?</span>(file)
    mime_type(file).start_with?(<span style="font-style: italic;">"image/"</span>)
  <span style="font-weight: bold;">end</span>

  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">self</span>.<span style="font-weight: bold;">playable?</span>(file)
    <span style="font-weight: bold;">if</span> <span style="font-weight: bold; text-decoration: underline;">File</span>.directory?(file)
      <span style="font-weight: bold; text-decoration: underline;">Dir</span>.foreach(file) <span style="font-weight: bold;">do</span> |fname|
        <span style="font-weight: bold;">next</span> <span style="font-weight: bold;">if</span> [<span style="font-style: italic;">"."</span>, <span style="font-style: italic;">".."</span>].include?(fname)
        <span style="font-weight: bold;">return</span> <span style="font-weight: bold; text-decoration: underline;">false</span> <span style="font-weight: bold;">unless</span> playable?(<span style="font-style: italic;">"</span><span style="font-weight: bold; font-style: italic;">#{file}</span><span style="font-style: italic;">/</span><span style="font-weight: bold; font-style: italic;">#{fname}</span><span style="font-style: italic;">"</span>)
      <span style="font-weight: bold;">end</span>
      <span style="font-weight: bold; text-decoration: underline;">true</span>
    <span style="font-weight: bold;">elsif</span> file =~ <span style="font-style: italic;">/https?:\/\/www\.youtube\.com.*/</span>
      <span style="font-weight: bold; text-decoration: underline;">true</span>
    <span style="font-weight: bold;">else</span>
      type(file).start_with?(<span style="font-style: italic;">"ISO Media"</span>, <span style="font-style: italic;">"Audio file"</span>) ||
        mime_type(file).start_with?(<span style="font-style: italic;">"video"</span>, <span style="font-style: italic;">"audio"</span>, <span style="font-style: italic;">"image"</span>)
    <span style="font-weight: bold;">end</span>
  <span style="font-weight: bold;">end</span>

  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">self</span>.<span style="font-weight: bold;">dvd_dir?</span>(file)
    <span style="font-weight: bold; text-decoration: underline;">false</span> <span style="font-weight: bold;">unless</span> mime_type(file) == <span style="font-style: italic;">'inode/directory'</span>
    <span style="font-weight: bold; text-decoration: underline;">File</span>.exist?(<span style="font-weight: bold; text-decoration: underline;">Pathname</span>.new(file).join(<span style="font-style: italic;">"VIDEO_TS"</span>)) ||
      <span style="font-weight: bold; text-decoration: underline;">File</span>.exist?(<span style="font-weight: bold; text-decoration: underline;">Pathname</span>.new(file).join(<span style="font-style: italic;">"video_ts"</span>))
  <span style="font-weight: bold;">end</span>
<span style="font-weight: bold;">end</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-orgba8fe58" class="outline-3">
<h3 id="orgba8fe58">mediautil</h3>
<div class="outline-text-3" id="text-orgba8fe58">
<p>
Utility ruby program for manipulating image, audio and video file.
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"dvd+rw-tools"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-ruby"><span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">!/usr/bin/env ruby</span>

<span style="font-weight: bold;">require</span> <span style="font-style: italic;">'thor'</span>
<span style="font-weight: bold;">require</span> <span style="font-style: italic;">'open3'</span>
<span style="font-weight: bold;">require</span> <span style="font-style: italic;">'fileutils'</span>
<span style="font-weight: bold;">require</span> <span style="font-style: italic;">'tempfile'</span>
<span style="font-weight: bold;">require</span> <span style="font-style: italic;">'tmpdir'</span>

<span style="font-weight: bold;">require</span> <span style="font-style: italic;">'filetype'</span>

<span style="font-weight: bold;">class</span> <span style="font-weight: bold; text-decoration: underline;">MediaUtil</span> &lt; <span style="font-weight: bold; text-decoration: underline;">Thor</span>
  <span style="font-weight: bold; text-decoration: underline;">OUTFILE_SUFFIX</span> = <span style="font-style: italic;">"_out"</span>
  <span style="font-weight: bold; text-decoration: underline;">DEFAULT_VIDEO_EXT</span> = <span style="font-style: italic;">".mkv"</span>

  <span style="font-weight: bold;">class</span> <span style="font-weight: bold; text-decoration: underline;">Names</span> &lt; <span style="font-weight: bold; text-decoration: underline;">Struct</span>.new(<span style="font-weight: bold; text-decoration: underline;">:in_f</span>, <span style="font-weight: bold; text-decoration: underline;">:out_f</span>)
    <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">in_file</span>()
      in_f
    <span style="font-weight: bold;">end</span>
    <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">out_file</span>(extension = <span style="font-weight: bold; text-decoration: underline;">nil</span>)
      <span style="font-weight: bold;">if</span> out_f
        out_f
      <span style="font-weight: bold;">else</span>
        bn = <span style="font-weight: bold; text-decoration: underline;">File</span>.basename(in_f, <span style="font-style: italic;">".*"</span>).gsub(<span style="font-style: italic;">/ /</span>, <span style="font-style: italic;">'_'</span>)
        ext = ((extension) ? extension : <span style="font-weight: bold; text-decoration: underline;">File</span>.extname(in_file))
        default_out = bn + ext
        <span style="font-weight: bold;">if</span> <span style="font-weight: bold; text-decoration: underline;">File</span>.file?(default_out)
          10.times <span style="font-weight: bold;">do</span> |i|
            try_name = bn + <span style="font-style: italic;">"_"</span> + (i+1).to_s + ext
            <span style="font-weight: bold;">unless</span> <span style="font-weight: bold; text-decoration: underline;">File</span>.file?(try_name)
              <span style="font-weight: bold;">return</span> try_name
            <span style="font-weight: bold;">end</span>
          <span style="font-weight: bold;">end</span>
        <span style="font-weight: bold;">end</span>
        default_out
      <span style="font-weight: bold;">end</span>
    <span style="font-weight: bold;">end</span>
    <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">title</span>()
      <span style="font-weight: bold; text-decoration: underline;">File</span>.basename(out_file, <span style="font-style: italic;">".*"</span>)
    <span style="font-weight: bold;">end</span>
  <span style="font-weight: bold;">end</span>
  <span style="font-weight: bold;">class</span> <span style="font-weight: bold; text-decoration: underline;">Commander</span> &lt; <span style="font-weight: bold; text-decoration: underline;">Struct</span>.new(<span style="font-weight: bold; text-decoration: underline;">:log</span>, <span style="font-weight: bold; text-decoration: underline;">:dry</span>)
    <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">execute</span>(command)
      <span style="font-weight: bold;">if</span> dry
        <span style="font-weight: bold;">puts</span> command
      <span style="font-weight: bold;">else</span>
        log_str, s_code = <span style="font-weight: bold; text-decoration: underline;">Open3</span>.capture2e(command)
        <span style="font-weight: bold;">if</span> log
          user_cmd = <span style="font-weight: bold;">caller</span>.first.scan(<span style="font-style: italic;">/`(.*)'/</span>).flatten.first.to_s
          log_fname = <span style="font-weight: bold; text-decoration: underline;">Time</span>.now.strftime(<span style="font-style: italic;">"%Y%m%d_%H%M%S_"</span>) + user_cmd + <span style="font-style: italic;">".log"</span>
          <span style="font-weight: bold; text-decoration: underline;">File</span>.open(log_fname, <span style="font-style: italic;">"w"</span>) <span style="font-weight: bold;">do</span> |f|
            f.puts(log_str)
          <span style="font-weight: bold;">end</span>
        <span style="font-weight: bold;">else</span>
          <span style="font-weight: bold;">puts</span> log_str
        <span style="font-weight: bold;">end</span>
        <span style="font-weight: bold;">exit</span> <span style="font-weight: bold; text-decoration: underline;">false</span> <span style="font-weight: bold;">unless</span> s_code.success?
        <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">exit false</span>
      <span style="font-weight: bold;">end</span>
    <span style="font-weight: bold;">end</span>
  <span style="font-weight: bold;">end</span>

  class_option <span style="font-weight: bold; text-decoration: underline;">:log</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"L"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:boolean</span>,
               <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">"log stdout and stderr instead they reveal in terminal"</span>
  class_option <span style="font-weight: bold; text-decoration: underline;">:dryrun</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"D"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:boolean</span>

  desc <span style="font-style: italic;">"info &lt;file&gt;"</span>, <span style="font-style: italic;">"show information about the video file or DVD directory"</span>
  option <span style="font-weight: bold; text-decoration: underline;">:short</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"s"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:boolean</span>
  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">info</span>(target)
    commander = <span style="font-weight: bold; text-decoration: underline;">Commander</span>.new(options[<span style="font-weight: bold; text-decoration: underline;">:log</span>], options[<span style="font-weight: bold; text-decoration: underline;">:dryrun</span>])

    <span style="font-weight: bold;">if</span> <span style="font-weight: bold; text-decoration: underline;">FileType</span>.video?(target) || <span style="font-weight: bold; text-decoration: underline;">FileType</span>.audio?(target)
      commander.execute(<span style="font-style: italic;">"ffprobe \"</span><span style="font-weight: bold; font-style: italic;">#{target}</span><span style="font-style: italic;">\" -hide_banner -show_entries format"</span>)
    <span style="font-weight: bold;">elsif</span> <span style="font-weight: bold; text-decoration: underline;">FileType</span>.image?(target)
      <span style="font-weight: bold;">if</span> options[<span style="font-weight: bold; text-decoration: underline;">:short</span>]
        commander.execute(<span style="font-style: italic;">"identify </span><span style="font-weight: bold; font-style: italic;">#{target}</span><span style="font-style: italic;">"</span>)
      <span style="font-weight: bold;">else</span>
        commander.execute(<span style="font-style: italic;">"identify -verbose </span><span style="font-weight: bold; font-style: italic;">#{target}</span><span style="font-style: italic;">"</span>)
      <span style="font-weight: bold;">end</span>
    <span style="font-weight: bold;">elsif</span> <span style="font-weight: bold; text-decoration: underline;">FileType</span>.block_device?(target) ||
          <span style="font-weight: bold; text-decoration: underline;">FileType</span>.video_dvd_image?(target) ||
          <span style="font-weight: bold; text-decoration: underline;">FileType</span>.dvd_dir?(target)
      commander.execute(<span style="font-style: italic;">"HandBrakeCLI -i \"</span><span style="font-weight: bold; font-style: italic;">#{target}</span><span style="font-style: italic;">\" --title 0"</span>)
    <span style="font-weight: bold;">else</span>
      <span style="font-weight: bold; text-decoration: underline;">STDERR</span>.puts <span style="font-style: italic;">"Unknown Media Format"</span>
      <span style="font-weight: bold;">exit</span> <span style="font-weight: bold; text-decoration: underline;">false</span>
    <span style="font-weight: bold;">end</span>
  <span style="font-weight: bold;">end</span>

  default_command <span style="font-weight: bold; text-decoration: underline;">:encode</span>
  desc <span style="font-style: italic;">"encode"</span>, <span style="font-style: italic;">"encode video file"</span>
  option <span style="font-weight: bold; text-decoration: underline;">:in</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"i"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>, <span style="font-weight: bold; text-decoration: underline;">:required</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">true</span>
  option <span style="font-weight: bold; text-decoration: underline;">:out</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"o"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>
  option <span style="font-weight: bold; text-decoration: underline;">:vencoder</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"e"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:banner</span> =&gt; <span style="font-style: italic;">"libx265|libx264"</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">"video encoder"</span>
  option <span style="font-weight: bold; text-decoration: underline;">:vquality</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"q"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:banner</span> =&gt; <span style="font-style: italic;">"24.0"</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">"video encoding quality"</span>
  option <span style="font-weight: bold; text-decoration: underline;">:vbitrate</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"b"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:banner</span> =&gt; <span style="font-style: italic;">"1000"</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">"video encoding bitrate in kbps"</span>
  option <span style="font-weight: bold; text-decoration: underline;">:aencoder</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"E"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:banner</span> =&gt; <span style="font-style: italic;">"fdk_aac"</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">"audio encoder"</span>
  option <span style="font-weight: bold; text-decoration: underline;">:aquality</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"Q"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:banner</span> =&gt; <span style="font-style: italic;">"100.0"</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">"audio encoding quality"</span>
  option <span style="font-weight: bold; text-decoration: underline;">:abitrate</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"B"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:banner</span> =&gt; <span style="font-style: italic;">"128"</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">"audio encoding bitrate in kbps"</span>
  option <span style="font-weight: bold; text-decoration: underline;">:display</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"d"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:banner</span> =&gt; <span style="font-style: italic;">"1920:1080"</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">'display (width:height) in which encoded video fit'</span>
  option <span style="font-weight: bold; text-decoration: underline;">:fps</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"f"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:banner</span> =&gt; <span style="font-style: italic;">"30"</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">'max frame rate'</span>
  option <span style="font-weight: bold; text-decoration: underline;">:ffmpeg</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>
  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">encode</span>()
    equip = <span style="font-weight: bold; text-decoration: underline;">Names</span>.new(options[<span style="font-weight: bold; text-decoration: underline;">:in</span>], options[<span style="font-weight: bold; text-decoration: underline;">:out</span>])
    commander = <span style="font-weight: bold; text-decoration: underline;">Commander</span>.new(options[<span style="font-weight: bold; text-decoration: underline;">:log</span>], options[<span style="font-weight: bold; text-decoration: underline;">:dryrun</span>])

    vconf = aconf = pconf = <span style="font-weight: bold; text-decoration: underline;">nil</span>
    <span style="font-weight: bold;">if</span> options[<span style="font-weight: bold; text-decoration: underline;">:vencoder</span>] || options[<span style="font-weight: bold; text-decoration: underline;">:vquality</span>]
      vconf = <span style="font-weight: bold; text-decoration: underline;">VideoConfig</span>.new(options[<span style="font-weight: bold; text-decoration: underline;">:vencoder</span>], options[<span style="font-weight: bold; text-decoration: underline;">:vquality</span>], options[<span style="font-weight: bold; text-decoration: underline;">:vbitrate</span>])
    <span style="font-weight: bold;">end</span>
    <span style="font-weight: bold;">if</span> options[<span style="font-weight: bold; text-decoration: underline;">:aencoder</span>] || options[<span style="font-weight: bold; text-decoration: underline;">:aquality</span>]
      aconf = <span style="font-weight: bold; text-decoration: underline;">AudioConfig</span>.new(options[<span style="font-weight: bold; text-decoration: underline;">:aencoder</span>], options[<span style="font-weight: bold; text-decoration: underline;">:aquality</span>], options[<span style="font-weight: bold; text-decoration: underline;">:abitrate</span>])
    <span style="font-weight: bold;">end</span>
    <span style="font-weight: bold;">if</span> options[<span style="font-weight: bold; text-decoration: underline;">:display</span>] || options[<span style="font-weight: bold; text-decoration: underline;">:fps</span>]
      pconf = <span style="font-weight: bold; text-decoration: underline;">PictureConfig</span>.new
      pconf.fit_size(options[<span style="font-weight: bold; text-decoration: underline;">:display</span>]) <span style="font-weight: bold;">if</span> options[<span style="font-weight: bold; text-decoration: underline;">:display</span>]
      pconf.decrease_framerate(options[<span style="font-weight: bold; text-decoration: underline;">:fps</span>]) <span style="font-weight: bold;">if</span> options[<span style="font-weight: bold; text-decoration: underline;">:fps</span>]
    <span style="font-weight: bold;">end</span>

    <span style="font-weight: bold;">if</span> <span style="font-weight: bold; text-decoration: underline;">FileType</span>.video?(equip.in_file) <span style="font-weight: bold;">then</span>
      commander.execute(<span style="font-weight: bold; text-decoration: underline;">FFMPEG</span>.command([<span style="font-weight: bold; text-decoration: underline;">FFMPEGOptSet</span>.new(equip.in_file, [])],
                                       [<span style="font-weight: bold; text-decoration: underline;">FFMPEGOptSet</span>.new(equip.out_file, [vconf, aconf, pconf, <span style="font-style: italic;">"-map_metadata 0"</span>, options[<span style="font-weight: bold; text-decoration: underline;">:ffmpeg</span>]])]))
    <span style="font-weight: bold;">elsif</span> <span style="font-weight: bold; text-decoration: underline;">FileType</span>.audio?(equip.in_file) <span style="font-weight: bold;">then</span>
      commander.execute(<span style="font-weight: bold; text-decoration: underline;">FFMPEG</span>.command([<span style="font-weight: bold; text-decoration: underline;">FFMPEGOptSet</span>.new(equip.in_file, [])],
                                       [<span style="font-weight: bold; text-decoration: underline;">FFMPEGOptSet</span>.new(equip.out_file, [aconf])]))
    <span style="font-weight: bold;">elsif</span> <span style="font-weight: bold; text-decoration: underline;">FileType</span>.image?(equip.in_file) <span style="font-weight: bold;">then</span>
      pconf = <span style="font-weight: bold; text-decoration: underline;">ImageConfig</span>.new
      commander.execute(<span style="font-weight: bold; text-decoration: underline;">ImageMagick</span>.command(equip.in_file,
                                            equip.out_file,
                                            pconf))
    <span style="font-weight: bold;">else</span>
      <span style="font-weight: bold; text-decoration: underline;">STDERR</span>.puts <span style="font-style: italic;">"Unknown Media Format"</span>
      <span style="font-weight: bold;">exit</span> <span style="font-weight: bold; text-decoration: underline;">false</span>
    <span style="font-weight: bold;">end</span>
  <span style="font-weight: bold;">end</span>

  desc <span style="font-style: italic;">'cdencode'</span>, <span style="font-style: italic;">'rip and encode CD contents'</span>
  option <span style="font-weight: bold; text-decoration: underline;">:device</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">'d'</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">'Device file'</span>
  option <span style="font-weight: bold; text-decoration: underline;">:format</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">'f'</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:banner</span> =&gt; <span style="font-style: italic;">'flac,ogg,m4a'</span>, <span style="font-weight: bold; text-decoration: underline;">:default</span> =&gt; <span style="font-style: italic;">'flac:-8'</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">'formats with additinal argument like compression level'</span>
  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">cdencode</span>()
    commander = <span style="font-weight: bold; text-decoration: underline;">Commander</span>.new(options[<span style="font-weight: bold; text-decoration: underline;">:log</span>], options[<span style="font-weight: bold; text-decoration: underline;">:dryrun</span>])

    abcde_args = []
    abcde_args &lt;&lt; <span style="font-style: italic;">"-d </span><span style="font-weight: bold; font-style: italic;">#{options[:device]}</span><span style="font-style: italic;">"</span> <span style="font-weight: bold;">if</span> options[<span style="font-weight: bold; text-decoration: underline;">:device</span>]
    abcde_args &lt;&lt; <span style="font-style: italic;">'-a default'</span>
    <span style="font-weight: bold;">if</span> options[<span style="font-weight: bold; text-decoration: underline;">:format</span>] <span style="font-weight: bold;">then</span>
      abcde_args &lt;&lt; <span style="font-style: italic;">"-o '</span><span style="font-weight: bold; font-style: italic;">#{options[:format]}</span><span style="font-style: italic;">'"</span>
    <span style="font-weight: bold;">end</span>
    abcde_args &lt;&lt; <span style="font-style: italic;">'-G'</span> <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">getalbumart</span>
    abcde_args &lt;&lt; <span style="font-style: italic;">'-x'</span> <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Eject CD</span>

    commander.execute(<span style="font-style: italic;">"abcde </span><span style="font-weight: bold; font-style: italic;">#{abcde_args.join(' ')}</span><span style="font-style: italic;">"</span>)
  <span style="font-weight: bold;">end</span>

  desc <span style="font-style: italic;">'dvdrip'</span>, <span style="font-style: italic;">'rip(backup) DVD contents'</span>
  option <span style="font-weight: bold; text-decoration: underline;">:device</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">'d'</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">'DVD device file'</span>
  option <span style="font-weight: bold; text-decoration: underline;">:out</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">'o'</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">'output directory name'</span>
  option <span style="font-weight: bold; text-decoration: underline;">:name</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">'n'</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">'root directory name of backup data'</span>
  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">dvdrip</span>()
    commander = <span style="font-weight: bold; text-decoration: underline;">Commander</span>.new(options[<span style="font-weight: bold; text-decoration: underline;">:log</span>], options[<span style="font-weight: bold; text-decoration: underline;">:dryrun</span>])

    dvdbackup_opts = [<span style="font-style: italic;">'dvdbackup'</span>]
    dvdbackup_opts &lt;&lt; <span style="font-style: italic;">'--input=%s'</span> % options[<span style="font-weight: bold; text-decoration: underline;">:device</span>] <span style="font-weight: bold;">if</span> options[<span style="font-weight: bold; text-decoration: underline;">:device</span>]
    dvdbackup_opts &lt;&lt; <span style="font-style: italic;">'--output=%s'</span> % options[<span style="font-weight: bold; text-decoration: underline;">:out</span>] <span style="font-weight: bold;">if</span> options[<span style="font-weight: bold; text-decoration: underline;">:out</span>]
    dvdbackup_opts &lt;&lt; <span style="font-style: italic;">'--name=%s'</span> % options[<span style="font-weight: bold; text-decoration: underline;">:name</span>] <span style="font-weight: bold;">if</span> options[<span style="font-weight: bold; text-decoration: underline;">:name</span>]
    dvdbackup_opts &lt;&lt; <span style="font-style: italic;">'--mirror'</span>
    dvdbackup_opts &lt;&lt; <span style="font-style: italic;">'--progress'</span>
    dvdbackup_opts &lt;&lt; <span style="font-style: italic;">'--verbose'</span>

    commander.execute(dvdbackup_opts.join(<span style="font-style: italic;">' '</span>))
  <span style="font-weight: bold;">end</span>

  desc <span style="font-style: italic;">'dvdencode'</span>, <span style="font-style: italic;">'encode DVD contents'</span>
  option <span style="font-weight: bold; text-decoration: underline;">:in</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">'i'</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>, <span style="font-weight: bold; text-decoration: underline;">:required</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">true</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">'input source, DVD device file or backuped DVD file'</span>
  option <span style="font-weight: bold; text-decoration: underline;">:out</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">'o'</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">'output directory name'</span>
  option <span style="font-weight: bold; text-decoration: underline;">:vencoder</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"e"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:banner</span> =&gt; <span style="font-style: italic;">"x265|x264"</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">"video encoder"</span>
  option <span style="font-weight: bold; text-decoration: underline;">:vquality</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"q"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:banner</span> =&gt; <span style="font-style: italic;">"24.0"</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">"video encoding quality"</span>
  option <span style="font-weight: bold; text-decoration: underline;">:vbitrate</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"b"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:banner</span> =&gt; <span style="font-style: italic;">"1000"</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">"video bitrate in kbps"</span>
  option <span style="font-weight: bold; text-decoration: underline;">:aencoder</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"E"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:banner</span> =&gt; <span style="font-style: italic;">"fdk_aac"</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">"audio encoder"</span>
  option <span style="font-weight: bold; text-decoration: underline;">:aquality</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"Q"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:banner</span> =&gt; <span style="font-style: italic;">"100.0"</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">"audio encoding quality"</span>
  option <span style="font-weight: bold; text-decoration: underline;">:abitrate</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"B"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:banner</span> =&gt; <span style="font-style: italic;">"128"</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">"audio bitrate in kbps"</span>
  option <span style="font-weight: bold; text-decoration: underline;">:title</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">'t'</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:banner</span> =&gt; <span style="font-style: italic;">'1|2|3|...'</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">'title number'</span>
  option <span style="font-weight: bold; text-decoration: underline;">:chapters</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">'c'</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:banner</span> =&gt; <span style="font-style: italic;">'1|1-3|1,3,5|...'</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">'chapter numbers'</span>
  option <span style="font-weight: bold; text-decoration: underline;">:audio</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">'a'</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:banner</span> =&gt; <span style="font-style: italic;">'1,2,3'</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">'audio channel'</span>
  option <span style="font-weight: bold; text-decoration: underline;">:subtitle</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">'s'</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:banner</span> =&gt; <span style="font-style: italic;">'1,2'</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">'subtitle channel'</span>
  option <span style="font-weight: bold; text-decoration: underline;">:handbrake</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:banner</span> =&gt; <span style="font-style: italic;">'--handbrake \"--mixdown 5point1,stereo\"'</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">'HandBrakeCLI options'</span>
  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">dvdencode</span>()
    equip = <span style="font-weight: bold; text-decoration: underline;">Names</span>.new(options[<span style="font-weight: bold; text-decoration: underline;">:in</span>], options[<span style="font-weight: bold; text-decoration: underline;">:out</span>])
    commander = <span style="font-weight: bold; text-decoration: underline;">Commander</span>.new(options[<span style="font-weight: bold; text-decoration: underline;">:log</span>], options[<span style="font-weight: bold; text-decoration: underline;">:dryrun</span>])

    <span style="font-weight: bold;">if</span> <span style="font-weight: bold; text-decoration: underline;">FileType</span>.block_device?(equip.in_file) ||
       <span style="font-weight: bold; text-decoration: underline;">FileType</span>.video_dvd_image?(equip.in_file) ||
       <span style="font-weight: bold; text-decoration: underline;">FileType</span>.dvd_dir?(equip.in_file)
      configs = []
      configs &lt;&lt; <span style="font-weight: bold; text-decoration: underline;">VideoConfig</span>.new(options[<span style="font-weight: bold; text-decoration: underline;">:vencoder</span>], options[<span style="font-weight: bold; text-decoration: underline;">:vquality</span>], options[<span style="font-weight: bold; text-decoration: underline;">:vbitrate</span>])
      configs &lt;&lt; <span style="font-weight: bold; text-decoration: underline;">AudioConfig</span>.new(options[<span style="font-weight: bold; text-decoration: underline;">:aencoder</span>], options[<span style="font-weight: bold; text-decoration: underline;">:aquality</span>], options[<span style="font-weight: bold; text-decoration: underline;">:abitrate</span>])
      dconf = <span style="font-weight: bold; text-decoration: underline;">DVDConfig</span>.new
      dconf.title = options[<span style="font-weight: bold; text-decoration: underline;">:title</span>] <span style="font-weight: bold;">if</span> options[<span style="font-weight: bold; text-decoration: underline;">:title</span>]
      dconf.chapters = options[<span style="font-weight: bold; text-decoration: underline;">:chapters</span>] <span style="font-weight: bold;">if</span> options[<span style="font-weight: bold; text-decoration: underline;">:chapters</span>]
      dconf.audio = options[<span style="font-weight: bold; text-decoration: underline;">:audio</span>] <span style="font-weight: bold;">if</span> options[<span style="font-weight: bold; text-decoration: underline;">:audio</span>]
      dconf.subtitle = options[<span style="font-weight: bold; text-decoration: underline;">:subtitle</span>] <span style="font-weight: bold;">if</span> options[<span style="font-weight: bold; text-decoration: underline;">:subtitle</span>]
      configs &lt;&lt; dconf
      commander.execute(<span style="font-weight: bold; text-decoration: underline;">HandBrakeCLI</span>.command(equip.in_file,
                                             equip.out_file(<span style="font-weight: bold; text-decoration: underline;">DEFAULT_VIDEO_EXT</span>),
                                             configs,
                                             options[<span style="font-weight: bold; text-decoration: underline;">:handbrake</span>]))
    <span style="font-weight: bold;">end</span>
  <span style="font-weight: bold;">end</span>

  desc <span style="font-style: italic;">'mount &lt;dir&gt;'</span>, <span style="font-style: italic;">'Mount CD/DVD media to dir.'</span>
  option <span style="font-weight: bold; text-decoration: underline;">:device</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"d"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>, <span style="font-weight: bold; text-decoration: underline;">:required</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">true</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">'device or iso file to mount'</span>,
         <span style="font-weight: bold; text-decoration: underline;">:banner</span> =&gt; <span style="font-style: italic;">'--mount /dev/dvd|image.iso'</span>
  option <span style="font-weight: bold; text-decoration: underline;">:type</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">'t'</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">'mount DVD-Video'</span>,
         <span style="font-weight: bold; text-decoration: underline;">:banner</span> =&gt; <span style="font-style: italic;">'--type data|video'</span>
  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">mount</span>(dir)
    commander = <span style="font-weight: bold; text-decoration: underline;">Commander</span>.new(options[<span style="font-weight: bold; text-decoration: underline;">:log</span>], options[<span style="font-weight: bold; text-decoration: underline;">:dryrun</span>])

    cmd_opts = [<span style="font-style: italic;">'mount'</span>]
    <span style="font-weight: bold;">if</span> options[<span style="font-weight: bold; text-decoration: underline;">:type</span>] == <span style="font-style: italic;">'video'</span> || <span style="font-weight: bold; text-decoration: underline;">FileType</span>.video_dvd_image?(options[<span style="font-weight: bold; text-decoration: underline;">:device</span>])
      cmd_opts &lt;&lt; [<span style="font-style: italic;">'-t'</span>, <span style="font-style: italic;">'iso9660'</span>, <span style="font-style: italic;">'-o'</span>, <span style="font-style: italic;">'loop'</span>]
    <span style="font-weight: bold;">end</span>
    cmd_opts &lt;&lt; options[<span style="font-weight: bold; text-decoration: underline;">:device</span>]
    cmd_opts &lt;&lt; dir

    <span style="font-weight: bold; text-decoration: underline;">Dir</span>.mkdir(dir) <span style="font-weight: bold;">if</span> !<span style="font-weight: bold; text-decoration: underline;">Dir</span>.exist?(dir) &amp;&amp; !options[<span style="font-weight: bold; text-decoration: underline;">:dryrun</span>]
    commander.execute(<span style="font-style: italic;">"sudo </span><span style="font-weight: bold; font-style: italic;">#{cmd_opts.join(' ')}</span><span style="font-style: italic;">"</span>)
  <span style="font-weight: bold;">end</span>

  desc <span style="font-style: italic;">'umount'</span>, <span style="font-style: italic;">'unmount dir'</span>
  option <span style="font-weight: bold; text-decoration: underline;">:remove</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">'r'</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:boolean</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">'remove dir after unmounting'</span>
  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">umount</span>(dir)
    commander = <span style="font-weight: bold; text-decoration: underline;">Commander</span>.new(options[<span style="font-weight: bold; text-decoration: underline;">:log</span>], options[<span style="font-weight: bold; text-decoration: underline;">:dryrun</span>])

    cmd_opts = [<span style="font-style: italic;">'umount'</span>]
    cmd_opts &lt;&lt; dir

    commander.execute(<span style="font-style: italic;">"sudo </span><span style="font-weight: bold; font-style: italic;">#{cmd_opts.join(' ')}</span><span style="font-style: italic;">"</span>)

    <span style="font-weight: bold;">if</span> options[<span style="font-weight: bold; text-decoration: underline;">:remove</span>]
      <span style="font-weight: bold; text-decoration: underline;">FileUtils</span>.rmdir(dir)
    <span style="font-weight: bold;">end</span>
  <span style="font-weight: bold;">end</span>

  desc <span style="font-style: italic;">'mkiso'</span>, <span style="font-style: italic;">'make ISO image file.'</span>
  option <span style="font-weight: bold; text-decoration: underline;">:type</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">'t'</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>, <span style="font-weight: bold; text-decoration: underline;">:required</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">true</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">'DVD image type. Data or Video DVD.'</span>,
         <span style="font-weight: bold; text-decoration: underline;">:banner</span> =&gt; <span style="font-style: italic;">'--type data|video'</span>
  option <span style="font-weight: bold; text-decoration: underline;">:volume</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">'V'</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">'Volume Label'</span>
  option <span style="font-weight: bold; text-decoration: underline;">:out</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">'o'</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">'ISO image file name.'</span>,
         <span style="font-weight: bold; text-decoration: underline;">:banner</span> =&gt; <span style="font-style: italic;">'--out movie.iso'</span>
  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">mkiso</span>(file)
    names = <span style="font-weight: bold; text-decoration: underline;">Names</span>.new(file, options[<span style="font-weight: bold; text-decoration: underline;">:out</span>])
    commander = <span style="font-weight: bold; text-decoration: underline;">Commander</span>.new(options[<span style="font-weight: bold; text-decoration: underline;">:log</span>], options[<span style="font-weight: bold; text-decoration: underline;">:dryrun</span>])

    mkisofs_opts = [<span style="font-style: italic;">'mkisofs'</span>]
    mkisofs_opts &lt;&lt; [<span style="font-style: italic;">"-V"</span>, <span style="font-style: italic;">"\"</span><span style="font-weight: bold; font-style: italic;">#{options[:volume]}</span><span style="font-style: italic;">\""</span>] <span style="font-weight: bold;">if</span> options[<span style="font-weight: bold; text-decoration: underline;">:volume</span>]
    <span style="font-weight: bold;">if</span> options[<span style="font-weight: bold; text-decoration: underline;">:type</span>] == <span style="font-style: italic;">"data"</span>
      mkisofs_opts &lt;&lt; [<span style="font-style: italic;">"-r"</span>, <span style="font-style: italic;">"-l"</span>, <span style="font-style: italic;">"-J"</span>]
    <span style="font-weight: bold;">elsif</span> options[<span style="font-weight: bold; text-decoration: underline;">:type</span>]
      mkisofs_opts &lt;&lt; <span style="font-style: italic;">"-dvd-video"</span>
    <span style="font-weight: bold;">else</span>
      <span style="font-weight: bold;">exit</span> 1
    <span style="font-weight: bold;">end</span>
    mkisofs_opts &lt;&lt; [<span style="font-style: italic;">"-o"</span>, <span style="font-style: italic;">"\"</span><span style="font-weight: bold; font-style: italic;">#{names.out_file('.iso')}</span><span style="font-style: italic;">\""</span>]
    mkisofs_opts &lt;&lt; <span style="font-style: italic;">"\"</span><span style="font-weight: bold; font-style: italic;">#{file}</span><span style="font-style: italic;">\""</span>

    commander.execute(mkisofs_opts.join(<span style="font-style: italic;">" "</span>))
  <span style="font-weight: bold;">end</span>

  desc <span style="font-style: italic;">'dvdburn &lt;file&gt;'</span>, <span style="font-style: italic;">'Burn file to DVD.'</span>
  option <span style="font-weight: bold; text-decoration: underline;">:iso</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">'I'</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:boolean</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">'Set this option if &lt;file&gt; is ISO 9660 compliant.'</span>
  option <span style="font-weight: bold; text-decoration: underline;">:volume</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">'V'</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>, <span style="font-weight: bold; text-decoration: underline;">:default</span> =&gt; <span style="font-style: italic;">'DVD_VIDEO'</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">'Volume Label'</span>
  option <span style="font-weight: bold; text-decoration: underline;">:video</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">'v'</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:boolean</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">'Create DVD video image file to burn.'</span>
  option <span style="font-weight: bold; text-decoration: underline;">:speed</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">'s'</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>, <span style="font-weight: bold; text-decoration: underline;">:default</span> =&gt; <span style="font-style: italic;">'4'</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">'Burning Speed'</span>,
         <span style="font-weight: bold; text-decoration: underline;">:banner</span> =&gt; <span style="font-style: italic;">'n'</span>
  option <span style="font-weight: bold; text-decoration: underline;">:device</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">'d'</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">'Device file'</span>, <span style="font-weight: bold; text-decoration: underline;">:default</span> =&gt; <span style="font-style: italic;">'/dev/sr0'</span>
  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">dvdburn</span>(file)
    commander = <span style="font-weight: bold; text-decoration: underline;">Commander</span>.new(options[<span style="font-weight: bold; text-decoration: underline;">:log</span>], options[<span style="font-weight: bold; text-decoration: underline;">:dryrun</span>])

    cmd_opts = [<span style="font-style: italic;">'growisofs'</span>]
    cmd_opts &lt;&lt; <span style="font-style: italic;">'-dvd-compat'</span>
    cmd_opts &lt;&lt; <span style="font-style: italic;">'-speed=%s'</span> % options[<span style="font-weight: bold; text-decoration: underline;">:speed</span>]
    <span style="font-weight: bold;">if</span> <span style="font-weight: bold; text-decoration: underline;">FileType</span>.iso9660?(file) || options[<span style="font-weight: bold; text-decoration: underline;">:iso</span>]
      cmd_opts &lt;&lt; <span style="font-style: italic;">'-Z %s=%s'</span> % [options[<span style="font-weight: bold; text-decoration: underline;">:device</span>], file]
    <span style="font-weight: bold;">else</span>
      cmd_opts &lt;&lt; <span style="font-style: italic;">'-Z %s'</span> % options[<span style="font-weight: bold; text-decoration: underline;">:device</span>]
      mkisofs_opts = []
      mkisofs_opts &lt;&lt; [<span style="font-style: italic;">'-V'</span>, <span style="font-style: italic;">"\"</span><span style="font-weight: bold; font-style: italic;">#{options[:volume]}</span><span style="font-style: italic;">\""</span>] <span style="font-weight: bold;">if</span> options[<span style="font-weight: bold; text-decoration: underline;">:volume</span>]
      <span style="font-weight: bold;">if</span> options[<span style="font-weight: bold; text-decoration: underline;">:video</span>]
        mkisofs_opts &lt;&lt; <span style="font-style: italic;">'-dvd-video'</span>
      <span style="font-weight: bold;">else</span> <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Data-DVD</span>
        mkisofs_opts &lt;&lt; [<span style="font-style: italic;">'-r'</span>, <span style="font-style: italic;">'-l'</span>, <span style="font-style: italic;">'-R'</span>]
      <span style="font-weight: bold;">end</span>
      mkisofs_opts &lt;&lt; file
      cmd_opts &lt;&lt; mkisofs_opts
    <span style="font-weight: bold;">end</span>

    commander.execute(cmd_opts.join(<span style="font-style: italic;">' '</span>))
  <span style="font-weight: bold;">end</span>

  desc <span style="font-style: italic;">"cdburn"</span>, <span style="font-style: italic;">"burn files to CD device"</span>
  option <span style="font-weight: bold; text-decoration: underline;">:in</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"i"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>, <span style="font-weight: bold; text-decoration: underline;">:required</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">true</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">"Root Directory for image file"</span>
  option <span style="font-weight: bold; text-decoration: underline;">:volume</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"v"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>, <span style="font-weight: bold; text-decoration: underline;">:required</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">true</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">"Volume ID"</span>
  option <span style="font-weight: bold; text-decoration: underline;">:device</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"d"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">"Device file"</span>, <span style="font-weight: bold; text-decoration: underline;">:default</span> =&gt; <span style="font-style: italic;">"/dev/sr0"</span>
  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">cdburn</span>()
    commander = <span style="font-weight: bold; text-decoration: underline;">Commander</span>.new(options[<span style="font-weight: bold; text-decoration: underline;">:log</span>], options[<span style="font-weight: bold; text-decoration: underline;">:dryrun</span>])

    commander.execute(<span style="font-style: italic;">"mkisofs -V \"</span><span style="font-weight: bold; font-style: italic;">#{options[:volume]}</span><span style="font-style: italic;">\" -J -r </span><span style="font-weight: bold; font-style: italic;">#{options[:in]}</span><span style="font-style: italic;"> | cdrecord -v dev=</span><span style="font-weight: bold; font-style: italic;">#{options[:device]}</span><span style="font-style: italic;"> -waiti -"</span>)
  <span style="font-weight: bold;">end</span>

  desc <span style="font-style: italic;">"screenshot"</span>, <span style="font-style: italic;">"take a screenshot of a video at a time"</span>
  option <span style="font-weight: bold; text-decoration: underline;">:in</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"i"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>, <span style="font-weight: bold; text-decoration: underline;">:required</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">true</span>
  option <span style="font-weight: bold; text-decoration: underline;">:out</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"o"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>
  option <span style="font-weight: bold; text-decoration: underline;">:time</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"t"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">"ex. 00:10:22.300"</span>
  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">screenshot</span>()
    equip = <span style="font-weight: bold; text-decoration: underline;">Names</span>.new(options[<span style="font-weight: bold; text-decoration: underline;">:in</span>], options[<span style="font-weight: bold; text-decoration: underline;">:out</span>])
    commander = <span style="font-weight: bold; text-decoration: underline;">Commander</span>.new(options[<span style="font-weight: bold; text-decoration: underline;">:log</span>], options[<span style="font-weight: bold; text-decoration: underline;">:dryrun</span>])
    <span style="font-weight: bold;">if</span> <span style="font-weight: bold; text-decoration: underline;">FileType</span>.video?(equip.in_file) <span style="font-weight: bold;">then</span>
      args = [<span style="font-style: italic;">'ffmpeg'</span>]
      args &lt;&lt; (<span style="font-style: italic;">'-ss %s'</span> % options[<span style="font-weight: bold; text-decoration: underline;">:time</span>]) <span style="font-weight: bold;">if</span> options[<span style="font-weight: bold; text-decoration: underline;">:time</span>]
      args &lt;&lt; <span style="font-style: italic;">'-i %s'</span> % equip.in_file
      args &lt;&lt; <span style="font-style: italic;">'-vframes 1'</span>
      args &lt;&lt; <span style="font-style: italic;">'-q:v 2'</span>
      args &lt;&lt; equip.out_file(<span style="font-style: italic;">'.jpg'</span>)
      commander.execute(args.join(<span style="font-style: italic;">' '</span>))
    <span style="font-weight: bold;">end</span>
  <span style="font-weight: bold;">end</span>

  desc <span style="font-style: italic;">"clip"</span>, <span style="font-style: italic;">"clip a video with specific time span"</span>
  option <span style="font-weight: bold; text-decoration: underline;">:in</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"i"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>, <span style="font-weight: bold; text-decoration: underline;">:required</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">true</span>
  option <span style="font-weight: bold; text-decoration: underline;">:out</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"o"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>
  option <span style="font-weight: bold; text-decoration: underline;">:time_begin</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"b"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">"ex. 00:10:22.300"</span>
  option <span style="font-weight: bold; text-decoration: underline;">:time_end</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"e"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>
  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">clip</span>()
    equip = <span style="font-weight: bold; text-decoration: underline;">Names</span>.new(options[<span style="font-weight: bold; text-decoration: underline;">:in</span>], options[<span style="font-weight: bold; text-decoration: underline;">:out</span>])
    commander = <span style="font-weight: bold; text-decoration: underline;">Commander</span>.new(options[<span style="font-weight: bold; text-decoration: underline;">:log</span>], options[<span style="font-weight: bold; text-decoration: underline;">:dryrun</span>])

    <span style="font-weight: bold;">if</span> <span style="font-weight: bold; text-decoration: underline;">FileType</span>.video?(equip.in_file) <span style="font-weight: bold;">then</span>
      <span style="font-weight: bold;">if</span> options[<span style="font-weight: bold; text-decoration: underline;">:time_begin</span>] <span style="font-weight: bold;">or</span> options[<span style="font-weight: bold; text-decoration: underline;">:time_end</span>] <span style="font-weight: bold;">then</span>
        in_opts = []
        in_opts &lt;&lt; <span style="font-style: italic;">"-ss </span><span style="font-weight: bold; font-style: italic;">#{options[:time_begin]}</span><span style="font-style: italic;">"</span> <span style="font-weight: bold;">if</span> options[<span style="font-weight: bold; text-decoration: underline;">:time_begin</span>]
        in_opts &lt;&lt; <span style="font-style: italic;">"-to </span><span style="font-weight: bold; font-style: italic;">#{options[:time_end]}</span><span style="font-style: italic;">"</span> <span style="font-weight: bold;">if</span> options[<span style="font-weight: bold; text-decoration: underline;">:time_end</span>]
        out_opts = []
        out_opts &lt;&lt; <span style="font-style: italic;">"-vcodec copy"</span>
        out_opts &lt;&lt; <span style="font-style: italic;">"-acodec copy"</span>
        out_opts &lt;&lt; <span style="font-style: italic;">"-map_metadata 0"</span>
        commander.execute(<span style="font-weight: bold; text-decoration: underline;">FFMPEG</span>.command([<span style="font-weight: bold; text-decoration: underline;">FFMPEGOptSet</span>.new(equip.in_file, in_opts)],
                                         [<span style="font-weight: bold; text-decoration: underline;">FFMPEGOptSet</span>.new(equip.out_file, out_opts)]))
      <span style="font-weight: bold;">end</span>
    <span style="font-weight: bold;">else</span>
      <span style="font-weight: bold; text-decoration: underline;">STDERR</span>.puts <span style="font-style: italic;">"This Media Format is not supported on this function"</span>
      <span style="font-weight: bold;">exit</span> <span style="font-weight: bold; text-decoration: underline;">false</span>
    <span style="font-weight: bold;">end</span>
  <span style="font-weight: bold;">end</span>

  desc <span style="font-style: italic;">"crop"</span>, <span style="font-style: italic;">"extract a specific rectangle of a image/video"</span>
  option <span style="font-weight: bold; text-decoration: underline;">:in</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"i"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>, <span style="font-weight: bold; text-decoration: underline;">:required</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">true</span>
  option <span style="font-weight: bold; text-decoration: underline;">:out</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"o"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>
  option <span style="font-weight: bold; text-decoration: underline;">:width</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"w"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:numeric</span>, <span style="font-weight: bold; text-decoration: underline;">:required</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">true</span>
  option <span style="font-weight: bold; text-decoration: underline;">:height</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"h"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:numeric</span>, <span style="font-weight: bold; text-decoration: underline;">:required</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">true</span>
  option <span style="font-weight: bold; text-decoration: underline;">:xpos</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"x"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:numeric</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">"x coordinate of an original image where cropped image of top-left corner overlaps"</span>
  option <span style="font-weight: bold; text-decoration: underline;">:ypos</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"y"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:numeric</span>
  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">crop</span>()
    names = <span style="font-weight: bold; text-decoration: underline;">Names</span>.new(options[<span style="font-weight: bold; text-decoration: underline;">:in</span>], options[<span style="font-weight: bold; text-decoration: underline;">:out</span>])
    commander = <span style="font-weight: bold; text-decoration: underline;">Commander</span>.new(options[<span style="font-weight: bold; text-decoration: underline;">:log</span>], options[<span style="font-weight: bold; text-decoration: underline;">:dryrun</span>])

    width = options[<span style="font-weight: bold; text-decoration: underline;">:width</span>]
    height = options[<span style="font-weight: bold; text-decoration: underline;">:height</span>]
    xpos = options[<span style="font-weight: bold; text-decoration: underline;">:xpos</span>] ? options[<span style="font-weight: bold; text-decoration: underline;">:xpos</span>] : 0
    ypos = options[<span style="font-weight: bold; text-decoration: underline;">:ypos</span>] ? options[<span style="font-weight: bold; text-decoration: underline;">:ypos</span>] : 0
    <span style="font-weight: bold;">if</span> <span style="font-weight: bold; text-decoration: underline;">FileType</span>.image?(names.in_file) <span style="font-weight: bold;">then</span>
      opt = <span style="font-style: italic;">'-crop %dx%d+%dx%d'</span> % [width, height, xpos, ypos]
      commander.execute(<span style="font-style: italic;">"convert </span><span style="font-weight: bold; font-style: italic;">#{opt}</span><span style="font-style: italic;"> </span><span style="font-weight: bold; font-style: italic;">#{names.in_file}</span><span style="font-style: italic;"> </span><span style="font-weight: bold; font-style: italic;">#{names.out_file}</span><span style="font-style: italic;">"</span>)
    <span style="font-weight: bold;">elsif</span> <span style="font-weight: bold; text-decoration: underline;">FileType</span>.video?(names.in_file) <span style="font-weight: bold;">then</span>
      args = [<span style="font-style: italic;">'ffmpeg'</span>]
      args &lt;&lt; <span style="font-style: italic;">'-i %s'</span> % names.in_file
      args &lt;&lt; <span style="font-style: italic;">'-vf crop=%d:%d:%d:%d'</span> % [width, height, xpos, ypos]
      args &lt;&lt; <span style="font-style: italic;">"-map_metadata 0"</span>
      args &lt;&lt; names.out_file
      commander.execute(args.join(<span style="font-style: italic;">' '</span>))
    <span style="font-weight: bold;">else</span>
      <span style="font-weight: bold; text-decoration: underline;">STDERR</span>.puts <span style="font-style: italic;">"This Media Format is not supported on this function"</span>
      <span style="font-weight: bold;">exit</span> <span style="font-weight: bold; text-decoration: underline;">false</span>
    <span style="font-weight: bold;">end</span>
  <span style="font-weight: bold;">end</span>

  desc <span style="font-style: italic;">"trim"</span>, <span style="font-style: italic;">"trim a image/video with automated detection"</span>
  option <span style="font-weight: bold; text-decoration: underline;">:in</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"i"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>, <span style="font-weight: bold; text-decoration: underline;">:required</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">true</span>
  option <span style="font-weight: bold; text-decoration: underline;">:out</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"o"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>
  option <span style="font-weight: bold; text-decoration: underline;">:threshold</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"t"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">"threshold where trimming begin and end"</span>
  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">trim</span>()
    names = <span style="font-weight: bold; text-decoration: underline;">Names</span>.new(options[<span style="font-weight: bold; text-decoration: underline;">:in</span>], options[<span style="font-weight: bold; text-decoration: underline;">:out</span>])
    commander = <span style="font-weight: bold; text-decoration: underline;">Commander</span>.new(options[<span style="font-weight: bold; text-decoration: underline;">:log</span>], options[<span style="font-weight: bold; text-decoration: underline;">:dryrun</span>])

    <span style="font-weight: bold;">if</span> <span style="font-weight: bold; text-decoration: underline;">FileType</span>.image?(names.in_file) <span style="font-weight: bold;">then</span>
      commander.execute(<span style="font-style: italic;">"convert -trim </span><span style="font-weight: bold; font-style: italic;">#{names.in_file}</span><span style="font-style: italic;"> </span><span style="font-weight: bold; font-style: italic;">#{names.out_file}</span><span style="font-style: italic;">"</span>)
    <span style="font-weight: bold;">elsif</span> <span style="font-weight: bold; text-decoration: underline;">FileType</span>.audio?(names.in_file) <span style="font-weight: bold;">then</span>
      threshold = (options[<span style="font-weight: bold; text-decoration: underline;">:threshold</span>]) ? options[<span style="font-weight: bold; text-decoration: underline;">:threshold</span>] : <span style="font-style: italic;">"-40dB"</span>
      commander.execute(<span style="font-style: italic;">"ffmpeg -i </span><span style="font-weight: bold; font-style: italic;">#{names.in_file}</span><span style="font-style: italic;"> -af \"silenceremove=start_periods=1:start_duration=0:start_threshold=</span><span style="font-weight: bold; font-style: italic;">#{threshold}</span><span style="font-style: italic;">:detection=peak\" </span><span style="font-weight: bold; font-style: italic;">#{names.out_file}</span><span style="font-style: italic;">"</span>)
    <span style="font-weight: bold;">end</span>
  <span style="font-weight: bold;">end</span>

  desc <span style="font-style: italic;">"resize"</span>, <span style="font-style: italic;">"resize the image"</span>
  option <span style="font-weight: bold; text-decoration: underline;">:in</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"i"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>, <span style="font-weight: bold; text-decoration: underline;">:required</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">true</span>
  option <span style="font-weight: bold; text-decoration: underline;">:out</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"o"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>
  option <span style="font-weight: bold; text-decoration: underline;">:width</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"w"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:banner</span> =&gt; <span style="font-style: italic;">"e.g. 300"</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">"resized image width"</span>
  option <span style="font-weight: bold; text-decoration: underline;">:height</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"h"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:banner</span> =&gt; <span style="font-style: italic;">"e.g. 200"</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">"resized image height"</span>
  option <span style="font-weight: bold; text-decoration: underline;">:operation</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"p"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:banner</span> =&gt; <span style="font-style: italic;">"enlarge|shrink"</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">"permitted operation for resizing"</span>
  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">resize</span>()
    names = <span style="font-weight: bold; text-decoration: underline;">Names</span>.new(options[<span style="font-weight: bold; text-decoration: underline;">:in</span>], options[<span style="font-weight: bold; text-decoration: underline;">:out</span>])
    commander = <span style="font-weight: bold; text-decoration: underline;">Commander</span>.new(options[<span style="font-weight: bold; text-decoration: underline;">:log</span>], options[<span style="font-weight: bold; text-decoration: underline;">:dryrun</span>])

    <span style="font-weight: bold;">if</span> <span style="font-weight: bold; text-decoration: underline;">FileType</span>.video?(names.in_file) <span style="font-weight: bold;">then</span>
      <span style="font-weight: bold;">if</span> options[<span style="font-weight: bold; text-decoration: underline;">:width</span>] <span style="font-weight: bold;">and</span> options[<span style="font-weight: bold; text-decoration: underline;">:height</span>]
        out_opts = []
        out_opts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"-vf scale=%s:%s,setsar=1:1"</span>, options[<span style="font-weight: bold; text-decoration: underline;">:width</span>], options[<span style="font-weight: bold; text-decoration: underline;">:height</span>])
        commander.execute(<span style="font-weight: bold; text-decoration: underline;">FFMPEG</span>.command([<span style="font-weight: bold; text-decoration: underline;">FFMPEGOptSet</span>.new(names.in_file, [])],
                                         [<span style="font-weight: bold; text-decoration: underline;">FFMPEGOptSet</span>.new(names.out_file, out_opts)]))
      <span style="font-weight: bold;">end</span>
    <span style="font-weight: bold;">elsif</span> <span style="font-weight: bold; text-decoration: underline;">FileType</span>.image?(names.in_file) <span style="font-weight: bold;">then</span>
      <span style="font-weight: bold;">return</span> <span style="font-weight: bold;">if</span> options[<span style="font-weight: bold; text-decoration: underline;">:width</span>] == <span style="font-weight: bold; text-decoration: underline;">nil</span> &amp;&amp; options[<span style="font-weight: bold; text-decoration: underline;">:height</span>] == <span style="font-weight: bold; text-decoration: underline;">nil</span>
      <span style="font-weight: bold;">if</span> options[<span style="font-weight: bold; text-decoration: underline;">:operation</span>] == <span style="font-style: italic;">"enlarge"</span>
        op = <span style="font-style: italic;">"&lt;"</span>
      <span style="font-weight: bold;">elsif</span> options[<span style="font-weight: bold; text-decoration: underline;">:operation</span>] == <span style="font-style: italic;">"shrink"</span>
        op = <span style="font-style: italic;">"&gt;"</span>
      <span style="font-weight: bold;">else</span>
        op = <span style="font-style: italic;">""</span>
      <span style="font-weight: bold;">end</span>
      geometry = <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"%sx%s%s"</span>, options[<span style="font-weight: bold; text-decoration: underline;">:width</span>], options[<span style="font-weight: bold; text-decoration: underline;">:height</span>], op)
      commander.execute(<span style="font-style: italic;">"convert -resize </span><span style="font-weight: bold; font-style: italic;">#{geometry}</span><span style="font-style: italic;"> </span><span style="font-weight: bold; font-style: italic;">#{names.in_file}</span><span style="font-style: italic;"> </span><span style="font-weight: bold; font-style: italic;">#{names.out_file}</span><span style="font-style: italic;">"</span>)
    <span style="font-weight: bold;">end</span>
  <span style="font-weight: bold;">end</span>

  desc <span style="font-style: italic;">"concat"</span>, <span style="font-style: italic;">"concat multiple files"</span>
  option <span style="font-weight: bold; text-decoration: underline;">:in</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"i"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:array</span>, <span style="font-weight: bold; text-decoration: underline;">:required</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">true</span>
  option <span style="font-weight: bold; text-decoration: underline;">:out</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"o"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>
  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">concat</span>()
    names = <span style="font-weight: bold; text-decoration: underline;">Names</span>.new(options[<span style="font-weight: bold; text-decoration: underline;">:in</span>][0], options[<span style="font-weight: bold; text-decoration: underline;">:out</span>])
    commander = <span style="font-weight: bold; text-decoration: underline;">Commander</span>.new(options[<span style="font-weight: bold; text-decoration: underline;">:log</span>], options[<span style="font-weight: bold; text-decoration: underline;">:dryrun</span>])

    srcs = options[<span style="font-weight: bold; text-decoration: underline;">:in</span>]
    output = names.out_file

    <span style="font-weight: bold;">if</span> srcs.all? { |src| <span style="font-weight: bold; text-decoration: underline;">FileType</span>.video?(src) }
      src_list = <span style="font-style: italic;">""</span>
      src_file = <span style="font-weight: bold; text-decoration: underline;">Tempfile</span>.open()
      chap_file = <span style="font-weight: bold; text-decoration: underline;">Tempfile</span>.open()
      chap_file.write(<span style="font-style: italic;">"### Create Chapterfile ###\n"</span>)
      files_to_remove = []
      time_accumulated = <span style="font-weight: bold; text-decoration: underline;">Time</span>.new(0)
      srcs.each_with_index <span style="font-weight: bold;">do</span> |src, index|
        valid_src =
          <span style="font-weight: bold;">if</span> src =~ <span style="font-style: italic;">/^\p{Ascii}+$/</span>
            src
          <span style="font-weight: bold;">else</span>
            <span style="font-weight: bold; text-decoration: underline;">Dir</span>::<span style="font-weight: bold; text-decoration: underline;">Tmpname</span>.create(<span style="font-style: italic;">'base'</span>) <span style="font-weight: bold;">do</span> |src_dup|
              <span style="font-weight: bold; text-decoration: underline;">FileUtils</span>.cp(src, src_dup)
              files_to_remove &lt;&lt; src_dup
              src_dup
            <span style="font-weight: bold;">end</span>
          <span style="font-weight: bold;">end</span>
        src_file.write(<span style="font-style: italic;">"file '</span><span style="font-weight: bold; font-style: italic;">#{File.expand_path(valid_src)}</span><span style="font-style: italic;">'\n"</span>)
        chap_file.write(<span style="font-style: italic;">"CHAPTER</span><span style="font-weight: bold; font-style: italic;">#{index + 1}</span><span style="font-style: italic;">=</span><span style="font-weight: bold; font-style: italic;">#{time_accumulated.strftime('%H:%M:%S.%L')}</span><span style="font-style: italic;">\n"</span>)
        chap_file.write(<span style="font-style: italic;">"CHAPTER</span><span style="font-weight: bold; font-style: italic;">#{index + 1}</span><span style="font-style: italic;">NAME=</span><span style="font-weight: bold; font-style: italic;">#{File.basename(src, File.extname(src))}</span><span style="font-style: italic;">\n"</span>)
        duration = <span style="font-style: italic;">`ffprobe -v error -show_entries format=duration -of default=noprint_wrappers=1:nokey=1 "</span><span style="font-weight: bold; font-style: italic;">#{src}</span><span style="font-style: italic;">"`</span>.strip().to_f()
        time_accumulated += duration
      <span style="font-weight: bold;">end</span>
      src_file.flush
      commander.execute(<span style="font-style: italic;">"ffmpeg -n -f concat -safe 0 -i </span><span style="font-weight: bold; font-style: italic;">#{src_file.path}</span><span style="font-style: italic;"> -c:v copy -c:a copy -c:s copy -map 0:v -map 0:a -map 0:s? </span><span style="font-weight: bold; font-style: italic;">#{output}</span><span style="font-style: italic;">"</span>)
      src_file.close
      chap_file.flush
      commander.execute(<span style="font-style: italic;">"MP4Box -chap </span><span style="font-weight: bold; font-style: italic;">#{chap_file.path}</span><span style="font-style: italic;"> </span><span style="font-weight: bold; font-style: italic;">#{output}</span><span style="font-style: italic;">"</span>)
      chap_file.close
      src_file.unlink
      chap_file.unlink
      <span style="font-weight: bold; text-decoration: underline;">FileUtils</span>.rm_f(files_to_remove)
    <span style="font-weight: bold;">elsif</span> srcs.all? { |src| <span style="font-weight: bold; text-decoration: underline;">FileType</span>.image?(src) }
      commander.execute <span style="font-style: italic;">"convert </span><span style="font-weight: bold; font-style: italic;">#{srcs.join(' ')}</span><span style="font-style: italic;"> </span><span style="font-weight: bold; font-style: italic;">#{output}</span><span style="font-style: italic;">"</span>
    <span style="font-weight: bold;">else</span>
      <span style="font-weight: bold; text-decoration: underline;">STDERR</span>.puts <span style="font-style: italic;">"This Media Format is not supported on this function"</span>
      <span style="font-weight: bold;">exit</span> <span style="font-weight: bold; text-decoration: underline;">false</span>
    <span style="font-weight: bold;">end</span>
  <span style="font-weight: bold;">end</span>

  desc <span style="font-style: italic;">"diff"</span>, <span style="font-style: italic;">"measure the difference by providing SSIM value"</span>
  option <span style="font-weight: bold; text-decoration: underline;">:out</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"o"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>
  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">diff</span>(file1, file2)
    commander = <span style="font-weight: bold; text-decoration: underline;">Commander</span>.new(options[<span style="font-weight: bold; text-decoration: underline;">:log</span>], options[<span style="font-weight: bold; text-decoration: underline;">:dryrun</span>])

    <span style="font-weight: bold;">if</span> ((<span style="font-weight: bold; text-decoration: underline;">FileType</span>.video?(file1) <span style="font-weight: bold;">and</span> <span style="font-weight: bold; text-decoration: underline;">FileType</span>.video?(file2)) <span style="font-weight: bold;">or</span>
        (<span style="font-weight: bold; text-decoration: underline;">FileType</span>.image?(file1) <span style="font-weight: bold;">and</span> <span style="font-weight: bold; text-decoration: underline;">FileType</span>.image?(file2))) <span style="font-weight: bold;">then</span>
      <span style="font-weight: bold;">if</span> options[<span style="font-weight: bold; text-decoration: underline;">:out</span>] <span style="font-weight: bold;">then</span>
        commander.execute(<span style="font-style: italic;">"ffmpeg -i </span><span style="font-weight: bold; font-style: italic;">#{file1}</span><span style="font-style: italic;"> -i </span><span style="font-weight: bold; font-style: italic;">#{file2}</span><span style="font-style: italic;"> -filter_complex ssim=</span><span style="font-weight: bold; font-style: italic;">#{options[:out]}</span><span style="font-style: italic;"> -an -f null -"</span>)
      <span style="font-weight: bold;">else</span>
        commander.execute(<span style="font-style: italic;">"ffmpeg -i </span><span style="font-weight: bold; font-style: italic;">#{file1}</span><span style="font-style: italic;"> -i </span><span style="font-weight: bold; font-style: italic;">#{file2}</span><span style="font-style: italic;"> -filter_complex ssim -an -f null -"</span>)
      <span style="font-weight: bold;">end</span>
    <span style="font-weight: bold;">end</span>
  <span style="font-weight: bold;">end</span>

  desc <span style="font-style: italic;">"mux"</span>, <span style="font-style: italic;">"mux to one file which has streams correspond with input files"</span>
  option <span style="font-weight: bold; text-decoration: underline;">:video</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"v"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>, <span style="font-weight: bold; text-decoration: underline;">:required</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">true</span>
  option <span style="font-weight: bold; text-decoration: underline;">:audio</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"a"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>, <span style="font-weight: bold; text-decoration: underline;">:required</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">true</span>
  option <span style="font-weight: bold; text-decoration: underline;">:audio_delay</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"d"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>
  option <span style="font-weight: bold; text-decoration: underline;">:out</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"o"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>
  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">mux</span>()
    names = <span style="font-weight: bold; text-decoration: underline;">Names</span>.new(options[<span style="font-weight: bold; text-decoration: underline;">:video</span>], options[<span style="font-weight: bold; text-decoration: underline;">:out</span>])
    commander = <span style="font-weight: bold; text-decoration: underline;">Commander</span>.new(options[<span style="font-weight: bold; text-decoration: underline;">:log</span>], options[<span style="font-weight: bold; text-decoration: underline;">:dryrun</span>])

    in_optsets = []
    in_optsets &lt;&lt; <span style="font-weight: bold; text-decoration: underline;">FFMPEGOptSet</span>.new(options[<span style="font-weight: bold; text-decoration: underline;">:video</span>], [])
    aconf = []
    aconf &lt;&lt; <span style="font-style: italic;">"-itsoffset </span><span style="font-weight: bold; font-style: italic;">#{options[:audio_delay]}</span><span style="font-style: italic;">"</span> <span style="font-weight: bold;">if</span> options[<span style="font-weight: bold; text-decoration: underline;">:audio_delay</span>]
    in_optsets &lt;&lt; <span style="font-weight: bold; text-decoration: underline;">FFMPEGOptSet</span>.new(options[<span style="font-weight: bold; text-decoration: underline;">:audio</span>], aconf)
    commander.execute(<span style="font-weight: bold; text-decoration: underline;">FFMPEG</span>.command(in_optsets,
                                     [<span style="font-weight: bold; text-decoration: underline;">FFMPEGOptSet</span>.new(names.out_file, [])]))
  <span style="font-weight: bold;">end</span>
<span style="font-weight: bold;">end</span>

<span style="font-weight: bold;">class</span> <span style="font-weight: bold; text-decoration: underline;">MainConfig</span>
  <span style="font-weight: bold;">attr_accessor</span> <span style="font-weight: bold; text-decoration: underline;">:start</span>, <span style="font-weight: bold; text-decoration: underline;">:end</span>
<span style="font-weight: bold;">end</span>

<span style="font-weight: bold;">class</span> <span style="font-weight: bold; text-decoration: underline;">VideoConfig</span>
  <span style="font-weight: bold;">attr_accessor</span> <span style="font-weight: bold; text-decoration: underline;">:encode</span>, <span style="font-weight: bold; text-decoration: underline;">:quality</span>, <span style="font-weight: bold; text-decoration: underline;">:bitrate</span>, <span style="font-weight: bold; text-decoration: underline;">:preset</span>, <span style="font-weight: bold; text-decoration: underline;">:tune</span>, <span style="font-weight: bold; text-decoration: underline;">:profile</span>, <span style="font-weight: bold; text-decoration: underline;">:level</span>

  <span style="font-weight: bold; text-decoration: underline;">DEFAULT_ENCODE</span> = <span style="font-style: italic;">'vp9'</span>
  <span style="font-weight: bold; text-decoration: underline;">DEFAULT_QUALITY</span> = <span style="font-style: italic;">'26'</span>
  <span style="font-weight: bold; text-decoration: underline;">DEFAULT_BITRATE</span> = <span style="font-style: italic;">'1000'</span>

  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">initialize</span>(encode, quality=<span style="font-weight: bold; text-decoration: underline;">nil</span>, bitrate=<span style="font-weight: bold; text-decoration: underline;">nil</span>)
    <span style="font-weight: bold; font-style: italic;">@encode</span> = encode
    <span style="font-weight: bold; font-style: italic;">@quality</span> = quality
    <span style="font-weight: bold; font-style: italic;">@bitrate</span> = bitrate

    <span style="font-weight: bold;">case</span> <span style="font-weight: bold; font-style: italic;">@encode</span>
    <span style="font-weight: bold;">when</span> <span style="font-style: italic;">"x265"</span>
      <span style="font-weight: bold; font-style: italic;">@preset</span> = <span style="font-style: italic;">"veryslow"</span>
      <span style="font-weight: bold; font-style: italic;">@tune</span> = <span style="font-style: italic;">"ssim"</span>
      <span style="font-weight: bold; font-style: italic;">@profile</span> = <span style="font-style: italic;">"main"</span>
      <span style="font-weight: bold; font-style: italic;">@level</span> = <span style="font-weight: bold; text-decoration: underline;">nil</span>
    <span style="font-weight: bold;">when</span> <span style="font-style: italic;">"x264"</span>
      <span style="font-weight: bold; font-style: italic;">@preset</span> = <span style="font-style: italic;">"veryslow"</span>
      <span style="font-weight: bold; font-style: italic;">@tune</span> = <span style="font-style: italic;">"film"</span>
      <span style="font-weight: bold; font-style: italic;">@profile</span> = <span style="font-style: italic;">"main"</span>
      <span style="font-weight: bold; font-style: italic;">@level</span> = <span style="font-style: italic;">"4.1"</span>
    <span style="font-weight: bold;">end</span>
  <span style="font-weight: bold;">end</span>
<span style="font-weight: bold;">end</span>

<span style="font-weight: bold;">class</span> <span style="font-weight: bold; text-decoration: underline;">PictureConfig</span>
  <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">conversion options</span>
  <span style="font-weight: bold;">attr_accessor</span> <span style="font-weight: bold; text-decoration: underline;">:vf_opts</span>, <span style="font-weight: bold; text-decoration: underline;">:fps</span>

  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">initialize</span>()
    <span style="font-weight: bold; font-style: italic;">@vf_opts</span> = []
    <span style="font-weight: bold; font-style: italic;">@vf_opts</span> &lt;&lt; <span style="font-style: italic;">"format=yuv420p"</span>
  <span style="font-weight: bold;">end</span>

  <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">down-size to fit to display (width:heigh) in keeping aspect ratio</span>
  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">fit_size</span>(display_size)
    <span style="font-weight: bold; font-style: italic;">@vf_opts</span> &lt;&lt; <span style="font-style: italic;">"scale=</span><span style="font-weight: bold; font-style: italic;">#{display_size}</span><span style="font-style: italic;">:force_original_aspect_ratio=decrease"</span>
    <span style="font-weight: bold; font-style: italic;">@vf_opts</span> &lt;&lt; <span style="font-style: italic;">"pad=((iw+1)/2)*2:((ih+1)/2)*2"</span> <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">avoid width/height to odd</span>
  <span style="font-weight: bold;">end</span>

  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">decrease_framerate</span>(fps)
    <span style="font-weight: bold; font-style: italic;">@fps</span> = fps
  <span style="font-weight: bold;">end</span>
<span style="font-weight: bold;">end</span>

<span style="font-weight: bold;">class</span> <span style="font-weight: bold; text-decoration: underline;">AudioConfig</span>
  <span style="font-weight: bold;">attr_accessor</span> <span style="font-weight: bold; text-decoration: underline;">:encode</span>, <span style="font-weight: bold; text-decoration: underline;">:quality</span>, <span style="font-weight: bold; text-decoration: underline;">:bitrate</span>

  <span style="font-weight: bold; text-decoration: underline;">DEFAULT_ENCODE</span> = <span style="font-style: italic;">'opus'</span>
  <span style="font-weight: bold; text-decoration: underline;">DEFAULT_QUALITY</span> = <span style="font-style: italic;">'100'</span>
  <span style="font-weight: bold; text-decoration: underline;">DEFAULT_BITRATE</span> = <span style="font-style: italic;">'128'</span>

  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">initialize</span>(encode, quality=<span style="font-weight: bold; text-decoration: underline;">nil</span>, bitrate=<span style="font-weight: bold; text-decoration: underline;">nil</span>)
    <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">@encode = (encode ? encode : DEFAULT_ENCODE)</span>
    <span style="font-weight: bold; font-style: italic;">@encode</span> = encode
    <span style="font-weight: bold; font-style: italic;">@quality</span> = quality
    <span style="font-weight: bold; font-style: italic;">@bitrate</span> = bitrate
  <span style="font-weight: bold;">end</span>

  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">quality</span>
    <span style="font-weight: bold;">case</span> <span style="font-weight: bold; font-style: italic;">@encode</span>
    <span style="font-weight: bold;">when</span> <span style="font-style: italic;">'opus'</span>
    <span style="font-weight: bold;">else</span>
      <span style="font-weight: bold; font-style: italic;">@quality</span>
    <span style="font-weight: bold;">end</span>
  <span style="font-weight: bold;">end</span>

  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">bitrate</span>
    <span style="font-weight: bold;">case</span> <span style="font-weight: bold; font-style: italic;">@encode</span>
    <span style="font-weight: bold;">when</span> <span style="font-style: italic;">'opus'</span>
      (<span style="font-weight: bold; font-style: italic;">@bitrate</span> ? <span style="font-weight: bold; font-style: italic;">@bitrate</span> : <span style="font-weight: bold; text-decoration: underline;">DEFAULT_BITRATE</span>)
    <span style="font-weight: bold;">else</span>
      <span style="font-weight: bold; font-style: italic;">@bitrate</span>
    <span style="font-weight: bold;">end</span>
  <span style="font-weight: bold;">end</span>
<span style="font-weight: bold;">end</span>

<span style="font-weight: bold;">class</span> <span style="font-weight: bold; text-decoration: underline;">DVDConfig</span>
  <span style="font-weight: bold;">attr_accessor</span> <span style="font-weight: bold; text-decoration: underline;">:title</span>, <span style="font-weight: bold; text-decoration: underline;">:chapters</span>, <span style="font-weight: bold; text-decoration: underline;">:audio</span>, <span style="font-weight: bold; text-decoration: underline;">:subtitle</span>, <span style="font-weight: bold; text-decoration: underline;">:options</span>
  <span style="font-weight: bold;">attr_accessor</span> <span style="font-weight: bold; text-decoration: underline;">:chapter_marker</span>

  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">initialize</span>
    <span style="font-weight: bold; font-style: italic;">@chapter_marker</span> = <span style="font-weight: bold; text-decoration: underline;">true</span>
  <span style="font-weight: bold;">end</span>
<span style="font-weight: bold;">end</span>

<span style="font-weight: bold;">class</span> <span style="font-weight: bold; text-decoration: underline;">ImageConfig</span>
  <span style="font-weight: bold;">attr_reader</span> <span style="font-weight: bold; text-decoration: underline;">:quality</span> <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">1~100</span>
<span style="font-weight: bold;">end</span>

<span style="font-weight: bold;">class</span> <span style="font-weight: bold; text-decoration: underline;">FFMPEGOptSet</span> &lt; <span style="font-weight: bold; text-decoration: underline;">Struct</span>.new(<span style="font-weight: bold; text-decoration: underline;">:fname</span>, <span style="font-weight: bold; text-decoration: underline;">:optset</span>)
<span style="font-weight: bold;">end</span>

<span style="font-weight: bold;">class</span> <span style="font-weight: bold; text-decoration: underline;">FFMPEG</span>
  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">self</span>.<span style="font-weight: bold;">command</span>(in_optsets, out_optsets)
    opts = [<span style="font-style: italic;">"ffmpeg"</span>]

    infilep = <span style="font-weight: bold;">proc</span> <span style="font-weight: bold;">do</span> |fname, optset|
      opt_arr = []
      optset.each <span style="font-weight: bold;">do</span> |opt|
        <span style="font-weight: bold;">if</span> opt.instance_of?(<span style="font-weight: bold; text-decoration: underline;">String</span>)
          opt_arr &lt;&lt; opt
        <span style="font-weight: bold;">end</span>
      <span style="font-weight: bold;">end</span>
      opt_arr &lt;&lt; [<span style="font-style: italic;">"-i"</span>, <span style="font-style: italic;">"\"</span><span style="font-weight: bold; font-style: italic;">#{fname}</span><span style="font-style: italic;">\""</span>]
      <span style="font-weight: bold;">next</span> opt_arr
    <span style="font-weight: bold;">end</span>
    in_optsets.each <span style="font-weight: bold;">do</span> |in_optset|
      opts &lt;&lt; infilep.call(in_optset.fname, in_optset.optset)
    <span style="font-weight: bold;">end</span>

    outfilep = <span style="font-weight: bold;">proc</span> <span style="font-weight: bold;">do</span> |fname, optset|
      oopts = []
      optset.each <span style="font-weight: bold;">do</span> |opt|
        <span style="font-weight: bold;">if</span> opt.instance_of?(<span style="font-weight: bold; text-decoration: underline;">VideoConfig</span>)
          <span style="font-weight: bold;">case</span> opt.encode
          <span style="font-weight: bold;">when</span> <span style="font-style: italic;">'av1'</span>
            oopts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"-c:v librav1e"</span>)
            <span style="font-weight: bold;">if</span> opt.bitrate
              oopts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"-b:v %sk"</span>, opt.bitrate)
            <span style="font-weight: bold;">end</span>
          <span style="font-weight: bold;">when</span> <span style="font-style: italic;">'vp9'</span>
            oopts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"-c:v libvpx-vp9"</span>)
            <span style="font-weight: bold;">if</span> opt.quality
              oopts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"-crf %s"</span>, opt.quality)
              oopts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"-b:v 0"</span>)
            <span style="font-weight: bold;">elsif</span> opt.bitrate
              oopts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"-b:v %s"</span>, opt.bitrate)
            <span style="font-weight: bold;">end</span>
          <span style="font-weight: bold;">when</span> <span style="font-style: italic;">'h265'</span>
            oopts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"-c:v libx265"</span>)
            oopts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"-crf %s"</span>, opt.quality)
            oopts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"-preset %s"</span>, opt.preset) <span style="font-weight: bold;">if</span> opt.preset
            oopts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"-tune %s"</span>, opt.tune) <span style="font-weight: bold;">if</span> opt.tune
            <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Currently, ffmpeg &#8203;does not support setting profiles on x265</span>
            oopts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"-profile:v %s"</span>, opt.profile) <span style="font-weight: bold;">if</span> opt.profile &amp;&amp; opt.encoder == <span style="font-style: italic;">'x264'</span>
            oopts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"-level %s"</span>, opt.level) <span style="font-weight: bold;">if</span> opt.level
          <span style="font-weight: bold;">else</span>
            oopts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"-c:v copy"</span>)
          <span style="font-weight: bold;">end</span>
        <span style="font-weight: bold;">elsif</span> opt.instance_of?(<span style="font-weight: bold; text-decoration: underline;">AudioConfig</span>)
          <span style="font-weight: bold;">case</span> opt.encode
          <span style="font-weight: bold;">when</span> <span style="font-style: italic;">'opus'</span>
            oopts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"-c:a lib%s"</span>, opt.encode)
            oopts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"-b:a %sk"</span>, opt.bitrate) <span style="font-weight: bold;">if</span> opt.bitrate
          <span style="font-weight: bold;">when</span> <span style="font-style: italic;">'aac'</span>
            oopts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"-c:a libfdk_aac"</span>)
            <span style="font-weight: bold;">if</span> opt.quality
              oopts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"-aq %s"</span>, opt.quality)
              oopts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"-b:a 0"</span>)
            <span style="font-weight: bold;">elsif</span> opt.bitrate
              oopts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"-b:a %s"</span>, opt.bitrate)
            <span style="font-weight: bold;">end</span>
          <span style="font-weight: bold;">else</span>
            oopts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"-c:a copy"</span>)
          <span style="font-weight: bold;">end</span>
        <span style="font-weight: bold;">elsif</span> opt.instance_of?(<span style="font-weight: bold; text-decoration: underline;">PictureConfig</span>)
          oopts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"-vf \"%s\""</span>, opt.vf_opts.join(<span style="font-style: italic;">","</span>)) <span style="font-weight: bold;">if</span> opt.vf_opts &amp;&amp; opt.vf_opts.any?
          oopts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"-r %s"</span>, opt.fps) <span style="font-weight: bold;">if</span> opt.fps
        <span style="font-weight: bold;">elsif</span> opt.instance_of?(<span style="font-weight: bold; text-decoration: underline;">String</span>)
          oopts &lt;&lt; opt
        <span style="font-weight: bold;">end</span>
      <span style="font-weight: bold;">end</span>
      oopts &lt;&lt; <span style="font-style: italic;">"\"</span><span style="font-weight: bold; font-style: italic;">#{fname}</span><span style="font-style: italic;">\""</span>
      <span style="font-weight: bold;">next</span> oopts
    <span style="font-weight: bold;">end</span>
    out_optsets.each <span style="font-weight: bold;">do</span> |out_optset|
      opts &lt;&lt; outfilep.call(out_optset.fname, out_optset.optset)
    <span style="font-weight: bold;">end</span>

    opts.join(<span style="font-style: italic;">" "</span>)
  <span style="font-weight: bold;">end</span>
<span style="font-weight: bold;">end</span>

<span style="font-weight: bold;">class</span> <span style="font-weight: bold; text-decoration: underline;">HandBrakeCLI</span>
  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">self</span>.<span style="font-weight: bold;">command</span>(input, output, configs, raw_option)
    cmd_opts = [<span style="font-style: italic;">"HandBrakeCLI"</span>]
    cmd_opts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"--input \"%s\""</span>, input)
    cmd_opts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"--output \"%s\""</span>, output)
    configs.each <span style="font-weight: bold;">do</span> |config|
      <span style="font-weight: bold;">if</span> config.instance_of?(<span style="font-weight: bold; text-decoration: underline;">VideoConfig</span>)
        <span style="font-weight: bold;">case</span> config.encode
        <span style="font-weight: bold;">when</span> <span style="font-style: italic;">'vp9'</span>
          cmd_opts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"--encoder VP9"</span>)
          <span style="font-weight: bold;">if</span> config.quality
            cmd_opts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"--quality %s"</span>, config.quality)
            cmd_opts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"--vb 0"</span>)
          <span style="font-weight: bold;">elsif</span> config.bitrate
            cmd_opts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"--vb %s"</span>, config.bitrate)
          <span style="font-weight: bold;">end</span>
          cmd_opts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"--encoder-preset veryslow"</span>)
        <span style="font-weight: bold;">when</span> <span style="font-style: italic;">'h265'</span> || <span style="font-style: italic;">'hevc'</span>
          cmd_opts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"--encoder x265"</span>)
          <span style="font-weight: bold;">if</span> config.quality
            cmd_opts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"--quality %s"</span>, config.quality)
            cmd_opts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"--vb 0"</span>)
          <span style="font-weight: bold;">elsif</span> config.bitrate
            cmd_opts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"--vb %s"</span>, config.bitrate)
          <span style="font-weight: bold;">end</span>
          cmd_opts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"--encoder-preset %s"</span>, config.preset) <span style="font-weight: bold;">if</span> config.preset
          cmd_opts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"--encoder-tune %s"</span>, config.tune) <span style="font-weight: bold;">if</span> config.tune
          cmd_opts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"--encoder-profile %s"</span>, config.profile) <span style="font-weight: bold;">if</span> config.profile
          cmd_opts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"--encoder-level %s"</span>, config.level) <span style="font-weight: bold;">if</span> config.level
        <span style="font-weight: bold;">else</span>
          cmd_opts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"--encoder %s"</span>, config.encode) <span style="font-weight: bold;">if</span> config.encode
          cmd_opts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"--quality %s"</span>, config.quality) <span style="font-weight: bold;">if</span> config.quality
          cmd_opts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"--vb %s"</span>, config.bitrate) <span style="font-weight: bold;">if</span> config.bitrate
        <span style="font-weight: bold;">end</span>
      <span style="font-weight: bold;">elsif</span> config.instance_of?(<span style="font-weight: bold; text-decoration: underline;">AudioConfig</span>)
        <span style="font-weight: bold;">case</span> config.encode
        <span style="font-weight: bold;">when</span> <span style="font-style: italic;">'opus'</span>
          cmd_opts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"--aencoder %s"</span>, config.encode)
          cmd_opts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"--aq %s"</span>, config.quality) <span style="font-weight: bold;">if</span> config.quality
          cmd_opts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"--ab %s"</span>, config.bitrate) <span style="font-weight: bold;">if</span> config.bitrate
        <span style="font-weight: bold;">when</span> <span style="font-style: italic;">'aac'</span>
          cmd_opts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"--aencoder ca_haac"</span>)
          <span style="font-weight: bold;">if</span> config.quality
            cmd_opts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"--aq %s"</span>, config.quality)
            cmd_opts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"--ab 0"</span>)
          <span style="font-weight: bold;">elsif</span> config.bitrate
            cmd_opts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"--ab %s"</span>, config.bitrate)
          <span style="font-weight: bold;">end</span>
        <span style="font-weight: bold;">else</span>
          cmd_opts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"--aencoder copy"</span>)
        <span style="font-weight: bold;">end</span>
      <span style="font-weight: bold;">elsif</span> config.instance_of?(<span style="font-weight: bold; text-decoration: underline;">DVDConfig</span>)
        cmd_opts &lt;&lt; (config.title ? <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"--title %s"</span>, config.title) : <span style="font-style: italic;">"--main-feature"</span>)
        cmd_opts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"--chapters %s"</span>, config.chapters) <span style="font-weight: bold;">if</span> config.chapters
        cmd_opts &lt;&lt; <span style="font-style: italic;">"--markers"</span> <span style="font-weight: bold;">if</span> config.chapter_marker
        cmd_opts &lt;&lt; (config.audio ? <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"--audio %s"</span>, config.audio) : <span style="font-style: italic;">"--all-audio"</span> )
        cmd_opts &lt;&lt; (config.subtitle ? <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"--subtitle %s"</span>, config.subtitle) : <span style="font-style: italic;">"--all-subtitles"</span> )
      <span style="font-weight: bold;">end</span>
    <span style="font-weight: bold;">end</span>

    cmd_opts &lt;&lt; raw_option <span style="font-weight: bold;">if</span> raw_option

    cmd_opts.join(<span style="font-style: italic;">" "</span>)
  <span style="font-weight: bold;">end</span>
<span style="font-weight: bold;">end</span>

<span style="font-weight: bold;">class</span> <span style="font-weight: bold; text-decoration: underline;">ImageMagick</span>
  <span style="font-weight: bold; text-decoration: underline;">COMMAND</span> = <span style="font-style: italic;">"convert %s %s %s %s "</span>

  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">self</span>.<span style="font-weight: bold;">command</span>(input, output, pconfig, raw_option=<span style="font-style: italic;">""</span>)
    input_opt = <span style="font-style: italic;">""</span>
    output_opt = <span style="font-style: italic;">""</span>
    <span style="font-weight: bold;">if</span> pconfig.instance_of?(<span style="font-weight: bold; text-decoration: underline;">ImageConfig</span>) <span style="font-weight: bold;">then</span>
      input_opt += <span style="font-style: italic;">"-quality %s"</span> % pconfig.quality <span style="font-weight: bold;">if</span> pconfig.quality
      s = <span style="font-weight: bold; text-decoration: underline;">COMMAND</span> % [input, input_opt, output, output_opt]
      s
    <span style="font-weight: bold;">end</span>
  <span style="font-weight: bold;">end</span>
<span style="font-weight: bold;">end</span>

<span style="font-weight: bold; text-decoration: underline;">MediaUtil</span>.start(<span style="font-weight: bold; text-decoration: underline;">ARGV</span>)
</pre>
</div>
</div>
</div>
<div id="outline-container-org5cacef4" class="outline-3">
<h3 id="org5cacef4">genalbum</h3>
<div class="outline-text-3" id="text-org5cacef4">
<p>
Personal script for encoding family pictures and movies.
</p>

<div class="org-src-container">
<pre class="src src-ruby"><span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">!/usr/bin/env ruby</span>

<span style="font-weight: bold;">require</span> <span style="font-style: italic;">'fileutils'</span>
<span style="font-weight: bold;">require</span> <span style="font-style: italic;">'time'</span>
<span style="font-weight: bold;">require</span> <span style="font-style: italic;">'exifr'</span>
<span style="font-weight: bold;">require</span> <span style="font-style: italic;">'streamio-ffmpeg'</span>
<span style="font-weight: bold;">require</span> <span style="font-style: italic;">'pathname'</span>
<span style="font-weight: bold;">require</span> <span style="font-style: italic;">'thor'</span>

<span style="font-weight: bold; text-decoration: underline;">PICTURE_FILE_EXTS</span> = [<span style="font-style: italic;">".jpg"</span>]
<span style="font-weight: bold; text-decoration: underline;">MOVIE_FILE_EXTS</span> = [<span style="font-style: italic;">".mp4"</span>]
<span style="font-weight: bold; text-decoration: underline;">ALBUM_DIR_NAME</span> = <span style="font-style: italic;">"album/"</span>
<span style="font-weight: bold; text-decoration: underline;">RENAME_DIR_NAME</span> = <span style="font-style: italic;">"rename/"</span>
<span style="font-weight: bold; text-decoration: underline;">WEB_DIR_NAME</span> = <span style="font-style: italic;">"album_web/"</span>
<span style="font-weight: bold; text-decoration: underline;">IMG_PREFIX</span> = <span style="font-style: italic;">"img_"</span>

<span style="font-weight: bold;">class</span> <span style="font-weight: bold; text-decoration: underline;">GenAlbum</span> &lt; <span style="font-weight: bold; text-decoration: underline;">Thor</span>
  default_command <span style="font-weight: bold; text-decoration: underline;">:album</span>
  desc <span style="font-style: italic;">"[album] -i &lt;img_dir&gt;"</span>, <span style="font-style: italic;">"generate album"</span>
  option <span style="font-weight: bold; text-decoration: underline;">:in</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"i"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>, <span style="font-weight: bold; text-decoration: underline;">:required</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">true</span>
  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">album</span>
    src_path = <span style="font-weight: bold; text-decoration: underline;">File</span>.expand_path(options[<span style="font-weight: bold; text-decoration: underline;">:in</span>], <span style="font-weight: bold; text-decoration: underline;">Dir</span>.pwd)
    dest_path = <span style="font-weight: bold; text-decoration: underline;">ALBUM_DIR_NAME</span>

    <span style="font-weight: bold; text-decoration: underline;">FileUtils</span>.mkdir_p(dest_path) <span style="font-weight: bold;">unless</span> <span style="font-weight: bold; text-decoration: underline;">FileTest</span>.exist?(dest_path)

    <span style="font-weight: bold; text-decoration: underline;">Dir</span>.glob(src_path + <span style="font-style: italic;">"/*"</span>).each <span style="font-weight: bold;">do</span> |img_file|
      basename = <span style="font-weight: bold; text-decoration: underline;">File</span>::basename(img_file)
      src_file = src_path + <span style="font-style: italic;">"/"</span> + basename
      dest_file = dest_path + <span style="font-style: italic;">"/"</span> + basename
      ext = <span style="font-weight: bold; text-decoration: underline;">File</span>.extname(img_file)
      <span style="font-weight: bold;">if</span> <span style="font-weight: bold; text-decoration: underline;">PICTURE_FILE_EXTS</span>.index(ext.downcase) != <span style="font-weight: bold; text-decoration: underline;">nil</span> <span style="font-weight: bold;">then</span>
        <span style="font-weight: bold;">system</span>(<span style="font-style: italic;">"convert -resize \"4096x&gt;\" -quality 92 </span><span style="font-weight: bold; font-style: italic;">#{src_file}</span><span style="font-style: italic;"> </span><span style="font-weight: bold; font-style: italic;">#{dest_file}</span><span style="font-style: italic;">"</span>)
      <span style="font-weight: bold;">elsif</span> <span style="font-weight: bold; text-decoration: underline;">MOVIE_FILE_EXTS</span>.index(ext.downcase) != <span style="font-weight: bold; text-decoration: underline;">nil</span> <span style="font-weight: bold;">then</span>
        <span style="font-weight: bold;">system</span>(<span style="font-style: italic;">"mediautil encode -i </span><span style="font-weight: bold; font-style: italic;">#{src_file}</span><span style="font-style: italic;"> -o </span><span style="font-weight: bold; font-style: italic;">#{dest_file}</span><span style="font-style: italic;"> -q 22.0 -Q 100.0"</span>)
      <span style="font-weight: bold;">end</span>
    <span style="font-weight: bold;">end</span>
  <span style="font-weight: bold;">end</span>

  desc <span style="font-style: italic;">"web -i &lt;img_dir&gt;"</span>, <span style="font-style: italic;">"generate lightweight album for web"</span>
  option <span style="font-weight: bold; text-decoration: underline;">:in</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"i"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>, <span style="font-weight: bold; text-decoration: underline;">:required</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">true</span>
  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">web</span>
    src_path = <span style="font-weight: bold; text-decoration: underline;">File</span>.expand_path(options[<span style="font-weight: bold; text-decoration: underline;">:in</span>], <span style="font-weight: bold; text-decoration: underline;">Dir</span>.pwd)
    dest_path = <span style="font-weight: bold; text-decoration: underline;">WEB_DIR_NAME</span>

    <span style="font-weight: bold; text-decoration: underline;">FileUtils</span>.mkdir_p(dest_path) <span style="font-weight: bold;">unless</span> <span style="font-weight: bold; text-decoration: underline;">FileTest</span>.exist?(dest_path)

    <span style="font-weight: bold; text-decoration: underline;">Dir</span>.glob(src_path + <span style="font-style: italic;">"/*"</span>).each <span style="font-weight: bold;">do</span> |img_file|
      basename = <span style="font-weight: bold; text-decoration: underline;">File</span>::basename(img_file)
      src_file = src_path + <span style="font-style: italic;">"/"</span> + basename
      dest_file = dest_path + <span style="font-style: italic;">"/"</span> + basename
      ext = <span style="font-weight: bold; text-decoration: underline;">File</span>.extname(img_file)
      <span style="font-weight: bold;">if</span> <span style="font-weight: bold; text-decoration: underline;">PICTURE_FILE_EXTS</span>.index(ext.downcase) != <span style="font-weight: bold; text-decoration: underline;">nil</span> <span style="font-weight: bold;">then</span>
        <span style="font-weight: bold;">system</span>(<span style="font-style: italic;">"convert -resize \"1024x&gt;\" -quality 80 </span><span style="font-weight: bold; font-style: italic;">#{src_file}</span><span style="font-style: italic;"> </span><span style="font-weight: bold; font-style: italic;">#{dest_file}</span><span style="font-style: italic;">"</span>)
      <span style="font-weight: bold;">elsif</span> <span style="font-weight: bold; text-decoration: underline;">MOVIE_FILE_EXTS</span>.index(ext.downcase) != <span style="font-weight: bold; text-decoration: underline;">nil</span> <span style="font-weight: bold;">then</span>
        <span style="font-weight: bold;">system</span>(<span style="font-style: italic;">"mediautil encode -i </span><span style="font-weight: bold; font-style: italic;">#{src_file}</span><span style="font-style: italic;"> -o </span><span style="font-weight: bold; font-style: italic;">#{dest_file}</span><span style="font-style: italic;"> -q 26.0 -Q 100.0"</span>)
      <span style="font-weight: bold;">end</span>
    <span style="font-weight: bold;">end</span>
  <span style="font-weight: bold;">end</span>

  desc <span style="font-style: italic;">"renmae -i &lt;img_dir&gt;"</span>, <span style="font-style: italic;">"rename image files in chlonological order"</span>
  option <span style="font-weight: bold; text-decoration: underline;">:in</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"i"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>, <span style="font-weight: bold; text-decoration: underline;">:required</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">true</span>
  option <span style="font-weight: bold; text-decoration: underline;">:out</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"o"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>
  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">rename</span>
    src_path = <span style="font-weight: bold; text-decoration: underline;">File</span>.expand_path(options[<span style="font-weight: bold; text-decoration: underline;">:in</span>], <span style="font-weight: bold; text-decoration: underline;">Dir</span>.pwd)
    dest_path = ((options[<span style="font-weight: bold; text-decoration: underline;">:out</span>]) ? options[<span style="font-weight: bold; text-decoration: underline;">:out</span>] : <span style="font-weight: bold; text-decoration: underline;">RENAME_DIR_NAME</span>)

    <span style="font-weight: bold; text-decoration: underline;">FileUtils</span>.mkdir_p(dest_path) <span style="font-weight: bold;">unless</span> <span style="font-weight: bold; text-decoration: underline;">FileTest</span>.exist?(dest_path)

    img_time = {}
    <span style="font-weight: bold; text-decoration: underline;">Dir</span>.glob(src_path + <span style="font-style: italic;">"/*"</span>).each <span style="font-weight: bold;">do</span> |img_file|
      ext = <span style="font-weight: bold; text-decoration: underline;">File</span>.extname(img_file)
      <span style="font-weight: bold;">if</span> <span style="font-weight: bold; text-decoration: underline;">PICTURE_FILE_EXTS</span>.index(ext.downcase) != <span style="font-weight: bold; text-decoration: underline;">nil</span> <span style="font-weight: bold;">then</span>
        pic = <span style="font-weight: bold; text-decoration: underline;">EXIFR</span>::<span style="font-weight: bold; text-decoration: underline;">JPEG</span>.new(img_file)
        <span style="font-weight: bold;">if</span> pic.exif? &amp;&amp; pic.date_time_original <span style="font-weight: bold;">then</span>
          img_time[img_file] = pic.date_time_original
        <span style="font-weight: bold;">else</span>
          img_time[img_file] = <span style="font-weight: bold; text-decoration: underline;">Time</span>.now
        <span style="font-weight: bold;">end</span>
      <span style="font-weight: bold;">elsif</span> <span style="font-weight: bold; text-decoration: underline;">MOVIE_FILE_EXTS</span>.index(ext.downcase) != <span style="font-weight: bold; text-decoration: underline;">nil</span> <span style="font-weight: bold;">then</span>
        movie = <span style="font-weight: bold; text-decoration: underline;">FFMPEG</span>::<span style="font-weight: bold; text-decoration: underline;">Movie</span>.new(img_file)
        time = movie.creation_time
        <span style="font-weight: bold;">if</span> time <span style="font-weight: bold;">then</span>
          img_time[img_file] = time
        <span style="font-weight: bold;">else</span>
          img_time[img_file] = <span style="font-weight: bold; text-decoration: underline;">Time</span>.now
        <span style="font-weight: bold;">end</span>
      <span style="font-weight: bold;">end</span>
    <span style="font-weight: bold;">end</span>
    img_time = img_time.sort_by{ |_, v| v }

    digit = img_time.length.to_s.length
    digit = 2 <span style="font-weight: bold;">if</span> digit &lt; 2
    img_time.each_with_index <span style="font-weight: bold;">do</span> |(img, time), i|
      ext = <span style="font-weight: bold; text-decoration: underline;">File</span>.extname(img).downcase
      base = <span style="font-weight: bold; text-decoration: underline;">IMG_PREFIX</span> + <span style="font-style: italic;">"%0</span><span style="font-weight: bold; font-style: italic;">#{digit}</span><span style="font-style: italic;">d"</span> % (i + 1) + ext
      src_file = img
      dest_file = dest_path + <span style="font-style: italic;">"/"</span> + base
      <span style="font-weight: bold;">system</span>(<span style="font-style: italic;">"cp </span><span style="font-weight: bold; font-style: italic;">#{src_file}</span><span style="font-style: italic;"> </span><span style="font-weight: bold; font-style: italic;">#{dest_file}</span><span style="font-style: italic;">"</span>)
    <span style="font-weight: bold;">end</span>
  <span style="font-weight: bold;">end</span>
<span style="font-weight: bold;">end</span>

<span style="font-weight: bold; text-decoration: underline;">GenAlbum</span>.start(<span style="font-weight: bold; text-decoration: underline;">ARGV</span>)
</pre>
</div>
</div>
</div>

<div id="outline-container-org0363143" class="outline-3">
<h3 id="org0363143">nhp&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span></h3>
</div>

<div id="outline-container-org9104e93" class="outline-3">
<h3 id="org9104e93">sendmail.py</h3>
<div class="outline-text-3" id="text-org9104e93">
<p>
Utility for sendind email programatically
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">!/usr/bin/env python3</span>

<span style="font-weight: bold;">import</span> sys
<span style="font-weight: bold;">import</span> argparse
<span style="font-weight: bold;">import</span> subprocess
<span style="font-weight: bold;">import</span> smtplib
<span style="font-weight: bold;">import</span> ssl
<span style="font-weight: bold;">from</span> email.mime.text <span style="font-weight: bold;">import</span> MIMEText
<span style="font-weight: bold;">from</span> email.utils <span style="font-weight: bold;">import</span> formatdate

<span style="font-weight: bold;">def</span> <span style="font-weight: bold;">sendmail</span>(mail_to, mail_from, subject, message):
    <span style="font-weight: bold; font-style: italic;">smtp_host</span> = <span style="font-style: italic;">'smtp.&lt;&lt;my-network()&gt;&gt;'</span>
    <span style="font-weight: bold; font-style: italic;">smtp_port</span> = <span style="font-style: italic;">'465'</span>
    <span style="font-weight: bold; font-style: italic;">smtp_user</span> = <span style="font-style: italic;">'&lt;&lt;email()&gt;&gt;'</span>.split(sep=<span style="font-style: italic;">'@'</span>)[0]
    <span style="font-weight: bold; font-style: italic;">smtp_pass</span> = subprocess.run([<span style="font-style: italic;">"pass {}:{}/{} | head -1"</span>.<span style="font-weight: bold;">format</span>(smtp_host, smtp_port, smtp_user)], stdout=subprocess.PIPE, shell=<span style="font-weight: bold; text-decoration: underline;">True</span>).stdout.decode().strip()

    <span style="font-weight: bold; font-style: italic;">mime_msg</span> = MIMEText(message)
    <span style="font-weight: bold; font-style: italic;">mime_msg</span>[<span style="font-style: italic;">'Subject'</span>] = subject
    <span style="font-weight: bold; font-style: italic;">mime_msg</span>[<span style="font-style: italic;">'From'</span>] = mail_from
    <span style="font-weight: bold; font-style: italic;">mime_msg</span>[<span style="font-style: italic;">'To'</span>] = mail_to
    <span style="font-weight: bold; font-style: italic;">mime_msg</span>[<span style="font-style: italic;">"Date"</span>] = formatdate(<span style="font-weight: bold; text-decoration: underline;">None</span>, <span style="font-weight: bold; text-decoration: underline;">True</span>)

    <span style="font-weight: bold;">if</span> smtp_port == <span style="font-style: italic;">'465'</span>:
        <span style="font-weight: bold; font-style: italic;">context</span> = ssl.create_default_context()
        <span style="font-weight: bold; font-style: italic;">smtp</span> = smtplib.SMTP_SSL(smtp_host, smtp_port, context=context)

    <span style="font-weight: bold;">if</span> smtp <span style="font-weight: bold;">is</span> <span style="font-weight: bold;">not</span> <span style="font-weight: bold; text-decoration: underline;">None</span>:
        smtp.login(smtp_user, smtp_pass)
        smtp.sendmail(mail_from, mail_to, mime_msg.as_string())
        smtp.<span style="font-weight: bold; text-decoration: underline;">quit</span>()


<span style="font-weight: bold; font-style: italic;">DESC</span> = <span style="font-style: italic;">'sendmail.py sends mail'</span>
<span style="font-weight: bold; font-style: italic;">parser</span> = argparse.ArgumentParser(description=DESC)
parser.add_argument(<span style="font-style: italic;">'-s'</span>, <span style="font-style: italic;">'--subject'</span>)
parser.add_argument(<span style="font-style: italic;">'-f'</span>, <span style="font-style: italic;">'--mailfrom'</span>)
parser.add_argument(<span style="font-style: italic;">'to'</span>)
<span style="font-weight: bold; font-style: italic;">args</span> = parser.parse_args()

<span style="font-weight: bold; font-style: italic;">message</span> = sys.stdin.read()
sendmail(args.to, args.mailfrom, args.subject, message)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgea88b7b" class="outline-3">
<h3 id="orgea88b7b">pwsudo</h3>
<div class="outline-text-3" id="text-orgea88b7b">
<p>
A script which executes command with elevating privilege using password from pass command.
</p>

<div class="org-src-container">
<pre class="src src-bash"><span style="font-weight: bold; font-style: italic;">_userid</span>=$(whoami)
<span style="font-weight: bold; font-style: italic;">_hostname</span>=$(hostname)

<span style="font-weight: bold;">if</span> pass show <span style="font-style: italic;">"${_hostname}/${_userid}"</span> &gt;/dev/null 2&gt;&amp;1; <span style="font-weight: bold;">then</span>
  pass show <span style="font-style: italic;">"${_hostname}/${_userid}"</span> | head -1 | sudo -sES -p <span style="font-style: italic;">""</span> <span style="font-style: italic;">"PATH=$PATH"</span> <span style="font-style: italic;">"$@"</span>
<span style="font-weight: bold;">else</span>
  sudo -sE <span style="font-style: italic;">"PATH=$PATH"</span> <span style="font-style: italic;">"$@"</span>
<span style="font-weight: bold;">fi</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd9af54f" class="outline-3">
<h3 id="orgd9af54f">gitsync&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span></h3>
</div>

<div id="outline-container-org7373e98" class="outline-3">
<h3 id="org7373e98">filetype-cli&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span></h3>
</div>
<div id="outline-container-org5285808" class="outline-3">
<h3 id="org5285808">strip ruby</h3>
<div class="outline-text-3" id="text-org5285808">
<p>
A program strips all ruby tags in a HTML stream. All HTML contents are expected to be from STDIN and go out as STDOUT. This procedure is mainly for html files converted from pdf and epub files.
Stripping rules are:
</p>
<ul class="org-ul">
<li>&lt;ruby&gt; tag will be stripped</li>
<li>&lt;rt&gt; tree for furigana tree will be removed</li>
<li>&lt;rp&gt; tree contains parenthes for non-ruby-support brouwser will be removed</li>
<li>&lt;rb&gt; tag for delimiter will be stripped</li>
<li>&lt;rtc&gt; tree for semantic word will be removed</li>
</ul>

<div class="org-src-container">
<pre class="src src-python"><span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">!/usr/bin/env python3</span>

<span style="font-weight: bold;">import</span> sys
<span style="font-weight: bold;">import</span> lxml.html <span style="font-weight: bold;">as</span> html

<span style="font-weight: bold; font-style: italic;">INPUT_STR</span> = sys.stdin.read()
<span style="font-weight: bold; font-style: italic;">ROOT</span> = html.fromstring(INPUT_STR).getroottree()

<span style="font-weight: bold;">for</span> ruby <span style="font-weight: bold;">in</span> ROOT.xpath(<span style="font-style: italic;">'//ruby'</span>):
    <span style="font-weight: bold;">for</span> rt <span style="font-weight: bold;">in</span> ruby.xpath(<span style="font-style: italic;">'//rt'</span>):
        rt.drop_tree()
    <span style="font-weight: bold;">for</span> rp <span style="font-weight: bold;">in</span> ruby.xpath(<span style="font-style: italic;">'//rp'</span>):
        rp.drop_tree()
    <span style="font-weight: bold;">for</span> rb <span style="font-weight: bold;">in</span> ruby.xpath(<span style="font-style: italic;">'//rb'</span>):
        rb.drop_tag()
    <span style="font-weight: bold;">for</span> rtc <span style="font-weight: bold;">in</span> ruby.xpath(<span style="font-style: italic;">'//rtc'</span>):
        rtc.drop_tree()
    ruby.drop_tag()

<span style="font-weight: bold; font-style: italic;">CONTENT</span> = html.tostring(ROOT, encoding=<span style="font-style: italic;">"utf-8"</span>, method=<span style="font-style: italic;">'html'</span>, pretty_print=<span style="font-weight: bold; text-decoration: underline;">True</span>)
<span style="font-weight: bold;">print</span>(CONTENT.decode())
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org482700c" class="outline-2">
<h2 id="org482700c">Workflows</h2>
<div class="outline-text-2" id="text-org482700c">
</div>
<div id="outline-container-orgd3ab986" class="outline-3">
<h3 id="orgd3ab986">Transcode Video Files</h3>
<div class="outline-text-3" id="text-orgd3ab986">
<p>
Transcoding my local video files with open codec, like VP9 and AV1, is effective for disc space usage.
</p>

<div class="org-src-container">
<pre class="src src-shell"><span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">!/usr/bin/</span><span style="font-weight: bold;">env</span><span style="font-weight: bold; font-style: italic;"> bash</span>
<span style="font-weight: bold;">set</span> -euo pipefail

<span style="font-weight: bold; font-style: italic;">CRF</span>=28
<span style="font-weight: bold; font-style: italic;">KBITRATE_AUDIO</span>=128

<span style="font-weight: bold;">function</span> <span style="font-weight: bold;">usage</span>() {
  cat &lt;&lt;_EOT_
<span style="font-weight: bold;">Usage:</span>
<span style="font-weight: bold;">  $(basename $0) [OPTIONS] &lt;video_in&gt; [&lt;video_out&gt;]</span>

<span style="font-weight: bold;">Description:</span>
<span style="font-weight: bold;">  $(basename $0) encodes &lt;video_in&gt; to &lt;video_out&gt; in specified codec.</span>

<span style="font-weight: bold;">Options:</span>
<span style="font-weight: bold;">  -c &lt;CRF&gt;      CRF value instead of ${CRF} (DEFAULT)</span>
<span style="font-weight: bold;">  -B &lt;AUDIO_BR&gt; Audio Bitrate in kbps</span>

<span style="font-weight: bold;">_EOT_</span>
}

<span style="font-weight: bold;">if</span> [ <span style="font-style: italic;">"${OPTIND}"</span> = 1 ]; <span style="font-weight: bold;">then</span>
  <span style="font-weight: bold;">while </span><span style="font-weight: bold;">getopts</span> c:B:h OPT
  <span style="font-weight: bold;">do</span>
    <span style="font-weight: bold;">case</span> ${<span style="font-weight: bold; font-style: italic;">OPT</span>} <span style="font-weight: bold;">in</span>
    c)
      <span style="font-weight: bold; font-style: italic;">CRF</span>=${<span style="font-weight: bold; font-style: italic;">OPTARG</span>}
      ;;
    B)
      <span style="font-weight: bold; font-style: italic;">CRF</span>=${<span style="font-weight: bold; font-style: italic;">OPTARG</span>}
      ;;
    h)
      usage
      ;;
    <span style="font-style: italic;">\?</span>)
      <span style="font-weight: bold;">echo</span> <span style="font-style: italic;">"Try to enter the h option."</span> 1&gt;&amp;2
      ;;
    <span style="font-weight: bold;">esac</span>
  <span style="font-weight: bold;">done</span>
<span style="font-weight: bold;">else</span>
  <span style="font-weight: bold;">echo</span> <span style="font-style: italic;">"No installed getopts-command."</span> 1&gt;&amp;2
  <span style="font-weight: bold;">exit</span> 1
<span style="font-weight: bold;">fi</span>

<span style="font-weight: bold;">shift</span> $((OPTIND - 1))

<span style="font-weight: bold;">if</span> [ $<span style="font-weight: bold; font-style: italic;">#</span> -lt 1 ] || [ $<span style="font-weight: bold; font-style: italic;">#</span> -gt 2 ]; <span style="font-weight: bold;">then</span>
  usage
  <span style="font-weight: bold;">exit</span> -1
<span style="font-weight: bold;">fi</span>

<span style="font-weight: bold; font-style: italic;">INPUT_VIDEO</span>=$<span style="font-weight: bold; font-style: italic;">1</span>
<span style="font-weight: bold;">if</span> [ ! -e <span style="font-style: italic;">"${INPUT_VIDEO}"</span> ]; <span style="font-weight: bold;">then</span>
  <span style="font-weight: bold;">echo</span> <span style="font-style: italic;">"${INPUT_VIDEO} does not exist."</span> 1&gt;&amp;2
  <span style="font-weight: bold;">exit</span> -1
<span style="font-weight: bold;">fi</span>

<span style="font-weight: bold;">if</span> [[ $<span style="font-weight: bold; font-style: italic;">#</span> -eq 2 ]]; <span style="font-weight: bold;">then</span>
  <span style="font-weight: bold; font-style: italic;">output_cand</span>=$<span style="font-weight: bold; font-style: italic;">2</span>
<span style="font-weight: bold;">else</span>
  <span style="font-weight: bold; font-style: italic;">output_cand</span>=$(basename <span style="font-style: italic;">"${INPUT_VIDEO}"</span>).webm
<span style="font-weight: bold;">fi</span>
<span style="font-weight: bold;">if</span> [ -e ${<span style="font-weight: bold; font-style: italic;">output_cand</span>} ]; <span style="font-weight: bold;">then</span>
  <span style="font-weight: bold; font-style: italic;">OUTPUT_VIDEO</span>=${<span style="font-weight: bold; font-style: italic;">output_cand</span>%.*}_$(date +%Y%m%d_%H%M).webm
<span style="font-weight: bold;">else</span>
  <span style="font-weight: bold; font-style: italic;">OUTPUT_VIDEO</span>=<span style="font-style: italic;">"${output_cand}"</span>
<span style="font-weight: bold;">fi</span>

<span style="font-weight: bold; font-style: italic;">WORK_DIR</span>=<span style="font-style: italic;">"${INPUT_VIDEO%.*}"</span>
</pre>
</div>
</div>

<div id="outline-container-org9613f99" class="outline-4">
<h4 id="org9613f99">vp9 transcoding</h4>
<div class="outline-text-4" id="text-org9613f99">
<ul class="org-ul">
<li><p>
transcode video to vp9
</p>
<pre class="example">
$ vp9transc -c 32 video_orig.mkv video_vp9.webm

</pre></li>
</ul>

<div class="org-src-container">
<pre class="src src-shell">&lt;&lt;transc-shared&gt;&gt;

<span style="font-weight: bold; font-style: italic;">vp9_opts_pass1</span>=<span style="font-style: italic;">"-c:v libvpx-vp9 -cpu-used 4 -threads 3 -row-mt 1 -speed 1 -b:v 0 -crf ${CRF} -pass 1 -an -f null"</span>
<span style="font-weight: bold; font-style: italic;">vp9_opts_pass2</span>=<span style="font-style: italic;">"-c:v libvpx-vp9 -cpu-used 4 -threads 3 -row-mt 1 -speed 1 -b:v 0 -crf ${CRF} -pass 2 -map_metadata 0"</span>
<span style="font-weight: bold; font-style: italic;">opus_opts</span>=<span style="font-style: italic;">"-c:a libopus -b:a ${KBITRATE_AUDIO}k -ac 2"</span>

mkdir -p <span style="font-style: italic;">"${WORK_DIR}"</span> &amp;&amp; <span style="font-weight: bold;">cd</span> <span style="font-style: italic;">"${WORK_DIR}"</span> <span style="font-style: italic;">\</span>
  &amp;&amp; ffmpeg -i <span style="font-style: italic;">"../${INPUT_VIDEO}"</span> ${<span style="font-weight: bold; font-style: italic;">vp9_opts_pass1</span>} /dev/null <span style="font-style: italic;">\</span>
  &amp;&amp; ffmpeg -i <span style="font-style: italic;">"../${INPUT_VIDEO}"</span> ${<span style="font-weight: bold; font-style: italic;">vp9_opts_pass2</span>} ${<span style="font-weight: bold; font-style: italic;">opus_opts</span>} <span style="font-style: italic;">"../${OUTPUT_VIDEO}"</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org2ba8f20" class="outline-4">
<h4 id="org2ba8f20">av1 transcoding</h4>
<div class="outline-text-4" id="text-org2ba8f20">
<ul class="org-ul">
<li><p>
transcode video to av1
</p>
<pre class="example">
$ av1transc video_orig.mkv video_av1.webm

</pre></li>
</ul>

<div class="org-src-container">
<pre class="src src-shell">&lt;&lt;transc-shared&gt;&gt;

<span style="font-weight: bold; font-style: italic;">av1_opts_common</span>=<span style="font-style: italic;">"-c:v libaom-av1 -cpu-used 2 -row-mt 1 -threads $(nproc) -b:v 0 -crf ${CRF}"</span>
<span style="font-weight: bold; font-style: italic;">av1_opts_pass1</span>=<span style="font-style: italic;">"${av1_opts_common} -pass 1 -an -f null"</span>
<span style="font-weight: bold; font-style: italic;">av1_opts_pass2</span>=<span style="font-style: italic;">"${av1_opts_common} -pass 2 -map_metadata 0"</span>
<span style="font-weight: bold; font-style: italic;">opus_opts</span>=<span style="font-style: italic;">"-c:a libopus -b:a ${KBITRATE_AUDIO}k -ac 2"</span>

mkdir -p <span style="font-style: italic;">"${WORK_DIR}"</span> &amp;&amp; <span style="font-weight: bold;">cd</span> <span style="font-style: italic;">"${WORK_DIR}"</span> <span style="font-style: italic;">\</span>
  &amp;&amp; ffmpeg -i <span style="font-style: italic;">"../${INPUT_VIDEO}"</span> ${<span style="font-weight: bold; font-style: italic;">av1_opts_pass1</span>} /dev/null <span style="font-style: italic;">\</span>
  &amp;&amp; ffmpeg -i <span style="font-style: italic;">"../${INPUT_VIDEO}"</span> ${<span style="font-weight: bold; font-style: italic;">av1_opts_pass2</span>} ${<span style="font-weight: bold; font-style: italic;">opus_opts</span>} <span style="font-style: italic;">"../${OUTPUT_VIDEO}"</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgef17c4e" class="outline-3">
<h3 id="orgef17c4e">Transcode Audio Files</h3>
<div class="outline-text-3" id="text-orgef17c4e">
<ul class="org-ul">
<li>usage
<ul class="org-ul">
<li><p>
encode bulk podcast files for 64kb/s (in Dired)
</p>
<pre class="example">
$ nohup parallel opusencode "{}" "{.}".oga ::: *

</pre></li>
</ul></li>
</ul>

<div class="org-src-container">
<pre class="src src-shell"><span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">!/usr/bin/</span><span style="font-weight: bold;">env</span><span style="font-weight: bold; font-style: italic;"> bash</span>
<span style="font-weight: bold;">set</span> -euo pipefail

<span style="font-weight: bold;">if</span> [[ $<span style="font-weight: bold; font-style: italic;">#</span> -ge 1 ]]; <span style="font-weight: bold;">then</span>
  <span style="font-weight: bold; font-style: italic;">INPUT_VIDEO</span>=$<span style="font-weight: bold; font-style: italic;">1</span>
  <span style="font-weight: bold;">if</span> [[ $<span style="font-weight: bold; font-style: italic;">#</span> -eq 2 ]]; <span style="font-weight: bold;">then</span>
    <span style="font-weight: bold; font-style: italic;">OUTPUT_VIDEO</span>=$<span style="font-weight: bold; font-style: italic;">2</span>
  <span style="font-weight: bold;">else</span>
    <span style="font-weight: bold; font-style: italic;">OUTPUT_VIDEO</span>=$(basename <span style="font-style: italic;">"${INPUT_VIDEO}"</span>).oga
  <span style="font-weight: bold;">fi</span>
<span style="font-weight: bold;">fi</span>

<span style="font-weight: bold; font-style: italic;">opus_opts</span>=<span style="font-style: italic;">"-c:a libopus -b:a 64k -ac 2"</span>

ffmpeg -i <span style="font-style: italic;">"${INPUT_VIDEO}"</span> ${<span style="font-weight: bold; font-style: italic;">opus_opts</span>} <span style="font-style: italic;">"${OUTPUT_VIDEO}"</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org5027d5b" class="outline-3">
<h3 id="org5027d5b">DVD Packing</h3>
<div class="outline-text-3" id="text-org5027d5b">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"handbrake"</span>
<span style="font-style: italic;">"dvdbackup"</span>
<span style="font-style: italic;">"libdvdnav"</span>
<span style="font-style: italic;">"libdvdcss"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-shell"><span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">!/usr/bin/</span><span style="font-weight: bold;">env</span><span style="font-weight: bold; font-style: italic;"> bash</span>
<span style="font-weight: bold;">set</span> -euo pipefail

<span style="font-weight: bold;">if</span> [ <span style="font-style: italic;">"${OPTIND}"</span> = 1 ]; <span style="font-weight: bold;">then</span>
  <span style="font-weight: bold;">while </span><span style="font-weight: bold;">getopts</span> t: OPT
  <span style="font-weight: bold;">do</span>
    <span style="font-weight: bold;">case</span> ${<span style="font-weight: bold; font-style: italic;">OPT</span>} <span style="font-weight: bold;">in</span>
    t)
      <span style="font-weight: bold; font-style: italic;">TITLE</span>=${<span style="font-weight: bold; font-style: italic;">OPTARG</span>}
      ;;
    <span style="font-weight: bold;">esac</span>
  <span style="font-weight: bold;">done</span>
<span style="font-weight: bold;">else</span>
  <span style="font-weight: bold;">echo</span> <span style="font-style: italic;">"No installed getopts-command."</span> 1&gt;&amp;2
  <span style="font-weight: bold;">exit</span> 1
<span style="font-weight: bold;">fi</span>
<span style="font-weight: bold;">shift</span> $((OPTIND - 1))

<span style="font-weight: bold;">if</span> [[ $<span style="font-weight: bold; font-style: italic;">#</span> -ge 1 ]]; <span style="font-weight: bold;">then</span>
  <span style="font-weight: bold; font-style: italic;">DVD_DIR</span>=$<span style="font-weight: bold; font-style: italic;">1</span>
  <span style="font-weight: bold;">if</span> [[ $<span style="font-weight: bold; font-style: italic;">#</span> -eq 2 ]]; <span style="font-weight: bold;">then</span>
    <span style="font-weight: bold; font-style: italic;">DVD_PACK_VIDEO</span>=$<span style="font-weight: bold; font-style: italic;">2</span>
  <span style="font-weight: bold;">else</span>
    <span style="font-weight: bold; font-style: italic;">DVD_PACK_VIDEO</span>=$(basename <span style="font-style: italic;">"${DVD_DIR}"</span>).mkv
  <span style="font-weight: bold;">fi</span>
<span style="font-weight: bold;">fi</span>

<span style="font-weight: bold;">if</span> [ -v TITLE ]; <span style="font-weight: bold;">then</span>
  <span style="font-weight: bold; font-style: italic;">title_opt</span>=<span style="font-style: italic;">"--title ${TITLE}"</span>
<span style="font-weight: bold;">else</span>
  <span style="font-weight: bold; font-style: italic;">title_opt</span>=<span style="font-style: italic;">'--main-feature'</span>
<span style="font-weight: bold;">fi</span>

<span style="font-weight: bold; font-style: italic;">hb_opts</span>=<span style="font-style: italic;">"--x264-preset veryslow --quality 18 --aencoder copy ${title_opt} --markers --all-audio --all-subtitles"</span>

HandBrakeCLI --input <span style="font-style: italic;">"${DVD_DIR}"</span> --output <span style="font-style: italic;">"${DVD_PACK_VIDEO}"</span> ${<span style="font-weight: bold; font-style: italic;">hb_opts</span>}
</pre>
</div>
</div>
</div>
<div id="outline-container-org072fa58" class="outline-3">
<h3 id="org072fa58">CD Ripping</h3>
<div class="outline-text-3" id="text-org072fa58">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"abcde"</span>
<span style="font-style: italic;">"cdrtools"</span>
<span style="font-style: italic;">"easytag"</span>
</pre>
</div>

<ul class="org-ul">
<li><p>
abcde
</p>
<div class="org-src-container">
<pre class="src src-conf"><span style="font-weight: bold; font-style: italic;">FDKAACENCOPTS</span>=<span style="font-style: italic;">'--bitrate 256k'</span>

<span style="font-weight: bold; font-style: italic;">OUTPUTFORMAT</span>=<span style="font-style: italic;">'${ARTISTFILE}/${ALBUMFILE}/${TRACKNUM}.${TRACKFILE}'</span>
</pre>
</div></li>
</ul>
</div>
</div>
<div id="outline-container-org86e140e" class="outline-3">
<h3 id="org86e140e">Tutorial Video Creation</h3>
<div class="outline-text-3" id="text-org86e140e">
<p>
<a href="https://www.thregr.org/~wavexx/software/screenkey/">Screencast your keys.</a>
</p>

<pre class="example">
$ screenkey -p fixed -g 1090x248+1470+348

</pre>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"python-screenkey"</span>
<span style="font-style: italic;">"slop"</span>
<span style="font-style: italic;">"gimp"</span>
<span style="font-style: italic;">"obs"</span>
<span style="font-style: italic;">"kdenlive"</span>
<span style="font-style: italic;">"audacity"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-json">{"no_systray": false, "timeout": 0.5, "recent_thr": 0.1, "compr_cnt": 3, "ignore": [], "position": "bottom", "persist": false, "font_desc": "Sans Bold", "font_size": "medium", "font_color": "white", "bg_color": "black", "opacity": 0.9, "key_mode": "composed", "bak_mode": "baked", "mods_mode": "emacs", "mods_only": false, "multiline": false, "vis_shift": true, "vis_space": true, "geometry": null, "screen": 0, "start_disabled": false, "mouse": false, "button_hide_duration": 2.0}
</pre>
</div>
</div>
</div>
<div id="outline-container-org6718a91" class="outline-3">
<h3 id="org6718a91">Sync Git Repos Automatically</h3>
<div class="outline-text-3" id="text-org6718a91">
<div class="org-src-container">
<pre class="src src-conf">0 */2 * * * /bin/bash -ci <span style="font-style: italic;">"ghq-sync &gt;&gt; $LOG_DIR/ghq-sync.log 2&gt;&amp;1"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-shell"><span style="font-weight: bold; font-style: italic;">ghq_repos</span>=$(ghq list --full-path)
<span style="font-weight: bold;">for</span> repo_path<span style="font-weight: bold;"> in</span> ${<span style="font-weight: bold; font-style: italic;">ghq_repos</span>[@]}; <span style="font-weight: bold;">do</span>
  <span style="font-weight: bold;">cd</span> ${<span style="font-weight: bold; font-style: italic;">repo_path</span>} &amp;&amp; <span style="font-style: italic;">\</span>
    (
      git-sync check &amp;&amp; git-sync
    )
<span style="font-weight: bold;">done</span>
</pre>
</div>
</div>

<div id="outline-container-orgd10e329" class="outline-4">
<h4 id="orgd10e329">git-sync</h4>
<div class="outline-text-4" id="text-orgd10e329">
<p>
<a href="https://github.com/simonthum/git-sync">git-sync</a> enables to sync (stage, commit and pull/push) git repositories. I use it for my org-file repo in daily basis.
</p>

<div class="org-src-container">
<pre class="src src-gitconfig">[branch "main"]
        syncCommitMsg = "on $(LC_TIME=en_GB.UTF-8 date) from $(uname -n)"
</pre>
</div>

<div class="org-src-container">
<pre class="src src-shell"><span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">!/usr/bin/</span><span style="font-weight: bold;">env</span><span style="font-weight: bold; font-style: italic;"> bash</span>
<span style="font-weight: bold; font-style: italic;">#</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">git-sync</span>
<span style="font-weight: bold; font-style: italic;">#</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">synchronize tracking repositories</span>
<span style="font-weight: bold; font-style: italic;">#</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">2012-20 by Simon Thum and contributors</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Licensed as: CC0</span>
<span style="font-weight: bold; font-style: italic;">#</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">This script intends to sync via git near-automatically</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">in "tracking" repositories where a nice history is not</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">crucial, but having one at all is.</span>
<span style="font-weight: bold; font-style: italic;">#</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Unlike the myriad of scripts to do just that already available,</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">it follows the KISS principle: It is small, requires nothing but</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">git and bash, but does not even try to shield you from git.</span>
<span style="font-weight: bold; font-style: italic;">#</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Mode sync (default)</span>
<span style="font-weight: bold; font-style: italic;">#</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Sync will likely get from you from a dull normal git repo with trivial</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">changes to an updated dull normal git repo equal to origin. No more,</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">no less. The intent is to do everything that's needed to sync</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">automatically, and resort to manual intervention as soon</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">as something non-trivial occurs. It is designed to be safe</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">in that it will likely refuse to do anything not known to</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">be safe.</span>
<span style="font-weight: bold; font-style: italic;">#</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Mode check</span>
<span style="font-weight: bold; font-style: italic;">#</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Check only performs the basic checks to make sure the repository</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">is in an orderly state to continue syncing, i.e. committing</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">changes, pull etc. without losing any data. When check returns</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">0, sync can start immediately. This does not, however, indicate</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">that syncing is at all likely to succeed.</span>

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">command used to auto-commit file modifications</span>
<span style="font-weight: bold; font-style: italic;">DEFAULT_AUTOCOMMIT_CMD</span>=<span style="font-style: italic;">"git add -u ; git commit -m \"%message\";"</span>

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">command used to auto-commit all changes</span>
<span style="font-weight: bold; font-style: italic;">ALL_AUTOCOMMIT_CMD</span>=<span style="font-style: italic;">"git add -A ; git commit -m \"%message\";"</span>

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">default commit message substituted into autocommit commands</span>
<span style="font-weight: bold; font-style: italic;">DEFAULT_AUTOCOMMIT_MSG</span>=<span style="font-style: italic;">"changes from $(uname -n) on $(date)"</span>


<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">AUTOCOMMIT_CMD="echo \"Please commit or stash pending changes\"; exit 1;"</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">TODO mode for stash push &amp; pop</span>

<span style="font-weight: bold;">print_usage</span>() {
    cat &lt;&lt; EOF
<span style="font-weight: bold;">usage: $0 [-h] [-n] [-s] [MODE]</span>

<span style="font-weight: bold;">Synchronize the current branch to a remote backup</span>
<span style="font-weight: bold;">MODE may be either "sync" (the default) or "check", to verify that the branch is ready to sync</span>

<span style="font-weight: bold;">OPTIONS:</span>
<span style="font-weight: bold;">   -h      Show this message</span>
<span style="font-weight: bold;">   -n      Commit new files even if branch.\$branch_name.syncNewFiles isn't set</span>
<span style="font-weight: bold;">   -s      Sync the branch even if branch.\$branch_name.sync isn't set</span>
<span style="font-weight: bold;">EOF</span>
}
<span style="font-weight: bold; font-style: italic;">sync_new_files_anyway</span>=<span style="font-style: italic;">"false"</span>
<span style="font-weight: bold; font-style: italic;">sync_anyway</span>=<span style="font-style: italic;">"false"</span>

<span style="font-weight: bold;">while </span><span style="font-weight: bold;">getopts</span> <span style="font-style: italic;">"hns"</span> opt ; <span style="font-weight: bold;">do</span>
    <span style="font-weight: bold;">case</span> $<span style="font-weight: bold; font-style: italic;">opt</span><span style="font-weight: bold;"> in</span>
        h )
            print_usage
            <span style="font-weight: bold;">exit</span> 0
            ;;
        n )
            <span style="font-weight: bold; font-style: italic;">sync_new_files_anyway</span>=<span style="font-style: italic;">"true"</span>
            ;;
        s )
            <span style="font-weight: bold; font-style: italic;">sync_anyway</span>=<span style="font-style: italic;">"true"</span>
            ;;
    <span style="font-weight: bold;">esac</span>
<span style="font-weight: bold;">done</span>
<span style="font-weight: bold;">shift</span> $((OPTIND-1))

<span style="font-weight: bold; font-style: italic;">#</span>
<span style="font-weight: bold; font-style: italic;">#    </span><span style="font-weight: bold; font-style: italic;">utility functions, some adapted from git bash completion</span>
<span style="font-weight: bold; font-style: italic;">#</span>

<span style="font-weight: bold;">__log_msg</span>()
{
    <span style="font-weight: bold;">echo</span> git-sync: $<span style="font-weight: bold; font-style: italic;">1</span>
}

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">echo the git dir</span>
<span style="font-weight: bold;">__gitdir</span>()
{
        <span style="font-weight: bold;">if</span> [ <span style="font-style: italic;">"true"</span> = <span style="font-style: italic;">"$(git rev-parse --is-inside-work-tree "$PWD" | head -1)"</span> ]; <span style="font-weight: bold;">then</span>
                git rev-parse --git-dir <span style="font-style: italic;">"$PWD"</span> 2&gt;/dev/null
        <span style="font-weight: bold;">fi</span>
}

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">echos repo state</span>
<span style="font-weight: bold;">git_repo_state</span> ()
{
        local <span style="font-weight: bold; font-style: italic;">g</span>=<span style="font-style: italic;">"$(__gitdir)"</span>
        <span style="font-weight: bold;">if</span> [ -n <span style="font-style: italic;">"$g"</span> ]; <span style="font-weight: bold;">then</span>
                <span style="font-weight: bold;">if</span> [ -f <span style="font-style: italic;">"$g/rebase-merge/interactive"</span> ]; <span style="font-weight: bold;">then</span>
                        <span style="font-weight: bold;">echo</span> <span style="font-style: italic;">"REBASE-i"</span>
                <span style="font-weight: bold;">elif</span> [ -d <span style="font-style: italic;">"$g/rebase-merge"</span> ]; <span style="font-weight: bold;">then</span>
                        <span style="font-weight: bold;">echo</span> <span style="font-style: italic;">"REBASE-m"</span>
                <span style="font-weight: bold;">else</span>
                        <span style="font-weight: bold;">if</span> [ -d <span style="font-style: italic;">"$g/rebase-apply"</span> ]; <span style="font-weight: bold;">then</span>
                                <span style="font-weight: bold;">echo</span> <span style="font-style: italic;">"AM/REBASE"</span>
                        <span style="font-weight: bold;">elif</span> [ -f <span style="font-style: italic;">"$g/MERGE_HEAD"</span> ]; <span style="font-weight: bold;">then</span>
                                <span style="font-weight: bold;">echo</span> <span style="font-style: italic;">"MERGING"</span>
                        <span style="font-weight: bold;">elif</span> [ -f <span style="font-style: italic;">"$g/CHERRY_PICK_HEAD"</span> ]; <span style="font-weight: bold;">then</span>
                                <span style="font-weight: bold;">echo</span> <span style="font-style: italic;">"CHERRY-PICKING"</span>
                        <span style="font-weight: bold;">elif</span> [ -f <span style="font-style: italic;">"$g/BISECT_LOG"</span> ]; <span style="font-weight: bold;">then</span>
                                <span style="font-weight: bold;">echo</span> <span style="font-style: italic;">"BISECTING"</span>
                        <span style="font-weight: bold;">fi</span>
                <span style="font-weight: bold;">fi</span>
                <span style="font-weight: bold;">if</span> [ <span style="font-style: italic;">"true"</span> = <span style="font-style: italic;">"$(git rev-parse --is-inside-git-dir 2&gt;/dev/null)"</span> ]; <span style="font-weight: bold;">then</span>
                        <span style="font-weight: bold;">if</span> [ <span style="font-style: italic;">"true"</span> = <span style="font-style: italic;">"$(git rev-parse --is-bare-repository 2&gt;/dev/null)"</span> ]; <span style="font-weight: bold;">then</span>
                                <span style="font-weight: bold;">echo</span> <span style="font-style: italic;">"|BARE"</span>
                        <span style="font-weight: bold;">else</span>
                                <span style="font-weight: bold;">echo</span> <span style="font-style: italic;">"|GIT_DIR"</span>
                        <span style="font-weight: bold;">fi</span>
                <span style="font-weight: bold;">elif</span> [ <span style="font-style: italic;">"true"</span> = <span style="font-style: italic;">"$(git rev-parse --is-inside-work-tree 2&gt;/dev/null)"</span> ]; <span style="font-weight: bold;">then</span>
                        git diff --no-ext-diff --quiet --exit-code || <span style="font-weight: bold;">echo</span> <span style="font-style: italic;">"|DIRTY"</span>
<span style="font-weight: bold; font-style: italic;">#                       </span><span style="font-weight: bold; font-style: italic;">if [ -n "${GIT_PS1_SHOWSTASHSTATE-}" ]; then</span>
<span style="font-weight: bold; font-style: italic;">#                               </span><span style="font-weight: bold; font-style: italic;">git rev-parse --verify refs/stash &gt;/dev/null 2&gt;&amp;1 &amp;&amp; s="$"</span>
<span style="font-weight: bold; font-style: italic;">#                       </span><span style="font-weight: bold; font-style: italic;">fi</span>
<span style="font-weight: bold; font-style: italic;">#</span>
<span style="font-weight: bold; font-style: italic;">#                       </span><span style="font-weight: bold; font-style: italic;">if [ -n "${GIT_PS1_SHOWUNTRACKEDFILES-}" ]; then</span>
<span style="font-weight: bold; font-style: italic;">#                          </span><span style="font-weight: bold; font-style: italic;">if [ -n "$(git ls-files --others --exclude-standard)" ]; then</span>
<span style="font-weight: bold; font-style: italic;">#                             </span><span style="font-weight: bold; font-style: italic;">u="%"</span>
<span style="font-weight: bold; font-style: italic;">#                          </span><span style="font-weight: bold; font-style: italic;">fi</span>
<span style="font-weight: bold; font-style: italic;">#                       </span><span style="font-weight: bold; font-style: italic;">fi</span>
<span style="font-weight: bold; font-style: italic;">#</span>
<span style="font-weight: bold; font-style: italic;">#                       </span><span style="font-weight: bold; font-style: italic;">if [ -n "${GIT_PS1_SHOWUPSTREAM-}" ]; then</span>
<span style="font-weight: bold; font-style: italic;">#                               </span><span style="font-weight: bold; font-style: italic;">__git_ps1_show_upstream</span>
<span style="font-weight: bold; font-style: italic;">#                       </span><span style="font-weight: bold; font-style: italic;">fi</span>
                <span style="font-weight: bold;">fi</span>
        <span style="font-weight: bold;">else</span>
            <span style="font-weight: bold;">echo</span> <span style="font-style: italic;">"NOGIT"</span>
        <span style="font-weight: bold;">fi</span>
}

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">check if we only have untouched, modified or (if configured) new files</span>
<span style="font-weight: bold;">check_initial_file_state</span>()
{
    local <span style="font-weight: bold; font-style: italic;">syncNew</span>=<span style="font-style: italic;">"$(git config --get --bool branch.$branch_name.syncNewFiles)"</span>
    <span style="font-weight: bold;">if</span> [[ <span style="font-style: italic;">"true"</span> == <span style="font-style: italic;">"$syncNew"</span> || <span style="font-style: italic;">"true"</span> == <span style="font-style: italic;">"$sync_new_files_anyway"</span> ]]; <span style="font-weight: bold;">then</span>
        <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">allow for new files</span>
        <span style="font-weight: bold;">if</span> [ ! -z <span style="font-style: italic;">"$(git status --porcelain | grep -E '^[^ \?][^M\?] *')"</span> ]; <span style="font-weight: bold;">then</span>
            <span style="font-weight: bold;">echo</span> <span style="font-style: italic;">"NonNewOrModified"</span>
        <span style="font-weight: bold;">fi</span>
    <span style="font-weight: bold;">else</span>
        <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">also bail on new files</span>
        <span style="font-weight: bold;">if</span> [ ! -z <span style="font-style: italic;">"$(git status --porcelain | grep -E '^[^ ][^M] *')"</span> ]; <span style="font-weight: bold;">then</span>
            <span style="font-weight: bold;">echo</span> <span style="font-style: italic;">"NotOnlyModified"</span>
        <span style="font-weight: bold;">fi</span>
    <span style="font-weight: bold;">fi</span>
}

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">look for local changes</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">used to decide if autocommit should be invoked</span>
<span style="font-weight: bold;">local_changes</span>()
{
    <span style="font-weight: bold;">if</span> [ ! -z <span style="font-style: italic;">"$(git status --porcelain | grep -E '^(\?\?|[MARC] |[ MARC][MD])*')"</span> ]; <span style="font-weight: bold;">then</span>
        <span style="font-weight: bold;">echo</span> <span style="font-style: italic;">"LocalChanges"</span>
    <span style="font-weight: bold;">fi</span>
}

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">determine sync state of repository, i.e. how the remote relates to our HEAD</span>
<span style="font-weight: bold;">sync_state</span>()
{
    local <span style="font-weight: bold; font-style: italic;">count</span>=<span style="font-style: italic;">"$(git rev-list --count --left-right $remote_name/$branch_name...HEAD)"</span>

    <span style="font-weight: bold;">case</span> <span style="font-style: italic;">"$count"</span><span style="font-weight: bold;"> in</span>
        <span style="font-style: italic;">""</span>) <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">no upstream</span>
            <span style="font-weight: bold;">echo</span> <span style="font-style: italic;">"noUpstream"</span>
            false
            ;;
        <span style="font-style: italic;">"0      0"</span>)
            <span style="font-weight: bold;">echo</span> <span style="font-style: italic;">"equal"</span>
            true
            ;;
        <span style="font-style: italic;">"0      "</span>*)
            <span style="font-weight: bold;">echo</span> <span style="font-style: italic;">"ahead"</span>
            true
            ;;
        *<span style="font-style: italic;">"      0"</span>)
            <span style="font-weight: bold;">echo</span> <span style="font-style: italic;">"behind"</span>
            true
            ;;
        *)
            <span style="font-weight: bold;">echo</span> <span style="font-style: italic;">"diverged"</span>
            true
            ;;
    <span style="font-weight: bold;">esac</span>
}

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">exit, issue warning if not in sync</span>
<span style="font-weight: bold;">exit_assuming_sync</span>() {
    <span style="font-weight: bold;">if</span> [ <span style="font-style: italic;">"equal"</span> == <span style="font-style: italic;">"$(sync_state)"</span> ] ; <span style="font-weight: bold;">then</span>
        __log_msg <span style="font-style: italic;">"In sync, all fine."</span>
        <span style="font-weight: bold;">exit</span> 0;
    <span style="font-weight: bold;">else</span>
        __log_msg <span style="font-style: italic;">"Synchronization FAILED! You should definitely check your repository carefully!"</span>
        __log_msg <span style="font-style: italic;">"(Possibly a transient network problem? Please try again in that case.)"</span>
        <span style="font-weight: bold;">exit</span> 3
    <span style="font-weight: bold;">fi</span>
}

<span style="font-weight: bold; font-style: italic;">#</span>
<span style="font-weight: bold; font-style: italic;">#        </span><span style="font-weight: bold; font-style: italic;">Here git-sync actually starts</span>
<span style="font-weight: bold; font-style: italic;">#</span>

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">first some sanity checks</span>
<span style="font-weight: bold; font-style: italic;">rstate</span>=<span style="font-style: italic;">"$(git_repo_state)"</span>
<span style="font-weight: bold;">if</span> [[ -z <span style="font-style: italic;">"$rstate"</span> || <span style="font-style: italic;">"|DIRTY"</span> = <span style="font-style: italic;">"$rstate"</span> ]]; <span style="font-weight: bold;">then</span>
    __log_msg <span style="font-style: italic;">"Preparing. Repo in $(__gitdir)"</span>
<span style="font-weight: bold;">elif</span> [[ <span style="font-style: italic;">"NOGIT"</span> = <span style="font-style: italic;">"$rstate"</span> ]] ; <span style="font-weight: bold;">then</span>
    __log_msg <span style="font-style: italic;">"No git repository detected. Exiting."</span>
    <span style="font-weight: bold;">exit</span> 128 <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">matches git's error code</span>
<span style="font-weight: bold;">else</span>
    __log_msg <span style="font-style: italic;">"Git repo state considered unsafe for sync: $(git_repo_state)"</span>
    <span style="font-weight: bold;">exit</span> 2
<span style="font-weight: bold;">fi</span>

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">determine the current branch (thanks to stackoverflow)</span>
<span style="font-weight: bold; font-style: italic;">branch_name</span>=$(git symbolic-ref -q HEAD)
<span style="font-weight: bold; font-style: italic;">branch_name</span>=${<span style="font-weight: bold; font-style: italic;">branch_name</span>##refs/heads/}

<span style="font-weight: bold;">if</span> [ -z <span style="font-style: italic;">"$branch_name"</span> ] ; <span style="font-weight: bold;">then</span>
    __log_msg <span style="font-style: italic;">"Syncing is only possible on a branch."</span>
    git status
    <span style="font-weight: bold;">exit</span> 2
<span style="font-weight: bold;">fi</span>

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">while at it, determine the remote to operate on</span>
<span style="font-weight: bold; font-style: italic;">remote_name</span>=$(git config --get branch.$<span style="font-weight: bold; font-style: italic;">branch_name</span>.pushRemote)
<span style="font-weight: bold;">if</span> [ -z <span style="font-style: italic;">"$remote_name"</span> ] ; <span style="font-weight: bold;">then</span>
    <span style="font-weight: bold; font-style: italic;">remote_name</span>=$(git config --get remote.pushDefault)
<span style="font-weight: bold;">fi</span>
<span style="font-weight: bold;">if</span> [ -z <span style="font-style: italic;">"$remote_name"</span> ] ; <span style="font-weight: bold;">then</span>
    <span style="font-weight: bold; font-style: italic;">remote_name</span>=$(git config --get branch.$<span style="font-weight: bold; font-style: italic;">branch_name</span>.remote)
<span style="font-weight: bold;">fi</span>

<span style="font-weight: bold;">if</span> [ -z <span style="font-style: italic;">"$remote_name"</span> ] ; <span style="font-weight: bold;">then</span>
    __log_msg <span style="font-style: italic;">"the current branch does not have a configured remote."</span>
    <span style="font-weight: bold;">echo</span>
    __log_msg <span style="font-style: italic;">"Please use"</span>
    <span style="font-weight: bold;">echo</span>
    __log_msg <span style="font-style: italic;">"  git branch --set-upstream-to=[remote_name]/$branch_name"</span>
    <span style="font-weight: bold;">echo</span>
    __log_msg <span style="font-style: italic;">"replacing [remote_name] with the name of your remote, i.e. - origin"</span>
    __log_msg <span style="font-style: italic;">"to set the remote tracking branch for git-sync to work"</span>
    <span style="font-weight: bold;">exit</span> 2
<span style="font-weight: bold;">fi</span>

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">check if current branch is configured for sync</span>
<span style="font-weight: bold;">if</span> [[ <span style="font-style: italic;">"true"</span> != <span style="font-style: italic;">"$(git config --get --bool branch.$branch_name.sync)"</span> &amp;&amp; <span style="font-style: italic;">"true"</span> != <span style="font-style: italic;">"$sync_anyway"</span> ]] ; <span style="font-weight: bold;">then</span>
    <span style="font-weight: bold;">echo</span>
    __log_msg <span style="font-style: italic;">"Please use"</span>
    <span style="font-weight: bold;">echo</span>
    __log_msg <span style="font-style: italic;">"  git config --bool branch.$branch_name.sync true"</span>
    <span style="font-weight: bold;">echo</span>
    __log_msg <span style="font-style: italic;">"to enlist branch $branch_name for synchronization."</span>
    __log_msg <span style="font-style: italic;">"Branch $branch_name has to have a same-named remote branch"</span>
    __log_msg <span style="font-style: italic;">"for git-sync to work."</span>
    <span style="font-weight: bold;">echo</span>
    __log_msg <span style="font-style: italic;">"(If you don't know what this means, you should change that"</span>
    __log_msg <span style="font-style: italic;">"before relying on this script. You have been warned.)"</span>
    <span style="font-weight: bold;">echo</span>
    <span style="font-weight: bold;">exit</span> 1
<span style="font-weight: bold;">fi</span>

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">determine mode</span>
<span style="font-weight: bold;">if</span> [[ -z <span style="font-style: italic;">"$1"</span> || <span style="font-style: italic;">"$1"</span> == <span style="font-style: italic;">"sync"</span> ]]; <span style="font-weight: bold;">then</span>
    <span style="font-weight: bold; font-style: italic;">mode</span>=<span style="font-style: italic;">"sync"</span>
<span style="font-weight: bold;">elif</span> [[ <span style="font-style: italic;">"check"</span> == <span style="font-style: italic;">"$1"</span> ]]; <span style="font-weight: bold;">then</span>
    <span style="font-weight: bold; font-style: italic;">mode</span>=<span style="font-style: italic;">"check"</span>
<span style="font-weight: bold;">else</span>
    __log_msg <span style="font-style: italic;">"Mode $1 not recognized"</span>
    <span style="font-weight: bold;">exit</span> 100
<span style="font-weight: bold;">fi</span>

__log_msg <span style="font-style: italic;">"Mode $mode"</span>

__log_msg <span style="font-style: italic;">"Using $remote_name/$branch_name"</span>

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">check for intentionally unhandled file states</span>
<span style="font-weight: bold;">if</span> [ ! -z <span style="font-style: italic;">"$(check_initial_file_state)"</span> ] ; <span style="font-weight: bold;">then</span>
    __log_msg <span style="font-style: italic;">"There are changed files you should probably handle manually."</span>
    git status
    <span style="font-weight: bold;">exit</span> 1
<span style="font-weight: bold;">fi</span>

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">if in check mode, this is all we need to know</span>
<span style="font-weight: bold;">if</span> [ $<span style="font-weight: bold; font-style: italic;">mode</span> == <span style="font-style: italic;">"check"</span> ] ; <span style="font-weight: bold;">then</span>
    __log_msg <span style="font-style: italic;">"check OK; sync may start."</span>
    <span style="font-weight: bold;">exit</span> 0
<span style="font-weight: bold;">fi</span>

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">check if we have to commit local changes, if yes, do so</span>
<span style="font-weight: bold;">if</span> [ ! -z <span style="font-style: italic;">"$(local_changes)"</span> ]; <span style="font-weight: bold;">then</span>
    <span style="font-weight: bold; font-style: italic;">autocommit_cmd</span>=<span style="font-style: italic;">""</span>
    <span style="font-weight: bold; font-style: italic;">config_autocommit_cmd</span>=<span style="font-style: italic;">"$(git config --get branch.$branch_name.autocommitscript)"</span>

    <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">discern the three ways to auto-commit</span>
    <span style="font-weight: bold;">if</span> [ ! -z <span style="font-style: italic;">"$config_autocommit_cmd"</span> ]; <span style="font-weight: bold;">then</span>
        <span style="font-weight: bold; font-style: italic;">autocommit_cmd</span>=<span style="font-style: italic;">"$config_autocommit_cmd"</span>
    <span style="font-weight: bold;">elif</span> [[ <span style="font-style: italic;">"true"</span> == <span style="font-style: italic;">"$(git config --get --bool branch.$branch_name.syncNewFiles)"</span> || <span style="font-style: italic;">"true"</span> == <span style="font-style: italic;">"$sync_new_files_anyway"</span> ]]; <span style="font-weight: bold;">then</span>
        <span style="font-weight: bold; font-style: italic;">autocommit_cmd</span>=${<span style="font-weight: bold; font-style: italic;">ALL_AUTOCOMMIT_CMD</span>}
    <span style="font-weight: bold;">else</span>
        <span style="font-weight: bold; font-style: italic;">autocommit_cmd</span>=${<span style="font-weight: bold; font-style: italic;">DEFAULT_AUTOCOMMIT_CMD</span>}
    <span style="font-weight: bold;">fi</span>

    <span style="font-weight: bold; font-style: italic;">commit_msg</span>=<span style="font-style: italic;">"$(git config --get branch.$branch_name.syncCommitMsg)"</span>
    <span style="font-weight: bold;">if</span> [ <span style="font-style: italic;">""</span> == <span style="font-style: italic;">"$commit_msg"</span> ]; <span style="font-weight: bold;">then</span>
      <span style="font-weight: bold; font-style: italic;">commit_msg</span>=${<span style="font-weight: bold; font-style: italic;">DEFAULT_AUTOCOMMIT_MSG</span>}
    <span style="font-weight: bold;">fi</span>
    <span style="font-weight: bold; font-style: italic;">autocommit_cmd</span>=$(<span style="font-weight: bold;">echo</span> <span style="font-style: italic;">"$autocommit_cmd"</span> | sed <span style="font-style: italic;">"s/%message/$commit_msg/"</span>)

    __log_msg <span style="font-style: italic;">"Committing local changes using ${autocommit_cmd}"</span>
    <span style="font-weight: bold;">eval</span> $<span style="font-weight: bold; font-style: italic;">autocommit_cmd</span>

    <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">after autocommit, we should be clean</span>
    <span style="font-weight: bold; font-style: italic;">rstate</span>=<span style="font-style: italic;">"$(git_repo_state)"</span>
    <span style="font-weight: bold;">if</span> [[ ! -z <span style="font-style: italic;">"$rstate"</span> ]]; <span style="font-weight: bold;">then</span>
        __log_msg <span style="font-style: italic;">"Auto-commit left uncommitted changes. Please add or remove them as desired and retry."</span>
        <span style="font-weight: bold;">exit</span> 1
    <span style="font-weight: bold;">fi</span>
<span style="font-weight: bold;">fi</span>

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">fetch remote to get to the current sync state</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">TODO make fetching/pushing optional</span>
__log_msg <span style="font-style: italic;">"Fetching from $remote_name/$branch_name"</span>
git fetch $<span style="font-weight: bold; font-style: italic;">remote_name</span> $<span style="font-weight: bold; font-style: italic;">branch_name</span>
<span style="font-weight: bold;">if</span> [ $<span style="font-weight: bold; font-style: italic;">?</span> != 0 ] ; <span style="font-weight: bold;">then</span>
    __log_msg <span style="font-style: italic;">"git fetch $remote_name returned non-zero. Likely a network problem; exiting."</span>
    <span style="font-weight: bold;">exit</span> 3
<span style="font-weight: bold;">fi</span>

<span style="font-weight: bold;">case</span> <span style="font-style: italic;">"$(sync_state)"</span><span style="font-weight: bold;"> in</span>
<span style="font-style: italic;">"noUpstream"</span>)
        __log_msg <span style="font-style: italic;">"Strange state, you're on your own. Good luck."</span>
        <span style="font-weight: bold;">exit</span> 2
        ;;
<span style="font-style: italic;">"equal"</span>)
        exit_assuming_sync
        ;;
<span style="font-style: italic;">"ahead"</span>)
        __log_msg <span style="font-style: italic;">"Pushing changes..."</span>
        git push $<span style="font-weight: bold; font-style: italic;">remote_name</span> $<span style="font-weight: bold; font-style: italic;">branch_name</span>:$<span style="font-weight: bold; font-style: italic;">branch_name</span>
        <span style="font-weight: bold;">if</span> [ $<span style="font-weight: bold; font-style: italic;">?</span> == 0 ]; <span style="font-weight: bold;">then</span>
            exit_assuming_sync
        <span style="font-weight: bold;">else</span>
            __log_msg <span style="font-style: italic;">"git push returned non-zero. Likely a connection failure."</span>
            <span style="font-weight: bold;">exit</span> 3
        <span style="font-weight: bold;">fi</span>
        ;;
<span style="font-style: italic;">"behind"</span>)
        __log_msg <span style="font-style: italic;">"We are behind, fast-forwarding..."</span>
        git merge --ff --ff-only $<span style="font-weight: bold; font-style: italic;">remote_name</span>/$<span style="font-weight: bold; font-style: italic;">branch_name</span>
        <span style="font-weight: bold;">if</span> [ $<span style="font-weight: bold; font-style: italic;">?</span> == 0 ]; <span style="font-weight: bold;">then</span>
            exit_assuming_sync
        <span style="font-weight: bold;">else</span>
            __log_msg <span style="font-style: italic;">"git merge --ff --ff-only returned non-zero ($?). Exiting."</span>
            <span style="font-weight: bold;">exit</span> 2
        <span style="font-weight: bold;">fi</span>
        ;;
<span style="font-style: italic;">"diverged"</span>)
        __log_msg <span style="font-style: italic;">"We have diverged. Trying to rebase..."</span>
        git rebase $<span style="font-weight: bold; font-style: italic;">remote_name</span>/$<span style="font-weight: bold; font-style: italic;">branch_name</span>
        <span style="font-weight: bold;">if</span> [[ $<span style="font-weight: bold; font-style: italic;">?</span> == 0 &amp;&amp; -z <span style="font-style: italic;">"$(git_repo_state)"</span> &amp;&amp; <span style="font-style: italic;">"ahead"</span> == <span style="font-style: italic;">"$(sync_state)"</span> ]] ; <span style="font-weight: bold;">then</span>
            __log_msg <span style="font-style: italic;">"Rebasing went fine, pushing..."</span>
            git push $<span style="font-weight: bold; font-style: italic;">remote_name</span> $<span style="font-weight: bold; font-style: italic;">branch_name</span>:$<span style="font-weight: bold; font-style: italic;">branch_name</span>
            exit_assuming_sync
        <span style="font-weight: bold;">else</span>
            __log_msg <span style="font-style: italic;">"Rebasing failed, likely there are conflicting changes. Resolve them and finish the rebase before repeating git-sync."</span>
            <span style="font-weight: bold;">exit</span> 1
        <span style="font-weight: bold;">fi</span>
        <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">TODO: save master, if rebasing fails, make a branch of old master</span>
        ;;
<span style="font-weight: bold;">esac</span>
</pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="creator"><a href="https://www.gnu.org/software/emacs/">Emacs</a> 26.3 (<a href="https://orgmode.org">Org</a> mode 9.1.9)</p>
<p class="validation"></p>
</div>
</body>
</html>
