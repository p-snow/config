<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Dotfiles</title>
<meta name="generator" content="Org Mode" />
<link rel="stylesheet" type="text/css" href="https://fniessen.github.io/org-html-themes/src/readtheorg_theme/css/htmlize.css"/>
<link rel="stylesheet" type="text/css" href="https://fniessen.github.io/org-html-themes/src/readtheorg_theme/css/readtheorg.css"/>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/src/lib/js/jquery.stickytableheaders.min.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/src/readtheorg_theme/js/readtheorg.js"></script>
</head>
<body>
<div id="content" class="content">
<h1 class="title">Dotfiles</h1>
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#orgd1d6fe4">Personal Information</a>
<ul>
<li><a href="#org7b05f38">Local Directories</a>
<ul>
<li><a href="#org1f809a2">home directory</a></li>
<li><a href="#org9718829">config directory</a></li>
<li><a href="#orgb56808c">document directory</a></li>
<li><a href="#org712dd00">data directory</a></li>
<li><a href="#orgf8edccd">share directory</a></li>
<li><a href="#org96126e5">media directory</a></li>
<li><a href="#org0880f28">trash directory</a></li>
<li><a href="#orge6a1214">log file directory</a></li>
</ul>
</li>
<li><a href="#org1bc0a1c">Email Settings</a>
<ul>
<li><a href="#orgc54beea">Smtp Server Host&#xa0;&#xa0;&#xa0;<span class="tag"><span class="crypt">crypt</span></span></a></li>
<li><a href="#org46ce9ef">Dummy Smtp Server Host</a></li>
<li><a href="#orged3d996">My Email Address&#xa0;&#xa0;&#xa0;<span class="tag"><span class="crypt">crypt</span></span></a></li>
<li><a href="#org84552c3">Dummy Email Address</a></li>
<li><a href="#org232fa43">Full Name&#xa0;&#xa0;&#xa0;<span class="tag"><span class="crypt">crypt</span></span></a></li>
<li><a href="#org314be7b">Dummy Full Name</a></li>
<li><a href="#orgc3517f0">My Login Name</a></li>
<li><a href="#org8653c08">My Domain Name</a></li>
</ul>
</li>
<li><a href="#org6fde87c">Machines</a>
<ul>
<li><a href="#org81d382b">Primary Laptop</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org20dd52b">Linux Distributions</a>
<ul>
<li><a href="#org653bd20">Ubuntu</a>
<ul>
<li><a href="#org7e56261">Apt Package Manager</a></li>
</ul>
</li>
<li><a href="#org301e07d">Linux Mint (Cinnamon DE)</a></li>
<li><a href="#org576d4ba">GNU Guix</a>
<ul>
<li><a href="#org42c3fc0">Channels</a></li>
<li><a href="#orgcdcc21f">Profiles</a></li>
<li><a href="#orgd695129">Home Configuration</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgc9c081d">Home Environment</a>
<ul>
<li><a href="#orga27340c">Fontconfig&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span></a></li>
<li><a href="#org289be17">Bash</a>
<ul>
<li><a href="#orgdccd451">bashrc</a></li>
<li><a href="#org94b645d">bash functions&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span></a></li>
<li><a href="#org83c9038">Shell Command Aliases</a></li>
</ul>
</li>
<li><a href="#orgc308389">Systemd</a>
<ul>
<li><a href="#org617b2c9">systemd-tmpfiles</a></li>
</ul>
</li>
<li><a href="#org8e72f9b">Vixie Cron</a></li>
<li><a href="#orgb1901d1">Btrfs</a>
<ul>
<li><a href="#org599a2a5">btrbk</a></li>
<li><a href="#org0c0e125">snapshots management&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span></a></li>
<li><a href="#org31f6062">backup to another device&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span></a></li>
</ul>
</li>
<li><a href="#org9c2cc9a">XDG</a>
<ul>
<li><a href="#orgf675861">xdg-mime</a></li>
</ul>
</li>
<li><a href="#org883bd0e">GnuPG (gpg)</a></li>
<li><a href="#orgbeecda8">Key Remappers</a>
<ul>
<li><a href="#org1f0e21f">Xremap&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span></a></li>
<li><a href="#org377553c">XKB&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span></a></li>
<li><a href="#org114fa45">Interception Tools&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span></a></li>
<li><a href="#org8554bc5">keyd</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgb75928e">Application Configurations</a>
<ul>
<li><a href="#gnu-emacs">GNU Emacs</a>
<ul>
<li><a href="#org8c7abe5">Basic Configuration</a></li>
<li><a href="#org99e6b01">Innovative Customization</a></li>
<li><a href="#org1747626">Org Tweaks for Specific Needs</a></li>
<li><a href="#orga5a40bf">would-be packages</a></li>
</ul>
</li>
<li><a href="#orgf3aca1f">Findutils</a></li>
<li><a href="#org739a68e">plocate</a></li>
<li><a href="#orgb678ff3">Git</a>
<ul>
<li><a href="#orge0a5284">git ignore</a></li>
<li><a href="#org12ab0cf">git config</a></li>
<li><a href="#org420640f">git attributes</a></li>
</ul>
</li>
<li><a href="#orge3e92d6">pass-git-helper</a></li>
<li><a href="#orged40449">git-annex</a>
<ul>
<li><a href="#orgd6f27e2">sync annex repos</a></li>
</ul>
</li>
<li><a href="#org0815aa3">ghq</a>
<ul>
<li><a href="#org16c8bbd">personal ghq environment</a></li>
</ul>
</li>
<li><a href="#orgf035fd3">Pass</a></li>
<li><a href="#orga9c1a36">mpv</a></li>
<li><a href="#org0effe0a">unison</a></li>
<li><a href="#org3f17d05">Aspell</a></li>
<li><a href="#org7e18628">textlint</a></li>
<li><a href="#org6a2b7ed">xkeysnail&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span></a></li>
<li><a href="#org394485f">SKK</a>
<ul>
<li><a href="#org27a2142">derive unique entries in user-jisyo&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span></a></li>
</ul>
</li>
<li><a href="#org292d28a">Festival</a></li>
<li><a href="#orgccd8442">Open JTalk</a></li>
<li><a href="#orgb5c8101">Jack&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span></a></li>
<li><a href="#org428449a">XRandR</a></li>
<li><a href="#orgc25f4c1">C/Migemo</a>
<ul>
<li><a href="#orgd15d592">C/Migemo in apt&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span></a></li>
<li><a href="#org08ca172">AZIK-compliant C/Migemo&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span></a></li>
</ul>
</li>
<li><a href="#org4a22ddc">LilyPond</a></li>
<li><a href="#org188c75d">Graphviz</a></li>
<li><a href="#org7e2606a">Rsync</a>
<ul>
<li><a href="#orge008dae">sync server data&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span></a></li>
<li><a href="#orgf76b0d6">backup script&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span></a></li>
</ul>
</li>
<li><a href="#orgdb158e9">libvirt</a></li>
<li><a href="#org956ba1e">Calibre</a></li>
<li><a href="#org4fcca14">yt-dlp</a></li>
<li><a href="#orgcebd626">rTorrent&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span></a></li>
<li><a href="#org54c24a0">Ledger</a></li>
<li><a href="#orgd9c5acf">ripgrep-all</a></li>
<li><a href="#org98a3372">Recoll</a>
<ul>
<li><a href="#org4e51fc7">systemd setting&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span></a></li>
</ul>
</li>
<li><a href="#orgfa615de">Enchant</a></li>
<li><a href="#org8c77f4d">Modern alternative command line tools</a></li>
<li><a href="#orgdcae8b6">Haunt</a></li>
<li><a href="#orgd5424f9">Wine</a></li>
<li><a href="#orga6377ca">Font Viewer</a></li>
</ul>
</li>
<li><a href="#orgcfac69f">Development Infrastructures</a>
<ul>
<li><a href="#org8cff5b4">C/C++</a></li>
<li><a href="#org7a1a6ee">Python</a></li>
<li><a href="#org70a48ba">Ruby</a></li>
<li><a href="#org8f3632a">Lua</a></li>
<li><a href="#org98df55e">Common Lisp</a></li>
<li><a href="#orgeeff7d2">Node.js</a></li>
<li><a href="#org9c6d77a">asdf-vm&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span></a></li>
<li><a href="#org0e2e280">Language Servers</a>
<ul>
<li><a href="#org52bcdb3">Bash Language Server</a></li>
<li><a href="#org3379817">Solargraph</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgd1dae9a">Stuffs for Dedicated Tasks</a>
<ul>
<li><a href="#orgb09a6a8">Batch Processing</a>
<ul>
<li><a href="#org045abe8">Morning Batch</a></li>
<li><a href="#org2009efa">Midnight Batch</a></li>
</ul>
</li>
<li><a href="#org8039a8e">Transcode Video Files</a>
<ul>
<li><a href="#org3a9a091">vp9 transcoding</a></li>
<li><a href="#orga6e2fb6">av1 transcoding</a></li>
</ul>
</li>
<li><a href="#org75dab74">Transcode Audio Files&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span></a></li>
<li><a href="#orgd3608e5">DVD Packing</a></li>
<li><a href="#org7be2ccd">CD Ripping</a>
<ul>
<li><a href="#orgd3660c2">abcde</a></li>
</ul>
</li>
<li><a href="#orgecf2be3">Tutorial Video Creation</a>
<ul>
<li><a href="#orgc8e4573">Screenkey</a></li>
</ul>
</li>
<li><a href="#org2e9868f">Sync Git Repos Automatically</a>
<ul>
<li><a href="#org5030d01">git-sync&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span></a></li>
</ul>
</li>
<li><a href="#org4a37107">Controlling Emacs from Desktop</a></li>
</ul>
</li>
<li><a href="#org578ba65">Babel Utility Functions</a>
<ul>
<li><a href="#orgcb6fae1">which path</a></li>
<li><a href="#org2958cd4">Generate hash string</a></li>
<li><a href="#orgf637e04">random number</a></li>
<li><a href="#orga3e91b9">Hours in seconds</a></li>
</ul>
</li>
<li><a href="#org32e8bd9">Specialized Scripts</a>
<ul>
<li><a href="#org3d0688a">Declutters&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span></a></li>
<li><a href="#org9e67752">Database back-up scripts</a></li>
<li><a href="#orgf9e8a84">filetype</a></li>
<li><a href="#org8998313">mediautil</a></li>
<li><a href="#org2a516be">genalbum</a></li>
<li><a href="#org86a776f">nhp&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span></a></li>
<li><a href="#orgd6b7941">sendmail.py</a></li>
<li><a href="#org5fca85a">pwsudo</a></li>
<li><a href="#orgbaa97de">gitsync&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span></a></li>
<li><a href="#org167769d">filetype-cli&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span></a></li>
<li><a href="#orgcf78454">strip ruby</a></li>
</ul>
</li>
<li><a href="#orgc8801d7">Local Variables</a></li>
</ul>
</div>
</div>

<div id="outline-container-orgd1d6fe4" class="outline-2">
<h2 id="orgd1d6fe4">Personal Information</h2>
<div class="outline-text-2" id="text-orgd1d6fe4">
</div>
<div id="outline-container-org7b05f38" class="outline-3">
<h3 id="org7b05f38">Local Directories</h3>
<div class="outline-text-3" id="text-org7b05f38">
</div>
<div id="outline-container-org1f809a2" class="outline-4">
<h4 id="org1f809a2">home directory</h4>
<div class="outline-text-4" id="text-org1f809a2">
<div class="org-src-container">
<pre class="src src-shell" id="orga49d585"><span style="font-weight: bold;">echo</span> -n <span style="font-style: italic;">'~'</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org9718829" class="outline-4">
<h4 id="org9718829">config directory</h4>
<div class="outline-text-4" id="text-org9718829">
<div class="org-src-container">
<pre class="src src-shell" id="org404a14e"><span style="font-weight: bold;">echo</span> <span style="font-style: italic;">'~/.config'</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb56808c" class="outline-4">
<h4 id="orgb56808c">document directory</h4>
<div class="outline-text-4" id="text-orgb56808c">
<div class="org-src-container">
<pre class="src src-emacs-lisp" id="orgc48022e">(file-name-concat <span style="font-style: italic;">"~/"</span> <span style="font-style: italic;">"&lt;&lt;laptop-node()&gt;&gt;"</span> <span style="font-style: italic;">"doc"</span>)
</pre>
</div>
</div>
</div>

<div id="outline-container-org712dd00" class="outline-4">
<h4 id="org712dd00">data directory</h4>
<div class="outline-text-4" id="text-org712dd00">
<div class="org-src-container">
<pre class="src src-shell" id="org9d9067d">realpath <span style="font-style: italic;">"${HOME}/data"</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf8edccd" class="outline-4">
<h4 id="orgf8edccd">share directory</h4>
<div class="outline-text-4" id="text-orgf8edccd">
<p>
My share directory is where my variable data stay.
</p>

<div class="org-src-container">
<pre class="src src-shell" id="org724e2f6"><span style="font-weight: bold;">echo</span> -n <span style="font-style: italic;">'~/.local/share'</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org96126e5" class="outline-4">
<h4 id="org96126e5">media directory</h4>
<div class="outline-text-4" id="text-org96126e5">
<div class="org-src-container">
<pre class="src src-shell">&lt;&lt;media-dir()&gt;&gt;
</pre>
</div>

<div class="org-src-container">
<pre class="src src-sh" id="org3a4f27a"><span style="font-weight: bold;">echo</span> -n <span style="font-style: italic;">'~/.local/share/video'</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org0880f28" class="outline-4">
<h4 id="org0880f28">trash directory</h4>
<div class="outline-text-4" id="text-org0880f28">
<div class="org-src-container">
<pre class="src src-emacs-lisp" id="org7196898">(funcall (<span style="font-weight: bold;">if</span> (= full-path 0) #'identity #'expand-file-name)
         <span style="font-style: italic;">"~/.local/share/Trash"</span>)
</pre>
</div>

<p>
delete file which lives longer than 1 week in trash directory.
</p>

<div class="org-src-container">
<pre class="src src-conf"><span style="font-weight: bold; font-style: italic;">d &lt;&lt;trash-dir(full-path</span>=1)&gt;&gt;/files - - - 1w
</pre>
</div>
</div>
</div>

<div id="outline-container-orge6a1214" class="outline-4">
<h4 id="orge6a1214">log file directory</h4>
<div class="outline-text-4" id="text-orge6a1214">
<div class="org-src-container">
<pre class="src src-shell" id="orgfc9abf0"><span style="font-weight: bold;">echo</span> -n <span style="font-style: italic;">'~/.local/state/log'</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-shell">&lt;&lt;log-dir()&gt;&gt;
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org1bc0a1c" class="outline-3">
<h3 id="org1bc0a1c">Email Settings</h3>
<div class="outline-text-3" id="text-org1bc0a1c">
</div>

<div id="outline-container-orgc54beea" class="outline-4">
<h4 id="orgc54beea">Smtp Server Host&#xa0;&#xa0;&#xa0;<span class="tag"><span class="crypt">crypt</span></span></h4>
<div class="outline-text-4" id="text-orgc54beea">
<p>
&#x2013;&#x2014;BEGIN PGP MESSAGE&#x2013;&#x2014;
</p>

<p>
hQEMA9uWvE5LJ2ejAQgAgdgJUS0v+ASUy6B5/RsqDdm/3ll8VK3bq+GlNPdPUIca
hO2qmuJfgiwXWmNZtr4wSFLYOEU6l9PjM8lCS+U1dcv18XcX0v3cjIZKb/0EiABl
PLnxdI0Nnkk3RBrWICP1+DLE48rCuJQvdHLzZ8wsVw1Wh4/BizIvY+t7+TxSDKLy
4UissNE9C+lftBL7caIaSUOyeppoQCKUaM4TaRiJU/Yv0QpCZvp6x03dSoTkr10h
l73EhhlkhbwvAUAg8Sb2hX7bAFwR8qp6BC8XkbtZM5u2uqrYUAmXGIYmHWOYSvQZ
hsxj9jzPkt8Y+xIZ//+oXxhN0UFigwGHn5IbIlB2TNJ+AYMlUGxMiv13YoI19N09
aGTmms93QHI7c86kfJNi4bI20kDLOwZThFK3gXEpzVFFT0rD1LOVga3Dqw1VsO0N
EEcaZWs9POlc4rdeF3kn3ZSB0P3J77vidiaIFOh5lNpU/9k7nEmT9QE0K++fpTxs
obm9ZjahsnwNP10Vn2pQ
=rUbc
&#x2013;&#x2014;END PGP MESSAGE&#x2013;&#x2014;
</p>
</div>
</div>

<div id="outline-container-org46ce9ef" class="outline-4">
<h4 id="org46ce9ef">Dummy Smtp Server Host</h4>
<div class="outline-text-4" id="text-org46ce9ef">
<p>
This is a dummy SMTP server definition that serves as a fallback when the genuine definition (encrypted above) is absent.
</p>

<div class="org-src-container">
<pre class="src src-text" id="org0bc9d79">smtp.dummy.com
</pre>
</div>
</div>
</div>

<div id="outline-container-orged3d996" class="outline-4">
<h4 id="orged3d996">My Email Address&#xa0;&#xa0;&#xa0;<span class="tag"><span class="crypt">crypt</span></span></h4>
<div class="outline-text-4" id="text-orged3d996">
<p>
&#x2013;&#x2014;BEGIN PGP MESSAGE&#x2013;&#x2014;
</p>

<p>
hQEMA9uWvE5LJ2ejAQgAtC7Jd2eChH/yaCKEx5ecJFRpmv0JJlymqJU7Jf2ShbgF
FQeDPbqQaBAyp/vV9RVxeiYV5EsOofTJYhlLvvdiv4zq4NiaaEDjrUblOGWxaEHp
KBMdKLqqLADM9RfvPv2vrofI7FtxAG7PF+wRFeW1vXyKakjhnPA/ydJpDdOIgjzh
HCPmcZnYObSz9pwKPM05Rhfd7eLtOtaWBCxmTLGHhVd9xU0dXJ3eQwO0OeqYns7l
QWq4lQ9Q825aZ7h+hKkamleVuKy8kjrBxnfdsyHGMaPUQlQcTTnNmS50+EmiHh4Z
0I9N+vIhAM6yuz5Y/C4pndMgggFjKYCpmVAnIJLLjdKBASx2bGgpUfmRqdHeOwY5
<i>3zipNj2QRjif9iZuSNdgthn2Yz0wtZuzwzc+CGib/fqtY+N5Nt36mhydgbac36v
y3bLp9UlGFAAUsqmvw1EP0nmtONIX+9SZDL3B08OV6OdtmmINKNAR/8rkDZN8o0d
5F/lEfK8uU00O1Cwjl6O8YK</i>
=qchL
&#x2013;&#x2014;END PGP MESSAGE&#x2013;&#x2014;
</p>
</div>
</div>

<div id="outline-container-org84552c3" class="outline-4">
<h4 id="org84552c3">Dummy Email Address</h4>
<div class="outline-text-4" id="text-org84552c3">
<p>
This is a dummy email address that serves as a fallback when the genuine (encrypted above) is absent or not available.
</p>

<div class="org-src-container">
<pre class="src src-text" id="orgc0b2fd8">user@dummy.com
</pre>
</div>
</div>
</div>

<div id="outline-container-org232fa43" class="outline-4">
<h4 id="org232fa43">Full Name&#xa0;&#xa0;&#xa0;<span class="tag"><span class="crypt">crypt</span></span></h4>
<div class="outline-text-4" id="text-org232fa43">
<p>
&#x2013;&#x2014;BEGIN PGP MESSAGE&#x2013;&#x2014;
</p>

<p>
hQEMA9uWvE5LJ2ejAQf/fpFgrhLTsuuXLWW4RU3WzAee1B+bBReCkH3mBbS/YWhO
8Cdle+MnLNbZ9WMOxZuSA8Zrb+6GM9rijC5UEwkT172KlmikttltCUyn4If6M/R3
zGyWy0Y0CAYL5QT7v/IMnBgwjo5nPvfjXQASbuvf/PhNZvl1Gi3Zcz+VAQGtFkhU
JK6h+HRb//NyzkwqY9WhXPxQePRxF2xQcFJnWLSg+viV5fid6ANRMBVPZAUhj1pg
Ew/uj4a4jGK14L2zrlhbtzYygpo3TrOiJRPJ2g8nmr9g6CBb7qAFo+27kqTPHk2P
qsZENoKtr3yzbLLL9SOOO0OD6A+bzH775hRySkt2ONJ/Ae8d3Fl+tke/QjaLpjC1
I17sR6dQ3Qz24BdNkg4rC5DvOftdqppf2vxJXN5Th7izSAmZHly6KGauoMi+qdnH
foMOc7y5cb5uQiPYIfNQICKo4Ut9yWjfnI79b94LUZopRTJpcVc7uCbcZ0E2iHTG
Kk2NxYDwNZELB7iqDq9mbQ==
=O5aZ
&#x2013;&#x2014;END PGP MESSAGE&#x2013;&#x2014;
</p>
</div>
</div>

<div id="outline-container-org314be7b" class="outline-4">
<h4 id="org314be7b">Dummy Full Name</h4>
<div class="outline-text-4" id="text-org314be7b">
<p>
This is a dummy full name that serves as a fallback when the genuine (encrypted above) is absent or not available.
</p>

<div class="org-src-container">
<pre class="src src-text" id="org3984337">taro.yamada
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc3517f0" class="outline-4">
<h4 id="orgc3517f0">My Login Name</h4>
<div class="outline-text-4" id="text-orgc3517f0">
<div class="org-src-container">
<pre class="src src-emacs-lisp" id="org437a45e">user-login-name
</pre>
</div>
</div>
</div>

<div id="outline-container-org8653c08" class="outline-4">
<h4 id="org8653c08">My Domain Name</h4>
<div class="outline-text-4" id="text-org8653c08">
<div class="org-src-container">
<pre class="src src-shell" id="orgc3f12bf"><span style="font-weight: bold;">echo</span> -n <span style="font-style: italic;">"${EMAIL}"</span> | cut -d<span style="font-style: italic;">'@'</span> -f2
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org6fde87c" class="outline-3">
<h3 id="org6fde87c">Machines</h3>
<div class="outline-text-3" id="text-org6fde87c">
</div>

<div id="outline-container-org81d382b" class="outline-4">
<h4 id="org81d382b">Primary Laptop</h4>
<div class="outline-text-4" id="text-org81d382b">
<div class="org-src-container">
<pre class="src src-shell" id="org3a1ddf4">uname -n
</pre>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-org20dd52b" class="outline-2">
<h2 id="org20dd52b">Linux Distributions</h2>
<div class="outline-text-2" id="text-org20dd52b">
</div>
<div id="outline-container-org653bd20" class="outline-3">
<h3 id="org653bd20">Ubuntu</h3>
<div class="outline-text-3" id="text-org653bd20">
<p>
initialization script for a ubuntu account
</p>

<div class="org-src-container">
<pre class="src src-bash">mkdir -p &lt;&lt;make-dir&gt;&gt;

<span style="font-weight: bold;">apt-install</span>
<span style="font-weight: bold;">npm-install</span>
<span style="font-weight: bold;">start-systemd-services</span>

<span style="font-weight: bold;">&lt;&lt;ubuntu-setup&gt;&gt;</span>
</pre>
</div>
</div>

<div id="outline-container-org7e56261" class="outline-4">
<h4 id="org7e56261">Apt Package Manager</h4>
<div class="outline-text-4" id="text-org7e56261">
<ul class="org-ul">
<li><p>
apt-managed packages
</p>
<div class="org-src-container">
<pre class="src src-shell">sudo apt-get install -y <span style="font-style: italic;">\</span>
     &lt;&lt;apt-pkg&gt;&gt;
</pre>
</div></li>
<li><p>
update apt packages every weekend
</p>
<div class="org-src-container">
<pre class="src src-sh">pwsudo apt update &amp;&amp; pwsudo apt upgrade --yes
</pre>
</div></li>
</ul>
</div>
</div>
</div>

<div id="outline-container-org301e07d" class="outline-3">
<h3 id="org301e07d">Linux Mint (Cinnamon DE)</h3>
<div class="outline-text-3" id="text-org301e07d">
<ul class="org-ul">
<li><p>
Back-up Cinnamon Desktop Configuration
</p>
<div class="org-src-container">
<pre class="src src-shell">dconf dump /org/cinnamon/ &gt; &lt;&lt;home-dir()&gt;&gt;/.local/state/cinnamon/desktop.conf
</pre>
</div></li>

<li><p>
Commands/Applications that need to use LinuxMint comfortably
</p>
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"xclip"</span>
</pre>
</div></li>
</ul>
</div>
</div>

<div id="outline-container-org576d4ba" class="outline-3">
<h3 id="org576d4ba">GNU Guix</h3>
<div class="outline-text-3" id="text-org576d4ba">
<p>
Below is Elisp code defining Guix templates for TempEL.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(guix-search <span style="font-style: italic;">"guix search "</span> (p (my/region-string-trans-buffer)))
(activate-profiles <span style="font-style: italic;">"activate-profiles "</span>
                   (completing-read <span style="font-style: italic;">"profiles: "</span>
                                    (mapcar (<span style="font-weight: bold;">lambda</span> (elt)
                                              (string-join elt <span style="font-style: italic;">" "</span>))
                                            (my/combinations
                                             '(<span style="font-style: italic;">"base"</span> <span style="font-style: italic;">"desktop"</span> <span style="font-style: italic;">"emacs"</span>)))))
</pre>
</div>
</div>

<div id="outline-container-org42c3fc0" class="outline-4">
<h4 id="org42c3fc0">Channels</h4>
<div class="outline-text-4" id="text-org42c3fc0">
<p>
Guix channels of my choice, providing package definitions.
</p>

<div class="org-src-container">
<pre class="src src-scheme">(list (channel
       (name 'nonguix)
       (url <span style="font-style: italic;">"https://gitlab.com/nonguix/nonguix"</span>))
      (channel
       (name 'guix)
       (url <span style="font-style: italic;">"https://git.savannah.gnu.org/git/guix.git"</span>))
      (channel
       (name 'guix-jp)
       (url <span style="font-style: italic;">"https://gitlab.com/guix-jp/channel"</span>)
       (branch <span style="font-style: italic;">"main"</span>))
      (channel
       (name 'p-snow)
       (url <span style="font-style: italic;">"https://github.com/p-snow/guix-channel"</span>)
       (introduction
        (make-channel-introduction
         <span style="font-style: italic;">"3a10227fbc2d5e9744aced43f820a0d3bf64add5"</span>
         (openpgp-fingerprint
          <span style="font-style: italic;">"CF56 FC53 3AD6 6A67 6FDC  1D73 0D2B AF0E 8AEF 0306"</span>)))))
</pre>
</div>

<p>
A script for updating channels
</p>

<p>
This script makes it easy to update all channels to the latest commit based on an original channel file.
</p>

<pre class="example">
update-channels
</pre>


<div class="org-src-container">
<pre class="src src-shell" id="orgafd6523">guix pull --channels=$<span style="font-weight: bold; font-style: italic;">HOME</span>/.config/guix/base-channels.scm <span style="font-style: italic;">\</span>
  &amp;&amp; guix describe --format=channels &gt; ~/.config/guix/channels.scm
</pre>
</div>
</div>
</div>

<div id="outline-container-orgcdcc21f" class="outline-4">
<h4 id="orgcdcc21f">Profiles</h4>
<div class="outline-text-4" id="text-orgcdcc21f">
<p>
Below is an initialization code for Guix profiles in Bash.
</p>

<div class="org-src-container">
<pre class="src src-sh" id="org944d4e4"><span style="font-weight: bold;">echo</span> -n <span style="font-style: italic;">'~/.guix-extra-profiles'</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-sh" id="orgfab208f"><span style="font-weight: bold;">export</span> <span style="font-weight: bold; font-style: italic;">GUIX_EXTRA_PROFILES</span>=&lt;&lt;guix/ex-prof()&gt;&gt;

<span style="font-weight: bold;"># fill in a variable below like a comment line</span>
<span style="font-weight: bold;"># if you'd like to acticate specific profiles under GUIX_EXTRA_PROFILES</span>
<span style="font-weight: bold;">ACTIVE_PROFILE_NAMES=()</span>
<span style="font-weight: bold;"># ACTIVE_PROFILE_NAMES=(base emacs)</span>

<span style="font-weight: bold;">profiles=()</span>
<span style="font-weight: bold;">if [ ${#ACTIVE_PROFILE_NAMES[@]} -eq 0 ]; then</span>
<span style="font-weight: bold;">  profiles="${GUIX_EXTRA_PROFILES}/*"</span>
<span style="font-weight: bold;">else</span>
<span style="font-weight: bold;">  for name in ${ACTIVE_PROFILE_NAMES[@]}; do</span>
<span style="font-weight: bold;">    profiles+=("${GUIX_EXTRA_PROFILES}/${name}")</span>
<span style="font-weight: bold;">  done</span>
<span style="font-weight: bold;">fi</span>

<span style="font-weight: bold;">for profile in ${profiles[@]}; do</span>
<span style="font-weight: bold;">  GUIX_PROFILE="${profile}/$(basename ${profile})"</span>
<span style="font-weight: bold;">  if [ -f ${GUIX_PROFILE}/etc/profile ]; then</span>
<span style="font-weight: bold;">    . "${GUIX_PROFILE}"/etc/profile</span>
<span style="font-weight: bold;">  fi</span>
<span style="font-weight: bold;">  if [ -d ${GUIX_PROFILE}/share ]; then</span>
<span style="font-weight: bold;">    export XDG_DATA_DIRS=${GUIX_PROFILE}/share${XDG_DATA_DIRS:+:}$XDG_DATA_DIRS</span>
<span style="font-weight: bold;">  fi</span>
<span style="font-weight: bold;">  if [ -d ${GUIX_PROFILE}/share/man ]; then</span>
<span style="font-weight: bold;">    export MANPATH=${GUIX_PROFILE}/share/man${MANPATH:+:}$MANPATH</span>
<span style="font-weight: bold;">  fi</span>
<span style="font-weight: bold;">done</span>

<span style="font-weight: bold;"># export GUIX_PROFILE="$HOME/.guix-profile"</span>
<span style="font-weight: bold;"># . "$GUIX_PROFILE/etc/profile"</span>

<span style="font-weight: bold;">export GUIX_PROFILE="$HOME/.config/guix/current"</span>
<span style="font-weight: bold;">. "$GUIX_PROFILE/etc/profile"</span>


<span style="font-weight: bold;">if [ -v GUIX_ENVIRONMENT ]; then</span>
<span style="font-weight: bold;">  if [[ $PS1 =~ (.*)"\\$" ]]; then</span>
<span style="font-weight: bold;">    PS1="${BASH_REMATCH[1]} [env]\\\$ "</span>
<span style="font-weight: bold;">  fi</span>
<span style="font-weight: bold;">fi</span>
</pre>
</div>

<p>
activate-profiles is a script that accepts space-separated profile names, whose packages will be fetched:
</p>

<pre class="example">
activate-profiles base emacs
</pre>


<div class="org-src-container">
<pre class="src src-shell" id="org41e6a3e"><span style="font-weight: bold; font-style: italic;">GREEN</span>=<span style="font-style: italic;">'\033[1;32m'</span>
<span style="font-weight: bold; font-style: italic;">RED</span>=<span style="font-style: italic;">'\033[1;30m'</span>
<span style="font-weight: bold; font-style: italic;">NC</span>=<span style="font-style: italic;">'\033[0m'</span>
<span style="font-weight: bold; font-style: italic;">GUIX_EXTRA_PROFILES</span>=$<span style="font-weight: bold; font-style: italic;">HOME</span>/.guix-extra-profiles

<span style="font-weight: bold; font-style: italic;">profiles</span>=$<span style="font-weight: bold; font-style: italic;">*</span>
<span style="font-weight: bold;">if</span> [ $<span style="font-weight: bold; font-style: italic;">#</span> -eq 0 ]; <span style="font-weight: bold;">then</span>
  <span style="font-weight: bold; font-style: italic;">profiles</span>=<span style="font-style: italic;">"$HOME/.config/guix/manifests/*.scm"</span>;
<span style="font-weight: bold;">fi</span>

<span style="font-weight: bold;">for</span> profile<span style="font-weight: bold;"> in</span> $<span style="font-weight: bold; font-style: italic;">profiles</span>; <span style="font-weight: bold;">do</span>
  <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Remove the path and file extension, if any</span>
  <span style="font-weight: bold; font-style: italic;">profileName</span>=$(basename $<span style="font-weight: bold; font-style: italic;">profile</span>)
  <span style="font-weight: bold; font-style: italic;">profileName</span>=<span style="font-style: italic;">"${profileName%.*}"</span>
  <span style="font-weight: bold; font-style: italic;">profilePath</span>=<span style="font-style: italic;">"$GUIX_EXTRA_PROFILES/$profileName"</span>
  <span style="font-weight: bold; font-style: italic;">manifestPath</span>=$<span style="font-weight: bold; font-style: italic;">HOME</span>/.config/guix/manifests/$<span style="font-weight: bold; font-style: italic;">profileName</span>.scm

  <span style="font-weight: bold;">if</span> [ -f $<span style="font-weight: bold; font-style: italic;">manifestPath</span> ]; <span style="font-weight: bold;">then</span>
    <span style="font-weight: bold;">echo</span>
    <span style="font-weight: bold;">echo</span> -e <span style="font-style: italic;">"${GREEN}Activating profile:"</span> $<span style="font-weight: bold; font-style: italic;">manifestPath</span> <span style="font-style: italic;">"${NC}"</span>
    <span style="font-weight: bold;">echo</span>

    mkdir -p $<span style="font-weight: bold; font-style: italic;">profilePath</span>
    guix package --manifest=$<span style="font-weight: bold; font-style: italic;">manifestPath</span> --profile=<span style="font-style: italic;">"$profilePath/$profileName"</span>

    <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Source the new profile</span>
    <span style="font-weight: bold; font-style: italic;">GUIX_PROFILE</span>=<span style="font-style: italic;">"$profilePath/$profileName"</span>
    <span style="font-weight: bold;">if</span> [ -f $<span style="font-weight: bold; font-style: italic;">GUIX_PROFILE</span>/etc/profile ]; <span style="font-weight: bold;">then</span>
      . <span style="font-style: italic;">"$GUIX_PROFILE"</span>/etc/profile
    <span style="font-weight: bold;">else</span>
      <span style="font-weight: bold;">echo</span> -e <span style="font-style: italic;">"${RED}Couldn't find profile:"</span> $<span style="font-weight: bold; font-style: italic;">GUIX_PROFILE</span>/etc/profile <span style="font-style: italic;">"${NC}"</span>
    <span style="font-weight: bold;">fi</span>
  <span style="font-weight: bold;">else</span>
    <span style="font-weight: bold;">echo</span> <span style="font-style: italic;">"No profile found at path"</span> $<span style="font-weight: bold; font-style: italic;">profilePath</span>
  <span style="font-weight: bold;">fi</span>
<span style="font-weight: bold;">done</span>
</pre>
</div>

<ul class="org-ul">
<li><p>
Automating Script
Update packages in base profile at morning
</p>
<div class="org-src-container">
<pre class="src src-shell">pwsudo -i guix pull &amp;&amp; pwsudo systemctl restart guix-daemon.service
update-channels &amp;&amp; activate-profiles base emacs desktop &amp;&amp; guix gc -d 1m -F 80G
</pre>
</div></li>
</ul>
</div>

<ul class="org-ul">
<li><a id="org979f6c2"></a>guix base profile<br />
<div class="outline-text-5" id="text-org979f6c2">
<div class="org-src-container">
<pre class="src src-scheme">(specifications-&gt;manifest
 '(<span style="font-style: italic;">"coreutils"</span>
   <span style="font-style: italic;">"diffutils"</span>
   <span style="font-style: italic;">"parallel"</span>
   <span style="font-style: italic;">"gawk"</span>
   <span style="font-style: italic;">"sed"</span>
   <span style="font-style: italic;">"tar"</span>
   <span style="font-style: italic;">"zip"</span>
   <span style="font-style: italic;">"unzip"</span>
   <span style="font-style: italic;">"zstd"</span>
   <span style="font-style: italic;">"p7zip"</span>
   <span style="font-style: italic;">"shadow"</span>
   <span style="font-style: italic;">"sshfs"</span>
   <span style="font-style: italic;">"grep"</span>
   <span style="font-style: italic;">"ripgrep"</span>
   <span style="font-style: italic;">"man-db"</span>
   <span style="font-style: italic;">"less"</span>
   <span style="font-style: italic;">"pwgen"</span>
   <span style="font-style: italic;">"file"</span>
   <span style="font-style: italic;">"nkf"</span>
   <span style="font-style: italic;">"lsof"</span>
   <span style="font-style: italic;">"tree"</span>
   <span style="font-style: italic;">"poppler"</span>
   <span style="font-style: italic;">"stow"</span>
   <span style="font-style: italic;">"pandoc"</span>
   <span style="font-style: italic;">"nss-certs"</span>
   <span style="font-style: italic;">"openssl"</span>
   <span style="font-style: italic;">"glibc"</span>
   <span style="font-style: italic;">"procps"</span>
   <span style="font-style: italic;">"time"</span>
   <span style="font-style: italic;">"htop"</span>
   <span style="font-style: italic;">"net-tools"</span>
   <span style="font-style: italic;">"curl"</span>
   <span style="font-style: italic;">"wget"</span>
   <span style="font-style: italic;">"httrack"</span>
   <span style="font-style: italic;">"ghc-tldr"</span>
   <span style="font-style: italic;">"network-manager"</span>
   <span style="font-style: italic;">"wakelan"</span>
   <span style="font-style: italic;">"speedtest-cli"</span>
   <span style="font-style: italic;">"parted"</span>
   <span style="font-style: italic;">"fdisk"</span>
   <span style="font-style: italic;">"gptfdisk"</span>
   <span style="font-style: italic;">"cryptsetup"</span>
   <span style="font-style: italic;">"smartmontools"</span>
   <span style="font-style: italic;">"ddrescue"</span>
   <span style="font-style: italic;">"sqlite"</span>
   <span style="font-style: italic;">"libarchive"</span>
   <span style="font-style: italic;">"graphicsmagick"</span>
   <span style="font-style: italic;">"pngquant"</span>
   <span style="font-style: italic;">"ffmpeg@6.1.1"</span> <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">mpv requires version 6 of FFMPEG</span>
   <span style="font-style: italic;">"dav1d"</span>
   <span style="font-style: italic;">"jq"</span>
   <span style="font-style: italic;">"pup"</span>
   <span style="font-style: italic;">"htmlq"</span>
   <span style="font-style: italic;">"python-feedparser"</span>
   <span style="font-style: italic;">"util-linux"</span>
   <span style="font-style: italic;">"binutils"</span>
   <span style="font-style: italic;">"make"</span>
   <span style="font-style: italic;">"llvm"</span>
   <span style="font-style: italic;">"cmake"</span>
   <span style="font-style: italic;">"libtool"</span>
   <span style="font-style: italic;">"pkgconf"</span>
   <span style="font-style: italic;">"texinfo"</span>
   <span style="font-style: italic;">"shellcheck"</span>
   <span style="font-style: italic;">"global"</span>
   <span style="font-style: italic;">"perl"</span>
   <span style="font-style: italic;">"pfetch"</span>
   <span style="font-style: italic;">"neofetch"</span>
   <span style="font-style: italic;">"python-selenium"</span>
   <span style="font-style: italic;">"gcc-toolchain@13.3.0"</span>
   <span style="font-weight: bold; text-decoration: underline;">&lt;&lt;guix-base&gt;&gt;</span>))
</pre>
</div>
</div>
</li>

<li><a id="org131fd97"></a>guix desktop profile<br />
<div class="outline-text-5" id="text-org131fd97">
<div class="org-src-container">
<pre class="src src-scheme">(specifications-&gt;manifest
 '(<span style="font-style: italic;">"gparted"</span>
   <span style="font-style: italic;">"gcompris-qt"</span>
   <span style="font-style: italic;">"gnome-disk-utility"</span>
   <span style="font-style: italic;">"kdeconnect"</span>
   <span style="font-style: italic;">"dia"</span>
   <span style="font-style: italic;">"shotwell"</span>
   <span style="font-style: italic;">"vlc"</span>
   <span style="font-weight: bold; text-decoration: underline;">&lt;&lt;guix-desktop&gt;&gt;</span>))
</pre>
</div>
</div>
</li>

<li><a id="org42d13a2"></a>guix creative profile&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span><br /></li>

<li><a id="org8b70963"></a>guix emacs profile<br />
<div class="outline-text-5" id="text-org8b70963">
<div class="org-src-container">
<pre class="src src-scheme">(specifications-&gt;manifest
 '(<span style="font-weight: bold; text-decoration: underline;">&lt;&lt;guix-emacs&gt;&gt;</span>
   <span style="font-style: italic;">"sicp"</span>
   <span style="font-style: italic;">"isync"</span>
   <span style="font-style: italic;">"stunnel"</span>
   <span style="font-style: italic;">"wordnet"</span>
   <span style="font-style: italic;">"emacs-transient"</span>
   <span style="font-style: italic;">"emacs-compat"</span>))
</pre>
</div>
</div>
</li>
</ul>
</div>

<div id="outline-container-orgd695129" class="outline-4">
<h4 id="orgd695129">Home Configuration</h4>
<div class="outline-text-4" id="text-orgd695129">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">This "home-environment" file can be passed to 'guix home reconfigure'</span>
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">to reproduce the content of your profile.  This is "symbolic": it only</span>
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">specifies package names.  To reproduce the exact same profile, you also</span>
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">need to capture the channels being used, as returned by "guix describe".</span>
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">See the "Replicating Guix" section in the manual.</span>

(use-modules (gnu home)
             (gnu home services)
             (gnu home services shells)
             (gnu home services ssh)
             (gnu home services dotfiles)
             (gnu packages)
             (gnu packages base)
             (gnu packages fonts)
             (gnu packages fontutils)
             (gnu packages gnupg)
             (gnu services)
             (guix gexp))

(home-environment
 <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Below is the list of packages that will show up in your</span>
 <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Home profile, under ~/.guix-home/profile.</span>
 (packages (list glibc-locales fontconfig which
                 font-iosevka font-ipa font-ipa-ex font-google-noto font-inconsolata
                 font-adobe-source-han-sans))

 <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Below is the list of Home services.  To search for available</span>
 <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">services, run 'guix home search KEYWORD' in a terminal.</span>
 (services
  (list
   (simple-service 'basic-env-vars-service
                   home-environment-variables-service-type
                   `((<span style="font-style: italic;">"EMAIL"</span> . <span style="font-style: italic;">"&lt;&lt;email&gt;&gt;"</span>)
                     (<span style="font-style: italic;">"VIEWER"</span> . <span style="font-style: italic;">"less"</span>)
                     (<span style="font-style: italic;">"EDITOR"</span> . <span style="font-style: italic;">"emacsclient -c -a emacs"</span>)))
   (service home-bash-service-type
            (home-bash-configuration
             (guix-defaults? #t)
             (aliases '(&lt;&lt;print-aliases(lang=<span style="font-style: italic;">"scheme"</span>)&gt;&gt;))
             (bashrc (list (local-file <span style="font-style: italic;">"./.bashrc"</span> <span style="font-style: italic;">"bashrc"</span>)))))
   (service home-openssh-service-type
            (home-openssh-configuration
             (hosts
              (list (openssh-host (name <span style="font-style: italic;">"pc02"</span>)
                                  (host-name <span style="font-style: italic;">"192.168.100.127"</span>))))))
   (service home-dotfiles-service-type
            (home-dotfiles-configuration
             (layout 'plain)
             (source-directory
              (<span style="font-weight: bold;">let</span> ((path <span style="font-style: italic;">"&lt;&lt;ghq-proj-path(name="</span>p-snow/environment<span style="font-style: italic;">")&gt;&gt;"</span>))
                (<span style="font-weight: bold;">if</span> (string-prefix? <span style="font-style: italic;">"~"</span> path)
                    (string-append (getenv <span style="font-style: italic;">"HOME"</span>) (substring path 1))
                    path)))
             (directories '(<span style="font-style: italic;">"home"</span>)))))))
</pre>
</div>

<p>
A script for activating home configuration
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(activate-home <span style="font-style: italic;">"cd ~/environment &amp;&amp; make"</span>)
</pre>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-orgc9c081d" class="outline-2">
<h2 id="orgc9c081d">Home Environment</h2>
<div class="outline-text-2" id="text-orgc9c081d">
</div>
<div id="outline-container-orga27340c" class="outline-3">
<h3 id="orga27340c">Fontconfig&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span></h3>
</div>

<div id="outline-container-org289be17" class="outline-3">
<h3 id="org289be17">Bash</h3>
<div class="outline-text-3" id="text-org289be17">
</div>
<div id="outline-container-orgdccd451" class="outline-4">
<h4 id="orgdccd451">bashrc</h4>
<div class="outline-text-4" id="text-orgdccd451">
<div class="org-src-container">
<pre class="src src-bash"><span style="font-weight: bold;">export</span> <span style="font-weight: bold; font-style: italic;">PATH</span>=<span style="font-style: italic;">"${HOME}/bin:${HOME}/.local/bin:${HOME}/.cargo/bin:$PATH"</span>
<span style="font-weight: bold;">export</span> <span style="font-weight: bold; font-style: italic;">PS1</span>=<span style="font-style: italic;">"[\u@$(uname -n):\\W]\n\$ "</span>

&lt;&lt;bashrc&gt;&gt;
</pre>
</div>
</div>
</div>

<div id="outline-container-org94b645d" class="outline-4">
<h4 id="org94b645d">bash functions&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span></h4>
</div>

<div id="outline-container-org83c9038" class="outline-4">
<h4 id="org83c9038">Shell Command Aliases</h4>
<div class="outline-text-4" id="text-org83c9038">
<table id="org16c016b" border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">..</td>
<td class="org-left">cd ../</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">e</td>
<td class="org-left">exit</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">l</td>
<td class="org-left">ls -F</td>
<td class="org-left">$*</td>
</tr>

<tr>
<td class="org-left">ll</td>
<td class="org-left">ls -lh</td>
<td class="org-left">$*</td>
</tr>

<tr>
<td class="org-left">lld</td>
<td class="org-left">l -ld</td>
<td class="org-left">$*</td>
</tr>

<tr>
<td class="org-left">la</td>
<td class="org-left">l -a</td>
<td class="org-left">$*</td>
</tr>

<tr>
<td class="org-left">lal</td>
<td class="org-left">l -alh</td>
<td class="org-left">$*</td>
</tr>

<tr>
<td class="org-left">cp</td>
<td class="org-left">cp -i</td>
<td class="org-left">$*</td>
</tr>

<tr>
<td class="org-left">mv</td>
<td class="org-left">mv -i</td>
<td class="org-left">$*</td>
</tr>

<tr>
<td class="org-left">rm</td>
<td class="org-left">rm -i</td>
<td class="org-left">$*</td>
</tr>

<tr>
<td class="org-left">rmf</td>
<td class="org-left">rm -rf</td>
<td class="org-left">$*</td>
</tr>

<tr>
<td class="org-left">mkdir</td>
<td class="org-left">mkdir -pv</td>
<td class="org-left">$*</td>
</tr>

<tr>
<td class="org-left">rmdir</td>
<td class="org-left">rmdir -v</td>
<td class="org-left">$*</td>
</tr>

<tr>
<td class="org-left">ipad</td>
<td class="org-left">hostname -I &vert; cut -f1 -d' '</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">kem</td>
<td class="org-left">pkill -kill emacs</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
</table>

<div class="org-src-container">
<pre class="src src-emacs-lisp" id="orgde4b583">(seq-do-indexed (<span style="font-weight: bold;">lambda</span> (alias index)
                  (<span style="font-weight: bold;">let</span> ((ali (car alias))
                        (def (replace-regexp-in-string <span style="font-style: italic;">"\\\\vert"</span> <span style="font-style: italic;">"|"</span> (cadr alias)))
                        (param (caddr alias)))
                    (<span style="font-weight: bold;">pcase</span> lang
                      ('<span style="font-style: italic;">"plain"</span>
                       (princ (funcall 'string-join `(,ali ,def ,param) <span style="font-style: italic;">" "</span>))
                       (<span style="font-weight: bold;">when</span> (&lt; index (1- (length aliases))) (princ <span style="font-style: italic;">"\n"</span>)))
                      ('<span style="font-style: italic;">"scheme"</span>
                       (prin1 (funcall 'cons ali def))
                       (princ <span style="font-style: italic;">"\n"</span>)))))
                aliases)
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgc308389" class="outline-3">
<h3 id="orgc308389">Systemd</h3>
<div class="outline-text-3" id="text-orgc308389">
<div class="org-src-container">
<pre class="src src-shell">&lt;&lt;systemd-service&gt;&gt;
</pre>
</div>
</div>

<div id="outline-container-org617b2c9" class="outline-4">
<h4 id="org617b2c9">systemd-tmpfiles</h4>
<div class="outline-text-4" id="text-org617b2c9">
<p>
<a href="https://www.freedesktop.org/software/systemd/man/systemd-tmpfiles-setup.service.html">systemd-tmpfiles</a> manages file creation and deletion. I mainly use systemd-tmpfiles to delete obsolete files in specific directories by running the following command.
</p>

<pre class="example">
$ systemd-tmpfiles --user --clean
</pre>


<p>
or set up timer shown below.
</p>

<div class="org-src-container">
<pre class="src src-conf">systemctl --user enable systemd-tmpfiles-clean.timer
</pre>
</div>

<div class="org-src-container">
<pre class="src src-conf">d /home/&lt;&lt;login-name()&gt;&gt;/tmp - - - 5d
d /home/&lt;&lt;login-name()&gt;&gt;/Downloads - - - 4w
&lt;&lt;tmpfiles-cleanup&gt;&gt;
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org8e72f9b" class="outline-3">
<h3 id="org8e72f9b">Vixie Cron</h3>
<div class="outline-text-3" id="text-org8e72f9b">
<p>
A script to reinitialize a set of cron jobs
</p>
<div class="org-src-container">
<pre class="src src-bash">crontab &lt;&lt;home-dir()&gt;&gt;/.config/crontab/&lt;&lt;login-name()&gt;&gt;
</pre>
</div>

<div class="org-src-container">
<pre class="src src-conf">cron-reinit.sh
</pre>
</div>

<div class="org-src-container">
<pre class="src src-conf"><span style="font-weight: bold; font-style: italic;">MAILTO</span>=<span style="font-style: italic;">"&lt;&lt;email&gt;&gt;"</span>

<span style="font-weight: bold; font-style: italic;">BIN_DIR</span>=<span style="font-style: italic;">"&lt;&lt;home-dir()&gt;&gt;/bin"</span>
<span style="font-weight: bold; font-style: italic;">LOG_DIR</span>=<span style="font-style: italic;">"&lt;&lt;log-dir()&gt;&gt;"</span>

&lt;&lt;cronjob-user&gt;&gt;
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb1901d1" class="outline-3">
<h3 id="orgb1901d1">Btrfs</h3>
<div class="outline-text-3" id="text-orgb1901d1">
<p>
Btrfs is a CoW (Copy on Write) file system supports snapshot and send/recv mechanism.
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"btrfs-progs"</span>
</pre>
</div>
</div>

<div id="outline-container-org599a2a5" class="outline-4">
<h4 id="org599a2a5">btrbk</h4>
<div class="outline-text-4" id="text-org599a2a5">
<p>
<a href="https://digint.ch/btrbk/doc/btrbk.1.html">Btrbk</a> supports for taking snapshots and backups
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"btrbk"</span>
</pre>
</div>
</div>

<ul class="org-ul">
<li><a id="org89708de"></a>btrbk.conf<br />
<div class="outline-text-5" id="text-org89708de">
<p>
<a href="https://digint.ch/btrbk/doc/btrbk.conf.5.html">btrbk.conf documentation</a>
</p>

<div class="org-src-container">
<pre class="src src-conf">timestamp_format long
incremental yes

snapshot_preserve_min 6h
snapshot_preserve 36h 3d 3w

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Create snapshots only if the backup disk is attached</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">snapshot_create ondemand</span>

target_preserve_min latest

snapshot_dir snapshots
volume /mnt/homes
target /mnt/exbak/&lt;&lt;laptop-node()&gt;&gt;

target_preserve 2w 3m
subvolume home-mint

target_preserve 8w 6m 2y
subvolume data
</pre>
</div>
</div>
</li>

<li><a id="org9750912"></a>snapshot/backup cron job<br />
<div class="outline-text-5" id="text-org9750912">
<div class="org-src-container">
<pre class="src src-conf">*/15 * * * * /usr/bin/bash -ci <span style="font-style: italic;">"which btrbk | xargs -I _ pwsudo _ --config ~/.config/btrbk/btrbk.conf run"</span>
</pre>
</div>
</div>
</li>
</ul>
</div>

<div id="outline-container-org0c0e125" class="outline-4">
<h4 id="org0c0e125">snapshots management&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span></h4>
</div>

<div id="outline-container-org31f6062" class="outline-4">
<h4 id="org31f6062">backup to another device&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span></h4>
</div>
</div>
<div id="outline-container-org9c2cc9a" class="outline-3">
<h3 id="org9c2cc9a">XDG</h3>
<div class="outline-text-3" id="text-org9c2cc9a">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"xdg-utils"</span>
</pre>
</div>
</div>

<div id="outline-container-orgf675861" class="outline-4">
<h4 id="orgf675861">xdg-mime</h4>
<div class="outline-text-4" id="text-orgf675861">
<ul class="org-ul">
<li><p>
ask default application for text/plain
</p>
<pre class="example">
$ xdg-mime query default text/plain
</pre></li>
</ul>

<div class="org-src-container">
<pre class="src src-conf">[<span style="font-weight: bold; text-decoration: underline;">Added Associations</span>]
<span style="font-weight: bold; font-style: italic;">inode/directory</span>=io.github.celluloid_player.Celluloid.desktop;nemo.desktop;

[<span style="font-weight: bold; text-decoration: underline;">Default Applications</span>]
<span style="font-weight: bold; font-style: italic;">inode/directory</span>=nemo.desktop
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org883bd0e" class="outline-3">
<h3 id="org883bd0e">GnuPG (gpg)</h3>
<div class="outline-text-3" id="text-org883bd0e">
<p>
<a href="https://wiki.archlinux.org/title/GnuPG">
GnuPG - ArchWiki</a>
</p>

<p>
I've chosen to use gpg/gpg-agent and pass on Ubuntu system since pass (password-store) spouts a warning saying there's gpg version mismatch persistently.
</p>
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">"gnupg"</span>
</pre>
</div>

<ul class="org-ul">
<li><p>
gpg config
</p>
<div class="org-src-container">
<pre class="src src-conf">with-keygrip
</pre>
</div></li>
<li><p>
gpg-agent config
</p>
<div class="org-src-container">
<pre class="src src-conf">pinentry-program /usr/bin/pinentry-curses
allow-emacs-pinentry
allow-loopback-pinentry
enable-ssh-support
<span style="font-weight: bold; font-style: italic;">max-cache-ttl &lt;&lt;hours-in-sec(h</span>=700)&gt;&gt;
<span style="font-weight: bold; font-style: italic;">default-cache-ttl &lt;&lt;hours-in-sec(h</span>=700)&gt;&gt;
<span style="font-weight: bold; font-style: italic;">default-cache-ttl-ssh &lt;&lt;hours-in-sec(h</span>=48)&gt;&gt;
</pre>
</div></li>
<li><p>
mandatory config to use pinentry-curses for gpg-agent
</p>

<div class="org-src-container">
<pre class="src src-shell"><span style="font-weight: bold;">export</span> <span style="font-weight: bold; font-style: italic;">GPG_TTY</span>=$(tty)

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Refresh gpg-agent tty in case user switches into an X session</span>
gpg-connect-agent updatestartuptty /bye &gt;/dev/null
</pre>
</div></li>
</ul>
</div>
</div>

<div id="outline-container-orgbeecda8" class="outline-3">
<h3 id="orgbeecda8">Key Remappers</h3>
<div class="outline-text-3" id="text-orgbeecda8">
</div>

<div id="outline-container-org1f0e21f" class="outline-4">
<h4 id="org1f0e21f">Xremap&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span></h4>
</div>

<div id="outline-container-org377553c" class="outline-4">
<h4 id="org377553c">XKB&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span></h4>
</div>

<div id="outline-container-org114fa45" class="outline-4">
<h4 id="org114fa45">Interception Tools&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span></h4>
</div>

<div id="outline-container-org8554bc5" class="outline-4">
<h4 id="org8554bc5">keyd</h4>
<div class="outline-text-4" id="text-org8554bc5">
<p>
<a href="https://github.com/rvaiya/keyd">keyd</a> is a key remapping daemon for Linux. It is fast with concise configuration introducing layer mechanism.
</p>

<div class="org-src-container">
<pre class="src src-conf">sudo systemctl enable keyd
sudo systemctl start keyd
</pre>
</div>

<div class="org-src-container">
<pre class="src src-conf">[<span style="font-weight: bold; text-decoration: underline;">ids</span>]

*

[<span style="font-weight: bold; text-decoration: underline;">main</span>]

<span style="font-weight: bold; font-style: italic;">capslock</span> = oneshot(control)
<span style="font-weight: bold; font-style: italic;">leftcontrol</span> = oneshot(capslock)
<span style="font-weight: bold; font-style: italic;">tab</span> = overload(numpad_layer, tab)
<span style="font-weight: bold; font-style: italic;">rightcontrol</span> = oneshot(app_layer)
<span style="font-weight: bold; font-style: italic;">space</span> = overload(shift, space)
<span style="font-style: italic;">' = overload(apostrophe_layer, '</span>)

<span style="font-weight: bold; font-style: italic;">leftshift</span> = overload(shift, =)
<span style="font-weight: bold; font-style: italic;">rightshift</span> = overload(shift, -)

[<span style="font-weight: bold; text-decoration: underline;">apostrophe_layer:M</span>]

<span style="font-weight: bold; font-style: italic;">u</span> = C-u

[<span style="font-weight: bold; text-decoration: underline;">numpad_layer:C-M</span>]

<span style="font-weight: bold; font-style: italic;">m</span> = 1
<span style="font-weight: bold; font-style: italic;">,</span> = 2
<span style="font-weight: bold; font-style: italic;">.</span> = 3
<span style="font-weight: bold; font-style: italic;">j</span> = 4
<span style="font-weight: bold; font-style: italic;">k</span> = 5
<span style="font-weight: bold; font-style: italic;">l</span> = 6
<span style="font-weight: bold; font-style: italic;">u</span> = 7
<span style="font-weight: bold; font-style: italic;">i</span> = 8
<span style="font-weight: bold; font-style: italic;">o</span> = 9
<span style="font-weight: bold; font-style: italic;">space</span> = 0

[<span style="font-weight: bold; text-decoration: underline;">app_layer:C-A-M</span>]
</pre>
</div>
</div>
</div>
</div>
</div>


<div id="outline-container-orgb75928e" class="outline-2">
<h2 id="orgb75928e">Application Configurations</h2>
<div class="outline-text-2" id="text-orgb75928e">
<div class="org-src-container">
<pre class="src src-emacs-lisp" id="org7e9a37d">(expand-file-name <span style="font-style: italic;">"~/.local/bin"</span>)
</pre>
</div>
</div>

<div id="outline-container-gnu-emacs" class="outline-3">
<h3 id="gnu-emacs">GNU Emacs</h3>
<div class="outline-text-3" id="text-gnu-emacs">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs"</span>
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">"emacs-next"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp" id="org8a345d4">no-littering-var-directory
</pre>
</div>
</div>

<div id="outline-container-org8c7abe5" class="outline-4">
<h4 id="org8c7abe5">Basic Configuration</h4>
<div class="outline-text-4" id="text-org8c7abe5">
</div>

<ul class="org-ul">
<li><a id="org5f4398f"></a>early-init.el<br />
<div class="outline-text-5" id="text-org5f4398f">
<p>
Early init file defines fundamental variables used from both normal Emacs session and batch mode.
</p>
</div>

<ul class="org-ul">
<li><a id="orgbb72b22"></a>Paths for tangling<br />
<div class="outline-text-6" id="text-orgbb72b22">
<p>
Variables that start with "tangle/" and are used during the tangling process are also required for the main Emacs session.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">&lt;&lt;tangle-def()&gt;&gt;
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp" id="org4f8bbc2">(<span style="font-weight: bold;">let</span> ((syms (string)))
  (obarray-map (<span style="font-weight: bold;">lambda</span> (sym)
                 (<span style="font-weight: bold;">when</span> (string-prefix-p <span style="font-style: italic;">"tangle/"</span> (symbol-name sym))
                   (<span style="font-weight: bold;">setq</span> syms
                         (concat syms
                                 (format <span style="font-style: italic;">"(setq %s \"%s\")\n"</span>
                                         sym (symbol-value sym))))))
               obarray)
  syms)
</pre>
</div>
</div>
</li>

<li><a id="org30eeff3"></a>package.el<br />
<div class="outline-text-6" id="text-org30eeff3">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">package</span>)

(<span style="font-weight: bold;">setopt</span> package-archives
        '((<span style="font-style: italic;">"gnu"</span> . <span style="font-style: italic;">"https://elpa.gnu.org/packages/"</span>)
          (<span style="font-style: italic;">"nongnu"</span> . <span style="font-style: italic;">"https://elpa.nongnu.org/nongnu/"</span>)
          (<span style="font-style: italic;">"melpa"</span> . <span style="font-style: italic;">"https://melpa.org/packages/"</span>)
          (<span style="font-style: italic;">"p-snow"</span> . <span style="font-style: italic;">"https://p-snow.org/packages/"</span>)))
(<span style="font-weight: bold;">setopt</span> package-archive-priorities
        '((<span style="font-style: italic;">"gnu"</span> . 3)
          (<span style="font-style: italic;">"melpa"</span> . 2)
          (<span style="font-style: italic;">"nongnu"</span> . 1)))
(<span style="font-weight: bold;">setopt</span> package-enable-at-startup t)

(<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">package-vc</span>)

(package-initialize)
</pre>
</div>
</div>
</li>

<li><a id="org9fc7b8f"></a>load cl-lib<br />
<div class="outline-text-6" id="text-org9fc7b8f">
<p>
Use 'cl-lib' rather than 'cl' package since it is <a href="https://www.gnu.org/savannah-checkouts/gnu/emacs/news/NEWS.27.1">officially deprecated</a>.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">cl-lib</span>)
</pre>
</div>
</div>
</li>

<li><a id="orgb75ea8c"></a>use-package<br />
<div class="outline-text-6" id="text-orgb75ea8c">
<p>
<a href="https://jwiegley.github.io/use-package/">Official manual</a> is handy especially when you look up <a href="https://jwiegley.github.io/use-package/keywords/">Keywords</a>.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">use-package</span>)
(<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">use-package-ensure</span>)

(<span style="font-weight: bold;">setopt</span> use-package-compute-statistics t
        use-package-verbose nil)
(<span style="font-weight: bold;">with-eval-after-load</span> 'my-launch-app
  (keymap-set my/invoke-list-command-map (kbd <span style="font-style: italic;">"u"</span>)
              #'use-package-report))
</pre>
</div>

<p>
use-package depends on following packages internally
</p>
</div>

<ul class="org-ul">
<li><a id="orgd6b1c0f"></a>diminish<br />
<div class="outline-text-7" id="text-orgd6b1c0f">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-diminish"</span>
</pre>
</div>
</div>
</li>

<li><a id="org8e45d74"></a>delight<br />
<div class="outline-text-7" id="text-org8e45d74">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-delight"</span>
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="org556dfec"></a>straight.el&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span><br /></li>

<li><a id="orgd64cbef"></a>safe local eval forms<br />
<div class="outline-text-6" id="text-orgd64cbef">
<p>
Following hook statements are likely written in .dir-locals.el at the top level of git repositories.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(add-to-list 'safe-local-eval-forms
             '(add-hook 'find-file-hook
                        (<span style="font-weight: bold;">lambda</span> () (<span style="font-weight: bold;">setq-local</span> buffer-save-without-query t))))

(add-to-list 'safe-local-eval-forms
             '(remove-hook 'find-file-hook
                           (<span style="font-weight: bold;">lambda</span> () (<span style="font-weight: bold;">setq-local</span> buffer-save-without-query t))))
</pre>
</div>
</div>
</li>

<li><a id="org51d1375"></a>no-littering<br />
<div class="outline-text-6" id="text-org51d1375">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-no-littering"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp" id="orga9c8114">(<span style="font-weight: bold;">setq</span> no-littering-var-directory
      (file-name-concat <span style="font-style: italic;">"&lt;&lt;share-dir()&gt;&gt;"</span> <span style="font-style: italic;">"emacs/var/"</span>))

(<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">no-littering</span>)
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="org1ba6b79"></a>loading sequence<br />
<ul class="org-ul">
<li><a id="org8abfced"></a>custom file<br />
<div class="outline-text-6" id="text-org8abfced">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">setopt</span> custom-file
        (expand-file-name <span style="font-style: italic;">"custom.el"</span> user-emacs-directory))

(<span style="font-weight: bold;">when</span> (file-readable-p custom-file)
  (load custom-file))
</pre>
</div>
</div>
</li>

<li><a id="org9a3db5f"></a>init.el<br />
<div class="outline-text-6" id="text-org9a3db5f">
<p>
init.el devote itself to call for remaining config files.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">push</span> (file-name-concat user-emacs-directory <span style="font-style: italic;">"lisp"</span>) load-path)
(<span style="font-weight: bold;">push</span> (file-name-concat user-emacs-directory <span style="font-style: italic;">"site-lisp"</span>) load-path)

(<span style="font-weight: bold;">let</span> ((load-match <span style="font-style: italic;">"\\.el$"</span>))
  (mapc #'load-file
        (append (directory-files (file-name-concat user-emacs-directory <span style="font-style: italic;">"lisp"</span>) t load-match)
                (directory-files (file-name-concat user-emacs-directory <span style="font-style: italic;">"lisp/dedicated"</span>) t load-match))))
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="org37e6ad9"></a>Themes<br />
<div class="outline-text-5" id="text-org37e6ad9">
<p>
The theme of my choice at present
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">with-eval-after-load</span> 'ef-themes
  (load-theme 'ef-bio <span style="font-weight: bold;">:no-confirm</span>))
</pre>
</div>
</div>

<ul class="org-ul">
<li><a id="org958a92b"></a>modus-themes<br />
<div class="outline-text-6" id="text-org958a92b">
<p>
I love modus-theme which <a href="https://protesilaos.com/codelog/2019-08-07-emacs-modus-themes/">conforms to WCAG AAA</a>. <a href="https://protesilaos.com/codelog/2022-04-21-modus-themes-colour-theory/">This blog post</a> explains how this package determines colors theoretically and perceptually.
</p>

<p>
Following configuration is for version 4 of modus-themes which takes breaking change from previous major version.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> modus-themes
  <span style="font-weight: bold;">:disabled</span> t
  <span style="font-weight: bold;">:custom</span>
  (modus-themes-to-toggle '(modus-vivendi
                            modus-vivendi-tinted
                            modus-vivendi-deuteranopia))
  (modus-themes-org-blocks 'tinted-background)
  (modus-themes-bold-constructs t)
  <span style="font-weight: bold;">:config</span>
  (customize-set-variable 'modus-themes-common-palette-overrides
                          modus-themes-preset-overrides-faint)
  (<span style="font-weight: bold;">bind-keys</span> (<span style="font-style: italic;">"&lt;f6&gt;"</span> . modus-themes-toggle)))
</pre>
</div>
</div>
</li>

<li><a id="org31ab7d4"></a>ef-themes<br />
<div class="outline-text-6" id="text-org31ab7d4">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-ef-themes"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> ef-themes
  <span style="font-weight: bold;">:init</span>
  (<span style="font-weight: bold;">setq</span> ef-bio-palette-overrides
        '((cursor <span style="font-style: italic;">"#ffffff"</span>)))
  <span style="font-weight: bold;">:custom</span>
  (ef-themes-to-toggle ef-themes-dark-themes)
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">bind-keys</span> (<span style="font-style: italic;">"&lt;f9&gt;"</span> . ef-themes-toggle)))
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="orgc95bc12"></a>Basic Preferences<br />
<div class="outline-text-5" id="text-orgc95bc12">
<p>
Settings in this section are influenced a great deal by my personal preference. Please be meticulous when you borrow.
</p>
</div>

<ul class="org-ul">
<li><a id="orgd374e04"></a>Modifier Keys<br />
<div class="outline-text-6" id="text-orgd374e04">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">cond</span>
 ((string= window-system <span style="font-style: italic;">"x"</span>)
  (<span style="font-weight: bold;">setf</span> x-meta-keysym 'meta
        x-alt-keysym 'meta
        x-super-keysym 'hyper))
 ((string= window-system <span style="font-style: italic;">"ns"</span>)
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">IME inline patch</span>
  (<span style="font-weight: bold;">setf</span> mac-use-input-method-on-system nil)
  (<span style="font-weight: bold;">setf</span> mac-control-modifier       'control
        mac-command-modifier       'meta
        mac-option-modifier        'super
        mac-right-option-modifier  'alt
        mac-right-control-modifier 'super
        mac-function-modifier      'hyper)))
</pre>
</div>
</div>
</li>

<li><a id="org619dd54"></a>Basic Key Bindings<br />
<div class="outline-text-6" id="text-org619dd54">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(keymap-global-set <span style="font-style: italic;">"M-F"</span> #'forward-to-word)
(keymap-global-set <span style="font-style: italic;">"M-B"</span> #'backward-to-word)
(keymap-global-set <span style="font-style: italic;">"C-c d"</span> #'duplicate-dwim)
(keymap-global-set <span style="font-style: italic;">"C-c j"</span> #'join-line)
(keymap-global-set <span style="font-style: italic;">"C-c M-d"</span> #'copy-from-above-command)
(keymap-global-set <span style="font-style: italic;">"M-z"</span> #'zap-up-to-char)
(keymap-global-set <span style="font-style: italic;">"C-z"</span> #'repeat)
(keymap-global-set <span style="font-style: italic;">"C-x M-t"</span> #'transpose-sentences)
(keymap-global-set <span style="font-style: italic;">"M-T"</span> #'transpose-paragraphs)

(keymap-global-set <span style="font-style: italic;">"C-c k"</span> #'kill-this-buffer)
(keymap-global-set <span style="font-style: italic;">"C-x M-r"</span> #'rename-visited-file)
(keymap-global-set <span style="font-style: italic;">"C-M-&lt;delete&gt;"</span> #'restart-emacs)
(keymap-global-set <span style="font-style: italic;">"C-M-S-&lt;delete&gt;"</span> #'save-buffers-kill-emacs)

(substitute-key-definition 'upcase-region
                           'upcase-dwim
                           global-map)
(substitute-key-definition 'downcase-region
                           'downcase-dwim
                           global-map)
(keymap-global-set <span style="font-style: italic;">"C-x C-c"</span> #'capitalize-dwim)
</pre>
</div>

<ul class="org-ul">
<li><p>
Bind for C-x C-b, use <a href="ibuffer">ibuffer</a> which has more features than <a href="list-buffers">list-buffers</a> based on <a href="https://irreal.org/blog/?p=10329">this advice</a>.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(substitute-key-definition 'list-buffers
                           'ibuffer
                           global-map)
</pre>
</div></li>

<li><p>
bind find-functions and finder commands
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(find-function-setup-keys)

(keymap-set ctl-x-map <span style="font-style: italic;">"C"</span> 'finder-commentary)
</pre>
</div></li>
</ul>
</div>
</li>

<li><a id="orgb3de91d"></a>Unleash Disabled Commands<br />
<div class="outline-text-6" id="text-orgb3de91d">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(put 'upcase-region 'disabled nil)
(put 'downcase-region 'disabled nil)
(put 'narrow-to-region 'disabled nil)
(put 'set-goal-column 'disabled nil)
(put 'buffer-save-without-query 'disabled nil)
(put 'scroll-left 'disabled nil)
(put 'scroll-right 'disabled nil)
</pre>
</div>
</div>
</li>

<li><a id="emacs-language"></a>Language<br />
<div class="outline-text-6" id="text-emacs-language">
<p>
<a href="https://www.gnu.org/software/emacs/manual/html_mono/emacs.html#Language-Environments">emacs#Language Environments</a>
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">language and locale</span>
(set-language-environment <span style="font-style: italic;">"Japanese"</span>)
(<span style="font-weight: bold;">setq</span> system-time-locale <span style="font-style: italic;">"C"</span>)

<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">coding system</span>
(set-default-coding-systems 'utf-8-unix)
(prefer-coding-system 'utf-8-unix)
(set-selection-coding-system 'utf-8-unix)

<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">prefer-coding-system take effect equally to follows</span>
(set-buffer-file-coding-system 'utf-8-unix)
(set-file-name-coding-system 'utf-8-unix)
(set-terminal-coding-system 'utf-8-unix)
(set-keyboard-coding-system 'utf-8-unix)
(<span style="font-weight: bold;">setq</span> locale-coding-system 'utf-8-unix)
</pre>
</div>
</div>
</li>

<li><a id="emacs-fontset"></a>Fontsets<br />
<div class="outline-text-6" id="text-emacs-fontset">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(create-fontset-from-ascii-font <span style="font-style: italic;">"IPAGothic"</span> nil <span style="font-style: italic;">"default"</span>)

(create-fontset-from-ascii-font <span style="font-style: italic;">"IPAexMincho"</span> nil <span style="font-style: italic;">"exmincho"</span>)
(set-fontset-font <span style="font-style: italic;">"fontset-exmincho"</span> 'japanese-jisx0208 <span style="font-style: italic;">"IPAexMincho"</span>)

(create-fontset-from-ascii-font <span style="font-style: italic;">"IPAexGothic"</span> nil <span style="font-style: italic;">"exgothic"</span>)
(set-fontset-font <span style="font-style: italic;">"fontset-exgothic"</span> 'japanese-jisx0208 <span style="font-style: italic;">"IPAexGothic"</span>)

(create-fontset-from-ascii-font <span style="font-style: italic;">"IPAMincho"</span> nil <span style="font-style: italic;">"mincho"</span>)
(set-fontset-font <span style="font-style: italic;">"fontset-mincho"</span> 'japanese-jisx0208 <span style="font-style: italic;">"IPAMincho"</span>)
(set-fontset-font <span style="font-style: italic;">"fontset-mincho"</span> 'symbol <span style="font-style: italic;">"IPAMincho"</span>)

(create-fontset-from-ascii-font <span style="font-style: italic;">"Iosevka"</span> nil <span style="font-style: italic;">"code"</span>)
(set-fontset-font <span style="font-style: italic;">"fontset-code"</span> 'latin (font-spec <span style="font-weight: bold;">:family</span> <span style="font-style: italic;">"Iosevka"</span> <span style="font-weight: bold;">:weight</span> 'Light <span style="font-weight: bold;">:width</span> 'Normal))

<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">foreign fonts for all fontsets</span>
(set-fontset-font t 'emoji <span style="font-style: italic;">"Noto Color Emoji"</span>)
(set-fontset-font t 'symbol <span style="font-style: italic;">"Noto Sans CJK JP"</span> nil 'append)
(set-fontset-font t 'symbol <span style="font-style: italic;">"Noto Sans Symbols"</span> nil 'append)
(set-fontset-font t 'symbol <span style="font-style: italic;">"Noto Sans Symbols2"</span> nil 'append)
</pre>
</div>
</div>
</li>

<li><a id="emacs-face"></a>Faces<br />
<div class="outline-text-6" id="text-emacs-face">
<p>
Caveat: <a href="https://en.wikipedia.org/wiki/Leber%27s_hereditary_optic_neuropathy">I am visually impaired</a>, so the font size for the default face is extraordinarily large.
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">face name</th>
<th scope="col" class="org-left">font</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">default</td>
<td class="org-left">IPAGothic</td>
</tr>

<tr>
<td class="org-left">fixed-pitch</td>
<td class="org-left">IPAMincho</td>
</tr>

<tr>
<td class="org-left">fixed-pitch-serif</td>
<td class="org-left">Iosevka</td>
</tr>

<tr>
<td class="org-left">variable-pitch</td>
<td class="org-left">IPAExMincho</td>
</tr>

<tr>
<td class="org-left">variable-pitch-text</td>
<td class="org-left">IPAExGothic</td>
</tr>
</tbody>
</table>

<div class="org-src-container">
<pre class="src src-emacs-lisp" id="orgddf1e29">(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my/default-pixel-width</span> 2560 <span style="font-style: italic;">"Default display width in pixel."</span>)
(<span style="font-weight: bold;">defmacro</span> <span style="font-weight: bold;">my/normalized-font-size</span> (original-size)
  <span style="font-style: italic;">"This macro culculates normalized font size for display resolution at runtime.</span>
<span style="font-style: italic;">It tries to proportionate ORIGINAL-SIZE in `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">my/default-pixel-width</span><span style="font-style: italic;">' in the display at runtime."</span>
  `(truncate (* ,original-size (/ (float (x-display-pixel-width))
                                  ,my/default-pixel-width))))

(set-face-attribute 'default
                    nil
                    <span style="font-weight: bold;">:font</span> <span style="font-style: italic;">"fontset-default"</span>
                    <span style="font-weight: bold;">:height</span> (my/normalized-font-size 620))
(set-face-attribute 'fixed-pitch
                    nil
                    <span style="font-weight: bold;">:font</span> <span style="font-style: italic;">"fontset-mincho"</span>)
(set-face-attribute 'fixed-pitch-serif
                    nil
                    <span style="font-weight: bold;">:font</span> <span style="font-style: italic;">"fontset-code"</span>)
(set-face-attribute 'variable-pitch
                    nil
                    <span style="font-weight: bold;">:font</span> <span style="font-style: italic;">"fontset-exmincho"</span>)
(set-face-attribute 'variable-pitch-text
                    nil
                    <span style="font-weight: bold;">:font</span> <span style="font-style: italic;">"fontset-exgothic"</span>)

(<span style="font-weight: bold;">use-package</span> face
  <span style="font-weight: bold;">:no-require</span> t
  <span style="font-weight: bold;">:hook</span>
  ((eww-mode mastodon-mode nov-mode mu4e-view-mode elfeed-show-mode)
   . (<span style="font-weight: bold;">lambda</span> ()
       (buffer-face-set (check-face 'variable-pitch-text))
       (text-scale-set 5.0)))
  ((Info-mode help-mode helpful-mode woman-mode devdocs-mode)
   . (<span style="font-weight: bold;">lambda</span> ()
       (buffer-face-set (check-face 'default))
       (text-scale-set 1.3)))
  ((org-mode text-mode mu4e-compose-mode)
   . (<span style="font-weight: bold;">lambda</span> ()
       (buffer-face-set (check-face 'default))))
  ((prog-mode shell-mode term-mode vterm-mode eshell-mode calendar-mode)
   . (<span style="font-weight: bold;">lambda</span> ()
       (buffer-face-set (check-face 'fixed-pitch-serif))
       (text-scale-set -1.2)))
  ((dired-mode mu4e-headers-mode elfeed-search-update)
   . (<span style="font-weight: bold;">lambda</span> ()
       (buffer-face-set (check-face 'fixed-pitch)))))
</pre>
</div>
</div>
</li>

<li><a id="org01d0199"></a>Performance Tuning<br />
<div class="outline-text-6" id="text-org01d0199">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">setq</span> auto-window-vscroll nil)
(<span style="font-weight: bold;">setq-default</span> bidi-display-reordering nil)
(<span style="font-weight: bold;">setq</span> bidi-inhibit-bpa t)
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="orge23ab83"></a>Custom Variables<br />
<div class="outline-text-5" id="text-orge23ab83">
<p>
Entries in this section represnets <a href="https://www.gnu.org/software/emacs/manual/html_mono/emacs.html#Customization-Groups">Customization Groups</a> hierarchy.
</p>
</div>

<ul class="org-ul">
<li><a id="org16d4e81"></a>Files<br />
<div class="outline-text-6" id="text-org16d4e81">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">setopt</span> create-lockfiles nil
        remote-file-name-inhibit-locks t)
</pre>
</div>
</div>

<ul class="org-ul">
<li><a id="orgfbd27db"></a>Auto Revert<br />
<div class="outline-text-7" id="text-orgfbd27db">
<p>
<a href="https://www.gnu.org/software/emacs/manual/html_mono/emacs.html#Auto-Revert">Auto Revert</a>: Keeping buffers automatically up-to-date.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> autorevert
  <span style="font-weight: bold;">:diminish</span> (global-auto-revert-mode auto-revert-mode)
  <span style="font-weight: bold;">:custom</span>
  (auto-revert-verbose nil)
  (global-auto-revert-non-file-buffers t)
  (auto-revert-interval 3)
  (auto-revert-check-vc-info t)
  (global-auto-revert-mode t))
</pre>
</div>
</div>
</li>

<li><a id="org5631ffc"></a>Auto Save<br />
<div class="outline-text-7" id="text-org5631ffc">
<p>
<a href="https://www.gnu.org/software/emacs/manual/html_mono/emacs.html#Auto-Save">Auto Save mode</a> saves the file you are editing periodically, whereas <a href="auto-save-visited-mode">auto-save-visited-mode</a> saves all  open buffers in Emacs session.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">setopt</span> auto-save-default t
        auto-save-interval 200
        auto-save-timeout 25
        auto-save-file-name-transforms
        `((<span style="font-style: italic;">".*"</span> ,(no-littering-expand-var-file-name <span style="font-style: italic;">"auto-save/files"</span>) t))
        delete-auto-save-files t
        kill-buffer-delete-auto-save-files t
        auto-save-no-message t)

(<span style="font-weight: bold;">setopt</span> auto-save-visited-mode t
        auto-save-visited-interval 10)
(put 'auto-save-visited-mode 'disabled nil)

(<span style="font-weight: bold;">setopt</span> delete-by-moving-to-trash t)
(<span style="font-weight: bold;">setopt</span> save-some-buffers-default-predicate 'save-some-buffers-root)
</pre>
</div>
</div>
</li>

<li><a id="org0c24d92"></a>Uniquify<br />
<div class="outline-text-7" id="text-org0c24d92">
<p>
<a href="https://www.gnu.org/software/emacs/manual/html_mono/emacs.html#Uniquify">Uniquify</a> shows buffer name easy to distinguish.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> uniquify
  <span style="font-weight: bold;">:custom</span>
  (uniquify-buffer-name-style 'post-forward))
</pre>
</div>
</div>
</li>

<li><a id="org3aa2a3a"></a>Recentf<br />
<div class="outline-text-7" id="text-org3aa2a3a">
<p>
<a href="https://www.gnu.org/software/emacs/manual/html_mono/emacs.html#File-Conveniences">emacs#File Conveniences</a>
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> recentf
  <span style="font-weight: bold;">:hook</span> (after-init . recentf-mode)
  <span style="font-weight: bold;">:custom</span>
  (recentf-exclude '(<span style="font-style: italic;">".gz"</span> <span style="font-style: italic;">".xz"</span> <span style="font-style: italic;">".zip"</span> <span style="font-style: italic;">".gpg"</span>))
  (recentf-max-saved-items 500)
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">clean-up when idle time reaches 7 minutes</span>
  (recentf-auto-cleanup (* 7 60)))
</pre>
</div>
</div>
</li>

<li><a id="orgc9830f6"></a>Tramp<br />
<div class="outline-text-7" id="text-orgc9830f6">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> tramp
  <span style="font-weight: bold;">:defer</span> t
  <span style="font-weight: bold;">:custom</span>
  (tramp-default-method <span style="font-style: italic;">"ssh"</span>)
  <span style="font-weight: bold;">:config</span>
  (add-to-list 'tramp-remote-path 'tramp-own-remote-path)
  (add-to-list 'tramp-remote-path <span style="font-style: italic;">"~/bin"</span>))
</pre>
</div>
</div>
</li>

<li><a id="orgaca94a9"></a>Find File<br />
<div class="outline-text-7" id="text-orgaca94a9">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">setopt</span> large-file-warning-threshold 30000000)
(<span style="font-weight: bold;">setopt</span> revert-buffer-quick-short-answers t)
</pre>
</div>
</div>
</li>

<li><a id="org39ee674"></a>Backup<br />
<div class="outline-text-7" id="text-org39ee674">
<p>
I no longer use backup functionality. Even if I reinstate it, backing up by copying must be rational.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">setopt</span> make-backup-files nil
        backup-by-copying t
        backup-directory-alist
        `((<span style="font-style: italic;">"."</span> . ,(no-littering-expand-var-file-name <span style="font-style: italic;">"backup"</span>))))
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="org7594372"></a>Environment<br />
<ul class="org-ul">
<li><a id="org506bd49"></a>Initialization<br />
<div class="outline-text-7" id="text-org506bd49">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">setopt</span> initial-scratch-message <span style="font-style: italic;">""</span>)
(<span style="font-weight: bold;">setopt</span> inhibit-startup-screen t)
</pre>
</div>
</div>
</li>

<li><a id="org7bd6be9"></a>Frames<br />
<div class="outline-text-7" id="text-org7bd6be9">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(tool-bar-mode -1)
(menu-bar-mode -1)
(scroll-bar-mode -1)
</pre>
</div>
</div>

<ul class="org-ul">
<li><a id="orgb21ebe2"></a>Fringe<br />
<div class="outline-text-8" id="text-orgb21ebe2">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(set-fringe-mode 15)
(<span style="font-weight: bold;">setq-default</span> indicate-buffer-boundaries 'left)
</pre>
</div>
</div>
</li>

<li><a id="org6f19745"></a>Two Column<br />
<div class="outline-text-8" id="text-org6f19745">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> two-column
  <span style="font-weight: bold;">:commands</span> (2C-two-columns 2C-split 2C-associate-buffer)
  <span style="font-weight: bold;">:custom</span>
  (2C-window-width 25))
</pre>
</div>
</div>
</li>

<li><a id="org8e89dce"></a>Desktop<br />
<div class="outline-text-8" id="text-org8e89dce">
<p>
<a href="https://www.gnu.org/software/emacs/manual/html_mono/emacs.html#Saving-Emacs-Sessions">Info manual for Saving Emacs Sessions</a> describes how to set up desktop-save-mode.
'&#x2013;no-desktop' option for emacs command will disable forcibly desktop-save-mode .
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> desktop
  <span style="font-weight: bold;">:commands</span> (desktop-save)
  <span style="font-weight: bold;">:custom</span>
  (desktop-restore-frames t)
  (desktop-restore-eager 1)
  (desktop-lazy-idle-delay 5)
  <span style="font-weight: bold;">:config</span>
  (desktop-change-dir (expand-file-name <span style="font-style: italic;">"desktop"</span> user-emacs-directory))
  (desktop-save-mode 1))
</pre>
</div>
</div>
</li>

<li><a id="org02d7e1b"></a>Cursor<br />
<div class="outline-text-8" id="text-org02d7e1b">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">setopt</span> blink-cursor-blinks 15
        blink-cursor-delay 0.7
        blink-cursor-interval 0.35
        blink-cursor-mode t)
</pre>
</div>
</div>
</li>

<li><a id="orgd847223"></a>Scrolling<br />
<div class="outline-text-8" id="text-orgd847223">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">setopt</span> fast-but-imprecise-scrolling t)
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="org0889fcf"></a>Display<br />
<div class="outline-text-7" id="text-org0889fcf">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">do not use visual bell</span>
(<span style="font-weight: bold;">setopt</span> visible-bell nil)

(<span style="font-weight: bold;">setopt</span> text-scale-mode-step 1.0625
        highlight-nonselected-windows t
        truncate-lines t
        x-underline-at-descent-line nil)
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">avoid to break at whitespace in Japanese</span>
(<span style="font-weight: bold;">setopt</span> word-wrap-by-category t)
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">suppress curved quotes in docstring (for emacs25)</span>
(<span style="font-weight: bold;">setopt</span> text-quoting-style 'straight)
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">resize frame size responding to font size</span>
(<span style="font-weight: bold;">setopt</span> global-text-scale-adjust-resizes-frames t)
</pre>
</div>
</div>
</li>

<li><a id="org58db7eb"></a>Windows<br />
<div class="outline-text-7" id="text-org58db7eb">
<p>
<a href="https://www.masteringemacs.org/article/demystifying-emacs-window-manager?utm_source=newsletter&amp;utm_medium=email&amp;utm_campaign=rss">This blog post</a> is must-read when you tweak display-buffer facilities or something related to display settings.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">setopt</span> scroll-step 1
        scroll-conservatively 101
        next-screen-context-lines 2
        scroll-preserve-screen-position t)
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">display buffer</span>
(<span style="font-weight: bold;">setopt</span> display-buffer-base-action
        '((display-buffer-same-window
           display-buffer-reuse-window
           display-buffer-reuse-mode-window
           display-buffer-in-previous-window)))

(<span style="font-weight: bold;">bind-keys</span> <span style="font-weight: bold;">:map</span> other-window-repeat-map
           (<span style="font-style: italic;">"0"</span> . delete-window)
           (<span style="font-style: italic;">"1"</span> . delete-other-windows))
</pre>
</div>
</div>

<ul class="org-ul">
<li><a id="orgfe2837e"></a>Winner<br />
<div class="outline-text-8" id="text-orgfe2837e">
<p>
Triple Escape (M-ESC ESC) has got to reset window layout by tweaking buffer-quit-function.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> winner
  <span style="font-weight: bold;">:bind</span> ((<span style="font-style: italic;">"H-z"</span> . winner-undo)
         (<span style="font-style: italic;">"H-M-z"</span> . winner-redo))
  <span style="font-weight: bold;">:custom</span>
  (winner-mode t)
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">setq</span> buffer-quit-function 'winner-undo))
</pre>
</div>
</div>
</li>

<li><a id="org3faa111"></a>Windmove<br />
<div class="outline-text-8" id="text-org3faa111">
<p>
You can now switch windows with your shift key by pressing S-&lt;left&gt;, S-&lt;right&gt;, S-&lt;up&gt;, S-&lt;down&gt;.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> windmove
  <span style="font-weight: bold;">:bind</span> ((<span style="font-style: italic;">"C-x C-&lt;left&gt;"</span>    . windmove-left)
         (<span style="font-style: italic;">"C-x C-&lt;right&gt;"</span>   . windmove-right)
         (<span style="font-style: italic;">"C-x C-&lt;up&gt;"</span>      . windmove-up)
         (<span style="font-style: italic;">"C-x C-&lt;down&gt;"</span>    . windmove-down)
         (<span style="font-style: italic;">"C-x C-S-&lt;left&gt;"</span>  . windmove-swap-states-left)
         (<span style="font-style: italic;">"C-x C-S-&lt;right&gt;"</span> . windmove-swap-states-right)
         (<span style="font-style: italic;">"C-x C-S-&lt;up&gt;"</span>    . windmove-swap-states-up)
         (<span style="font-style: italic;">"C-x C-S-&lt;down&gt;"</span>  . windmove-swap-states-down)
         (<span style="font-style: italic;">"C-x C-M-&lt;left&gt;"</span>  . windmove-delete-left)
         (<span style="font-style: italic;">"C-x C-M-&lt;right&gt;"</span> . windmove-delete-right)
         (<span style="font-style: italic;">"C-x C-M-&lt;up&gt;"</span>    . windmove-delete-up)
         (<span style="font-style: italic;">"C-x C-M-&lt;down&gt;"</span>  . windmove-delete-down))
  <span style="font-weight: bold;">:custom</span>
  (windmove-mode t)
  (windmove-wrap-around t)
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">defvar-keymap</span> my/windmove-repeat-map
    <span style="font-weight: bold;">:doc</span> <span style="font-style: italic;">"Keymap to repeat windmove commands."</span>
    <span style="font-weight: bold;">:repeat</span> (<span style="font-weight: bold;">:enter</span> (windmove-left
                     windmove-right
                     windmove-up
                     windmove-down
                     windmove-swap-states-left
                     windmove-swap-states-right
                     windmove-swap-states-up
                     windmove-swap-states-down
                     windmove-delete-left
                     windmove-delete-right
                     windmove-delete-up
                     windmove-delete-down))
    <span style="font-style: italic;">"&lt;left&gt;"</span>  #'windmove-left
    <span style="font-style: italic;">"&lt;right&gt;"</span> #'windmove-right
    <span style="font-style: italic;">"&lt;up&gt;"</span>    #'windmove-up
    <span style="font-style: italic;">"&lt;down&gt;"</span>  #'windmove-down
    <span style="font-style: italic;">"S-&lt;left&gt;"</span>  #'windmove-swap-states-left
    <span style="font-style: italic;">"S-&lt;right&gt;"</span> #'windmove-swap-states-right
    <span style="font-style: italic;">"S-&lt;up&gt;"</span>    #'windmove-swap-states-up
    <span style="font-style: italic;">"S-&lt;down&gt;"</span>  #'windmove-swap-states-down
    <span style="font-style: italic;">"M-&lt;left&gt;"</span>  #'windmove-delete-left
    <span style="font-style: italic;">"M-&lt;right&gt;"</span> #'windmove-delete-right
    <span style="font-style: italic;">"M-&lt;up&gt;"</span>    #'windmove-delete-up
    <span style="font-style: italic;">"M-&lt;down&gt;"</span>  #'windmove-delete-down))
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="emacs-minibuffer"></a>Minibuffer<br />
<div class="outline-text-7" id="text-emacs-minibuffer">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">setopt</span> history-length 1500)
(<span style="font-weight: bold;">setopt</span> history-delete-duplicates t)
(<span style="font-weight: bold;">setopt</span> enable-recursive-minibuffers t)
(<span style="font-weight: bold;">setopt</span> minibuffer-depth-indicate-mode t)
(<span style="font-weight: bold;">setopt</span> read-file-name-completion-ignore-case t)
(<span style="font-weight: bold;">setopt</span> read-minibuffer-restore-windows t)
(<span style="font-weight: bold;">setopt</span> minibuffer-default-prompt-format <span style="font-style: italic;">" [%s]"</span>)
(<span style="font-weight: bold;">setopt</span> completion-cycle-threshold 1)
(<span style="font-weight: bold;">setopt</span> completions-detailed t)

(add-hook 'minibuffer-setup-hook 'my/minibuffer-setup-function)
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/minibuffer-setup-function</span> ()
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">disable input method in mini buffer</span>
  (<span style="font-weight: bold;">when</span> current-input-method
    (deactivate-input-method))
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">decrease font size to 90% in minibuffer</span>
  (<span style="font-weight: bold;">setq-local</span> face-remapping-alist '((default <span style="font-weight: bold;">:height</span> 0.9))))
</pre>
</div>

<p>
Formerly, I used to bind C-h to <code>backward-delete-char</code> and M-h to <code>backward-kill-word</code>, which was very comfortable. However, I realized that C-h should be a help key, as many Emacs packages are developed with the assumption that "C-h is a help key." That said, in the minibuffer where a help key does not necessarily play a significant role, I decided to bind C-h to <code>backward-delete-char</code>.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(keymap-set minibuffer-mode-map
            <span style="font-style: italic;">"C-h"</span> #'delete-backward-char)
(keymap-set minibuffer-mode-map
            <span style="font-style: italic;">"M-h"</span> #'backward-kill-word)
(keymap-set minibuffer-mode-map <span style="font-style: italic;">"TAB"</span> 'minibuffer-complete)
</pre>
</div>
</div>

<ul class="org-ul">
<li><a id="orgd0348e0"></a>Savehist<br />
<div class="outline-text-8" id="text-orgd0348e0">
<p>
<a href="savehist-mode">savehist-mode</a> saves minibuffer history and additionals.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> savehist
  <span style="font-weight: bold;">:custom</span>
  (savehist-save-minibuffer-history t)
  (savehist-additional-variables '((kill-ring . 1000)
                                   (compile-command . 1000)))
  (savehist-autosave-interval 180)
  <span style="font-weight: bold;">:hook</span>
  (after-init . savehist-mode))
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="org7238a9f"></a>Menu<br />
<div class="outline-text-7" id="text-org7238a9f">
<p>
<a href="https://christiantietze.de/posts/2022/12/use-file-open-dialog-for-file-actions/">This blog post</a> demonstrates for emacsers who have disabled file pickers and dialog boxes to adversely use them temporalily.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">setopt</span> use-short-answers t)
(<span style="font-weight: bold;">setopt</span> use-file-dialog nil)
</pre>
</div>
</div>
</li>

<li><a id="org5169ff4"></a>Mode Line<br />
<div class="outline-text-7" id="text-org5169ff4">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my/mode-line-buffer-name-length-max</span> 15
  <span style="font-style: italic;">"Fixed length for displaying buffer name in mode line."</span>)

(<span style="font-weight: bold;">setopt</span> line-number-mode nil
        column-number-mode nil
        mode-line-compact t)
(<span style="font-weight: bold;">setopt</span> mode-line-format
        '(<span style="font-style: italic;">"%e"</span>
          (<span style="font-weight: bold;">:eval</span> (my/tab-bar-mode-line-string))
          mode-line-front-space
          (<span style="font-weight: bold;">:eval</span>
           (<span style="font-weight: bold;">let</span> ((mode-line-buffer-name
                  (replace-regexp-in-string <span style="font-style: italic;">" %</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">[[:ascii:]]</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">"</span> <span style="font-style: italic;">" %%\\1"</span>
                                            (truncate-string-to-width
                                             (buffer-name) my/mode-line-buffer-name-length-max nil ? t))))
             (<span style="font-weight: bold;">cond</span>
              (buffer-read-only
               (propertize mode-line-buffer-name 'face 'underline))
              ((buffer-modified-p)
               (propertize mode-line-buffer-name 'face 'warning))
              (mode-line-buffer-name))))
          (<span style="font-weight: bold;">:eval</span>
           (<span style="font-weight: bold;">cond</span>
            ((<span style="font-weight: bold;">and</span> line-number-mode
                  column-number-mode)
             mode-line-position-column-line-format)
            (line-number-mode mode-line-position-line-format)
            (column-number-mode mode-line-position-column-format)))
          <span style="font-style: italic;">" "</span>
          global-mode-string))
</pre>
</div>
</div>

<ul class="org-ul">
<li><a id="org47dc39b"></a>Display Time<br />
<div class="outline-text-8" id="text-org47dc39b">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">setopt</span>
 display-time-string-forms
 '((propertize (format-time-string <span style="font-style: italic;">"%H:%M"</span> now) 'face 'mode-line-highlight)))
(<span style="font-weight: bold;">setopt</span> display-time-mode t)
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="org05c93e6"></a>Mouse<br />
<div class="outline-text-7" id="text-org05c93e6">
<p>
Mouse needs to be unobtrusive in my Emacs experience.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> mouse
  <span style="font-weight: bold;">:custom</span>
  (mouse-1-click-follows-link nil)
  (mouse-highlight nil)
  (mouse-wheel-mode nil))

(<span style="font-weight: bold;">use-package</span> pixel-scroll
  <span style="font-weight: bold;">:custom</span>
  (pixel-scroll-precision-mode t))
</pre>
</div>
</div>

<ul class="org-ul">
<li><a id="org45e1884"></a>Tool Tips<br />
<div class="outline-text-8" id="text-org45e1884">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(tooltip-mode -1)
(<span style="font-weight: bold;">setq</span> x-gtk-use-system-tooltips nil)
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="org3a1e71a"></a>Hardware<br />
<div class="outline-text-7" id="text-org3a1e71a">
</div>

<ul class="org-ul">
<li><a id="orga8efb38"></a>Battery<br />
<div class="outline-text-8" id="text-orga8efb38">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> battery
  <span style="font-weight: bold;">:after</span> my-launch-app
  <span style="font-weight: bold;">:bind</span> (<span style="font-weight: bold;">:map</span> my/launch-app-map
              (<span style="font-style: italic;">"b"</span> . battery)))
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="org6957720"></a>Installation<br />
<div class="outline-text-7" id="text-org6957720">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> tutorial
  <span style="font-weight: bold;">:commands</span> help-with-tutorial
  <span style="font-weight: bold;">:preface</span>
  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/tutorial--saved-dir</span> ()
    (locate-user-emacs-file
     (no-littering-expand-var-file-name <span style="font-style: italic;">"tutorial/"</span>)
     (expand-file-name <span style="font-style: italic;">"tutorial/"</span> user-emacs-directory)))
  <span style="font-weight: bold;">:config</span>
  (advice-add #'tutorial--saved-dir <span style="font-weight: bold;">:override</span>
              #'my/tutorial--saved-dir))
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="org878d0de"></a>Convenience<br />
<div class="outline-text-6" id="text-org878d0de">
<p>
subword-mode enables to recognize 'RSS' and 'Feed' are separate words in 'RSSFeed'
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(repeat-mode 1)
(global-subword-mode 1)
</pre>
</div>
</div>

<ul class="org-ul">
<li><a id="org0e5af83"></a>Abbreviations<br />
<div class="outline-text-7" id="text-org0e5af83">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> abbrev
  <span style="font-weight: bold;">:diminish</span> abbrev-mode
  <span style="font-weight: bold;">:custom</span>
  (save-abbrevs t)
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">setq-default</span> abbrev-mode 1)
  (quietly-read-abbrev-file))
</pre>
</div>
</div>
</li>

<li><a id="orgdbdea87"></a>Hippie Expand<br />
<div class="outline-text-7" id="text-orgdbdea87">
<p>
<a href="https://www.masteringemacs.org/article/text-expansion-hippie-expand">As this blog post mentions</a>, Hippie Expansion is superior to dabbrev, skeleton and company in the field of auto typing.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> hippie-exp
  <span style="font-weight: bold;">:bind</span> ([remap dabbrev-expand] . hippie-expand))
</pre>
</div>
</div>
</li>

<li><a id="orgbd0673b"></a>Hl Line<br />
<div class="outline-text-7" id="text-orgbd0673b">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> hl-line
  <span style="font-weight: bold;">:hook</span> (vterm-mode . (<span style="font-weight: bold;">lambda</span> () (hl-line-mode -1)))
  <span style="font-weight: bold;">:config</span>
  (hl-line-mode 1))
</pre>
</div>
</div>
</li>

<li><a id="org4bf80b8"></a>Visual Line<br />
<div class="outline-text-7" id="text-org4bf80b8">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> visual-line
  <span style="font-weight: bold;">:no-require</span> t
  <span style="font-weight: bold;">:after</span> adaptive-wrap
  <span style="font-weight: bold;">:hook</span>
  ((feed-show-mode eww-after-render help-mode helpful-mode Info-mode woman-mode
                   mu4e-view-mode nov-mode devdocs-mode)
   . visual-line-mode)
  ((feed-show-mode eww-after-render help-mode helpful-mode Info-mode woman-mode
                   mu4e-view-mode nov-mode devdocs-mode)
   . adaptive-wrap-prefix-mode)
  <span style="font-weight: bold;">:custom</span>
  (global-visual-line-mode nil))
</pre>
</div>
</div>
</li>

<li><a id="org49d7973"></a>Whitespace<br />
<div class="outline-text-7" id="text-org49d7973">
<p>
<a href="https://www.gnu.org/software/emacs/manual/html_mono/emacs.html#Useless-Whitespace">emacs#Useless Whitespace</a>
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> whitespace
  <span style="font-weight: bold;">:diminish</span> ((global-whitespace-mode . <span style="font-style: italic;">"Ws"</span>)
             (whitespace-mode . <span style="font-style: italic;">"ws"</span>))
  <span style="font-weight: bold;">:hook</span>
  ((org-mode prog-mode dired-mode) . whitespace-mode)
  (eww-mode . whitespace-turn-off)
  (before-save . delete-trailing-whitespace)
  <span style="font-weight: bold;">:custom</span>
  (whitespace-style
   '(face trailing tabs tab-mark spaces space-mark empty missing-newline-at-eof))
  (whitespace-action '(cleanup auto-cleanup))
  (whitespace-space-regexp <span style="font-style: italic;">"</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">\x3000+</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">"</span>)
  (whitespace-trailing-regexp <span style="font-style: italic;">"</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">[ \t\u00A0]+</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">$"</span>)
  (whitespace-display-mappings
   '((space-mark ?\x3000 [?\u2423])
     (tab-mark   ?\t   [?\u00BB ?\t])))
  (global-whitespace-mode nil))
</pre>
</div>
</div>
</li>

<li><a id="orga4ab45c"></a>So Long<br />
<div class="outline-text-7" id="text-orga4ab45c">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">setopt</span> global-so-long-mode t)
</pre>
</div>
</div>
</li>

<li><a id="org0430cad"></a>Tab Bar<br />
<div class="outline-text-7" id="text-org0430cad">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> tab-bar
  <span style="font-weight: bold;">:custom</span>
  (tab-bar-show 8)
  (tab-bar-history-mode t)
  (tab-bar-tab-hints t)
  (tab-bar-tab-name-function (apply-partially #'my/project-root-path t))
  <span style="font-weight: bold;">:preface</span>
  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/tab-bar-mode-line-string</span> ()
    <span style="font-style: italic;">"Return the first 3 characters of the name for the current tab."</span>
    (substring
     (assoc-default 'name
                    (assoc-default 'current-tab
                                   (funcall tab-bar-tabs-function)))
     0 3))
  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/project-root-path</span> (<span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> base-name)
    <span style="font-style: italic;">"Return an absolute path for `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">project-current</span><span style="font-style: italic;">' or base name if BASE-NAME is non-nil."</span>
    (<span style="font-weight: bold;">if-let</span> (project (project-current))
        (funcall (<span style="font-weight: bold;">if</span> base-name #'file-name-nondirectory #'identity)
                 (directory-file-name (project-root project)))
      (buffer-name)))
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">with-eval-after-load</span> 'consult
    (<span style="font-weight: bold;">bind-keys</span> <span style="font-weight: bold;">:map</span> tab-prefix-map
               (<span style="font-style: italic;">"B"</span> . consult-buffer-other-tab))))

(keymap-global-set <span style="font-style: italic;">"H-t"</span> tab-prefix-map)
(keymap-set tab-prefix-map <span style="font-style: italic;">"s"</span> #'tab-switcher)
</pre>
</div>
</div>
</li>

<li><a id="org4133fdb"></a>Ffap<br />
<div class="outline-text-7" id="text-org4133fdb">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">ffap</span>)

(ffap-bindings)
</pre>
</div>
</div>
</li>

<li><a id="orgbc18169"></a>Kmacro<br />
<div class="outline-text-7" id="text-orgbc18169">
<p>
The power of keyboard macro is more than repeating editing commands. <a href="https://masteringemacs.org/article/keyboard-macros-are-misunderstood">This post explains fluently</a>.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">kmacro</span>)

(<span style="font-weight: bold;">defalias</span> '<span style="font-weight: bold;">kmacro-insert-macro</span> 'insert-kbd-macro)
(keymap-set kmacro-keymap <span style="font-style: italic;">"I"</span> #'kmacro-insert-macro)
</pre>
</div>
</div>
</li>

<li><a id="emacs-register"></a>Register<br />
<div class="outline-text-7" id="text-emacs-register">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> register
  <span style="font-weight: bold;">:bind</span> (<span style="font-style: italic;">"H-r"</span> . jump-to-register)
  <span style="font-weight: bold;">:custom</span>
  (register-preview-delay nil)
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">with-eval-after-load</span> 'savehist
    (add-to-list 'savehist-additional-variables
                 'register-alist)))
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="org0f54773"></a>Editing<br />
<div class="outline-text-6" id="text-org0f54773">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">the point will be at the beginning of duplicated lines</span>
(<span style="font-weight: bold;">setopt</span> duplicate-line-final-position 1)
</pre>
</div>
</div>

<ul class="org-ul">
<li><a id="org0cb0a82"></a>Indent<br />
<div class="outline-text-7" id="text-org0cb0a82">
<p>
See also <a href="#org5b5b90a">aggressive-indent-mode</a>
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">setopt</span> tab-always-indent 'complete
        indent-tabs-mode nil
        tab-first-completion 'word-or-paren-or-punct)
</pre>
</div>
</div>
</li>

<li><a id="orgd6536cd"></a>Electricity<br />
<div class="outline-text-7" id="text-orgd6536cd">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">setopt</span> electric-indent-mode nil)
</pre>
</div>
</div>
</li>

<li><a id="orgc1077ac"></a>Fill<br />
<div class="outline-text-7" id="text-orgc1077ac">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">setopt</span> fill-column 80
        sentence-end-double-space nil)
</pre>
</div>
</div>
</li>

<li><a id="org22c64cf"></a>Killing<br />
<div class="outline-text-7" id="text-org22c64cf">
<p>
The <code>save-interprogram-paste-before-kill</code> variable controls whether clipboard text is moved to the kill-ring when some text is killed in Emacs. This is something I've been longing for!
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">setopt</span> yank-pop-change-selection t)
(<span style="font-weight: bold;">setopt</span> delete-active-region 'kill)
(<span style="font-weight: bold;">setopt</span> kill-do-not-save-duplicates nil)
(<span style="font-weight: bold;">setopt</span> kill-whole-line nil)
(<span style="font-weight: bold;">setopt</span> save-interprogram-paste-before-kill (expt 2 16))
</pre>
</div>
</div>
</li>

<li><a id="org1c6224d"></a>Undo<br />
<div class="outline-text-7" id="text-org1c6224d">
<p>
The older undo step which exceeds <a href="undo-limit">undo-limit</a> in byte is eliminated at garbage collection.
The oldest undo step, if undo info exceeds <a href="undo-strong-limit">undo-strong-limit</a> in total, is removed instantaneously.
No more new undo step than <a href="undo-outer-limit">undo-outer-limit</a> could not be registered.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">setopt</span> undo-limit 320000
        undo-strong-limit 480000
        undo-outer-limit 48000000
        undo-no-redo nil)
</pre>
</div>
</div>
</li>

<li><a id="org4244efe"></a>Matching<br />
<ul class="org-ul">
<li><a id="org21ea218"></a>Isearch<br />
<div class="outline-text-8" id="text-org21ea218">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> isearch
  <span style="font-weight: bold;">:custom</span>
  (isearch-allow-motion t)
  (isearch-lazy-count t)
  (isearch-lax-whitespace t)
  (isearch-regexp-lax-whitespace t)
  (search-whitespace-regexp <span style="font-style: italic;">".*"</span>)
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">bind-keys</span> <span style="font-weight: bold;">:map</span> isearch-mode-map
             (<span style="font-style: italic;">"C-j"</span> . isearch-exit)))
</pre>
</div>
</div>
</li>

<li><a id="emacs-bookmark"></a>Bookmark<br />
<div class="outline-text-8" id="text-emacs-bookmark">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> bookmark
  <span style="font-weight: bold;">:bind</span> (<span style="font-style: italic;">"C-x 5 B"</span> . bookmark-jump-other-frame)
  <span style="font-weight: bold;">:custom</span>
  (bookmark-save-flag 1)
  (bookmark-menu-confirm-deletion t)
  (bookmark-watch-bookmark-file 'silent))
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="org4e536cc"></a>Paragraph<br />
<div class="outline-text-7" id="text-org4e536cc">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">setopt</span> bidi-paragraph-direction 'left-to-right)
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="orgff83491"></a>Multimedia<br />
<ul class="org-ul">
<li><a id="orge8ddb31"></a>Image<br />
<div class="outline-text-7" id="text-orge8ddb31">
<p>
<a href="https://xenodium.com/emacs-viewing-webp-images/">This post</a> teaches me how to enable converting external formats (i.e. webp) to internal ones.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> image
  <span style="font-weight: bold;">:custom</span>
  (image-use-external-converter t))
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="orgf1127d0"></a>Programming<br />
<div class="outline-text-6" id="text-orgf1127d0">
</div>

<ul class="org-ul">
<li><a id="orgd29a07e"></a>Tools<br />
<div class="outline-text-7" id="text-orgd29a07e">
</div>

<ul class="org-ul">
<li><a id="org736c11c"></a>Xref<br />
<div class="outline-text-8" id="text-org736c11c">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> xref
  <span style="font-weight: bold;">:custom</span>
  (xref-show-definitions-function 'xref-show-definitions-completing-read)
  (xref-search-program (<span style="font-weight: bold;">cond</span>
                        ((<span style="font-weight: bold;">or</span> (executable-find <span style="font-style: italic;">"ripgrep"</span>)
                             (executable-find <span style="font-style: italic;">"rg"</span>))
                         'ripgrep)
                        ((executable-find <span style="font-style: italic;">"ugrep"</span>)
                         'ugrep)
                        (t
                         'grep))))
</pre>
</div>
</div>
</li>

<li><a id="orgc58c867"></a>Ediff<br />
<div class="outline-text-8" id="text-orgc58c867">
</div>

<ul class="org-ul">
<li><a id="org6d0b1a8"></a>Ediff Window<br />
<div class="outline-text-9" id="text-org6d0b1a8">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> ediff
  <span style="font-weight: bold;">:commands</span> ediff-files
  <span style="font-weight: bold;">:custom</span>
  (ediff-window-setup-function 'ediff-setup-windows-plain)
  (ediff-split-window-function 'split-window-horizontally))
</pre>
</div>
</div>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>

<li><a id="org5eb4565"></a>Development<br />
<ul class="org-ul">
<li><a id="orgf600fcd"></a>Internal<br />
<ul class="org-ul">
<li><a id="org6a516b9"></a>Storage Allocation<br />
<div class="outline-text-8" id="text-org6a516b9">
<p>
If GC time at Emacs init is problematic, checking <a href="gcs-done">gcs-done</a> and <a href="gc-elapsed">gc-elapsed</a> may help you. Increasing gc-cons-* variables would minimize Emacs init time, but this also cause each GC time which may noticeable as freeze.
<a href="https://emacsconf.org/2023/talks/gc/">
This presentation</a> advise to increase gc-cons-threshold to 20-80Mb if you have Emacs with slow startup, and to increase consult&#x2013;gc-percentage to 0.2-1.0 if you have slow and frequent GC.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">setq</span> gc-cons-threshold (* 30 gc-cons-threshold)
      gc-cons-percentage 0.3)
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="org32554b4"></a>Lisp<br />
<ul class="org-ul">
<li><a id="org3933aee"></a>Shortdoc<br />
<div class="outline-text-8" id="text-org3933aee">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> shortdoc
  <span style="font-weight: bold;">:bind</span> (<span style="font-style: italic;">"&lt;help&gt; D"</span> . shortdoc-display-group))
</pre>
</div>
</div>
</li>

<li><a id="orgdc22661"></a>Re Builder<br />
<div class="outline-text-8" id="text-orgdc22661">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> re-builder
  <span style="font-weight: bold;">:custom</span>
  (reb-re-syntax 'string))
</pre>
</div>
</div>
</li>

<li><a id="orgdb3a433"></a>Comp<br />
<div class="outline-text-8" id="text-orgdb3a433">
<p>
For <a href="https://www.gnu.org/software/emacs/manual/html_mono/elisp.html#Native-Compilation">native compilation feature</a> introduced at Emacs 28.1.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> comp
  <span style="font-weight: bold;">:init</span>
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">enable asynchronous native compilation</span>
  (<span style="font-weight: bold;">setq</span> native-comp-jit-compilation t)
  <span style="font-weight: bold;">:custom</span>
  (native-comp-async-report-warnings-errors 'silent)
  (native-comp-async-query-on-exit t)
  (native-comp-verbose 1))
</pre>
</div>
</div>
</li>

<li><a id="org35d4b88"></a>Eldoc<br />
<div class="outline-text-8" id="text-org35d4b88">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> eldoc
  <span style="font-weight: bold;">:preface</span>
  (<span style="font-weight: bold;">setq</span> eldoc-documentation-strategy 'eldoc-documentation-compose-eagerly)
  <span style="font-weight: bold;">:custom</span>
  (eldoc-echo-area-prefer-doc-buffer 'maybe)
  <span style="font-weight: bold;">:config</span>
  (eldoc-add-command-completions <span style="font-style: italic;">"paredit-"</span>))
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="org4169cb0"></a>Debug<br />
<div class="outline-text-7" id="text-org4169cb0">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">setopt</span> message-log-max 10000)
</pre>
</div>
</div>
</li>

<li><a id="orgf156666"></a>Development<br />
<div class="outline-text-7" id="text-orgf156666">
</div>

<ul class="org-ul">
<li><a id="orgf203b8c"></a>Extensions<br />
<div class="outline-text-8" id="text-orgf203b8c">
</div>

<ul class="org-ul">
<li><a id="org7f04e21"></a>Transient<br />
<div class="outline-text-9" id="text-org7f04e21">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-transient"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp" id="org4ce56ef">(<span style="font-weight: bold;">use-package</span> transient
  <span style="font-weight: bold;">:custom</span>
  (transient-save-history t)
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">:config</span>
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(mapc (lambda (face) (set-face-attribute face nil</span>
  <span style="font-weight: bold; font-style: italic;">;;                                      </span><span style="font-weight: bold; font-style: italic;">:font "fontset-code"</span>
  <span style="font-weight: bold; font-style: italic;">;;                                      </span><span style="font-weight: bold; font-style: italic;">:height (my/normalized-font-size 420)))</span>
  <span style="font-weight: bold; font-style: italic;">;;       </span><span style="font-weight: bold; font-style: italic;">(seq-filter (lambda (face) (string-match-p "transient-.+" (symbol-name face)))</span>
  <span style="font-weight: bold; font-style: italic;">;;                   </span><span style="font-weight: bold; font-style: italic;">(face-list)))</span>
  )
</pre>
</div>
</div>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>

<li><a id="orgaec78a5"></a>Help<br />
<div class="outline-text-6" id="text-orgaec78a5">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">setopt</span> help-enable-variable-value-editing t)
(<span style="font-weight: bold;">setopt</span> help-enable-symbol-autoload t)
(<span style="font-weight: bold;">setopt</span> describe-bindings-outline t)
</pre>
</div>
</div>
</li>

<li><a id="orgbffcb3b"></a>Data<br />
<ul class="org-ul">
<li><a id="org7df3ae9"></a>Save Place<br />
<div class="outline-text-7" id="text-org7df3ae9">
<p>
File-related tweaks including <a href="https://www.gnu.org/software/emacs/manual/html_mono/emacs.html#Customize-Save">Customizing Saving of Files</a>.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">saveplace</span>)

(<span style="font-weight: bold;">setopt</span> save-place-abbreviate-file-names t
        save-place-version-control t
        save-place-mode t)
</pre>
</div>
</div>
</li>

<li><a id="org49b6d7e"></a>Compression<br />
<div class="outline-text-7" id="text-org49b6d7e">
<ul class="org-ul">
<li><p>
Jka Compr (auto compression mode)
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">setopt</span> auto-compression-mode t)
</pre>
</div></li>
</ul>
</div>
</li>

<li><a id="org91d9067"></a>Tar<br />
<div class="outline-text-7" id="text-org91d9067">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">tar-mode</span>)
</pre>
</div>
</div>
</li>

<li><a id="orgae0b137"></a>Archive<br />
<div class="outline-text-7" id="text-orgae0b137">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">archive-mode</span>)
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="org261007f"></a>Editing Basics<br />
<div class="outline-text-6" id="text-org261007f">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">setopt</span> set-mark-command-repeat-pop t
        mark-ring-max 64
        next-line-add-newlines nil
        cycle-spacing-actions '(delete-all-space just-one-space restore))

<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">delsel</span>
<span style="font-weight: bold; font-style: italic;">;;; </span><span style="font-weight: bold; font-style: italic;">inserting Replacing the string in the region with the typed character</span>
<span style="font-weight: bold; font-style: italic;">;;; </span><span style="font-weight: bold; font-style: italic;">instead of simply inserting it.</span>
(<span style="font-weight: bold;">setopt</span> delete-selection-mode t)

<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">files</span>
(<span style="font-weight: bold;">setopt</span> mode-require-final-newline 'visit-save
        enable-remote-dir-locals t)
(<span style="font-weight: bold;">setq</span> delete-auto-save-files t)
</pre>
</div>
</div>
</li>

<li><a id="orgdcc9de1"></a>External<br />
<ul class="org-ul">
<li><a id="org3d95066"></a>EasyPG<br />
<div class="outline-text-7" id="text-org3d95066">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> epg
  <span style="font-weight: bold;">:defer</span> t
  <span style="font-weight: bold;">:custom</span>
  (epg-pinentry-mode 'loopback))
</pre>
</div>
</div>

<ul class="org-ul">
<li><a id="org5e4ed58"></a>Epa (EasyPG Assistant)<br />
<div class="outline-text-8" id="text-org5e4ed58">
<p>
<a href="https://www.gnu.org/software/emacs/manual/html_mono/epa.html#Top">EasyPG Assistant (epa)</a> enables users to manage their GnuPG keys and exert encryption/sign with them.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> epa
  <span style="font-weight: bold;">:bind</span> ((<span style="font-style: italic;">"C-x : l"</span> . epa-list-keys)
         (<span style="font-style: italic;">"C-x : L"</span> . epa-list-secret-keys)
         <span style="font-weight: bold;">:map</span> dired-mode-map
         (<span style="font-style: italic;">": E"</span> . my/epa-dired-do-encrypt-armor))
  <span style="font-weight: bold;">:preface</span>
  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/epa-dired-do-encrypt-armor</span> ()
    <span style="font-style: italic;">"Encrypt mark files in ASCII armored format."</span>
    (<span style="font-weight: bold;">interactive</span>)
    (<span style="font-weight: bold;">let</span> ((epa-armor t))
      (epa-dired-do-encrypt)))
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">setq</span> epa-file-encrypt-to <span style="font-style: italic;">"&lt;&lt;email&gt;&gt;"</span>))
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="orgda9157f"></a>Server<br />
<div class="outline-text-7" id="text-orgda9157f">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> server
  <span style="font-weight: bold;">:hook</span> (after-init . (<span style="font-weight: bold;">lambda</span> () (<span style="font-weight: bold;">unless</span> (server-running-p)
                               (server-start))))
  <span style="font-weight: bold;">:custom</span>
  (server-name <span style="font-style: italic;">"server-&lt;&lt;hash-string(seed="</span>server<span style="font-style: italic;">", len=6)&gt;&gt;"</span>)
  (server-client-instructions t))
</pre>
</div>
</div>
</li>

<li><a id="orgf7468d0"></a>Processes<br />
<ul class="org-ul">
<li><a id="orga5298ea"></a>Proced<br />
<div class="outline-text-8" id="text-orga5298ea">
<p>
<a href="https://www.masteringemacs.org/article/displaying-interacting-processes-proced">This blog post</a> explains how to use proced, process monitoring package for emacs.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> proced
  <span style="font-weight: bold;">:commands</span> proced
  <span style="font-weight: bold;">:custom</span>
  (proced-auto-update-flag t)
  (proced-auto-update-interval 3)
  (proced-show-remote-processes t)
  (proced-show-remote-processes t))
</pre>
</div>
</div>
</li>
<li><a id="orgb54fa4b"></a>Shell<br />
<div class="outline-text-8" id="text-orgb54fa4b">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">setopt</span> shell-command-prompt-show-cwd t)
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="org37e603c"></a>Browse Url<br />
<div class="outline-text-7" id="text-org37e603c">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> browse-url
  <span style="font-weight: bold;">:init</span>
  (keymap-global-set <span style="font-style: italic;">"C-c C-o"</span> #'browse-url-at-point)
  <span style="font-weight: bold;">:custom</span>
  (browse-url-new-window-flag t)
  (browse-url-browser-function 'eww-browse-url)
  (browse-url-secondary-browser-function 'browse-url-firefox))
</pre>
</div>
</div>

<ul class="org-ul">
<li><a id="org394c0cc"></a>Webjump<br />
<div class="outline-text-8" id="text-org394c0cc">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> webjump
  <span style="font-weight: bold;">:commands</span> webjump
  <span style="font-weight: bold;">:custom</span>
  (webjump-use-internal-browser t))
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="org872acbc"></a>locate<br />
<div class="outline-text-7" id="text-org872acbc">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> locate
  <span style="font-weight: bold;">:commands</span> locate
  <span style="font-weight: bold;">:custom</span>
  (locate-command <span style="font-style: italic;">"plocate"</span>)
  (locate-make-command-line #'my/plocate-make-command-line)
  (locate-fcodes-file (expand-file-name <span style="font-style: italic;">"&lt;&lt;plocate-db()&gt;&gt;"</span>))
  (locate-update-path (expand-file-name <span style="font-style: italic;">"~/"</span>)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/plocate-make-command-line</span> (search-string)
  (list locate-command <span style="font-style: italic;">"-d"</span> (expand-file-name <span style="font-style: italic;">"&lt;&lt;plocate-db()&gt;&gt;"</span>) <span style="font-style: italic;">"--ignore-case"</span> <span style="font-style: italic;">"--existing"</span> <span style="font-style: italic;">"--regexp"</span> search-string))
</pre>
</div>
</div>
</li>

<li><a id="orgd1668ea"></a>With Editor<br />
<div class="outline-text-7" id="text-orgd1668ea">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> with-editor
  <span style="font-weight: bold;">:custom</span>
  (shell-command-with-editor-mode t))
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="orgfd8f190"></a>Applications<br />
<ul class="org-ul">
<li><a id="org77fcb5a"></a>Mail<br />
<div class="outline-text-7" id="text-org77fcb5a">
</div>

<ul class="org-ul">
<li><a id="org5e79221"></a>Smtpmail<br />
<div class="outline-text-8" id="text-org5e79221">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> smtpmail
  <span style="font-weight: bold;">:after</span> mu4e
  <span style="font-weight: bold;">:init</span>
  (<span style="font-weight: bold;">setq</span> smtpmail-default-smtp-server <span style="font-style: italic;">"&lt;&lt;smtp-host&gt;&gt;"</span>)
  <span style="font-weight: bold;">:custom</span>
  (smtpmail-smtp-service 465)
  (smtpmail-smtp-user user-mail-address)
  (smtpmail-stream-type 'ssl)
  (smtpmail-mail-address user-mail-address))
</pre>
</div>
</div>
</li>

<li><a id="org6c42ce7"></a>Message<br />
<div class="outline-text-8" id="text-org6c42ce7">
</div>

<ul class="org-ul">
<li><a id="org35bd2d5"></a>Message Mail<br />
<div class="outline-text-9" id="text-org35bd2d5">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> message
  <span style="font-weight: bold;">:after</span> (dired mu4e)
  <span style="font-weight: bold;">:custom</span>
  (message-send-mail-function 'smtpmail-send-it))
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="org4f0950b"></a>Mime Security<br />
<div class="outline-text-8" id="text-org4f0950b">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> mm-encode
  <span style="font-weight: bold;">:after</span> mu4e
  <span style="font-weight: bold;">:custom</span>
  (mm-sign-option nil))

(<span style="font-weight: bold;">use-package</span> mml-sec
  <span style="font-weight: bold;">:after</span> (mu4e dired)
  <span style="font-weight: bold;">:custom</span>
  (mml-secure-openpgp-sign-with-sender t)
  (mml-default-sign-method 'pgpmime))
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="orgd84bca0"></a>Ispell/FlySpell<br />
<div class="outline-text-7" id="text-orgd84bca0">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> ispell
  <span style="font-weight: bold;">:if</span> (executable-find <span style="font-style: italic;">"aspell"</span>)
  <span style="font-weight: bold;">:custom</span>
  (ispell-program-name <span style="font-style: italic;">"aspell"</span>)
  <span style="font-weight: bold;">:config</span>
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">avoid checking for Japanese characters</span>
  (add-to-list 'ispell-skip-region-alist '(<span style="font-style: italic;">"[</span><span style="font-style: italic;">^</span><span style="font-style: italic;">\000-\377]+"</span>))
  (<span style="font-weight: bold;">setq-default</span> ispell-extra-args '(<span style="font-style: italic;">"--sug-mode=ultra"</span>
                                    <span style="font-style: italic;">"--lang=en_US"</span>))
  (<span style="font-weight: bold;">let</span> ((arg <span style="font-style: italic;">"--camel-case"</span>))
    (<span style="font-weight: bold;">and</span> (string-match-p arg
                         (shell-command-to-string (concat ispell-program-name <span style="font-style: italic;">" --help"</span>)))
         (<span style="font-weight: bold;">push</span> arg ispell-extra-args))))

(<span style="font-weight: bold;">use-package</span> flyspell
  <span style="font-weight: bold;">:after</span> ispell
  <span style="font-weight: bold;">:hook</span> ((text-mode . (<span style="font-weight: bold;">lambda</span> ()
                        (<span style="font-weight: bold;">unless</span> (derived-mode-p 'org-mode)
                          (flyspell-mode 1))))
         (prog-mode . flyspell-prog-mode))
  <span style="font-weight: bold;">:preface</span> (<span style="font-weight: bold;">setq</span> flyspell-mode-map nil)
  <span style="font-weight: bold;">:bind</span> (<span style="font-weight: bold;">:map</span> flyspell-mode-map
              <span style="font-weight: bold;">:prefix</span> <span style="font-style: italic;">"C-$"</span>
              <span style="font-weight: bold;">:prefix-map</span> my/flyspell-mode-map
              <span style="font-weight: bold;">:prefix-docstring</span> <span style="font-style: italic;">"Keymap for Flyspell"</span>
              (<span style="font-style: italic;">"n"</span> . flyspell-goto-next-error)
              (<span style="font-style: italic;">"C-$"</span> . flyspell-auto-correct-word)
              (<span style="font-style: italic;">"C-"</span> . flyspell-auto-correct-previous-word)
              (<span style="font-style: italic;">"$"</span> . flyspell-correct-word-before-point))
  <span style="font-weight: bold;">:custom</span>
  (flyspell-issue-message-flag nil))
</pre>
</div>
</div>
</li>

<li><a id="orgb34909b"></a>News<br />
<ul class="org-ul">
<li><a id="org8f2f12f"></a>Gnus<br />
<ul class="org-ul">
<li><a id="org91b2695"></a>Auth Source<br />
<div class="outline-text-9" id="text-org91b2695">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> auth-source
  <span style="font-weight: bold;">:custom</span>
  (auth-source-gpg-encrypt-to `(,user-mail-address))
  <span style="font-weight: bold;">:config</span>
  (add-to-list 'auth-sources <span style="font-style: italic;">"~/.netrc.gpg"</span>))

(<span style="font-weight: bold;">use-package</span> auth-source-pass
  <span style="font-weight: bold;">:config</span>
  (auth-source-pass-enable))
</pre>
</div>
</div>
</li>
</ul>
</li>
</ul>
</li>

<li><a id="org62fe373"></a>Calc (The GNU Emacs Calculator)<br />
<div class="outline-text-7" id="text-org62fe373">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> calc
  <span style="font-weight: bold;">:bind</span> (<span style="font-style: italic;">"&lt;f7&gt;"</span> . calc)
  <span style="font-weight: bold;">:commands</span> (calc))
</pre>
</div>
</div>
</li>

<li><a id="org46924c8"></a>Calendar<br />
<div class="outline-text-7" id="text-org46924c8">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> calendar
  <span style="font-weight: bold;">:commands</span> (calendar)
  <span style="font-weight: bold;">:hook</span>
  (calendar-today-visible . calendar-mark-today)
  <span style="font-weight: bold;">:custom</span>
  (calendar-left-margin 0)
  (calendar-right-margin 0)
  (calendar-intermonth-spacing 1)
  (calendar-mark-holidays-flag t)
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Below is lat/lon for Japna used in sunrise-sunset command</span>
  (calendar-latitude 36.2)
  (calendar-longitude 138.3)
  <span style="font-weight: bold;">:custom-face</span>
  (holiday ((t (<span style="font-weight: bold;">:foreground</span> <span style="font-style: italic;">"dark orange"</span> <span style="font-weight: bold;">:box</span> t)))))
</pre>
</div>
</div>

<ul class="org-ul">
<li><a id="org90550f7"></a>Midnight<br />
<div class="outline-text-8" id="text-org90550f7">
<div class="org-src-container">
<pre class="src src-emacs-lisp" id="org890e77a">(<span style="font-weight: bold;">use-package</span> midnight
  <span style="font-weight: bold;">:defer</span> t
  <span style="font-weight: bold;">:custom</span>
  (midnight-mode t)
  (midnight-delay <span style="font-style: italic;">"4:00"</span>))
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="org1f552f6"></a>Package<br />
<div class="outline-text-7" id="text-org1f552f6">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> package
  <span style="font-weight: bold;">:custom</span>
  (package-native-compile t)
  (package-install-upgrade-built-in t)
  (package-quickstart t)
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">with-eval-after-load</span> 'my-launch-app
    (keymap-set my/invoke-list-command-map (kbd <span style="font-style: italic;">"p"</span>)
                #'list-packages)))
</pre>
</div>
</div>
</li>

<li><a id="orgdc6145e"></a>Eglot<br />
<div class="outline-text-7" id="text-orgdc6145e">
<p>
<a href="https://github.com/joaotavora/eglot">Eglot</a>
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> eglot
  <span style="font-weight: bold;">:disabled</span> t
  <span style="font-weight: bold;">:hook</span> ((sh-mode ruby-mode python-mode graphviz-dot-mode) . eglot-ensure)
  <span style="font-weight: bold;">:custom</span>
  (eglot-extend-to-xref t))
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="org16426db"></a>Text<br />
<ul class="org-ul">
<li><a id="org824aef1"></a>View<br />
<div class="outline-text-7" id="text-org824aef1">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> view
  <span style="font-weight: bold;">:defer</span> t)
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="org6f76c93"></a>Hypermedia<br />
<div class="outline-text-6" id="text-org6f76c93">
</div>
<ul class="org-ul">
<li><a id="orgcf661d8"></a>Dictionary<br />
<div class="outline-text-7" id="text-orgcf661d8">
<div class="org-src-container">
<pre class="src src-shell">dictd dict <span style="font-style: italic;">\</span>
      dict-gcide dict-wn <span style="font-style: italic;">\</span>
      dict-jargon dict-foldoc dict-vera <span style="font-style: italic;">\</span>
      dict-freedict-eng-jpn dict-freedict-jpn-eng
</pre>
</div>

<div class="org-src-container">
<pre class="src src-conf">sudo systemctl start dictd
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(<span style="font-weight: bold;">use-package</span> dictionary
  <span style="font-weight: bold;">:commands</span> (dictionary-search dictionary-lookup-definition)
  <span style="font-weight: bold;">:custom</span>
  (dictionary-use-single-buffer t)
  (dictionary-server nil)
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">setq</span> switch-to-buffer-obey-display-actions t)
  (add-to-list 'display-buffer-alist
               '(<span style="font-style: italic;">"^\\*Dictionary\\*"</span>
                 display-buffer-in-tab)))
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="org64b01b5"></a>Communication<br />
<div class="outline-text-6" id="text-org64b01b5">
</div>

<ul class="org-ul">
<li><a id="orge7de448"></a>Net Utils<br />
<div class="outline-text-7" id="text-orge7de448">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> net-utils
  <span style="font-weight: bold;">:after</span> my-launch-app
  <span style="font-weight: bold;">:bind</span> (<span style="font-weight: bold;">:map</span> my/launch-app-map
              (<span style="font-style: italic;">"n d"</span> . run-dig)
              (<span style="font-style: italic;">"n i"</span> . ifconfig)
              (<span style="font-style: italic;">"n w"</span> . iwconfig)
              (<span style="font-style: italic;">"n p"</span> . ping)))
</pre>
</div>
</div>
</li>
</ul>
</li>
</ul>
</li>

<li><a id="orgff1619b"></a>Input Methods<br />
<ul class="org-ul">
<li><a id="org6274bce"></a>ddskk<br />
<div class="outline-text-6" id="text-org6274bce">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-ddskk"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-style: italic;">"https://github.com/skk-dev/ddskk/releases.atom"</span> soft_update)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp" id="orgd1cc5eb">(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">skk-dir</span> (expand-file-name <span style="font-style: italic;">"skk"</span> <span style="font-style: italic;">"&lt;&lt;share-dir()&gt;&gt;"</span>))

(<span style="font-weight: bold;">use-package</span> skk
  <span style="font-weight: bold;">:defer</span> t
  <span style="font-weight: bold;">:init</span>
  (<span style="font-weight: bold;">setopt</span> default-input-method <span style="font-style: italic;">"japanese-skk"</span>)
  (<span style="font-weight: bold;">defface</span> <span style="font-weight: bold; font-style: italic;">skk-candidate</span> `((t . (<span style="font-weight: bold;">:font</span> <span style="font-style: italic;">"fontset-default"</span>
                                       <span style="font-weight: bold;">:height</span> ,(my/normalized-font-size 860))))
    <span style="font-style: italic;">"Default face for ddskk candidates."</span>
    <span style="font-weight: bold;">:group</span> 'skk-dcomp)
  (<span style="font-weight: bold;">setq</span> skk-get-jisyo-directory <span style="font-style: italic;">"&lt;&lt;skk-jisyo-path()&gt;&gt;"</span>)
  <span style="font-weight: bold;">:custom</span>
  (skk-user-directory (no-littering-expand-etc-file-name <span style="font-style: italic;">"ddskk"</span>))
  (skk-init-file (expand-file-name <span style="font-style: italic;">"ddskk-init.el"</span> skk-user-directory))
  (skk-byte-compile-init-file t)
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">cursor color</span>
  (skk-use-color-cursor t)
  (skk-cursor-hiragana-color <span style="font-style: italic;">"orange"</span>)
  (skk-cursor-katakana-color <span style="font-style: italic;">"OrangeRed3"</span>)
  (skk-cursor-latin-color <span style="font-style: italic;">"DodgerBlue3"</span>)
  (skk-cursor-jisx0201-color <span style="font-style: italic;">"purple3"</span>)
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">mode line string</span>
  (skk-latin-mode-string <span style="font-style: italic;">"A"</span>)
  (skk-hiragana-mode-string <span style="font-style: italic;">"&#12354;"</span>)
  (skk-katakana-mode-string <span style="font-style: italic;">"&#12450;"</span>)
  (skk-jisx0201-mode-string <span style="font-style: italic;">"&#65393;"</span>)
  (skk-jisx0208-latin-mode-string <span style="font-style: italic;">"&#65313;"</span>)
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">AZIK</span>
  (skk-use-azik t)
  (skk-azik-keyboard-type 'us101)
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">conversion</span>
  (skk-egg-like-newline t)
  (skk-henkan-strict-okuri-precedence t)
  (skk-check-okurigana-on-touroku t)
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">annotation</span>
  (skk-show-annotation t)
  (skk-annotation-delay 0.3)
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">how candidates behave</span>
  (skk-show-candidates-always-pop-to-buffer t)
  (skk-henkan-number-to-display-candidates 10)
  (skk-show-candidates-nth-henkan-char 3)
  (skk-henkan-show-candidates-keys
   '(?1 ?2 ?3 ?4 ?5 ?6 ?7 ?8 ?9 ?0))
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">set face for candidates list</span>
  (skk-treat-candidate-appearance-function
   (<span style="font-weight: bold;">lambda</span> (candidate listing-p)
     (<span style="font-weight: bold;">cond</span>
      ((string-match <span style="font-style: italic;">";"</span> candidate)
       (put-text-property 0 (match-beginning 0)
                          'face 'skk-candidate
                          candidate)
       (put-text-property (match-beginning 0)
                          (length candidate) 'face 'shadow candidate))
      (t
       (put-text-property 0 (length candidate)
                          'face 'skk-candidate
                          candidate)))
     candidate))
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">bind C-q for hankaku-kana input mode</span>
  (skk-use-jisx0201-input-method t)
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">dynamic conversion</span>
  (skk-dcomp-activate nil)
  (skk-dcomp-multiple-activate nil)
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">config file</span>
  (skk-record-file (expand-file-name <span style="font-style: italic;">"record"</span> skk-dir))
  (skk-emacs-id-file (expand-file-name <span style="font-style: italic;">"emacs-id"</span> skk-dir))
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">jisyo</span>
  (skk-share-private-jisyo t)
  (skk-compare-jisyo-size-when-saving t)
  (skk-save-jisyo-instantly t)
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">jisyo file/directory</span>
  (skk-jisyo `(,(no-littering-expand-var-file-name <span style="font-style: italic;">"ddskk/jisyo.txt"</span>) . utf-8))
  (skk-backup-jisyo (expand-file-name <span style="font-style: italic;">"jisyo.bak"</span> skk-dir))
  (skk-large-jisyo (expand-file-name <span style="font-style: italic;">"SKK-JISYO.L"</span> skk-get-jisyo-directory))
  (skk-itaiji-jisyo (expand-file-name <span style="font-style: italic;">"SKK-JISYO.itaiji"</span> skk-get-jisyo-directory))
  (skk-extra-jisyo-file-list
   (seq-remove (<span style="font-weight: bold;">lambda</span> (dic)
                 (seq-some (<span style="font-weight: bold;">lambda</span> (suffix)
                             (string-suffix-p (symbol-name suffix) dic))
                           '(L itaiji tar)))
               (append (file-expand-wildcards (expand-file-name <span style="font-style: italic;">"SKK-JISYO.*"</span> skk-get-jisyo-directory))
                       (file-expand-wildcards (expand-file-name <span style="font-style: italic;">"open-jisyo/SKK-JISYO.*"</span> skk-dir)))))
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">jisyo server</span>
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(skk-server-host "localhost")</span>
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(skk-server-portnum 1178)</span>
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(skk-server-inhibit-startup-server t)</span>
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">study</span>
  (skk-study-file (expand-file-name <span style="font-style: italic;">"study"</span> skk-dir))
  (skk-study-backup-file (expand-file-name <span style="font-style: italic;">"study.bak"</span> skk-dir))
  <span style="font-weight: bold;">:config</span>
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">ward off activating skk-auto-fill-mode inadvertently</span>
  (<span style="font-weight: bold;">bind-keys</span> (<span style="font-style: italic;">"C-x j"</span> . skk-mode)))
</pre>
</div>

<ul class="org-ul">
<li>ddskk init file</li>
</ul>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">-*- mode:emacs-lisp; -*-</span>
(<span style="font-weight: bold;">setq</span> skk-rom-kana-rule-list
      (append skk-rom-kana-rule-list
              '((<span style="font-style: italic;">"!"</span> nil skk-purge-from-jisyo)
                (<span style="font-style: italic;">"xka"</span> nil (<span style="font-style: italic;">"&#12533;"</span> . <span style="font-style: italic;">"&#12533;"</span>))
                (<span style="font-style: italic;">"xke"</span> nil (<span style="font-style: italic;">"&#12534;"</span> . <span style="font-style: italic;">"&#12534;"</span>))
                (<span style="font-style: italic;">"n"</span> nil nil)
                (<span style="font-style: italic;">"nn"</span> nil (<span style="font-style: italic;">"&#12490;&#12494;"</span> . <span style="font-style: italic;">"&#12394;&#12398;"</span>))
                (<span style="font-style: italic;">"nm"</span> nil (<span style="font-style: italic;">"&#12494;&#12511;"</span> . <span style="font-style: italic;">"&#12398;&#12415;"</span>))
                (<span style="font-style: italic;">"ks"</span> nil (<span style="font-style: italic;">"&#12467;&#12477;"</span> . <span style="font-style: italic;">"&#12371;&#12381;"</span>))
                (<span style="font-style: italic;">"kna"</span> nil (<span style="font-style: italic;">"&#12459;&#12490;"</span> . <span style="font-style: italic;">"&#12363;&#12394;"</span>))
                (<span style="font-style: italic;">"kno"</span> nil (<span style="font-style: italic;">"&#12467;&#12494;"</span> . <span style="font-style: italic;">"&#12371;&#12398;"</span>))
                (<span style="font-style: italic;">"ym"</span> nil (<span style="font-style: italic;">"&#12516;&#12510;"</span> . <span style="font-style: italic;">"&#12420;&#12414;"</span>))
                (<span style="font-style: italic;">"yk"</span> nil (<span style="font-style: italic;">"&#12518;&#12461;"</span> . <span style="font-style: italic;">"&#12422;&#12365;"</span>))
                (<span style="font-style: italic;">"tga"</span> nil (<span style="font-style: italic;">"&#12479;&#12460;"</span> . <span style="font-style: italic;">"&#12383;&#12364;"</span>))
                (<span style="font-style: italic;">"vj"</span> nil (<span style="font-style: italic;">"&#12532;&#12531;"</span> . <span style="font-style: italic;">"&#12406;&#12435;"</span>))
                (<span style="font-style: italic;">"hm"</span> nil (<span style="font-style: italic;">"&#12495;&#12510;"</span> . <span style="font-style: italic;">"&#12399;&#12414;"</span>))
                <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">followings are for preventing from changing to zenkaku eisu mode by pressing '</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">L</span><span style="font-weight: bold; font-style: italic;">'</span>
                (<span style="font-style: italic;">"bL"</span> nil (<span style="font-style: italic;">"&#12508;&#12531;"</span> . <span style="font-style: italic;">"&#12412;&#12435;"</span>))
                (<span style="font-style: italic;">"byL"</span> nil (<span style="font-style: italic;">"&#12499;&#12519;&#12531;"</span> . <span style="font-style: italic;">"&#12403;&#12423;&#12435;"</span>))
                (<span style="font-style: italic;">"cL"</span> nil (<span style="font-style: italic;">"&#12481;&#12519;&#12531;"</span> . <span style="font-style: italic;">"&#12385;&#12423;&#12435;"</span>))
                (<span style="font-style: italic;">"dL"</span> nil (<span style="font-style: italic;">"&#12489;&#12531;"</span> . <span style="font-style: italic;">"&#12393;&#12435;"</span>))
                (<span style="font-style: italic;">"fL"</span> nil (<span style="font-style: italic;">"&#12501;&#12457;&#12531;"</span> . <span style="font-style: italic;">"&#12405;&#12361;&#12435;"</span>))
                (<span style="font-style: italic;">"gL"</span> nil (<span style="font-style: italic;">"&#12468;&#12531;"</span> . <span style="font-style: italic;">"&#12372;&#12435;"</span>))
                (<span style="font-style: italic;">"gyL"</span> nil (<span style="font-style: italic;">"&#12462;&#12519;&#12531;"</span> . <span style="font-style: italic;">"&#12366;&#12423;&#12435;"</span>))
                (<span style="font-style: italic;">"hL"</span> nil (<span style="font-style: italic;">"&#12507;&#12531;"</span> . <span style="font-style: italic;">"&#12411;&#12435;"</span>))
                (<span style="font-style: italic;">"hgL"</span> nil (<span style="font-style: italic;">"&#12498;&#12519;&#12531;"</span> . <span style="font-style: italic;">"&#12402;&#12423;&#12435;"</span>))
                (<span style="font-style: italic;">"hyL"</span> nil (<span style="font-style: italic;">"&#12498;&#12519;&#12531;"</span> . <span style="font-style: italic;">"&#12402;&#12423;&#12435;"</span>))
                (<span style="font-style: italic;">"jL"</span> nil (<span style="font-style: italic;">"&#12472;&#12519;&#12531;"</span> . <span style="font-style: italic;">"&#12376;&#12423;&#12435;"</span>))
                (<span style="font-style: italic;">"kL"</span> nil (<span style="font-style: italic;">"&#12467;&#12531;"</span> . <span style="font-style: italic;">"&#12371;&#12435;"</span>))
                (<span style="font-style: italic;">"kgL"</span> nil (<span style="font-style: italic;">"&#12461;&#12519;&#12531;"</span> . <span style="font-style: italic;">"&#12365;&#12423;&#12435;"</span>))
                (<span style="font-style: italic;">"kyL"</span> nil (<span style="font-style: italic;">"&#12461;&#12519;&#12531;"</span> . <span style="font-style: italic;">"&#12365;&#12423;&#12435;"</span>))
                (<span style="font-style: italic;">"mL"</span> nil (<span style="font-style: italic;">"&#12514;&#12531;"</span> . <span style="font-style: italic;">"&#12418;&#12435;"</span>))
                (<span style="font-style: italic;">"mgL"</span> nil (<span style="font-style: italic;">"&#12511;&#12519;&#12531;"</span> . <span style="font-style: italic;">"&#12415;&#12423;&#12435;"</span>))
                (<span style="font-style: italic;">"myL"</span> nil (<span style="font-style: italic;">"&#12511;&#12519;&#12531;"</span> . <span style="font-style: italic;">"&#12415;&#12423;&#12435;"</span>))
                (<span style="font-style: italic;">"nL"</span> nil (<span style="font-style: italic;">"&#12494;&#12531;"</span> . <span style="font-style: italic;">"&#12398;&#12435;"</span>))
                (<span style="font-style: italic;">"ngL"</span> nil (<span style="font-style: italic;">"&#12491;&#12519;&#12531;"</span> . <span style="font-style: italic;">"&#12395;&#12423;&#12435;"</span>))
                (<span style="font-style: italic;">"nyL"</span> nil (<span style="font-style: italic;">"&#12491;&#12519;&#12531;"</span> . <span style="font-style: italic;">"&#12395;&#12423;&#12435;"</span>))
                (<span style="font-style: italic;">"pL"</span> nil (<span style="font-style: italic;">"&#12509;&#12531;"</span> . <span style="font-style: italic;">"&#12413;&#12435;"</span>))
                (<span style="font-style: italic;">"pgL"</span> nil (<span style="font-style: italic;">"&#12500;&#12519;&#12531;"</span> . <span style="font-style: italic;">"&#12404;&#12423;&#12435;"</span>))
                (<span style="font-style: italic;">"pyL"</span> nil (<span style="font-style: italic;">"&#12500;&#12519;&#12531;"</span> . <span style="font-style: italic;">"&#12404;&#12423;&#12435;"</span>))
                (<span style="font-style: italic;">"rL"</span> nil (<span style="font-style: italic;">"&#12525;&#12531;"</span> . <span style="font-style: italic;">"&#12429;&#12435;"</span>))
                (<span style="font-style: italic;">"ryL"</span> nil (<span style="font-style: italic;">"&#12522;&#12519;&#12531;"</span> . <span style="font-style: italic;">"&#12426;&#12423;&#12435;"</span>))
                (<span style="font-style: italic;">"sL"</span> nil (<span style="font-style: italic;">"&#12477;&#12531;"</span> . <span style="font-style: italic;">"&#12381;&#12435;"</span>))
                (<span style="font-style: italic;">"syL"</span> nil (<span style="font-style: italic;">"&#12471;&#12519;&#12531;"</span> . <span style="font-style: italic;">"&#12375;&#12423;&#12435;"</span>))
                (<span style="font-style: italic;">"tL"</span> nil (<span style="font-style: italic;">"&#12488;&#12531;"</span> . <span style="font-style: italic;">"&#12392;&#12435;"</span>))
                (<span style="font-style: italic;">"tyL"</span> nil (<span style="font-style: italic;">"&#12481;&#12519;&#12531;"</span> . <span style="font-style: italic;">"&#12385;&#12423;&#12435;"</span>))
                (<span style="font-style: italic;">"vL"</span> nil (<span style="font-style: italic;">"&#12532;&#12457;&#12531;"</span> . <span style="font-style: italic;">"&#12358;&#12443;&#12361;&#12435;"</span>))
                (<span style="font-style: italic;">"wL"</span> nil (<span style="font-style: italic;">"&#12454;&#12457;&#12531;"</span> . <span style="font-style: italic;">"&#12358;&#12361;&#12435;"</span>))
                (<span style="font-style: italic;">"xL"</span> nil (<span style="font-style: italic;">"&#12471;&#12519;&#12531;"</span> . <span style="font-style: italic;">"&#12375;&#12423;&#12435;"</span>))
                (<span style="font-style: italic;">"xxL"</span> nil (<span style="font-style: italic;">"&#8594;"</span> . <span style="font-style: italic;">"&#8594;"</span>))
                (<span style="font-style: italic;">"yL"</span> nil (<span style="font-style: italic;">"&#12520;&#12531;"</span> . <span style="font-style: italic;">"&#12424;&#12435;"</span>))
                (<span style="font-style: italic;">"zL"</span> nil (<span style="font-style: italic;">"&#12478;&#12531;"</span> . <span style="font-style: italic;">"&#12382;&#12435;"</span>))
                (<span style="font-style: italic;">"zyL"</span> nil (<span style="font-style: italic;">"&#12472;&#12519;&#12531;"</span> . <span style="font-style: italic;">"&#12376;&#12423;&#12435;"</span>)))))

(add-hook 'skk-azik-load-hook
          (<span style="font-weight: bold;">lambda</span> ()
            (<span style="font-weight: bold;">dolist</span> (key '(<span style="font-style: italic;">"kA"</span> <span style="font-style: italic;">"kE"</span> <span style="font-style: italic;">"tU"</span> <span style="font-style: italic;">"wA"</span>))
              (<span style="font-weight: bold;">setq</span> skk-rom-kana-rule-list
                    (skk-del-alist key skk-rom-kana-rule-list)))))
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="org9a22041"></a>Dired<br />
<div class="outline-text-5" id="text-org9a22041">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> dired
  <span style="font-weight: bold;">:bind</span> (<span style="font-weight: bold;">:map</span> global-map
              (<span style="font-style: italic;">"C-x d"</span> . dired-jump)
              <span style="font-weight: bold;">:map</span> dired-mode-map
              (<span style="font-style: italic;">"C-j"</span> . dired-find-file)
              (<span style="font-style: italic;">"^"</span> . dired-up-directory)
              (<span style="font-style: italic;">"("</span> . dired-hide-details-mode)
              (<span style="font-style: italic;">")"</span> . dired-hide-details-mode)
              (<span style="font-style: italic;">"E"</span> . dired-create-empty-file)
              (<span style="font-style: italic;">"Y"</span> . dired-do-relsymlink)
              (<span style="font-style: italic;">"e"</span> . wdired-change-to-wdired-mode)
              (<span style="font-style: italic;">"RET"</span> . dired-open-file)
              (<span style="font-style: italic;">"C-c C-o"</span> . dired-open-file)
              (<span style="font-style: italic;">"C-c C-s"</span> . my/dired-share))
  <span style="font-weight: bold;">:hook</span> (dired-mode . dired-hide-details-mode)
  <span style="font-weight: bold;">:custom</span>
  (dired-kill-when-opening-new-dired-buffer t)
  (dired-do-revert-buffer t)
  (dired-auto-revert-buffer t)
  (dired-copy-dereference t)
  (dired-recursive-copies 'always)
  (dired-recursive-deletes 'top)
  (dired-listing-switches <span style="font-style: italic;">"-ahgG --time-style=long-iso --group-directories-first"</span>)
  (dired-dwim-target 'dired-dwim-target-next)
  (dired-hide-details-hide-information-lines nil)
  (dired-hide-details-hide-symlink-targets nil)
  (dired-compress-file-default-suffix <span style="font-style: italic;">".zst"</span>)
  (dired-compress-directory-default-suffix <span style="font-style: italic;">".7z"</span>)
  (dired-isearch-filenames t)
  (dired-open-use-nohup t)
  (dired-open-query-before-exit nil)
  (completion-ignored-extensions nil)
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">with-eval-after-load</span> 'open-file
    (<span style="font-weight: bold;">setq</span> dired-guess-shell-alist-user
          `((,(regexp-opt (append my/open-file-media-extensions
                                  my/open-file-compressed-media-extensions)
                          <span style="font-style: italic;">"\\.</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">"</span>)
             <span style="font-style: italic;">"mpv"</span>)
            (,(regexp-quote <span style="font-style: italic;">".kdenlive"</span>) <span style="font-style: italic;">"kdenlive"</span>)
            (,(regexp-quote <span style="font-style: italic;">".xcf"</span>) <span style="font-style: italic;">"gimp"</span>))))
  (advice-add #'dired-do-delete <span style="font-weight: bold;">:around</span> #'my/advice-dired-control-deletion)
  (advice-add #'dired-do-flagged-delete <span style="font-weight: bold;">:around</span> #'my/advice-dired-control-deletion)
  (put 'dired-find-alternate-file 'disabled nil))

(<span style="font-weight: bold;">use-package</span> dired-x
  <span style="font-weight: bold;">:after</span> dired
  <span style="font-weight: bold;">:config</span>
  (lambda-key dired-mode-map <span style="font-style: italic;">"."</span>
              (<span style="font-weight: bold;">lambda</span> ()
                <span style="font-style: italic;">"Toggle hiding dotfiles whose name starts with '</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">.</span><span style="font-style: italic;">'"</span>
                (<span style="font-weight: bold;">interactive</span>)
                (<span style="font-weight: bold;">let</span> ((dired-omit-files (<span style="font-weight: bold;">rx</span> (seq string-start
                                                 (<span style="font-weight: bold;">or</span> <span style="font-style: italic;">"."</span> <span style="font-style: italic;">".."</span>
                                                     (seq <span style="font-style: italic;">"."</span> (+? graph)))
                                                 string-end))))
                  (call-interactively #'dired-omit-mode)))))

(<span style="font-weight: bold;">use-package</span> dired-aux
  <span style="font-weight: bold;">:after</span> dired
  <span style="font-weight: bold;">:custom</span>
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Renaming files in Dired reflects their name in VCSs</span>
  (dired-vc-rename-file t)
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">setq</span> dired-compress-files-alist
        (append dired-compress-files-alist
                '((<span style="font-style: italic;">"\\.tar\\.7z\\'"</span> . <span style="font-style: italic;">"tar cf - %i | 7z a -si %o"</span>)
                  (<span style="font-style: italic;">"\\.7z\\'"</span> . <span style="font-style: italic;">"7z a %o %i"</span>))))
  (add-to-list 'dired-compress-file-suffixes
               '(<span style="font-style: italic;">"\\.tar\\.7z\\'"</span> <span style="font-style: italic;">""</span> <span style="font-style: italic;">"7z x -so %i | tar xf -"</span>))
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">submit "M-s f" to consult-find</span>
  (<span style="font-weight: bold;">bind-keys</span> <span style="font-weight: bold;">:map</span> dired-mode-map
             (<span style="font-style: italic;">"M-s f"</span> . nil)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/advice-dired-control-deletion</span> (oldfun <span style="font-weight: bold; text-decoration: underline;">&amp;rest</span> r)
  <span style="font-style: italic;">"Enable file deleting functions to control deleting procedure</span>
<span style="font-style: italic;">whether files are going to be in trash box."</span>
  (<span style="font-weight: bold;">let</span> ((delete-by-moving-to-trash
         (<span style="font-weight: bold;">if</span> (equal current-prefix-arg '(4))
             nil t)))
    (apply oldfun (cdr r))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/dired-share</span> ()
  <span style="font-style: italic;">"Share file with remote device via KDE Connect."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">let</span> ((files (dired-get-marked-files nil nil)))
    (mapc (<span style="font-weight: bold;">lambda</span> (file)
            (shell-command
             (mapconcat 'identity
                        (list <span style="font-style: italic;">"kdeconnect-cli"</span> <span style="font-style: italic;">"-d"</span> <span style="font-style: italic;">"a30587ededf4c2d2"</span>
                              <span style="font-style: italic;">"--share"</span> (shell-quote-argument
                                         file)) <span style="font-weight: bold; font-style: italic;">" "</span><span style="font-weight: bold;">)))</span>
          files)))
</pre>
</div>
</div>
<ul class="org-ul">
<li><a id="orgf7f3108"></a>dired-rsync<br />
<div class="outline-text-6" id="text-orgf7f3108">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-dired-rsync"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> dired-rsync
  <span style="font-weight: bold;">:after</span> dired
  <span style="font-weight: bold;">:bind</span> (<span style="font-weight: bold;">:map</span> dired-mode-map
              (<span style="font-style: italic;">"C-c C-r"</span> . dired-rsync))
  <span style="font-weight: bold;">:custom</span>
  (dired-rsync-options <span style="font-style: italic;">"-auz --info=progress2"</span>))
</pre>
</div>
</div>
</li>

<li><a id="org4fa5696"></a>dired-single&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span><br /></li>

<li><a id="orgf3a8fb4"></a>dired-hacks<br />
<div class="outline-text-6" id="text-orgf3a8fb4">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-dired-hacks"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">dired-open</span>)

(<span style="font-weight: bold;">use-package</span> dired-subtree
  <span style="font-weight: bold;">:after</span> dired
  <span style="font-weight: bold;">:bind</span> (<span style="font-weight: bold;">:map</span> dired-mode-map
              (<span style="font-style: italic;">"TAB"</span> . dired-subtree-cycle)))

(<span style="font-weight: bold;">use-package</span> dired-narrow
  <span style="font-weight: bold;">:after</span> dired
  <span style="font-weight: bold;">:bind</span>
  (<span style="font-weight: bold;">:map</span> dired-mode-map
        (<span style="font-style: italic;">"z"</span> . dired-narrow))
  (<span style="font-weight: bold;">:map</span> dired-narrow-map
        (<span style="font-style: italic;">"C-j"</span> . exit-minibuffer)))
</pre>
</div>
</div>
</li>

<li><a id="orgd515649"></a>dired-hide-dotfiles&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span><br /></li>

<li><a id="org0265bb1"></a>find-dired<br />
<div class="outline-text-6" id="text-org0265bb1">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> find-dired
  <span style="font-weight: bold;">:bind</span> (<span style="font-weight: bold;">:prefix</span> <span style="font-style: italic;">"M-s d"</span>
                 <span style="font-weight: bold;">:prefix-map</span> my/find-dired-map
                 <span style="font-weight: bold;">:prefix-docstring</span> <span style="font-style: italic;">"Keymap for FInd Dired"</span>
                 (<span style="font-style: italic;">"f"</span> . find-dired)
                 (<span style="font-style: italic;">"F"</span> . find-lisp-find-dired)
                 (<span style="font-style: italic;">"g"</span> . find-grep-dired)
                 (<span style="font-style: italic;">"n"</span> . find-name-dired)
                 (<span style="font-style: italic;">"d"</span> . find-lisp-find-dired-subdirectories)
                 (<span style="font-style: italic;">"!"</span> . find-dired-with-command))
  <span style="font-weight: bold;">:custom</span>
  (find-grep-options <span style="font-style: italic;">"-n -H --no-heading -q"</span>)
  (find-ls-option '(<span style="font-style: italic;">"-print0 | xargs -0 ls -ldN"</span> . <span style="font-style: italic;">"-ldN"</span>)))
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="org8e99704"></a>EWW<br />
<div class="outline-text-5" id="text-org8e99704">
<div class="org-src-container">
<pre class="src src-emacs-lisp" id="org8b02c0e">(funcall (<span style="font-weight: bold;">if</span> (= full-path 0) #'identity #'expand-file-name)
         (file-name-concat no-littering-var-directory <span style="font-style: italic;">"eww/org"</span>))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-conf"><span style="font-weight: bold; font-style: italic;">d &lt;&lt;eww-org-dir(full-path</span>=1)&gt;&gt; - - - 3d
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">with-eval-after-load</span> 'shr
  (<span style="font-weight: bold;">setopt</span> shr-width 10000)
  (<span style="font-weight: bold;">setopt</span> shr-use-fonts nil)
  (<span style="font-weight: bold;">setopt</span> shr-image-animate t)
  (<span style="font-weight: bold;">setopt</span> shr-use-colors nil)
  (<span style="font-weight: bold;">setopt</span> shr-max-image-proportion 0.4)
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">never use cookies</span>
  (<span style="font-weight: bold;">setopt</span> shr-cookie-policy nil))
</pre>
</div>

<p>
The EWW bookmark functionality is an original implementation, separate from the emacs bookmark facility. Although <a href="https://lists.gnu.org/archive/html/emacs-devel/2020-10/msg01651.html">adoption of the facility has been considered</a>, a possible solution to count EWW bookmarks in the source of consult-buffer is showcased at <a href="https://github.com/minad/consult/issues/347">here</a>.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp" id="org2facb94">(<span style="font-weight: bold;">use-package</span> eww
  <span style="font-weight: bold;">:commands</span> eww
  <span style="font-weight: bold;">:after</span> my-launch-app
  <span style="font-weight: bold;">:bind</span> (<span style="font-weight: bold;">:map</span> my/invoke-list-command-map
              (<span style="font-style: italic;">"B"</span> . eww-list-bookmarks)
              <span style="font-weight: bold;">:map</span> my/launch-app-map
              (<span style="font-style: italic;">"W"</span> . eww-switch-to-buffer))
  <span style="font-weight: bold;">:custom</span>
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">set enough large column number to prevent from inserting line break</span>
  (eww-header-line-format nil)
  (eww-browse-url-new-window-is-tab nil)
  (eww-auto-rename-buffer 'title)
  (eww-buffer-name-length 20)
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">bind-keys</span> <span style="font-weight: bold;">:map</span> eww-mode-map
             (<span style="font-style: italic;">"C"</span> . eww-set-character-encoding)
             (<span style="font-style: italic;">"C-j"</span> . eww-follow-link)
             (<span style="font-style: italic;">"T"</span> . eww-goto-title-heading)
             (<span style="font-style: italic;">"L"</span> . my/eww-goto-heading)
             (<span style="font-style: italic;">"O"</span> . my/eww-view-in-org)
             <span style="font-weight: bold;">:map</span> eww-bookmark-mode-map
             (<span style="font-style: italic;">"C-j"</span> . eww-bookmark-browse))
  (<span style="font-weight: bold;">with-eval-after-load</span> 'consult
    (<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">consult--source-eww</span>
      (list <span style="font-weight: bold;">:name</span>     <span style="font-style: italic;">"Eww"</span>
            <span style="font-weight: bold;">:narrow</span>   ?w
            <span style="font-weight: bold;">:action</span>   (<span style="font-weight: bold;">lambda</span> (bm)
                        (eww-browse-url (get-text-property 0 'url bm)))
            <span style="font-weight: bold;">:items</span>    (<span style="font-weight: bold;">lambda</span> ()
                        (eww-read-bookmarks)
                        (mapcar (<span style="font-weight: bold;">lambda</span> (bm)
                                  (propertize
                                   (format <span style="font-style: italic;">"%s (%s)"</span>
                                           (plist-get bm <span style="font-weight: bold;">:url</span>)
                                           (plist-get bm <span style="font-weight: bold;">:title</span>))
                                   'url (plist-get bm <span style="font-weight: bold;">:url</span>)))
                                eww-bookmarks))))
    (add-to-list 'consult-buffer-sources 'consult--source-eww 'append)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/eww-view-in-org</span> ()
  <span style="font-style: italic;">"Convert current html page into one org file and show it.</span>

<span style="font-style: italic;">This is handy if you would like to check a page index comfortably."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">let</span> ((source (plist-get eww-data <span style="font-weight: bold;">:source</span>))
        (src-html (make-temp-file <span style="font-style: italic;">"source-"</span>))
        (dst-org (expand-file-name
                  (format <span style="font-style: italic;">"&lt;&lt;eww-org-dir()&gt;&gt;/%s.org"</span> (org-id-uuid))))
        (coding-system-for-write 'utf-8-unix)
        (org-startup-folded t))
    (<span style="font-weight: bold;">with-temp-buffer</span>
      (insert source)
      (make-directory
       (file-name-directory (directory-file-name dst-org)) t)
      (write-region (point-min) (point-max) src-html nil)
      (call-process-shell-command (format <span style="font-style: italic;">"pandoc %s -f html -t org -o %s"</span>
                                          (shell-quote-argument src-html)
                                          (shell-quote-argument dst-org)))
      (delete-file src-html))
    (find-file dst-org t)
    (goto-char (point-min))
    (org-ctrl-c-tab)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">eww-headings-dom</span> ()
  <span style="font-style: italic;">"Return heading list as a dom from xml."</span>
  (<span style="font-weight: bold;">let</span> ((source (plist-get eww-data <span style="font-weight: bold;">:source</span>))
        (dom nil))
    (<span style="font-weight: bold;">with-temp-buffer</span>
      (<span style="font-weight: bold;">let</span> ((source-file (make-temp-file <span style="font-style: italic;">"source-"</span>))
            (coding-system-for-write 'utf-8-unix))
        (insert source)
        (write-region (point-min) (point-max) source-file nil)
        (erase-buffer)
        (call-process <span style="font-style: italic;">"extract_headings"</span> source-file t)
        (delete-file source-file)
        (libxml-parse-xml-region (point-min) (point-max))))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">eww-goto-title-heading</span> ()
  <span style="font-style: italic;">"Set point to a line which contaings the possible heading."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">when-let*</span> ((headings-dom (eww-headings-dom))
              (possible-heading (cl-reduce (<span style="font-weight: bold;">lambda</span> (node-a node-b)
                                             (<span style="font-weight: bold;">if</span> (not (<span style="font-weight: bold;">bound-and-true-p</span> node-a))
                                                 (<span style="font-weight: bold;">if</span> (not (<span style="font-weight: bold;">bound-and-true-p</span> node-b))
                                                     nil
                                                   node-b)
                                               (<span style="font-weight: bold;">if</span> (&gt;= (string-to-number (<span style="font-weight: bold;">dom-attr</span> node-a 'proximity))
                                                       (string-to-number (<span style="font-weight: bold;">dom-attr</span> node-b 'proximity)))
                                                   node-a node-b)))
                                           (dom-children headings-dom)
                                           <span style="font-weight: bold;">:initial-value</span> nil))
              (possible-text (dom-text possible-heading))
              (match-pos (<span style="font-weight: bold;">or</span> (re-search-forward (format <span style="font-style: italic;">"^*?[[:blank:]]*%s[[:blank:]]*$"</span> (regexp-quote possible-text)) nil t 1)
                             (re-search-backward (format <span style="font-style: italic;">"^*?[[:blank:]]*%s[[:blank:]]*$"</span> (regexp-quote possible-text)) nil t 1))))
    (beginning-of-line)
    (recenter-top-bottom 0)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/eww-goto-heading</span> ()
  <span style="font-style: italic;">"Go to selected heading line."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">setq</span> lexical-binding t)
  (<span style="font-weight: bold;">when-let*</span> ((headings-root (eww-headings-dom))
              (cur-buf (current-buffer))
              (heading (completing-read
                        <span style="font-style: italic;">"Heading : "</span>
                        (mapcar (<span style="font-weight: bold;">lambda</span> (heading-node)
                                  (<span style="font-weight: bold;">when-let*</span> ((heading (dom-text heading-node))
                                              (tag (symbol-name (dom-tag heading-node)))
                                              (match-pos (string-match <span style="font-style: italic;">"h</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">[1-6]\\{</span><span style="font-weight: bold; font-style: italic;">1\\</span><span style="font-style: italic;">}</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">"</span> tag))
                                              (indent (- (string-to-number (match-string 1 tag)) 1)))
                                    (format <span style="font-style: italic;">"%s%s"</span>
                                            (apply 'concat (make-list indent <span style="font-style: italic;">"  "</span>))
                                            heading)))
                                (dom-children headings-root))))
              (match (string-match <span style="font-style: italic;">"</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(?:</span><span style="font-style: italic;">  </span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">*</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">.*</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">"</span> heading))
              (heading (match-string 1 heading))
              (match-pos (<span style="font-weight: bold;">or</span> (re-search-forward (build-regex heading) nil t 1)
                             (re-search-backward (build-regex heading) nil t 1))))
    (<span style="font-weight: bold;">with-current-buffer</span> cur-buf
      (switch-to-buffer cur-buf)
      (beginning-of-line)
      (recenter-top-bottom 0))))

(<span style="font-weight: bold;">defmacro</span> <span style="font-weight: bold;">build-regex</span> (str)
  <span style="font-style: italic;">"Return a regexp representation for `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">STR</span><span style="font-style: italic;">'."</span>
  `(format <span style="font-style: italic;">"^[[:blank:]SVG Image]*%s[[:blank:]]*$"</span>
           ,str))
</pre>
</div>
</div>

<ul class="org-ul">
<li><a id="orgaa8e50c"></a>extract<sub>headings</sub><br />
<div class="outline-text-6" id="text-orgaa8e50c">
<div class="org-src-container">
<pre class="src src-python"><span style="font-weight: bold;">import</span> sys
<span style="font-weight: bold;">import</span> lxml.html <span style="font-weight: bold;">as</span> html
<span style="font-weight: bold;">from</span> lxml <span style="font-weight: bold;">import</span> etree
<span style="font-weight: bold;">import</span> difflib

<span style="font-weight: bold;">if</span> <span style="font-weight: bold;">len</span>(sys.argv) == 1:
    <span style="font-weight: bold; font-style: italic;">INPUT_STR</span> = sys.stdin.read()
    <span style="font-weight: bold; font-style: italic;">ROOT</span> = html.fromstring(INPUT_STR).getroottree()
<span style="font-weight: bold;">else</span>:
    sys.<span style="font-weight: bold; text-decoration: underline;">exit</span>(1)

<span style="font-weight: bold; font-style: italic;">OUT_ROOT</span> = etree.Element(<span style="font-style: italic;">"headings"</span>)

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">extract title text</span>
<span style="font-weight: bold; font-style: italic;">title</span> = <span style="font-style: italic;">''</span>
<span style="font-weight: bold; font-style: italic;">title_text_arr</span> = ROOT.xpath(<span style="font-style: italic;">'//title[1]//text()'</span>)
<span style="font-weight: bold;">if</span> <span style="font-weight: bold;">len</span>(title_text_arr):
    <span style="font-weight: bold; font-style: italic;">title</span> = title_text_arr[0]
    OUT_ROOT.<span style="font-weight: bold;">set</span>(<span style="font-style: italic;">"title"</span>, title.strip())

<span style="font-weight: bold; font-style: italic;">htag_text_arr</span> = ROOT.xpath(<span style="font-style: italic;">'//*[self::h1 or self::h2 or self::h3 or self::h4 or self::h5 or self::h6]'</span>)
<span style="font-weight: bold;">for</span> i <span style="font-weight: bold;">in</span> <span style="font-weight: bold;">range</span>(<span style="font-weight: bold;">len</span>(htag_text_arr)):
    <span style="font-weight: bold; font-style: italic;">text</span> = <span style="font-style: italic;">''</span>
    <span style="font-weight: bold; font-style: italic;">texts</span> = htag_text_arr[i].xpath(<span style="font-style: italic;">'.//text()'</span>)
    <span style="font-weight: bold;">if</span> <span style="font-weight: bold;">len</span>(texts) == 1:
        <span style="font-weight: bold; font-style: italic;">text</span> = texts[0].strip()
    <span style="font-weight: bold;">elif</span> <span style="font-weight: bold;">len</span>(texts) &gt; 1:
        <span style="font-weight: bold; font-style: italic;">text</span> = <span style="font-style: italic;">''</span>.join(<span style="font-weight: bold;">map</span>(<span style="font-weight: bold;">str</span>.strip, texts))
    <span style="font-weight: bold;">else</span>:
        <span style="font-weight: bold;">continue</span>
    <span style="font-weight: bold; font-style: italic;">proximity</span> = difflib.SequenceMatcher(<span style="font-weight: bold; text-decoration: underline;">None</span>, title, text).ratio()
    <span style="font-weight: bold; font-style: italic;">heading</span> = etree.Element(htag_text_arr[i].tag)
    heading.<span style="font-weight: bold; font-style: italic;">text</span> = text
    heading.<span style="font-weight: bold;">set</span>(<span style="font-style: italic;">'proximity'</span>, <span style="font-weight: bold;">str</span>(proximity))
    OUT_ROOT.append(heading)

<span style="font-weight: bold; font-style: italic;">out_root_str</span> = etree.tostring(OUT_ROOT, encoding=<span style="font-style: italic;">'utf-8'</span>, method=<span style="font-style: italic;">'xml'</span>, pretty_print=<span style="font-weight: bold; text-decoration: underline;">True</span>)
<span style="font-weight: bold;">if</span> <span style="font-weight: bold;">type</span>(out_root_str) <span style="font-weight: bold;">is</span> <span style="font-weight: bold;">bytes</span>:
    <span style="font-weight: bold; font-style: italic;">out_root_str</span> = out_root_str.decode()
    <span style="font-weight: bold;">print</span>(out_root_str)
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="orgd705f70"></a>Info<br />
<div class="outline-text-5" id="text-orgd705f70">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> info
  <span style="font-weight: bold;">:custom</span>
  (Info-use-header-line nil)
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">bind-keys</span> <span style="font-weight: bold;">:map</span> Info-mode-map (<span style="font-style: italic;">"a"</span> . info-apropos)))
</pre>
</div>
</div>
</li>

<li><a id="org973b782"></a>Magit<br />
<div class="outline-text-5" id="text-org973b782">
<p>
<a href="https://github.com/magit/magit">Magit</a> is git front end for emacs which is outstandingly powerful.
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-magit"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> magit
  <span style="font-weight: bold;">:commands</span> (magit magit-status magit-dispatch)
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">bind-keys</span> <span style="font-weight: bold;">:map</span> magit-status-mode-map
             (<span style="font-style: italic;">"/"</span> . magit-file-checkout)
             (<span style="font-style: italic;">";"</span> . magit-list-repositories)))
</pre>
</div>
</div>

<ul class="org-ul">
<li><a id="orga66c840"></a>Magit Essentials<br />
<div class="outline-text-6" id="text-orga66c840">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> magit-repos
  <span style="font-weight: bold;">:after</span> magit
  <span style="font-weight: bold;">:custom</span>
  (magit-repository-directories '((<span style="font-style: italic;">"~/git"</span> . 1))))
</pre>
</div>
</div>
</li>

<li><a id="org6a9622f"></a>Magit Revision<br />
<div class="outline-text-6" id="text-org6a9622f">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> magit-diff
  <span style="font-weight: bold;">:after</span> magit
  <span style="font-weight: bold;">:custom</span>
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">%GG denotes signature key info botained by --show-signature option in git log command</span>
  (magit-revision-headers-format
   (mapconcat #'identity
              (list <span style="font-style: italic;">"Author:     %aN &lt;%aE&gt;"</span>
                    <span style="font-style: italic;">"AuthorDate: %ad"</span>
                    <span style="font-style: italic;">"Commit:     %cN &lt;%cE&gt;"</span>
                    <span style="font-style: italic;">"CommitDate: %cd"</span>
                    <span style="font-style: italic;">"%GG"</span>)
              <span style="font-style: italic;">"\n"</span>)))
</pre>
</div>
</div>
</li>

<li><a id="orgc4583cb"></a>Magit Log<br />
<div class="outline-text-6" id="text-orgc4583cb">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> magit-log
  <span style="font-weight: bold;">:after</span> magit
  <span style="font-weight: bold;">:custom</span>
  (magit-log-show-refname-after-summary t))
</pre>
</div>
</div>
</li>

<li><a id="org7fcca69"></a>Magit Wip<br />
<div class="outline-text-6" id="text-org7fcca69">
<p>
The following excerpt is important when trying finer control for git-wip-*-mode.
</p>
<ul class="org-ul">
<li><p>
<a href="magit-wip-mode">magit-wip-mode</a>
</p>
<blockquote>
<p>
For historic reasons this mode is implemented on top of four
other 'magit-wip-*' modes, which can also be used individually,
if you want finer control over when the wip refs are updated;
but that is discouraged.
</p>
</blockquote></li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> magit-wip
  <span style="font-weight: bold;">:after</span> magit
  <span style="font-weight: bold;">:custom</span>
  (magit-wip-merge-branch t)
  <span style="font-weight: bold;">:config</span>
  (magit-wip-after-save-mode 1))
</pre>
</div>
</div>
</li>

<li><a id="org34876de"></a>forge<br />
<div class="outline-text-6" id="text-org34876de">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-forge"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> forge
  <span style="font-weight: bold;">:after</span> magit)
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="orgad34c38"></a>Mu4e<br />
<div class="outline-text-5" id="text-orgad34c38">
<p>
You might need to <a href="https://www.djcbsoftware.nl/code/mu/mu4e/Initializing-the-message-store.html">issue 'mu init' command</a> before initial usage or after upgrading. The command would presumably looks like the following:
</p>
<pre class="example">
mu init --maildir=~/data/share/mail --muhome=~/data/share/mu --my-address=jim@example.com --my-address=bob@example.com
</pre>


<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"mu"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> mu4e
  <span style="font-weight: bold;">:commands</span> (mu4e)
  <span style="font-weight: bold;">:hook</span> (emacs-startup . (<span style="font-weight: bold;">lambda</span> () (mu4e t)))
  <span style="font-weight: bold;">:delight</span>
  (mu4e-main-mode    <span style="font-style: italic;">" MU"</span>)
  (mu4e-headers-mode <span style="font-style: italic;">" MU"</span>)
  (mu4e-view-mode    <span style="font-style: italic;">" MU"</span>)
  (mu4e-compose-mode <span style="font-style: italic;">" MU"</span>)
  <span style="font-weight: bold;">:custom</span>
  (mail-user-agent 'mu4e-user-agent)
  (mu4e-hide-index-messages t)
  (mu4e-context-policy 'pick-first)
  (mu4e-compose-context-policy 'ask)
  (mu4e-update-interval 300)
  (mu4e-split-view 'single-window)
  (mu4e-headers-date-format <span style="font-style: italic;">"%y%m%d"</span>)
  (mu4e-headers-time-format <span style="font-style: italic;">" %R"</span>)
  (mu4e-headers-fields
   '((<span style="font-weight: bold;">:human-date</span> . 6)
     (<span style="font-weight: bold;">:flags</span>      . 3)
     (<span style="font-weight: bold;">:from</span>       . 16)
     (<span style="font-weight: bold;">:subject</span>)))
  (mu4e-search-results-limit 2000)
  (mu4e-headers-advance-after-mark t)
  (mu4e-change-filenames-when-moving t)
  (mu4e-view-show-images t)
  (mu4e-html2text-command (<span style="font-weight: bold;">lambda</span> (msg)
                            (plist-put msg <span style="font-weight: bold;">:body-html</span>
                                       (<span style="font-weight: bold;">with-temp-buffer</span>
                                         (insert (<span style="font-weight: bold;">or</span> (mu4e-message-field msg <span style="font-weight: bold;">:body-html</span>) <span style="font-style: italic;">""</span>))
                                         (shell-command-on-region (point-min) (point-max) <span style="font-style: italic;">"nkf -w -Lu"</span> (current-buffer) t)
                                         (<span style="font-weight: bold;">or</span> (buffer-string) <span style="font-style: italic;">""</span>)))
                            (mu4e-shr2text msg)))
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">bind-keys</span> <span style="font-weight: bold;">:map</span> mu4e-headers-mode-map
             (<span style="font-style: italic;">"C-j"</span> . mu4e-headers-view-message)
             <span style="font-weight: bold;">:map</span> mu4e-view-mode-map
             (<span style="font-style: italic;">"C-j"</span> . push-button)
             (<span style="font-style: italic;">"C-c C-a"</span> . mu4e-view-attachment-action)
             <span style="font-weight: bold;">:map</span> mu4e-compose-mode-map
             (<span style="font-style: italic;">"C-x C-o"</span> . org-mu4e-compose-org-mode))
  (add-to-list 'mu4e-view-actions
               '(<span style="font-style: italic;">"external browser"</span> . mu4e-action-view-in-browser) t)
  (add-to-list 'mu4e-view-actions
               '(<span style="font-style: italic;">"XWidget View"</span> . mu4e-action-view-with-xwidget) t)
  (<span style="font-weight: bold;">when</span> (fboundp 'imagemagick-register-types)
    (imagemagick-register-types)))
</pre>
</div>
</div>

<ul class="org-ul">
<li><a id="org5b7281f"></a>mu4e-alert&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span><br /></li>

<li><a id="org2a38a67"></a>additional tweaks<br />
<div class="outline-text-6" id="text-org2a38a67">
<ul class="org-ul">
<li><p>
file attachment in dired (<a href="https://www.djcbsoftware.nl/code/mu/mu4e/Dired.html">source</a>)
</p>
<pre class="example">
gnus-dired-attach (C-c RET C-a)
</pre>


<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> gnus-dired
  <span style="font-weight: bold;">:after</span> mu4e-compose
  <span style="font-weight: bold;">:hook</span>
  (dired-mode . turn-on-gnus-dired-mode)
  <span style="font-weight: bold;">:custom</span>
  (gnus-dired-mail-mode 'mu4e-user-agent))
</pre>
</div></li>

<li><p>
use contact info from org-contacts
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">with-eval-after-load</span> 'mu4e
  (add-to-list 'mu4e-headers-actions
               '(<span style="font-style: italic;">"Contact to add"</span> . mu4e-action-add-org-contact) t)
  (add-to-list 'mu4e-view-actions
               '(<span style="font-style: italic;">"Contact to add"</span> . mu4e-action-add-org-contact) t)
  (<span style="font-weight: bold;">with-eval-after-load</span> 'org-contacts
    (<span style="font-weight: bold;">setq</span> mu4e-org-contacts-file (car org-contacts-files))))
</pre>
</div></li>
</ul>
</div>
</li>
</ul>
</li>

<li><a id="orgc2ff24f"></a>Elfeed<br />
<div class="outline-text-5" id="text-orgc2ff24f">
<p>
<a href="https://github.com/skeeto/elfeed">Elfeed</a> is a powerful RSS feed reader with tag capability that is one of core software in my input workflow.
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-elfeed"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-style: italic;">"https://github.com/skeeto/elfeed/releases.atom"</span> soft_update)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp" id="org950e1f6">(<span style="font-weight: bold;">use-package</span> elfeed
  <span style="font-weight: bold;">:delight</span>
  (elfeed-show-mode   <span style="font-style: italic;">" EF"</span>)
  (elfeed-search-mode <span style="font-style: italic;">" EF"</span>)
  <span style="font-weight: bold;">:commands</span> elfeed
  <span style="font-weight: bold;">:init</span>
  (<span style="font-weight: bold;">defface</span> <span style="font-weight: bold; font-style: italic;">elfeed-search-unchecked-title-face</span>
    nil
    <span style="font-style: italic;">"Face used in search mode for unchecked entry titles."</span>
    <span style="font-weight: bold;">:group</span> 'elfeed)
  (<span style="font-weight: bold;">defface</span> <span style="font-weight: bold; font-style: italic;">elfeed-search-checked-title-face</span>
    nil
    <span style="font-style: italic;">"Face used in search mode for checked entry titles."</span>
    <span style="font-weight: bold;">:group</span> 'elfeed)
  <span style="font-weight: bold;">:custom-face</span>
  (elfeed-search-title-face ((t (<span style="font-weight: bold;">:foreground</span> <span style="font-style: italic;">"#4D4D4D"</span>))))
  (elfeed-search-unchecked-title-face ((t (<span style="font-weight: bold;">:foreground</span> <span style="font-style: italic;">"cornflowerblue"</span>))))
  (elfeed-search-checked-title-face ((t (<span style="font-weight: bold;">:foreground</span> <span style="font-style: italic;">"darkblue"</span>))))
  <span style="font-weight: bold;">:custom</span>
  (elfeed-use-curl t)
  (elfeed-search-date-format '(<span style="font-style: italic;">"%Y%m%d"</span> 8 <span style="font-weight: bold;">:left</span>))
  (elfeed-search-title-min-width 100)
  (elfeed-search-title-max-width 120)
  (elfeed-search-trailing-width 160)
  (elfeed-sort-order 'ascending)
  (elfeed-enclosure-default-dir <span style="font-style: italic;">"~/Downloads/"</span>)
  (elfeed-save-multiple-enclosures-without-asking t)
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">defalias</span> '<span style="font-weight: bold;">elfeed-search-tag-all-unchecked</span>
    (elfeed-expose #'elfeed-search-tag-all 'unchecked)
    <span style="font-style: italic;">"Add the `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">unchecked</span><span style="font-style: italic;">' tag to all selected entries."</span>)
  (<span style="font-weight: bold;">defalias</span> '<span style="font-weight: bold;">elfeed-search-untag-all-unchecked</span>
    (elfeed-expose #'elfeed-search-untag-all 'unchecked)
    <span style="font-style: italic;">"Remove the `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">unchecked</span><span style="font-style: italic;">' tag from all selected entries."</span>)
  (<span style="font-weight: bold;">defalias</span> '<span style="font-weight: bold;">elfeed-search-tag-all-checked</span>
    (elfeed-expose #'elfeed-search-tag-all 'checked)
    <span style="font-style: italic;">"Add the `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">checked</span><span style="font-style: italic;">' tag to all selected entries."</span>)
  (<span style="font-weight: bold;">defalias</span> '<span style="font-weight: bold;">elfeed-search-untag-all-checked</span>
    (elfeed-expose #'elfeed-search-untag-all 'checked)
    <span style="font-style: italic;">"Remove the `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">checked</span><span style="font-style: italic;">' tag from all selected entries."</span>)
  (<span style="font-weight: bold;">bind-keys</span> <span style="font-weight: bold;">:map</span> elfeed-search-mode-map
             (<span style="font-style: italic;">"C-j"</span> . elfeed-search-show-entry)
             (<span style="font-style: italic;">"M-RET"</span> . elfeed-search-open-url)
             (<span style="font-style: italic;">"C-c C-o"</span> . elfeed-search-open-url)
             (<span style="font-style: italic;">"f"</span> . scroll-up-line)
             (<span style="font-style: italic;">"e"</span> . scroll-down-line)
             (<span style="font-style: italic;">"q"</span> . elfeed-kill-buffer)
             (<span style="font-style: italic;">"Q"</span> . quit-window)
             (<span style="font-style: italic;">"x"</span> . elfeed-search-update--force)
             (<span style="font-style: italic;">"c"</span> . (<span style="font-weight: bold;">lambda</span> () (<span style="font-weight: bold;">interactive</span>)
                      (elfeed-search-untag-all-unread)
                      (<span style="font-weight: bold;">unless</span> (use-region-p) (forward-line -1))
                      (elfeed-search-tag-all-unchecked)))
             (<span style="font-style: italic;">"C"</span> . elfeed-search-untag-all-unchecked)
             (<span style="font-style: italic;">"r"</span> . (<span style="font-weight: bold;">lambda</span> () (<span style="font-weight: bold;">interactive</span>)
                      (elfeed-search-untag-all-unread)
                      (<span style="font-weight: bold;">unless</span> (use-region-p) (forward-line -1))
                      (elfeed-search-untag-all-unchecked)
                      (<span style="font-weight: bold;">unless</span> (use-region-p) (forward-line -1))
                      (elfeed-search-tag-all-checked)
                      (<span style="font-weight: bold;">unless</span> (use-region-p) (forward-line -1))
                      (elfeed-search-tag-all (intern (format-time-string <span style="font-style: italic;">"%Y%m%d"</span>)))))
             (<span style="font-style: italic;">"R"</span> . elfeed-search-untag-all-checked)
             (<span style="font-style: italic;">"d"</span> . elfeed-search-untag-all-unread)
             (<span style="font-style: italic;">"Y"</span> . elfeed-search-download-media)
             (<span style="font-style: italic;">"_"</span> . elfeed-search-show-media-duration))
  (add-to-list 'elfeed-search-face-alist '(unchecked elfeed-search-unchecked-title-face))
  (add-to-list 'elfeed-search-face-alist '(checked elfeed-search-checked-title-face)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">elfeed-search-open-url</span> ()
  <span style="font-style: italic;">"Visit the current entry in your browser using '</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">eww-browse-url</span><span style="font-style: italic;">'."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (elfeed-search-untag-all-unchecked)
  (<span style="font-weight: bold;">unless</span> (use-region-p) (forward-line -1))
  (elfeed-search-tag-all-checked)
  (<span style="font-weight: bold;">unless</span> (use-region-p) (forward-line -1))
  (elfeed-search-tag-all (intern (format-time-string <span style="font-style: italic;">"%Y%m%d"</span>)))
  (<span style="font-weight: bold;">unless</span> (use-region-p) (forward-line -1))
  (elfeed-search-browse-url))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">elfeed-search-download-media</span> ()
  <span style="font-style: italic;">"Downlaod video file."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">let</span> ((entries (elfeed-search-selected)))
    (<span style="font-weight: bold;">cl-loop</span> for entry in entries
             when (<span style="font-weight: bold;">or</span> (caar (elfeed-entry-enclosures entry))
                      (elfeed-entry-link entry))
             do (<span style="font-weight: bold;">let</span> ((title (elfeed-entry-title entry)))
                  (yt-dlp-dispatch-dwim it title)
                  (dispatch-execute-macro)))
    (mapc #'elfeed-search-update-entry entries)
    (<span style="font-weight: bold;">unless</span> (<span style="font-weight: bold;">or</span> elfeed-search-remain-on-entry (use-region-p))
      (forward-line))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">elfeed-search-show-media-duration</span> ()
  <span style="font-style: italic;">"Show duration of media attached to current entry."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">let*</span> ((entry (elfeed-search-selected <span style="font-weight: bold;">:single</span>))
         (url (<span style="font-weight: bold;">or</span> (caar (elfeed-entry-enclosures entry))
                  (elfeed-entry-link entry))))
    (<span style="font-weight: bold;">let</span> ((dispatch-dwim--default-method
           (<span style="font-weight: bold;">lambda</span> (comm) (princ
                       (string-trim
                        (shell-command-to-string comm))))))
      (yt-dlp-dispatch-dwim url nil t)
      (dispatch-execute-macro))))
</pre>
</div>
</div>

<ul class="org-ul">
<li><a id="orgaefa0d5"></a>elfeed-score<br />
<div class="outline-text-6" id="text-orgaefa0d5">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-elfeed-score"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> elfeed-score
  <span style="font-weight: bold;">:after</span> elfeed
  <span style="font-weight: bold;">:custom</span>
  (elfeed-score-score-format '(<span style="font-style: italic;">"%d "</span> 3 <span style="font-weight: bold;">:right</span>))
  (elfeed-score-rule-stats-file
   (no-littering-expand-var-file-name <span style="font-style: italic;">"elfeed/score/stats.el"</span>))
  <span style="font-weight: bold;">:config</span>
  (elfeed-score-enable)
  (<span style="font-weight: bold;">setq</span> elfeed-search-sort-function #'my/elfeed-score-sort-descending)
  (<span style="font-weight: bold;">setq</span> elfeed-search-print-entry-function #'my/elfeed-score-search-print-entry)
  (keymap-set elfeed-search-mode-map <span style="font-style: italic;">"="</span> #'elfeed-score-map)
  <span style="font-weight: bold;">:preface</span>
  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/elfeed-score-sort-descending</span> (a b)
    <span style="font-style: italic;">"Return non-nil if A should sort after B."</span>
    (<span style="font-weight: bold;">let</span> ((a-score (elfeed-score-scoring-get-score-from-entry a))
          (b-score (elfeed-score-scoring-get-score-from-entry b)))
      (<span style="font-weight: bold;">if</span> (&lt; a-score b-score)
          t
        (<span style="font-weight: bold;">let</span> ((a-date (elfeed-entry-date a))
              (b-date (elfeed-entry-date b)))
          (<span style="font-weight: bold;">and</span> (eq a-score b-score) (&lt; a-date b-date))))))
  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/elfeed-score-search-print-entry</span> (entry)
    <span style="font-style: italic;">"Print ENTRY to the buffer with my style."</span>
    (<span style="font-weight: bold;">let*</span> ((date (elfeed-search-format-date (elfeed-entry-date entry)))
           (title (<span style="font-weight: bold;">or</span> (elfeed-meta entry <span style="font-weight: bold;">:title</span>) (elfeed-entry-title entry) <span style="font-style: italic;">""</span>))
           (title-faces (elfeed-search--faces (elfeed-entry-tags entry)))
           (feed (elfeed-entry-feed entry))
           (feed-title
            (<span style="font-weight: bold;">when</span> feed
              (<span style="font-weight: bold;">or</span> (elfeed-meta feed <span style="font-weight: bold;">:title</span>) (elfeed-feed-title feed))))
           (tags (mapcar #'symbol-name (elfeed-entry-tags entry)))
           (tags-str (mapconcat
                      (<span style="font-weight: bold;">lambda</span> (s) (propertize s 'face 'elfeed-search-tag-face))
                      tags <span style="font-style: italic;">","</span>))
           (title-width (- (window-width) 10 elfeed-search-trailing-width))
           (title-column (elfeed-format-column
                          title (elfeed-clamp
                                 elfeed-search-title-min-width
                                 title-width
                                 elfeed-search-title-max-width)
                          <span style="font-weight: bold;">:left</span>))
           (score
            (elfeed-score-format-score
             (elfeed-score-scoring-get-score-from-entry entry))))
      (insert score)
      (<span style="font-weight: bold;">when</span> feed-title
        (insert (propertize (elfeed-format-column feed-title 6 <span style="font-weight: bold;">:left</span>)
                            'face 'elfeed-search-feed-face) <span style="font-weight: bold; font-style: italic;">" "</span><span style="font-weight: bold;">))</span>
      (insert (propertize title-column 'face title-faces 'kbd-help title) <span style="font-style: italic;">" "</span>)
      (insert (propertize date 'face 'elfeed-search-date-face) <span style="font-style: italic;">" "</span>)
      (<span style="font-weight: bold;">when</span> tags
        (insert <span style="font-style: italic;">"("</span> tags-str <span style="font-style: italic;">")"</span>)))))
</pre>
</div>
</div>
</li>

<li><a id="org78e9077"></a>elfeed-org<br />
<div class="outline-text-6" id="text-org78e9077">
<p>
<a href="https://github.com/remyhonig/elfeed-org">elfeed-org</a> allow me to express feeds for elfeed in org file.
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-elfeed-org"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> elfeed-org
  <span style="font-weight: bold;">:after</span> (elfeed org)
  <span style="font-weight: bold;">:init</span>
  (<span style="font-weight: bold;">with-eval-after-load</span> 'denote
    (<span style="font-weight: bold;">setq</span> rmh-elfeed-org-files
          (list (denote-get-path-by-id <span style="font-style: italic;">"20230605T173315"</span>))))
  <span style="font-weight: bold;">:custom</span>
  (rmh-elfeed-org-ignore-tag <span style="font-style: italic;">"ARCHIVE"</span>)
  (rmh-elfeed-org-auto-ignore-invalid-feeds nil)
  <span style="font-weight: bold;">:config</span>
  (elfeed-org))
</pre>
</div>

<p>
Packages managed by other than guix (i.e. straight.el or apt) are encouraged to register feed since updating information channel is desirable to exist.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(advice-add #'rmh-elfeed-org-process
            <span style="font-weight: bold;">:after</span> #'my/elfeed-org-add-feeds)

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/elfeed-org-add-feeds</span> (rmh-elfeed-org-files rmh-elfeed-org-tree-id)
  <span style="font-style: italic;">"Add feeds in addition to feeds in `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">rmh-elfeed-org-files</span><span style="font-style: italic;">'.</span>

<span style="font-style: italic;">This function needs to be invoked after `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">rmh-elfeed-org-process</span><span style="font-style: italic;">' which clear all feeds."</span>
  (<span style="font-weight: bold;">setf</span> elfeed-feeds
        (append elfeed-feeds
                '(<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">s-exps for feeds will be inserted here</span>
                  &lt;&lt;elfeed-feeds&gt;&gt;))))
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="org417e04b"></a>Terminal Emulators<br />
<ul class="org-ul">
<li><a id="orgc37cc6a"></a>shell<br />
<div class="outline-text-6" id="text-orgc37cc6a">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> shell
  <span style="font-weight: bold;">:delight</span> <span style="font-style: italic;">" SM"</span>
  <span style="font-weight: bold;">:commands</span> (shell)
  <span style="font-weight: bold;">:custom</span>
  (shell-has-auto-cd t)
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">bind-keys</span> <span style="font-weight: bold;">:map</span> shell-mode-map
             (<span style="font-style: italic;">"C-j"</span> . comint-send-input)))
</pre>
</div>
</div>
</li>

<li><a id="orgd078af0"></a>term<br />
<div class="outline-text-6" id="text-orgd078af0">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> term
  <span style="font-weight: bold;">:disabled</span> t
  <span style="font-weight: bold;">:delight</span>
  (term-mode <span style="font-style: italic;">" TR"</span>)
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">bind-keys</span> <span style="font-weight: bold;">:map</span> term-mode-map
             (<span style="font-style: italic;">"C-j"</span> . term-send-input)))
</pre>
</div>
</div>
</li>

<li><a id="org34804dd"></a>vterm<br />
<div class="outline-text-6" id="text-org34804dd">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-vterm"</span>
<span style="font-style: italic;">"emacs-multi-vterm"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-style: italic;">"https://github.com/akermu/emacs-libvterm/releases.atom"</span> soft_update)
(<span style="font-style: italic;">"https://github.com/suonlight/multi-vterm/releases.atom"</span> soft_update)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-shell"><span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">function/variable used in libvterm/emacs</span>
<span style="font-weight: bold;">vterm_printf</span>(){
  <span style="font-weight: bold;">if</span> [ -n <span style="font-style: italic;">"$TMUX"</span> ]; <span style="font-weight: bold;">then</span>
    <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Tell tmux to pass the escape sequences through</span>
    <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">(Source: http://permalink.gmane.org/gmane.comp.terminal-emulators.tmux.user/1324)</span>
    printf <span style="font-style: italic;">"\ePtmux;\e\e]%s\007\e\\"</span> <span style="font-style: italic;">"$1"</span>
  <span style="font-weight: bold;">elif</span> [ <span style="font-style: italic;">"${TERM%%-*}"</span> = <span style="font-style: italic;">"screen"</span> ]; <span style="font-weight: bold;">then</span>
    <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">GNU screen (screen, screen-256color, screen-256color-bce)</span>
    printf <span style="font-style: italic;">"\eP\e]%s\007\e\\"</span> <span style="font-style: italic;">"$1"</span>
  <span style="font-weight: bold;">else</span>
    printf <span style="font-style: italic;">"\e]%s\e\\"</span> <span style="font-style: italic;">"$1"</span>
  <span style="font-weight: bold;">fi</span>
}

<span style="font-weight: bold;">vterm_prompt_end</span>(){
  vterm_printf <span style="font-style: italic;">"51;A$(whoami)@$(hostname):$(pwd)"</span>
}

<span style="font-weight: bold; font-style: italic;">PROMPT_COMMAND</span>=<span style="font-style: italic;">'echo -ne "\033]0;${HOSTNAME}:${PWD}\007"'</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> vterm
  <span style="font-weight: bold;">:commands</span> (vterm multi-vterm multi-vterm-next)
  <span style="font-weight: bold;">:bind</span> (<span style="font-weight: bold;">:map</span> vterm-mode-map
              (<span style="font-style: italic;">"C-c M-n"</span> . multi-vterm-next)
              (<span style="font-style: italic;">"C-c M-p"</span> . multi-vterm-prev))
  <span style="font-weight: bold;">:delight</span> <span style="font-style: italic;">" VT"</span>
  <span style="font-weight: bold;">:diminish</span> ((vterm-copy-mode . <span style="font-style: italic;">"vc"</span>))
  <span style="font-weight: bold;">:custom</span>
  (vterm-min-window-width 55)
  (vterm-buffer-name-string <span style="font-style: italic;">"vterm %s"</span>)
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">multi-vterm</span>)
  (<span style="font-weight: bold;">bind-keys</span> <span style="font-weight: bold;">:map</span> vterm-mode-map
             (<span style="font-style: italic;">"C-h"</span> . vterm-send-backspace)
             (<span style="font-style: italic;">"M-h"</span> . vterm-send-meta-backspace)
             (<span style="font-style: italic;">"C-y"</span> . vterm-yank)
             (<span style="font-style: italic;">"M-y"</span> . vterm-yank-pop)
             (<span style="font-style: italic;">"M-l"</span> . nil)
             <span style="font-weight: bold;">:map</span> vterm-copy-mode-map
             (<span style="font-style: italic;">"C-j"</span> . vterm-copy-mode-done))
  (advice-add 'consult-yank-from-kill-ring <span style="font-weight: bold;">:around</span> #'advice/vterm-yank-pop))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/multi-vterm</span> (<span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> arg)
  <span style="font-style: italic;">"Switch between existing vterm buffers.</span>

<span style="font-style: italic;">Spawn a new vterm buffer if there's no available vterm buffer.</span>
<span style="font-style: italic;">If command prefix ARG is simgle `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">C-u</span><span style="font-style: italic;">', spawn a vterm buffer forcibly regardless of condition."</span>
  (<span style="font-weight: bold;">interactive</span> <span style="font-style: italic;">"P"</span>)
  (<span style="font-weight: bold;">if</span> (equal arg '(4))
      (multi-vterm)
    (multi-vterm-next)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">advice/vterm-yank-pop</span> (orig-fun <span style="font-weight: bold; text-decoration: underline;">&amp;rest</span> args)
  (<span style="font-weight: bold;">if</span> (eq major-mode 'vterm-mode)
      (<span style="font-weight: bold;">let</span> ((inhibit-read-only t)
            (yank-undo-function (<span style="font-weight: bold;">lambda</span> (_start _end) (vterm-undo))))
        (<span style="font-weight: bold;">cl-letf</span> (((symbol-function 'insert-for-yank)
                   (<span style="font-weight: bold;">lambda</span> (str) (vterm-send-string str t))))
          (apply orig-fun args)))
    (apply orig-fun args)))
</pre>
</div>
</div>
</li>

<li><a id="orgc4f0e99"></a>Eshell<br />
<div class="outline-text-6" id="text-orgc4f0e99">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> eshell
  <span style="font-weight: bold;">:after</span> my-launch-app
  <span style="font-weight: bold;">:commands</span> (eshell)
  <span style="font-weight: bold;">:bind</span> (<span style="font-weight: bold;">:map</span> my/launch-app-map
              (<span style="font-style: italic;">"e"</span> . eshell))
  <span style="font-weight: bold;">:hook</span>
  (eshell-kill . eshell-command-alert)
  <span style="font-weight: bold;">:custom</span>
  (eshell-prompt-function
   #'(<span style="font-weight: bold;">lambda</span> ()
       (format <span style="font-style: italic;">"[%s]\n%s"</span>
               (eshell/basename (eshell/pwd))
               (<span style="font-weight: bold;">if</span> (= (user-uid) 0) <span style="font-style: italic;">"# "</span> <span style="font-style: italic;">"$ "</span>))))
  (eshell-prompt-regexp <span style="font-style: italic;">"[#$] "</span>)
  (eshell-visual-subcommands '((<span style="font-style: italic;">"git"</span> <span style="font-style: italic;">"log"</span> <span style="font-style: italic;">"diff"</span> <span style="font-style: italic;">"show"</span>)))
  (eshell-scroll-to-bottom-on-input 'this)
  (eshell-history-size 2500)
  (eshell-hist-ignoredups t)
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">em-prompt</span>)
  (<span style="font-weight: bold;">bind-keys</span> <span style="font-weight: bold;">:map</span> eshell-prompt-mode-map
             (<span style="font-style: italic;">"C-h"</span> . delete-backward-char)
             (<span style="font-style: italic;">"M-h"</span> . backward-kill-word))
  (<span style="font-weight: bold;">setq</span> eshell-path-env (getenv <span style="font-style: italic;">"PATH"</span>))
  (<span style="font-weight: bold;">with-eval-after-load</span> 'consult
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">narrow down eshell history using vertico</span>
    (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">em-hist</span> nil t)
      (<span style="font-weight: bold;">bind-keys</span> <span style="font-weight: bold;">:map</span> eshell-hist-mode-map
                 (<span style="font-style: italic;">"C-M-n"</span> . consult-history)))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">eshell-command-alert</span> (process status)
  <span style="font-style: italic;">"Send `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">alert</span><span style="font-style: italic;">' with severity based on STATUS when PROCESS finished."</span>
  (<span style="font-weight: bold;">let*</span> ((cmd (process-command process))
         (buffer (process-buffer process))
         (msg (format <span style="font-style: italic;">"%s: %s"</span> (mapconcat 'identity cmd <span style="font-style: italic;">" "</span>)  status)))
    (<span style="font-weight: bold;">if</span> (string-prefix-p <span style="font-style: italic;">"finished"</span> status)
        (alert msg <span style="font-weight: bold;">:buffer</span> buffer <span style="font-weight: bold;">:severity</span>  'normal)
      (alert msg <span style="font-weight: bold;">:buffer</span> buffer <span style="font-weight: bold;">:severity</span> 'urgent))))
</pre>
</div>
</div>

<ul class="org-ul">
<li><a id="org0d38ee7"></a>Eshell Aliases<br />
<div class="outline-text-7" id="text-org0d38ee7">
<p>
Aliases for Eshell are shared with Bash.
</p>

<div class="org-src-container">
<pre class="src src-conf">alias v view-file $1
alias vo view-file-other-window $1
<span style="font-weight: bold; font-style: italic;">alias &lt;&lt;print-aliases(lang</span>=<span style="font-style: italic;">"plain"</span>)&gt;&gt;
</pre>
</div>
</div>
</li>
</ul>
</li>
</ul>
</li>

<li><a id="orga6112ff"></a>Org Mode<br />
<div class="outline-text-5" id="text-orga6112ff">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-org"</span>
<span style="font-style: italic;">"tree-sitter-org"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-style: italic;">"https://updates.orgmode.org/feed/releases"</span> soft_update)
</pre>
</div>

<p>
Basic settings for built-in Org features. Similar to <a href="#orge23ab83">this section</a>, all entries obey customize group hierarchy for Org mode.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> org
  <span style="font-weight: bold;">:mode</span> (<span style="font-style: italic;">"\\.org$"</span> . org-mode)
  <span style="font-weight: bold;">:init</span>
  (<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my/org-initialized</span> nil
    <span style="font-style: italic;">"Indicator showing whether any org file had opened."</span>)
  (<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my/org-mode-init-hook</span> nil
    <span style="font-style: italic;">"One-off hook run when first org file open."</span>)
  (<span style="font-weight: bold;">setq</span> org-directory <span style="font-style: italic;">"~/org"</span>)
  <span style="font-weight: bold;">:hook</span>
  (org-mode . (<span style="font-weight: bold;">lambda</span> ()
                (<span style="font-weight: bold;">unless</span> my/org-initialized
                  (<span style="font-weight: bold;">setq</span> my/org-initialized t)
                  (run-hooks 'my/org-mode-init-hook)
                  (<span style="font-weight: bold;">provide</span> '<span style="font-weight: bold; text-decoration: underline;">my/org-mode-init</span>)))))

(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my/org-todo-keyword--urgent</span> <span style="font-style: italic;">"UG"</span>
  <span style="font-style: italic;">"TODO keyword acronym standing for '</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">UrGent</span><span style="font-style: italic;">'"</span>)
(put 'my/org-todo-keyword--urgent 'char ?u)
(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my/org-todo-keyword--todo</span> <span style="font-style: italic;">"TD"</span>
  <span style="font-style: italic;">"TODO keyword acronym standing for '</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">ToDo</span><span style="font-style: italic;">'"</span>)
(put 'my/org-todo-keyword--todo 'char ?t)
(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my/org-todo-keyword--next</span> <span style="font-style: italic;">"NX"</span>
  <span style="font-style: italic;">"TODO keyword acronym standing for 'NeXt"</span>)
(put 'my/org-todo-keyword--next 'char ?n)
(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my/org-todo-keyword--in-action</span> <span style="font-style: italic;">"IP"</span>
  <span style="font-style: italic;">"TODO keyword acronym standing for 'In Progress"</span>)
(put 'my/org-todo-keyword--in-action 'char ?i)
(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my/org-todo-keyword--someday</span> <span style="font-style: italic;">"SD"</span>
  <span style="font-style: italic;">"TODO keyword acronym standing for '</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">Someday</span><span style="font-style: italic;">'"</span>)
(put 'my/org-todo-keyword--someday 'char ?s)
(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my/org-done-keyword--done</span> <span style="font-style: italic;">"DN"</span>
  <span style="font-style: italic;">"DONE keyword acronym standing for '</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">DoNe</span><span style="font-style: italic;">'"</span>)
(put 'my/org-done-keyword--done 'char ?d)
(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my/org-done-keyword--cancel</span> <span style="font-style: italic;">"CX"</span>
  <span style="font-style: italic;">"DONE keyword acronym standing for '</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">Cancel</span><span style="font-style: italic;">'"</span>)
(put 'my/org-done-keyword--cancel 'char ?x)
(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my/org-done-keyword--pending</span> <span style="font-style: italic;">"GU"</span>
  <span style="font-style: italic;">"DONE keyword acronym standing for '</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">Given-Up</span><span style="font-style: italic;">'"</span>)
(put 'my/org-done-keyword--pending 'char ?g)

(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my/org-project-tag</span> <span style="font-style: italic;">"project"</span> <span style="font-style: italic;">"A tag for projects"</span>)
</pre>
</div>
</div>

<ul class="org-ul">
<li><a id="org3952d86"></a>org mode keymap<br />
<div class="outline-text-6" id="text-org3952d86">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">with-eval-after-load</span> 'org
  (<span style="font-weight: bold;">let</span> ((map org-mode-map))
    (keymap-set map <span style="font-style: italic;">"C-j"</span> #'org-return)
    (keymap-set map <span style="font-style: italic;">"C-M-j"</span> #'org-return-indent)
    (keymap-set map <span style="font-style: italic;">"M-j"</span> #'org-meta-return)
    (keymap-set map <span style="font-style: italic;">"C-S-p"</span> #'org-previous-item)
    (keymap-set map <span style="font-style: italic;">"C-S-n"</span> #'org-next-item)
    (keymap-set map <span style="font-style: italic;">"C-S-u"</span> #'org-up-element)
    (keymap-set map <span style="font-style: italic;">"C-S-d"</span> #'org-down-element)
    (keymap-set map <span style="font-style: italic;">"C-&lt;"</span> #'org-previous-link)
    (keymap-set map <span style="font-style: italic;">"C-&gt;"</span> #'org-next-link)
    (keymap-set map <span style="font-style: italic;">"C-c @"</span> #'org-mark-element)
    (keymap-set map <span style="font-style: italic;">"C-c C-SPC"</span> #'org-mark-subtree)
    (keymap-set map <span style="font-style: italic;">"C-c C-a"</span> nil)
    (keymap-set map <span style="font-style: italic;">"C-,"</span> nil)
    (keymap-set map <span style="font-style: italic;">"M-h"</span> nil)))
</pre>
</div>
</div>
</li>

<li><a id="orgd5999ec"></a>org core feature setup<br />
<div class="outline-text-6" id="text-orgd5999ec">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"org-macs"</span>
  (<span style="font-weight: bold;">setopt</span> org-sort-function 'org-sort-function-fallback))
</pre>
</div>
</div>

<ul class="org-ul">
<li><a id="org0bad1e6"></a>Org Agenda<br />
<div class="outline-text-7" id="text-org0bad1e6">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> org-agenda
  <span style="font-weight: bold;">:after</span> (org my-org-global-map)
  <span style="font-weight: bold;">:bind</span> (<span style="font-weight: bold;">:map</span> my/org-global-map
              (<span style="font-style: italic;">"a"</span> . org-agenda))
  <span style="font-weight: bold;">:hook</span>
  (org-agenda-mode . (<span style="font-weight: bold;">lambda</span> ()
                       <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">TODO: this can be rewritten with `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">display-buffer</span><span style="font-weight: bold; font-style: italic;">'</span>
                       (delete-other-windows)
                       (org-agenda-to-appt t '((category <span style="font-style: italic;">"appt"</span>)))))
  <span style="font-weight: bold;">:custom</span>
  (org-agenda-files
   `(,(file-name-as-directory
       (file-name-concat org-directory <span style="font-style: italic;">"agenda"</span>))))
  (org-agenda-inhibit-startup t)
  (org-agenda-use-tag-inheritance nil)
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">bind-keys</span> <span style="font-weight: bold;">:map</span> org-agenda-mode-map
             (<span style="font-style: italic;">"C-j"</span> . org-agenda-switch-to)
             (<span style="font-style: italic;">"M"</span> . org-agenda-month-view)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">org-agenda-cmp-latest-clock-log</span> (a b)
  <span style="font-style: italic;">"Compare two org entry A and B in terms of clock log.</span>

<span style="font-style: italic;">This function can be used as `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">org-agenda-cmp-user-defined</span><span style="font-style: italic;">' in `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">org-agenda-sorting-strategy</span><span style="font-style: italic;">'."</span>
  (<span style="font-weight: bold;">let*</span> ((marker-a (get-text-property 1 'org-marker a))
         (time-a (org-get-latest-clock-log-time marker-a))
         (marker-b (get-text-property 1 'org-marker b))
         (time-b (org-get-latest-clock-log-time marker-b)))
    (<span style="font-weight: bold;">if</span> (time-less-p time-a time-b) -1 +1)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">org-clock-sum-all</span> ()
  <span style="font-style: italic;">"Sum the times for all agenda files."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">save-excursion</span>
    (mapc (<span style="font-weight: bold;">lambda</span> (file)
            (<span style="font-weight: bold;">with-current-buffer</span> (<span style="font-weight: bold;">or</span> (org-find-base-buffer-visiting file)
                                     (find-file-noselect file))
              (org-clock-sum)
              (org-clock-sum-today)))
          (org-agenda-files))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">org-get-latest-clock-log-time</span> (pom)
  <span style="font-style: italic;">"Get the latest clock log time stamp in org entry at POM as a time object.</span>

<span style="font-style: italic;">If entry at POM has no clock log time stamp, this function returns 0."</span>
  (<span style="font-weight: bold;">org-with-point-at</span> pom
    (<span style="font-weight: bold;">save-excursion</span>
      (<span style="font-weight: bold;">setq</span> end-of-subtree (org-end-of-subtree))
      (<span style="font-weight: bold;">setq</span> latest-time 0)
      (org-back-to-heading t)
      (org-show-all)
      (<span style="font-weight: bold;">while</span> (re-search-forward org-drawer-regexp end-of-subtree t)
        (<span style="font-weight: bold;">when</span> (string= (match-string 1) (org-clock-drawer-name))
          (<span style="font-weight: bold;">while</span> (<span style="font-weight: bold;">progn</span>
                   (forward-line 1)
                   (<span style="font-weight: bold;">when</span> (org-match-line (concat <span style="font-style: italic;">"^[ \t]*"</span> org-clock-string <span style="font-style: italic;">"[ \t]*"</span> org-tsr-regexp-both))
                     (<span style="font-weight: bold;">setq</span> match-ts
                           (<span style="font-weight: bold;">if</span> (match-string 3)
                               (match-string 3) (match-string 1)))
                     (<span style="font-weight: bold;">when</span> (time-less-p latest-time
                                        (apply 'encode-time (parse-time-string match-ts)))
                       (<span style="font-weight: bold;">setq</span> latest-time (apply 'encode-time (parse-time-string match-ts)))))
                   (not (org-match-line org-clock-drawer-end-re))))))))
  latest-time)
</pre>
</div>
</div>

<ul class="org-ul">
<li><a id="org6c3fd8f"></a>Org Agenda Custom Commands<br />
<div class="outline-text-8" id="text-org6c3fd8f">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">with-eval-after-load</span> 'org-agenda
  (<span style="font-weight: bold;">setopt</span> org-stuck-projects `(,(concat <span style="font-style: italic;">"+"</span> my/org-project-tag)
                               (,my/org-todo-keyword--todo ,my/org-todo-keyword--next ,my/org-todo-keyword--in-action)
                               nil <span style="font-style: italic;">""</span>))
  (<span style="font-weight: bold;">setq</span> org-agenda-custom-commands
        `((<span style="font-style: italic;">"a"</span> <span style="font-style: italic;">"Week-agenda"</span>
           agenda <span style="font-style: italic;">""</span>
           ((org-agenda-skip-function #'my/org-agenda-skip-someday-task)))
          (<span style="font-style: italic;">"l"</span> <span style="font-style: italic;">"Log entries in a week"</span>
           agenda <span style="font-style: italic;">""</span>
           ((org-agenda-skip-function #'my/org-agenda-skip-someday-task)
            (org-agenda-span (<span style="font-weight: bold;">if</span> (equal current-prefix-arg '(4))
                                 'day 'week))
            (org-agenda-start-with-log-mode t)
            (org-agenda-start-with-clockreport-mode t)
            (org-agenda-include-inactive-timestamps nil)
            (org-agenda-include-diary t)
            (org-agenda-sorting-strategy
             '(time-up
               deadline-up
               todo-state-up
               priority-down))))
          (<span style="font-style: italic;">"L"</span> <span style="font-style: italic;">"Log entry timeline on today with default org-agenda-prefix-format"</span>
           agenda <span style="font-style: italic;">""</span>
           ((org-agenda-skip-function #'my/org-agenda-skip-someday-task)
            (org-agenda-prefix-format (eval (car (get 'org-agenda-prefix-format 'standard-value))))
            (org-agenda-span (<span style="font-weight: bold;">if</span> (equal current-prefix-arg '(4))
                                 'day 'week))
            (org-agenda-start-with-clockreport-mode t)
            (org-agenda-start-with-log-mode t)
            (org-agenda-include-inactive-timestamps nil)
            (org-agenda-include-diary t)
            (org-agenda-sorting-strategy
             '(time-up
               deadline-up
               todo-state-up
               priority-down))))
          <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">KEEP IN MIND</span>
          <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">invoking `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">org-clock-sum-all</span><span style="font-weight: bold; font-style: italic;">' is required before showing effort table</span>
          (<span style="font-style: italic;">"e"</span> . <span style="font-style: italic;">"Effort table"</span>)
          (<span style="font-style: italic;">"ei"</span> <span style="font-style: italic;">"today"</span>
           ((org-ql-search-block `(<span style="font-weight: bold;">or</span> (todo ,my/org-todo-keyword--urgent)
                                      (todo ,my/org-todo-keyword--in-action)
                                      (<span style="font-weight: bold;">and</span> (clocked <span style="font-weight: bold;">:on</span> today)
                                           (<span style="font-weight: bold;">or</span> (todo) (done))
                                           (not (habit))
                                           (not (tags <span style="font-style: italic;">"web"</span>))))
                                 ((org-ql-block-header <span style="font-style: italic;">"Today's task"</span>))))
           ((org-agenda-overriding-header <span style="font-style: italic;">"Today's Task"</span>)
            (org-overriding-columns-format <span style="font-style: italic;">"%26ITEM(Task) %Effort(Effort){:} %CLOCKSUM_T(Today){:} %CLOCKSUM(Total)"</span>)
            (org-agenda-view-columns-initially t)
            (org-agenda-sorting-strategy '(todo-state-up priority-down deadline-up))))
          (<span style="font-style: italic;">"eg"</span> <span style="font-style: italic;">"this week"</span>
           ((org-ql-search-block `(<span style="font-weight: bold;">or</span> (todo ,my/org-todo-keyword--urgent)
                                      (todo ,my/org-todo-keyword--next)
                                      (todo ,my/org-todo-keyword--in-action))
                                 ((org-ql-block-header <span style="font-style: italic;">"This Week's task"</span>))))
           ((org-agenda-overriding-header <span style="font-style: italic;">"This Week's Task"</span>)
            (org-overriding-columns-format <span style="font-style: italic;">"%26ITEM(Task) %Effort(Effort){:} %CLOCKSUM_T(Today){:} %CLOCKSUM(Total)"</span>)
            (org-agenda-view-columns-initially t)
            (org-agenda-sorting-strategy '(todo-state-up priority-down deadline-up))))
          (<span style="font-style: italic;">"ed"</span> <span style="font-style: italic;">"done task"</span>
           ((org-ql-search-block `(<span style="font-weight: bold;">or</span> (todo ,my/org-done-keyword--done)
                                      (todo ,my/org-done-keyword--cancel)
                                      (todo ,my/org-done-keyword--pending))
                                 ((org-ql-block-header <span style="font-style: italic;">"Done task"</span>))))
           ((org-agenda-overriding-header <span style="font-style: italic;">"Done Task"</span>)
            (org-overriding-columns-format <span style="font-style: italic;">"%26ITEM(Task) %Effort(Effort){:} %CLOCKSUM(Total){:}"</span>)
            (org-agenda-view-columns-initially t)
            (org-agenda-sorting-strategy '(todo-state-up priority-down deadline-up))))
          (<span style="font-style: italic;">"i"</span> <span style="font-style: italic;">"Today's agenda"</span>
           ((todo <span style="font-style: italic;">"Today's agenda"</span>
                  ((org-agenda-sorting-strategy '(priority-up))))
            (org-ql-search-block `(<span style="font-weight: bold;">or</span> (todo ,my/org-todo-keyword--urgent)
                                      (todo ,my/org-todo-keyword--in-action))
                                 ((org-ql-block-header <span style="font-style: italic;">"Today's task"</span>)))
            (org-ql-search-block `(<span style="font-weight: bold;">and</span> (planning <span style="font-weight: bold;">:on</span> today)
                                       (not (todo ,my/org-todo-keyword--in-action
                                                  ,my/org-done-keyword--done
                                                  ,my/org-done-keyword--cancel
                                                  ,my/org-done-keyword--pending))
                                       (not (tags <span style="font-style: italic;">"web"</span>))
                                       (not (habit))
                                       (not (todo ,my/org-todo-keyword--someday)))
                                 ((org-ql-block-header <span style="font-style: italic;">"Scheduled/Deadlined on today"</span>)))
            (org-ql-search-block `(<span style="font-weight: bold;">and</span> (habit)
                                       (<span style="font-weight: bold;">or</span> (todo ,my/org-todo-keyword--todo)
                                           (todo ,my/org-todo-keyword--next))
                                       (scheduled <span style="font-weight: bold;">:to</span> today)
                                       (not (tags <span style="font-style: italic;">"bad_habit"</span>))
                                       (not (tags-inherited <span style="font-style: italic;">"ARCHIVE"</span>)))
                                 ((org-ql-block-header <span style="font-style: italic;">"Habits to take"</span>)))
            (org-ql-search-block `(<span style="font-weight: bold;">and</span> (ts-active <span style="font-weight: bold;">:on</span> today)
                                       (not (<span style="font-weight: bold;">or</span> (todo ,my/org-todo-keyword--in-action)
                                                (habit) (done)))
                                       (not (todo ,my/org-todo-keyword--someday)))
                                 ((org-ql-block-header <span style="font-style: italic;">"Today's common event"</span>)))
            (org-ql-search-block '(and (done)
                                       (closed <span style="font-weight: bold;">:on</span> today))
                                 ((org-ql-block-header <span style="font-style: italic;">"Completed tasks on today"</span>)))
            (org-ql-search-block '(and (habit)
                                       (last-repeat 0))
                                 ((org-ql-block-header <span style="font-style: italic;">"Completed habits on today"</span>))))
           ((org-agenda-sorting-strategy
             '(todo-state-up priority-down deadline-up))))
          (<span style="font-style: italic;">"n"</span> <span style="font-style: italic;">"This Week's agenda"</span>
           ((org-ql-search-block `(heading ,(format-time-string <span style="font-style: italic;">"%G-W%V"</span>))
                                 ((org-agenda-files `(,(file-name-concat org-directory <span style="font-style: italic;">"archive"</span> (format-time-string <span style="font-style: italic;">"archive_%Y.org"</span>))))
                                  (org-ql-block-header <span style="font-style: italic;">"This week in datetree archive"</span>)))
            (org-ql-search-block `(<span style="font-weight: bold;">or</span> (todo ,my/org-todo-keyword--next))
                                 ((org-ql-block-header <span style="font-style: italic;">"This week's tasks"</span>)))
            (org-ql-search-block `(<span style="font-weight: bold;">or</span> (todo ,my/org-todo-keyword--urgent)
                                      (todo ,my/org-todo-keyword--in-action))
                                 ((org-ql-block-header <span style="font-style: italic;">"Today's tasks"</span>)))
            (org-ql-search-block `(<span style="font-weight: bold;">and</span> (planning <span style="font-weight: bold;">:from</span> 0 <span style="font-weight: bold;">:to</span> 6)
                                       (not (todo ,my/org-todo-keyword--in-action
                                                  ,my/org-done-keyword--done
                                                  ,my/org-done-keyword--cancel
                                                  ,my/org-done-keyword--pending))
                                       (not (tags <span style="font-style: italic;">"web"</span>))
                                       (not (todo ,my/org-todo-keyword--someday))
                                       (not (habit)))
                                 ((org-ql-block-header <span style="font-style: italic;">"Scheduled/Deadlined this week"</span>)))
            (org-ql-search-block `(<span style="font-weight: bold;">and</span> (<span style="font-weight: bold;">and</span> (ts-active <span style="font-weight: bold;">:from</span> 0 <span style="font-weight: bold;">:to</span> 6)
                                            (not (deadline))
                                            (not (scheduled))
                                            (not (closed)))
                                       (not (<span style="font-weight: bold;">or</span> (todo ,my/org-todo-keyword--next
                                                      ,my/org-todo-keyword--in-action)
                                                (done))))
                                 ((org-ql-block-header <span style="font-style: italic;">"This week's common event"</span>))))
           ((org-agenda-sorting-strategy
             '(todo-state-up priority-down deadline-up))))
          (<span style="font-style: italic;">"t"</span> <span style="font-style: italic;">"All tasks"</span>
           ((org-ql-search-block `(todo ,my/org-todo-keyword--urgent)
                                 ((org-ql-block-header <span style="font-style: italic;">"Urgent task"</span>)))
            (org-ql-search-block `(todo ,my/org-todo-keyword--in-action)
                                 ((org-ql-block-header <span style="font-style: italic;">"Today's task"</span>)))
            (org-ql-search-block `(todo ,my/org-todo-keyword--next)
                                 ((org-ql-block-header <span style="font-style: italic;">"This week's task"</span>)))
            (org-ql-search-block `(<span style="font-weight: bold;">and</span> (todo ,my/org-todo-keyword--todo)
                                       (not (habit)))
                                 ((org-ql-block-header <span style="font-style: italic;">"Remaining task"</span>)))))
          (<span style="font-style: italic;">"d"</span> <span style="font-style: italic;">"Done tasks"</span>
           ((org-ql-search-block `(<span style="font-weight: bold;">and</span> (<span style="font-weight: bold;">or</span> (done)
                                           (<span style="font-weight: bold;">and</span> (todo ,my/org-todo-keyword--someday)
                                                (not (path ,(expand-file-name <span style="font-style: italic;">"agenda/somedays.org"</span> org-directory)))))
                                       (not (tags <span style="font-style: italic;">"project"</span>)))
                                 ((org-ql-block-header <span style="font-style: italic;">"Done/Canceled/Pending task"</span>)))))
          (<span style="font-style: italic;">"p"</span> <span style="font-style: italic;">"Projects"</span> tags ,(concat <span style="font-style: italic;">"+"</span> my/org-project-tag))
          (<span style="font-style: italic;">"h"</span> <span style="font-style: italic;">"Habits in consistency graph"</span>
           agenda <span style="font-style: italic;">""</span>
           ((org-agenda-span 'day)
            (org-agenda-use-time-grid nil)
            (org-agenda-prefix-format '((agenda . <span style="font-style: italic;">""</span>)))
            (org-habit-show-all-today t)
            (org-agenda-sorting-strategy '(scheduled-up))
            <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">display habits only</span>
            (org-agenda-skip-function
             (<span style="font-weight: bold;">lambda</span> ()
               (<span style="font-weight: bold;">and</span> (<span style="font-weight: bold;">save-excursion</span>
                      (not (org-is-habit-p)))
                    (<span style="font-weight: bold;">progn</span> (outline-next-heading) (point)))))))
          (<span style="font-style: italic;">"H"</span> <span style="font-style: italic;">"show all habits"</span>
           ((org-ql-search-block '(habit)
                                 ((org-ql-block-header <span style="font-style: italic;">"All Habits"</span>))))
           ((org-agenda-sorting-strategy '(scheduled-up)))))))
</pre>
</div>
</div>
</li>

<li><a id="org3f80fbe"></a>Org Agenda Daily/Weekly<br />
<div class="outline-text-8" id="text-org3f80fbe">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">with-eval-after-load</span> 'org-agenda
  (<span style="font-weight: bold;">setopt</span> org-agenda-start-on-weekday 1)
  (<span style="font-weight: bold;">setopt</span> org-agenda-skip-deadline-if-done t)
  (<span style="font-weight: bold;">setopt</span> org-agenda-include-diary t)
  (<span style="font-weight: bold;">setopt</span> org-agenda-dim-blocked-tasks nil))
</pre>
</div>
</div>
</li>

<li><a id="orgcd130f7"></a>Org Agenda Line Format<br />
<div class="outline-text-8" id="text-orgcd130f7">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">with-eval-after-load</span> 'org-agenda
  (<span style="font-weight: bold;">setq</span> org-agenda-prefix-format '((agenda   . <span style="font-style: italic;">"%?-12t% s"</span>)
                                   (timeline . <span style="font-style: italic;">"  %s"</span>)
                                   (todo     . <span style="font-style: italic;">" "</span>)
                                   (tags     . <span style="font-style: italic;">" "</span>)
                                   (search   . <span style="font-style: italic;">" "</span>))))
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="org8e88744"></a>Org Capture<br />
<div class="outline-text-7" id="text-org8e88744">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> org-capture
  <span style="font-weight: bold;">:after</span> (org my-org-global-map)
  <span style="font-weight: bold;">:bind</span> (<span style="font-weight: bold;">:map</span> my/org-global-map
              (<span style="font-style: italic;">"c"</span> . org-capture))
  <span style="font-weight: bold;">:hook</span>
  (org-capture-mode . delete-other-windows)
  <span style="font-weight: bold;">:custom</span>
  (org-reverse-note-order nil)
  (org-capture-bookmark nil)
  (org-capture-templates
   `((<span style="font-style: italic;">"e"</span> <span style="font-style: italic;">"Entry"</span>
      entry (id <span style="font-style: italic;">"58e12e3e-da50-4089-9d22-565986637121"</span>)
      ,(concat <span style="font-style: italic;">"* [heading]\n%a\n"</span>
               <span style="font-style: italic;">"%(and (length&gt; \"%i\" 0)</span>
<span style="font-style: italic;">(format \"#+begin_</span><span style="font-weight: bold; font-style: italic;">\</span><span style="font-style: italic;">%1$s\n</span><span style="font-weight: bold; font-style: italic;">\</span><span style="font-style: italic;">%2$s#+end_%1$s\n\"</span>
<span style="font-style: italic;">\"text\"</span>
<span style="font-style: italic;">(replace-regexp-in-string \"^*\" \",*\" \"%i\")))"</span>))
     (<span style="font-style: italic;">"t"</span> <span style="font-style: italic;">"Task"</span>
      entry (id <span style="font-style: italic;">"58e12e3e-da50-4089-9d22-565986637121"</span>)
      ,(format <span style="font-style: italic;">"* %s %%?\n"</span>
               my/org-todo-keyword--todo))
     (<span style="font-style: italic;">"p"</span> <span style="font-style: italic;">"Project"</span>
      entry (id <span style="font-style: italic;">"58e12e3e-da50-4089-9d22-565986637121"</span>)
      <span style="font-style: italic;">"* %? [/] :project:\n"</span>
      <span style="font-weight: bold;">:jump-to-captured</span> t)
     (<span style="font-style: italic;">"M"</span> <span style="font-style: italic;">"Append memo to clocking task"</span>
      item (clock)
      <span style="font-style: italic;">"- %i%?"</span>))))
</pre>
</div>
</div>
</li>

<li><a id="org2ea405c"></a>Org Startup<br />
<div class="outline-text-7" id="text-org2ea405c">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">setopt</span> org-startup-folded 'fold)
(<span style="font-weight: bold;">setopt</span> org-startup-truncated t)
(<span style="font-weight: bold;">setopt</span> org-startup-with-inline-images t)
(<span style="font-weight: bold;">setopt</span> org-cycle-hide-drawer-startup t)

<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">allow _{}/^{} format for sub/super script</span>
(<span style="font-weight: bold;">setopt</span> org-use-sub-superscripts '{})
</pre>
</div>
</div>
</li>

<li><a id="orgd08faf9"></a>Org TODO<br />
<div class="outline-text-7" id="text-orgd08faf9">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">setopt</span> org-enforce-todo-dependencies t)
(<span style="font-weight: bold;">setopt</span> org-todo-keywords
        `((sequence ,(format <span style="font-style: italic;">"%s(%c)"</span> my/org-todo-keyword--todo
                             (get 'my/org-todo-keyword--todo 'char))
                    ,(format <span style="font-style: italic;">"%s(%c)"</span> my/org-todo-keyword--urgent
                             (get 'my/org-todo-keyword--urgent 'char))
                    ,(format <span style="font-style: italic;">"%s(%c)"</span> my/org-todo-keyword--next
                             (get 'my/org-todo-keyword--next 'char))
                    ,(format <span style="font-style: italic;">"%s(%c)"</span> my/org-todo-keyword--in-action
                             (get 'my/org-todo-keyword--in-action 'char))
                    ,(format <span style="font-style: italic;">"%s(%c!/!)"</span> my/org-todo-keyword--someday
                             (get 'my/org-todo-keyword--someday 'char))
                    <span style="font-style: italic;">"|"</span>
                    ,(format <span style="font-style: italic;">"%s(%c!/@)"</span> my/org-done-keyword--done
                             (get 'my/org-done-keyword--done 'char))
                    ,(format <span style="font-style: italic;">"%s(%c!/@)"</span> my/org-done-keyword--cancel
                             (get 'my/org-done-keyword--cancel 'char))
                    ,(format <span style="font-style: italic;">"%s(%c!/@)"</span> my/org-done-keyword--pending
                             (get 'my/org-done-keyword--pending 'char)))))
(<span style="font-weight: bold;">setopt</span> org-todo-keyword-faces
        `((,my/org-todo-keyword--urgent    . <span style="font-style: italic;">"red1"</span>)
          (,my/org-todo-keyword--todo      . <span style="font-style: italic;">"DeepPink1"</span>)
          (,my/org-todo-keyword--next      . <span style="font-style: italic;">"green1"</span>)
          (,my/org-todo-keyword--in-action . <span style="font-style: italic;">"DodgerBlue1"</span>)
          (,my/org-todo-keyword--someday   . <span style="font-style: italic;">"SpringGreen"</span>)
          (,my/org-done-keyword--done      . <span style="font-style: italic;">"gray30"</span>)
          (,my/org-done-keyword--cancel    . <span style="font-style: italic;">"dark gray"</span>)
          (,my/org-done-keyword--pending   . <span style="font-style: italic;">"sea green"</span>)))
(<span style="font-weight: bold;">setopt</span> org-log-into-drawer t
        org-log-states-order-reversed t
        org-log-note-clock-out nil
        org-log-done 'time
        org-log-refile 'time
        org-log-reschedule nil
        org-log-redeadline 'time
        org-closed-keep-when-no-todo nil)
</pre>
</div>
</div>
</li>

<li><a id="orge498349"></a>Org Structure<br />
<div class="outline-text-7" id="text-orge498349">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> org-indent
  <span style="font-weight: bold;">:after</span> org
  <span style="font-weight: bold;">:bind</span> (<span style="font-weight: bold;">:map</span> org-mode-map
              (<span style="font-style: italic;">"C-c C-M-i"</span> . org-indent-mode))
  <span style="font-weight: bold;">:hook</span> (org-mode . org-indent-mode)
  <span style="font-weight: bold;">:custom</span>
  (org-startup-indented t)
  (org-bookmark-names-plist nil)
  (org-insert-heading-respect-content t)
  (org-M-RET-may-split-line '((default . nil))))

(<span style="font-weight: bold;">use-package</span> org-keys
  <span style="font-weight: bold;">:after</span> org
  <span style="font-weight: bold;">:custom</span>
  (org-use-speed-commands
   (<span style="font-weight: bold;">lambda</span> () (<span style="font-weight: bold;">and</span> (looking-at org-outline-regexp) (looking-back <span style="font-style: italic;">"^</span><span style="font-weight: bold; font-style: italic;">\</span><span style="font-style: italic;">**"</span>))))
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">cl-labels</span> ((os-set (key command)
                (assoc-delete-all key org-speed-commands)
                (add-to-list 'org-speed-commands
                             (cons key command)
                             t)))
    (add-to-list 'org-speed-commands '(<span style="font-style: italic;">"Additional"</span>) t)
    (os-set <span style="font-style: italic;">"k"</span> nil)                    <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">prevent from inadvertent org tree loss</span>
    (os-set <span style="font-style: italic;">"j"</span> #'org-insert-heading)
    (os-set <span style="font-style: italic;">"P"</span> #'org-set-property)
    (os-set <span style="font-style: italic;">"C"</span> #'org-clone-subtree-with-time-shift)
    (os-set <span style="font-style: italic;">"s"</span> #'org-schedule)
    (os-set <span style="font-style: italic;">"d"</span> #'org-deadline)
    (os-set <span style="font-style: italic;">"N"</span> #'org-toggle-narrow-to-subtree)
    (os-set <span style="font-style: italic;">"$"</span> #'org-archive-subtree)
    (os-set <span style="font-style: italic;">"'"</span> #'ignore)))
</pre>
</div>
</div>

<ul class="org-ul">
<li><a id="org1165cd8"></a>Org Edit Structure<br />
<div class="outline-text-8" id="text-org1165cd8">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> org-src
  <span style="font-weight: bold;">:after</span> org
  <span style="font-weight: bold;">:hook</span> (org-src-mode . (<span style="font-weight: bold;">lambda</span> ()
                          (<span style="font-weight: bold;">setq-local</span> auto-save-visited-mode nil)
                          (<span style="font-weight: bold;">setq-local</span> buffer-save-without-query t)
                          (<span style="font-weight: bold;">when</span> (eq major-mode 'text-mode)
                            (visual-line-mode 1))))
  <span style="font-weight: bold;">:custom</span>
  (org-special-ctrl-a/e t)
  (org-src-window-setup 'current-window)
  (org-edit-src-content-indentation 0)
  (org-edit-src-turn-on-auto-save nil)
  (org-edit-src-auto-save-idle-delay 30)
  (org-edit-src-persistent-message nil)
  (org-src-ask-before-returning-to-edit-buffer nil)
  (org-special-ctrl-k t)
  (org-ctrl-k-protect-subtree t)
  (org-src-lang-modes
   (mapc (<span style="font-weight: bold;">lambda</span> (override-src-lang)
           (add-to-list 'org-src-lang-modes override-src-lang))
         '((<span style="font-style: italic;">"bash"</span>   . bash-ts)
           (<span style="font-style: italic;">"C"</span>      . c)
           (<span style="font-style: italic;">"ruby"</span>   . ruby)
           (<span style="font-style: italic;">"python"</span> . python-ts)
           (<span style="font-style: italic;">"java"</span>   . java)
           (<span style="font-style: italic;">"rust"</span>   . rust)
           (<span style="font-style: italic;">"lua"</span>    . lua)
           (<span style="font-style: italic;">"css"</span>    . css-ts)
           (<span style="font-style: italic;">"json"</span>   . json-ts)
           (<span style="font-style: italic;">"dot"</span>    . graphviz-dot)
           (<span style="font-style: italic;">"yaml"</span>   . yaml-ts))))
  <span style="font-weight: bold;">:config</span>
  (mapc (<span style="font-weight: bold;">lambda</span> (temp-cons)
          (<span style="font-weight: bold;">if-let</span> ((place (assoc (car temp-cons) org-structure-template-alist)))
              (<span style="font-weight: bold;">setf</span> (cdr (assoc (car temp-cons) org-structure-template-alist)) (cdr temp-cons))
            (add-to-list 'org-structure-template-alist temp-cons t)))
        '((<span style="font-style: italic;">"sh"</span> . <span style="font-style: italic;">"src shell"</span>)
          (<span style="font-style: italic;">"tx"</span> . <span style="font-style: italic;">"src text"</span>)
          (<span style="font-style: italic;">"el"</span> . <span style="font-style: italic;">"src emacs-lisp"</span>)
          (<span style="font-style: italic;">"py"</span> . <span style="font-style: italic;">"src python"</span>)))
  (advice-add #'org-edit-src-save
              <span style="font-weight: bold;">:before</span>
              (<span style="font-weight: bold;">lambda</span> (<span style="font-weight: bold; text-decoration: underline;">&amp;rest</span> _)
                (delete-trailing-whitespace))))
</pre>
</div>
</div>
</li>

<li><a id="org12c4e0a"></a>Org Plain lists<br />
<div class="outline-text-8" id="text-org12c4e0a">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">setopt</span> org-list-demote-modify-bullet
        '((<span style="font-style: italic;">"-"</span> . <span style="font-style: italic;">"+"</span>) (<span style="font-style: italic;">"+"</span> . <span style="font-style: italic;">"-"</span>) (<span style="font-style: italic;">"*"</span> . <span style="font-style: italic;">"-"</span>)
          (<span style="font-style: italic;">"1."</span> . <span style="font-style: italic;">"1)"</span>) (<span style="font-style: italic;">"1)"</span> . <span style="font-style: italic;">"1."</span>) (<span style="font-style: italic;">"*"</span> . <span style="font-style: italic;">"1."</span>))
        org-cycle-include-plain-lists 'integrate
        org-list-use-circular-motion t
        org-list-allow-alphabetical t)
</pre>
</div>
</div>
</li>

<li><a id="org34df7aa"></a>Org Archive<br />
<div class="outline-text-8" id="text-org34df7aa">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> org-archive
  <span style="font-weight: bold;">:defer</span> t
  <span style="font-weight: bold;">:custom</span>
  (org-archive-default-command 'org-toggle-archive-tag))

(<span style="font-weight: bold;">setopt</span> org-cycle-open-archived-trees t)
</pre>
</div>
</div>
</li>

<li><a id="orgfc90284"></a>Org Inline Tasks<br />
<div class="outline-text-8" id="text-orgfc90284">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> org-inlinetask
  <span style="font-weight: bold;">:commands</span> (org-inlinetask-insert-task
             org-inlinetask-promote
             org-inlinetask-demote)
  <span style="font-weight: bold;">:custom</span>
  (org-inlinetask-default-state my/org-todo-keyword--todo)
  (org-inlinetask-min-level 10))
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="org10e4b57"></a>Org Tags<br />
<div class="outline-text-7" id="text-org10e4b57">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">with-eval-after-load</span> 'org
  (<span style="font-weight: bold;">setopt</span> org-use-tag-inheritance org-archive-tag
          org-tags-column -57
          org-tags-sort-function #'org-string-collate-greaterp))
</pre>
</div>
</div>
</li>

<li><a id="orgc6235ff"></a>Org Properties<br />
<div class="outline-text-7" id="text-orgc6235ff">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">setopt</span> org-use-property-inheritance <span style="font-style: italic;">"TIMELIMIT.*"</span>
        org-highest-priority ?A
        org-lowest-priority ?Z
        org-default-priority ?E
        org-global-properties
        '((<span style="font-style: italic;">"Effort_ALL"</span>. <span style="font-style: italic;">"0 0:10 0:20 0:30 1:00 1:30 2:00 3:00 4:00 6:00 8:00"</span>)))
</pre>
</div>
</div>
</li>

<li><a id="org108e9fb"></a>Org Refile<br />
<div class="outline-text-7" id="text-org108e9fb">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> org-refile
  <span style="font-weight: bold;">:after</span> (org denote)
  <span style="font-weight: bold;">:commands</span> (org-refile)
  <span style="font-weight: bold;">:custom</span>
  (org-refile-targets
   `((org-agenda-files <span style="font-weight: bold;">:tag</span> . ,my/org-project-tag)
     (org-agenda-files <span style="font-weight: bold;">:tag</span> . <span style="font-style: italic;">"refile"</span>)
     (,(cl-remove-if-not (<span style="font-weight: bold;">lambda</span> (f)
                           (member <span style="font-style: italic;">"refile"</span>
                                   (denote-extract-keywords-from-path f)))
                         (denote-directory-files))
      <span style="font-weight: bold;">:tag</span> . <span style="font-style: italic;">"refile"</span>))))
</pre>
</div>
</div>
</li>

<li><a id="org6ec1110"></a>Org Time<br />
<div class="outline-text-7" id="text-org6ec1110">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">setopt</span> org-time-stamp-custom-formats
        '(<span style="font-style: italic;">"&lt;%m-%d %a&gt;"</span> . <span style="font-style: italic;">"&lt;%H:%M&gt;"</span>))
</pre>
</div>
</div>

<ul class="org-ul">
<li><a id="org59eb087"></a>Org Progress<br />
<ul class="org-ul">
<li><a id="org87a21ff"></a>Org Habit<br />
<div class="outline-text-9" id="text-org87a21ff">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> org-habit
  <span style="font-weight: bold;">:after</span> my/org-mode-init
  <span style="font-weight: bold;">:custom</span>
  (org-habit-graph-column 32)
  (org-habit-preceding-days 21)
  (org-habit-following-days 14)
  (org-habit-show-habits-only-for-today t))
</pre>
</div>
</div>
</li>

<li><a id="org8e756e5"></a>Org Clock<br />
<div class="outline-text-9" id="text-org8e756e5">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> org-clock
  <span style="font-weight: bold;">:after</span> (org my-org-global-map)
  <span style="font-weight: bold;">:custom</span>
  (org-clock-into-drawer <span style="font-style: italic;">"CLOCK"</span>)
  (org-clock-out-when-done t)
  (org-clock-out-remove-zero-time-clocks t)
  (org-clock-persist t)
  (org-clock-persist-query-resume nil)
  (org-clock-string-limit 20)
  (org-clock-continuously t)
  (org-clock-ask-before-exiting nil)
  <span style="font-weight: bold;">:config</span>
  (org-clock-persistence-insinuate)
  (<span style="font-weight: bold;">bind-keys</span> <span style="font-weight: bold;">:map</span> my/org-global-map
             (<span style="font-style: italic;">"j"</span> . org-clock-goto)
             (<span style="font-style: italic;">"I"</span> . org-clock-in)
             (<span style="font-style: italic;">"O"</span> . org-clock-out)
             (<span style="font-style: italic;">"X"</span> . org-clock-cancel))
  (<span style="font-weight: bold;">with-eval-after-load</span> 'org-keys
    (<span style="font-weight: bold;">dolist</span> (elt '((<span style="font-style: italic;">"Clock Commands"</span>)
                   (<span style="font-style: italic;">"I"</span> . org-clock-in)
                   (<span style="font-style: italic;">"O"</span> . org-clock-out)
                   (<span style="font-style: italic;">"x"</span> . nil)
                   (<span style="font-style: italic;">"X"</span> . org-clock-cancel)))
      (add-to-list 'org-speed-commands elt t))))
</pre>
</div>
</div>
</li>
</ul>
</li>
</ul>
</li>

<li><a id="orgee1c745"></a>Org Appearance<br />
<div class="outline-text-7" id="text-orgee1c745">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">setopt</span> org-hide-leading-stars t
        org-hide-emphasis-markers t
        org-pretty-entities t
        org-image-actual-width 100
        org-display-remote-inline-images 'cache)
</pre>
</div>
</div>
</li>

<li><a id="org7cacc29"></a>Babel<br />
<div class="outline-text-7" id="text-org7cacc29">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"plantuml"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp" id="orgd260545">(<span style="font-weight: bold;">use-package</span> ob-core
  <span style="font-weight: bold;">:after</span> org
  <span style="font-weight: bold;">:hook</span> (org-babel-after-execute . org-display-inline-images)
  <span style="font-weight: bold;">:init</span>
  (<span style="font-weight: bold;">cond</span>
   ((string= system-type <span style="font-style: italic;">"gnu/linux"</span>)
    (<span style="font-weight: bold;">setq</span> org-plantuml-jar-path (expand-file-name <span style="font-style: italic;">"plantuml.jar"</span> <span style="font-style: italic;">"~/.guix-profile/share/java"</span>)))
   ((string= system-type <span style="font-style: italic;">"darwin"</span>)
    (<span style="font-weight: bold;">setq</span> org-plantuml-jar-path <span style="font-style: italic;">"/usr/local/Cellar/plantuml/8041/plantuml.8041.jar"</span>)))
  <span style="font-weight: bold;">:custom</span>
  (org-babel-load-languages '((emacs-lisp . t)
                              (lisp       . t)
                              (C          . t)
                              (java       . t)
                              (R          . t)
                              (shell      . t)
                              (ruby       . t)
                              (python     . t)
                              (scheme     . t)
                              (lua        . t)
                              (ledger     . t)
                              (gnuplot    . t)
                              (dot        . t)
                              (plantuml   . t)
                              (lilypond   . t))))
</pre>
</div>
</div>

<ul class="org-ul">
<li><a id="org8efbc4b"></a>Org Babel Tangle<br />
<div class="outline-text-8" id="text-org8efbc4b">
<p>
org-babel-tangle-default-file-mode does not seems to be in effect. I set org-babel-default-header-args:&lt;lang&gt; instead as a wordaround.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> ob-tangle
  <span style="font-weight: bold;">:after</span> ob-core
  <span style="font-weight: bold;">:custom</span>
  (org-babel-tangle-default-file-mode (identity #o444))
  (org-babel-tangle-use-relative-file-links nil))
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="org4dd335d"></a>Org ID<br />
<div class="outline-text-7" id="text-org4dd335d">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> org-id
  <span style="font-weight: bold;">:after</span> org
  <span style="font-weight: bold;">:bind</span> (<span style="font-weight: bold;">:map</span> org-mode-map
              (<span style="font-style: italic;">"C-c i"</span> . org-id-copy))
  <span style="font-weight: bold;">:custom</span>
  (org-id-track-globally t)
  (org-id-link-to-org-use-id 'create-if-interactive))
</pre>
</div>
</div>
</li>

<li><a id="orgd90ad9d"></a>Org Crypt<br />
<div class="outline-text-7" id="text-orgd90ad9d">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> org-crypt
  <span style="font-weight: bold;">:after</span> my/org-mode-init
  <span style="font-weight: bold;">:custom</span>
  (org-crypt-key user-mail-address)
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">bind-keys</span> <span style="font-weight: bold;">:map</span> org-mode-map
             (<span style="font-style: italic;">"C-c M-: e"</span> . org-encrypt-entry)
             (<span style="font-style: italic;">"C-c M-: E"</span> . org-encrypt-entries)
             (<span style="font-style: italic;">"C-c M-: d"</span> . org-decrypt-entry)
             (<span style="font-style: italic;">"C-c M-: D"</span> . org-decrypt-entries))
  (org-crypt-use-before-save-magic)
  (add-to-list 'org-tags-exclude-from-inheritance
               org-crypt-tag-matcher))
</pre>
</div>
</div>
</li>

<li><a id="orge49a9d2"></a>Org Attach&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span><br /></li>

<li><a id="org937f76b"></a>Org Link<br />
<div class="outline-text-7" id="text-org937f76b">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> ol
  <span style="font-weight: bold;">:after</span> (my-org-global-map my/org-mode-init)
  <span style="font-weight: bold;">:bind</span> (<span style="font-weight: bold;">:map</span> my/org-global-map
              (<span style="font-style: italic;">"s"</span> . org-store-link))
  <span style="font-weight: bold;">:config</span>
  (org-link-set-parameters <span style="font-style: italic;">"src"</span> <span style="font-weight: bold;">:follow</span> #'org-babel-ref-resolve))
</pre>
</div>
</div>

<ul class="org-ul">
<li><a id="org9f6822d"></a>Org Follow Link<br />
<div class="outline-text-8" id="text-org9f6822d">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">with-eval-after-load</span> 'ol
  (<span style="font-weight: bold;">setf</span> (alist-get 'file org-link-frame-setup) 'find-file)
  (<span style="font-weight: bold;">setopt</span> org-link-elisp-confirm-function nil))

(<span style="font-weight: bold;">with-eval-after-load</span> 'org-keys
  (<span style="font-weight: bold;">setopt</span> org-return-follows-link t))
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="org67e4bc0"></a>Org Export<br />
<ul class="org-ul">
<li><a id="org32bdeb6"></a>Org Export General<br />
<div class="outline-text-8" id="text-org32bdeb6">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> ox
  <span style="font-weight: bold;">:commands</span> org-export-dispatch
  <span style="font-weight: bold;">:custom</span>
  (org-export-with-smart-quotes t)
  (org-export-with-emphasize t)
  (org-export-with-special-strings t)
  (org-export-with-fixed-width t)
  (org-export-with-timestamps t)
  (org-export-preserve-breaks nil)
  (org-export-with-sub-superscripts nil)
  (org-export-with-archived-trees 'headline)
  (org-export-with-author nil)
  (org-export-with-broken-links 'mark)
  (org-export-with-clocks nil)
  (org-export-with-creator nil)
  (org-export-with-drawers '(not <span style="font-style: italic;">"LOGBOOK"</span>))
  (org-export-with-date nil)
  (org-export-with-entities t)
  (org-export-with-email nil)
  (org-export-with-footnotes t)
  (org-export-headline-levels 5)
  (org-export-with-inlinetasks t)
  (org-export-with-section-numbers nil)
  (org-export-with-planning nil)
  (org-export-with-priority nil)
  (org-export-with-properties nil)
  (org-export-with-statistics-cookies t)
  (org-export-with-tags nil)
  (org-export-with-tasks t)
  (org-export-with-latex t)
  (org-export-time-stamp-file nil)
  (org-export-with-title t)
  (org-export-with-toc nil)
  (org-export-with-todo-keywords nil)
  (org-export-with-tables t)
  (org-export-default-language <span style="font-style: italic;">"ja"</span>)
  (org-export-dispatch-use-expert-ui nil))
</pre>
</div>
</div>
</li>

<li><a id="org02632a7"></a>Org Export HTML<br />
<div class="outline-text-8" id="text-org02632a7">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> ox-html
  <span style="font-weight: bold;">:commands</span> (org-html-export-as-html
             org-html-export-to-html)
  <span style="font-weight: bold;">:custom</span>
  (org-html-preamble t)
  (org-html-postamble 'auto)
  (org-html-with-latex t)
  (org-html-container-element <span style="font-style: italic;">"div"</span>)
  (org-html-doctype <span style="font-style: italic;">"xhtml-strict"</span>))
</pre>
</div>
</div>
</li>

<li><a id="orgeab5aba"></a>Org Export LaTeX<br />
<div class="outline-text-8" id="text-orgeab5aba">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> ox-latex
  <span style="font-weight: bold;">:commands</span> (org-latex-export-as-latex
             org-latex-export-to-latex
             org-latex-export-to-pdf)
  <span style="font-weight: bold;">:custom</span>
  (org-latex-pdf-process '(<span style="font-style: italic;">"platex %f"</span>
                           <span style="font-style: italic;">"platex %f"</span>
                           <span style="font-style: italic;">"bibtex %b"</span>
                           <span style="font-style: italic;">"platex %f"</span>
                           <span style="font-style: italic;">"platex %f"</span>
                           <span style="font-style: italic;">"dvipdfmx %b.dvi"</span>))
  (org-latex-default-class <span style="font-style: italic;">"jsarticle"</span>)
  <span style="font-weight: bold;">:config</span>
  (add-to-list 'org-latex-classes
               '(<span style="font-style: italic;">"jsarticle"</span>
                 <span style="font-style: italic;">"\\documentclass[dvipdfmx,12pt]{jsarticle}"</span>
                 (<span style="font-style: italic;">"\\section{%s}"</span> . <span style="font-style: italic;">"\\section*{%s}"</span>)
                 (<span style="font-style: italic;">"\\subsection{%s}"</span> . <span style="font-style: italic;">"\\subsection*{%s}"</span>)
                 (<span style="font-style: italic;">"\\subsubsection{%s}"</span> . <span style="font-style: italic;">"\\subsubsection*{%s}"</span>)
                 (<span style="font-style: italic;">"\\paragraph{%s}"</span> . <span style="font-style: italic;">"\\paragraph*{%s}"</span>)
                 (<span style="font-style: italic;">"\\subparagraph{%s}"</span> . <span style="font-style: italic;">"\\subparagraph*{%s}"</span>)))
  (add-to-list 'org-latex-classes
               `(<span style="font-style: italic;">"beamer"</span>
                 <span style="font-style: italic;">"\\documentclass[presentation,dvipdfmx,18pt]{beamer}\n"</span>
                 (<span style="font-style: italic;">"\\section{%s}"</span> . <span style="font-style: italic;">"\\section*{%s}"</span>)
                 (<span style="font-style: italic;">"\\subsection{%s}"</span> . <span style="font-style: italic;">"\\subsection*{%s}"</span>)
                 (<span style="font-style: italic;">"\\subsubsection{%s}"</span> . <span style="font-style: italic;">"\\subsubsection*{%s}"</span>))))
</pre>
</div>
</div>
</li>

<li><a id="org1662b7b"></a>Org Export Texinfo<br />
<div class="outline-text-8" id="text-org1662b7b">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> ox-texinfo
  <span style="font-weight: bold;">:after</span> ox)
</pre>
</div>
</div>
</li>
</ul>
</li>
</ul>
</li>

<li><a id="org4e4df0e"></a>org external packages<br />
<div class="outline-text-6" id="text-org4e4df0e">
</div>
<ul class="org-ul">
<li><a id="org7e39fec"></a>org-ai&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span><br /></li>

<li><a id="org708f4b0"></a>org-modern<br />
<div class="outline-text-7" id="text-org708f4b0">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-org-modern"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> org-modern
  <span style="font-weight: bold;">:after</span> org
  <span style="font-weight: bold;">:commands</span> org-modern-mode)
</pre>
</div>
</div>
</li>

<li><a id="org4ed39dd"></a>org-transclusion<br />
<div class="outline-text-7" id="text-org4ed39dd">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-org-transclusion"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> org-transclusion
  <span style="font-weight: bold;">:after</span> org
  <span style="font-weight: bold;">:bind</span> (<span style="font-weight: bold;">:map</span> my/org-global-map
              (<span style="font-style: italic;">"% a"</span> . org-transclusion-add)
              (<span style="font-style: italic;">"% A"</span> . org-transclusion-add-all)
              (<span style="font-style: italic;">"% n"</span> . org-transclusion-make-from-link)
              (<span style="font-style: italic;">"% t"</span> . org-transclusion-activate)))
</pre>
</div>
</div>
</li>

<li><a id="org4a056a9"></a>org-edna<br />
<div class="outline-text-7" id="text-org4a056a9">
<p>
<a href="https://www.nongnu.org/org-edna-el/">Org Edna</a> allows to org entries to be blockers and action triggers, which is very intresting feature especially for managing successive set of tasks or any correlated tasks.
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-org-edna"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> org-edna
  <span style="font-weight: bold;">:after</span> org
  <span style="font-weight: bold;">:custom</span>
  (org-edna-mode t))
</pre>
</div>
</div>
</li>

<li><a id="orge052414"></a>org-drill<br />
<div class="outline-text-7" id="text-orge052414">
<p>
<a href="https://gitlab.com/phillord/org-drill">org-drill</a> helps me to learn english words and phrases. <a href="https://youtu.be/SGzdFtN_NqE">This video</a> introduces how I use org-drill.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-style: italic;">"https://gitlab.com/phillord/org-drill/-/tags?format=atom"</span> soft_update)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> org-drill
  <span style="font-weight: bold;">:ensure</span> t
  <span style="font-weight: bold;">:after</span> org
  <span style="font-weight: bold;">:bind</span> (<span style="font-weight: bold;">:map</span> org-mode-map
              (<span style="font-style: italic;">"C-c D"</span> . org-drill-tree))
  <span style="font-weight: bold;">:custom</span>
  (org-drill-spaced-repetition-algorithm 'sm5))
</pre>
</div>
</div>
</li>

<li><a id="orgd415119"></a>org-ql<br />
<div class="outline-text-7" id="text-orgd415119">
<p>
<a href="https://github.com/alphapapa/org-ql">Org QL</a> enables me to issue queries to search org entries with either SQL-like format or plain search strings.
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-org-ql"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> org-ql
  <span style="font-weight: bold;">:after</span> (org my-org-global-map)
  <span style="font-weight: bold;">:bind</span> (<span style="font-weight: bold;">:map</span> my/org-global-map
              (<span style="font-style: italic;">"q q"</span> . org-ql-search)
              (<span style="font-style: italic;">"q v"</span> . org-ql-view)
              (<span style="font-style: italic;">"q f f"</span> . org-ql-find)
              (<span style="font-style: italic;">"q f F"</span> . org-ql-find-in-org-directory)
              (<span style="font-style: italic;">"q f a"</span> . org-ql-find-in-agenda)
              (<span style="font-style: italic;">"q f n"</span> . my/org-ql-find-in-notes)
              (<span style="font-style: italic;">"q /"</span> . org-ql-sparse-tree))
  <span style="font-weight: bold;">:preface</span>
  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/org-ql-find-in-notes</span> ()
    <span style="font-style: italic;">"Call '</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">org-ql-find</span><span style="font-style: italic;">' on '</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">denote-all-files</span><span style="font-style: italic;">'."</span>
    (<span style="font-weight: bold;">interactive</span>)
    (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">denote</span> nil t)
      (org-ql-find (denote-directory-files))))
  <span style="font-weight: bold;">:custom</span>
  (org-ql-search-directories-files-regexp <span style="font-style: italic;">"\\.org</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(?:</span><span style="font-style: italic;">\\.gpg</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">?$"</span>)
  (org-ql-search-directories-files-recursive t)
  <span style="font-weight: bold;">:preface</span>
  (<span style="font-weight: bold;">defconst</span> <span style="font-weight: bold; font-style: italic;">org-last-repeat-time-regexp</span>
    <span style="font-style: italic;">"</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(?:</span><span style="font-style: italic;">:LAST_REPEAT: *\\[</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">[</span><span style="font-style: italic;">^</span><span style="font-style: italic;">]]+</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">]</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">"</span>
    <span style="font-style: italic;">"Matches the LAST_REPEAT property together with a time stamp."</span>)
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">org-ql-search</span>)
  (org-ql-defpred last-repeat (<span style="font-weight: bold; text-decoration: underline;">&amp;key</span> from to _on)
    <span style="font-style: italic;">"Return non-nil if current entry was repeated in given period.</span>
<span style="font-style: italic;">Without arguments, return non-nil if entry has LAST_REPEAT property."</span>
    <span style="font-weight: bold;">:normalizers</span> ((`(,predicate-names ,(<span style="font-weight: bold;">and</span> num-days (pred numberp)))
                   (<span style="font-weight: bold;">let*</span> ((from-day (* -1 num-days))
                          (rest (list <span style="font-weight: bold;">:from</span> from-day)))
                     (org-ql--normalize-from-to-on
                       `(last-repeat <span style="font-weight: bold;">:from</span> ,from))))
                  (`(,predicate-names . ,rest)
                   (org-ql--normalize-from-to-on
                     `(last-repeat <span style="font-weight: bold;">:from</span> ,from <span style="font-weight: bold;">:to</span> ,to))))
    <span style="font-weight: bold;">:preambles</span> ((`(,predicate-names . ,_)
                 <span style="font-weight: bold; font-style: italic;">;;  </span><span style="font-weight: bold; font-style: italic;">Predicate still needs testing.</span>
                 (list <span style="font-weight: bold;">:regexp</span> org-last-repeat-time-regexp <span style="font-weight: bold;">:query</span> query)))
    <span style="font-weight: bold;">:body</span>
    (org-ql--predicate-ts <span style="font-weight: bold;">:from</span> from <span style="font-weight: bold;">:to</span> to <span style="font-weight: bold;">:regexp</span> org-last-repeat-time-regexp <span style="font-weight: bold;">:match-group</span> 1))
  (org-ql-defpred (tags-expanded expanded-tags tags-x xtags) (<span style="font-weight: bold; text-decoration: underline;">&amp;rest</span> tags)
    <span style="font-style: italic;">"Return non-nil if current heading has one or more of TAGS.</span>
<span style="font-style: italic;">If TAGS contains a group tag, all tags in the group is used to match.</span>
<span style="font-style: italic;">Both inherited and local tags is tested."</span>
    <span style="font-weight: bold;">:normalizers</span> ((`(,predicate-names . ,tags)
                   `(tags-expanded ,@tags)))
    <span style="font-weight: bold;">:body</span> (apply #'org-ql--predicate-tags
                 (seq-uniq (--mapcat (org-tags-expand it t)
                                     tags))))
  (org-ql-defpred (category-inherited) (<span style="font-weight: bold; text-decoration: underline;">&amp;rest</span> categories)
    <span style="font-style: italic;">"Return non-nil if current heading has CATEGORY.</span>
<span style="font-style: italic;">Ancestors are looked up If current heading has no CATEGORY."</span>
    <span style="font-weight: bold;">:body</span> (<span style="font-weight: bold;">when-let</span> ((category (<span style="font-weight: bold;">or</span> (org-get-category (point))
                                   (org-entry-get (point) <span style="font-style: italic;">"CATEGORY"</span> t))))
            (<span style="font-weight: bold;">cl-typecase</span> categories
              (null t)
              (otherwise (member category categories)))))
  (<span style="font-weight: bold;">with-eval-after-load</span> 'org-expiry
    (org-ql-defpred expired ()
      <span style="font-style: italic;">"Return non-nil if the entry is expired."</span>
      <span style="font-weight: bold;">:body</span> (org-expiry-expired-p))))

(<span style="font-weight: bold;">use-package</span> org-ql-view
  <span style="font-weight: bold;">:after</span> (org-ql org-agenda)
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">push</span> `(<span style="font-style: italic;">"Tasks on Web/Book"</span>
          <span style="font-weight: bold;">:buffers-files</span> org-agenda-files
          <span style="font-weight: bold;">:query</span> (<span style="font-weight: bold;">and</span> (<span style="font-weight: bold;">or</span> (tags <span style="font-style: italic;">"web"</span>)
                          (tags <span style="font-style: italic;">"book"</span>))
                      (not (<span style="font-weight: bold;">or</span> (done) (todo ,my/org-todo-keyword--someday))))
          <span style="font-weight: bold;">:super-groups</span> ((<span style="font-weight: bold;">:auto-tags</span>))
          <span style="font-weight: bold;">:sort</span> (priority date))
        org-ql-views)
  (<span style="font-weight: bold;">push</span> `(<span style="font-style: italic;">"Habits"</span>
          <span style="font-weight: bold;">:buffers-files</span> org-agenda-files
          <span style="font-weight: bold;">:query</span> (habit)
          <span style="font-weight: bold;">:sort</span> (todo scheduled))
        org-ql-views))
</pre>
</div>
</div>
</li>

<li><a id="org1eab190"></a>org-contacts<br />
<div class="outline-text-7" id="text-org1eab190">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-org-contacts"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> org-contacts
  <span style="font-weight: bold;">:after</span> org
  <span style="font-weight: bold;">:commands</span> (org-contacts-anniversaries)
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">denote</span> nil t)
    (<span style="font-weight: bold;">setq</span> org-contacts-files
          (list (denote-get-path-by-id <span style="font-style: italic;">"20230605T173003"</span>)))))
</pre>
</div>
</div>
</li>

<li><a id="orge4b9044"></a>org-ml&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span><br /></li>

<li><a id="org5507300"></a>org-roam&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span><br /></li>
<li><a id="org66574eb"></a>org-mime<br />
<div class="outline-text-7" id="text-org66574eb">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-org-mime"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> org-mime
  <span style="font-weight: bold;">:after</span> org
  <span style="font-weight: bold;">:commands</span> (org-mime-org-subtree-htmlize)
  <span style="font-weight: bold;">:bind</span> (<span style="font-weight: bold;">:map</span> org-mode-map
              (<span style="font-style: italic;">"C-c M-M"</span> . org-mime-org-subtree-htmlize))
  <span style="font-weight: bold;">:custom</span>
  (org-mime-use-property-inheritance t)
  (org-mime-export-ascii t))
</pre>
</div>
</div>
</li>

<li><a id="orgac563a3"></a>org-web-tools<br />
<div class="outline-text-7" id="text-orgac563a3">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-org-web-tools"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> org-web-tools
  <span style="font-weight: bold;">:bind</span> ((<span style="font-style: italic;">"C-c C-;"</span> . org-web-tools-insert-link-for-url)))
</pre>
</div>
</div>
</li>

<li><a id="org48177a1"></a>org-volume&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span><br /></li>

<li><a id="orge2fb425"></a>org-clock-convenience<br />
<div class="outline-text-7" id="text-orge2fb425">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-style: italic;">"https://github.com/dfeich/org-clock-convenience/releases.atom"</span> soft_update)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> org-clock-convenience
  <span style="font-weight: bold;">:ensure</span> t
  <span style="font-weight: bold;">:after</span> org-agenda
  <span style="font-weight: bold;">:bind</span>
  (<span style="font-weight: bold;">:map</span> org-agenda-mode-map
        (<span style="font-style: italic;">"@"</span>   . org-clock-convenience-fill-gap)
        (<span style="font-style: italic;">"C-@"</span> . org-clock-convenience-fill-gap-both)))
</pre>
</div>
</div>
</li>

<li><a id="org49ba74e"></a>org-reveal<br />
<div class="outline-text-7" id="text-org49ba74e">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-org-reveal"</span>
</pre>
</div>
</div>
</li>

<li><a id="org7a19aea"></a>org-expiry<br />
<div class="outline-text-7" id="text-org7a19aea">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-org-contrib"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> org-expiry
  <span style="font-weight: bold;">:after</span> my/org-mode-init
  <span style="font-weight: bold;">:custom</span>
  (org-expiry-inactive-timestamps t)
  (org-expiry-handler-function 'org-expiry-archive-subtree)
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">with-eval-after-load</span> 'org-capture
    (add-hook 'org-capture-prepare-finalize-hook
              #'org-expiry-insert-created))
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Workaround for the malfunction of org-expiry-insinuate</span>
  (<span style="font-weight: bold;">unless</span> (<span style="font-weight: bold;">ignore-errors</span> (org-expiry-insinuate))
    (add-hook 'org-insert-heading-hook 'org-expiry-insert-created)
    (add-hook 'org-after-todo-state-change-hook 'org-expiry-insert-created)
    (add-hook 'org-after-tags-change-hook 'org-expiry-insert-created)))
</pre>
</div>
</div>
</li>

<li><a id="orgba6ceec"></a>ob-async&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span><br /></li>

<li><a id="orga9d4b63"></a>ob-lilypond&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span><br /></li>

<li><a id="orga77e29c"></a>ox-hugo<br />
<div class="outline-text-7" id="text-orga77e29c">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-ox-hugo"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> ox-hugo
  <span style="font-weight: bold;">:after</span> ox)
</pre>
</div>
</div>
</li>

<li><a id="orgef95139"></a>org-web-track<br />
<div class="outline-text-7" id="text-orgef95139">
<p>
<a href="my/org-web-track-update-all-and-notify">org-web-track-update-all-and-notify</a> seems not to suit midnight-hook.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> org-web-track
  <span style="font-weight: bold;">:ensure</span> t
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">:load-path "~/data/home/.local/share/ghq/github.com/p-snow/org-web-track"</span>
  <span style="font-weight: bold;">:after</span> (my/org-mode-init my-org-global-map)
  <span style="font-weight: bold;">:bind</span> (<span style="font-weight: bold;">:map</span> my/org-global-map
              (<span style="font-style: italic;">"T q"</span> . my/org-web-track-ql-view)
              (<span style="font-style: italic;">"T c"</span> . org-web-track-columns)
              (<span style="font-style: italic;">"T a"</span> . org-web-track-agenda-columns)
              (<span style="font-style: italic;">"T n"</span> . org-web-track-setup-entry)
              (<span style="font-style: italic;">"T u"</span> . org-web-track-update-entry)
              (<span style="font-style: italic;">"T U"</span> . org-web-track-update-files)
              (<span style="font-style: italic;">"T r"</span> . org-web-track-report))
  <span style="font-weight: bold;">:preface</span>
  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/org-web-track-ql-view</span> ()
    <span style="font-style: italic;">"Open Org Agenda view with tracking items which hold TRACK_URL property."</span>
    (<span style="font-weight: bold;">interactive</span>)
    (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">org-web-track</span> nil t)
    (<span style="font-weight: bold;">with-current-buffer</span> (get-buffer-create <span style="font-style: italic;">"Org Web Track"</span>)
      (org-agenda-mode)
      (<span style="font-weight: bold;">setq-local</span> org-overriding-columns-format (org-web-track-columns-format)
                  org-agenda-view-columns-initially t)
      (<span style="font-weight: bold;">setq</span> org-columns-modify-value-for-display-function
            'org-web-track-display-values)
      (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">org-ql</span> nil t)
        (org-ql-search org-web-track-files
                       `(property ,org-web-track-url)
                       <span style="font-weight: bold;">:super-groups</span> '((<span style="font-weight: bold;">:tag</span> <span style="font-style: italic;">"book"</span>) (<span style="font-weight: bold;">:tag</span> <span style="font-style: italic;">"food"</span>)
                                       (<span style="font-weight: bold;">:tag</span> <span style="font-style: italic;">"tool"</span>) (<span style="font-weight: bold;">:tag</span> <span style="font-style: italic;">"supply"</span>))
                       <span style="font-weight: bold;">:buffer</span> (current-buffer)))))
  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/org-web-track-update-all-and-notify</span> ()
    <span style="font-style: italic;">"Update all web tracking items in `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">org-web-track-files</span><span style="font-style: italic;">'</span>
<span style="font-style: italic;"> and send an email if any of them has changed its value."</span>
    (<span style="font-weight: bold;">let*</span> ((org-log-into-drawer t)
           (message-kill-buffer-on-exit t)
           (mail-msg (mapconcat
                      (<span style="font-weight: bold;">lambda</span> (chg)
                        (<span style="font-weight: bold;">org-with-point-at</span> chg
                          (<span style="font-weight: bold;">let</span> ((org-trust-scanner-tags t))
                            (format <span style="font-style: italic;">"%s\n\t%s\n"</span>
                                    (substring-no-properties
                                     (org-get-heading t t t t))
                                    (org-web-track-current-changes nil <span style="font-style: italic;">"%p =&gt; %c"</span> <span style="font-style: italic;">" | "</span>)))))
                      (org-web-track-update-files))))
      (<span style="font-weight: bold;">unless</span> (string-blank-p mail-msg)
        <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">you need to set SMTP info to smtpmail-xxx variables</span>
        (message-mail user-mail-address <span style="font-style: italic;">"Web Tracking Notification"</span>)
        (message-goto-body)
        (insert mail-msg)
        (message-send-and-exit))))
  (<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my/usd-exchange-rates</span> nil)
  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/usd-excange-rate</span> (currency)
    <span style="font-style: italic;">"Return the exchange rate between CURRENCY and the US dollar.</span>

<span style="font-style: italic;">This function also Update `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">my/usd-exchange-rates</span><span style="font-style: italic;">', a list of</span>
<span style="font-style: italic;">exchange rate against US dollar."</span>
    (<span style="font-weight: bold;">or</span> my/usd-exchange-rates
        (request (concat <span style="font-style: italic;">"https://openexchangerates.org/api/latest.json?app_id="</span>
                         (my/credential-info <span style="font-style: italic;">"openexchangerates.org"</span> <span style="font-style: italic;">"app id"</span>))
          <span style="font-weight: bold;">:sync</span> t
          <span style="font-weight: bold;">:success</span>
          (<span style="font-weight: bold;">cl-function</span>
           (<span style="font-weight: bold;">lambda</span> (<span style="font-weight: bold; text-decoration: underline;">&amp;key</span> response <span style="font-weight: bold; text-decoration: underline;">&amp;allow-other-keys</span>)
             (<span style="font-weight: bold;">let</span> ((content (request-response-data response)))
               (<span style="font-weight: bold;">setq</span> my/usd-exchange-rates (json-parse-string content <span style="font-weight: bold;">:object-type</span> 'alist)))))
          <span style="font-weight: bold;">:complete</span>
          (<span style="font-weight: bold;">cl-function</span>
           (<span style="font-weight: bold;">lambda</span> (<span style="font-weight: bold; text-decoration: underline;">&amp;key</span> data <span style="font-weight: bold; text-decoration: underline;">&amp;allow-other-keys</span>)
             data))))
    (assoc-default currency
                   (assoc-default 'rates my/usd-exchange-rates)))
  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/convert-currency</span> (target-currency amount)
    <span style="font-style: italic;">"Convert AMOUNT into TARGET-CURRENCY."</span>
    (<span style="font-weight: bold;">let*</span> ((currs '((<span style="font-style: italic;">"$"</span> . USD) (<span style="font-style: italic;">"&#8364;"</span> . EUR) (<span style="font-style: italic;">"&#163;"</span> . GBP) (<span style="font-style: italic;">"&#8377;"</span> . INR)
                    (<span style="font-style: italic;">"&#165;"</span> . JPY) (<span style="font-style: italic;">"&#165;"</span> . CNY) (<span style="font-style: italic;">"&#8361;"</span> . KRW) (<span style="font-style: italic;">"&#8381;"</span> . RUB)))
           (curr-re (rx-to-string `(seq (group-n 1 (<span style="font-weight: bold;">or</span> ,@(mapcar 'car currs)))
                                        (group-n 2 (1+ digit))))))
      (<span style="font-weight: bold;">when</span> (string-match curr-re amount)
        (<span style="font-weight: bold;">let</span> ((amt-in-usd (string-to-number (match-string 2 amount)))
              (to-usd-rate (my/usd-excange-rate
                            (assoc-default (match-string 1 amount) currs)))
              (from-usd-rate (my/usd-excange-rate target-currency)))
          (format <span style="font-style: italic;">"%s%.2f"</span>
                  (car (rassq target-currency currs))
                  (/ (* amt-in-usd from-usd-rate) to-usd-rate))))))
  <span style="font-weight: bold;">:custom</span>
  (org-web-track-use-curl nil)
  (org-web-track-content-fetcher-alist
   `((,(regexp-quote <span style="font-style: italic;">"melpa.org/#/"</span>) .
      <span style="font-style: italic;">"fetch-dynamic-page.py %s"</span>)))
  (org-web-track-selectors-alist
   `((,(regexp-quote <span style="font-style: italic;">"melpa</span><span style="font-weight: bold; font-style: italic;">\</span><span style="font-style: italic;">.org/#/"</span>) .
      <span style="font-style: italic;">"htmlq --text dd | head -n 1 | cut -d ' ' -f 1"</span>)
     (,(regexp-quote <span style="font-style: italic;">"www.lenovo.com/jp/ja/p/laptops/thinkpad"</span>)
      (<span style="font-weight: bold;">lambda</span> (dom)
        (<span style="font-weight: bold;">when-let</span> ((price-node (car (dom-search dom (<span style="font-weight: bold;">lambda</span> (node) (string= <span style="font-style: italic;">"productpromotionprice"</span>
                                                                        (<span style="font-weight: bold;">dom-attr</span> node 'name)))))))
          (assoc-default 'content (cadr price-node)))))
     (,(<span style="font-weight: bold;">rx</span> <span style="font-style: italic;">"www.amazon.co.jp"</span> (+ anychar) <span style="font-style: italic;">"-ebook"</span>)
      <span style="font-style: italic;">"pup 'span[id=\"priceblock_ourprice\"],span[id=\"kindle-price\"],span[class=\"a-text-price\"],span[class=\"a-offscreen\"] json{}' </span><span style="font-weight: bold; font-style: italic;">\</span><span style="font-style: italic;">| jq -re '.[0].text'"</span>)
     (,(regexp-quote <span style="font-style: italic;">"www.amazon.co.jp/product-reviews"</span>)
      [.a-size-base.a-color-secondary] <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">num of stars</span>
      [.a-size-medium.a-color-base])  <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">rating</span>
     (,(regexp-quote <span style="font-style: italic;">"www.amazon.co.jp"</span>)
      [.a-price.aok-align-center &gt; .a-offscreen]
      [div:availability span]         <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">availability</span>
      )
     (,(regexp-quote <span style="font-style: italic;">"www.yodobashi.com/product"</span>)
      [<span style="font-weight: bold;">:js_scl_unitPrice</span>])
     (,(regexp-quote <span style="font-style: italic;">"kakaku.com/item"</span>)
      [.priceTxt])
     (,(regexp-quote <span style="font-style: italic;">"store.steampowered.com"</span>)
      (<span style="font-weight: bold;">lambda</span> (dom)
        (<span style="font-weight: bold;">when-let</span> ((products (dom-search dom (<span style="font-weight: bold;">lambda</span> (node) (string-prefix-p <span style="font-style: italic;">"game_area_purchase_game"</span>
                                                                             (<span style="font-weight: bold;">dom-attr</span> node 'class))))))
          (seq-some (<span style="font-weight: bold;">lambda</span> (prod)
                      (<span style="font-weight: bold;">let</span> ((text (dom-text (<span style="font-weight: bold;">or</span> (dom-by-class prod <span style="font-style: italic;">"game_purchase_price"</span>)
                                                (dom-by-class prod <span style="font-style: italic;">"discount_final_price"</span>)))))
                        (<span style="font-weight: bold;">if</span> (length= text 0) nil text)))
                    products))))
     (,(regexp-quote <span style="font-style: italic;">"www.googleapis.com/youtube/v3/channels"</span>)
      (<span style="font-weight: bold;">lambda</span> (json)
        (assoc-default 'subscriberCount
                       (assoc-default 'statistics (aref (cdr (assoc 'items json))
                                                        0)))))
     (,(regexp-quote <span style="font-style: italic;">"www.googleapis.com/youtube/v3/videos"</span>)
      (<span style="font-weight: bold;">lambda</span> (json)
        (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">dash</span> nil t)
          (<span style="font-weight: bold;">let</span> ((stat (-&gt;&gt; json
                           (assoc-default 'items)
                           (mapcar #'identity)
                           (nth 0)
                           (assoc-default 'statistics))))
            (list (assoc-default 'likeCount stat)
                  (assoc-default 'commentCount stat))))))
     (,(regexp-quote <span style="font-style: italic;">"openexchangerates.org/api/latest"</span>)
      (<span style="font-weight: bold;">lambda</span> (json)
        (format <span style="font-style: italic;">"%.3f"</span>
                (assoc-default 'JPY
                               (assoc-default 'rates json)))))
     (,(regexp-quote <span style="font-style: italic;">"map.kaldi.co.jp/kaldi"</span>)
      <span style="font-style: italic;">"pup 'div[class=\"shop_bnr news\"] ul li text{}' | xargs echo -n"</span>)
     (,(regexp-quote <span style="font-style: italic;">"www.seijoishii.com"</span>)
      [.price &gt; .total])
     (<span style="font-style: italic;">"localhost"</span> identity)
     (,(regexp-quote <span style="font-style: italic;">"store.minisforum.jp/products"</span>)
      (<span style="font-weight: bold;">lambda</span> (dom)
        (<span style="font-weight: bold;">when-let*</span> ((prod-price (car (dom-by-class dom <span style="font-style: italic;">"product-info__price"</span>)))
                    (sale-price (car (dom-by-tag prod-price 'sale-price))))
          (dom-text sale-price))))
     (,(<span style="font-weight: bold;">rx</span> (seq <span style="font-style: italic;">"www.gmktec.com/"</span> (<span style="font-weight: bold;">or</span> <span style="font-style: italic;">"products"</span> <span style="font-style: italic;">"collections"</span>)))
      (<span style="font-weight: bold;">lambda</span> (dom)
        (<span style="font-weight: bold;">when-let*</span> ((price-w (car (dom-by-class dom <span style="font-style: italic;">"product-info__header_price-wrapper"</span>)))
                    (price (car (dom-by-class price-w <span style="font-style: italic;">"tw-text-save-color"</span>))))
          (my/convert-currency 'JPY (dom-text price)))))
     (,(regexp-quote <span style="font-style: italic;">"api.github.com/repos"</span>) .
      ,(apply-partially 'assoc-default 'stargazers_count))))
  (org-agenda-bulk-custom-functions
   '((?U org-web-track-agenda-update)))
  (org-web-track-item-column-width 16)
  (org-web-track-update-column-width 30)
  (org-web-track-files
   (<span style="font-weight: bold;">lambda</span> ()
     (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">denote</span> nil t)
       (<span style="font-weight: bold;">let</span> ((denote-directory (expand-file-name <span style="font-style: italic;">"~/org/notes"</span>))
             (org-agenda-files '(<span style="font-style: italic;">"~/org/agenda/"</span>)))
         (append (org-agenda-files)
                 (cl-remove-if-not (<span style="font-weight: bold;">lambda</span> (f)
                                     (member <span style="font-style: italic;">"track"</span>
                                             (denote-extract-keywords-from-path f)))
                                   (denote-directory-files))))))))
</pre>
</div>
</div>

<ul class="org-ul">
<li><a id="org8ce6ef2"></a>batch tracking<br />
<div class="outline-text-8" id="text-org8ce6ef2">
<div class="org-src-container">
<pre class="src src-shell"><span style="font-weight: bold;">export</span> <span style="font-weight: bold; font-style: italic;">DISPLAY</span>=:0 &amp;&amp; <span style="font-style: italic;">\</span>
  emacs -Q --batch <span style="font-style: italic;">\</span>
        -l $<span style="font-weight: bold; font-style: italic;">XDG_CONFIG_HOME</span>/emacs/early-init.el <span style="font-style: italic;">\</span>
        -l $<span style="font-weight: bold; font-style: italic;">XDG_CONFIG_HOME</span>/emacs/lisp/ext-config.el <span style="font-style: italic;">\</span>
        -l $<span style="font-weight: bold; font-style: italic;">XDG_CONFIG_HOME</span>/emacs/lisp/org-web-track-config.el <span style="font-style: italic;">\</span>
        -l $<span style="font-weight: bold; font-style: italic;">XDG_CONFIG_HOME</span>/emacs/batch/org-web-track-mail.el <span style="font-style: italic;">\</span>
        -f my/org-web-track-mail
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">provide</span> '<span style="font-weight: bold; text-decoration: underline;">my/org-mode-init</span>)
(define-keymap <span style="font-weight: bold;">:prefix</span> 'my/org-global-map)
(<span style="font-weight: bold;">provide</span> '<span style="font-weight: bold; text-decoration: underline;">my-org-global-map</span>)

(<span style="font-weight: bold;">setopt</span> message-send-mail-function 'smtpmail-send-it
        smtpmail-smtp-server <span style="font-style: italic;">"&lt;&lt;smtp-host&gt;&gt;"</span>
        smtpmail-smtp-service 465
        smtpmail-smtp-user user-mail-address
        smtpmail-stream-type 'ssl
        smtpmail-mail-address user-mail-address
        message-send-mail-function 'smtpmail-send-it
        network-security-level 'low
        make-backup-files nil)

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/org-web-track-mail</span> ()
  <span style="font-style: italic;">"Update `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">org-web-track</span><span style="font-style: italic;">' items along with sending email and immediate exit."</span>
  (my/org-web-track-update-all-and-notify)
  (org-save-all-org-buffers)
  (save-buffers-kill-emacs t))
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="org3df51fa"></a>org-tidy<br />
<div class="outline-text-7" id="text-org3df51fa">
<p>
<a href="https://github.com/jxq0/org-tidy">org-tidy</a> attentively conceals all org drawers. I use it in <a href="#org3c67662">my English drill session</a>.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> org-tidy
  <span style="font-weight: bold;">:ensure</span> t
  <span style="font-weight: bold;">:after</span> org
  <span style="font-weight: bold;">:bind</span> (<span style="font-weight: bold;">:map</span> org-mode-map
              (<span style="font-style: italic;">"C-c t"</span> . org-tidy-mode)))
</pre>
</div>
</div>
</li>

<li><a id="orgd18f601"></a>org-super-links&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span><br /></li>

<li><a id="orgf7836e9"></a>org-appear<br />
<div class="outline-text-7" id="text-orgf7836e9">
<p>
<a href="https://github.com/awth13/org-appear">org-appear</a> attentively displays emphasis markers, such as / for italic and _ for underline, only when the cursor is positioned over the word in Org Mode.
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-org-appear"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> org-appear
  <span style="font-weight: bold;">:after</span> org
  <span style="font-weight: bold;">:disabled</span> t <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">tempprarily not working with Org 9.7</span>
  <span style="font-weight: bold;">:hook</span> (org-mode . (org-appear-mode)))
</pre>
</div>
</div>
</li>
</ul>
</li>
</ul>
</li>

<li><a id="orgf7fdae5"></a>Completion<br />
<ul class="org-ul">
<li><a id="org3982075"></a>vertico<br />
<div class="outline-text-6" id="text-org3982075">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-vertico"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-style: italic;">"https://github.com/minad/vertico/releases.atom"</span> soft_update)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> vertico
  <span style="font-weight: bold;">:bind</span> (<span style="font-weight: bold;">:map</span> vertico-map
              (<span style="font-style: italic;">"C-j"</span> . exit-minibuffer)
              (<span style="font-style: italic;">"RET"</span> . vertico-directory-enter)
              (<span style="font-style: italic;">"C-h"</span> . vertico-directory-delete-char)
              (<span style="font-style: italic;">"M-h"</span> . vertico-directory-delete-word)
              (<span style="font-style: italic;">"M-q"</span> . vertico-quick-insert)
              (<span style="font-style: italic;">"C-q"</span> . vertico-quick-exit))
  <span style="font-weight: bold;">:hook</span>
  ((minibuffer-setup . vertico-repeat-save)
   <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">enable to write "~/" or "/" whatever path being input in minibuffer</span>
   (rfn-eshadow-update-overlay . vertico-directory-tidy))
  <span style="font-weight: bold;">:custom</span>
  (vertico-cycle t)
  (vertico-scroll-margin 0)
  (vertico-count 11)
  (vertico-resize 'grow-only)
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">bind-keys</span> (<span style="font-style: italic;">"M-R"</span> . vertico-repeat))
  (vertico-mode 1))

(<span style="font-weight: bold;">use-package</span> vertico-multiform
  <span style="font-weight: bold;">:after</span> vertico
  <span style="font-weight: bold;">:bind</span> (<span style="font-weight: bold;">:map</span> vertico-map
              (<span style="font-style: italic;">"M-G"</span> . vertico-multiform-grid))
  <span style="font-weight: bold;">:config</span>
  (vertico-multiform-mode 1))
</pre>
</div>
</div>
</li>

<li><a id="org577d59f"></a>consult<br />
<div class="outline-text-6" id="text-org577d59f">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-consult"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-style: italic;">"https://github.com/minad/consult/releases.atom"</span> soft_update)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> consult
  <span style="font-weight: bold;">:after</span> my-org-global-map
  <span style="font-weight: bold;">:bind</span> ((<span style="font-style: italic;">"C-;"</span> . consult-buffer)
         (<span style="font-style: italic;">"C-c m"</span> . consult-mode-command)
         (<span style="font-style: italic;">"C-c r"</span> . consult-recent-file)
         (<span style="font-style: italic;">"C-c h"</span> . consult-outline)
         (<span style="font-style: italic;">"C-x M-:"</span> . consult-complex-command)
         (<span style="font-style: italic;">"M-y"</span> . consult-yank-pop)
         (<span style="font-style: italic;">"C-M-y"</span> . consult-yank-from-kill-ring)
         (<span style="font-style: italic;">"M-g M-g"</span> . consult-goto-line)
         (<span style="font-style: italic;">"M-g m"</span> . consult-mark)
         (<span style="font-style: italic;">"M-g M"</span> . consult-global-mark)
         (<span style="font-style: italic;">"M-g i"</span> . consult-imenu)
         (<span style="font-style: italic;">"M-g I"</span> . consult-imenu-multi)
         (<span style="font-style: italic;">"C-x r j"</span> . consult-register)
         (<span style="font-style: italic;">"M-s e"</span> . consult-isearch-history)
         (<span style="font-style: italic;">"M-s \\"</span> . consult-locate)
         (<span style="font-style: italic;">"M-s f"</span> . consult-find)
         (<span style="font-style: italic;">"M-s F"</span> . consult-fd)
         (<span style="font-style: italic;">"M-s g"</span> . consult-grep)
         (<span style="font-style: italic;">"M-s G"</span> . consult-git-grep)
         (<span style="font-style: italic;">"M-s r"</span> . consult-ripgrep)
         (<span style="font-style: italic;">"M-s l"</span> . consult-line)
         (<span style="font-style: italic;">"H-s"</span> . consult-line)
         (<span style="font-style: italic;">"M-s L"</span> . consult-line-multi)
         (<span style="font-style: italic;">"M-s m"</span> . consult-multi-occur)
         (<span style="font-style: italic;">"M-s k"</span> . consult-keep-lines)
         (<span style="font-style: italic;">"M-s u"</span> . consult-focus-lines)
         (<span style="font-style: italic;">"M-s i"</span> . consult-info)
         (<span style="font-style: italic;">"C-x M-#"</span> . consult-theme)
         <span style="font-weight: bold;">:map</span> my/org-global-map
         (<span style="font-style: italic;">"h"</span> . consult-org-agenda)
         <span style="font-weight: bold;">:map</span> isearch-mode-map
         (<span style="font-style: italic;">"C-M-n"</span> . consult-isearch-history)
         (<span style="font-style: italic;">"M-l"</span> . consult-line)
         (<span style="font-style: italic;">"M-L"</span> . consult-line-multi)
         <span style="font-weight: bold;">:map</span> minibuffer-local-map
         (<span style="font-style: italic;">"C-M-n"</span> . consult-history)
         <span style="font-weight: bold;">:map</span> text-mode-map
         (<span style="font-style: italic;">"C-M-i"</span> . completion-at-point)
         <span style="font-weight: bold;">:map</span> org-mode-map
         (<span style="font-style: italic;">"C-M-i"</span> . completion-at-point))
  <span style="font-weight: bold;">:custom</span>
  (consult-narrow-key <span style="font-style: italic;">"&lt;"</span>)
  (consult-widen-key <span style="font-style: italic;">"&gt;"</span>)
  (consult-line-start-from-top t)
  (consult-locate-args (format <span style="font-style: italic;">"plocate -d %s --ignore-case --existing --regexp"</span>
                               (expand-file-name <span style="font-style: italic;">"&lt;&lt;plocate-db()&gt;&gt;"</span>)))
  (consult-find-args <span style="font-style: italic;">"find . "</span>)
  (consult-fd-args '((<span style="font-weight: bold;">if</span> (executable-find <span style="font-style: italic;">"fdfind"</span> 'remote)
                         <span style="font-style: italic;">"fdfind"</span> <span style="font-style: italic;">"fd"</span>)
                     <span style="font-style: italic;">"--hidden --full-path --color=never"</span>))
  <span style="font-weight: bold;">:init</span>
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">use consult for completion unless Corfu is active</span>
  (<span style="font-weight: bold;">setq</span> completion-in-region-function
        (<span style="font-weight: bold;">lambda</span> (<span style="font-weight: bold; text-decoration: underline;">&amp;rest</span> args)
          (apply (<span style="font-weight: bold;">if</span> vertico-mode
                     #'consult-completion-in-region
                   #'completion--in-region)
                 args)))
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">with-eval-after-load</span> 'org
    (<span style="font-weight: bold;">bind-keys</span> <span style="font-weight: bold;">:map</span> org-mode-map
               (<span style="font-style: italic;">"C-c H"</span> . consult-org-heading))))
</pre>
</div>
</div>

<ul class="org-ul">
<li><a id="org9435185"></a>consult-dir<br />
<div class="outline-text-7" id="text-org9435185">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-consult-dir"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> consult-dir
  <span style="font-weight: bold;">:after</span> consult
  <span style="font-weight: bold;">:bind</span> (<span style="font-style: italic;">"H-d"</span> . consult-dir))
</pre>
</div>
</div>
</li>

<li><a id="org74f7557"></a>affe<br />
<div class="outline-text-7" id="text-org74f7557">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> affe
  <span style="font-weight: bold;">:ensure</span> t
  <span style="font-weight: bold;">:bind</span> ((<span style="font-style: italic;">"M-s a f"</span> . affe-find)
         (<span style="font-style: italic;">"M-s a g"</span> . affe-grep)))
</pre>
</div>
</div>
</li>

<li><a id="org645ebbc"></a>consult-ghq<br />
<div class="outline-text-7" id="text-org645ebbc">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> consult-ghq
  <span style="font-weight: bold;">:ensure</span> t
  <span style="font-weight: bold;">:after</span> consult
  <span style="font-weight: bold;">:bind</span> ((<span style="font-style: italic;">"C-c q f"</span> . consult-ghq-find)
         (<span style="font-style: italic;">"C-c q g"</span> . consult-ghq-grep))
  <span style="font-weight: bold;">:custom</span>
  (consult-ghq-find-function 'dired))
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="org59e17c8"></a>embark<br />
<div class="outline-text-6" id="text-org59e17c8">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-embark"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-style: italic;">"https://github.com/oantolin/embark/releases.atom"</span> soft_update)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> embark
  <span style="font-weight: bold;">:bind</span> ((<span style="font-style: italic;">"C-."</span> . embark-act)
         (<span style="font-style: italic;">"M-."</span> . embark-dwim)
         (<span style="font-style: italic;">"&lt;help&gt; B"</span> . embark-bindings)
         <span style="font-weight: bold;">:map</span> embark-file-map
         (<span style="font-style: italic;">"b"</span> . browse-url))
  <span style="font-weight: bold;">:init</span>
  (<span style="font-weight: bold;">setq</span> prefix-help-command #'embark-prefix-help-command) <span style="font-weight: bold; font-style: italic;">;</span>
  <span style="font-weight: bold;">:custom</span>
  (embark-mixed-indicator-delay 3)
  <span style="font-weight: bold;">:hook</span>
  (embark-collect-mode . consult-preview-at-point-mode)
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">embark-consult</span>)
  (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">embark-org</span>)
  (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">avy-embark-collect</span>)
  (<span style="font-weight: bold;">push</span> 'embark--allow-edit
        (alist-get 'shell-command-on-region embark-target-injection-hooks)))
</pre>
</div>
</div>
</li>

<li><a id="orgeb1be1c"></a>marginalia<br />
<div class="outline-text-6" id="text-orgeb1be1c">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-marginalia"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-style: italic;">"https://github.com/minad/marginalia/releases.atom"</span> soft_update)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> marginalia
  <span style="font-weight: bold;">:after</span> vertico
  <span style="font-weight: bold;">:config</span>
  (marginalia-mode 1))
</pre>
</div>
</div>
</li>

<li><a id="org1d3d910"></a>orderless<br />
<div class="outline-text-6" id="text-org1d3d910">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-orderless"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-style: italic;">"https://github.com/oantolin/orderless/releases.atom"</span> soft_update)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> orderless
  <span style="font-weight: bold;">:custom</span> (completion-styles '(orderless)))
</pre>
</div>
</div>

<ul class="org-ul">
<li><a id="orgbc188b1"></a>support for migemo in orderless<br />
<div class="outline-text-7" id="text-orgbc188b1">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">orderless-migemo</span> (component)
  (<span style="font-weight: bold;">let</span> ((pattern (migemo-get-pattern component)))
    (<span style="font-weight: bold;">condition-case</span> nil
        (<span style="font-weight: bold;">progn</span> (string-match-p pattern <span style="font-style: italic;">""</span>) pattern)
      (invalid-regexp nil))))

(orderless-define-completion-style orderless-default-style
  (orderless-matching-styles '(orderless-literal
                               orderless-regexp)))

(orderless-define-completion-style orderless-migemo-style
  (orderless-matching-styles '(orderless-literal
                               orderless-regexp
                               orderless-migemo)))

(<span style="font-weight: bold;">setq</span> orderless-matching-styles '(orderless-literal orderless-regexp orderless-migemo))

<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Uncomment this clause if you prefer to apply rules for completion categories selectively</span>
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(setq completion-category-overrides</span>
<span style="font-weight: bold; font-style: italic;">;;       </span><span style="font-weight: bold; font-style: italic;">'((command (styles orderless-default-style))</span>
<span style="font-weight: bold; font-style: italic;">;;         </span><span style="font-weight: bold; font-style: italic;">(file (styles orderless-migemo-style))</span>
<span style="font-weight: bold; font-style: italic;">;;         </span><span style="font-weight: bold; font-style: italic;">(project-file (styles orderless-migemo-style))</span>
<span style="font-weight: bold; font-style: italic;">;;         </span><span style="font-weight: bold; font-style: italic;">(buffer (styles orderless-migemo-style))</span>
<span style="font-weight: bold; font-style: italic;">;;         </span><span style="font-weight: bold; font-style: italic;">(symbol (styles orderless-default-style))</span>
<span style="font-weight: bold; font-style: italic;">;;         </span><span style="font-weight: bold; font-style: italic;">(multi-category (styles orderless-migemo-style))</span>
<span style="font-weight: bold; font-style: italic;">;;         </span><span style="font-weight: bold; font-style: italic;">(org-heading (styles orderless-migemo-style))</span>
<span style="font-weight: bold; font-style: italic;">;;         </span><span style="font-weight: bold; font-style: italic;">(consult-location (styles orderless-migemo-style))</span>
<span style="font-weight: bold; font-style: italic;">;;         </span><span style="font-weight: bold; font-style: italic;">(org-roam-node (styles orderless-migemo-style))</span>
<span style="font-weight: bold; font-style: italic;">;;         </span><span style="font-weight: bold; font-style: italic;">(unicode-name (styles orderless-migemo-style))</span>
<span style="font-weight: bold; font-style: italic;">;;         </span><span style="font-weight: bold; font-style: italic;">(variable (styles orderless-default-style))))</span>
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="orgee4a479"></a>corfu<br />
<div class="outline-text-6" id="text-orgee4a479">
<p>
Though I prefer vertico more for completion interface, <a href="https://github.com/minad/consult">consult manual</a> says Vertico can't be used with Eglot or lsp-mode. So I decided to use Corfu only in prog-mode.
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-corfu"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> corfu
  <span style="font-weight: bold;">:hook</span> ((prog-mode shell-mode eshell-mode) . corfu-mode)
  <span style="font-weight: bold;">:custom</span>
  (corfu-cycle t)
  (corfu-auto t)
  (corfu-preselect-first t))
</pre>
</div>
</div>
</li>

<li><a id="orgfd6e7ef"></a>cape<br />
<div class="outline-text-6" id="text-orgfd6e7ef">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-cape"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> cape
  <span style="font-weight: bold;">:bind</span> (<span style="font-weight: bold;">:map</span> ctl-x-map
              <span style="font-weight: bold;">:prefix</span> <span style="font-style: italic;">"C-M-i"</span>
              <span style="font-weight: bold;">:prefix-map</span> my/cape-map
              <span style="font-weight: bold;">:prefix-docstring</span> <span style="font-style: italic;">"Keymap for cape commands."</span>
              (<span style="font-style: italic;">"C-M-i"</span> . completion-at-point)
              (<span style="font-style: italic;">"d"</span> . cape-dabbrev)
              (<span style="font-style: italic;">"h"</span> . cape-history)
              (<span style="font-style: italic;">"f"</span> . cape-file)
              (<span style="font-style: italic;">"k"</span> . cape-keyword)
              (<span style="font-style: italic;">"s"</span> . cape-symbol)
              (<span style="font-style: italic;">"a"</span> . cape-abbrev)
              (<span style="font-style: italic;">"l"</span> . cape-line)
              (<span style="font-style: italic;">"w"</span> . cape-dict)
              (<span style="font-style: italic;">"\\"</span> . cape-tex)
              (<span style="font-style: italic;">"_"</span> . cape-tex)
              (<span style="font-style: italic;">"^"</span> . cape-tex)
              (<span style="font-style: italic;">"&amp;"</span> . cape-sgml)
              (<span style="font-style: italic;">"r"</span> . cape-rfc1345))
  <span style="font-weight: bold;">:hook</span>
  (text-mode . (<span style="font-weight: bold;">lambda</span> ()
                 (<span style="font-weight: bold;">setq-local</span> completion-at-point-functions
                             (append completion-at-point-functions
                                     '(cape-dabbrev
                                       cape-file
                                       cape-symbol
                                       cape-dict)))))
  (prog-mode . (<span style="font-weight: bold;">lambda</span> ()
                 (<span style="font-weight: bold;">setq-local</span> completion-at-point-functions
                             (append completion-at-point-functions
                                     '(cape-dabbrev
                                       cape-file
                                       cape-symbol
                                       cape-keyword
                                       cape-history))))))
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="orgffcd792"></a>text-mode and its derivatives<br />
<ul class="org-ul">
<li><a id="orgb5c1533"></a>nxml-mode<br />
<div class="outline-text-6" id="text-orgb5c1533">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> nxml-mode
  <span style="font-weight: bold;">:delight</span> (nxml-mode <span style="font-style: italic;">" XM"</span>)
  <span style="font-weight: bold;">:mode</span> ((<span style="font-style: italic;">"</span><span style="font-weight: bold; font-style: italic;">\</span><span style="font-style: italic;">.xml$"</span>   . nxml-mode)
         (<span style="font-style: italic;">"</span><span style="font-weight: bold; font-style: italic;">\</span><span style="font-style: italic;">.xsl$"</span>   . nxml-mode)
         (<span style="font-style: italic;">"</span><span style="font-weight: bold; font-style: italic;">\</span><span style="font-style: italic;">.xhtml$"</span> . nxml-mode)
         (<span style="font-style: italic;">"</span><span style="font-weight: bold; font-style: italic;">\</span><span style="font-style: italic;">.page$"</span>  . nxml-mode)
         (<span style="font-style: italic;">"</span><span style="font-weight: bold; font-style: italic;">\</span><span style="font-style: italic;">.plist$"</span> . nxml-mode))
  <span style="font-weight: bold;">:hook</span> (nxml-mode . my/prog-mode-hook-function)
  <span style="font-weight: bold;">:custom</span>
  (nxml-child-indent 2)
  (nxml-attribute-indent 2)
  (nxml-slash-auto-complete-flag t)
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">setq-local</span> tab-width 2)
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">pattern in hideshow mode for nxml mode</span>
  (add-to-list 'hs-special-modes-alist
               (list 'nxml-mode
                     <span style="font-style: italic;">"&lt;!--</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">|</span><span style="font-style: italic;">&lt;[</span><span style="font-style: italic;">^</span><span style="font-style: italic;">/&gt;]*[</span><span style="font-style: italic;">^</span><span style="font-style: italic;">/]&gt;"</span>
                     <span style="font-style: italic;">"--&gt;</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">|</span><span style="font-style: italic;">&lt;/[</span><span style="font-style: italic;">^</span><span style="font-style: italic;">/&gt;]*[</span><span style="font-style: italic;">^</span><span style="font-style: italic;">/]&gt;"</span>
                     <span style="font-style: italic;">"&lt;!--"</span>
                     'nxml-forward-element
                     nil)))
</pre>
</div>
</div>
</li>

<li><a id="orgb4cee0e"></a>toml-mode<br />
<div class="outline-text-6" id="text-orgb4cee0e">
<p>
language grammar for toml
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(toml <span style="font-style: italic;">"https://github.com/tree-sitter/tree-sitter-toml"</span>)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(toml-mode . toml-ts-mode)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> toml
  <span style="font-weight: bold;">:mode</span> <span style="font-style: italic;">"\\.toml$"</span>)
</pre>
</div>
</div>
</li>

<li><a id="orgf9198ae"></a>yaml-mode<br />
<div class="outline-text-6" id="text-orgf9198ae">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(yaml <span style="font-style: italic;">"https://github.com/ikatyang/tree-sitter-yaml"</span>)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(yaml-mode . yaml-ts-mode)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(yaml-ts-mode . combobulate-mode)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> yaml
  <span style="font-weight: bold;">:mode</span> <span style="font-style: italic;">"\\.ya?ml$"</span>)
</pre>
</div>
</div>
</li>

<li><a id="org82ac850"></a>json-mode<br />
<div class="outline-text-6" id="text-org82ac850">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"tree-sitter-json"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(json-mode . json-ts-mode)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> json
  <span style="font-weight: bold;">:mode</span> <span style="font-style: italic;">"\\.json$"</span>)
</pre>
</div>
</div>
</li>

<li><a id="org9dac104"></a>markdown-mode<br />
<div class="outline-text-6" id="text-org9dac104">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"markdown"</span>
<span style="font-style: italic;">"tree-sitter-markdown"</span>
<span style="font-style: italic;">"emacs-markdown-mode"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> markdown-mode
  <span style="font-weight: bold;">:mode</span> <span style="font-style: italic;">"\\.md$"</span>)
</pre>
</div>
</div>
</li>

<li><a id="org40b891d"></a>tex-mode<br />
<div class="outline-text-6" id="text-org40b891d">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> tex-mode
  <span style="font-weight: bold;">:mode</span> (<span style="font-style: italic;">"\\.tex$"</span> . latex-mode)
  <span style="font-weight: bold;">:hook</span> ((tex-mode . (<span style="font-weight: bold;">lambda</span> () (<span style="font-weight: bold;">setq</span> ispell-parser 'tex))))
  <span style="font-weight: bold;">:config</span>
  (my/add-dash-docsets-hook 'latex-mode-hook '(<span style="font-style: italic;">"LaTeX"</span>)))
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="org5800987"></a>prog-mode and its derivatives<br />
<div class="outline-text-5" id="text-org5800987">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(add-hook 'prog-mode-hook
          #'my/prog-mode-hook-function)

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/prog-mode-hook-function</span> ()
  (hl-line-mode -1)
  (hs-minor-mode -1)
  (display-fill-column-indicator-mode 1)
  (prettify-symbols-mode 1))
</pre>
</div>
</div>

<ul class="org-ul">
<li><a id="orgbd0bb1c"></a>sh-mode<br />
<div class="outline-text-6" id="text-orgbd0bb1c">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"tree-sitter-bash"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> sh-script
  <span style="font-weight: bold;">:delight</span> <span style="font-style: italic;">" SH"</span>
  <span style="font-weight: bold;">:commands</span> sh-mode
  <span style="font-weight: bold;">:mode</span> (<span style="font-style: italic;">"\\.sh$"</span> . sh-mode)
  <span style="font-weight: bold;">:hook</span> ((sh-mode)
         . (<span style="font-weight: bold;">lambda</span> ()
             (my/add-dash-docsets-hook 'sh-mode-hook '(<span style="font-style: italic;">"Bash"</span>))
             (<span style="font-weight: bold;">setq-local</span> devdocs-current-docs '(<span style="font-style: italic;">"bash"</span>))))
  <span style="font-weight: bold;">:custom</span>
  (sh-basic-offset 2)
  (sh-indent-after-if '+)
  (sh-indent-for-case-label 0)
  (sh-indent-for-case-alt '+))
</pre>
</div>
</div>
</li>

<li><a id="org1363ddc"></a>bash-ts-mode<br />
<div class="outline-text-6" id="text-org1363ddc">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> bash-ts-mode
  <span style="font-weight: bold;">:interpreter</span> <span style="font-style: italic;">"bash"</span>
  <span style="font-weight: bold;">:hook</span> ((bash-ts-mode)
         . (<span style="font-weight: bold;">lambda</span> ()
             (<span style="font-weight: bold;">setq-local</span> devdocs-current-docs '(<span style="font-style: italic;">"bash"</span>)))))
</pre>
</div>
</div>
</li>

<li><a id="orge254d30"></a>emacs-lisp-mode<br />
<div class="outline-text-6" id="text-orge254d30">
<p>
I'm in the trial of pp-eval-last-sexp instead of eval-last-sexp adviced from <a href="https://karthinks.com/software/an-elisp-editing-tip/">this blog post</a>
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(elisp <span style="font-style: italic;">"https://github.com/Wilfred/tree-sitter-elisp"</span>)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> elisp-mode
  <span style="font-weight: bold;">:mode</span> (<span style="font-style: italic;">"\\.eld?$"</span> . emacs-lisp-mode)
  <span style="font-weight: bold;">:commands</span> emacs-lisp-mode
  <span style="font-weight: bold;">:hook</span> (emacs-lisp-mode . (<span style="font-weight: bold;">lambda</span> ()
                             (<span style="font-weight: bold;">setq-local</span> devdocs-current-docs '(<span style="font-style: italic;">"elisp"</span>))
                             (<span style="font-weight: bold;">push</span> '(<span style="font-style: italic;">"lambda"</span> . ?&#955;) prettify-symbols-alist)
                             (<span style="font-weight: bold;">setq-local</span> tab-width 8)
                             (eldoc-mode 1)))
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">eldoc</span>)
  (substitute-key-definition 'eval-last-sexp
                             'pp-eval-last-sexp
                             global-map)
  (my/add-dash-docsets-hook 'emacs-lisp-mode-hook
                            '(<span style="font-style: italic;">"Emacs Lisp"</span>)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/elisp-mode-eval-buffer</span> ()
  (<span style="font-weight: bold;">interactive</span>)
  (message <span style="font-style: italic;">"Evaluated buffer"</span>)
  (eval-buffer))

(keymap-set emacs-lisp-mode-map <span style="font-style: italic;">"C-c C-c"</span> #'my/elisp-mode-eval-buffer)
(keymap-set lisp-interaction-mode-map <span style="font-style: italic;">"C-c C-c"</span> #'my/elisp-mode-eval-buffer)
</pre>
</div>
</div>
</li>

<li><a id="orgaef3454"></a>lisp-mode<br />
<div class="outline-text-6" id="text-orgaef3454">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> lisp-mode
  <span style="font-weight: bold;">:mode</span> <span style="font-style: italic;">"\\.lisp$"</span>
  <span style="font-weight: bold;">:config</span>
  (my/add-dash-docsets-hook 'lisp-mode-hook
                            '(<span style="font-style: italic;">"Common Lisp"</span>)))
</pre>
</div>
</div>

<ul class="org-ul">
<li><a id="orgb865501"></a>sly<br />
<div class="outline-text-7" id="text-orgb865501">
<p>
<a href="https://github.com/joaotavora/sly#start-of-content">Sly</a>, a fork of <a href="https://slime.common-lisp.dev/">Slime</a>.
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-sly"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> sly
  <span style="font-weight: bold;">:custom</span>
  (inferior-lisp-program <span style="font-style: italic;">"&lt;&lt;which(filename="</span>sbcl<span style="font-style: italic;">")&gt;&gt;"</span>)
  (sly-auto-start 'ask)
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">with-eval-after-load</span> 'ob-lisp
    (<span style="font-weight: bold;">setopt</span> org-babel-lisp-eval-fn 'sly-eval)))
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="org8765eb4"></a>scheme-mode<br />
<div class="outline-text-6" id="text-org8765eb4">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"tree-sitter-scheme"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> scheme
  <span style="font-weight: bold;">:mode</span> ((<span style="font-style: italic;">"\\.guix-channel"</span> . scheme-mode)
         (<span style="font-style: italic;">"\\.guix-authorizations"</span> . scheme-mode)))
</pre>
</div>
</div>
</li>

<li><a id="org3853a41"></a>cc-mode<br />
<div class="outline-text-6" id="text-org3853a41">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> cc-mode
  <span style="font-weight: bold;">:mode</span> ((<span style="font-style: italic;">"\\.c\\'"</span>   . c-mode)
         (<span style="font-style: italic;">"\\.cpp\\'"</span> . c++-mode))
  <span style="font-weight: bold;">:hook</span> (((c-mode c-ts-mode)
          . (<span style="font-weight: bold;">lambda</span> ()
              (<span style="font-weight: bold;">setq-local</span> devdocs-current-docs '(<span style="font-style: italic;">"c"</span>))))
         ((c++-mode c++-ts-mode)
          . (<span style="font-weight: bold;">lambda</span> ()
              (<span style="font-weight: bold;">setq-local</span> devdocs-current-docs '(<span style="font-style: italic;">"cpp"</span>)))))
  <span style="font-weight: bold;">:custom</span>
  (c-tab-always-indent t)
  (c-auto-align-backslashes nil)
  (c-echo-syntactic-information-p t)
  (c-default-style <span style="font-style: italic;">"my/c-style"</span>)
  <span style="font-weight: bold;">:config</span>
  (my/add-dash-docsets-hook 'c-mode-common-hook
                            '(<span style="font-style: italic;">"C"</span>))
  (c-toggle-auto-newline 1)
  (c-add-style <span style="font-style: italic;">"my/c-style"</span>
               '((c-basic-offset . 4)
                 (c-comment-only-line-offset . 0)
                 (c-hanging-braces-alist
                  . ((brace-if-brace before after)
                     (substatement-open before after)))
                 (c-hanging-colons-alist
                  . ((case-label after)))
                 (c-cleanup-list
                  . (brace-else-brace
                     brace-elseif-brace
                     empty-defun-braces
                     defun-close-semi
                     list-close-comma
                     scope-operator))
                 (c-offsets-alist
                  . ((arglist-intro . +)
                     (arglist-cont-nonempty . c-lineup-arglist)))))
  (c-add-style <span style="font-style: italic;">"my/objc-style"</span>
               '((c-basic-offset . 2)
                 (c-comment-only-line-offset . 0)
                 (c-hanging-braces-alist
                  . ((brace-if-brace before after)
                     (substatement-open before after)))
                 (c-hanging-colons-alist
                  . ((case-label after)))
                 (c-cleanup-list
                  . (brace-else-brace
                     brace-elseif-brace
                     empty-defun-braces
                     defun-close-semi
                     list-close-comma
                     scope-operator))
                 (c-offsets-alist
                  . ((arglist-intro . +)
                     (arglist-cont-nonempty . c-lineup-arglist))))))
</pre>
</div>
</div>
</li>

<li><a id="orga6b9bf3"></a>rust-mode<br />
<div class="outline-text-6" id="text-orga6b9bf3">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-rust-mode"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> rust-mode
  <span style="font-weight: bold;">:mode</span> <span style="font-style: italic;">"\\.rs$"</span>
  <span style="font-weight: bold;">:hook</span> ((rust-mode rust-ts-mode)
         . (<span style="font-weight: bold;">lambda</span> ()
             (<span style="font-weight: bold;">setq-local</span> devdocs-current-docs '(<span style="font-style: italic;">"rust"</span>)))))
</pre>
</div>
</div>
</li>

<li><a id="org86b87b0"></a>rustic&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span><br /></li>

<li><a id="org2a4b74a"></a>python-mode<br />
<div class="outline-text-6" id="text-org2a4b74a">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"tree-sitter-python"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(python-mode . python-ts-mode)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(python-ts-mode . combobulate-mode)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> python
  <span style="font-weight: bold;">:mode</span> <span style="font-style: italic;">"\\.py\\'"</span>
  <span style="font-weight: bold;">:interpreter</span> <span style="font-style: italic;">"python"</span>
  <span style="font-weight: bold;">:hook</span>
  ((python-mode inferior-python-mode python-ts-mode) .
   (<span style="font-weight: bold;">lambda</span> ()
     (<span style="font-weight: bold;">setq-local</span> flycheck-checker 'python-pylint)
     (<span style="font-weight: bold;">setq-local</span> devdocs-current-docs '(<span style="font-style: italic;">"python~3.9"</span>))))
  <span style="font-weight: bold;">:config</span>
  (my/add-dash-docsets-hook 'python-mode-hook
                            '(<span style="font-style: italic;">"Python 3"</span> <span style="font-style: italic;">"NumPy"</span> <span style="font-style: italic;">"Matplotlib"</span>))
  (my/add-dash-docsets-hook 'inferior-python-mode-hook
                            '(<span style="font-style: italic;">"Python 3"</span>)))

(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">python-mode-initialized</span> nil)

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-python-mode-hook</span> ()
  (<span style="font-weight: bold;">setq-local</span> flycheck-checker 'python-pylint)
  (jedi:setup)
  (jedi-mode 1)
  (<span style="font-weight: bold;">unless</span> python-mode-initialized
    (<span style="font-weight: bold;">setq</span> python-mode-initialized t)
    (info-lookup-add-help
     <span style="font-weight: bold;">:mode</span> 'python-mode
     <span style="font-weight: bold;">:regexp</span> <span style="font-style: italic;">"[a-zA-Z_0-9.]+"</span>
     <span style="font-weight: bold;">:doc-spec</span>
     '((<span style="font-style: italic;">"(python)Python Module Index"</span> )
       (<span style="font-style: italic;">"(python)Index"</span>
        (<span style="font-weight: bold;">lambda</span>
          (item)
          (<span style="font-weight: bold;">cond</span>
           ((string-match
             <span style="font-style: italic;">"</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">[A-Za-z0-9_]+</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">() (in module </span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">[A-Za-z0-9_.]+</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">)"</span> item)
            (format <span style="font-style: italic;">"%s.%s"</span> (match-string 2 item)
                    (match-string 1 item))))))))))
</pre>
</div>
</div>

<ul class="org-ul">
<li><a id="org5439539"></a>emacs-project<br />
<div class="outline-text-7" id="text-org5439539">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-company-jedi"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> company-jedi
  <span style="font-weight: bold;">:after</span> python
  <span style="font-weight: bold;">:hook</span> (python-mode . my/python-mode-hook)
  <span style="font-weight: bold;">:custom</span>
  (jedi:tooltip-method nil)
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/python-mode-hook</span> ()
    (add-to-list 'company-backends 'company-jedi)))
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="orgbd9dc0a"></a>ruby-mode<br />
<div class="outline-text-6" id="text-orgbd9dc0a">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(ruby-mode . ruby-ts-mode)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> ruby
  <span style="font-weight: bold;">:mode</span> ((<span style="font-style: italic;">"\\.rb$"</span>   . ruby-mode)
         (<span style="font-style: italic;">"Capfile$"</span> . ruby-mode)
         (<span style="font-style: italic;">"Gemfile$"</span> . ruby-mode))
  <span style="font-weight: bold;">:interpreter</span> ((<span style="font-style: italic;">"ruby"</span>    . ruby-mode)
                (<span style="font-style: italic;">"rbx"</span>     . ruby-mode)
                (<span style="font-style: italic;">"jruby"</span>   . ruby-mode))
  <span style="font-weight: bold;">:hook</span> ((ruby-mode ruby-ts-mode)
         . (<span style="font-weight: bold;">lambda</span> ()
             (<span style="font-weight: bold;">setq-local</span> flycheck-checker 'ruby-rubocop)
             (<span style="font-weight: bold;">setq-local</span> devdocs-current-docs '(<span style="font-style: italic;">"ruby~3.2"</span>))))
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">setq</span> ruby-indent-level 2)
  (<span style="font-weight: bold;">setq</span> ruby-insert-encoding-magic-comment nil)
  (add-to-list 'hs-special-modes-alist
               `(ruby-mode
                 ,(<span style="font-weight: bold;">rx</span> (<span style="font-weight: bold;">or</span> <span style="font-style: italic;">"def"</span> <span style="font-style: italic;">"class"</span> <span style="font-style: italic;">"module"</span> <span style="font-style: italic;">"do"</span> <span style="font-style: italic;">"if"</span> <span style="font-style: italic;">"{"</span> <span style="font-style: italic;">"["</span>)) <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">Block start</span>
                 ,(<span style="font-weight: bold;">rx</span> (<span style="font-weight: bold;">or</span> <span style="font-style: italic;">"}"</span> <span style="font-style: italic;">"]"</span> <span style="font-style: italic;">"end"</span>))                       <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">Block end</span>
                 ,(<span style="font-weight: bold;">rx</span> (<span style="font-weight: bold;">or</span> <span style="font-style: italic;">"#"</span> <span style="font-style: italic;">"=begin"</span>))                        <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">Comment start</span>
                 ruby-forward-sexp nil))
  (my/add-dash-docsets-hook 'ruby-mode-hook '(<span style="font-style: italic;">"Ruby"</span>)))
</pre>
</div>
</div>

<ul class="org-ul">
<li><a id="orge8ac29a"></a>inf-ruby<br />
<div class="outline-text-7" id="text-orge8ac29a">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-inf-ruby"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> inf-ruby
  <span style="font-weight: bold;">:after</span> ruby
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">setq</span> inf-ruby-default-implementation <span style="font-style: italic;">"pry"</span>)
  (add-to-list 'inf-ruby-implementations '(<span style="font-style: italic;">"pry"</span> . <span style="font-style: italic;">"pry"</span>))
  (<span style="font-weight: bold;">setq</span> inf-ruby-eval-binding <span style="font-style: italic;">"Pry.toplevel_binding"</span>)
  (<span style="font-weight: bold;">setq</span> inf-ruby-first-prompt-pattern <span style="font-style: italic;">"^\\[[0-9]+\\] pry</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">(.*)</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">&gt; *"</span>)
  (<span style="font-weight: bold;">setq</span> inf-ruby-prompt-pattern <span style="font-style: italic;">"^\\[[0-9]+\\] pry</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">(.*)</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">[&gt;*\"'] *"</span>))
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="orgc7d94ca"></a>java-ts-mode<br />
<div class="outline-text-6" id="text-orgc7d94ca">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(java-mode . java-ts-mode)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> java-ts-mode
  <span style="font-weight: bold;">:mode</span> <span style="font-style: italic;">"\\.java$"</span>
  <span style="font-weight: bold;">:hook</span> (java-ts-mode
         . (<span style="font-weight: bold;">lambda</span> ()
             (<span style="font-weight: bold;">setq-local</span> devdocs-current-docs '(<span style="font-style: italic;">"openjdk~21"</span>)))))
</pre>
</div>
</div>
</li>

<li><a id="orgf928d92"></a>lua-mode<br />
<div class="outline-text-6" id="text-orgf928d92">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-lua-mode"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> lua-mode
  <span style="font-weight: bold;">:mode</span> <span style="font-style: italic;">"\\.lua$"</span>
  <span style="font-weight: bold;">:hook</span> ((lua-mode lua-ts-mode)
         . (<span style="font-weight: bold;">lambda</span> ()
             (<span style="font-weight: bold;">setq-local</span> flycheck-checker 'lua-rubocop)
             (<span style="font-weight: bold;">setq-local</span> devdocs-current-docs '(<span style="font-style: italic;">"lua~3.2"</span>)))))
</pre>
</div>
</div>
</li>

<li><a id="orga1e21ea"></a>perl-mode<br />
<div class="outline-text-6" id="text-orga1e21ea">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> perl-mode
  <span style="font-weight: bold;">:delight</span> <span style="font-style: italic;">" PL"</span>)
</pre>
</div>
</div>
</li>

<li><a id="org7ff17bb"></a>web-mode<br />
<div class="outline-text-6" id="text-org7ff17bb">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-web-mode"</span>
<span style="font-style: italic;">"tree-sitter-html"</span>
<span style="font-style: italic;">"tree-sitter-css"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> web-mode
  <span style="font-weight: bold;">:delight</span> <span style="font-style: italic;">" WB"</span>
  <span style="font-weight: bold;">:mode</span> ((<span style="font-style: italic;">"\\.phtml$"</span>     . web-mode)
         (<span style="font-style: italic;">"\\.tpl\\.php$"</span> . web-mode)
         (<span style="font-style: italic;">"\\.jsp$"</span>       . web-mode)
         (<span style="font-style: italic;">"\\.as[cp]x$"</span>   . web-mode)
         (<span style="font-style: italic;">"\\.erb$"</span>       . web-mode)
         (<span style="font-style: italic;">"\\.html?$"</span>     . web-mode))
  <span style="font-weight: bold;">:custom</span>
  (web-mode-attr-indent-offset        2)
  (web-mode-attr-value-indent-offset  2)
  (web-mode-code-indent-offset        2)
  (web-mode-css-offset                2)
  (web-mode-markup-indent-offset      2)
  (web-mode-sql-indent-offset         2)
  (web-mode-block-padding             2)
  (web-mode-script-padding            2)
  <span style="font-weight: bold;">:config</span>
  (my/add-dash-docsets-hook 'web-mode-hook '(<span style="font-style: italic;">"HTML"</span>)))
</pre>
</div>
</div>
</li>

<li><a id="org3489bae"></a>css-mode<br />
<div class="outline-text-6" id="text-org3489bae">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> css-mode
  <span style="font-weight: bold;">:mode</span> <span style="font-style: italic;">"\\.css$"</span>
  <span style="font-weight: bold;">:hook</span> ((css-mode css-ts-mode)
         . (<span style="font-weight: bold;">lambda</span> ()
             (my/add-dash-docsets-hook 'css-mode-hook '(<span style="font-style: italic;">"CSS"</span>))
             (<span style="font-weight: bold;">setq-local</span> devdocs-current-docs '(<span style="font-style: italic;">"css"</span>))))
  <span style="font-weight: bold;">:custom</span>
  (css-indent-offset 2))
</pre>
</div>
</div>
</li>

<li><a id="orgeafcc45"></a>js2-mode<br />
<div class="outline-text-6" id="text-orgeafcc45">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-js2-mode"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(js2-mode . js-ts-mode)
(css-mode . css-ts-mode)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> js2-mode
  <span style="font-weight: bold;">:delight</span> <span style="font-style: italic;">" J2"</span>
  <span style="font-weight: bold;">:mode</span> ((<span style="font-style: italic;">"\\.js</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">on</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">?\\'"</span> . js2-mode)
         (<span style="font-style: italic;">"\\.eslintrc\\'"</span>    . js2-mode))
  <span style="font-weight: bold;">:hook</span> (js2-mode . (<span style="font-weight: bold;">lambda</span> ()
                      (<span style="font-weight: bold;">setq-local</span> flycheck-checker 'javascript-eslint)
                      (<span style="font-weight: bold;">setq-local</span> flycheck-disabled-checkers '(javascript-jshint javascript-jscs))))
  <span style="font-weight: bold;">:custom</span>
  (flycheck-javascript-eslint-executable <span style="font-style: italic;">"eslint"</span>)
  (my/add-dash-docsets-hook 'js2-mode-hook '(<span style="font-style: italic;">"JavaScript"</span>)))

(<span style="font-weight: bold;">use-package</span> js
  <span style="font-weight: bold;">:disabled</span> t
  <span style="font-weight: bold;">:delight</span> <span style="font-style: italic;">" JS"</span>
  <span style="font-weight: bold;">:custom</span>
  (js-indent-level 2))
</pre>
</div>
</div>
</li>

<li><a id="orgcd61a66"></a>make<br />
<div class="outline-text-6" id="text-orgcd61a66">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(cmake <span style="font-style: italic;">"https://github.com/uyha/tree-sitter-cmake"</span>)
(make <span style="font-style: italic;">"https://github.com/alemuller/tree-sitter-make"</span>)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(cmake-mode . cmake-ts-mode)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> cmake
  <span style="font-weight: bold;">:mode</span> ((<span style="font-style: italic;">"\\.mk$"</span> . cmake-mode)
         (<span style="font-style: italic;">"^Makefile$"</span> . cmake-mode)))
</pre>
</div>
</div>
</li>

<li><a id="org7473b3f"></a>sql-mode<br />
<div class="outline-text-6" id="text-org7473b3f">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> sql
  <span style="font-weight: bold;">:delight</span> <span style="font-style: italic;">" SQ"</span>
  <span style="font-weight: bold;">:commands</span> (sql-mode)
  <span style="font-weight: bold;">:mode</span> ((<span style="font-style: italic;">"\\.sql$"</span> . sql-mode))
  <span style="font-weight: bold;">:bind</span> (<span style="font-weight: bold;">:map</span> sql-interactive-mode-map
              (<span style="font-style: italic;">"C-j"</span> . comint-send-input))
  <span style="font-weight: bold;">:hook</span> (sql-mode . (<span style="font-weight: bold;">lambda</span> ()
                      (<span style="font-weight: bold;">setq-local</span> flycheck-checker 'sql-sqlint))))
</pre>
</div>
</div>
</li>

<li><a id="org31dbe4f"></a>plantuml-mode<br />
<div class="outline-text-6" id="text-org31dbe4f">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-plantuml-mode"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> plantuml
  <span style="font-weight: bold;">:mode</span> <span style="font-style: italic;">"\\.plu$"</span>
  <span style="font-weight: bold;">:custom</span>
  (plantuml-jar-path <span style="font-style: italic;">"~/.guix-extra-profiles/emacs/emacs/share/java/plantuml.jar"</span>)
  (plantuml-exec-mode 'jar)
  <span style="font-weight: bold;">:config</span>
  (my/add-dash-docsets-hook 'plantuml-mode-hook '(<span style="font-style: italic;">"PlantUML"</span>)))
</pre>
</div>
</div>
</li>

<li><a id="orgf4fbc11"></a>conf<br />
<div class="outline-text-6" id="text-orgf4fbc11">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> conf-mode
  <span style="font-weight: bold;">:delight</span> <span style="font-style: italic;">" CF"</span>)
</pre>
</div>
</div>
</li>

<li><a id="org0ce77d5"></a>generic-x<br />
<div class="outline-text-6" id="text-org0ce77d5">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> generic-x
  <span style="font-weight: bold;">:mode</span> ((<span style="font-style: italic;">"\\.conf$"</span>     . apache-conf-generic-mode)
         (<span style="font-style: italic;">"\\.htaccess$"</span> . apache-conf-generic-mode)))
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="org94a30f0"></a>special-mode derivatives<br />
<div class="outline-text-5" id="text-org94a30f0">
</div>

<ul class="org-ul">
<li><a id="orgbe3e753"></a>special mode<br />
<div class="outline-text-6" id="text-orgbe3e753">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(keymap-set special-mode-map <span style="font-style: italic;">"C-j"</span> #'push-button)
</pre>
</div>
</div>
</li>

<li><a id="orgdc634e0"></a>help<br />
<div class="outline-text-6" id="text-orgdc634e0">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">with-eval-after-load</span> 'help
  (keymap-set help-map <span style="font-style: italic;">"C-?"</span> #'help-for-help)
  (keymap-set help-map <span style="font-style: italic;">"c"</span> #'describe-face)
  (keymap-set help-map <span style="font-style: italic;">"K"</span> #'describe-keymap))
</pre>
</div>
</div>
</li>

<li><a id="org812339b"></a>woman<br />
<div class="outline-text-6" id="text-org812339b">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(autoload #'woman <span style="font-style: italic;">"woman"</span> nil t)
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="orgfc3afe2"></a>Programming<br />
<ul class="org-ul">
<li><a id="orgbab9195"></a>sMerge<br />
<div class="outline-text-6" id="text-orgbab9195">
<p>
sMerge can be used to solve merging problems. The code below kicks off sMerge if there is a collision sign.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(autoload 'smerge-mode <span style="font-style: italic;">"smerge-mode"</span> nil t)

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/try-smerge</span> ()
  (<span style="font-weight: bold;">save-excursion</span>
    (goto-char (point-min))
    (<span style="font-weight: bold;">when</span> (re-search-forward <span style="font-style: italic;">"^&lt;&lt;&lt;&lt;&lt;&lt;&lt; "</span> nil t)
      (smerge-mode 1))))
(add-hook 'find-file-hook 'my/try-smerge t)
</pre>
</div>
</div>
</li>

<li><a id="orge65b7f5"></a>Next Error<br />
<div class="outline-text-6" id="text-orge65b7f5">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">setopt</span> next-error-message-highlight t)
</pre>
</div>
</div>
</li>

<li><a id="org58c6818"></a>Hideshow<br />
<div class="outline-text-6" id="text-org58c6818">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> hideshow
  <span style="font-weight: bold;">:diminish</span> <span style="font-style: italic;">"hs"</span>
  <span style="font-weight: bold;">:bind</span> ((<span style="font-style: italic;">"C-c TAB"</span> . hs-toggle-hiding)))
</pre>
</div>
</div>
</li>

<li><a id="org185ea62"></a>imenu<br />
<div class="outline-text-6" id="text-org185ea62">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> imenu
  <span style="font-weight: bold;">:custom</span>
  (imenu-auto-rescan t))
</pre>
</div>
</div>
</li>
<li><a id="orga3d7552"></a>compile<br />
<div class="outline-text-6" id="text-orga3d7552">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> compile
  <span style="font-weight: bold;">:bind</span> (<span style="font-weight: bold;">:map</span> compilation-mode-map
              (<span style="font-style: italic;">"C-j"</span> . compile-goto-error)))
</pre>
</div>
</div>
</li>

<li><a id="org300270c"></a>grep<br />
<div class="outline-text-6" id="text-org300270c">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> grep
  <span style="font-weight: bold;">:custom</span>
  (grep-program <span style="font-style: italic;">"rg"</span>)
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">bind-keys</span> <span style="font-weight: bold;">:map</span> grep-mode-map
             (<span style="font-style: italic;">"C-j"</span> . compile-goto-error)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/grep-ripgrep-all</span> ()
  <span style="font-style: italic;">"Grep many kind of files like pdf, epub and more."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">let</span> ((grep-find-command '(<span style="font-style: italic;">"rga --with-filename --no-heading --line-number --color never -e '' ./* ./**/*"</span> . 66)))
    (call-interactively 'grep-find)))

(keymap-global-set <span style="font-style: italic;">"M-s R"</span> 'my/grep-ripgrep-all)
</pre>
</div>
</div>
</li>

<li><a id="org35b01c1"></a>executable<br />
<div class="outline-text-6" id="text-org35b01c1">
<p>
<a href="https://emacsredux.com/blog/2021/09/29/make-script-files-executable-automatically/">The post</a> says it is useful to set executable bit if the saved file seems to be script.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">with-eval-after-load</span> 'executable
  (add-hook 'after-save-hook
            'executable-make-buffer-file-executable-if-script-p))
</pre>
</div>
</div>
</li>

<li><a id="org48854e5"></a>Paren Showing<br />
<div class="outline-text-6" id="text-org48854e5">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> paren
  <span style="font-weight: bold;">:hook</span> (prog-mode . show-paren-local-mode)
  <span style="font-weight: bold;">:custom</span>
  (show-paren-style 'mixed)
  (show-paren-delay 0.2)
  (show-paren-mode nil)
  (show-paren-context-when-offscreen t))
</pre>
</div>
</div>
</li>

<li><a id="orgcb57992"></a>project<br />
<div class="outline-text-6" id="text-orgcb57992">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> project
  <span style="font-weight: bold;">:custom</span>
  (project-kill-buffers-display-buffer-list t)
  <span style="font-weight: bold;">:config</span>
  (add-to-list 'project-switch-commands
               '(project-dired <span style="font-style: italic;">"Dired root"</span>))
  (<span style="font-weight: bold;">with-eval-after-load</span> 'magit
    (<span style="font-weight: bold;">bind-keys</span> <span style="font-weight: bold;">:map</span> project-prefix-map
               (<span style="font-style: italic;">"M"</span> . magit-project-status))
    (add-to-list 'project-switch-commands
                 '(magit-project-status <span style="font-style: italic;">"Magit"</span>))))
</pre>
</div>
</div>
</li>

<li><a id="org31ff73e"></a>log-view<br />
<div class="outline-text-6" id="text-org31ff73e">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> log-view
  <span style="font-weight: bold;">:delight</span>
  (log-view-mode <span style="font-style: italic;">" LV"</span>)
  <span style="font-weight: bold;">:mode</span> (<span style="font-style: italic;">"\\.log$"</span> . log-view-mode)
  <span style="font-weight: bold;">:hook</span> ((log-view-mode . my/prog-mode-hook-function )
         (log-view-mode . auto-revert-tail-mode)))
</pre>
</div>
</div>
</li>

<li><a id="org879de2e"></a>vc (version control)<br />
<div class="outline-text-6" id="text-org879de2e">
</div>
</li>
<li><a id="orga0401cb"></a>vc-hooks<br />
<div class="outline-text-6" id="text-orga0401cb">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> vc-hooks
  <span style="font-weight: bold;">:custom</span>
  (vc-follow-symlinks t))
</pre>
</div>
</div>
</li>
</ul>
</li>
<li><a id="orgfd3535f"></a>Tree Sitter<br />
<div class="outline-text-5" id="text-orgfd3535f">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"tree-sitter"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> treesit
  <span style="font-weight: bold;">:preface</span>
  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/setup-install-grammars</span> ()
    <span style="font-style: italic;">"Install Tree-sitter grammars if they are absent."</span>
    (<span style="font-weight: bold;">interactive</span>)
    (<span style="font-weight: bold;">dolist</span> (grammar
             '(&lt;&lt;treesit-language-source&gt;&gt;))
      (add-to-list 'treesit-language-source-alist grammar)
      (<span style="font-weight: bold;">unless</span> (treesit-language-available-p (car grammar))
        (treesit-install-language-grammar (car grammar)))))
  <span style="font-weight: bold;">:config</span>
  (my/setup-install-grammars))
</pre>
</div>
</div>

<ul class="org-ul">
<li><a id="org6c998ef"></a>combobulate<br />
<div class="outline-text-6" id="text-org6c998ef">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> combobulate
  <span style="font-weight: bold;">:disabled</span> t
  <span style="font-weight: bold;">:after</span> treesit
  <span style="font-weight: bold;">:preface</span>
  (<span style="font-weight: bold;">setq</span> combobulate-key-prefix <span style="font-style: italic;">"C-c o"</span>)
  <span style="font-weight: bold;">:hook</span> (&lt;&lt;combobulate-hook&gt;&gt;)
  <span style="font-weight: bold;">:load-path</span> (<span style="font-style: italic;">"~/.emacs.d/site-elisp/combobulate/"</span>))
</pre>
</div>
</div>
</li>

<li><a id="org35851dc"></a>major mode remapping<br />
<div class="outline-text-6" id="text-org35851dc">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">setq</span> major-mode-remap-alist
      '(&lt;&lt;major-mode-remap-rule&gt;&gt;))
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="orgaada196"></a>Elisp Package Development<br />
<div class="outline-text-5" id="text-orgaada196">
</div>

<ul class="org-ul">
<li><a id="orgcb2ea35"></a>package build<br />
<div class="outline-text-6" id="text-orgcb2ea35">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-package-build"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">let</span> ((default-directory package-user-dir))
  (<span style="font-weight: bold;">setopt</span> package-build-recipes-dir
          (expand-file-name <span style="font-style: italic;">"recipes"</span>)
          package-build-archive-dir
          (expand-file-name <span style="font-style: italic;">"packages"</span>)
          package-build-working-dir
          (expand-file-name <span style="font-style: italic;">"working"</span>)))
</pre>
</div>
</div>
</li>

<li><a id="org5894f08"></a>flycheck package<br />
<div class="outline-text-6" id="text-org5894f08">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-flycheck-package"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(eval-after-load 'flycheck
  '(flycheck-package-setup))
</pre>
</div>
</div>
</li>

<li><a id="org14add80"></a>package lint<br />
<div class="outline-text-6" id="text-org14add80">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-package-lint"</span>
</pre>
</div>
</div>
</li>

<li><a id="org1899acc"></a>makem.sh<br />
<div class="outline-text-6" id="text-org1899acc">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">makem</span>)
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="org4f53da3"></a>Blogging<br />
<div class="outline-text-5" id="text-org4f53da3">
<p>
This subtree holds resources for <a href="https://p-snow.org/">my blog</a>.
</p>
</div>

<ul class="org-ul">
<li><a id="org1686b25"></a>org-static-blog&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span><br /></li>

<li><a id="orgf621b56"></a>templates for blogging<br />
<div class="outline-text-6" id="text-orgf621b56">
<div class="org-src-container">
<pre class="src src-emacs-lisp" id="org6bbc4e9">(blog-post-filename (format-time-string <span style="font-style: italic;">"%Y%m%d-%H%M.org"</span>))
(blog-post-dotfile-url <span style="font-style: italic;">"https://p-snow.org/config/dotfiles.html#"</span>)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp" id="org1e6da17">(blog-post-skeleton <span style="font-style: italic;">"#+title:"</span> n
                    <span style="font-style: italic;">"#+date:"</span> n
                    <span style="font-style: italic;">"#+description:"</span> n
                    <span style="font-style: italic;">"#+filetags:"</span> n n
                    <span style="font-style: italic;">"#+SETUPFILE: "</span>
                    (<span style="font-weight: bold;">pcase</span> (file-name-base (directory-file-name default-directory))
                      (<span style="font-style: italic;">"posts"</span> <span style="font-style: italic;">"diary/header"</span>)
                      (<span style="font-style: italic;">"org-content"</span> <span style="font-style: italic;">"header"</span>)))
(blog-post-macro-preview <span style="font-style: italic;">"{{{preview-begin}}}"</span> n
                         <span style="font-style: italic;">"{{{preview-end}}}"</span>)
(blog-post-macro-accordion (p <span style="font-style: italic;">"Summary: "</span> summary t)
                           (format <span style="font-style: italic;">"{{{accordion-begin(%s)}}}"</span> summary) n
                           <span style="font-style: italic;">"{{{accordion-end}}}"</span>)
</pre>
</div>
</div>
</li>

<li><a id="org26e11be"></a>ox-haunt<br />
<div class="outline-text-6" id="text-org26e11be">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-ox-haunt"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> ox-haunt
  <span style="font-weight: bold;">:after</span> ox)
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="org59dd48a"></a>Journaling<br />
<div class="outline-text-5" id="text-org59dd48a">
</div>

<ul class="org-ul">
<li><a id="org7362b0d"></a>journal entry template<br />
<div class="outline-text-6" id="text-org7362b0d">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(journal <span style="font-style: italic;">"- diary"</span> n&gt;
         <span style="font-style: italic;">"#+begin_src text"</span> n&gt; <span style="font-style: italic;">"#+end_src"</span> n
         <span style="font-style: italic;">"- clocktable"</span> n&gt;
         <span style="font-style: italic;">"#+begin: clocktable-by-tag :maxlevel 3 :wstart 1 "</span>
         <span style="font-style: italic;">":block "</span> (p <span style="font-style: italic;">"year"</span>) <span style="font-style: italic;">"-"</span> (p <span style="font-style: italic;">"month"</span>) <span style="font-style: italic;">"-"</span> (p <span style="font-style: italic;">"day"</span>) n&gt;
         <span style="font-style: italic;">"#+end:"</span> n
         <span style="font-style: italic;">"- agenda"</span> n&gt;
         <span style="font-style: italic;">"#+begin_example"</span> n
         (p <span style="font-style: italic;">"agenda"</span>) n&gt;
         <span style="font-style: italic;">"#+end_example"</span>)
</pre>
</div>
</div>
</li>

<li><a id="org2ff7967"></a>week subtree template<br />
<div class="outline-text-6" id="text-org2ff7967">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(nw &amp; <span style="font-style: italic;">"- mission [/]"</span> n
    <span style="font-style: italic;">"- clocktable"</span> n&gt;
    <span style="font-style: italic;">"#+begin: clocktable-by-tag :maxlevel 3 "</span>
    <span style="font-style: italic;">":block "</span> (p <span style="font-style: italic;">"year"</span>) <span style="font-style: italic;">"-W"</span> (p <span style="font-style: italic;">"isoweek"</span>) <span style="font-style: italic;">" :wstart 1"</span> n&gt;
    <span style="font-style: italic;">"#+end:"</span> n
    <span style="font-style: italic;">"- meta-projects"</span> n&gt;
    <span style="font-style: italic;">"#+begin: clocktable :maxlevel 3 :scope agenda "</span>
    <span style="font-style: italic;">":block "</span> (p <span style="font-style: italic;">"year"</span>) <span style="font-style: italic;">"-W"</span> (p <span style="font-style: italic;">"isoweek"</span>)
    <span style="font-style: italic;">" :wstart 1 :narrow 40! :tcolumns 3 :formula %"</span> n&gt;
    <span style="font-style: italic;">"#+end:"</span>)
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="org70ad3d4"></a>External Emacs Packages<br />
<div class="outline-text-5" id="text-org70ad3d4">
<p>
Packages below are out of categories above. Packages which have ARCHIVE tag is no longer in use. Keywords which package gives in its description are set to tag.
</p>
</div>

<ul class="org-ul">
<li><a id="org4d4fbb9"></a>git-modes<br />
<div class="outline-text-6" id="text-org4d4fbb9">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-git-modes"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> git-modes)
</pre>
</div>
</div>
</li>

<li><a id="orga9108e5"></a>git-annex<br />
<div class="outline-text-6" id="text-orga9108e5">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-git-annex"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-style: italic;">"https://github.com/jwiegley/git-annex-el/releases.atom"</span> soft_update)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> git-annex
  <span style="font-weight: bold;">:after</span> dired
  <span style="font-weight: bold;">:custom-face</span>
  (git-annex-dired-annexed-available ((t (<span style="font-weight: bold;">:foreground</span> <span style="font-style: italic;">"green yellow"</span>))))
  (git-annex-dired-annexed-unavailable ((t (<span style="font-weight: bold;">:foreground</span> <span style="font-style: italic;">"red3"</span>)))))
</pre>
</div>
</div>
</li>

<li><a id="org39f5083"></a>magit-annex&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span><br /></li>

<li><a id="org2b26b62"></a>orgit<br />
<div class="outline-text-6" id="text-org2b26b62">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-orgit"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> orgit
  <span style="font-weight: bold;">:after</span> my/org-mode-init
  <span style="font-weight: bold;">:custom</span>
  (orgit-remote <span style="font-style: italic;">"github"</span>))
</pre>
</div>
</div>
</li>

<li><a id="orge0d715a"></a>suggest<br />
<div class="outline-text-6" id="text-orge0d715a">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-suggest"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> suggest
  <span style="font-weight: bold;">:commands</span> suggest
  <span style="font-weight: bold;">:custom</span>
  (suggest-insert-example-on-start nil))
</pre>
</div>
</div>
</li>

<li><a id="org15a3d25"></a>mastodon<br />
<div class="outline-text-6" id="text-org15a3d25">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-mastodon"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> mastodon
  <span style="font-weight: bold;">:after</span> my-launch-app
  <span style="font-weight: bold;">:bind</span> (<span style="font-weight: bold;">:map</span> my/launch-app-map
              (<span style="font-style: italic;">"@"</span> . mastodon))
  <span style="font-weight: bold;">:hook</span> (mastodon-mode . visual-line-mode)
  <span style="font-weight: bold;">:custom</span>
  (mastodon-active-user <span style="font-style: italic;">"p_snow"</span>)
  (mastodon-instance-url <span style="font-style: italic;">"https://social.linux.pizza"</span>)
  (mastodon-client--token-file
   (no-littering-expand-var-file-name <span style="font-style: italic;">"mastodon.plstore"</span>))
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">mastodon-views</span>))
</pre>
</div>
</div>
</li>

<li><a id="orgc3e7b1a"></a>bookmark+&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span><br /></li>

<li><a id="orgef6cc6f"></a>chatgpt-shell<br />
<div class="outline-text-6" id="text-orgef6cc6f">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-chatgpt-shell"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> chatgpt-shell
  <span style="font-weight: bold;">:after</span> engine-mode
  <span style="font-weight: bold;">:preface</span>
  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/chatgpt-shell-dwim</span> ()
    <span style="font-style: italic;">"docstring"</span>
    (<span style="font-weight: bold;">interactive</span>)
    (<span style="font-weight: bold;">if</span> (use-region-p)
        (chatgpt-shell-prompt-compose)
      (chatgpt-shell)))
  <span style="font-weight: bold;">:bind</span> (<span style="font-weight: bold;">:map</span> engine-mode-prefixed-map
              (<span style="font-style: italic;">"p c"</span> . my/chatgpt-shell-dwim)
              (<span style="font-style: italic;">"p C"</span> . chatgpt-shell-prompt)
              (<span style="font-style: italic;">"p e"</span> . chatgpt-shell-explain-code)
              (<span style="font-style: italic;">"p d"</span> . chatgpt-shell-describe-code)
              (<span style="font-style: italic;">"p p"</span> . chatgpt-shell-proofread-region)
              (<span style="font-style: italic;">"p g"</span> . chatgpt-shell-write-git-commit)
              (<span style="font-style: italic;">"p u"</span> . chatgpt-shell-generate-unit-test)
              (<span style="font-style: italic;">"p i"</span> . (<span style="font-weight: bold;">lambda</span> (<span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> lang)
                         <span style="font-style: italic;">"Ask ChatGPT to interpret into Japanese or some other language if LANG is non-nil."</span>
                         (<span style="font-weight: bold;">interactive</span> <span style="font-style: italic;">"P"</span>)
                         (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">chatgpt-shell</span> nil t)
                           (chatgpt-shell-send-region-with-header
                            (format <span style="font-style: italic;">"Please help me interpret the following sentence into %s:"</span>
                                    (<span style="font-weight: bold;">if</span> (equal lang '(4))
                                        (completing-read <span style="font-style: italic;">"Langauage: "</span> '(<span style="font-style: italic;">"Japanese"</span> <span style="font-style: italic;">"English"</span> <span style="font-style: italic;">"German"</span>))
                                      <span style="font-style: italic;">"Japanese"</span>))))))
              <span style="font-weight: bold;">:map</span> chatgpt-shell-mode-map
              (<span style="font-style: italic;">"C-M-g"</span> . chatgpt-shell-clear-buffer))
  <span style="font-weight: bold;">:custom</span>
  (chatgpt-shell-openai-key 'my/credential-info)
  (chatgpt-shell-system-prompt 3)
  (chatgpt-shell-model-temperature 0.6))

(<span style="font-weight: bold;">use-package</span> ob-chatgpt-shell
  <span style="font-weight: bold;">:after</span> (chatgpt-shell ob-core)
  <span style="font-weight: bold;">:config</span>
  (ob-chatgpt-shell-setup)
  (add-to-list 'org-structure-template-alist
               '(<span style="font-style: italic;">"ch"</span> . <span style="font-style: italic;">"src chatgpt-shell"</span>)
               t))

(<span style="font-weight: bold;">use-package</span> dall-e-shell
  <span style="font-weight: bold;">:commands</span> dall-e-shell
  <span style="font-weight: bold;">:custom</span>
  (dall-e-shell-openai-key 'my/credential-info))
</pre>
</div>
</div>
</li>

<li><a id="org562979c"></a>async<br />
<div class="outline-text-6" id="text-org562979c">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-async"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> dired-async
  <span style="font-weight: bold;">:after</span> dired
  <span style="font-weight: bold;">:config</span>
  (dired-async-mode 1))

(<span style="font-weight: bold;">use-package</span> async-bytecomp
  <span style="font-weight: bold;">:custom</span>
  (async-bytecomp-package-mode t))
</pre>
</div>
</div>
</li>

<li><a id="orgdf149d1"></a>visible-mark&#xa0;&#xa0;&#xa0;<span class="tag"><span class="marking">marking</span>&#xa0;<span class="faces">faces</span>&#xa0;<span class="color">color</span></span><br />
<div class="outline-text-6" id="text-orgdf149d1">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> visible-mark
  <span style="font-weight: bold;">:ensure</span> t
  <span style="font-weight: bold;">:config</span>
  (global-visible-mark-mode 1))
</pre>
</div>
</div>
</li>

<li><a id="org9192a0c"></a>ement&#xa0;&#xa0;&#xa0;<span class="tag"><span class="comm">comm</span></span><br />
<div class="outline-text-6" id="text-org9192a0c">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-ement"</span>
</pre>
</div>
</div>
</li>

<li><a id="orga7a95ee"></a>ligature&#xa0;&#xa0;&#xa0;<span class="tag"><span class="extensions">extensions</span>&#xa0;<span class="data">data</span></span><br />
<div class="outline-text-6" id="text-orga7a95ee">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-ligature"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> ligature
  <span style="font-weight: bold;">:hook</span> (prog-mode . ligature-mode)
  <span style="font-weight: bold;">:config</span>
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">ligatures below are supported by `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">Iosevka</span><span style="font-weight: bold; font-style: italic;">' font</span>
  (ligature-set-ligatures 'prog-mode
                          '(<span style="font-style: italic;">"-&lt;&lt;"</span> <span style="font-style: italic;">"-&lt;"</span> <span style="font-style: italic;">"-&lt;-"</span> <span style="font-style: italic;">"&lt;--"</span> <span style="font-style: italic;">"&lt;---"</span> <span style="font-style: italic;">"&lt;&lt;-"</span> <span style="font-style: italic;">"&lt;-"</span> <span style="font-style: italic;">"-&gt;"</span> <span style="font-style: italic;">"-&gt;&gt;"</span> <span style="font-style: italic;">"--&gt;"</span> <span style="font-style: italic;">"---&gt;"</span> <span style="font-style: italic;">"-&gt;-"</span> <span style="font-style: italic;">"&gt;-"</span> <span style="font-style: italic;">"&gt;&gt;-"</span>
                            <span style="font-style: italic;">"=&lt;&lt;"</span> <span style="font-style: italic;">"=&lt;"</span> <span style="font-style: italic;">"=&lt;="</span> <span style="font-style: italic;">"&lt;=="</span> <span style="font-style: italic;">"&lt;==="</span> <span style="font-style: italic;">"&lt;&lt;="</span> <span style="font-style: italic;">"&lt;="</span> <span style="font-style: italic;">"=&gt;"</span> <span style="font-style: italic;">"=&gt;&gt;"</span> <span style="font-style: italic;">"==&gt;"</span> <span style="font-style: italic;">"===&gt;"</span> <span style="font-style: italic;">"=&gt;="</span> <span style="font-style: italic;">"&gt;="</span> <span style="font-style: italic;">"&gt;&gt;="</span>
                            <span style="font-style: italic;">"&lt;-&gt;"</span> <span style="font-style: italic;">"&lt;--&gt;"</span> <span style="font-style: italic;">"&lt;---&gt;"</span> <span style="font-style: italic;">"&lt;----&gt;"</span> <span style="font-style: italic;">"&lt;=&gt;"</span> <span style="font-style: italic;">"&lt;==&gt;"</span> <span style="font-style: italic;">"&lt;===&gt;"</span> <span style="font-style: italic;">"&lt;====&gt;"</span> <span style="font-style: italic;">"::"</span> <span style="font-style: italic;">":::"</span> <span style="font-style: italic;">"__"</span>
                            <span style="font-style: italic;">"&lt;~~"</span> <span style="font-style: italic;">"&lt;/"</span> <span style="font-style: italic;">"&lt;/&gt;"</span> <span style="font-style: italic;">"/&gt;"</span> <span style="font-style: italic;">"~~&gt;"</span> <span style="font-style: italic;">"=="</span> <span style="font-style: italic;">"!="</span> <span style="font-style: italic;">"/="</span> <span style="font-style: italic;">"~="</span> <span style="font-style: italic;">"&lt;&gt;"</span> <span style="font-style: italic;">"==="</span> <span style="font-style: italic;">"!=="</span> <span style="font-style: italic;">"!==="</span> <span style="font-style: italic;">"=/="</span> <span style="font-style: italic;">"=!="</span>
                            <span style="font-style: italic;">"&lt;:"</span> <span style="font-style: italic;">":="</span> <span style="font-style: italic;">"*="</span> <span style="font-style: italic;">"*+"</span> <span style="font-style: italic;">"&lt;*"</span> <span style="font-style: italic;">"&lt;*&gt;"</span> <span style="font-style: italic;">"*&gt;"</span> <span style="font-style: italic;">"&lt;|"</span> <span style="font-style: italic;">"&lt;|&gt;"</span> <span style="font-style: italic;">"|&gt;"</span> <span style="font-style: italic;">"&lt;."</span> <span style="font-style: italic;">"&lt;.&gt;"</span> <span style="font-style: italic;">".&gt;"</span> <span style="font-style: italic;">"+*"</span> <span style="font-style: italic;">"=*"</span> <span style="font-style: italic;">"=:"</span> <span style="font-style: italic;">":&gt;"</span>
                            <span style="font-style: italic;">"(*"</span> <span style="font-style: italic;">"*)"</span> <span style="font-style: italic;">"/*"</span> <span style="font-style: italic;">"*/"</span> <span style="font-style: italic;">"[|"</span> <span style="font-style: italic;">"|]"</span> <span style="font-style: italic;">"{|"</span> <span style="font-style: italic;">"|}"</span> <span style="font-style: italic;">"++"</span> <span style="font-style: italic;">"+++"</span> <span style="font-style: italic;">"\\/"</span> <span style="font-style: italic;">"/\\"</span> <span style="font-style: italic;">"|-"</span> <span style="font-style: italic;">"-|"</span> <span style="font-style: italic;">"&lt;!--"</span> <span style="font-style: italic;">"&lt;!---"</span>)))
</pre>
</div>
</div>
</li>

<li><a id="orgf653071"></a>meow&#xa0;&#xa0;&#xa0;<span class="tag"><span class="modal_editing">modal_editing</span>&#xa0;<span class="convenience">convenience</span>&#xa0;<span class="ARCHIVE">ARCHIVE</span></span><br /></li>

<li><a id="org1115e04"></a>enlive&#xa0;&#xa0;&#xa0;<span class="tag"><span class="selector">selector</span>&#xa0;<span class="query">query</span>&#xa0;<span class="css">css</span></span><br />
<div class="outline-text-6" id="text-org1115e04">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-enlive"</span>
</pre>
</div>
</div>
</li>

<li><a id="emacs-gptel"></a>gptel&#xa0;&#xa0;&#xa0;<span class="tag"><span class="convenience">convenience</span></span><br />
<div class="outline-text-6" id="text-emacs-gptel">
<p>
<a href="https://github.com/karthink/gptel">gptel</a> is my go-to AI frontend in Emacs as of <span class="timestamp-wrapper"><span class="timestamp">[2024-07-19 Fri]</span></span>. It supports a large number of services (LLM models).
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> gptel
  <span style="font-weight: bold;">:ensure</span> t
  <span style="font-weight: bold;">:after</span> engine-mode
  <span style="font-weight: bold;">:bind</span> (<span style="font-style: italic;">"H-Q"</span> . my/gpeel-invoke)
  <span style="font-weight: bold;">:preface</span>
  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/gpeel-invoke</span> (<span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> arg)
    <span style="font-style: italic;">"Enable users to call gptel/gptel-menu/gptel-send by changing prefix argument."</span>
    (<span style="font-weight: bold;">interactive</span> <span style="font-style: italic;">"P"</span>)
    (call-interactively (<span style="font-weight: bold;">pcase</span> arg
                          ('(16) #'gptel)
                          ('(4) #'gptel-menu)
                          (default #'gptel-send))))
  <span style="font-weight: bold;">:custom</span>
  (gptel-api-key (apply-partially #'my/credential-info <span style="font-style: italic;">"openai.com"</span> <span style="font-style: italic;">"apikey"</span>))
  (gptel-max-tokens 500)
  (gptel-model <span style="font-style: italic;">"gpt-4o-mini"</span>)
  (gptel-default-mode 'org-mode)
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">cl-pushnew</span> '(proofreading . <span style="font-style: italic;">"Please help me proofread the following text with English."</span>)
              gptel-directives)
  (<span style="font-weight: bold;">cl-pushnew</span> '(commit-message-pr . <span style="font-style: italic;">"Please help me proofread the following text as a commit message for Git."</span>)
              gptel-directives)
  (<span style="font-weight: bold;">cl-pushnew</span> '(japanese . <span style="font-style: italic;">"Please help me interpret the following sentence into Japanese."</span>)
              gptel-directives)
  (<span style="font-weight: bold;">cl-pushnew</span> '(english . <span style="font-style: italic;">"Please help me interpret the following sentence into English."</span>)
              gptel-directives)
  (gptel-make-gemini <span style="font-style: italic;">"Gemini"</span>
    <span style="font-weight: bold;">:key</span> (apply-partially 'my/credential-info <span style="font-style: italic;">"www.google.com/&lt;&lt;full-name&gt;&gt;"</span> <span style="font-style: italic;">"gemini apikey"</span>)
    <span style="font-weight: bold;">:stream</span> t)
  (gptel-make-openai <span style="font-style: italic;">"Perplexity"</span>
    <span style="font-weight: bold;">:host</span> <span style="font-style: italic;">"api.perplexity.ai"</span>
    <span style="font-weight: bold;">:key</span> (apply-partially 'my/credential-info <span style="font-style: italic;">"perplexity.ai"</span>)
    <span style="font-weight: bold;">:endpoint</span> <span style="font-style: italic;">"/chat/completions"</span>
    <span style="font-weight: bold;">:stream</span> t
    <span style="font-weight: bold;">:models</span> '(<span style="font-style: italic;">"llama-3.1-sonar-small-128k-online"</span>
              <span style="font-style: italic;">"llama-3.1-sonar-large-128k-online"</span>
              <span style="font-style: italic;">"llama-3.1-sonar-small-128k-chat"</span>
              <span style="font-style: italic;">"llama-3.1-sonar-large-128k-chat"</span>
              <span style="font-style: italic;">"llama-3.1-70b-instruct"</span>
              <span style="font-style: italic;">"llama-3.1-8b-instruct"</span>)))
</pre>
</div>
</div>
</li>

<li><a id="orgfca91ef"></a>engine-mode<br />
<div class="outline-text-6" id="text-orgfca91ef">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-engine-mode"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp" id="org6b68d2b">(<span style="font-weight: bold;">use-package</span> engine-mode
  <span style="font-weight: bold;">:preface</span>
  (<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">engine/minibuffer-history</span> nil
    <span style="font-style: italic;">"Minibuffer history for `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">engine-mode</span><span style="font-style: italic;">'."</span>)
  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">engine--history-search-term</span> (engine-name)
    <span style="font-style: italic;">"Prompt the user for a search term for ENGINE-NAME.</span>
<span style="font-style: italic;">Default to the symbol at point."</span>
    (<span style="font-weight: bold;">let</span> ((current-word (<span style="font-weight: bold;">or</span> (thing-at-point 'symbol 'no-properties) <span style="font-style: italic;">""</span>)))
      (read-string (engine--search-prompt engine-name current-word)
                   nil 'engine/minibuffer-history current-word)))
  <span style="font-weight: bold;">:config</span>
  (advice-add 'engine--prompted-search-term <span style="font-weight: bold;">:override</span>
              'engine--history-search-term)
  (engine/set-keymap-prefix (kbd <span style="font-style: italic;">"H-q"</span>))
  (engine-mode 1)
  (defengine google
    <span style="font-style: italic;">"https://www.google.com/search?ie=utf-8&amp;oe=utf-8&amp;q=%s"</span>
    <span style="font-weight: bold;">:keybinding</span> <span style="font-style: italic;">"g"</span>)
  (defengine duckduckgo
    <span style="font-style: italic;">"https://duckduckgo.com/?q=%s"</span>
    <span style="font-weight: bold;">:keybinding</span> <span style="font-style: italic;">"d"</span>)
  (defengine youtube
    <span style="font-style: italic;">"https://www.youtube.com/results?aq=f&amp;oq=&amp;search_query=%s"</span>
    <span style="font-weight: bold;">:keybinding</span> <span style="font-style: italic;">"y"</span>)
  (defengine github
    <span style="font-style: italic;">"https://github.com/search?ref=simplesearch&amp;q=%s"</span>
    <span style="font-weight: bold;">:keybinding</span> <span style="font-style: italic;">"h"</span>)
  (defengine amazon
    <span style="font-style: italic;">"https://www.amazon.co.jp/gp/search/?field-keywords=%s"</span>
    <span style="font-weight: bold;">:keybinding</span> <span style="font-style: italic;">"a"</span>)
  (defengine melpa
    <span style="font-style: italic;">"https://melpa.org/#/?q=%s"</span>
    <span style="font-weight: bold;">:keybinding</span> <span style="font-style: italic;">"m"</span>)
  (defengine eijiro
    <span style="font-style: italic;">"https://eow.alc.co.jp/search?q=%s"</span>
    <span style="font-weight: bold;">:keybinding</span> <span style="font-style: italic;">"e"</span>)
  (defengine weblio
    <span style="font-style: italic;">"https://www.weblio.jp/content/%s"</span>
    <span style="font-weight: bold;">:keybinding</span> <span style="font-style: italic;">"l"</span>)
  (defengine wikipedia-ja
    <span style="font-style: italic;">"https://ja.wikipedia.org/wiki/%s"</span>
    <span style="font-weight: bold;">:keybinding</span> <span style="font-style: italic;">"w"</span>)
  (defengine wikipedia
    <span style="font-style: italic;">"https://en.wikipedia.org/wiki/%s"</span>
    <span style="font-weight: bold;">:keybinding</span> <span style="font-style: italic;">"W"</span>))
</pre>
</div>
</div>
</li>

<li><a id="org30da90c"></a>tmr&#xa0;&#xa0;&#xa0;<span class="tag"><span class="timer">timer</span>&#xa0;<span class="convenience">convenience</span></span><br />
<div class="outline-text-6" id="text-org30da90c">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-tmr"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> tmr
  <span style="font-weight: bold;">:after</span> my-launch-app
  <span style="font-weight: bold;">:bind</span> (<span style="font-weight: bold;">:map</span> my/launch-app-map
              (<span style="font-style: italic;">"t"</span> . tmr)))
</pre>
</div>
</div>
</li>

<li><a id="orgf32dc4d"></a>beframe<br />
<div class="outline-text-6" id="text-orgf32dc4d">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-beframe"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> beframe
  <span style="font-weight: bold;">:ensure</span> t
  <span style="font-weight: bold;">:bind</span> ((<span style="font-style: italic;">"C-x B"</span> . beframe-switch-buffer)
         (<span style="font-style: italic;">"C-x C-b"</span> . beframe-buffer-menu))
  <span style="font-weight: bold;">:custom</span>
  (beframe-global-buffers '(<span style="font-style: italic;">"*Messages*"</span> <span style="font-style: italic;">"*Backtrace*"</span>))
  (beframe-create-frame-scratch-buffer nil)
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">with-eval-after-load</span> 'consult
    (<span style="font-weight: bold;">defface</span> <span style="font-weight: bold; font-style: italic;">beframe-buffer</span>
      '((t <span style="font-weight: bold;">:inherit</span> font-lock-string-face))
      <span style="font-style: italic;">"Face for `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">consult</span><span style="font-style: italic;">' framed buffers."</span>)
    (<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">beframe--consult-source</span>
      `( <span style="font-weight: bold;">:name</span>     <span style="font-style: italic;">"Frame-specific buffers (current frame)"</span>
         <span style="font-weight: bold;">:narrow</span>   ?F
         <span style="font-weight: bold;">:category</span> buffer
         <span style="font-weight: bold;">:face</span>     beframe-buffer
         <span style="font-weight: bold;">:history</span>  beframe-history
         <span style="font-weight: bold;">:items</span>    ,#'beframe--buffer-names
         <span style="font-weight: bold;">:action</span>   ,#'switch-to-buffer
         <span style="font-weight: bold;">:state</span>    ,#'consult--buffer-state))
    (add-to-list 'consult-buffer-sources 'beframe--consult-source))
  (beframe-mode 1))
</pre>
</div>
</div>
</li>

<li><a id="org812506f"></a>free-keys&#xa0;&#xa0;&#xa0;<span class="tag"><span class="convenience">convenience</span></span><br />
<div class="outline-text-6" id="text-org812506f">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-free-keys"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> free-keys
  <span style="font-weight: bold;">:after</span> my-launch-app
  <span style="font-weight: bold;">:bind</span> (<span style="font-weight: bold;">:map</span> my/launch-app-map
              (<span style="font-style: italic;">"f"</span> . free-keys))
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">setq</span> free-keys-modifiers (append free-keys-modifiers
                                    '(<span style="font-style: italic;">"H"</span>))))
</pre>
</div>
</div>
</li>

<li><a id="org3b47e20"></a>consult-recoll&#xa0;&#xa0;&#xa0;<span class="tag"><span class="docs">docs</span>&#xa0;<span class="convenience">convenience</span></span><br />
<div class="outline-text-6" id="text-org3b47e20">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> consult-recoll
  <span style="font-weight: bold;">:ensure</span> t
  <span style="font-weight: bold;">:after</span> consult
  <span style="font-weight: bold;">:bind</span> (<span style="font-style: italic;">"M-s c"</span> . consult-recoll)
  <span style="font-weight: bold;">:preface</span>
  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/consult-recoll--html</span> (file)
    (<span style="font-weight: bold;">let</span> ((mime (mailcap-extension-to-mime (file-name-extension file))))
      (<span style="font-weight: bold;">cond</span>
       ((string= mime (regexp-quote <span style="font-style: italic;">"application/epub+zip"</span>))
        (my/open-epub-as-html file))
       (t (eww-open-file file)))))
  <span style="font-weight: bold;">:custom</span>
  (consult-recoll-open-fns
   '((<span style="font-style: italic;">"text/html"</span> . my/consult-recoll--html)
     (<span style="font-style: italic;">"application/pdf"</span> . my/open-pdf-as-html))))
</pre>
</div>
</div>
</li>

<li><a id="org3022467"></a>detached&#xa0;&#xa0;&#xa0;<span class="tag"><span class="processes">processes</span>&#xa0;<span class="convenience">convenience</span></span><br />
<div class="outline-text-6" id="text-org3022467">
<p>
How to use detached.el
</p>
<ul class="org-ul">
<li>in vterm
<ol class="org-ol">
<li>create a session with S-RET(detached-vterm-send-input)</li>
<li>detach from the session with C-c C-d(detached-detach-key)</li>
<li>attach to the session with C-RET(detached-vterm-attach)</li>
</ol></li>
<li>with shell-command
<ul class="org-ul">
<li>invoke/call detached-shell-command</li>
</ul></li>
</ul>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"dtach"</span>
<span style="font-style: italic;">"emacs-detached"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> detached
  <span style="font-weight: bold;">:init</span>
  (detached-init)
  (<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my/detached-bury-buffer</span> nil)
  <span style="font-weight: bold;">:bind</span>
  (([remap async-shell-command] . detached-shell-command)
   ([remap compile] . detached-compile)
   ([remap recompile] . detached-compile-recompile))
  <span style="font-weight: bold;">:custom</span>
  (detached-shell-command-initial-input nil)
  (detached-terminal-data-command system-type)
  (detached-terminal-data-command system-type)
  <span style="font-weight: bold;">:config</span>
  (add-to-list 'display-buffer-alist
               `((<span style="font-weight: bold;">lambda</span> (buffer-or-name arg)
                   (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">and</span> (string-match-p
                               (regexp-opt (list detached--shell-command-buffer))
                               (<span style="font-weight: bold;">cond</span>
                                ((stringp buffer-or-name) buffer-or-name)
                                ((bufferp buffer-or-name) (buffer-name buffer-or-name))))
                              my/detached-bury-buffer)
                     (<span style="font-weight: bold;">setq</span> my/detached-bury-buffer nil)
                     t))
                 (display-buffer-reuse-window)
                 (body-function
                  . (<span style="font-weight: bold;">lambda</span> (window) (<span style="font-weight: bold;">interactive</span>)
                      (bury-buffer))))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/org-link--open-shell-detached</span> (path _)
  <span style="font-style: italic;">"Open a \"shell\" type.</span>

<span style="font-style: italic;">PATH is the command to execute with `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">detached-shell-command</span><span style="font-style: italic;">'."</span>
  (<span style="font-weight: bold;">if</span> (<span style="font-weight: bold;">or</span> (<span style="font-weight: bold;">and</span> (org-string-nw-p org-link-shell-skip-confirm-regexp)
               (string-match-p org-link-shell-skip-confirm-regexp path))
          (not org-link-shell-confirm-function)
          (funcall org-link-shell-confirm-function
                   (format <span style="font-style: italic;">"Execute %s in shell? "</span>
                           (org-add-props path nil 'face 'org-warning))))
      (<span style="font-weight: bold;">progn</span>
        (message <span style="font-style: italic;">"Executing %s"</span> path)
        (detached-shell-command path))
    (<span style="font-weight: bold;">user-error</span> <span style="font-style: italic;">"Abort"</span>)))

(<span style="font-weight: bold;">with-eval-after-load</span> 'ol
  (org-link-set-parameters <span style="font-style: italic;">"shell"</span> <span style="font-weight: bold;">:follow</span> #'my/org-link--open-shell-detached))

(<span style="font-weight: bold;">use-package</span> detached-list
  <span style="font-weight: bold;">:after</span> my-launch-app
  <span style="font-weight: bold;">:bind</span> (<span style="font-weight: bold;">:map</span> my/invoke-list-command-map
              (<span style="font-style: italic;">"d"</span> . detached-list-sessions))
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">bind-keys</span> <span style="font-weight: bold;">:map</span> detached-list-mode-map
             (<span style="font-style: italic;">"C-m"</span> . detached-list-open-session)
             (<span style="font-style: italic;">"C-j"</span> . detached-list-open-session)))
</pre>
</div>
</div>
</li>

<li><a id="orge2fd2b7"></a>emacs-guix&#xa0;&#xa0;&#xa0;<span class="tag"><span class="tools">tools</span></span><br />
<div class="outline-text-6" id="text-orge2fd2b7">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-guix"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> guix
  <span style="font-weight: bold;">:commands</span> guix
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">with-eval-after-load</span> 'my-launch-app
    (<span style="font-weight: bold;">bind-keys</span> <span style="font-weight: bold;">:map</span> my/launch-app-map
               (<span style="font-style: italic;">"x"</span> . guix))))
</pre>
</div>
</div>
</li>

<li><a id="orgf6dfaa4"></a>pcre2el<br />
<div class="outline-text-6" id="text-orgf6dfaa4">
<p>
<a href="https://github.com/joddie/pcre2el">pcre2el</a> is not only the converter between PCRE, emacs lisp style regexp and RX representation. It support re-builder as a conversion environment. Great!
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-pcre2el"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> pcre2el)
</pre>
</div>
</div>
</li>

<li><a id="org5109eb8"></a>iedit&#xa0;&#xa0;&#xa0;<span class="tag"><span class="simultaneous">simultaneous</span>&#xa0;<span class="region">region</span>&#xa0;<span class="refactoring">refactoring</span>&#xa0;<span class="occurrence">occurrence</span></span><br />
<div class="outline-text-6" id="text-org5109eb8">
<p>
<a href="https://github.com/victorhge/iedit">IEdit</a> is not only replacement for M-%/C-M-% but it highlights symbol occurences to change. <a href="https://www.masteringemacs.org/article/iedit-interactive-multi-occurrence-editing-in-your-buffer">This advise</a> would be useful for anyone who needs dedicated command to replace symbols in defun.
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-iedit"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> iedit
  <span style="font-weight: bold;">:bind</span> (<span style="font-style: italic;">"C-\""</span> . iedit-mode)
  <span style="font-weight: bold;">:custom</span>
  (iedit-toggle-key-default (kbd <span style="font-style: italic;">"C-\""</span>))
  (iedit-auto-narrow t))
</pre>
</div>
</div>
</li>

<li><a id="org3c3dcb8"></a>ledger-mode / flycheck-ledger&#xa0;&#xa0;&#xa0;<span class="tag"><span class="tools">tools</span>&#xa0;<span class="languages">languages</span>&#xa0;<span class="convenience">convenience</span></span><br />
<div class="outline-text-6" id="text-org3c3dcb8">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-ledger-mode"</span>
<span style="font-style: italic;">"emacs-flycheck-ledger"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> ledger-mode
  <span style="font-weight: bold;">:bind</span> (<span style="font-weight: bold;">:map</span> ledger-mode-map
              (<span style="font-style: italic;">"C-c C-y"</span> . ledger-copy-transaction-at-point))
  <span style="font-weight: bold;">:custom</span>
  (ledger-reconcile-default-commodity <span style="font-style: italic;">"\\"</span>)
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">flycheck-ledger</span>)
  (<span style="font-weight: bold;">with-eval-after-load</span> 'ob-core
    (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">ob-ledger</span>)))
</pre>
</div>
</div>
</li>

<li><a id="org8c03590"></a>mentor&#xa0;&#xa0;&#xa0;<span class="tag"><span class="processes">processes</span>&#xa0;<span class="comm">comm</span>&#xa0;<span class="bittorrent">bittorrent</span></span><br />
<div class="outline-text-6" id="text-org8c03590">
<p>
<a href="https://github.com/skangas/mentor">mentor</a> is a <a href="#orgcebd626">rTorrent</a> client for emacs.
</p>

<p>
Typical file downloading workflow:
</p>
<ol class="org-ol">
<li>start mentor: M-x mentor</li>
<li>add magnet link (URL or torrent file path): M-x mentor-download-load-magnet-link-or-url (l)</li>
<li>view downloaded file in dired: M-x mentor-dired-jump (v)</li>
<li>shutdown mentor: M-x mentor-shutdown (Q)</li>
</ol>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-mentor"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> mentor
  <span style="font-weight: bold;">:commands</span> mentor
  <span style="font-weight: bold;">:custom</span>
  (mentor-rtorrent-download-directory <span style="font-style: italic;">"&lt;&lt;torrent-dir()&gt;&gt;"</span>)
  (mentor-rtorrent-keep-session t)
  (mentor-rtorrent-external-rpc <span style="font-style: italic;">"&lt;&lt;rtorrent-sock()&gt;&gt;"</span>))
</pre>
</div>
</div>
</li>

<li><a id="org572bf57"></a>geiser&#xa0;&#xa0;&#xa0;<span class="tag"><span class="scheme">scheme</span>&#xa0;<span class="languages">languages</span>&#xa0;<span class="geiser">geiser</span></span><br />
<div class="outline-text-6" id="text-org572bf57">
<p>
<a href="guix.html#The-Perfect-Setup">guix#The Perfect Setup</a>
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"guile"</span>
<span style="font-style: italic;">"emacs-geiser"</span>
<span style="font-style: italic;">"emacs-geiser-guile"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> geiser-guile
  <span style="font-weight: bold;">:commands</span> (scheme-mode)
  <span style="font-weight: bold;">:config</span>
  (add-to-list 'geiser-guile-load-path
               (file-name-concat <span style="font-style: italic;">"&lt;&lt;ghq-root()&gt;&gt;"</span> <span style="font-style: italic;">"git.savannah.gnu.org/git/guix"</span>))
  (<span style="font-weight: bold;">with-eval-after-load</span> 'yasnippet
    (add-to-list 'yas-snippet-dirs
                 (file-name-concat <span style="font-style: italic;">"&lt;&lt;ghq-root()&gt;&gt;"</span> <span style="font-style: italic;">"git.savannah.gnu.org/git/guix/etc/snippets/yas"</span>)
                 t))
  (load-file (file-name-concat <span style="font-style: italic;">"&lt;&lt;ghq-root()&gt;&gt;"</span> <span style="font-style: italic;">"git.savannah.gnu.org/git/guix/etc/copyright.el"</span>)))
</pre>
</div>
</div>
</li>

<li><a id="orgfbfef49"></a>consult-dash&#xa0;&#xa0;&#xa0;<span class="tag"><span class="docs">docs</span>&#xa0;<span class="dash">dash</span>&#xa0;<span class="consult">consult</span></span><br />
<div class="outline-text-6" id="text-orgfbfef49">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-dash-docs"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> dash-docs
  <span style="font-weight: bold;">:custom</span>
  (dash-docs-docsets-path
   (file-name-concat <span style="font-style: italic;">"&lt;&lt;share-dir()&gt;&gt;"</span> <span style="font-style: italic;">"dash/docsets"</span>)))

(add-to-list 'load-path
             (expand-file-name <span style="font-style: italic;">"elpa/consult-dash-20220621.226"</span> user-emacs-directory))

(<span style="font-weight: bold;">use-package</span> consult-dash
  <span style="font-weight: bold;">:after</span> dash-docs
  <span style="font-weight: bold;">:bind</span> (<span style="font-style: italic;">"M-s M-d"</span> . consult-dash))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defmacro</span> <span style="font-weight: bold;">my/add-dash-docsets-hook</span> (hook docsets)
  `(add-hook ,hook
             (<span style="font-weight: bold;">lambda</span> ()
               (<span style="font-weight: bold;">when</span> (functionp 'consult-dash)
                 (<span style="font-weight: bold;">setq-local</span> consult-dash-docsets ,docsets)))))
</pre>
</div>
</div>
</li>

<li><a id="orgcc3fd75"></a>denote<br />
<div class="outline-text-6" id="text-orgcc3fd75">
<p>
<a href="https://protesilaos.com/emacs/denote">Denote</a> leverages note taking in org mode by providing file naming scheme and backlink capability.
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-denote"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> denote
  <span style="font-weight: bold;">:after</span> my/org-mode-init
  <span style="font-weight: bold;">:bind</span> ((<span style="font-style: italic;">"C-c n n"</span> . denote)
         (<span style="font-style: italic;">"C-c n o"</span> . denote-open-or-create))
  <span style="font-weight: bold;">:custom</span>
  (denote-directory (expand-file-name <span style="font-style: italic;">"~/org/notes"</span>))
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">denote-org-extras</span>)
  (<span style="font-weight: bold;">with-eval-after-load</span> 'org-capture
    (<span style="font-weight: bold;">setq</span> denote-org-capture-specifiers <span style="font-style: italic;">"%l\n%i\n%?"</span>)
    (add-to-list 'org-capture-templates
                 '(<span style="font-style: italic;">"n"</span> <span style="font-style: italic;">"New note (with denote.el)"</span> plain
                   (file denote-last-path)
                   #'denote-org-capture
                   <span style="font-weight: bold;">:no-save</span> t
                   <span style="font-weight: bold;">:immediate-finish</span> nil
                   <span style="font-weight: bold;">:kill-buffer</span> t
                   <span style="font-weight: bold;">:jump-to-captured</span> t))))
</pre>
</div>
</div>
</li>

<li><a id="orgcd263ee"></a>denote-menu<br />
<div class="outline-text-6" id="text-orgcd263ee">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-denote-menu"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp" id="org989b9af">(<span style="font-weight: bold;">use-package</span> denote-menu
  <span style="font-weight: bold;">:after</span> denote
  <span style="font-weight: bold;">:custom</span>
  (denote-menu-date-column-width 12)
  (denote-menu-title-column-width 32)
  (denote-menu-show-file-type nil))
</pre>
</div>
</div>
</li>

<li><a id="org31ea29d"></a>tree-sitter&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span><br /></li>

<li><a id="org2884ab7"></a>xr&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span><br /></li>

<li><a id="orgb69e375"></a>Whole Line Or Region&#xa0;&#xa0;&#xa0;<span class="tag"><span class="wp">wp</span>&#xa0;<span class="convenience">convenience</span></span><br />
<div class="outline-text-6" id="text-orgb69e375">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-style: italic;">"https://github.com/purcell/whole-line-or-region/releases.atom"</span> soft_update)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> whole-line-or-region
  <span style="font-weight: bold;">:ensure</span> t
  <span style="font-weight: bold;">:config</span>
  (whole-line-or-region-global-mode 1))
</pre>
</div>
</div>
</li>

<li><a id="org6e8ee0b"></a>projectile&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span>&#xa0;<span class="ignore">ignore</span></span><br /></li>

<li><a id="org1a27bd6"></a>counsel-projectile&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span>&#xa0;<span class="ignore">ignore</span></span><br /></li>
<li><a id="org420bb29"></a>ag.el&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span>&#xa0;<span class="ignore">ignore</span></span><br /></li>

<li><a id="org8faa19b"></a>ripgrep.el&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span>&#xa0;<span class="ignore">ignore</span></span><br /></li>

<li><a id="org2461ff3"></a>wgrep&#xa0;&#xa0;&#xa0;<span class="tag"><span class="grep">grep</span>&#xa0;<span class="extensions">extensions</span>&#xa0;<span class="edit">edit</span></span><br />
<div class="outline-text-6" id="text-org2461ff3">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-wgrep"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> wgrep
  <span style="font-weight: bold;">:custom</span>
  (wgrep-auto-save-buffer t)
  (wgrep-enable-key <span style="font-style: italic;">"e"</span>))
</pre>
</div>
</div>
</li>

<li><a id="org3a80e86"></a>dumb-jump&#xa0;&#xa0;&#xa0;<span class="tag"><span class="programming">programming</span></span><br />
<div class="outline-text-6" id="text-org3a80e86">
<p>
<a href="https://github.com/jacktasia/dumb-jump">dumb-jump</a> is "jump to definition" package without tagging.
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-dumb-jump"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> dumb-jump
  <span style="font-weight: bold;">:after</span> xref
  <span style="font-weight: bold;">:config</span>
  (add-to-list 'xref-backend-functions
               #'dumb-jump-xref-activate)
  (<span style="font-weight: bold;">bind-keys</span> (<span style="font-style: italic;">"M-g ."</span> . dumb-jump-go)
             (<span style="font-style: italic;">"M-g ,"</span> . dumb-jump-back)
             (<span style="font-style: italic;">"M-g l"</span> . dumb-jump-quick-look)))
</pre>
</div>
</div>
</li>

<li><a id="org0f2227b"></a>visual-regexp&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span><br /></li>

<li><a id="org5633c1b"></a>avy&#xa0;&#xa0;&#xa0;<span class="tag"><span class="point">point</span>&#xa0;<span class="location">location</span></span><br />
<div class="outline-text-6" id="text-org5633c1b">
<p>
<a href="https://karthinks.com/software/avy-can-do-anything/">This post</a> tell me how we can concoct efficient editing workflow with avy.
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-avy"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> avy
  <span style="font-weight: bold;">:preface</span>
  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">avy-action-embark</span> (pt)
    (<span style="font-weight: bold;">unwind-protect</span>
        (<span style="font-weight: bold;">save-excursion</span>
          (goto-char pt)
          (embark-act))
      (select-window
       (cdr (ring-ref avy-ring 0))))
    t)
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">setf</span> (alist-get ?. avy-dispatch-alist) 'avy-action-embark)
  (<span style="font-weight: bold;">bind-keys</span> (<span style="font-style: italic;">"M-g g"</span> . avy-goto-line)
             (<span style="font-style: italic;">"H-g"</span> . avy-goto-line)))
</pre>
</div>
</div>

<ul class="org-ul">
<li><a id="orgfbf33d6"></a>avy-migemo<br />
<div class="outline-text-7" id="text-orgfbf33d6">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> avy-migemo
  <span style="font-weight: bold;">:ensure</span> t
  <span style="font-weight: bold;">:after</span> migemo
  <span style="font-weight: bold;">:bind</span> ((<span style="font-style: italic;">"M-g M-a"</span> . avy-migemo-goto-char-timer)
         (<span style="font-style: italic;">"M-g a"</span> . avy-migemo-goto-char-timer)
         (<span style="font-style: italic;">"H-a"</span> . avy-migemo-goto-char-timer)
         <span style="font-weight: bold;">:map</span> isearch-mode-map
         (<span style="font-style: italic;">"M-a"</span> . avy-migemo-isearch)))
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="orged5f56a"></a>paredit&#xa0;&#xa0;&#xa0;<span class="tag"><span class="lisp">lisp</span></span><br />
<div class="outline-text-6" id="text-orged5f56a">
<p>
Handy commands
</p>
<ul class="org-ul">
<li>press '(' to insert '()' pair</li>
<li>C-&lt;left/right&gt; to barf and slurp s-expressions</li>
<li>call paredit-splice-sexp to strip embracing parenthes</li>
<li>press M-&lt;up&gt; or M-r to delete upper sexp except pointing one</li>
<li>DEL, C-d, C-k act like originals but care for parenthes</li>
<li>press DEL to remedy unbalanced parenthes</li>
<li>press C-q ( to insert ( char manually</li>
</ul>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-paredit"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> paredit
  <span style="font-weight: bold;">:bind</span> (<span style="font-weight: bold;">:map</span> paredit-mode-map
              (<span style="font-style: italic;">"&lt;backspace&gt;"</span> . paredit-backward-delete)
              (<span style="font-style: italic;">"C-M-g"</span> .  paredit-splice-sexp)
              (<span style="font-style: italic;">"M-s"</span> . nil)
              (<span style="font-style: italic;">"C-M-;"</span> . paredit-comment-dwim)
              (<span style="font-style: italic;">"M-;"</span> . nil))
  <span style="font-weight: bold;">:hook</span> (((emacs-lisp-mode lisp-mode scheme-mode) . enable-paredit-mode)))
</pre>
</div>

<ul class="org-ul">
<li><p>
workaround
Thanks to <a href="https://andreyorst.gitlab.io/posts/2021-09-30-why-is-paredit-is-so-un-emacsy/">this blog post</a>, a couple of commands in paredit.el are fixed with transient-mark-mode
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my/paredit-delete-region-functions</span>
  '(paredit-forward-delete
    paredit-backward-delete)
  <span style="font-style: italic;">"List of `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">paredit-mode</span><span style="font-style: italic;">' functions that should support tmm region deletion."</span>)

(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my/paredit-kill-region-functions</span>
  '(paredit-forward-kill-word
    paredit-backward-kill-word)
  <span style="font-style: italic;">"List of `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">paredit-mode</span><span style="font-style: italic;">' functions that should support tmm region killing."</span>)

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/paredit-fix-transient-mark-mode</span> (orig-fn <span style="font-weight: bold; text-decoration: underline;">&amp;rest</span> args)
  <span style="font-style: italic;">"Allow deleting/killing a region if expression is balanced."</span>
  (<span style="font-weight: bold;">if</span> (<span style="font-weight: bold;">and</span> transient-mark-mode
           mark-active)
      (<span style="font-weight: bold;">cond</span> ((memq this-command my/paredit-delete-region-functions)
             (paredit-delete-region (region-beginning) (region-end)))
            ((memq this-command my/paredit-kill-region-functions)
             (paredit-kill-region (region-beginning) (region-end)))
            (t (apply orig-fn args)))
    (apply orig-fn args)))

(<span style="font-weight: bold;">dolist</span> (fun (append my/paredit-delete-region-functions
                     my/paredit-kill-region-functions))
  (advice-add fun <span style="font-weight: bold;">:around</span> #'my/paredit-fix-transient-mark-mode))
</pre>
</div></li>
</ul>
</div>
</li>

<li><a id="orgfbdd230"></a>lsp-mode&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span><br /></li>

<li><a id="org5a83269"></a>company-mode&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span><br /></li>

<li><a id="org5a75a4e"></a>flycheck&#xa0;&#xa0;&#xa0;<span class="tag"><span class="tools">tools</span>&#xa0;<span class="languages">languages</span>&#xa0;<span class="convenience">convenience</span></span><br />
<div class="outline-text-6" id="text-org5a75a4e">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-flycheck"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> flycheck
  <span style="font-weight: bold;">:diminish</span>
  <span style="font-weight: bold;">:hook</span> (prog-mode . flycheck-mode-on-safe)
  <span style="font-weight: bold;">:custom</span>
  (global-flycheck-mode t)
  (flycheck-check-syntax-automatically
   '(save new-line idle-change))
  (flycheck-display-errors-delay 10.0)
  (flycheck-checker-error-threshold 1000)
  (flycheck-textlint-config <span style="font-style: italic;">".textlintrc"</span>)
  <span style="font-weight: bold;">:config</span>
  (add-hook 'flycheck-mode-hook
            (<span style="font-weight: bold;">lambda</span> ()
              (<span style="font-weight: bold;">if</span> (my/ascii-string-p (buffer-string))
                  (<span style="font-weight: bold;">setq</span> flycheck-textlint-config <span style="font-style: italic;">".textlintrc"</span>)
                (<span style="font-weight: bold;">setq</span> flycheck-textlint-config <span style="font-style: italic;">".config/textlint/textlintrc_ja"</span>))))
  (add-to-list 'display-buffer-alist
               `(,flycheck-error-message-buffer
                 . (display-buffer-reuse-window
                    display-buffer-in-previous-window
                    display-buffer-pop-up-window
                    . ((window-height . 5))))))
</pre>
</div>
</div>
</li>

<li><a id="orgb9dd745"></a>twittering-mode&#xa0;&#xa0;&#xa0;<span class="tag"><span class="web">web</span>&#xa0;<span class="twitter">twitter</span>&#xa0;<span class="ARCHIVE">ARCHIVE</span></span><br /></li>

<li><a id="org976a617"></a>comment-dwim-2&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span><br /></li>

<li><a id="org51eb4be"></a>undo-tree&#xa0;&#xa0;&#xa0;<span class="tag"><span class="undo">undo</span>&#xa0;<span class="tree">tree</span>&#xa0;<span class="redo">redo</span>&#xa0;<span class="history">history</span>&#xa0;<span class="files">files</span>&#xa0;<span class="convenience">convenience</span>&#xa0;<span class="ARCHIVE">ARCHIVE</span></span><br /></li>

<li><a id="org9e33161"></a>quickrun&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span><br /></li>

<li><a id="orgdebd6e2"></a>expand-region<br />
<div class="outline-text-6" id="text-orgdebd6e2">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-expand-region"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> expand-region
  <span style="font-weight: bold;">:bind</span> ((<span style="font-style: italic;">"C-,"</span>   . er/expand-region)
         (<span style="font-style: italic;">"C-M-,"</span> . er/contract-region))
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">push</span> 'er/mark-outside-pairs er/try-expand-list))
</pre>
</div>
</div>
</li>

<li><a id="orgacfdac7"></a>helpful<br />
<div class="outline-text-6" id="text-orgacfdac7">
<p>
helpful-mode displays more sources compared to help-mode, including callers, debugging information, and source code.
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-helpful"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> helpful
  <span style="font-weight: bold;">:after</span> help
  <span style="font-weight: bold;">:bind</span> (<span style="font-weight: bold;">:map</span> help-map
              (<span style="font-style: italic;">"C-u a"</span> . helpful-callable)
              (<span style="font-style: italic;">"C-u f"</span> . helpful-function)
              (<span style="font-style: italic;">"C-u s"</span> . helpful-symbol)
              (<span style="font-style: italic;">"C-u x"</span> . helpful-command)
              (<span style="font-style: italic;">"C-u v"</span> . helpful-variable)
              (<span style="font-style: italic;">"C-u k"</span> . helpful-key)
              (<span style="font-style: italic;">"C-u m"</span> . helpful-macro)))
</pre>
</div>
</div>
</li>

<li><a id="org641aa3c"></a>define-word&#xa0;&#xa0;&#xa0;<span class="tag"><span class="dictionary">dictionary</span>&#xa0;<span class="convenience">convenience</span></span><br />
<div class="outline-text-6" id="text-org641aa3c">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-style: italic;">"https://github.com/abo-abo/define-word/releases.atom"</span> soft_update)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> define-word
  <span style="font-weight: bold;">:ensure</span> t
  <span style="font-weight: bold;">:defer</span> t
  <span style="font-weight: bold;">:bind</span> (<span style="font-weight: bold;">:map</span> engine-mode-prefixed-map
              (<span style="font-style: italic;">"n"</span> . my/define-word))
  <span style="font-weight: bold;">:preface</span>
  (<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my/define-word-minibuffer-history</span> nil)
  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/define-word</span> (word)
    <span style="font-style: italic;">"Invoke `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">define-word</span><span style="font-style: italic;">' with dedicated minibuffer history."</span>
    (<span style="font-weight: bold;">interactive</span> (list (determine-search-word <span style="font-style: italic;">"Word to define: "</span> 'my/define-word-minibuffer-history)))
    (define-word word define-word-default-service))
  <span style="font-weight: bold;">:custom</span>
  (define-word-displayfn-alist
   '((wordnik . my/define-word--display-in-buffer)
     (openthesaurus . my/define-word--display-in-buffer)
     (webster . my/define-word--display-in-buffer)))
  (define-word-default-service 'wordnik)
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">setf</span> (cdr (assoc 'wordnik define-word-services))
        '(<span style="font-style: italic;">"http://wordnik.com/words/%s"</span> my/define-word--parse-wordnik-all))
  (<span style="font-weight: bold;">push</span> '(<span style="font-style: italic;">"&lt;b&gt;</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">.*?</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">&lt;/b&gt;"</span> bold)
        define-word--tag-faces)
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">fix issue #31 temporally</span>
  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/define-word--fix-31</span> (define-word-orig <span style="font-weight: bold; text-decoration: underline;">&amp;rest</span> args)
    <span style="font-style: italic;">"Fix `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">define-word</span><span style="font-style: italic;">' backends that require a user agent (like wordnik)."</span>
    (<span style="font-weight: bold;">let</span> ((url-request-extra-headers
           '((<span style="font-style: italic;">"User-Agent"</span> .
              <span style="font-style: italic;">"Mozilla/5.0 (Macintosh; Intel Mac OS X 11_5_2) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/93.0.4577.63 Safari/537.36"</span>))))
      (apply define-word-orig args)))
  (advice-add #'define-word <span style="font-weight: bold;">:around</span> #'my/define-word--fix-31))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/define-word--display-in-buffer</span> (definition)
  <span style="font-style: italic;">"docstring"</span>
  (<span style="font-weight: bold;">let*</span> ((buf-name <span style="font-style: italic;">"*DEFINE WORD*"</span>)
         (buffer (get-buffer-create buf-name))
         (display-buffer-alist
          `((,buf-name
             (display-buffer-same-window)))))
    (<span style="font-weight: bold;">with-current-buffer</span> buffer
      (read-only-mode -1)
      (erase-buffer)
      (insert definition)
      (goto-char (point-min))
      (<span style="font-weight: bold;">save-excursion</span> (xml-parse-string))
      (read-only-mode 1))
    (display-buffer buffer)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/define-word--parse-wordnik-example</span> ()
  (<span style="font-weight: bold;">save-excursion</span>
    (<span style="font-weight: bold;">let</span> (beg
          results
          (define-word-limit 10))
      (re-search-forward <span style="font-style: italic;">"&lt;h2&gt;Examples"</span> nil t)
      (<span style="font-weight: bold;">save-excursion</span>
        (<span style="font-weight: bold;">setq</span> beg (re-search-forward <span style="font-style: italic;">"&lt;div class=\"relatedWords-module\"&gt;"</span> nil t)))
      (<span style="font-weight: bold;">while</span> (re-search-forward <span style="font-style: italic;">"&lt;p class=\"text\"&gt;</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">.*</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">&lt;/p&gt;"</span> beg t)
        (<span style="font-weight: bold;">push</span> <span style="font-style: italic;">"---"</span> results)
        (<span style="font-weight: bold;">push</span> (match-string 1) results))
      (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">setq</span> results (nreverse results))
        (define-word--convert-html-tag-to-face (define-word--join-results results))))))

(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my/define-word-part-map-alist</span> '((<span style="font-style: italic;">"adjective"</span> <span style="font-style: italic;">"adj."</span>)
                                        (<span style="font-style: italic;">"adverb"</span> <span style="font-style: italic;">"adv."</span>)
                                        (<span style="font-style: italic;">"intransitive verb"</span> <span style="font-style: italic;">"v.i."</span>)
                                        (<span style="font-style: italic;">"transitive verb"</span> <span style="font-style: italic;">"v.t."</span>)))


(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/define-word--parse-wordnik</span> ()
  (<span style="font-weight: bold;">let</span> ((str (define-word--parse-wordnik)))
    (<span style="font-weight: bold;">with-temp-buffer</span>
      (insert str)
      (mapc (<span style="font-weight: bold;">lambda</span> (abbrev-map)
              (goto-char (point-min))
              (<span style="font-weight: bold;">while</span> (re-search-forward (format <span style="font-style: italic;">"</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">%s</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">"</span> (car abbrev-map)) nil t)
                (<span style="font-weight: bold;">let</span> ((match (match-string 1)))
                  (replace-match
                   (propertize (cadr abbrev-map) 'face (text-properties-at (point)))))))
            my/define-word-part-map-alist)
      (buffer-string))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/define-word--parse-wordnik-related-word</span> ()
  <span style="font-style: italic;">"docstring"</span>
  (<span style="font-weight: bold;">save-excursion</span>
    (<span style="font-weight: bold;">save-match-data</span>
      (seq-reduce
       (<span style="font-weight: bold;">lambda</span> (accum group)
         (<span style="font-weight: bold;">let</span> (results
               (define-word-limit 20))
           (<span style="font-weight: bold;">if</span> (re-search-forward (format <span style="font-style: italic;">"&lt;h3&gt;%s"</span> group) nil t)
               (<span style="font-weight: bold;">progn</span> (<span style="font-weight: bold;">save-excursion</span>
                        (<span style="font-weight: bold;">setq</span> beg (re-search-forward <span style="font-style: italic;">"&lt;div class=\"related-group-header clearfix\"&gt;"</span> nil t)))
                      (<span style="font-weight: bold;">push</span> (concat group <span style="font-style: italic;">":"</span>) results)
                      (<span style="font-weight: bold;">while</span> (re-search-forward <span style="font-style: italic;">"&lt;span data-definition-for=\"</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">[</span><span style="font-style: italic;">^</span><span style="font-style: italic;">\"]*</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">\""</span> beg t)
                        (<span style="font-weight: bold;">push</span> (concat <span style="font-style: italic;">"- "</span> (match-string 1)) results)
                        (re-search-forward <span style="font-style: italic;">"&lt;/span&gt;"</span>))
                      (concat (<span style="font-weight: bold;">when</span> accum (concat accum <span style="font-style: italic;">"\n\n"</span>))
                              (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">setq</span> results (nreverse results))
                                (define-word--convert-html-tag-to-face (define-word--join-results results)))))
             accum)))
       '(<span style="font-style: italic;">"antonym"</span> <span style="font-style: italic;">"equivalents"</span> <span style="font-style: italic;">"hypernyms"</span> <span style="font-style: italic;">"hyponyms"</span> <span style="font-style: italic;">"same context"</span>)
       nil))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/define-word--parse-wordnik-all</span> ()
  <span style="font-style: italic;">""</span>
  (<span style="font-weight: bold;">let*</span> ((def (funcall #'my/define-word--parse-wordnik))
         (rel (funcall #'my/define-word--parse-wordnik-related-word))
         (exp (funcall #'my/define-word--parse-wordnik-example)))
    (concat <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">"Definitions:\n" (funcall #'define-word--parse-wordnik) "\n\n"</span>
     (<span style="font-weight: bold;">when</span> def (format <span style="font-style: italic;">"Definitions:\n%s\n\n"</span> def))
     (<span style="font-weight: bold;">when</span> rel (format <span style="font-style: italic;">"%s\n\n"</span> rel))
     (<span style="font-weight: bold;">when</span> exp (format <span style="font-style: italic;">"Examples:\n%s\n"</span> exp)))))
</pre>
</div>
</div>
</li>

<li><a id="org9d9d0da"></a>synosaurus<br />
<div class="outline-text-6" id="text-org9d9d0da">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-synosaurus"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> synosaurus
  <span style="font-weight: bold;">:bind</span> (<span style="font-weight: bold;">:map</span> engine-mode-prefixed-map
              (<span style="font-style: italic;">"s"</span> . synosaurus-lookup))
  <span style="font-weight: bold;">:custom</span>
  (synosaurus-choose-method 'default))
</pre>
</div>
</div>
</li>

<li><a id="org55f2559"></a>exec-path-from-shell&#xa0;&#xa0;&#xa0;<span class="tag"><span class="unix">unix</span>&#xa0;<span class="environment">environment</span></span><br />
<div class="outline-text-6" id="text-org55f2559">
<p>
A GNU Emacs library to ensure environment variables inside Emacs look the same as in the user's shell.
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-exec-path-from-shell"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> exec-path-from-shell
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">when</span> (memq window-system '(mac))
    (exec-path-from-shell-initialize)))
</pre>
</div>
</div>
</li>

<li><a id="org8e2397b"></a>migemo.el<br />
<div class="outline-text-6" id="text-org8e2397b">
<p>
migemo allows me to search incrementally Japanese words using roma-ji expression.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-style: italic;">"https://github.com/emacs-jp/migemo/releases.atom"</span> soft_update)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> migemo
  <span style="font-weight: bold;">:ensure</span> t
  <span style="font-weight: bold;">:ensure-system-package</span> cmigemo
  <span style="font-weight: bold;">:custom</span>
  (migemo-command <span style="font-style: italic;">"cmigemo"</span>)
  (migemo-options '(<span style="font-style: italic;">"-q"</span> <span style="font-style: italic;">"--emacs"</span>))
  (migemo-directory
   (file-name-concat <span style="font-style: italic;">"&lt;&lt;migemo-dict-path()&gt;&gt;"</span> <span style="font-style: italic;">"utf-8"</span>))
  (migemo-user-dictionary nil)
  (migemo-coding-system 'utf-8-unix)
  (migemo-regex-dictionary nil)
  <span style="font-weight: bold;">:config</span>
  (migemo-init))
</pre>
</div>
</div>

<ul class="org-ul">
<li><a id="org70574a5"></a>ivy-migemo&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span>&#xa0;<span class="ignore">ignore</span></span><br /></li>
</ul>
</li>

<li><a id="orga714819"></a>jaword<br />
<div class="outline-text-6" id="text-orga714819">
<p>
Jaword.elbackward-wordforward-wordjaword.el
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-style: italic;">"https://github.com/zk-phi/jaword/releases.atom"</span> soft_update)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> jaword
  <span style="font-weight: bold;">:ensure</span> t
  <span style="font-weight: bold;">:custom</span>
  (jaword-enable-subword t)
  <span style="font-weight: bold;">:hook</span> ((skk-mode
          . (<span style="font-weight: bold;">lambda</span> ()
              (jaword-mode 1)))
         (input-method-activate
          . (<span style="font-weight: bold;">lambda</span> ()
              (<span style="font-weight: bold;">when</span> (string= current-input-method <span style="font-style: italic;">"japanese-skk"</span>)
                (jaword-mode 1))))
         (input-method-deactivate
          . (<span style="font-weight: bold;">lambda</span> ()
              (<span style="font-weight: bold;">when</span> (string= current-input-method <span style="font-style: italic;">"japanese-skk"</span>)
                (jaword-mode -1))))))
</pre>
</div>
</div>
</li>

<li><a id="orgd549727"></a>hungry-delete&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span><br /></li>

<li><a id="org5b5b90a"></a>aggressive-indent-mode&#xa0;&#xa0;&#xa0;<span class="tag"><span class="tools">tools</span>&#xa0;<span class="maint">maint</span>&#xa0;<span class="lisp">lisp</span>&#xa0;<span class="indent">indent</span></span><br />
<div class="outline-text-6" id="text-org5b5b90a">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-aggressive-indent"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> aggressive-indent
  <span style="font-weight: bold;">:diminish</span> (aggressive-indent-mode . <span style="font-style: italic;">"ai"</span>)
  <span style="font-weight: bold;">:hook</span> ((emacs-lisp-mode scheme-mode) . aggressive-indent-mode))
</pre>
</div>
</div>
</li>

<li><a id="org4ca473d"></a>adaptive-wrap<br />
<div class="outline-text-6" id="text-org4ca473d">
<p>
adaptive-wrap and visual-line-mode are active in a bundle in a bunch of major modes.
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-adaptive-wrap"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> adaptive-wrap)
</pre>
</div>
</div>
</li>

<li><a id="org2acf340"></a>restart-emacs&#xa0;&#xa0;&#xa0;<span class="tag"><span class="convenience">convenience</span>&#xa0;<span class="ARCHIVE">ARCHIVE</span></span><br /></li>

<li><a id="org76d290d"></a>pangu-spacing&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span><br /></li>
<li><a id="org0aa32b0"></a>which-key&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span><br /></li>
<li><a id="orgda8920f"></a>hydra&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span><br /></li>

<li><a id="org44733e2"></a>pass&#xa0;&#xa0;&#xa0;<span class="tag"><span class="store">store</span>&#xa0;<span class="password">password</span>&#xa0;<span class="password">password</span>&#xa0;<span class="keychain">keychain</span></span><br />
<div class="outline-text-6" id="text-org44733e2">
<p>
Major mode for manupulating password store file.
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-pass"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> pass
  <span style="font-weight: bold;">:commands</span> pass
  <span style="font-weight: bold;">:bind</span> (<span style="font-weight: bold;">:map</span> pass-mode-map
              (<span style="font-style: italic;">"C-j"</span> . pass-view)))
</pre>
</div>
</div>
</li>

<li><a id="org7c5ceae"></a>password-store&#xa0;&#xa0;&#xa0;<span class="tag"><span class="tools">tools</span>&#xa0;<span class="store">store</span>&#xa0;<span class="password">password</span>&#xa0;<span class="password">password</span>&#xa0;<span class="pass">pass</span></span><br />
<div class="outline-text-6" id="text-org7c5ceae">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-password-store"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> password-store
  <span style="font-weight: bold;">:custom</span>
  (password-store-time-before-clipboard-restore 25))
</pre>
</div>
</div>
</li>

<li><a id="org7cc8fa9"></a>nov.el&#xa0;&#xa0;&#xa0;<span class="tag"><span class="multimedia">multimedia</span>&#xa0;<span class="hypermedia">hypermedia</span>&#xa0;<span class="epub">epub</span></span><br />
<div class="outline-text-6" id="text-org7cc8fa9">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-nov-el"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> nov
  <span style="font-weight: bold;">:mode</span> (<span style="font-style: italic;">"\\.epub$"</span> . nov-mode)
  <span style="font-weight: bold;">:hook</span> (nov-mode . nov-abbreviate-file-name)
  <span style="font-weight: bold;">:custom</span>
  (nov-variable-pitch nil)
  (nov-text-width t)
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">bind-keys</span> <span style="font-weight: bold;">:map</span> nov-mode-map
             (<span style="font-style: italic;">"C-j"</span> . nov-browse-url)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">nov-abbreviate-file-name</span> ()
  <span style="font-style: italic;">"Shorten `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">nov-file-name</span><span style="font-style: italic;">' using `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">directory-abbrev-alist</span><span style="font-style: italic;">'."</span>
  (<span style="font-weight: bold;">setq</span> nov-file-name (abbreviate-file-name nov-file-name)))
</pre>
</div>
</div>
</li>

<li><a id="orga201a93"></a>yasnippet&#xa0;&#xa0;&#xa0;<span class="tag"><span class="emulation">emulation</span>&#xa0;<span class="convenience">convenience</span></span><br />
<div class="outline-text-6" id="text-orga201a93">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-yasnippet"</span>
<span style="font-style: italic;">"emacs-yasnippet-snippets"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> yasnippet
  <span style="font-weight: bold;">:disabled</span> t
  <span style="font-weight: bold;">:bind</span> (<span style="font-weight: bold;">:prefix</span> <span style="font-style: italic;">"C-c y"</span>
                 <span style="font-weight: bold;">:prefix-map</span> my/yas-map
                 <span style="font-weight: bold;">:prefix-docstring</span> <span style="font-style: italic;">"Keymap for YASnippet family."</span>
                 (<span style="font-style: italic;">"v"</span> . yas-visit-snippet-file)
                 (<span style="font-style: italic;">"n"</span> . yas-new-snippet)
                 (<span style="font-style: italic;">"i"</span> . yas-insert-snippet)
                 (<span style="font-style: italic;">"TAB"</span> . yas-insert-snippet))
  <span style="font-weight: bold;">:hook</span>
  ((prog-mode text-mode) . yas-minor-mode)
  (after-init . yas-reload-all)
  <span style="font-weight: bold;">:custom</span>
  (yas-triggers-in-field t)
  (yas-wrap-around-region t)
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">yasnippet-snippets</span>))
</pre>
</div>
</div>
</li>

<li><a id="org3916bae"></a>auto-yasnippet<br />
<div class="outline-text-6" id="text-org3916bae">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-auto-yasnippet"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> auto-yasnippet
  <span style="font-weight: bold;">:disabled</span> t
  <span style="font-weight: bold;">:after</span> yasnippet
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">bind-keys</span> <span style="font-weight: bold;">:map</span> my/yas-map
             (<span style="font-style: italic;">"a"</span>   . aya-create)
             (<span style="font-style: italic;">"A"</span>   . aya-expand)
             (<span style="font-style: italic;">"C-s"</span> . aya-persist-snippet)))
</pre>
</div>
</div>
</li>

<li><a id="org6787b1c"></a>yankpad&#xa0;&#xa0;&#xa0;<span class="tag"><span class="convenience">convenience</span>&#xa0;<span class="abbrev">abbrev</span>&#xa0;<span class="ARCHIVE">ARCHIVE</span></span><br /></li>

<li><a id="orgabe8da2"></a>pdf-tools&#xa0;&#xa0;&#xa0;<span class="tag"><span class="multimedia">multimedia</span>&#xa0;<span class="files">files</span>&#xa0;<span class="ARCHIVE">ARCHIVE</span></span><br /></li>

<li><a id="org5a11fff"></a>rainbow-mode&#xa0;&#xa0;&#xa0;<span class="tag"><span class="faces">faces</span></span><br />
<div class="outline-text-6" id="text-org5a11fff">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-rainbow-mode"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> rainbow-mode
  <span style="font-weight: bold;">:diminish</span>
  (rainbow-mode . <span style="font-style: italic;">"rb"</span>)
  <span style="font-weight: bold;">:hook</span>
  ((css-mode scss-mode php-mode html-mode) . rainbow-mode)
  <span style="font-weight: bold;">:custom</span>
  (rainbow-html-colors t)
  (rainbow-x-colors t)
  (rainbow-latex-colors t)
  (rainbow-ansi-colors t))
</pre>
</div>
</div>
</li>
<li><a id="org7d59e72"></a>alert&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notification">notification</span>&#xa0;<span class="message">message</span>&#xa0;<span class="emacs">emacs</span></span><br />
<div class="outline-text-6" id="text-org7d59e72">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-alert"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> alert
  <span style="font-weight: bold;">:config</span>
  (set-face-background 'alert-saved-fringe-face nil)
  (alert-add-rule <span style="font-weight: bold;">:status</span> '(buried)
                  <span style="font-weight: bold;">:mode</span>   'mu4e-alert
                  <span style="font-weight: bold;">:style</span>  'fringe)
  (alert-add-rule <span style="font-weight: bold;">:status</span> '(buried)
                  <span style="font-weight: bold;">:mode</span>   'dired-mode
                  <span style="font-weight: bold;">:style</span>  'fringe)
  (alert-add-rule <span style="font-weight: bold;">:status</span> '(buried)
                  <span style="font-weight: bold;">:mode</span>   'org-mode
                  <span style="font-weight: bold;">:style</span>  'libnotify))
</pre>
</div>
</div>
</li>

<li><a id="org0e8755d"></a>ts&#xa0;&#xa0;&#xa0;<span class="tag"><span class="lisp">lisp</span>&#xa0;<span class="calendar">calendar</span></span><br />
<div class="outline-text-6" id="text-org0e8755d">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-ts"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> ts)
</pre>
</div>
</div>
</li>

<li><a id="org93f6974"></a>app-launcher<br />
<div class="outline-text-6" id="text-org93f6974">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-app-launcher"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> app-launcher
  <span style="font-weight: bold;">:after</span> my-launch-app
  <span style="font-weight: bold;">:bind</span> (<span style="font-weight: bold;">:map</span> my/launch-app-map
              (<span style="font-style: italic;">"a"</span> . app-launcher-run-app)))
</pre>
</div>
</div>
</li>

<li><a id="orgc5e1f7f"></a>tldr&#xa0;&#xa0;&#xa0;<span class="tag"><span class="tools">tools</span>&#xa0;<span class="docs">docs</span></span><br />
<div class="outline-text-6" id="text-orgc5e1f7f">
<p>
I ran into a problem with downloading TL;DR document. I forcibly download, uncompress and locate that to `tldr-directory-path'.
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-tldr"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> tldr
  <span style="font-weight: bold;">:commands</span> tldr
  <span style="font-weight: bold;">:custom</span>
  (tldr-use-word-at-point t))
</pre>
</div>
</div>
</li>

<li><a id="org692530d"></a>burly&#xa0;&#xa0;&#xa0;<span class="tag"><span class="convenience">convenience</span></span><br />
<div class="outline-text-6" id="text-org692530d">
<p>
<a href="https://github.com/alphapapa/burly.el">Burly.el</a> is capable of saving and opening Emacs frames and windows by describing them as URL which can be stored in bookmark. You can use Burly as a lightweight workspace tool.
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-burly"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">burly</span>)
</pre>
</div>
</div>
</li>
<li><a id="orgc30ce8b"></a>tempel&#xa0;&#xa0;&#xa0;<span class="tag"><span class="wp">wp</span>&#xa0;<span class="tools">tools</span>&#xa0;<span class="languages">languages</span>&#xa0;<span class="abbrev">abbrev</span></span><br />
<div class="outline-text-6" id="text-orgc30ce8b">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-tempel"</span>
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">"emacs-tempel-collection"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp" id="org82f14a6">(<span style="font-weight: bold;">use-package</span> tempel
  <span style="font-weight: bold;">:bind</span> ((<span style="font-style: italic;">"M-+"</span> . tempel-complete) <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Alternative tempel-expand</span>
         (<span style="font-style: italic;">"M-_"</span> . tempel-insert))
  <span style="font-weight: bold;">:hook</span>
  ((conf-mode prog-mode text-mode minibuffer-mode) . tempel-setup-capf)
  (mu4e-compose-mode . tempel-abbrev-mode)
  <span style="font-weight: bold;">:preface</span>
  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">tempel-setup-capf</span> ()
    (<span style="font-weight: bold;">setq-local</span> completion-at-point-functions
                (cons #'tempel-expand
                      completion-at-point-functions)))
  <span style="font-weight: bold;">:custom</span>
  (tempel-path (list (no-littering-expand-etc-file-name <span style="font-style: italic;">"tempel/templates/*.eld"</span>)
                     (no-littering-expand-etc-file-name <span style="font-style: italic;">"tempel/templates/*/*.eld"</span>)))
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">bind-keys</span> <span style="font-weight: bold;">:map</span> tempel-map
             (<span style="font-style: italic;">"TAB"</span> . tempel-next)
             (<span style="font-style: italic;">"M-TAB"</span> . tempel-previous)
             (<span style="font-style: italic;">"C-&gt;"</span> . tempel-next)
             (<span style="font-style: italic;">"C-&lt;"</span> . tempel-previous))
  (<span style="font-weight: bold;">with-eval-after-load</span> 'cape
    (<span style="font-weight: bold;">bind-keys</span> <span style="font-weight: bold;">:map</span> my/cape-map
               (<span style="font-style: italic;">"t"</span> . tempel-expand))))

(<span style="font-weight: bold;">use-package</span> tempel-collection
  <span style="font-weight: bold;">:ensure</span> t
  <span style="font-weight: bold;">:after</span> tempel)
</pre>
</div>
</div>
</li>

<li><a id="org70b754e"></a>literate calc mode&#xa0;&#xa0;&#xa0;<span class="tag"><span class="tools">tools</span>&#xa0;<span class="languages">languages</span>&#xa0;<span class="calc">calc</span></span><br />
<div class="outline-text-6" id="text-org70b754e">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-literate-calc-mode"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> literate-calc-mode
  <span style="font-weight: bold;">:bind</span> (<span style="font-style: italic;">"C-c M-="</span> . literate-calc-mode))
</pre>
</div>
</div>
</li>

<li><a id="org17bf631"></a>git-link<br />
<div class="outline-text-6" id="text-org17bf631">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-git-link"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> git-link)
</pre>
</div>
</div>
</li>

<li><a id="orgd4b6734"></a>jinx<br />
<div class="outline-text-6" id="text-orgd4b6734">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-jinx"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> jinx
  <span style="font-weight: bold;">:bind</span> ((<span style="font-style: italic;">"M-$"</span> . jinx-correct)
         (<span style="font-style: italic;">"C-M-$"</span> . jinx-languages))
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">bind-keys</span> <span style="font-weight: bold;">:map</span> jinx-mode-map
             (<span style="font-style: italic;">"M-n"</span> . jinx-next)
             (<span style="font-style: italic;">"M-p"</span> . jinx-previous)))
</pre>
</div>
</div>
</li>
<li><a id="org6a36354"></a>simple-httpd<br />
<div class="outline-text-6" id="text-org6a36354">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-simple-httpd"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> simple-httpd
  <span style="font-weight: bold;">:commands</span> (httpd-start httpd-serve-directory))
</pre>
</div>
</div>
</li>

<li><a id="orgf99d15c"></a>logos<br />
<div class="outline-text-6" id="text-orgf99d15c">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-logos"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp" id="org4398be4">(<span style="font-weight: bold;">use-package</span> logos
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">fingertip</span>)
  <span style="font-weight: bold;">:preface</span>
  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">logos-toggle-read-only</span> ()
    <span style="font-style: italic;">"Toggle read only state in `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">logos-focus-mode</span><span style="font-style: italic;">'"</span>
    (<span style="font-weight: bold;">interactive</span>)
    (<span style="font-weight: bold;">let</span> ((current-ro-state logos-buffer-read-only))
      (logos-focus-mode -1)
      (<span style="font-weight: bold;">setq</span> logos-buffer-read-only (not current-ro-state))
      (logos-focus-mode 1)
      (<span style="font-weight: bold;">unless</span> logos-buffer-read-only
        (fingertip-mode -1))
      (message <span style="font-style: italic;">"Buffer is %s"</span>
               (<span style="font-weight: bold;">if</span> logos-buffer-read-only
                   <span style="font-style: italic;">"read-only"</span> <span style="font-style: italic;">"editable"</span>))))
  <span style="font-weight: bold;">:bind</span> ((<span style="font-style: italic;">"H-;"</span> . logos-focus-mode)
         (<span style="font-style: italic;">"H-n"</span> . logos-narrow-dwim)
         <span style="font-weight: bold;">:map</span> logos-focus-mode-map
         (<span style="font-style: italic;">"H-e"</span> . logos-toggle-read-only))
  <span style="font-weight: bold;">:hook</span> (((help-mode helpful-mode Info-mode eww-mode nov-mode mu4e-view-mode
                     woman-mode mastodon-mode Custom-mode devdocs-mode)
          . logos-focus-mode)
         (logos-focus-mode
          . (<span style="font-weight: bold;">lambda</span> () (<span style="font-weight: bold;">if</span> logos-focus-mode
                       (fingertip-mode 1)
                     (<span style="font-weight: bold;">setq</span> logos-buffer-read-only t)
                     (fingertip-mode -1)))))
  <span style="font-weight: bold;">:custom</span>
  (logos-scroll-lock nil)
  (logos-variable-pitch nil)
  (logos-hide-cursor nil)
  (logos-hide-mode-line t)
  (logos-hide-buffer-boundaries t)
  (logos-buffer-read-only t)
  (logos-olivetti nil)
  (logos-hide-fringe t))
</pre>
</div>
</div>
</li>

<li><a id="org51bfc1d"></a>editorconfig<br />
<div class="outline-text-6" id="text-org51bfc1d">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-editorconfig"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> editorconfig)
</pre>
</div>
</div>
</li>

<li><a id="org68708dc"></a>elisp-demos<br />
<div class="outline-text-6" id="text-org68708dc">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-elisp-demos"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> elisp-demos
  <span style="font-weight: bold;">:bind</span> (<span style="font-weight: bold;">:map</span> help-map
              (<span style="font-style: italic;">"O"</span> . elisp-demos-find-demo))
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">helpful</span>)
  (<span style="font-weight: bold;">bind-keys</span> <span style="font-weight: bold;">:map</span> helpful-mode-map
             (<span style="font-style: italic;">"O"</span> . elisp-demos-for-helpful)))
</pre>
</div>
</div>
</li>

<li><a id="org7cb3ac5"></a>yeetube<br />
<div class="outline-text-6" id="text-org7cb3ac5">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-yeetube"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp" id="orge329ad7">(<span style="font-weight: bold;">use-package</span> yeetube
  <span style="font-weight: bold;">:after</span> engine-mode
  <span style="font-weight: bold;">:bind</span> (<span style="font-weight: bold;">:map</span> engine-mode-prefixed-map
              (<span style="font-style: italic;">"Y"</span> . yeetube-search))
  <span style="font-weight: bold;">:custom</span>
  (yeetube-download-directory <span style="font-style: italic;">"&lt;&lt;media-dir()&gt;&gt;"</span>)
  (yeetube-default-sort-column <span style="font-style: italic;">"Date"</span>)
  (yeetube-display-thumbnails nil)
  <span style="font-weight: bold;">:config</span>
  (keymap-set yeetube-mode-map <span style="font-style: italic;">"Y"</span>
              (<span style="font-weight: bold;">lambda</span> () (<span style="font-weight: bold;">interactive</span>)
                <span style="font-style: italic;">"Dwonload a video at point using `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">yt-dlp-dispatch-dwim</span><span style="font-style: italic;">'"</span>
                (yt-dlp-dispatch-dwim (yeetube-get-url))))
  (keymap-set yeetube-mode-map <span style="font-style: italic;">"P"</span>
              (<span style="font-weight: bold;">lambda</span> () (<span style="font-weight: bold;">interactive</span>)
                <span style="font-style: italic;">"Play a video at point using `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">yt-dlp-dispatch-dwim</span><span style="font-style: italic;">'"</span>
                (yt-dlp-dispatch-dwim (yeetube-get-url) nil nil t)
                (dispatch-execute-macro))))
</pre>
</div>
</div>
</li>

<li><a id="orgd04d3a9"></a>consult-notes&#xa0;&#xa0;&#xa0;<span class="tag"><span class="wp">wp</span>&#xa0;<span class="convenience">convenience</span>&#xa0;<span class="ARCHIVE">ARCHIVE</span></span><br /></li>

<li><a id="org58af6bb"></a>gnuplot<br />
<div class="outline-text-6" id="text-org58af6bb">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"gnuplot"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-gnuplot"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> gnuplot
  <span style="font-weight: bold;">:defer</span> t
  <span style="font-weight: bold;">:hook</span>
  (gnuplot-mode . (<span style="font-weight: bold;">lambda</span> ()
                    (<span style="font-weight: bold;">setq-local</span> devdocs-current-docs '(<span style="font-style: italic;">"gnuplot"</span>)))))
</pre>
</div>
</div>
</li>

<li><a id="org365503d"></a>treesit-auto<br />
<div class="outline-text-6" id="text-org365503d">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> treesit-auto
  <span style="font-weight: bold;">:ensure</span> t
  <span style="font-weight: bold;">:config</span>
  (treesit-auto-add-to-auto-mode-alist 'all))
</pre>
</div>
</div>
</li>

<li><a id="org4332395"></a>devdocs<br />
<div class="outline-text-6" id="text-org4332395">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-devdocs"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> devdocs
  <span style="font-weight: bold;">:bind</span> (<span style="font-weight: bold;">:map</span> help-map
              (<span style="font-style: italic;">"M-d"</span> . devdocs-lookup)))
</pre>
</div>
</div>
</li>

<li><a id="org1797403"></a>unfill<br />
<div class="outline-text-6" id="text-org1797403">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-unfill"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> unfill
  <span style="font-weight: bold;">:bind</span> (<span style="font-style: italic;">"M-Q"</span> . unfill-toggle))
</pre>
</div>
</div>
</li>

<li><a id="orgcb71945"></a>htmlize<br />
<div class="outline-text-6" id="text-orgcb71945">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-htmlize"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp" id="org695131e">(funcall (<span style="font-weight: bold;">if</span> (= full-path 0) #'identity #'expand-file-name)
         (file-name-concat no-littering-var-directory <span style="font-style: italic;">"htmlize"</span>))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-shell">&lt;&lt;htmlize-dir()&gt;&gt;
</pre>
</div>

<div class="org-src-container">
<pre class="src src-conf"><span style="font-weight: bold; font-style: italic;">d &lt;&lt;htmlize-dir(full-path</span>=1)&gt;&gt; - - - 5d
</pre>
</div>

<p>
EWW is a nice place for intensive reading. When there are articles or documents in a format other than HTML, I convert them to HTML and browse them in EWW with my/view-htmlized.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp" id="org9d65a05">(<span style="font-weight: bold;">use-package</span> htmlize
  <span style="font-weight: bold;">:bind</span> (<span style="font-style: italic;">"C-!"</span> . my/view-htmlized)
  <span style="font-weight: bold;">:custom</span>
  (Htmlize-force-inline-images t)
  <span style="font-weight: bold;">:init</span>
  (<span style="font-weight: bold;">with-eval-after-load</span> 'org-keys
    (add-to-list 'org-speed-commands
                 '(<span style="font-style: italic;">"!"</span> . my/view-htmlized)
                 t))
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/view-htmlized</span> ()
    (<span style="font-weight: bold;">interactive</span>)
    (<span style="font-weight: bold;">pcase-let*</span> ((`(,fname . ,write-proc)
                  (<span style="font-weight: bold;">if</span> (derived-mode-p 'org-mode)
                      (cons (format <span style="font-style: italic;">"%s.html"</span>
                                    (secure-hash 'md5 (org-id-get-create)))
                            (<span style="font-weight: bold;">lambda</span> (file)
                              (<span style="font-weight: bold;">let</span> ((org-export-show-temporary-export-buffer nil)
                                    (org-export-preserve-breaks t)
                                    (org-export-use-babel nil))
                                (org-html-export-as-html nil (<span style="font-weight: bold;">if</span> (org-before-first-heading-p) nil t) nil)
                                (<span style="font-weight: bold;">with-current-buffer</span> <span style="font-style: italic;">"*Org HTML Export*"</span>
                                  (write-file file)))))
                    (cons (format <span style="font-style: italic;">"%s.html"</span>
                                  (secure-hash 'md5
                                               (apply 'buffer-substring-no-properties
                                                      (<span style="font-weight: bold;">if</span> (region-active-p)
                                                          (list (region-beginning) (region-end))
                                                        (list (point-min) (point-max))))))
                          (<span style="font-weight: bold;">lambda</span> (file)
                            (<span style="font-weight: bold;">let</span> ((region-text (apply 'htmlize-region-for-paste
                                                      (<span style="font-weight: bold;">if</span> (region-active-p)
                                                          (list (region-beginning) (region-end))
                                                        (list (point-min) (point-max))))))
                              (<span style="font-weight: bold;">with-temp-buffer</span>
                                (insert region-text)
                                (write-file file nil)))))))
                 (file-path (file-name-concat <span style="font-style: italic;">"&lt;&lt;htmlize-dir()&gt;&gt;"</span> fname)))
      (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">or</span> (not (file-exists-p file-path))
                (derived-mode-p 'org-mode))
        (apply write-proc (list file-path)))
      (browse-url-of-file file-path))))
</pre>
</div>
</div>
</li>

<li><a id="orgb150148"></a>everywhere&#xa0;&#xa0;&#xa0;<span class="tag"><span class="frames">frames</span>&#xa0;<span class="convenience">convenience</span></span><br />
<div class="outline-text-6" id="text-orgb150148">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-everywhere"</span>
<span style="font-style: italic;">"xdotool"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> emacs-everywhere
  <span style="font-weight: bold;">:hook</span> (emacs-everywhere-mode
         . (<span style="font-weight: bold;">lambda</span> () (<span style="font-weight: bold;">when</span> emacs-everywhere-mode
                    (set-frame-parameter nil 'fullscreen 'fullboth)))))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-sh" id="orgf2f0015">emacsclient -s server-&lt;&lt;hash-string(<span style="font-weight: bold; font-style: italic;">seed</span>=<span style="font-style: italic;">"server"</span>, <span style="font-weight: bold; font-style: italic;">len</span>=6)&gt;&gt; --eval <span style="font-style: italic;">"(emacs-everywhere)"</span>
</pre>
</div>
</div>
</li>

<li><a id="orge131bde"></a>Eat<br />
<div class="outline-text-6" id="text-orge131bde">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-eat"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> eat
  <span style="font-weight: bold;">:commands</span> (eat eat-eshell-mode)
  <span style="font-weight: bold;">:hook</span> (eshell-load . eat-eshell-mode))
</pre>
</div>
</div>
</li>

<li><a id="orge3a06ae"></a>japanese-holidays&#xa0;&#xa0;&#xa0;<span class="tag"><span class="calendar">calendar</span></span><br />
<div class="outline-text-6" id="text-orge3a06ae">
<p>
<a href="https://github.com/emacs-jp/japanese-holidays/releases.atom">japanese-holidays</a>
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> japanese-holidays
  <span style="font-weight: bold;">:ensure</span> t
  <span style="font-weight: bold;">:preface</span>
  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/japanese-holiday-show</span> (<span style="font-weight: bold; text-decoration: underline;">&amp;rest</span> _args)
    <span style="font-style: italic;">"Show holiday information in mini buffer if date on which the cursor is any holidays."</span>
    (<span style="font-weight: bold;">let*</span> ((date (calendar-cursor-to-date t))
           (calendar-date-display-form '((format <span style="font-style: italic;">"%s&#24180; %s&#26376; %s&#26085;&#65288;%s&#65289;"</span> year month day dayname)))
           (date-string (calendar-date-string date))
           (holiday-list (calendar-check-holidays date)))
      (<span style="font-weight: bold;">when</span> holiday-list
        (message <span style="font-style: italic;">"%s: %s"</span> date-string (mapconcat #'identity holiday-list <span style="font-style: italic;">"; "</span>)))))
  <span style="font-weight: bold;">:custom-face</span>
  (japanese-holiday-saturday ((t (<span style="font-weight: bold;">:foreground</span> <span style="font-style: italic;">"blue"</span> <span style="font-weight: bold;">:background</span> nil))))
  <span style="font-weight: bold;">:custom</span>
  (japanese-holiday-weekend '(0 6))
  (japanese-holiday-weekend-marker
   '(holiday nil nil nil nil nil japanese-holiday-saturday))
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">setf</span> calendar-holidays
        (append japanese-holidays holiday-local-holidays holiday-other-holidays))
  (<span style="font-weight: bold;">with-eval-after-load</span> 'calendar
    (add-hook 'calendar-today-visible-hook
              #'japanese-holiday-mark-weekend)
    (add-hook 'calendar-today-invisible-hook
              #'japanese-holiday-mark-weekend)
    (add-hook 'calendar-move-hook
              #'my/japanese-holiday-show)))
</pre>
</div>
</div>
</li>

<li><a id="orga1d32e2"></a>consult-denote<br />
<div class="outline-text-6" id="text-orga1d32e2">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-consult-denote"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> consult-denote
  <span style="font-weight: bold;">:after</span> (consult denote)
  <span style="font-weight: bold;">:init</span> (consult-denote-mode)
  <span style="font-weight: bold;">:bind</span> ((<span style="font-style: italic;">"C-c n f"</span> . consult-denote-find)
         (<span style="font-style: italic;">"C-c n g"</span> . consult-denote-grep)))
</pre>
</div>
</div>
</li>

<li><a id="orgdef2ad0"></a>capf-autosuggest<br />
<div class="outline-text-6" id="text-orgdef2ad0">
<p>
<a href="https://repo.or.cz/emacs-capf-autosuggest.git">capf-autosuggest</a> provides auto-suggestion functionality in Eshell and major modes, which is derived from Comint mode. In <code>capf-autosuggest-mode</code>, you can use <code>C-e</code> to complete the entire command suggested as a placeholder, and <code>M-f</code> to complete a single word.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> capf-autosuggest
  <span style="font-weight: bold;">:ensure</span> t
  <span style="font-weight: bold;">:hook</span> ((eshell-mode comint-mode) . capf-autosuggest-mode))
</pre>
</div>
</div>
</li>

<li><a id="org9e5dff2"></a>denote-explore<br />
<div class="outline-text-6" id="text-org9e5dff2">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> denote-explore
  <span style="font-weight: bold;">:ensure</span> t
  <span style="font-weight: bold;">:after</span> denote)
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="org3e8f566"></a>My Emacs Packages<br />
<ul class="org-ul">
<li><a id="org8178133"></a>lfile<br />
<div class="outline-text-6" id="text-org8178133">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> lfile
  <span style="font-weight: bold;">:after</span> org
  <span style="font-weight: bold;">:config</span>
  (put 'lfile-locate 'org-link-abbrev-safe t))
</pre>
</div>
</div>
</li>

<li><a id="orgd0ca20c"></a>open-file<br />
<div class="outline-text-6" id="text-orgd0ca20c">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">open-file</span>)
</pre>
</div>
</div>
</li>

<li><a id="org9b231b2"></a>org-password-store<br />
<div class="outline-text-6" id="text-org9b231b2">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> org-password-store
  <span style="font-weight: bold;">:after</span> org
  <span style="font-weight: bold;">:bind</span> (<span style="font-weight: bold;">:map</span> org-mode-map
              (<span style="font-style: italic;">"C-c p c c"</span> . my/password-store-copy)
              (<span style="font-style: italic;">"C-c p c f"</span> . my/password-store-copy-field)
              (<span style="font-style: italic;">"C-c p s"</span> . my/password-store-show-field)
              (<span style="font-style: italic;">"C-c p w"</span> . my/password-store-url)
              (<span style="font-style: italic;">"C-c p l"</span> . my/password-store-web-login)
              (<span style="font-style: italic;">"C-c p n"</span> . my/password-store-create)
              (<span style="font-style: italic;">"C-c p e"</span> . my/password-store-edit)
              (<span style="font-style: italic;">"C-c p v"</span> . my/password-store-edit)
              (<span style="font-style: italic;">"C-c p k"</span> . my/password-store-remove)))
</pre>
</div>
</div>
</li>

<li><a id="org7350939"></a>org-drill-english<br />
<div class="outline-text-6" id="text-org7350939">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> org-drill-english
  <span style="font-weight: bold;">:after</span> org
  <span style="font-weight: bold;">:bind</span> (<span style="font-weight: bold;">:map</span> my/org-global-map
              (<span style="font-style: italic;">"e e"</span> . my/org-english-capture)
              (<span style="font-style: italic;">"e d"</span> . my/org-english-drill)
              (<span style="font-style: italic;">"e r"</span> . my/org-english-drill-resume)
              (<span style="font-style: italic;">"e l"</span> . my/org-english-link)
              (<span style="font-style: italic;">"E"</span> . my/cloze-deletion-replace)
              (<span style="font-style: italic;">"e q"</span> . my/org-english-search)
              <span style="font-weight: bold;">:map</span> engine-mode-prefixed-map
              (<span style="font-style: italic;">"j"</span> . (<span style="font-weight: bold;">lambda</span> (word)
                       <span style="font-style: italic;">"Copy Japanese translation as well as the pronunciation to `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">kill-ring</span><span style="font-style: italic;">'."</span>
                       (<span style="font-weight: bold;">interactive</span> (list (determine-search-word)))
                       (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">if</span> (<span style="font-weight: bold;">featurep</span> '<span style="font-weight: bold; text-decoration: underline;">org-drill-english</span>)
                                 t
                               (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">org-drill-english</span> nil t))
                         (kill-new (message <span style="font-style: italic;">"%s %s"</span>
                                            (my/english-japanese-translate word t)
                                            (my/english-pronunciation word t)))))))
  <span style="font-weight: bold;">:config</span>
  (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">denote</span> nil t)
    (<span style="font-weight: bold;">setq</span> my/org-english-file (denote-get-path-by-id <span style="font-style: italic;">"20230605T170959"</span>))))
</pre>
</div>
</div>
</li>
</ul>
</li>
</ul>
</div>

<div id="outline-container-org99e6b01" class="outline-4">
<h4 id="org99e6b01">Innovative Customization</h4>
<div class="outline-text-4" id="text-org99e6b01">
</div>

<ul class="org-ul">
<li><a id="org54cc20d"></a>utility macros/functions<br />
<div class="outline-text-5" id="text-org54cc20d">
</div>

<ul class="org-ul">
<li><a id="org7872176"></a>lambda key<br />
<div class="outline-text-6" id="text-org7872176">
<p>
<a href="https://www.emacswiki.org/emacs/DocumentingKeyBindingToLambda">lambda-key</a> is nice idea to remedy lambda bindings with define-key.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">lambda-key</span> (keymap key def)
  <span style="font-style: italic;">"Wrap`</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">define-key</span><span style="font-style: italic;">' to provide documentation."</span>
  (set 'sym (make-symbol (documentation def)))
  (fset sym def)
  (keymap-set keymap key sym))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp" id="org514029a">(lambda-key <span style="font-style: italic;">"(lambda-key "</span> (p <span style="font-style: italic;">"keymap"</span>) <span style="font-style: italic;">" \""</span> (p <span style="font-style: italic;">"key"</span>) <span style="font-style: italic;">"\""</span> n&gt;
            <span style="font-style: italic;">"(lambda () \""</span> (p <span style="font-style: italic;">"desc"</span>) <span style="font-style: italic;">"\""</span> n&gt; <span style="font-style: italic;">"(interactive)"</span> n&gt;
            p <span style="font-style: italic;">"))"</span>)
</pre>
</div>
</div>
</li>

<li><a id="orgc60dc0c"></a>computational<br />
<div class="outline-text-6" id="text-orgc60dc0c">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/combinations</span> (list)
  <span style="font-style: italic;">"Return all combinations for all elements in LIST."</span>
  (<span style="font-weight: bold;">if</span> (null list)
      (list nil)
    (<span style="font-weight: bold;">let</span> ((rest-combs (my/combinations (cdr list))))
      (append (mapcar (<span style="font-weight: bold;">lambda</span> (combination) (cons (car list) combination))
                      rest-combs)
              rest-combs))))
</pre>
</div>
</div>
</li>

<li><a id="orge6d8787"></a>copy line number in kill ring<br />
<div class="outline-text-6" id="text-orge6d8787">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/copy-line-number</span> ()
  <span style="font-style: italic;">"Copy the line number of current point into the kill ring."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">let</span> ((line-number (number-to-string (line-number-at-pos))))
    (message <span style="font-style: italic;">"Line number: %s"</span> line-number)
    (kill-new line-number)))
(keymap-global-set <span style="font-style: italic;">"C-M-S-w"</span> 'my/copy-line-number)
</pre>
</div>
</div>
</li>

<li><a id="org45a43ad"></a>expand shorthand time string<br />
<div class="outline-text-6" id="text-org45a43ad">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/expand-shorthand-time</span> (time-string)
  <span style="font-style: italic;">"Expand shorthand expressions in TIME-STRING."</span>
  (<span style="font-weight: bold;">let</span> ((case-fold-search nil))
    (<span style="font-weight: bold;">rx-let</span> ((follow-digit (char)
                           (: (group (+ digit)) (* space) char
                              (group (<span style="font-weight: bold;">or</span> eol (not alpha))))))
      (seq-reduce (<span style="font-weight: bold;">lambda</span> (result element)
                    (replace-regexp-in-string (car element) (cadr element) result))
                  `((,(<span style="font-weight: bold;">rx</span> (follow-digit <span style="font-style: italic;">"y"</span>)) <span style="font-style: italic;">"\\1year\\2"</span>)
                    (,(<span style="font-weight: bold;">rx</span> (follow-digit <span style="font-style: italic;">"M"</span>)) <span style="font-style: italic;">"\\1month\\2"</span>)
                    (,(<span style="font-weight: bold;">rx</span> (follow-digit <span style="font-style: italic;">"w"</span>)) <span style="font-style: italic;">"\\1week\\2"</span>)
                    (,(<span style="font-weight: bold;">rx</span> (follow-digit <span style="font-style: italic;">"d"</span>)) <span style="font-style: italic;">"\\1day\\2"</span>)
                    (,(<span style="font-weight: bold;">rx</span> (follow-digit <span style="font-style: italic;">"h"</span>)) <span style="font-style: italic;">"\\1hour\\2"</span>)
                    (,(<span style="font-weight: bold;">rx</span> (follow-digit <span style="font-style: italic;">"m"</span>)) <span style="font-style: italic;">"\\1minute\\2"</span>)
                    (,(<span style="font-weight: bold;">rx</span> (follow-digit <span style="font-style: italic;">"s"</span>)) <span style="font-style: italic;">"\\1second\\2"</span>))
                  time-string))))
</pre>
</div>

<p>
unit test
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">ert-deftest</span> <span style="font-weight: bold;">test/expand-shorthand-time</span> ()
  <span style="font-style: italic;">"Tests the output string of `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">my/expand-shorthand-time</span><span style="font-style: italic;">'."</span>
  (should (string= (my/expand-shorthand-time <span style="font-style: italic;">"1m"</span>)
                   <span style="font-style: italic;">"1minute"</span>))
  (should (string= (my/expand-shorthand-time <span style="font-style: italic;">"1m 20s"</span>)
                   <span style="font-style: italic;">"1minute 20second"</span>))
  (should (string= (my/expand-shorthand-time <span style="font-style: italic;">" 2h10m "</span>)
                   <span style="font-style: italic;">" 2hour10minute "</span>)))
</pre>
</div>
</div>
</li>

<li><a id="org7b65c2f"></a>play sound<br />
<div class="outline-text-6" id="text-org7b65c2f">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"mpg321"</span>
<span style="font-style: italic;">"vorbis-tools"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/play-sound</span> (sound-file <span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> background-p)
  <span style="font-style: italic;">"Play SOUND-FILE.</span>

<span style="font-style: italic;">The job is executed in the background if BACKGROUND-P is non-nil."</span>
  (call-process-shell-command
   (concat
    (mapconcat #'shell-quote-argument
               (list (<span style="font-weight: bold;">cond</span>
                      ((string-suffix-p <span style="font-style: italic;">".mp3"</span> sound-file)
                       <span style="font-style: italic;">"mpg321"</span>)
                      ((string-suffix-p <span style="font-style: italic;">".oga"</span> sound-file)
                       <span style="font-style: italic;">"ogg123"</span>)
                      (t
                       <span style="font-style: italic;">"mpv --no-config"</span>))
                     sound-file)
               <span style="font-style: italic;">" "</span>)
    (<span style="font-weight: bold;">when</span> background-p <span style="font-style: italic;">"&amp;"</span>))))
</pre>
</div>
</div>
</li>

<li><a id="org77fd071"></a>determine search word macro<br />
<div class="outline-text-6" id="text-org77fd071">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defmacro</span> <span style="font-weight: bold;">determine-search-word</span> (<span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> prompt history)
  <span style="font-style: italic;">"Return word at point unless region is active using PROMPT and HISTORY."</span>
  `(downcase
    (<span style="font-weight: bold;">if</span> (use-region-p)
        (buffer-substring-no-properties (region-beginning) (region-end))
      (read-string ,(<span style="font-weight: bold;">or</span> prompt <span style="font-style: italic;">"Search word: "</span>) (downcase (<span style="font-weight: bold;">or</span> (word-at-point t) <span style="font-style: italic;">""</span>)) <span style="font-style: italic;">""</span> ,history))))
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="orgcd316f7"></a>patches and workarounds<br />
<div class="outline-text-5" id="text-orgcd316f7">
</div>

<ul class="org-ul">
<li><a id="org835d386"></a>disable external IME (fcitx)<br />
<div class="outline-text-6" id="text-org835d386">
<p>
As of 28.1, Emacs won't steal keyboard focus at startup which means we can use external input methods. But I'm confortable with shutting out external IM, fcitx in my case. Restarting fcitx makes my desire come true.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(add-hook 'emacs-startup-hook
          (<span style="font-weight: bold;">lambda</span> ()
            (call-process-shell-command <span style="font-style: italic;">"fcitx -r"</span>)))
</pre>
</div>
</div>
</li>

<li><a id="org102fc92"></a>ddskk corsor color malfunction in Emacs 28 and later<br />
<div class="outline-text-6" id="text-org102fc92">
<p>
<a href="https://github.com/skk-dev/ddskk/issues/190">Cursor colour no longer changes to match hiragana/katakana mode.  Issue #190  skk-dev/ddskk  GitHub</a>
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">facemenu</span>)
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="org10a6d3b"></a>repeat maps<br />
<div class="outline-text-5" id="text-org10a6d3b">
</div>

<ul class="org-ul">
<li><a id="org9871564"></a>dired subdir repeat map<br />
<div class="outline-text-6" id="text-org9871564">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">with-eval-after-load</span> 'dired
  (<span style="font-weight: bold;">defvar-keymap</span> my/dired-subdir-map
    <span style="font-weight: bold;">:doc</span> <span style="font-style: italic;">"Keymap to repeat commands on dired-subdir."</span>
    <span style="font-weight: bold;">:repeat</span> (<span style="font-weight: bold;">:enter</span> (dired-next-subdir
                     dired-prev-subdir
                     dired-goto-subdir)
                    <span style="font-weight: bold;">:exit</span> (dired-kill-subdir
                           dired-open-subdir))
    <span style="font-style: italic;">"n"</span> #'dired-next-subdir
    <span style="font-style: italic;">"p"</span> #'dired-prev-subdir
    <span style="font-style: italic;">"k"</span> #'dired-kill-subdir
    <span style="font-style: italic;">"g"</span> #'dired-goto-subdir
    <span style="font-style: italic;">"TAB"</span> #'dired-hide-subdir
    <span style="font-style: italic;">"RET"</span> #'dired-open-subdir))
</pre>
</div>
</div>
</li>

<li><a id="org5b22184"></a>visual cycling repeat map<br />
<div class="outline-text-6" id="text-org5b22184">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> emacs
  <span style="font-weight: bold;">:no-require</span> t
  <span style="font-weight: bold;">:bind-keymap</span>
  (<span style="font-style: italic;">"H-c"</span> . my/cycle-visual-repeat-map)
  <span style="font-weight: bold;">:preface</span>
  (<span style="font-weight: bold;">defvar-keymap</span> my/cycle-visual-repeat-map
    <span style="font-weight: bold;">:doc</span> <span style="font-style: italic;">"Keymap to repeat toggle/cycling appearance.  Used in `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">repeat-mode</span><span style="font-style: italic;">'."</span>
    <span style="font-weight: bold;">:repeat</span> t
    <span style="font-style: italic;">"#"</span> #'display-line-numbers-mode
    <span style="font-style: italic;">"SPC"</span> #'cycle-spacing
    <span style="font-style: italic;">"V"</span> #'visual-line-mode
    <span style="font-style: italic;">"F"</span> #'toggle-frame-fullscreen
    <span style="font-style: italic;">"P"</span> #'variable-pitch-mode
    <span style="font-style: italic;">"L"</span> #'line-number-mode
    <span style="font-style: italic;">"C"</span> #'column-number-mode
    <span style="font-style: italic;">"R"</span> #'rainbow-mode
    <span style="font-style: italic;">"TAB"</span> #'adaptive-wrap-prefix-mode
    <span style="font-style: italic;">"+"</span> #'text-scale-adjust
    <span style="font-style: italic;">"-"</span> #'text-scale-adjust
    <span style="font-style: italic;">"0"</span> (<span style="font-weight: bold;">lambda</span> () <span style="font-style: italic;">"Set text scale to default level."</span> (<span style="font-weight: bold;">interactive</span>)
          (text-scale-set 0))))
</pre>
</div>
</div>
</li>

<li><a id="orgf3c8c41"></a>frame repeat map<br />
<div class="outline-text-6" id="text-orgf3c8c41">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defvar-keymap</span> my/frame-repeat-map
  <span style="font-weight: bold;">:doc</span> <span style="font-style: italic;">"Keymap to repeat frame commands.  Used in `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">repeat-mode</span><span style="font-style: italic;">'."</span>
  <span style="font-weight: bold;">:repeat</span> (<span style="font-weight: bold;">:enter</span> (other-frame))
  <span style="font-style: italic;">"o"</span> #'other-frame
  <span style="font-style: italic;">"0"</span> #'delete-frame
  <span style="font-style: italic;">"1"</span> #'delete-other-frames
  <span style="font-style: italic;">"2"</span> #'make-frame-command
  <span style="font-style: italic;">"5"</span> #'other-frame-prefix
  <span style="font-style: italic;">"B"</span> #'bookmark-jump-other-frame
  <span style="font-style: italic;">"p"</span> #'project-other-frame-command
  <span style="font-style: italic;">"D"</span> #'dired-other-frame
  <span style="font-style: italic;">"m"</span> #'compose-mail-other-frame)
</pre>
</div>
</div>
</li>

<li><a id="orge3de2e8"></a>delete repeat map<br />
<div class="outline-text-6" id="text-orge3de2e8">
<p>
Suport successive deletion with C-h/M-h
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/delete-char-dwim</span> ()
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">if</span> (eq major-mode 'org-mode)
      (org-delete-char 1)
    (delete-char 1)))
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/delete-backward-char-dwim</span> ()
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">if</span> (eq major-mode 'org-mode)
      (org-delete-backward-char 1)
    (delete-backward-char 1)))
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/kill-word-dwim</span> ()
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">if</span> jaword-mode
      (jaword-kill 1)
    (kill-word 1)))
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/backward-kill-word-dwim</span> ()
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">if</span> jaword-mode
      (jaword-kill -1)
    (backward-kill-word 1)))

(<span style="font-weight: bold;">defvar-keymap</span> my/delete-repeat-map
  <span style="font-weight: bold;">:doc</span> <span style="font-style: italic;">"Keymap to repeat deletion commands.  Used in `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">repeat-mode</span><span style="font-style: italic;">'."</span>
  <span style="font-weight: bold;">:repeat</span> (<span style="font-weight: bold;">:enter</span> (delete-char
                   org-delete-char
                   kill-word
                   jaword-kill
                   my/delete-char-dwim
                   my/delete-backward-char-dwim
                   my/kill-word-dwim
                   my/backward-kill-word-dwim))
  <span style="font-style: italic;">"C-d"</span> #'my/delete-char-dwim
  <span style="font-style: italic;">"C-h"</span> #'my/delete-backward-char-dwim
  <span style="font-style: italic;">"M-d"</span> #'my/kill-word-dwim
  <span style="font-style: italic;">"M-h"</span> #'my/backward-kill-word-dwim)
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="org51c42b6"></a>tailored commands/functions<br />
<div class="outline-text-5" id="text-org51c42b6">
</div>

<ul class="org-ul">
<li><a id="orge01f179"></a>update elfeed feeds automatically<br />
<div class="outline-text-6" id="text-orge01f179">
<p>
elfeed-update will run at morning everyday
</p>

<div class="org-src-container">
<pre class="src src-sh">emacsclient -s server-&lt;&lt;hash-string(<span style="font-weight: bold; font-style: italic;">seed</span>=<span style="font-style: italic;">"server"</span>, <span style="font-weight: bold; font-style: italic;">len</span>=6)&gt;&gt; --eval <span style="font-style: italic;">"(my/elfeed-update)"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/elfeed-update</span> ()
  <span style="font-style: italic;">"Update Elfeed feeds and compress the database."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (elfeed)
  (elfeed-update)
  (elfeed-db-compact)
  (<span style="font-weight: bold;">when</span> (eq major-mode 'elfeed-search-mode)
    (elfeed-kill-buffer)))
</pre>
</div>
</div>
</li>

<li><a id="orge6cb999"></a>frame maximization<br />
<div class="outline-text-6" id="text-orge6cb999">
<p>
Every frame will be spawn in maximized and initial frame will be full screen at Emacs start-up time.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> frame
  <span style="font-weight: bold;">:if</span> (member (window-system) '(x ns w32))
  <span style="font-weight: bold;">:init</span>
  (add-to-list 'after-make-frame-functions
               (<span style="font-weight: bold;">lambda</span> (frame) (set-frame-parameter frame 'fullscreen 'maximized)))
  <span style="font-weight: bold;">:hook</span>
  (emacs-startup . (<span style="font-weight: bold;">lambda</span> () (set-frame-parameter nil 'fullscreen 'fullboth))))
</pre>
</div>
</div>
</li>

<li><a id="org6db5b86"></a>prune old .eln files at shut down&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span><br /></li>

<li><a id="org4feeead"></a>Increasing a number at point preserving pad<br />
<div class="outline-text-6" id="text-org4feeead">
<p>
Org Mode offers handy commands, namely org-increase-number-at-point and org-decrease-number-at-point. I often find myself handling zero-padded numbers such as '010'. I thought it would be nice if there was a command that could increase a number at point while preserving the preceding zeros - and this is the solution.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/increase-number-at-point-preserve-pad</span> (<span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> inc)
  <span style="font-style: italic;">"Increment the number at point while preserving zero padding.</span>
<span style="font-style: italic;">With an optional prefix numeric argument INC, increment using</span>
<span style="font-style: italic;">this numeric value.</span>

<span style="font-style: italic;">This command is a homage to org-increase-number-at-point."</span>
  (<span style="font-weight: bold;">interactive</span> <span style="font-style: italic;">"p"</span>)
  (<span style="font-weight: bold;">if</span> (not (number-at-point))
      (<span style="font-weight: bold;">user-error</span> <span style="font-style: italic;">"Not on a number"</span>)
    (<span style="font-weight: bold;">unless</span> inc (<span style="font-weight: bold;">setq</span> inc 1))
    (<span style="font-weight: bold;">let*</span> ((pos (point))
           (digit-chars <span style="font-style: italic;">"-+0-9"</span>)
           (beg (skip-chars-backward digit-chars))
           (end (skip-chars-forward digit-chars))
           (nap (buffer-substring-no-properties
                 (+ pos beg) (+ pos beg end)))
           (digit-count (length nap)))
      (delete-region (+ pos beg) (+ pos beg end))
      (insert (format (concat <span style="font-style: italic;">"%0"</span> (format <span style="font-style: italic;">"%d"</span> digit-count) <span style="font-style: italic;">"d"</span>)
                      (+ (string-to-number nap) inc))))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/decrease-number-at-point-preserve-pad</span> (<span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> inc)
  <span style="font-style: italic;">"Decrement the number at point while preserving zero padding.</span>
<span style="font-style: italic;">With an optional prefix numeric argument INC, decrement using</span>
<span style="font-style: italic;">this numeric value."</span>
  (<span style="font-weight: bold;">interactive</span> <span style="font-style: italic;">"p"</span>)
  (my/increase-number-at-point-preserve-pad (- (<span style="font-weight: bold;">or</span> inc 1))))

(keymap-global-set <span style="font-style: italic;">"C-x &lt;up&gt;"</span> #'my/increase-number-at-point-preserve-pad)
(keymap-global-set <span style="font-style: italic;">"C-x &lt;down&gt;"</span> #'my/decrease-number-at-point-preserve-pad)
(<span style="font-weight: bold;">defvar-keymap</span> my/increase-number-repeat-map
  <span style="font-weight: bold;">:doc</span> <span style="font-style: italic;">"Keymap to repeat increasing a number."</span>
  <span style="font-weight: bold;">:repeat</span> (<span style="font-weight: bold;">:enter</span> (my/increase-number-at-point-preserve-pad
                   my/decrease-number-at-point-preserve-pad))
  <span style="font-style: italic;">"&lt;up&gt;"</span> #'my/increase-number-at-point-preserve-pad
  <span style="font-style: italic;">"&lt;down&gt;"</span> #'my/decrease-number-at-point-preserve-pad)
</pre>
</div>
</div>
</li>

<li><a id="orgfd6f37d"></a>edit local file as root (sudo)<br />
<div class="outline-text-6" id="text-orgfd6f37d">
<p>
my/sudo-edit-local-file is inspired by <a href="https://emacsredux.com/blog/2013/04/21/edit-files-as-root/">this thisblog post</a>.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/sudo-edit-local-file</span> ()
  <span style="font-style: italic;">"Reopen the current buffer file with root privileges."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">when</span> (file-exists-p buffer-file-name)
    (find-alternate-file
     (concat <span style="font-style: italic;">"/sudo:root@localhost:"</span>
             buffer-file-name))))

(keymap-global-set <span style="font-style: italic;">"C-x C-#"</span> #'my/sudo-edit-local-file)
</pre>
</div>
</div>
</li>

<li><a id="orgbb72739"></a>power management<br />
<div class="outline-text-6" id="text-orgbb72739">
<p>
Shut down emacs automatically when remaining power of laptop PC lower than <a href="battery-load-low">battery-load-low</a>
to avoid accidental data loss.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">battery</span>)

(run-with-timer 60 60 #'kill-emacs-auto)

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">kill-emacs-auto</span> ()
  <span style="font-style: italic;">"Kill Emacs if remaining machine power lower than `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">battery-load-low</span><span style="font-style: italic;">'."</span>
  (<span style="font-weight: bold;">when-let*</span> ((data (<span style="font-weight: bold;">and</span> battery-status-function (funcall battery-status-function)))
              (percentage (car (read-from-string (cdr (assq ?p data)))))
              (power (cdr (assq ?L data))))
    (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">and</span> (numberp percentage)
               (&lt; percentage battery-load-low)
               (stringp power)
               (string= power <span style="font-style: italic;">"BAT"</span>))
      (save-buffers-kill-emacs t))))
</pre>
</div>
</div>
</li>

<li><a id="org7e16e7b"></a>lazy viewing&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span><br /></li>

<li><a id="org1abc0ba"></a>lookup functions&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span><br /></li>

<li><a id="orge4bd004"></a>tldr<br />
<div class="outline-text-6" id="text-orge4bd004">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/tldr</span> (command)
  <span style="font-style: italic;">"Show the output of tldr for COMMAND in a dedicated buffer."</span>
  (<span style="font-weight: bold;">interactive</span> (list (read-string <span style="font-style: italic;">"Coomand: "</span>)))
  (<span style="font-weight: bold;">let*</span> ((buf-name <span style="font-style: italic;">"*TL;DR*"</span>)
         (buffer (get-buffer-create buf-name)))
    (<span style="font-weight: bold;">with-current-buffer</span> buffer
      (read-only-mode -1)
      (erase-buffer)
      (insert (shell-command-to-string (format <span style="font-style: italic;">"tldr %s"</span>
                                               (shell-quote-argument command))))
      (ansi-color-apply-on-region (point-min) (point-max))
      (goto-char (point-min))
      (read-only-mode 1))
    (display-buffer buffer '((display-buffer-pop-up-window)
                             . ((window-height . 8))))
    (switch-to-buffer-other-window buffer)))
</pre>
</div>
</div>
</li>

<li><a id="org4362bc0"></a>download media file&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span><br /></li>

<li><a id="emacs-package-tts"></a>Text-to-Speech using AI (tts.el)<br />
<div class="outline-text-6" id="text-emacs-package-tts">
<p>
tts.el provides functions to say out given text using <a href="https://platform.openai.com/docs/guides/text-to-speech">the OpenAI Text to Speech service</a> through its API.  The vips project is referenced when implementation.  The <a href="https://github.com/marcklemp/vips">vips</a> project was helpful during the implementation process.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;;; </span><span style="font-weight: bold; font-style: italic;">tts.el --- Text to speech -*- lexical-binding: t -*-</span>

<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Author: p-snow</span>
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Version: 0.0.1</span>
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Package-Requires: ((emacs "29.1") (request "0.3.0"))</span>
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Homepage: https://github.com/p-snow/tts</span>
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Keywords: media</span>

<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">This file is not part of GNU Emacs</span>

<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">This program is free software: you can redistribute it and/or modify</span>
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">it under the terms of the GNU General Public License as published by</span>
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">the Free Software Foundation, either version 3 of the License, or</span>
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(at your option) any later version.</span>

<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">This program is distributed in the hope that it will be useful,</span>
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">GNU General Public License for more details.</span>

<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">You should have received a copy of the GNU General Public License</span>
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">along with this program.  If not, see <a href="https://www.gnu.org/licenses/">&lt;https://www.gnu.org/licenses/&gt;</a>.</span>

<span style="font-weight: bold; font-style: italic;">;;; </span><span style="font-weight: bold; font-style: italic;">Commentary:</span>

<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">commentary</span>

<span style="font-weight: bold; font-style: italic;">;;; </span><span style="font-weight: bold; font-style: italic;">Code:</span>

(<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">request</span>)

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">tts-openai-request</span> (api-key input action)
  <span style="font-style: italic;">"Return audio file content from OpenAI API and save it to OUTPUT-FILE or play it.</span>
<span style="font-style: italic;">INPUT is the text string sent to the API.</span>
<span style="font-style: italic;">RESPONSE-FORMAT is the format of the audio file, defaults to '</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">mp3</span><span style="font-style: italic;">'.</span>
<span style="font-style: italic;">ACTION is either 'save or 'play, determining what to do with the response."</span>
  (<span style="font-weight: bold;">let*</span> ((auth-value (format <span style="font-style: italic;">"Bearer %s"</span> api-key))
         (model <span style="font-style: italic;">"tts-1"</span>)
         (voice <span style="font-style: italic;">"nova"</span>)
         (speed nil)
         (response-format <span style="font-style: italic;">"opus"</span>)
         (url <span style="font-style: italic;">"https://api.openai.com/v1/audio/speech"</span>)
         (data (json-encode `((<span style="font-style: italic;">"model"</span> . ,model)
                              (<span style="font-style: italic;">"input"</span> . ,input)
                              (<span style="font-style: italic;">"voice"</span> . ,voice)
                              ,@(<span style="font-weight: bold;">when</span> response-format `((<span style="font-style: italic;">"response_format"</span> . ,response-format)))
                              ,@(<span style="font-weight: bold;">when</span> speed `((<span style="font-style: italic;">"speed"</span> . ,speed)))))))
    (request
      url
      <span style="font-weight: bold;">:type</span> <span style="font-style: italic;">"POST"</span>
      <span style="font-weight: bold;">:data</span> data
      <span style="font-weight: bold;">:headers</span> `((<span style="font-style: italic;">"Authorization"</span> . ,auth-value) (<span style="font-style: italic;">"Content-Type"</span> . <span style="font-style: italic;">"application/json"</span>))
      <span style="font-weight: bold;">:parser</span> 'buffer-string
      <span style="font-weight: bold;">:success</span> (<span style="font-weight: bold;">cl-function</span>
                (<span style="font-weight: bold;">lambda</span> (<span style="font-weight: bold; text-decoration: underline;">&amp;key</span> data <span style="font-weight: bold; text-decoration: underline;">&amp;allow-other-keys</span>)
                  (<span style="font-weight: bold;">let</span> ((coding-system-for-write 'binary)
                        (speech-file (make-temp-file <span style="font-style: italic;">"tts-"</span> nil <span style="font-style: italic;">".opus"</span>)))
                    (<span style="font-weight: bold;">with-temp-file</span> speech-file
                      (insert data))
                    (<span style="font-weight: bold;">when</span> action (funcall action speech-file)))))
      <span style="font-weight: bold;">:error</span> (<span style="font-weight: bold;">cl-function</span>
              (<span style="font-weight: bold;">lambda</span> (<span style="font-weight: bold; text-decoration: underline;">&amp;key</span> error-thrown <span style="font-weight: bold; text-decoration: underline;">&amp;allow-other-keys</span>)
                (message <span style="font-style: italic;">"Error: %S"</span> error-thrown))))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">tts-play</span> (speech-file)
  <span style="font-style: italic;">""</span>
  (play-sound-file speech-file))

(<span style="font-weight: bold;">provide</span> '<span style="font-weight: bold; text-decoration: underline;">tts</span>)
<span style="font-weight: bold; font-style: italic;">;;; </span><span style="font-weight: bold; font-style: italic;">tts.el ends here</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">tts</span> nil t)
  (keymap-global-set <span style="font-style: italic;">"C-x C-\""</span> #'my/tts-say-it)
  (<span style="font-weight: bold;">with-eval-after-load</span> 'embark
    (keymap-set embark-region-map <span style="font-style: italic;">"\""</span> #'my/tts-say-it)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/tts-say-it</span> (text)
  <span style="font-style: italic;">""</span>
  (<span style="font-weight: bold;">interactive</span> (list (<span style="font-weight: bold;">cond</span>
                      ((region-active-p)
                       (buffer-substring-no-properties (region-beginning) (region-end)))
                      (sentence-at-point))))
  (tts-openai-request (my/credential-info <span style="font-style: italic;">"openai.com"</span> <span style="font-style: italic;">"apikey"</span>)
                      text
                      #'my/tts-play))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/tts-play</span> (speech-file)
  <span style="font-style: italic;">""</span>
  (start-process-shell-command <span style="font-style: italic;">"tts"</span> nil (format <span style="font-style: italic;">"mpv --keep-open=no --no-pause --force-window=no %1$s; rm -f %1$s"</span>
                                                 (shell-quote-argument speech-file))))
</pre>
</div>
</div>

<ul class="org-ul">
<li><a id="org132ddc0"></a>jsay&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span><br /></li>

<li><a id="org6c7760a"></a>esay&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span><br /></li>
</ul>
</li>

<li><a id="org440bed8"></a>wrap up launch app commands in single keymap<br />
<div class="outline-text-6" id="text-org440bed8">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(keymap-global-set <span style="font-style: italic;">"H-j"</span>
                   (define-keymap
                     <span style="font-weight: bold;">:prefix</span> 'my/launch-app-map
                     <span style="font-style: italic;">"v"</span> #'my/multi-vterm
                     <span style="font-style: italic;">"d"</span> #'dired-jump
                     <span style="font-style: italic;">"w"</span> #'eww
                     <span style="font-style: italic;">"m"</span> #'mu4e
                     <span style="font-style: italic;">"p"</span> #'proced
                     <span style="font-style: italic;">"P"</span> #'list-processes
                     <span style="font-style: italic;">"?"</span> #'woman
                     <span style="font-style: italic;">"l"</span> (define-keymap
                           <span style="font-weight: bold;">:prefix</span> 'my/invoke-list-command-map)))

(<span style="font-weight: bold;">provide</span> '<span style="font-weight: bold; text-decoration: underline;">my-launch-app</span>)
</pre>
</div>
</div>
</li>

<li><a id="org191c88e"></a>show the day in calendar<br />
<div class="outline-text-6" id="text-org191c88e">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/calendar-show-items</span> ()
  <span style="font-style: italic;">"Show items on the day pointed in calendar view."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">let*</span> ((calendar-date-display-form calendar-iso-date-display-form)
         (date (calendar-date-string (calendar-cursor-to-date)))
         (d (parse-time-string date))
         (year (decoded-time-year d))
         (files (file-expand-wildcards (file-name-concat org-directory <span style="font-style: italic;">"archive"</span> (format <span style="font-style: italic;">"archive_%d.org"</span> year))))
         (buffer-name-prefix <span style="font-style: italic;">"=="</span>)
         (buffer-name (concat buffer-name-prefix date))
         (display-buffer-alist
          `((,buffer-name-prefix
             (display-buffer-reuse-mode-window
              display-buffer-pop-up-window)
             (window-height . 7)))))
    (org-ql-search files `(<span style="font-weight: bold;">and</span> (<span style="font-weight: bold;">or</span> (parent (heading ,date))
                                   (ts-a <span style="font-weight: bold;">:on</span> ,date))
                               (not (tags <span style="font-style: italic;">"web"</span> <span style="font-style: italic;">"drill"</span>)))
                   <span style="font-weight: bold;">:buffer</span> buffer-name)
    (other-window 1)))

(<span style="font-weight: bold;">with-eval-after-load</span> 'calendar
  (<span style="font-weight: bold;">bind-keys</span> <span style="font-weight: bold;">:map</span> calendar-mode-map
             (<span style="font-style: italic;">"v"</span> . my/calendar-show-items)))
</pre>
</div>
</div>
</li>

<li><a id="org0819b9e"></a>replace regexp with re-builder and query-replace-regexp trick<br />
<div class="outline-text-6" id="text-org0819b9e">
<p>
Great idea using re-builder when query-replace-regexp borrowed from <a href="https://karthinks.com/software/bridging-islands-in-emacs-1/">this post</a>.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my/re-builder-positions</span> nil
  <span style="font-style: italic;">"Store point and region bounds before calling re-builder"</span>)

(advice-add 're-builder
            <span style="font-weight: bold;">:before</span>
            (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/re-builder-save-state</span> (<span style="font-weight: bold; text-decoration: underline;">&amp;rest</span> _)
              <span style="font-style: italic;">"Save into `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">my/re-builder-positions</span><span style="font-style: italic;">' the point and region</span>
<span style="font-style: italic;">positions before calling `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">re-builder</span><span style="font-style: italic;">'."</span>
              (<span style="font-weight: bold;">setq</span> my/re-builder-positions
                    (cons (point)
                          (<span style="font-weight: bold;">when</span> (region-active-p)
                            (list (region-beginning)
                                  (region-end)))))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">reb-replace-regexp</span> (<span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> delimited)
  <span style="font-style: italic;">"Run `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">query-replace-regexp</span><span style="font-style: italic;">' with the contents of re-builder. With</span>
<span style="font-style: italic;">non-nil optional argument DELIMITED, only replace matches</span>
<span style="font-style: italic;">surrounded by word boundaries."</span>
  (<span style="font-weight: bold;">interactive</span> <span style="font-style: italic;">"P"</span>)
  (reb-update-regexp)
  (<span style="font-weight: bold;">let*</span> ((re (reb-cook-regexp (reb-read-regexp)))
         (replacement (query-replace-read-to
                       re
                       (concat <span style="font-style: italic;">"Query replace"</span>
                               (<span style="font-weight: bold;">if</span> current-prefix-arg
                                   (<span style="font-weight: bold;">if</span> (eq current-prefix-arg '-) <span style="font-style: italic;">" backward"</span> <span style="font-style: italic;">" word"</span>)
                                 <span style="font-style: italic;">""</span>)
                               <span style="font-style: italic;">" regexp"</span>
                               (<span style="font-weight: bold;">if</span> (<span style="font-weight: bold;">with-selected-window</span> reb-target-window
                                     (region-active-p)) <span style="font-weight: bold; font-style: italic;">" in region"</span><span style="font-weight: bold;"> </span><span style="font-weight: bold; font-style: italic;">""</span><span style="font-weight: bold;">))</span>
                       t))
         (pnt (car my/re-builder-positions))
         (beg (cadr my/re-builder-positions))
         (end (caddr my/re-builder-positions)))
    (<span style="font-weight: bold;">with-selected-window</span> reb-target-window
      (goto-char pnt) <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">replace with (goto-char (match-beginning 0)) if you want</span>
                                        <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">to control where in the buffer the replacement starts</span>
                                        <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">with re-builder</span>
      (<span style="font-weight: bold;">setq</span> my/re-builder-positions nil)
      (reb-quit)
      (query-replace-regexp re replacement delimited beg end))))

(<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">rebuilder</span> nil t)
  (keymap-set reb-mode-map <span style="font-style: italic;">"RET"</span> #'reb-replace-regexp)
  (keymap-set reb-lisp-mode-map <span style="font-style: italic;">"RET"</span> #'reb-replace-regexp)
  (keymap-global-set <span style="font-style: italic;">"C-%"</span> #'re-builder))
</pre>
</div>
</div>
</li>

<li><a id="org04dfc93"></a>mark and open a file in one go in Dired<br />
<div class="outline-text-6" id="text-org04dfc93">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/dired-mark-and-open-file</span> ()
  <span style="font-style: italic;">"Mark file and open it in one go."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">save-excursion</span>
    (dired-mark 1))
  (dired-open-file))

(<span style="font-weight: bold;">with-eval-after-load</span> 'dired
  (keymap-set dired-mode-map <span style="font-style: italic;">"M-RET"</span>
              #'my/dired-mark-and-open-file))
</pre>
</div>
</div>
</li>

<li><a id="org38ffc48"></a>open space<br />
<div class="outline-text-6" id="text-org38ffc48">
<p>
Like C-o (M-x open-line), it is useful open single space ahead of point.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/open-space</span> ()
  <span style="font-style: italic;">"Insert single space ahead of point."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (insert <span style="font-style: italic;">" "</span>)
  (backward-char 1))
(keymap-global-set <span style="font-style: italic;">"M-o"</span> 'my/open-space)
</pre>
</div>
</div>
</li>

<li><a id="orgdaa4b2d"></a>Retrieving Credential Information<br />
<div class="outline-text-6" id="text-orgdaa4b2d">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">auth-source-pass</span> nil t)
  (auth-source-pass-enable)
  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/credential-info</span> (host key)
    <span style="font-style: italic;">"Return API key for HOST or OpenAI."</span>
    (<span style="font-weight: bold;">or</span> (cdr (assoc key (auth-source-pass-parse-entry host)))
        (<span style="font-weight: bold;">let</span> ((sec (plist-get (car (auth-source-search <span style="font-weight: bold;">:host</span> host)) <span style="font-weight: bold;">:secret</span>)))
          (<span style="font-weight: bold;">if</span> (functionp sec)
              (funcall sec) sec)))))
</pre>
</div>
</div>
</li>

<li><a id="emacs-function-insert-last-kbd-macro"></a>Binding Saved Kmacro under H-k<br />
<div class="outline-text-6" id="text-emacs-function-insert-last-kbd-macro">
<p>
Calling my/insert-last-kbd-macro after saving the desired keyboard macro will generate a set of code for persistent use.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(keymap-global-set <span style="font-style: italic;">"H-k"</span>
                   (define-keymap
                     <span style="font-weight: bold;">:prefix</span> 'my/kmacro-map))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/insert-last-kbd-macro</span> (macroname keys)
  <span style="font-style: italic;">"Customized `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">insert-kbd-macro</span><span style="font-style: italic;">' to bind last recorded kbd macro to `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">my/kmacro-map</span><span style="font-style: italic;">'.."</span>
  (<span style="font-weight: bold;">interactive</span> (list (read-string <span style="font-style: italic;">"Macro name: "</span>)
                     (read-string <span style="font-style: italic;">"Keys (following H-k): "</span>)))
  (kmacro-name-last-macro (intern macroname))
  (insert-kbd-macro (intern macroname))
  (insert <span style="font-style: italic;">"(keymap-set my/kmacro-map"</span>)
  (insert (format <span style="font-style: italic;">" \"%s\""</span> keys))
  (insert (format <span style="font-style: italic;">" #'%s)"</span> macroname)))

(keymap-global-set <span style="font-style: italic;">"C-x C-k i"</span> #'my/insert-last-kbd-macro)

(mapc #'load-file
      (file-expand-wildcards
       (concat (no-littering-expand-etc-file-name <span style="font-style: italic;">"kmacro"</span>)
               <span style="font-style: italic;">"/*.el"</span>)))
</pre>
</div>
</div>
</li>

<li><a id="org9a6893b"></a>miscellaneous functions/commands<br />
<div class="outline-text-6" id="text-org9a6893b">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/insert-time-stamp</span> ()
  <span style="font-style: italic;">"Insert time stamp with preferred format."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (insert
   (completing-read <span style="font-style: italic;">"Format: "</span>
                    (mapcar #'format-time-string
                            '(<span style="font-style: italic;">"%Y%m%d"</span> <span style="font-style: italic;">"%Y-%m-%d"</span> <span style="font-style: italic;">"%Y-%m-%d %H:%M:%S"</span>)))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/drag-line-backward</span> ()
  <span style="font-style: italic;">"Drag up current line for one."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (transpose-lines 1)
  (previous-line 2))
(keymap-global-set <span style="font-style: italic;">"M-S-&lt;up&gt;"</span> 'my/drag-line-backward)

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/drag-line-forward</span> ()
  <span style="font-style: italic;">"Drag down current line for one."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (next-line 1)
  (transpose-lines 1)
  (previous-line 1))
(keymap-global-set <span style="font-style: italic;">"M-S-&lt;down&gt;"</span> 'my/drag-line-forward)

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/comment-box</span> (b e)
  <span style="font-style: italic;">"Draw a box comment around the region but arrange for the region</span>
<span style="font-style: italic;">  to extend to at least the fill column. Place the point after the</span>
<span style="font-style: italic;">  comment box."</span>
  (<span style="font-weight: bold;">interactive</span> <span style="font-style: italic;">"r"</span>)
  (<span style="font-weight: bold;">let</span> ((e (copy-marker e t)))
    (goto-char b)
    (end-of-line)
    (insert-char ?  (- fill-column (current-column)))
    (comment-box b e 1)
    (goto-char e)
    (set-marker e nil)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/ascii-string-p</span> (string)
  <span style="font-style: italic;">"Return non-nil if `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">STRING</span><span style="font-style: italic;">' seems to be made of ASCII."</span>
  (<span style="font-weight: bold;">if</span> (length&gt; string 0)
      (string-match-p
       (format <span style="font-style: italic;">"\\`[%s]+\\'"</span> <span style="font-style: italic;">"[:ascii:]&#8217;&#8220;&#8221;&#8211;"</span>)
       string)
    t))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/file-name-legitimate</span> (filename)
  <span style="font-style: italic;">"Substitute legitimate file name for `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">FILENAME</span><span style="font-style: italic;">' so as not to have any special charactors."</span>
  (seq-reduce (<span style="font-weight: bold;">lambda</span> (takeover replace)
                (replace-regexp-in-string
                 (car replace) (cdr replace) takeover))
              '((<span style="font-style: italic;">"/"</span> . <span style="font-style: italic;">"&#65295;"</span>)
                (<span style="font-style: italic;">"\""</span> . <span style="font-style: italic;">"&#10078;"</span>)
                (<span style="font-style: italic;">"'"</span> . <span style="font-style: italic;">"&#10076;"</span>))
              filename))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/kansuji-to-number</span> (kansuuji-string)
  <span style="font-style: italic;">"Translate Japanese Kansuuji(&#28450;&#25968;&#23383;) KANSUUJI-STRING to number."</span>
  (<span style="font-weight: bold;">let*</span> ((kanji-digits '(?&#19968; ?&#20108; ?&#19977; ?&#22235; ?&#20116; ?&#20845; ?&#19971; ?&#20843; ?&#20061;))
         (kanji-units '((?&#21313; . 10) (?&#30334; . 100) (?&#21315; . 1000)))
         (rs (cl-reduce (<span style="font-weight: bold;">lambda</span> (kansuji val)
                          (<span style="font-weight: bold;">let</span> ((digit (cl-position kansuji kanji-digits))
                                (unit (cdr (assoc kansuji kanji-units))))
                            (<span style="font-weight: bold;">if</span> (&gt; (cdr val) 0)
                                (cons (+ (car val) (* (cdr val)
                                                      (1+ (<span style="font-weight: bold;">or</span> digit 0))))
                                      (<span style="font-weight: bold;">or</span> unit 0))
                              (<span style="font-weight: bold;">cond</span>
                               (digit (cons (+ (1+ digit) (car val)) 0))
                               (unit (cons (car val) unit))))))
                        kansuuji-string
                        <span style="font-weight: bold;">:from-end</span> t <span style="font-weight: bold;">:initial-value</span> (cons 0 0))))
    (+ (car rs) (cdr rs))))
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="org7926f79"></a>literate configuration (this file)<br />
<div class="outline-text-5" id="text-org7926f79">
<p>
Configuration files are generated by tangling org source blocks whenever this file is saved defined in <a href=".dir-locals.el">.dir-locals.el</a>. Following code suppresses confirmation at file saving.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/compile-default-command</span> ()
  <span style="font-style: italic;">"Compile `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">compile-command</span><span style="font-style: italic;">'."</span>
  (<span style="font-weight: bold;">let</span> ((default-directory (project-root (project-current t)))
        (compilation-buffer-name-function
         (<span style="font-weight: bold;">or</span> project-compilation-buffer-name-function
             compilation-buffer-name-function)))
    (funcall #'compile compile-command))
  (quit-window))

(add-to-list 'safe-local-eval-forms
             '(add-hook 'after-save-hook
                        #'my/compile-default-command nil t))
</pre>
</div>
</div>

<ul class="org-ul">
<li><a id="orgd8e8349"></a>Common Babel Config<br />
<div class="outline-text-6" id="text-orgd8e8349">
<p>
I'd share this babel config between literate configuration and main Emacs session.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">with-eval-after-load</span> 'ob-core
  (<span style="font-weight: bold;">setq</span> org-babel-noweb-error-all-langs t)
  (<span style="font-weight: bold;">setopt</span> org-babel-python-command (executable-find <span style="font-style: italic;">"python3"</span>))
  (<span style="font-weight: bold;">setopt</span> org-babel-ruby-command (executable-find <span style="font-style: italic;">"ruby"</span>))
  (<span style="font-weight: bold;">setopt</span> org-confirm-babel-evaluate nil)
  (<span style="font-weight: bold;">setopt</span> org-babel-load-languages '((shell      . t)
                                     (emacs-lisp . t)
                                     (python     . t)
                                     (ruby       . t)))
  (<span style="font-weight: bold;">setf</span> org-babel-default-header-args
        (append org-babel-default-header-args
                '((<span style="font-weight: bold;">:mkdirp</span> . t)
                  (<span style="font-weight: bold;">:comments</span> . <span style="font-style: italic;">"link"</span>)))))

(<span style="font-weight: bold;">with-eval-after-load</span> 'ob-shell
  (add-to-list 'org-babel-default-header-args:shell
               '(<span style="font-weight: bold;">:shebang</span> . <span style="font-style: italic;">"#!/bin/sh"</span>))
  (add-to-list 'org-babel-default-header-args:shell
               `(<span style="font-weight: bold;">:tangle-mode</span> . ,(identity #o755)))
  (add-to-list 'org-babel-default-header-args:bash
               `(<span style="font-weight: bold;">:tangle-mode</span> . ,(identity #o755)))
  (add-to-list 'org-babel-default-header-args:bash
               '(<span style="font-weight: bold;">:shebang</span> . <span style="font-style: italic;">"#!/usr/bin/env bash\nset -euo pipefail\n"</span>)))

(<span style="font-weight: bold;">with-eval-after-load</span> 'ob-emacs-lisp
  (add-to-list 'org-babel-default-header-args:emacs-lisp
               `(<span style="font-weight: bold;">:tangle-mode</span> . ,(identity #o444))))

(<span style="font-weight: bold;">with-eval-after-load</span> 'ob-python
  (mapc (<span style="font-weight: bold;">lambda</span> (header-arg)
          (add-to-list 'org-babel-default-header-args:python
                       header-arg))
        `((<span style="font-weight: bold;">:tangle-mode</span> . ,(identity #o755))
          (<span style="font-weight: bold;">:shebang</span> . <span style="font-style: italic;">"#!/usr/bin/env python3"</span>))))

(<span style="font-weight: bold;">with-eval-after-load</span> 'ob-ruby
  (mapc (<span style="font-weight: bold;">lambda</span> (header-arg)
          (add-to-list 'org-babel-default-header-args:ruby
                       header-arg))
        `((<span style="font-weight: bold;">:tangle-mode</span> . ,(identity #o755))
          (<span style="font-weight: bold;">:shebang</span> . <span style="font-style: italic;">"#!/usr/bin/env ruby"</span>))))
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="org90e5747"></a>custom RX definitions<br />
<div class="outline-text-5" id="text-org90e5747">
<p>
My RX function 'parened' evaluates 'parened-rx' with reb-target-buffer's syntax table since  working buffer with RX in re-builder is reb-lisp-mode which does not hold same syntax table with target-buffer.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">parened-rx</span> (paren-open-char element)
  `(seq ,paren-open-char
        (group ,element)
        ,(matching-paren paren-open-char)))

(<span style="font-weight: bold;">rx-define</span> parened (paren-open-char element)
  (eval (<span style="font-weight: bold;">with-syntax-table</span> (<span style="font-weight: bold;">cond</span>
                            ((derived-mode-p 'reb-lisp-mode)
                             (<span style="font-weight: bold;">with-current-buffer</span> reb-target-buffer (syntax-table)))
                            ((derived-mode-p 'minibuffer-mode)
                             (<span style="font-weight: bold;">with-current-buffer</span> (other-buffer nil t) (syntax-table)))
                            (t (syntax-table)))
          (parened-rx paren-open-char 'element))))
</pre>
</div>
</div>
</li>

<li><a id="org8aba38d"></a>dispatch-dwim commands<br />
<div class="outline-text-5" id="text-org8aba38d">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">dispatch-dwim</span> nil t)

<span style="font-weight: bold; font-style: italic;">;;; </span><span style="font-weight: bold; font-style: italic;">Misc</span>

(<span style="font-weight: bold;">defalias</span> '<span style="font-weight: bold;">dispatch-execute-macro</span> (kmacro <span style="font-style: italic;">"RET"</span>))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">dispatch-dwim-select</span> ()
  <span style="font-style: italic;">"Execute dispatch-*-dwim command."</span>
  (<span style="font-weight: bold;">declare</span> (interactive-only command-execute))
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">let</span> ((read-extended-command-predicate
         (<span style="font-weight: bold;">lambda</span> (sym buf)
           (string-match-p (<span style="font-weight: bold;">rx</span> <span style="font-style: italic;">"dispatch-dwim"</span> eos)
                           (symbol-name sym)))))
    (execute-extended-command current-prefix-arg)))
(keymap-global-set <span style="font-style: italic;">"H-D"</span> 'dispatch-dwim-select)
</pre>
</div>
</div>

<ul class="org-ul">
<li><a id="orgf3a08b3"></a>mpv command<br />
<div class="outline-text-6" id="text-orgf3a08b3">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">transient-define-prefix</span> mpv-dispatch-dwim (file <span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> no-resume start end)
  <span style="font-style: italic;">""</span>
  <span style="font-weight: bold;">:man-page</span> <span style="font-style: italic;">"mpv"</span>
  [(<span style="font-style: italic;">"-R"</span> <span style="font-style: italic;">"noresume"</span> <span style="font-style: italic;">"--no-resume-playback"</span>
    <span style="font-weight: bold;">:init-value</span> (<span style="font-weight: bold;">lambda</span> (obj) (<span style="font-weight: bold;">oset</span> obj value (<span style="font-weight: bold;">if</span> no-resume <span style="font-style: italic;">"--no-resume-playback"</span> nil))))
   (<span style="font-style: italic;">"-s"</span> <span style="font-style: italic;">"start"</span> <span style="font-style: italic;">"--start="</span> <span style="font-weight: bold;">:prompt</span> <span style="font-style: italic;">"start: "</span>
    <span style="font-weight: bold;">:init-value</span> (<span style="font-weight: bold;">lambda</span> (obj) (<span style="font-weight: bold;">oset</span> obj value start)))
   (<span style="font-style: italic;">"-e"</span> <span style="font-style: italic;">"end"</span> <span style="font-style: italic;">"--end="</span> <span style="font-weight: bold;">:prompt</span> <span style="font-style: italic;">"end: "</span>
    <span style="font-weight: bold;">:init-value</span> (<span style="font-weight: bold;">lambda</span> (obj) (<span style="font-weight: bold;">oset</span> obj value end)))]
  [(dispatch-dwim-execute
    <span style="font-weight: bold;">:command-format</span>
    (format <span style="font-style: italic;">"mpv %%a %s"</span>
            (dispatch-dwim-shell-argument (plist-get (<span style="font-weight: bold;">oref</span> transient-current-prefix scope) 'file))))]
  (<span style="font-weight: bold;">interactive</span> (list (<span style="font-weight: bold;">or</span> (<span style="font-weight: bold;">unless</span> (equal current-prefix-arg '(4))
                           (dispatch-dwim-determine-file-name))
                         (read-file-name <span style="font-style: italic;">"File to play: "</span>))))
  (transient-setup 'mpv-dispatch-dwim nil nil
                   <span style="font-weight: bold;">:scope</span> (plist-put nil 'file file)))

(<span style="font-weight: bold;">with-eval-after-load</span> 'embark
  (mapc (<span style="font-weight: bold;">lambda</span> (map)
          (lambda-key map <span style="font-style: italic;">"P"</span>
                      (<span style="font-weight: bold;">lambda</span> (file)
                        <span style="font-style: italic;">"play media FILE"</span>
                        (mpv-dispatch-dwim file t))))
        (list embark-file-map embark-url-map))
  (<span style="font-weight: bold;">with-eval-after-load</span> 'org
    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/flink-path</span> (flink)
      (<span style="font-weight: bold;">let*</span> ((exp-link (org-link-expand-abbrev flink)))
        (string-trim-right
         (string-trim-left exp-link <span style="font-style: italic;">"file:"</span>)
         <span style="font-style: italic;">"::.+$"</span>)))
    (mapc (<span style="font-weight: bold;">lambda</span> (map)
            (lambda-key map <span style="font-style: italic;">"P"</span>
                        (<span style="font-weight: bold;">lambda</span> (link)
                          <span style="font-style: italic;">"play media file written in org LINK"</span>
                          (mpv-dispatch-dwim (my/flink-path link) t))))
          (list embark-org-link-map))
    (mapc
     (<span style="font-weight: bold;">lambda</span> (map)
       (lambda-key map <span style="font-style: italic;">"P"</span>
                   (<span style="font-weight: bold;">lambda</span> (list)
                     <span style="font-style: italic;">"play media in LIST"</span>
                     (mpv-dispatch-dwim (mapcar (<span style="font-weight: bold;">lambda</span> (item)
                                                  (<span style="font-weight: bold;">when</span> (string-match org-link-any-re (car item))
                                                    (my/flink-path (match-string-no-properties 2 (car item)))))
                                                (cdr (org-list-to-lisp list)))
                                        t))))
     (list embark-org-plain-list-map))))
</pre>
</div>
</div>
</li>

<li><a id="orge923f12"></a>ffmpeg-opus command<br />
<div class="outline-text-6" id="text-orge923f12">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">transient-define-prefix</span> ffmpeg-opus-dispatch-dwim (file)
  <span style="font-style: italic;">""</span>
  [(<span style="font-style: italic;">"-b"</span> <span style="font-style: italic;">"bitrate"</span> <span style="font-style: italic;">"-b:a "</span> <span style="font-weight: bold;">:prompt</span> <span style="font-style: italic;">"bitrate: "</span> <span style="font-weight: bold;">:class</span> transient-option
    <span style="font-weight: bold;">:init-value</span> (<span style="font-weight: bold;">lambda</span> (obj) (<span style="font-weight: bold;">oset</span> obj value <span style="font-style: italic;">"64k"</span>)))
   (<span style="font-style: italic;">"-t"</span> <span style="font-style: italic;">"tempo"</span> <span style="font-style: italic;">"-filter:a atempo="</span> <span style="font-weight: bold;">:prompt</span> <span style="font-style: italic;">"tempo (floating number): "</span>)]
  [(dispatch-dwim-execute
    <span style="font-weight: bold;">:command-format</span>
    (format <span style="font-style: italic;">"parallel ffmpeg -i '</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">{}</span><span style="font-style: italic;">' -c:a libopus -ac 2 %%a '</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">{.}</span><span style="font-style: italic;">'.opus ::: %s"</span>
            (dispatch-dwim-shell-argument (plist-get (<span style="font-weight: bold;">oref</span> transient-current-prefix scope) 'file))))]
  (<span style="font-weight: bold;">interactive</span> (list (<span style="font-weight: bold;">or</span> (<span style="font-weight: bold;">unless</span> (equal current-prefix-arg '(4))
                           (dispatch-dwim-determine-file-name))
                         (read-file-name <span style="font-style: italic;">"File to convert to opus: "</span>))))
  (transient-setup 'ffmpeg-opus-dispatch-dwim nil nil
                   <span style="font-weight: bold;">:scope</span> (plist-put nil 'file file)))
</pre>
</div>
</div>
</li>

<li><a id="orgd7f74be"></a>ffmpeg-vp9 command<br />
<div class="outline-text-6" id="text-orgd7f74be">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">transient-define-prefix</span> ffmpeg-vp9-dispatch-dwim (file)
  <span style="font-style: italic;">""</span>
  [(<span style="font-style: italic;">"-B"</span> <span style="font-style: italic;">"audio bitrate"</span> <span style="font-style: italic;">"-b:a "</span> <span style="font-weight: bold;">:prompt</span> <span style="font-style: italic;">"Audio bitrate: "</span> <span style="font-weight: bold;">:class</span> transient-option
    <span style="font-weight: bold;">:init-value</span> (<span style="font-weight: bold;">lambda</span> (obj) (<span style="font-weight: bold;">oset</span> obj value <span style="font-style: italic;">"128k"</span>)))
   (<span style="font-style: italic;">"-c"</span> <span style="font-style: italic;">"crf"</span> <span style="font-style: italic;">"-crf "</span> <span style="font-weight: bold;">:prompt</span> <span style="font-style: italic;">"CRF value: "</span> <span style="font-weight: bold;">:class</span> transient-option
    <span style="font-weight: bold;">:init-value</span> (<span style="font-weight: bold;">lambda</span> (obj) (<span style="font-weight: bold;">oset</span> obj value <span style="font-style: italic;">"28"</span>)))
   (<span style="font-style: italic;">"-ss"</span> <span style="font-style: italic;">"seek start"</span> <span style="font-style: italic;">"-ss "</span> <span style="font-weight: bold;">:prompt</span> <span style="font-style: italic;">"Time to start seeking: "</span> <span style="font-weight: bold;">:class</span> transient-option)
   (<span style="font-style: italic;">"-to"</span> <span style="font-style: italic;">"seek stop"</span> <span style="font-style: italic;">"-to "</span> <span style="font-weight: bold;">:prompt</span> <span style="font-style: italic;">"Time to stop seeking: "</span> <span style="font-weight: bold;">:class</span> transient-option)]
  [(dispatch-dwim-execute
    <span style="font-weight: bold;">:command-format</span>
    (apply #'format
           <span style="font-style: italic;">"ffmpeg -i %5$s %1$s %2$s /dev/null &amp;&amp; ffmpeg %%S -i %5$s %1$s %3$s %4$s %6$s_vp9.mkv"</span>
           <span style="font-style: italic;">"-c:v libvpx-vp9 -cpu-used 4 -threads 3 -row-mt 1 -speed 1 -b:v 0 %c"</span>
           <span style="font-style: italic;">"-pass 1 -an -f null"</span>
           <span style="font-style: italic;">"-pass 2 -map_metadata 0"</span>
           <span style="font-style: italic;">"-c:a libopus %b -ac 2"</span>
           (<span style="font-weight: bold;">let*</span> ((f (plist-get (<span style="font-weight: bold;">oref</span> transient-current-prefix scope) 'file))
                  (valid-f (dispatch-dwim-shell-argument f)))
             (list valid-f
                   (file-name-base valid-f))))
    <span style="font-weight: bold;">:command-format-spec</span> ((?b . (dispatch-shell-command--key-vals '(<span style="font-style: italic;">"-B"</span>)))
                          (?c . (dispatch-shell-command--key-vals '(<span style="font-style: italic;">"-c"</span>)))
                          (?S . (dispatch-shell-command--key-vals '(<span style="font-style: italic;">"-ss"</span> <span style="font-style: italic;">"-to"</span>)))))]
  (<span style="font-weight: bold;">interactive</span> (list (<span style="font-weight: bold;">or</span> (<span style="font-weight: bold;">unless</span> (equal current-prefix-arg '(4))
                           (dispatch-dwim-determine-file-name))
                         (read-file-name <span style="font-style: italic;">"Input file: "</span>))))
  (transient-setup 'ffmpeg-vp9-dispatch-dwim nil nil
                   <span style="font-weight: bold;">:scope</span> (plist-put nil 'file file)))
</pre>
</div>
</div>
</li>

<li><a id="org1391e53"></a>handbrake command<br />
<div class="outline-text-6" id="text-org1391e53">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">transient-define-prefix</span> handbrake-dispatch-dwim (file)
  <span style="font-style: italic;">""</span>
  [(<span style="font-style: italic;">"-o"</span> <span style="font-style: italic;">"Destination file name"</span> <span style="font-style: italic;">"--output "</span>
    <span style="font-weight: bold;">:class</span> transient-option <span style="font-weight: bold;">:prompt</span> <span style="font-style: italic;">"Output file (.mp4/.mkv/.webm): "</span>
    <span style="font-weight: bold;">:init-value</span> (<span style="font-weight: bold;">lambda</span> (obj)
                  (<span style="font-weight: bold;">oset</span> obj value
                        (<span style="font-weight: bold;">if</span> (<span style="font-weight: bold;">and</span> (stringp file)
                                 (<span style="font-weight: bold;">or</span> (file-exists-p file)
                                     (file-directory-p file)))
                            (format <span style="font-style: italic;">"%s-hbout.mkv"</span>
                                    (file-name-base file))
                          <span style="font-style: italic;">"hbout.mkv"</span>))))
   (<span style="font-style: italic;">"-m"</span> <span style="font-style: italic;">"Add chapter markers"</span> <span style="font-style: italic;">"--markers"</span> <span style="font-weight: bold;">:class</span> transient-switch
    <span style="font-weight: bold;">:init-value</span> (<span style="font-weight: bold;">lambda</span> (obj) (<span style="font-weight: bold;">oset</span> obj value <span style="font-style: italic;">"--markers"</span>)))
   (<span style="font-style: italic;">"-t"</span> <span style="font-style: italic;">"Titles"</span> <span style="font-style: italic;">"--title "</span>
    <span style="font-weight: bold;">:class</span> transient-option <span style="font-weight: bold;">:prompt</span> <span style="font-style: italic;">"Titles (0 to scan): "</span>)
   (<span style="font-style: italic;">"-F"</span> <span style="font-style: italic;">"Main feature title"</span> <span style="font-style: italic;">"--main-feature"</span> <span style="font-weight: bold;">:class</span> transient-switch
    <span style="font-weight: bold;">:init-value</span> (<span style="font-weight: bold;">lambda</span> (obj) (<span style="font-weight: bold;">oset</span> obj value <span style="font-style: italic;">"--main-feature"</span>)))
   (<span style="font-style: italic;">"-S"</span> <span style="font-style: italic;">"Subtitle"</span> <span style="font-style: italic;">""</span> <span style="font-weight: bold;">:class</span> transient-switches
    <span style="font-weight: bold;">:argument-format</span> <span style="font-style: italic;">"--%s"</span>
    <span style="font-weight: bold;">:argument-regexp</span> <span style="font-style: italic;">"</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">--</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">all-subtitles</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">|</span><span style="font-style: italic;">first-subtitles</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">"</span>
    <span style="font-weight: bold;">:choices</span> (<span style="font-style: italic;">"all-subtitles"</span> <span style="font-style: italic;">"first-subtitles"</span>)
    <span style="font-weight: bold;">:init-value</span> (<span style="font-weight: bold;">lambda</span> (obj) (<span style="font-weight: bold;">oset</span> obj value <span style="font-style: italic;">"--all-subtitles"</span>)))]
  [<span style="font-style: italic;">"Video"</span>
   (<span style="font-style: italic;">"e"</span> <span style="font-style: italic;">"Encoder"</span> <span style="font-style: italic;">""</span>
    <span style="font-weight: bold;">:class</span> transient-switches
    <span style="font-weight: bold;">:argument-format</span> <span style="font-style: italic;">"--encoder %s"</span>
    <span style="font-weight: bold;">:argument-regexp</span> <span style="font-style: italic;">"</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">--encoder </span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">VP8</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">|</span><span style="font-style: italic;">VP9</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">|</span><span style="font-style: italic;">x264</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">|</span><span style="font-style: italic;">x265</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">|</span><span style="font-style: italic;">svt_av1</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">"</span>
    <span style="font-weight: bold;">:choices</span> (<span style="font-style: italic;">"VP8"</span> <span style="font-style: italic;">"VP9"</span> <span style="font-style: italic;">"x264"</span> <span style="font-style: italic;">"x265"</span> <span style="font-style: italic;">"svt_av1"</span>)
    <span style="font-weight: bold;">:init-value</span> (<span style="font-weight: bold;">lambda</span> (obj) (<span style="font-weight: bold;">oset</span> obj value <span style="font-style: italic;">"--encoder VP9"</span>)))
   (<span style="font-style: italic;">"p"</span> <span style="font-style: italic;">"Preset"</span> <span style="font-style: italic;">""</span>
    <span style="font-weight: bold;">:class</span> transient-switches
    <span style="font-weight: bold;">:argument-format</span> <span style="font-style: italic;">"--encoder-preset %s"</span>
    <span style="font-weight: bold;">:argument-regexp</span> <span style="font-style: italic;">"</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">--encoder </span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">.+</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">"</span>
    <span style="font-weight: bold;">:choices</span> (<span style="font-style: italic;">"veryfast"</span> <span style="font-style: italic;">"faster"</span> <span style="font-style: italic;">"fast"</span> <span style="font-style: italic;">"medium"</span> <span style="font-style: italic;">"slow"</span> <span style="font-style: italic;">"slower"</span> <span style="font-style: italic;">"veryslow"</span>)
    <span style="font-weight: bold;">:init-value</span> (<span style="font-weight: bold;">lambda</span> (obj) (<span style="font-weight: bold;">oset</span> obj value <span style="font-style: italic;">"--encoder-preset fast"</span>)))
   (<span style="font-style: italic;">"-q"</span> <span style="font-style: italic;">"Quality"</span> <span style="font-style: italic;">"--quality "</span>
    <span style="font-weight: bold;">:class</span> transient-option <span style="font-weight: bold;">:prompt</span> <span style="font-style: italic;">"Quality value (float): "</span>
    <span style="font-weight: bold;">:init-value</span> (<span style="font-weight: bold;">lambda</span> (obj) (<span style="font-weight: bold;">oset</span> obj value <span style="font-style: italic;">"18.0"</span>)))
   (<span style="font-style: italic;">"-b"</span> <span style="font-style: italic;">"Bitrate"</span> <span style="font-style: italic;">"--vb "</span>
    <span style="font-weight: bold;">:class</span> transient-option <span style="font-weight: bold;">:prompt</span> <span style="font-style: italic;">"Bitrate (in kbps): "</span>)]
  [<span style="font-style: italic;">"Audio"</span>
   (<span style="font-style: italic;">"T"</span> <span style="font-style: italic;">"Track"</span> <span style="font-style: italic;">""</span>
    <span style="font-weight: bold;">:class</span> transient-switches
    <span style="font-weight: bold;">:argument-format</span> <span style="font-style: italic;">"--%s"</span>
    <span style="font-weight: bold;">:argument-regexp</span> <span style="font-style: italic;">"</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">--</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">all-audio</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">|</span><span style="font-style: italic;">first-audio</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">"</span>
    <span style="font-weight: bold;">:choices</span> (<span style="font-style: italic;">"all-audio"</span> <span style="font-style: italic;">"first-audio"</span>)
    <span style="font-weight: bold;">:init-value</span> (<span style="font-weight: bold;">lambda</span> (obj) (<span style="font-weight: bold;">oset</span> obj value <span style="font-style: italic;">"--all-audio"</span>)))
   (<span style="font-style: italic;">"E"</span> <span style="font-style: italic;">"Encoder"</span> <span style="font-style: italic;">""</span>
    <span style="font-weight: bold;">:class</span> transient-switches
    <span style="font-weight: bold;">:argument-format</span> <span style="font-style: italic;">"--aencoder %s"</span>
    <span style="font-weight: bold;">:argument-regexp</span> <span style="font-style: italic;">"</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">--aencoder </span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">opus</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">|</span><span style="font-style: italic;">copy</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">"</span>
    <span style="font-weight: bold;">:choices</span> (<span style="font-style: italic;">"opus"</span> <span style="font-style: italic;">"copy"</span>)
    <span style="font-weight: bold;">:init-value</span> (<span style="font-weight: bold;">lambda</span> (obj) (<span style="font-weight: bold;">oset</span> obj value <span style="font-style: italic;">"--aencoder copy"</span>)))
   (<span style="font-style: italic;">"-B"</span> <span style="font-style: italic;">"Bitrate"</span> <span style="font-style: italic;">"--ab "</span>
    <span style="font-weight: bold;">:class</span> transient-option <span style="font-weight: bold;">:prompt</span> <span style="font-style: italic;">"Bitrate (in kbps): "</span>)]
  [(dispatch-dwim-execute
    <span style="font-weight: bold;">:command-format</span>
    (format <span style="font-style: italic;">"HandBrakeCLI --input %s %%a"</span>
            (dispatch-dwim-shell-argument (plist-get (<span style="font-weight: bold;">oref</span> transient-current-prefix scope) 'file))))]
  (<span style="font-weight: bold;">interactive</span> (list (<span style="font-weight: bold;">or</span> (<span style="font-weight: bold;">unless</span> (equal current-prefix-arg '(4))
                           (dispatch-dwim-determine-file-name))
                         (read-file-name <span style="font-style: italic;">"Input device or directory: "</span>))))
  (transient-setup 'handbrake-dispatch-dwim nil nil
                   <span style="font-weight: bold;">:scope</span> (plist-put nil 'file file)))
</pre>
</div>
</div>
</li>

<li><a id="org365a285"></a>dvdbackup command<br />
<div class="outline-text-6" id="text-org365a285">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">transient-define-prefix</span> dvdbackup-dispatch-dwim ()
  <span style="font-style: italic;">""</span>
  <span style="font-weight: bold;">:man-page</span> <span style="font-style: italic;">"dvdbackup"</span>
  [(<span style="font-style: italic;">"-i"</span> <span style="font-style: italic;">"Input device"</span> <span style="font-style: italic;">"--input="</span>
    <span style="font-weight: bold;">:class</span> transient-option
    <span style="font-weight: bold;">:prompt</span> <span style="font-style: italic;">"Device file: "</span>
    <span style="font-weight: bold;">:reader</span> transient-read-existing-file
    <span style="font-weight: bold;">:init-value</span> (<span style="font-weight: bold;">lambda</span> (obj) (<span style="font-weight: bold;">oset</span> obj value <span style="font-style: italic;">"/dev/sr0"</span>)))
   (<span style="font-style: italic;">"-o"</span> <span style="font-style: italic;">"Output directory"</span> <span style="font-style: italic;">"--output="</span>
    <span style="font-weight: bold;">:class</span> transient-option
    <span style="font-weight: bold;">:prompt</span> <span style="font-style: italic;">"Output directory: "</span>
    <span style="font-weight: bold;">:reader</span> transient-read-file
    <span style="font-weight: bold;">:init-value</span> (<span style="font-weight: bold;">lambda</span> (obj) (<span style="font-weight: bold;">oset</span> obj value <span style="font-style: italic;">"dvd-out"</span>)))
   (<span style="font-style: italic;">"a"</span> <span style="font-style: italic;">"Action"</span> <span style="font-style: italic;">""</span>
    <span style="font-weight: bold;">:class</span> transient-switches
    <span style="font-weight: bold;">:argument-format</span> <span style="font-style: italic;">"--%s"</span>
    <span style="font-weight: bold;">:argument-regexp</span> <span style="font-style: italic;">"--</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">mirror</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">|</span><span style="font-style: italic;">feature</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">|</span><span style="font-style: italic;">info</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">"</span>
    <span style="font-weight: bold;">:choices</span> (<span style="font-style: italic;">"mirror"</span> <span style="font-style: italic;">"feature"</span> <span style="font-style: italic;">"info"</span>)
    <span style="font-weight: bold;">:init-value</span> (<span style="font-weight: bold;">lambda</span> (obj) (<span style="font-weight: bold;">oset</span> obj value <span style="font-style: italic;">"--mirror"</span>)))]
  [(dispatch-dwim-execute
    <span style="font-weight: bold;">:command-format</span>
    (format <span style="font-style: italic;">"dvdbackup %%a"</span>
            (plist-get (<span style="font-weight: bold;">oref</span> transient-current-prefix scope) 'file)))]
  (<span style="font-weight: bold;">interactive</span>)
  (transient-setup 'dvdbackup-dispatch-dwim))
</pre>
</div>
</div>
</li>

<li><a id="org035b4ee"></a>rtcwake complex command<br />
<div class="outline-text-6" id="text-org035b4ee">
<div class="org-src-container">
<pre class="src src-emacs-lisp" id="org44ff9eb">(<span style="font-weight: bold;">transient-define-prefix</span> sleep-dispatch-dwim (<span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> number)
  <span style="font-style: italic;">""</span>
  <span style="font-weight: bold;">:man-page</span> <span style="font-style: italic;">"sleep"</span>
  [(<span style="font-style: italic;">"n"</span> <span style="font-style: italic;">"Number[SUFFIX]"</span> <span style="font-style: italic;">""</span> <span style="font-weight: bold;">:prompt</span> <span style="font-style: italic;">"amount of time [s/m/h/d]: "</span>
    <span style="font-weight: bold;">:class</span> transient-option <span style="font-weight: bold;">:always-read</span> t <span style="font-weight: bold;">:allow-empty</span> nil
    <span style="font-weight: bold;">:init-value</span> (<span style="font-weight: bold;">lambda</span> (obj) (<span style="font-weight: bold;">oset</span> obj value (<span style="font-weight: bold;">or</span> number <span style="font-style: italic;">"0"</span>))))]
  [(dispatch-dwim-execute
    <span style="font-weight: bold;">:command-format</span> <span style="font-style: italic;">"sleep %a"</span>)]
  (<span style="font-weight: bold;">interactive</span>)
  (transient-setup 'sleep-dispatch-dwim))

(<span style="font-weight: bold;">transient-define-prefix</span> option-dispatch-dwim (<span style="font-weight: bold; text-decoration: underline;">&amp;rest</span> options)
  <span style="font-style: italic;">""</span>
  [(<span style="font-style: italic;">"o"</span> <span style="font-style: italic;">"option"</span> <span style="font-style: italic;">""</span>
    <span style="font-weight: bold;">:class</span> transient-option
    <span style="font-weight: bold;">:init-value</span> (<span style="font-weight: bold;">lambda</span> (obj)
                  (<span style="font-weight: bold;">oset</span> obj choices options)
                  (<span style="font-weight: bold;">oset</span> obj value (car (<span style="font-weight: bold;">oref</span> obj choices)))))]
  [(dispatch-dwim-execute)]
  (<span style="font-weight: bold;">interactive</span>)
  (transient-setup 'option-dispatch-dwim))

(<span style="font-weight: bold;">transient-define-prefix</span> rtcwake-dispatch-dwim (<span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> number)
  <span style="font-style: italic;">""</span>
  <span style="font-weight: bold;">:man-page</span> <span style="font-style: italic;">"rtcwake"</span>
  [(<span style="font-style: italic;">"-t"</span> <span style="font-style: italic;">"wake-up time"</span> <span style="font-style: italic;">"--date "</span> <span style="font-weight: bold;">:prompt</span> <span style="font-style: italic;">"Wake-up time: "</span> <span style="font-weight: bold;">:class</span> transient-option
    <span style="font-weight: bold;">:allow-empty</span> nil <span style="font-weight: bold;">:reader</span> my/transient-read-time <span style="font-weight: bold;">:always-read</span> t
    <span style="font-weight: bold;">:init-value</span> (<span style="font-weight: bold;">lambda</span> (obj) (<span style="font-weight: bold;">oset</span> obj value (my/transient-read-time nil <span style="font-style: italic;">"+6h15m"</span> nil))))]
  [(<span style="font-style: italic;">"{"</span> <span style="font-style: italic;">"preceding sleep"</span> dispatch-dwim-fraction-command
    <span style="font-weight: bold;">:prefix</span> sleep-dispatch-dwim <span style="font-weight: bold;">:prefix-arg</span> (<span style="font-style: italic;">"30m"</span>) <span style="font-weight: bold;">:priority</span> 20
    <span style="font-weight: bold;">:default</span> <span style="font-style: italic;">"sleep 30m"</span>)
   (<span style="font-style: italic;">"["</span> <span style="font-style: italic;">"following command"</span> dispatch-dwim-fraction-command
    <span style="font-weight: bold;">:prefix</span> option-dispatch-dwim <span style="font-weight: bold;">:prefix-arg</span> (<span style="font-style: italic;">"midnight.sh"</span>)
    <span style="font-weight: bold;">:priority</span> 30 <span style="font-weight: bold;">:default</span> <span style="font-style: italic;">"midnight.sh"</span>)
   (<span style="font-style: italic;">"]"</span> <span style="font-style: italic;">"following command"</span> dispatch-dwim-fraction-command
    <span style="font-weight: bold;">:prefix</span> option-dispatch-dwim <span style="font-weight: bold;">:prefix-arg</span> (<span style="font-style: italic;">"morning.sh"</span>)
    <span style="font-weight: bold;">:priority</span> 90 <span style="font-weight: bold;">:default</span> <span style="font-style: italic;">"morning.sh"</span>)
   (dispatch-dwim-execute
    <span style="font-weight: bold;">:command-format</span> <span style="font-style: italic;">"pwsudo rtcwake -l -m mem -v %d"</span>
    <span style="font-weight: bold;">:command-format-spec</span> ((?d . (dispatch-shell-command--key-vals '(<span style="font-style: italic;">"-t"</span>)))))])

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/transient-read-time</span> (prompt default-time history)
  <span style="font-style: italic;">"Read time using date command."</span>
  (<span style="font-weight: bold;">or</span> (seq-some (<span style="font-weight: bold;">lambda</span> (d)
                  (<span style="font-weight: bold;">let*</span> ((time-str (string-trim
                                    (shell-command-to-string
                                     (format <span style="font-style: italic;">"date +'%%Y-%%m-%%d %%H:%%M' -d '</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">%s</span><span style="font-style: italic;">'"</span>
                                             (my/expand-shorthand-time d)))))
                         (time-ts (<span style="font-weight: bold;">or</span> (<span style="font-weight: bold;">and</span> (string-prefix-p <span style="font-style: italic;">"date: invalid date"</span>
                                                            time-str)
                                           (message <span style="font-style: italic;">"Invalid time"</span>))
                                      (encode-time (parse-time-string time-str)))))
                    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Ask the user if the specified time is designated as either past or beyond 12 hours</span>
                    (<span style="font-weight: bold;">if</span> (<span style="font-weight: bold;">and</span> (<span style="font-weight: bold;">or</span> (time-less-p time-ts (current-time))
                                 (time-less-p (time-add nil (seconds-to-time (* 12 60 60)))
                                              time-ts))
                             (not (y-or-n-p (format <span style="font-style: italic;">"Is %s right?: "</span> time-str))))
                        (car (symbol-value history))
                      (format <span style="font-style: italic;">"'</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">%s</span><span style="font-style: italic;">'"</span> time-str))))
                (delq nil (list (<span style="font-weight: bold;">and</span> prompt (read-string prompt)) default-time)))
      <span style="font-style: italic;">""</span>))
</pre>
</div>
</div>
</li>

<li><a id="orgc10796c"></a>pandoc command<br />
<div class="outline-text-6" id="text-orgc10796c">
<div class="org-src-container">
<pre class="src src-emacs-lisp" id="orgbed725a">(<span style="font-weight: bold;">transient-define-prefix</span> pandoc-dispatch-dwim (file)
  <span style="font-style: italic;">""</span>
  <span style="font-weight: bold;">:man-page</span> <span style="font-style: italic;">"pandoc"</span>
  [(<span style="font-style: italic;">"-t"</span> <span style="font-style: italic;">"Ootput format"</span> <span style="font-style: italic;">"--to="</span>
    <span style="font-weight: bold;">:class</span> transient-option
    <span style="font-weight: bold;">:always-read</span> t
    <span style="font-weight: bold;">:choices</span> (<span style="font-style: italic;">"org"</span> <span style="font-style: italic;">"pdf"</span> <span style="font-style: italic;">"epub"</span> <span style="font-style: italic;">"rst"</span> <span style="font-style: italic;">"texinfo"</span> <span style="font-style: italic;">"odt"</span> <span style="font-style: italic;">"docx"</span> <span style="font-style: italic;">"markdown"</span> <span style="font-style: italic;">"asciidoc"</span> <span style="font-style: italic;">"plain"</span>)
    <span style="font-weight: bold;">:init-value</span> (<span style="font-weight: bold;">lambda</span> (obj) (<span style="font-weight: bold;">oset</span> obj value (car (<span style="font-weight: bold;">oref</span> obj choices)))))]
  [(dispatch-dwim-execute
    <span style="font-weight: bold;">:command-format</span>
    (format <span style="font-style: italic;">"parallel pandoc %%t %%o '</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">{}</span><span style="font-style: italic;">' ::: %s"</span>
            (dispatch-dwim-shell-argument (plist-get (<span style="font-weight: bold;">oref</span> transient-current-prefix scope) 'file)))
    <span style="font-weight: bold;">:command-format-spec</span> ((?t . (dispatch-shell-command--key-vals '(<span style="font-style: italic;">"-t"</span>)))
                          (?o . (seq-some (<span style="font-weight: bold;">lambda</span> (obj)
                                            (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">and</span> (string= (<span style="font-weight: bold;">oref</span> obj key) <span style="font-style: italic;">"-t"</span>)
                                                       (string-match <span style="font-style: italic;">"--to=</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">.+</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">"</span> (transient-infix-value obj)))
                                              (<span style="font-weight: bold;">let</span> ((out-ext (<span style="font-weight: bold;">pcase</span> (match-string 1 (transient-infix-value obj))
                                                               (<span style="font-style: italic;">"markdown"</span> <span style="font-style: italic;">"md"</span>)
                                                               (<span style="font-style: italic;">"texinfo"</span> <span style="font-style: italic;">"texi"</span>)
                                                               (<span style="font-style: italic;">"asciidoc"</span> <span style="font-style: italic;">"adoc"</span>)
                                                               (<span style="font-style: italic;">"plain"</span> <span style="font-style: italic;">"txt"</span>)
                                                               (x x))))
                                                (concat (format <span style="font-style: italic;">"--output='</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">{.}</span><span style="font-style: italic;">'.%s"</span> out-ext)
                                                        (<span style="font-weight: bold;">when</span> (string= out-ext <span style="font-style: italic;">"pdf"</span>)
                                                          <span style="font-style: italic;">" --pdf-engine weasyprint"</span>)))))
                                          (transient-suffixes (<span style="font-weight: bold;">oref</span> transient-current-prefix command))))))]
  (<span style="font-weight: bold;">interactive</span> (list (<span style="font-weight: bold;">or</span> (<span style="font-weight: bold;">unless</span> (equal current-prefix-arg '(4))
                           (dispatch-dwim-determine-file-name))
                         (read-file-name <span style="font-style: italic;">"File to convert: "</span>))))
  (transient-setup 'pandoc-dispatch-dwim nil nil
                   <span style="font-weight: bold;">:scope</span> (plist-put nil 'file file)))
</pre>
</div>
</div>
</li>

<li><a id="orgfbaf83c"></a>yt-dlp command<br />
<div class="outline-text-6" id="text-orgfbaf83c">
<div class="org-src-container">
<pre class="src src-emacs-lisp" id="org390180f">(<span style="font-weight: bold;">transient-define-prefix</span> yt-dlp-dispatch-dwim (url <span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> output duration-p play-p)
  <span style="font-style: italic;">""</span>
  <span style="font-weight: bold;">:man-page</span> <span style="font-style: italic;">"yt-dlp"</span>
  [(<span style="font-style: italic;">"-P"</span> <span style="font-style: italic;">"download path"</span> <span style="font-style: italic;">"--paths "</span>
    <span style="font-weight: bold;">:class</span> transient-option
    <span style="font-weight: bold;">:reader</span> transient-read-existing-directory
    <span style="font-weight: bold;">:init-value</span> (<span style="font-weight: bold;">lambda</span> (obj) (<span style="font-weight: bold;">oset</span> obj value <span style="font-style: italic;">"&lt;&lt;media-dir()&gt;&gt;"</span>)))
   (<span style="font-style: italic;">"-a"</span> <span style="font-style: italic;">"audio"</span> <span style="font-style: italic;">"-x --embed-thumbnail"</span>)
   (<span style="font-style: italic;">"-F"</span> <span style="font-style: italic;">"free format"</span> <span style="font-style: italic;">"--prefer-free-formats"</span>
    <span style="font-weight: bold;">:init-value</span> (<span style="font-weight: bold;">lambda</span> (obj) (<span style="font-weight: bold;">oset</span> obj value <span style="font-style: italic;">"--prefer-free-formats"</span>)))
   (<span style="font-style: italic;">"-d"</span> <span style="font-style: italic;">"duration"</span> <span style="font-style: italic;">"--get-duration --no-warnings"</span>
    <span style="font-weight: bold;">:init-value</span> (<span style="font-weight: bold;">lambda</span> (obj) (<span style="font-weight: bold;">oset</span> obj value (<span style="font-weight: bold;">and</span> duration-p (<span style="font-weight: bold;">oref</span> obj argument)))))
   (<span style="font-style: italic;">"-p"</span> <span style="font-style: italic;">"play"</span> <span style="font-style: italic;">"--exec 'mpv --no-pause {}</span><span style="font-weight: bold; font-style: italic;">\</span><span style="font-style: italic;">; rm {}'"</span>
    <span style="font-weight: bold;">:init-value</span> (<span style="font-weight: bold;">lambda</span> (obj) (<span style="font-weight: bold;">oset</span> obj value (<span style="font-weight: bold;">and</span> play-p (<span style="font-weight: bold;">oref</span> obj argument)))))
   (<span style="font-style: italic;">"-f"</span> <span style="font-style: italic;">"format"</span> <span style="font-style: italic;">"--format "</span>
    <span style="font-weight: bold;">:class</span> transient-option
    <span style="font-weight: bold;">:init-value</span> (<span style="font-weight: bold;">lambda</span> (obj) (<span style="font-weight: bold;">oset</span> obj value <span style="font-style: italic;">"'</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">bestvideo*+bestaudio/best</span><span style="font-style: italic;">'"</span>)))
   (<span style="font-style: italic;">"-S"</span> <span style="font-style: italic;">"format sort"</span> <span style="font-style: italic;">"--format-sort "</span>
    <span style="font-weight: bold;">:class</span> transient-option
    <span style="font-weight: bold;">:init-value</span> (<span style="font-weight: bold;">lambda</span> (obj) (<span style="font-weight: bold;">oset</span> obj value <span style="font-style: italic;">"'codec,ext,size:1.5G'"</span>)))
   (<span style="font-style: italic;">"-o"</span> <span style="font-style: italic;">"output"</span> <span style="font-style: italic;">"--output "</span>
    <span style="font-weight: bold;">:class</span> transient-option <span style="font-weight: bold;">:reader</span> dispatch-dwim-read-yt-dlp-output
    <span style="font-weight: bold;">:prompt</span> <span style="font-style: italic;">"Output file name without extension: "</span>
    <span style="font-weight: bold;">:init-value</span>
    (<span style="font-weight: bold;">lambda</span> (obj) (<span style="font-weight: bold;">oset</span> obj value
                    (<span style="font-weight: bold;">and</span> output (shell-quote-argument
                                 (format <span style="font-style: italic;">"%s.%%</span><span style="font-weight: bold; font-style: italic;">\</span><span style="font-style: italic;">(ext</span><span style="font-weight: bold; font-style: italic;">\</span><span style="font-style: italic;">)s"</span>
                                         (my/file-name-legitimate output)))))))]
  [(dispatch-dwim-execute
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">embed url to :command-format may cause unexpected glitch</span>
    <span style="font-weight: bold;">:command-format</span>
    <span style="font-style: italic;">"yt-dlp --embed-chapters --live-from-start %a %u"</span>
    <span style="font-weight: bold;">:command-format-spec</span> ((?u . (dispatch-dwim-shell-argument
                                 (plist-get (<span style="font-weight: bold;">oref</span> transient-current-prefix scope) 'url)))))]
  (<span style="font-weight: bold;">interactive</span> (list (<span style="font-weight: bold;">or</span> (<span style="font-weight: bold;">unless</span> (equal current-prefix-arg '(4))
                           (dispatch-dwim-determine-url))
                         (read-string <span style="font-style: italic;">"URL: "</span>))))
  (<span style="font-weight: bold;">setq</span> my/detached-bury-buffer t)
  (transient-setup 'yt-dlp-dispatch-dwim nil nil
                   <span style="font-weight: bold;">:scope</span> (plist-put nil 'url url)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">dispatch-dwim-read-yt-dlp-output</span> (prompt _default _history)
  <span style="font-style: italic;">""</span>
  (shell-quote-argument
   (format <span style="font-style: italic;">"%s.%%</span><span style="font-weight: bold; font-style: italic;">\</span><span style="font-style: italic;">(ext</span><span style="font-weight: bold; font-style: italic;">\</span><span style="font-style: italic;">)s"</span>
           (my/file-name-legitimate (read-string prompt)))))

(<span style="font-weight: bold;">with-eval-after-load</span> 'embark
  (mapc (<span style="font-weight: bold;">lambda</span> (map)
          (lambda-key map <span style="font-style: italic;">"Y"</span>
                      (<span style="font-weight: bold;">lambda</span> (thing)
                        <span style="font-style: italic;">"download media file"</span>
                        (<span style="font-weight: bold;">let</span> ((url (<span style="font-weight: bold;">pcase</span> thing
                                     ((<span style="font-weight: bold;">and</span> (pred (<span style="font-weight: bold;">lambda</span> (s) (string-match org-link-any-re s))) ol)
                                      (<span style="font-weight: bold;">or</span> (match-string-no-properties 0 ol)
                                          (match-string-no-properties 2 ol)))
                                     ((<span style="font-weight: bold;">and</span> (pred (<span style="font-weight: bold;">lambda</span> (s) (string-match ffap-url-at-point s))) u)
                                      (match-string-no-properties 0 u)))))
                          (yt-dlp-dispatch-dwim url)
                          (dispatch-execute-macro)))))
        (list embark-kill-ring-map embark-url-map
              embark-org-link-map)))
</pre>
</div>
</div>
</li>

<li><a id="org07d4b6a"></a>du command<br />
<div class="outline-text-6" id="text-org07d4b6a">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">transient-define-prefix</span> du-dispatch-dwim (file)
  <span style="font-style: italic;">"Dispatch du command."</span>
  <span style="font-weight: bold;">:man-page</span> <span style="font-style: italic;">"du"</span>
  [(<span style="font-style: italic;">"-s"</span> <span style="font-style: italic;">"summarize"</span> <span style="font-style: italic;">"--summarize"</span>
    <span style="font-weight: bold;">:init-value</span> (<span style="font-weight: bold;">lambda</span> (obj) (<span style="font-weight: bold;">oset</span> obj value <span style="font-style: italic;">"--summarize"</span>)))
   (<span style="font-style: italic;">"-c"</span> <span style="font-style: italic;">"add total"</span> <span style="font-style: italic;">"--total"</span>
    <span style="font-weight: bold;">:init-value</span> (<span style="font-weight: bold;">lambda</span> (obj) (<span style="font-weight: bold;">oset</span> obj value <span style="font-style: italic;">"--total"</span>)))
   (<span style="font-style: italic;">"-D"</span> <span style="font-style: italic;">"deref symlinks"</span> <span style="font-style: italic;">"--dereference-args"</span>
    <span style="font-weight: bold;">:init-value</span> (<span style="font-weight: bold;">lambda</span> (obj) (<span style="font-weight: bold;">oset</span> obj value <span style="font-style: italic;">"--dereference-args"</span>)))
   (<span style="font-style: italic;">"-h"</span> <span style="font-style: italic;">"human readable"</span> <span style="font-style: italic;">"--human-readable"</span>
    <span style="font-weight: bold;">:init-value</span> (<span style="font-weight: bold;">lambda</span> (obj) (<span style="font-weight: bold;">oset</span> obj value <span style="font-style: italic;">"--human-readable"</span>)))]
  [(dispatch-dwim-execute
    <span style="font-weight: bold;">:command-format</span>
    (format <span style="font-style: italic;">"ionice -c2 -n7 nice -n19 du %%a %s"</span>
            (dispatch-dwim-shell-argument (plist-get (<span style="font-weight: bold;">oref</span> transient-current-prefix scope) 'file))))]
  (<span style="font-weight: bold;">interactive</span> (list (<span style="font-weight: bold;">or</span> (<span style="font-weight: bold;">unless</span> (equal current-prefix-arg '(4))
                           (dispatch-dwim-determine-file-name))
                         (read-file-name <span style="font-style: italic;">"File: "</span>))))
  (transient-setup 'du-dispatch-dwim nil nil
                   <span style="font-weight: bold;">:scope</span> (plist-put nil 'file file)))
</pre>
</div>
</div>
</li>

<li><a id="orgc991e39"></a>ghq-get command<br />
<div class="outline-text-6" id="text-orgc991e39">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">transient-define-prefix</span> ghq-get-dispatch-dwim (url)
  <span style="font-style: italic;">"Dispatch ghq get command."</span>
  [(<span style="font-style: italic;">"-s"</span> <span style="font-style: italic;">"shallow clone"</span> <span style="font-style: italic;">"--shallow"</span>)]
  [(dispatch-dwim-execute
    <span style="font-weight: bold;">:command-format</span>
    (format <span style="font-style: italic;">"ghq get %%a '</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">%s</span><span style="font-style: italic;">'"</span>
            (plist-get (<span style="font-weight: bold;">oref</span> transient-current-prefix scope) 'url)))]
  (<span style="font-weight: bold;">interactive</span> (list (<span style="font-weight: bold;">or</span> (<span style="font-weight: bold;">unless</span> (equal current-prefix-arg '(4))
                           (dispatch-dwim-determine-url))
                         (read-string <span style="font-style: italic;">"URL: "</span>))))
  (transient-setup 'ghq-get-dispatch-dwim nil nil
                   <span style="font-weight: bold;">:scope</span> (plist-put nil 'url url)))
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="org1719f8f"></a>TempEL templates for major modes<br />
<div class="outline-text-5" id="text-org1719f8f">
<div class="org-src-container">
<pre class="src src-emacs-lisp" id="org753d8ba">(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/region-string-trans-buffer</span> ()
  <span style="font-style: italic;">"Return region string in some buffer where region is active."</span>
  (cl-some (<span style="font-weight: bold;">lambda</span> (buf)
             (<span style="font-weight: bold;">with-current-buffer</span> buf
               (<span style="font-weight: bold;">when</span> (region-active-p)
                 (buffer-substring-no-properties (region-beginning)
                                                 (region-end)))))
           (list (current-buffer) (other-buffer nil t))))
</pre>
</div>
</div>

<ul class="org-ul">
<li><a id="org6bbf040"></a>fundamental-mode templates<br />
<div class="outline-text-6" id="text-org6bbf040">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(timestamp (my/insert-time-stamp))
</pre>
</div>
</div>
</li>

<li><a id="org17fdc4b"></a>text-mode templates<br />
<div class="outline-text-6" id="text-org17fdc4b">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(gma <span style="font-style: italic;">"update on "</span> (my/insert-time-stamp))
</pre>
</div>
</div>
</li>

<li><a id="org8d71b44"></a>org-mode templates<br />
<div class="outline-text-6" id="text-org8d71b44">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(call &amp; <span style="font-style: italic;">"#+CALL: "</span> (p <span style="font-style: italic;">"name"</span> name) <span style="font-style: italic;">"("</span> (s var) <span style="font-style: italic;">"=\""</span> (s value) <span style="font-style: italic;">"\")"</span>)
(name &amp; <span style="font-style: italic;">"#+NAME: "</span> (p <span style="font-style: italic;">"name"</span> name))
(/ <span style="font-style: italic;">"[/]"</span> (org-update-statistics-cookies nil))
(tsm p <span style="font-style: italic;">" :: "</span> (<span style="font-weight: bold;">with-temp-buffer</span> (org-insert-time-stamp (current-time) t t)))

&lt;&lt;org-template&gt;&gt;
</pre>
</div>
</div>
</li>

<li><a id="orgdb36671"></a>minibuffer-mode templates<br />
<div class="outline-text-6" id="text-orgdb36671">
<div class="org-src-container">
<pre class="src src-emacs-lisp">&lt;&lt;minibuffer-mode-template&gt;&gt;

(version (p <span style="font-style: italic;">"command"</span>) <span style="font-style: italic;">" --version"</span>)
(curly-bracket-japanese-regexp
 (<span style="font-weight: bold;">rx</span> (parened ?&#65371; (+ (<span style="font-weight: bold;">or</span> <span style="font-style: italic;">" "</span>
                         (category japanese-hiragana-two-byte)))))))
</pre>
</div>
</div>
</li>

<li><a id="orgbbe53ea"></a>emacs-lisp-mode templates<br />
<div class="outline-text-6" id="text-orgbbe53ea">
<div class="org-src-container">
<pre class="src src-emacs-lisp">&lt;&lt;emacs-lisp-mode-template&gt;&gt;

(<span style="font-weight: bold;">require</span> <span style="font-style: italic;">"(require '"</span> (p <span style="font-style: italic;">"feature"</span>) <span style="font-style: italic;">")"</span>)
(<span style="font-weight: bold;">lambda</span> <span style="font-style: italic;">"(lambda () "</span> n&gt;
  (p <span style="font-style: italic;">"docstring: "</span> doc-str t)
  (<span style="font-weight: bold;">when</span> (length&gt; doc-str 0)
    (format <span style="font-style: italic;">"\"%s\"\n"</span> doc-str))
  &gt; p <span style="font-style: italic;">")"</span>)
(<span style="font-weight: bold;">interactive</span> <span style="font-style: italic;">"(interactive"</span>
             (p <span style="font-style: italic;">"code: "</span> code t)
             (<span style="font-weight: bold;">when</span> (length&gt; code 0)
               (format <span style="font-style: italic;">" \"%s\""</span> code))
             <span style="font-style: italic;">")"</span>)
(<span style="font-weight: bold;">bind-keys</span> <span style="font-style: italic;">"(bind-keys "</span> (p (format <span style="font-style: italic;">":map "</span>))
           <span style="font-style: italic;">"(\""</span> p <span style="font-style: italic;">"\" . "</span> p <span style="font-style: italic;">"))"</span>)
</pre>
</div>
</div>
</li>

<li><a id="orgf5638be"></a>sh-base-mode templates<br />
<div class="outline-text-6" id="text-orgf5638be">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(rf <span style="font-style: italic;">"${"</span> p <span style="font-style: italic;">"}"</span>)
(<span style="font-weight: bold;">function</span> <span style="font-style: italic;">"function "</span> (p <span style="font-style: italic;">"name"</span>) <span style="font-style: italic;">" {"</span> n&gt; p n <span style="font-style: italic;">"}"</span>)
</pre>
</div>
</div>
</li>

<li><a id="org51a37a9"></a>mu4e-compose-mode templates<br />
<div class="outline-text-6" id="text-org51a37a9">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(&#12424;&#12429; <span style="font-style: italic;">"&#12424;&#12429;&#12375;&#12367;&#12362;&#39000;&#12356;&#12356;&#12383;&#12375;&#12414;&#12377;&#12290;"</span>)
(&#12356;&#12376;&#12423;&#12358; <span style="font-style: italic;">"&#20197;&#19978;&#12289;&#12424;&#12429;&#12375;&#12367;&#12362;&#39000;&#12356;&#12356;&#12383;&#12375;&#12414;&#12377;&#12290;"</span>)
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="orgd14acb6"></a>elisp code from outside of Emacs<br />
<div class="outline-text-5" id="text-orgd14acb6">
<p>
This section mainly for elisp code associated with some other programs.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">&lt;&lt;elisp-code&gt;&gt;
</pre>
</div>
</div>
</li>

<li><a id="org8e66dc9"></a>obsolete features&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span><br /></li>
</ul>
</div>

<div id="outline-container-org1747626" class="outline-4">
<h4 id="org1747626">Org Tweaks for Specific Needs</h4>
<div class="outline-text-4" id="text-org1747626">
</div>

<ul class="org-ul">
<li><a id="orgd58ad28"></a>org link at point map<br />
<div class="outline-text-5" id="text-orgd58ad28">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">org-link-at-point-map</span> (function)
  <span style="font-style: italic;">"Call FUNCTION with a list whose elements are the URL and title</span>
<span style="font-style: italic;">obtained from the org-link at the current point."</span>
  (<span style="font-weight: bold;">when-let*</span> ((context (org-element-lineage
                        (org-element-context)
                        '(link)
                        t))
              (type (org-element-property <span style="font-weight: bold;">:type</span> context))
              (path (org-element-property <span style="font-weight: bold;">:path</span> context))
              (desc (<span style="font-weight: bold;">when-let</span> ((begin (org-element-property <span style="font-weight: bold;">:contents-begin</span> context))
                               (end (org-element-property <span style="font-weight: bold;">:contents-end</span> context)))
                      (buffer-substring begin end))))
    (<span style="font-weight: bold;">cond</span>
     ((string-match-p <span style="font-style: italic;">"https?"</span> type)
      (funcall function (list (org-link-unescape (concat type <span style="font-style: italic;">":"</span> path)) desc)))
     ((string-match-p <span style="font-style: italic;">"elfeed"</span> type)
      (<span style="font-weight: bold;">save-excursion</span>
        (org-open-at-point)
        (<span style="font-weight: bold;">when</span> (eq major-mode 'elfeed-show-mode)
          (<span style="font-weight: bold;">when-let</span> ((url (<span style="font-weight: bold;">or</span> (caar (elfeed-entry-enclosures elfeed-show-entry))
                              (elfeed-entry-link elfeed-show-entry)))
                     (title (elfeed-entry-title elfeed-show-entry)))
            (funcall function (list url title)))
          (quit-window)))))))
</pre>
</div>
</div>
</li>

<li><a id="org2f5f64c"></a>keymap for global org commands<br />
<div class="outline-text-5" id="text-org2f5f64c">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(keymap-global-set <span style="font-style: italic;">"H-o"</span>
                   (define-keymap
                     <span style="font-weight: bold;">:prefix</span> 'my/org-global-map
                     <span style="font-style: italic;">"o"</span> #'org-open-at-point
                     <span style="font-style: italic;">"C-s"</span> #'org-save-all-org-buffers
                     <span style="font-style: italic;">"J"</span> #'org-babel-tangle-jump-to-org
                     <span style="font-style: italic;">"i"</span> #'org-info-find-node
                     <span style="font-style: italic;">"m"</span> #'org-mark-ring-goto
                     <span style="font-style: italic;">"@"</span> #'org-previous-link))

(<span style="font-weight: bold;">provide</span> '<span style="font-weight: bold; text-decoration: underline;">my-org-global-map</span>)
</pre>
</div>
</div>
</li>

<li><a id="orgbdac8ad"></a>remove empty clock log unless manually clocked out&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span><br /></li>

<li><a id="org2335f4d"></a>embark keymaps for consult-org-heading and consult-location<br />
<div class="outline-text-5" id="text-org2335f4d">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/embark-org-clock-in-with-opening-thing</span> (target)
  <span style="font-style: italic;">"Clock in and open thing for TARGET at once.</span>

<span style="font-style: italic;">If TARGET is an agenda item and `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">other-window-for-scrolling</span><span style="font-style: italic;">' is</span>
<span style="font-style: italic;">displaying an org mode buffer, then that is the source window.</span>
<span style="font-style: italic;">If TARGET is a minibuffer completion candidate, then the source</span>
<span style="font-style: italic;">window is the window selected before the command that opened the</span>
<span style="font-style: italic;">minibuffer ran."</span>
  (embark-org--in-source-window
   target
   (<span style="font-weight: bold;">lambda</span> (marker)
     (<span style="font-weight: bold;">org-with-point-at</span> marker
       (org-clock-in)
       (org-open-at-point)))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/embark-org-clock-supersede</span> (target)
  <span style="font-style: italic;">"Cancel the current clocking then clock in TARGET so as to fill out the gap time."</span>
  (embark-org--in-source-window
   target
   (<span style="font-weight: bold;">lambda</span> (marker)
     (<span style="font-weight: bold;">org-with-point-at</span> marker
       (my/org-clock-supersede)))))

(<span style="font-weight: bold;">with-eval-after-load</span> 'embark
  (cl-mapc (<span style="font-weight: bold;">lambda</span> (key-def)
             (keymap-set embark-org-heading-map
                         (car key-def) (cdr key-def)))
           '((<span style="font-style: italic;">"M-I"</span> . my/embark-org-clock-in-with-opening-thing)
             (<span style="font-style: italic;">"V"</span> . my/embark-org-clock-supersede))))
</pre>
</div>
</div>
</li>

<li><a id="orgd597191"></a>org move repeat map<br />
<div class="outline-text-5" id="text-orgd597191">
<p>
<a href="my/org-move-repeat-map">my/org-move-repeat-map</a> allows to move around org elements and blocks with ease.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defvar-keymap</span> my/org-move-repeat-map
  <span style="font-weight: bold;">:doc</span> <span style="font-style: italic;">"Keymap to repeat moving commands in `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">org-mode</span><span style="font-style: italic;">'.  Used in `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">repeat-mode</span><span style="font-style: italic;">'."</span>
  <span style="font-weight: bold;">:repeat</span> t
  <span style="font-style: italic;">"n"</span> #'org-next-item
  <span style="font-style: italic;">"p"</span> #'org-previous-item
  <span style="font-style: italic;">"u"</span> #'org-up-element
  <span style="font-style: italic;">"d"</span> #'org-down-element
  <span style="font-style: italic;">"f"</span> #'org-forward-element
  <span style="font-style: italic;">"b"</span> #'org-backward-element
  <span style="font-style: italic;">"&gt;"</span> #'org-next-link
  <span style="font-style: italic;">"&lt;"</span> #'org-previous-link
  <span style="font-style: italic;">"M-f"</span> #'org-next-block
  <span style="font-style: italic;">"M-b"</span> #'org-previous-block
  <span style="font-style: italic;">"M-F"</span> #'org-babel-next-src-block
  <span style="font-style: italic;">"M-B"</span> #'org-babel-previous-src-block)
</pre>
</div>
</div>
</li>

<li><a id="org184409b"></a>show org entries pointing to the current (backlink)<br />
<div class="outline-text-5" id="text-org184409b">
<p>
These commands show back links even in <a href="#orgcc3fd75">denote</a> files.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/org-backlink-entry</span> ()
  <span style="font-style: italic;">"Show all entries that point to the entry at point."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">let</span> ((id (org-entry-get (point) <span style="font-style: italic;">"ID"</span>))
        (heading (org-get-heading t t t t)))
    (org-ql-search
      (directory-files-recursively org-directory <span style="font-style: italic;">"\\.org$"</span> t
                                   (<span style="font-weight: bold;">lambda</span> (subdir)
                                     (member (file-relative-name subdir org-directory)
                                             '(<span style="font-style: italic;">"agenda"</span> <span style="font-style: italic;">"notes"</span>))))
      `(link ,(<span style="font-weight: bold;">or</span> id heading))
      <span style="font-weight: bold;">:super-groups</span> '((<span style="font-weight: bold;">:auto-parent</span>)))))
(keymap-global-set <span style="font-style: italic;">"C-c b b"</span> #'my/org-backlink-entry)

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/org-backlink-by-tag</span> ()
  <span style="font-style: italic;">"Show all entries that share tag with the entry at point."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">let*</span> ((org-use-tag-inheritance
          (<span style="font-weight: bold;">if</span> (denote-file-is-note-p (buffer-file-name))
              t nil))
         (tags (org-get-tags)))
    (org-ql-search
      (directory-files-recursively org-directory <span style="font-style: italic;">"\\.org$"</span> t
                                   (<span style="font-weight: bold;">lambda</span> (subdir)
                                     (member (file-relative-name subdir org-directory)
                                             '(<span style="font-style: italic;">"agenda"</span> <span style="font-style: italic;">"notes"</span>))))
      `(tags ,@tags)
      <span style="font-weight: bold;">:super-groups</span> '((<span style="font-weight: bold;">:auto-tags</span>)))))
(keymap-global-set <span style="font-style: italic;">"C-c b t"</span> #'my/org-backlink-by-tag)
</pre>
</div>
</div>
</li>

<li><a id="org6c9624a"></a>set timer at clocking in<br />
<div class="outline-text-5" id="text-org6c9624a">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">with-eval-after-load</span> 'org-clock
  (add-hook 'org-clock-in-prepare-hook
            #'my/org-clock-in-set-timer))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/org-clock-in-set-timer</span> ()
  <span style="font-style: italic;">"Start count down timer for a clocked in entry.</span>

<span style="font-style: italic;">If the entry has ATTENTION_SPAN property, use it for `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">org-timer-default-timer</span><span style="font-style: italic;">'.</span>
<span style="font-style: italic;">Otherwise count down time is Effort property value.</span>
<span style="font-style: italic;">In neither case, count down time is 25 min which is suggested in the Pomodoro-technique."</span>
  (<span style="font-weight: bold;">let*</span> ((todo (org-get-todo-state))
         (attention-span (org-entry-get (point) <span style="font-style: italic;">"ATTENTION_SPAN"</span> 'selective))
         (effort (org-entry-get (point) <span style="font-style: italic;">"Effort"</span> 'selective))
         (countdown-time (<span style="font-weight: bold;">or</span> attention-span
                             (<span style="font-weight: bold;">and</span> todo <span style="font-style: italic;">"25"</span>)))
         (org-timer-default-timer countdown-time))
    (<span style="font-weight: bold;">and</span> countdown-time
         (org-timer-set-timer '(16)))))
</pre>
</div>
</div>
</li>

<li><a id="orgf62040e"></a>stop timer at clocking out<br />
<div class="outline-text-5" id="text-orgf62040e">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">with-eval-after-load</span> 'org-clock
  (<span style="font-weight: bold;">dolist</span> (hook '(org-clock-out-hook org-clock-cancel-hook))
    (add-hook hook
              (<span style="font-weight: bold;">lambda</span> ()
                (<span style="font-weight: bold;">and</span> (<span style="font-weight: bold;">bound-and-true-p</span>  org-timer-countdown-timer)
                     (org-timer-stop))))))
</pre>
</div>
</div>
</li>

<li><a id="org16f6402"></a>supersede clocking task<br />
<div class="outline-text-5" id="text-org16f6402">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/org-clock-supersede</span> ()
  <span style="font-style: italic;">"Supersede clocking task with the task at point."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">let</span> ((org-clock-continuously t))
    (<span style="font-weight: bold;">save-excursion</span>
      (<span style="font-weight: bold;">and</span> (<span style="font-weight: bold;">bound-and-true-p</span> org-clock-current-task)
           (org-clock-cancel)))
    (org-clock-in)))

(<span style="font-weight: bold;">with-eval-after-load</span> 'org-keys
  (<span style="font-weight: bold;">with-eval-after-load</span> 'my-org-global-map
    (<span style="font-weight: bold;">bind-keys</span> <span style="font-weight: bold;">:map</span> my/org-global-map
               (<span style="font-style: italic;">"V"</span> . my/org-clock-supersede))
    (<span style="font-weight: bold;">setf</span> (map-elt org-speed-commands <span style="font-style: italic;">"V"</span>) #'my/org-clock-supersede)))
</pre>
</div>
</div>
</li>

<li><a id="orgd373991"></a>notify the completion of the timer with an alarm<br />
<div class="outline-text-5" id="text-orgd373991">
<div class="org-src-container">
<pre class="src src-shell">pactl list sinks | grep <span style="font-style: italic;">'^[[:space:]]Volume:'</span> | head -n $(($<span style="font-weight: bold; font-style: italic;">SINK</span> + 1 )) | tail -n 1 | sed -e <span style="font-style: italic;">'s,.* \([0-9][0-9]*\)%.*,\1,'</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">with-eval-after-load</span> 'org-timer
  (add-hook 'org-timer-done-hook
            'my/org-task-timer-finish))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/org-task-timer-finish</span> ()
  <span style="font-style: italic;">"Notify task timer by appropriate means."</span>
  (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">and</span> (org-clocking-p)
             org-clock-marker)
    (<span style="font-weight: bold;">let</span> ((alert (org-entry-get org-clock-marker
                                <span style="font-style: italic;">"ALERT"</span>)))
      (<span style="font-weight: bold;">and</span> (stringp alert)
           (string= alert <span style="font-style: italic;">"alarm"</span>)
           (alert <span style="font-style: italic;">"Timer Done!"</span> <span style="font-weight: bold;">:style</span> 'alarm))
      (alert <span style="font-style: italic;">"Timer Done!"</span> <span style="font-weight: bold;">:style</span> 'fringe <span style="font-weight: bold;">:mode</span> 'org-mode <span style="font-weight: bold;">:buffer</span> (org-clocking-buffer) <span style="font-weight: bold;">:severity</span> 'trivial))))

(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">alarm-sound</span> <span style="font-style: italic;">"/usr/share/sounds/freedesktop/stereo/complete.oga"</span>)

(<span style="font-weight: bold;">with-eval-after-load</span> 'alert
  (alert-define-style 'alarm
                      <span style="font-weight: bold;">:title</span> <span style="font-style: italic;">"alarm"</span>
                      <span style="font-weight: bold;">:notifier</span>
                      (<span style="font-weight: bold;">lambda</span> (info)
                        (my/play-sound alarm-sound t))))
</pre>
</div>
</div>
</li>

<li><a id="orgf657f23"></a>org-scrap (jotting down in org)<br />
<div class="outline-text-5" id="text-orgf657f23">
<p>
Memo file (memo.org) is useful for jotting down fragmented pieces of text, code and more.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">with-eval-after-load</span> 'org
  (<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my/org-capture-scrap-file</span>
    (file-name-concat org-directory <span style="font-style: italic;">"sandbox/scrap.org"</span>)
    <span style="font-style: italic;">"File for jotting down with `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">org-capture</span><span style="font-style: italic;">'."</span>)
  (<span style="font-weight: bold;">with-eval-after-load</span> 'org-capture
    (add-to-list 'org-capture-templates
                 `(<span style="font-style: italic;">"j"</span> <span style="font-style: italic;">"Jot down"</span>
                   entry (file ,my/org-capture-scrap-file)
                   <span style="font-style: italic;">"* %U\n#+begin_src %^{Lnaguage|text}\n%(my/org-capture-filter-scrap \"%i\")\n#+end_src"</span>
                   <span style="font-weight: bold;">:jump-to-captured</span> t
                   <span style="font-weight: bold;">:immediate-finish</span> t)
                 t)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/org-capture-filter-scrap</span> (<span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> str)
  <span style="font-style: italic;">"Replace semantic representation in `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">org-mode</span><span style="font-style: italic;">' with plain string in STR."</span>
  (<span style="font-weight: bold;">cond</span>
   ((stringp str)
    (replace-regexp-in-string <span style="font-style: italic;">"^</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">*+ </span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">"</span> <span style="font-style: italic;">",\\1"</span> str))
   (t <span style="font-style: italic;">""</span>)))
</pre>
</div>
</div>
</li>

<li><a id="org4805db0"></a>reset org element contextually<br />
<div class="outline-text-5" id="text-org4805db0">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">with-eval-after-load</span> 'org
  (<span style="font-weight: bold;">bind-keys</span> <span style="font-weight: bold;">:map</span> org-mode-map
             (<span style="font-style: italic;">"C-c SPC"</span> . my/org-reset-dwim)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/org-reset-dwim</span> ()
  <span style="font-style: italic;">"Exert reset procedure depending on org element at point."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">cond</span>
   ((org-at-table-p) (org-table-blank-field))
   ((org-in-subtree-not-table-p)
    (<span style="font-weight: bold;">org-save-outline-visibility</span> t
      (org-reset-checkbox-state-subtree)))))
</pre>
</div>
</div>
</li>

<li><a id="orgf9a9d22"></a>copy arbitrary org property to kill ring<br />
<div class="outline-text-5" id="text-orgf9a9d22">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">with-eval-after-load</span> 'org
  (<span style="font-weight: bold;">bind-keys</span> <span style="font-weight: bold;">:map</span> org-mode-map
             (<span style="font-style: italic;">"C-c W"</span> . my/org-entry-kill)))

(<span style="font-weight: bold;">with-eval-after-load</span> 'org-keys
  (add-to-list 'org-speed-commands
               '(<span style="font-style: italic;">"W"</span> . my/org-entry-kill)
               t))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/org-entry-kill</span> ()
  <span style="font-style: italic;">"Prompt user to select property to append to the kill ring.</span>

<span style="font-style: italic;">If property's value matches $(...) format, ... is interpreted as shell command and execute it."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">let*</span> ((properties (org-entry-properties))
         (prop-key-to-copy
          (completing-read <span style="font-style: italic;">"Property name: "</span>
                           (mapcar #'(<span style="font-weight: bold;">lambda</span> (var) (car var)) properties))))
    (<span style="font-weight: bold;">when</span> (stringp prop-key-to-copy)
      (<span style="font-weight: bold;">let*</span> ((prop-value (cdr (assoc prop-key-to-copy properties)))
             (str-to-copy
              (<span style="font-weight: bold;">cond</span>
               ((string-match <span style="font-style: italic;">"$(</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">.+</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">)"</span> prop-value)
                (shell-command-to-string (match-string 1 prop-value)))
               (t prop-value))))
        (kill-new str-to-copy)))))
</pre>
</div>
</div>
</li>

<li><a id="orgd859283"></a>lob ingest all named source blocks<br />
<div class="outline-text-5" id="text-orgd859283">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">with-eval-after-load</span> 'org
  (<span style="font-weight: bold;">bind-keys</span> <span style="font-weight: bold;">:map</span> my/org-global-map
             (<span style="font-style: italic;">"b i"</span> . my/org-babel-lob-ingest-all))

  (<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my/org-babel-lob-ingest-files</span>
    (seq-reduce (<span style="font-weight: bold;">lambda</span> (org-files dir)
                  (append org-files
                          (directory-files (expand-file-name dir org-directory) <span style="font-style: italic;">"</span><span style="font-weight: bold; font-style: italic;">\</span><span style="font-style: italic;">.org$"</span>)))
                '(<span style="font-style: italic;">"agenda"</span> <span style="font-style: italic;">"notes"</span>)
                nil)
    <span style="font-style: italic;">"A list of org files which is used in `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">my/org-babel-lob-ingest-all</span><span style="font-style: italic;">'."</span>)

  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/org-babel-lob-ingest-all</span> ()
    <span style="font-style: italic;">"Add all named soruce blocks in cpecified files."</span>
    (<span style="font-weight: bold;">interactive</span>)
    (<span style="font-weight: bold;">dolist</span> (org-file my/org-babel-lob-ingest-files)
      (org-babel-lob-ingest org-file))))
</pre>
</div>
</div>
</li>

<li><a id="orgf38e484"></a>Altering the Org Heading Text<br />
<div class="outline-text-5" id="text-orgf38e484">
<p>
<a href="https://www.p-snow.org/posts/20231121_1858/">I wrote a blog post</a> for this topic.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">with-eval-after-load</span> 'org
  (<span style="font-weight: bold;">bind-keys</span> <span style="font-weight: bold;">:map</span> org-mode-map
             (<span style="font-style: italic;">"C-c C-%"</span> . my/org-alter-heading)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/org-alter-heading</span> ()
  <span style="font-style: italic;">"CHange the heading text of the entry at point.</span>

<span style="font-style: italic;">The previous heading is logged as a log note."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">let*</span> ((old-heading (org-get-heading t t t t))
         (new-heading (read-string <span style="font-style: italic;">"Heading: "</span> old-heading))
         (org-log-note-headings (append '((heading . <span style="font-style: italic;">"Heading %-12s from %-12S %t"</span>))
                                        org-log-note-headings)))
    (<span style="font-weight: bold;">save-excursion</span>
      (org-back-to-heading t)
      (replace-string old-heading new-heading nil
                      (line-beginning-position) (line-end-position))
      (org-align-tags))
    (org-add-log-setup 'heading new-heading old-heading 'state)
    (run-hooks 'post-command-hook)))
</pre>
</div>
</div>
</li>

<li><a id="org6404125"></a>download media files in org&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span><br /></li>

<li><a id="org2f825fd"></a>Managing Someday Tasks<br />
<div class="outline-text-5" id="text-org2f825fd">
<ul class="org-ul">
<li><p>
task lifecycle
</p>
<div class="org-src-container">
<pre class="src src-dot">digraph{
"web browsing" [shape = hexagon];
"web browsing" -&gt; task [label = "read later"];
elfeed [shape = hexagon];
elfeed -&gt; task [label = "watch later"];
"web browsing" -&gt; someday [label = "read someday"];
task -&gt; someday [label = "expired"];
someday -&gt; task [label = "drill (active)"];
task -&gt; pending [label = "abandoned"];
subgraph cluster_0 {
someday -&gt; someday [label = "drill (inactive)"];
pending;
label = "somedays.org";
}
}
</pre>
</div></li>
</ul>
</div>

<ul class="org-ul">
<li><a id="orgc07ff84"></a>Reviewing Someday Tasks<br />
<div class="outline-text-6" id="text-orgc07ff84">
<p>
Someday tasks are encouraged to review and they prohibited to appear in agenda views.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/org-someday-task-review</span> (resume-p)
  <span style="font-style: italic;">"Start or resume (if RESUME-P is non-nil) a session for reviewing tasks."</span>
  (<span style="font-weight: bold;">interactive</span> <span style="font-style: italic;">"P"</span>)
  (<span style="font-weight: bold;">progn</span>
    (org-id-goto <span style="font-style: italic;">"58da20ee-97a9-4463-96b8-6ebb1084b9b7"</span>)
    (<span style="font-weight: bold;">let</span> ((org-drill-scope 'tree)
          (org-drill-question-tag my/org-review-tag)
          (org-drill-maximum-items-per-session 40)
          (org-drill-hide-item-headings-p nil)
          <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">drill session regulations</span>
          (org-drill-maximum-duration 12)
          (org-drill-maximum-items-per-session 30)
          (org-drill-item-count-includes-failed-items-p t)
          <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Spaced repetition algorithm</span>
          (org-drill-spaced-repetition-algorithm 'sm5)
          (org-drill-sm5-initial-interval 14.0)
          <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Random variation of repetition intervals</span>
          (org-drill-add-random-noise-to-intervals-p t)
          <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Adjusting item difficulty globally</span>
          (org-drill-learn-fraction 0.37)
          (org-startup-indented nil))
      (<span style="font-weight: bold;">and</span> (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">cl</span> nil t)
           (org-drill nil (format <span style="font-style: italic;">"TODO=\"%s\""</span> my/org-todo-keyword--someday)
                      resume-p)))))
</pre>
</div>
</div>
</li>

<li><a id="org1ee9ad1"></a>Skipping the display of "someday" tasks in the agenda view.<br />
<div class="outline-text-6" id="text-org1ee9ad1">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my/org-review-tag</span> <span style="font-style: italic;">"review"</span>
  <span style="font-style: italic;">"Tag name set for tasks which is encourged to review."</span>)

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/org-agenda-skip-someday-task</span> ()
  <span style="font-style: italic;">"Skip entries which hold schedule time and review tag in agenda view."</span>
  (<span style="font-weight: bold;">let</span> ((tags (org-get-tags)))
    (<span style="font-weight: bold;">if</span> (<span style="font-weight: bold;">and</span> (member my/org-review-tag (org-get-tags))
             (org-get-scheduled-time (point)))
        (<span style="font-weight: bold;">progn</span> (outline-next-heading) (point))
      nil)))

<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(with-eval-after-load 'org-agenda</span>
<span style="font-weight: bold; font-style: italic;">;;   </span><span style="font-weight: bold; font-style: italic;">(setopt org-agenda-skip-function-global</span>
<span style="font-weight: bold; font-style: italic;">;;           </span><span style="font-weight: bold; font-style: italic;">'my/org-agenda-skip-someday-task))</span>
</pre>
</div>
</div>
</li>

<li><a id="org0f2d962"></a>Showing SOMEDAY/GIVEUP Tasks<br />
<div class="outline-text-6" id="text-org0f2d962">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">with-eval-after-load</span> 'org-ql-view
  (<span style="font-weight: bold;">push</span> `(<span style="font-style: italic;">"Someday tasks"</span>
          <span style="font-weight: bold;">:buffers-files</span> ,(list (file-name-concat org-directory
                                                  <span style="font-style: italic;">"agenda/somedays.org"</span>))
          <span style="font-weight: bold;">:query</span> (todo ,my/org-todo-keyword--someday)
          <span style="font-weight: bold;">:super-groups</span> ((<span style="font-weight: bold;">:auto-property</span> <span style="font-style: italic;">"ARCHIVE_OLPATH"</span>))
          <span style="font-weight: bold;">:sort</span> (priority date))
        org-ql-views)
  (<span style="font-weight: bold;">push</span> `(<span style="font-style: italic;">"Review: someday tasks"</span>
          <span style="font-weight: bold;">:buffers-files</span> ,(list (file-name-concat org-directory
                                                  <span style="font-style: italic;">"agenda/somedays.org"</span>))
          <span style="font-weight: bold;">:query</span> (todo ,my/org-todo-keyword--someday)
          <span style="font-weight: bold;">:sort</span> (scheduled))
        org-ql-views)
  (<span style="font-weight: bold;">push</span> `(<span style="font-style: italic;">"Given-up tasks"</span>
          <span style="font-weight: bold;">:buffers-files</span> ,(org-agenda-files)
          <span style="font-weight: bold;">:query</span> (todo ,my/org-done-keyword--pending)
          <span style="font-weight: bold;">:super-groups</span> ((<span style="font-weight: bold;">:auto-property</span> <span style="font-style: italic;">"ARCHIVE_OLPATH"</span>))
          <span style="font-weight: bold;">:sort</span> (scheduled priority date))
        org-ql-views))
</pre>
</div>
</div>
</li>

<li><a id="org8fab140"></a>Immediate RE-Refiling SOMEDAY Tasks<br />
<div class="outline-text-6" id="text-org8fab140">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">with-eval-after-load</span> 'org-refile
  (add-hook 'org-after-refile-insert-hook
            #'my/org-archive-suspended-task))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/org-archive-suspended-task</span> ()
  <span style="font-style: italic;">"Archive this entry to the file for suspended tasks if the TODO state fits the bill."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">when</span> (member (org-entry-get nil <span style="font-style: italic;">"TODO"</span>)
                `(,my/org-todo-keyword--someday ,my/org-done-keyword--pending))
    (org-archive-subtree)))
</pre>
</div>
</div>
</li>
</ul>
</li>

<li><a id="org6c458ed"></a>send org subtree via email<br />
<div class="outline-text-5" id="text-org6c458ed">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">with-eval-after-load</span> 'org-keys
  (<span style="font-weight: bold;">bind-keys</span> <span style="font-weight: bold;">:map</span> org-mode-map
             (<span style="font-style: italic;">"C-c M"</span> . my/org-subtree-send-email))
  (add-to-list 'org-speed-commands
               '(<span style="font-style: italic;">"M"</span> . my/org-subtree-send-email)
               t))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/org-subtree-send-email</span> ()
  <span style="font-style: italic;">"Send an email containing the contents of the subtree at the entry at point."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">org-save-outline-visibility</span> t
    (<span style="font-weight: bold;">save-excursion</span>
      (org-fold-show-all)
      (<span style="font-weight: bold;">let*</span> ((heading (org-get-heading t t t t))
             (org-export-with-toc nil)
             (org-export-with-author nil)
             (org-export-show-temporary-export-buffer nil)
             (message-kill-buffer-on-exit t)
             (exp-buf (org-ascii-export-as-ascii nil t t t)))
        (message-mail (cdr (assoc <span style="font-style: italic;">"username"</span> (auth-source-pass-parse-entry <span style="font-style: italic;">"www.zoho.com"</span>)))
                      heading)
        (message-goto-body)
        (insert (<span style="font-weight: bold;">with-current-buffer</span> exp-buf (buffer-string)))
        (message-send-and-exit)))))
</pre>
</div>
</div>
</li>
<li><a id="orgab06879"></a>clean up after the task has chenged to DONE<br />
<div class="outline-text-5" id="text-orgab06879">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">with-eval-after-load</span> 'org
  (add-hook 'org-after-todo-state-change-hook
            #'my/org-todo-cleanup-when-done))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/org-todo-cleanup-when-done</span> ()
  <span style="font-style: italic;">"Exert several procedure when the state of the task has chnaged to DONE.</span>

<span style="font-style: italic;">Including:</span>
<span style="font-style: italic;">- Remove priority</span>
<span style="font-style: italic;">- Reset DONE state if the task is non-repeated habit</span>
<span style="font-style: italic;">- Close the project of the task"</span>
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">when the entry has any org-done-keywords</span>
  (<span style="font-weight: bold;">when</span> (member org-state
                `(,my/org-done-keyword--done ,my/org-done-keyword--cancel ,my/org-done-keyword--pending))
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">remove priority if exists</span>
    (<span style="font-weight: bold;">and</span> <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">the entry has been set any priority</span>
     (/= 21000 (<span style="font-weight: bold;">save-excursion</span>
                 (<span style="font-weight: bold;">save-match-data</span>
                   (beginning-of-line)
                   (<span style="font-weight: bold;">and</span> (looking-at org-heading-regexp)
                        (org-get-priority (match-string 0))))))
     (org-priority 'remove))
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">reset done state if the task is non-repeated habit</span>
    (<span style="font-weight: bold;">and</span> (org-is-habit-p)
         (not (org-get-scheduled-time (point)))
         (org-todo <span style="font-style: italic;">""</span>))
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">close the project</span>
    (<span style="font-weight: bold;">save-excursion</span>
      (org-back-to-heading t)
      (org-speed-move-safe 'outline-up-heading)
      (<span style="font-weight: bold;">and</span> (member my/org-project-tag (org-get-tags))
           (org-todo my/org-done-keyword--done)))))
</pre>
</div>
</div>
</li>

<li><a id="orgc12f1dd"></a>flush old clock logs and state changes<br />
<div class="outline-text-5" id="text-orgc12f1dd">
<p>
The hook functions, which is commented out, provoke malfunction failing to create todo state change logs which is necessary for habit graph.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp" id="orgc7c6ade">(<span style="font-weight: bold;">with-eval-after-load</span> 'midnight
  (add-hook 'midnight-hook
            (<span style="font-weight: bold;">lambda</span> ()
              (org-map-entries (<span style="font-weight: bold;">lambda</span> () (<span style="font-weight: bold;">when</span> (org-is-habit-p)
                                        (revert-buffer t t t)
                                        (my/org-flush-blobs)
                                        (basic-save-buffer)))
                               nil
                               'agenda))))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp" id="org8b52824">(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my/org-flush-blobs-old-timestamp-in-day</span> 90
  <span style="font-style: italic;">"Flush blobs with timestamps that are earlier than this number of days."</span>)

(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my/org-flush-blobs-clock-log</span> t
  <span style="font-style: italic;">"Whether `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">my/org-flush-blobs</span><span style="font-style: italic;">' flushes old clock logs."</span>)

(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my/org-flush-blobs-state-change</span> t
  <span style="font-style: italic;">"Whether `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">my/org-flush-blobs</span><span style="font-style: italic;">' flushes old todo state changes."</span>)

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/org-flush-blobs</span> ()
  <span style="font-style: italic;">"Flush old blob."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">org-save-outline-visibility</span> t
    (org-show-all)
    (<span style="font-weight: bold;">save-excursion</span>
      (<span style="font-weight: bold;">let</span> ((case-fold-search t)
            (next-heading (<span style="font-weight: bold;">save-excursion</span>
                            (org-next-visible-heading 1)
                            (point-marker))))
        (mapc (<span style="font-weight: bold;">lambda</span> (re)
                (org-back-to-heading t)
                (<span style="font-weight: bold;">while-let</span> ((ts-time (<span style="font-weight: bold;">and</span> (re-search-forward re (marker-position next-heading) t)
                                          (encode-time (parse-time-string (match-string 1))))))
                  (<span style="font-weight: bold;">when</span> (time-less-p ts-time
                                     (time-subtract (current-time) (days-to-time my/org-flush-blobs-old-timestamp-in-day)))
                    (kill-whole-line))))
              (append (<span style="font-weight: bold;">and</span> my/org-flush-blobs-clock-log
                           (list org-tr-regexp-both))
                      (<span style="font-weight: bold;">and</span> my/org-flush-blobs-state-change
                           (list (concat (<span style="font-weight: bold;">rx</span> <span style="font-style: italic;">"- State "</span> <span style="font-style: italic;">"\""</span> (&gt;= 1 upper) <span style="font-style: italic;">"\""</span> (+ space)
                                             <span style="font-style: italic;">"from "</span> (opt <span style="font-style: italic;">"\""</span> (&gt;= 1 upper) <span style="font-style: italic;">"\""</span>) (+ space))
                                         org-ts-regexp-inactive)))))
        (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">featurep</span> '<span style="font-weight: bold; text-decoration: underline;">org-clock</span>)
          (org-clock-remove-empty-clock-drawer))))))
</pre>
</div>
</div>
</li>

<li><a id="orgf61d145"></a>pad non-clocking time with break task<br />
<div class="outline-text-5" id="text-orgf61d145">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">with-eval-after-load</span> 'org-clock
  (add-hook 'org-clock-out-hook #'my/org-clock-in-break-time))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/org-clock-in-break-time</span> ()
  <span style="font-style: italic;">"Clock in the '</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">Break</span><span style="font-style: italic;">' task automatically as to pat non-clocking time."</span>
  (<span style="font-weight: bold;">let</span> ((break-task-id <span style="font-style: italic;">"d49d97de-58ec-4e41-b58c-491a9e216e1c"</span>))
    (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">and</span> (not org-clock-clocking-in)
               (not (string= (<span style="font-weight: bold;">or</span> (<span style="font-weight: bold;">save-excursion</span>
                                   (org-clock-goto)
                                   (org-id-get))
                                 <span style="font-style: italic;">""</span>)
                             break-task-id)))
      (<span style="font-weight: bold;">org-with-point-at</span> (org-id-find break-task-id t)
        (org-clock-in)))))
</pre>
</div>
</div>
</li>

<li><a id="org07bdb83"></a>show week number from the timestamp at point<br />
<div class="outline-text-5" id="text-org07bdb83">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/org-iso-week-at-point</span> ()
  <span style="font-style: italic;">"Display ISO 8601 week number correspoinds to time stamp at point."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">when-let</span> ((ts-bound (org-in-regexp (org-re-timestamp 'all)))
             (ts (buffer-substring (car ts-bound) (cdr ts-bound))))
    (message <span style="font-style: italic;">"W%s"</span> (format-time-string <span style="font-style: italic;">"%V"</span> (org-read-date nil t ts nil)))))
</pre>
</div>
</div>
</li>

<li><a id="emacs-org-tweak-outline-path"></a>Showing an Outline Path for the Entry<br />
<div class="outline-text-5" id="text-emacs-org-tweak-outline-path">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/org-show-outline-path</span> (pom)
  <span style="font-style: italic;">"Display a sparse tree that shows an outline path for the entry at POM."</span>
  (<span style="font-weight: bold;">interactive</span> (list (point)))
  (<span style="font-weight: bold;">save-excursion</span>
    (<span style="font-weight: bold;">cl-labels</span> ((lookup-parent ()
                  (<span style="font-weight: bold;">let*</span> ((heading-raw (substring-no-properties
                                       (org-get-heading t t t t)))
                         (heading (<span style="font-weight: bold;">if</span> (string-match org-link-bracket-re heading-raw)
                                      (match-string 2 heading-raw)
                                    heading-raw))
                         (h-li (list heading)))
                    (<span style="font-weight: bold;">if</span> (org-up-heading-safe)
                        (append (lookup-parent) h-li)
                      h-li))))
      (org-ql-sparse-tree (format <span style="font-style: italic;">"(olps %s)"</span>
                                  (mapconcat (<span style="font-weight: bold;">lambda</span> (str) (format <span style="font-style: italic;">"\"%s\""</span> str))
                                             (lookup-parent)
                                             <span style="font-style: italic;">" "</span>))))))

(<span style="font-weight: bold;">with-eval-after-load</span> 'org-ql
  (keymap-set org-mode-map <span style="font-style: italic;">"C-c M-/"</span>
              #'my/org-show-outline-path))
</pre>
</div>
</div>
</li>

<li><a id="orgc00a775"></a>use ISO week tree instead of Y/M/D tree<br />
<div class="outline-text-5" id="text-orgc00a775">
<p>
Following code is also responsible for deterministic archive location.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">with-eval-after-load</span> 'org-archive
  (advice-add #'org-archive-subtree <span style="font-weight: bold;">:around</span>
              #'my/org-archive-subtree--iso-datetree))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/org-archive-subtree--iso-datetree</span> (oldfun <span style="font-weight: bold; text-decoration: underline;">&amp;rest</span> r)
  <span style="font-style: italic;">"Move the current subtree to the archive.</span>

<span style="font-style: italic;">If archiving location is datetree, it supposed to be iso week tree."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">when</span> (member (org-get-todo-state)
                `(,my/org-todo-keyword--urgent ,my/org-todo-keyword--todo ,my/org-todo-keyword--next ,my/org-todo-keyword--in-action))
    (org-todo my/org-done-keyword--cancel))
  (<span style="font-weight: bold;">when</span> (string= (org-get-todo-state)
                 my/org-todo-keyword--someday)
    (org-toggle-tag my/org-review-tag 'on))
  (<span style="font-weight: bold;">let*</span> ((todo-state (org-get-todo-state))
         (closed-time (org-entry-get nil <span style="font-style: italic;">"CLOSED"</span> t))
         (org-archive-location
          (<span style="font-weight: bold;">cond</span>
           ((member todo-state
                    `(nil ,my/org-done-keyword--done ,my/org-done-keyword--cancel))
            (format <span style="font-style: italic;">"%s::datetree/"</span>
                    (file-name-concat org-directory <span style="font-style: italic;">"archive"</span>
                                      (format <span style="font-style: italic;">"archive_%s.org"</span>
                                              (<span style="font-weight: bold;">if</span> closed-time
                                                  (nth 5
                                                       (parse-time-string
                                                        (substring closed-time 1 -1)))
                                                (format-time-string <span style="font-style: italic;">"%Y"</span>))))))
           ((string= todo-state my/org-todo-keyword--someday)
            (format <span style="font-style: italic;">"%s::* Someday Tasks"</span>
                    (expand-file-name <span style="font-style: italic;">"agenda/somedays.org"</span> org-directory)))
           ((string= todo-state my/org-done-keyword--pending)
            (format <span style="font-style: italic;">"%s::* Given-up Tasks"</span>
                    (expand-file-name <span style="font-style: italic;">"archive/agenda/given-ups.org"</span> org-directory))))))
    (<span style="font-weight: bold;">when</span> (stringp org-archive-location)
      (advice-add #'org-datetree-find-date-create <span style="font-weight: bold;">:override</span>
                  #'org-datetree-find-iso-week-create)
      (apply oldfun r)
      (advice-remove #'org-datetree-find-date-create
                     #'org-datetree-find-iso-week-create))))

(<span style="font-weight: bold;">with-eval-after-load</span> 'org-agenda
  (keymap-set org-agenda-mode-map <span style="font-style: italic;">"C"</span> #'my/org-archive-find--iso-datetree))

(<span style="font-weight: bold;">with-eval-after-load</span> 'calendar
  (keymap-set calendar-mode-map <span style="font-style: italic;">"C"</span> #'my/org-archive-find--iso-datetree))

<span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/org-archive-find--iso-datetree</span> (date)
  <span style="font-style: italic;">"Find and visit the location of DATE in archivee file.</span>

<span style="font-style: italic;">DATE must be a string representing the date to find and parsable with `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">format-time-string</span><span style="font-style: italic;">'.</span>

<span style="font-style: italic;">If called interactively, it prompt the user to select the date to find."</span>
  (<span style="font-weight: bold;">interactive</span>
   (<span style="font-weight: bold;">cond</span>
    ((eq major-mode 'calendar-mode)
     (list (calendar-date-string (calendar-cursor-to-date))))
    ((eq major-mode 'org-agenda-mode)
     (<span style="font-weight: bold;">let*</span> ((day (<span style="font-weight: bold;">or</span> (get-text-property (min (1- (point-max)) (point)) 'day)
                     (<span style="font-weight: bold;">user-error</span> <span style="font-style: italic;">"Don't know which date to open in calendar"</span>)))
            (date (calendar-gregorian-from-absolute day)))
       (list (calendar-date-string date))))
    (t (<span style="font-weight: bold;">let</span> ((date-select (org-read-date)))
         (list date-select)))))
  (<span style="font-weight: bold;">let*</span> ((d (parse-time-string date))
         (day (decoded-time-day d))
         (month (decoded-time-month d))
         (year (decoded-time-year d)))
    (find-file (file-name-concat org-directory <span style="font-style: italic;">"archive"</span> (format <span style="font-style: italic;">"archive_%d.org"</span> year)))
    (org-datetree-find-iso-week-create `(,month ,day ,year))))

(<span style="font-weight: bold;">with-eval-after-load</span> 'my-org-global-map
  (<span style="font-weight: bold;">bind-keys</span> <span style="font-weight: bold;">:map</span> my/org-global-map
             (<span style="font-style: italic;">"D"</span> . my/org-archive-find--iso-datetree)))
</pre>
</div>
</div>
</li>

<li><a id="orgd3be3ca"></a>search org entry under 'default-directory'<br />
<div class="outline-text-5" id="text-orgd3be3ca">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defmacro</span> <span style="font-weight: bold;">with-org-files-under</span> (<span style="font-weight: bold; text-decoration: underline;">&amp;rest</span> body)
  <span style="font-style: italic;">"Eval `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">BODY</span><span style="font-style: italic;">' with providing org file list from `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">default-directory</span><span style="font-style: italic;">'."</span>
  (<span style="font-weight: bold;">declare</span> (indent defun))
  `(<span style="font-weight: bold;">let</span> ((org-files (directory-files-recursively
                     default-directory
                     <span style="font-style: italic;">"</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(?:</span><span style="font-style: italic;">\\.org</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(?:</span><span style="font-style: italic;">\\.gpg</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">?$</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">"</span>)))
     ,@body))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/consult-org-heading-under</span> ()
  <span style="font-style: italic;">"Invoke `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">consult-org-heading</span><span style="font-style: italic;">' with all org files under `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">default-directory</span><span style="font-style: italic;">'."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (with-org-files-under
    (<span style="font-weight: bold;">let</span> ((org-agenda-files org-files))
      (consult-org-agenda))))

(<span style="font-weight: bold;">with-eval-after-load</span> 'embark
  (keymap-set embark-file-map <span style="font-style: italic;">"H"</span>
              (<span style="font-weight: bold;">lambda</span> (dir) (<span style="font-weight: bold;">interactive</span> <span style="font-style: italic;">"sDir: "</span>)
                (<span style="font-weight: bold;">let</span> ((default-directory dir))
                  (my/consult-org-heading-under)))))

(<span style="font-weight: bold;">with-eval-after-load</span> 'my-org-global-map
  (keymap-set my/org-global-map <span style="font-style: italic;">"H"</span>
              #'my/consult-org-heading-under))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/org-ql-search-under</span> ()
  <span style="font-style: italic;">"Invoke `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">org-ql-search</span><span style="font-style: italic;">' with all org files under `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">default-directory</span><span style="font-style: italic;">'."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (with-org-files-under
    (<span style="font-weight: bold;">let</span> ((org-agenda-files org-files)
          (query (read-string <span style="font-style: italic;">"Query: "</span>)))
      (org-ql-search (org-agenda-files) query))))

(<span style="font-weight: bold;">with-eval-after-load</span> 'embark
  (keymap-set embark-file-map <span style="font-style: italic;">"Q"</span>
              (<span style="font-weight: bold;">lambda</span> (dir) (<span style="font-weight: bold;">interactive</span> <span style="font-style: italic;">"sDir: "</span>)
                (<span style="font-weight: bold;">let</span> ((default-directory dir))
                  (my/org-ql-search-under)))))

(<span style="font-weight: bold;">with-eval-after-load</span> 'my-org-global-map
  (keymap-set my/org-global-map <span style="font-style: italic;">"q Q"</span>
              #'my/org-ql-search-under))
</pre>
</div>
</div>
</li>

<li><a id="org056af7e"></a>Opening Large Well-Accessed Org Files Stealthily<br />
<div class="outline-text-5" id="text-org056af7e">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">with-eval-after-load</span> 'org
  (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">denote</span> nil t)
    (run-with-idle-timer (* 5 60) nil
                         (<span style="font-weight: bold;">lambda</span> ()
                           <span style="font-style: italic;">"Open large org files."</span>
                           (mapc #'find-file-noselect
                                 (list (denote-get-path-by-id <span style="font-style: italic;">"20230605T170959"</span>)
                                       (file-name-concat org-directory (format-time-string <span style="font-style: italic;">"archive/archive_%Y.org"</span>))))))))
</pre>
</div>
</div>
</li>

<li><a id="orgf60e770"></a>Creating and showing project-task relationship<br />
<div class="outline-text-5" id="text-orgf60e770">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/project-insert-link</span> ()
  <span style="font-style: italic;">"Insert a org-link pointing to the project entry which locates upper position."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">when</span> (org-get-todo-state)
    (<span style="font-weight: bold;">save-excursion</span>
      (outline-up-heading 1)
      (call-interactively #'org-store-link))
    (<span style="font-weight: bold;">let</span> ((org-log-note-headings (append '((project . <span style="font-style: italic;">"project %s %t"</span>))
                                         org-log-note-headings))
          (link-str (<span style="font-weight: bold;">with-temp-buffer</span>
                      (call-interactively #'org-insert-last-stored-link)
                      (concat <span style="font-style: italic;">" "</span> <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">workaround for org-ql failing to recognize org-link with preceding "</span>
                              (buffer-substring-no-properties (point-min) (1- (point-max)))
                              <span style="font-style: italic;">" "</span>))))
      (org-add-log-setup 'project link-str
                         nil 'state (format-time-string (org-time-stamp-format t t)))
      (run-hooks 'post-command-hook))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/project-list-tasks</span> ()
  <span style="font-style: italic;">"Show a list of tasks belonging to the current project."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">org-ql</span> nil t)
    (<span style="font-weight: bold;">when-let</span> ((id (org-id-get)))
      (org-ql-search
        (append (file-expand-wildcards (file-name-concat org-directory <span style="font-style: italic;">"archive"</span> <span style="font-style: italic;">"archive_*.org"</span>))
                (org-agenda-files))
        `(link <span style="font-weight: bold;">:target</span> ,(format <span style="font-style: italic;">"id:%s"</span> id))))))

(<span style="font-weight: bold;">with-eval-after-load</span> 'org-refile
  (add-hook 'org-after-refile-insert-hook
            #'my/project-insert-link))
</pre>
</div>
</div>
</li>
</ul>
</div>

<div id="outline-container-orga5a40bf" class="outline-4">
<h4 id="orga5a40bf">would-be packages</h4>
<div class="outline-text-4" id="text-orga5a40bf">
</div>

<ul class="org-ul">
<li><a id="orga0e8945"></a>Package: lfile (custom org link type)<br />
<div class="outline-text-5" id="text-orga0e8945">
<p>
lfile is an extended org link type for files in local machine. It is inspired by <a href="https://karl-voit.at/2022/02/10/lfile/">Kerl Voit's implementation</a>.
It is implemented using abbrev mechanism since functionality of file: link type such as inline image or exporting can be easily imparted.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">ol</span>)
(<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">org-element</span>)

(<span style="font-weight: bold;">with-eval-after-load</span> 'ol
  (add-to-list 'org-link-abbrev-alist
               '(<span style="font-style: italic;">"lfile"</span> . <span style="font-style: italic;">"file:%(lfile-locate)"</span>)
               t)
  (add-to-list 'org-link-abbrev-alist
               '(<span style="font-style: italic;">"lfile+emacs"</span> . <span style="font-style: italic;">"file+emacs:%(lfile-locate)"</span>)
               t)
  (add-to-list 'org-link-abbrev-alist
               '(<span style="font-style: italic;">"lfile+sys"</span> . <span style="font-style: italic;">"file+sys:%(lfile-locate)"</span>)
               t))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">lfile-locate</span> (tag)
  <span style="font-style: italic;">"Return a path found using TAG with locate program."</span>
  (<span style="font-weight: bold;">let*</span> ((match-idx (string-match <span style="font-style: italic;">"^</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">[</span><span style="font-style: italic;">^</span><span style="font-style: italic;">:]*</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">::?</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">.*</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">?$"</span> tag))
         (link (<span style="font-weight: bold;">if</span> match-idx (match-string 1 tag) tag)))
    (concat (string-trim
             (shell-command-to-string
              (concat (format <span style="font-style: italic;">"plocate -d &lt;&lt;plocate-db()&gt;&gt; -e \"%s\" 2&gt;/dev/null"</span>
                              (shell-quote-argument link))
                      <span style="font-style: italic;">" | head --lines=1"</span>)))
            (<span style="font-weight: bold;">when</span> match-idx (match-string 2 tag)))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">lfile-store-link</span> ()
  <span style="font-style: italic;">"Store a lfile link.</span>

<span style="font-style: italic;">Prefix argument does matter in this function call.</span>
<span style="font-style: italic;">If `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">C-u</span><span style="font-style: italic;">' prefix is given, file: link type will be used instead."</span>
  (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">and</span> (derived-mode-p 'dired-mode)
             (string-match-p
              (format <span style="font-style: italic;">"^%s"</span> (expand-file-name <span style="font-style: italic;">"~"</span>))
              (dired-current-directory nil)))
    (<span style="font-weight: bold;">let</span> ((path (dired-get-filename nil t)))
      (<span style="font-weight: bold;">if</span> (equal current-prefix-arg '(4))
          (org-link-store-props
           <span style="font-weight: bold;">:type</span> <span style="font-style: italic;">"file"</span>
           <span style="font-weight: bold;">:link</span> (concat <span style="font-style: italic;">"file:"</span> (abbreviate-file-name
                                  (expand-file-name path))))
        (org-link-store-props
         <span style="font-weight: bold;">:type</span> <span style="font-style: italic;">"lfile"</span>
         <span style="font-weight: bold;">:link</span> (concat <span style="font-style: italic;">"lfile:"</span> (file-name-nondirectory path)))))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">lfile-abbrev</span> (raw-link <span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> path-conv-fn)
  <span style="font-style: italic;">"Return an abbreviated lfile link from RAW-LINK.</span>

<span style="font-style: italic;">RAW-LINK is supposed to be a file link type with a path and the path is</span>
<span style="font-style: italic;">converted by `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">file-name-nondirectory</span><span style="font-style: italic;">' unless PATH-CONV-FN is supplied."</span>
  (<span style="font-weight: bold;">let*</span> ((link (<span style="font-weight: bold;">with-temp-buffer</span>
                 (<span style="font-weight: bold;">let</span> ((org-inhibit-startup nil))
                   (insert raw-link)
                   (org-mode)
                   (goto-char (point-min))
                   (org-element-link-parser))))
         (type (org-element-property <span style="font-weight: bold;">:type</span> link))
         (path (org-element-property <span style="font-weight: bold;">:path</span> link))
         (abbrev-link (<span style="font-weight: bold;">cond</span>
                       ((string= type <span style="font-style: italic;">"file"</span>)
                        (format <span style="font-style: italic;">"%s:%s"</span>
                                <span style="font-style: italic;">"lfile"</span>
                                (<span style="font-weight: bold;">if</span> (functionp path-conv-fn)
                                    (funcall path-conv-fn path)
                                  (file-name-nondirectory path))))
                       ((stringp type)
                        raw-link)
                       (t nil))))
    abbrev-link))

(<span style="font-weight: bold;">with-eval-after-load</span> 'org
  (org-link-set-parameters <span style="font-style: italic;">"lfile"</span>
                           <span style="font-weight: bold;">:store</span> #'lfile-store-link))

(<span style="font-weight: bold;">provide</span> '<span style="font-weight: bold; text-decoration: underline;">lfile</span>)
</pre>
</div>
</div>

<ul class="org-ul">
<li><a id="orgfc229e5"></a>lfile (legacy)&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span><br /></li>
</ul>
</li>

<li><a id="orgf32b99a"></a>Package: open-file<br />
<div class="outline-text-5" id="text-orgf32b99a">
<p>
Open-file is a feature that allows you to specify the application to open a file based on its type.
</p>

<p>
By default, PDF and EPUB files are opened in EWW after converted into HTML. Videos and audio files are played in MPV media player.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp" id="orgd0006c2"><span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">general functions</span>

(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my/open-file-dir</span>
  <span style="font-style: italic;">"&lt;&lt;htmlize-dir()&gt;&gt;"</span>
  <span style="font-style: italic;">"Directory where html file is converted into."</span>)

(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my/open-file-media-player</span> <span style="font-style: italic;">"mpv"</span>
  <span style="font-style: italic;">"Media player used to play media file in open-file."</span>)

(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my/open-file-media-extensions</span>
  '(<span style="font-style: italic;">"mpg"</span> <span style="font-style: italic;">"mpeg"</span> <span style="font-style: italic;">"mp3"</span> <span style="font-style: italic;">"mp4"</span> <span style="font-style: italic;">"m4v"</span> <span style="font-style: italic;">"m4a"</span>
    <span style="font-style: italic;">"avi"</span> <span style="font-style: italic;">"wmv"</span> <span style="font-style: italic;">"wav"</span> <span style="font-style: italic;">"mov"</span> <span style="font-style: italic;">"flv"</span> <span style="font-style: italic;">"mkv"</span> <span style="font-style: italic;">"mka"</span> <span style="font-style: italic;">"webm"</span> <span style="font-style: italic;">"3gp"</span>
    <span style="font-style: italic;">"flac"</span> <span style="font-style: italic;">"ogv"</span> <span style="font-style: italic;">"oga"</span> <span style="font-style: italic;">"ogx"</span> <span style="font-style: italic;">"ogg"</span> <span style="font-style: italic;">"spx"</span> <span style="font-style: italic;">"opus"</span>
    <span style="font-style: italic;">"xbm"</span> <span style="font-style: italic;">"pbm"</span> <span style="font-style: italic;">"pgm"</span> <span style="font-style: italic;">"ppm"</span> <span style="font-style: italic;">"pnm"</span> <span style="font-style: italic;">"png"</span> <span style="font-style: italic;">"gif"</span> <span style="font-style: italic;">"bmp"</span> <span style="font-style: italic;">"tif"</span> <span style="font-style: italic;">"jpeg"</span> <span style="font-style: italic;">"jpg"</span> <span style="font-style: italic;">"webp"</span>)
  <span style="font-style: italic;">"Extensions files which can play with media player must have."</span>)

(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my/open-file-compressed-media-extensions</span>
  '(<span style="font-style: italic;">"tar.gz"</span> <span style="font-style: italic;">"tgz"</span> <span style="font-style: italic;">"tar.xz"</span> <span style="font-style: italic;">"txz"</span> <span style="font-style: italic;">"zip"</span> <span style="font-style: italic;">"7z"</span>)
  <span style="font-style: italic;">"Extensions compressed files which can play with media player must have."</span>)

<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">TODO: This could be achieved by command builder</span>
(<span style="font-weight: bold;">defmacro</span> <span style="font-weight: bold;">my/open-file-as-html</span> (file convert-cmd)
  `(<span style="font-weight: bold;">let*</span> ((cap-command (<span style="font-weight: bold;">if</span> (string-match-p url-handler-regexp ,file)
                           <span style="font-style: italic;">"curl"</span>
                         (<span style="font-weight: bold;">if</span> (string-suffix-p <span style="font-style: italic;">".gpg"</span> ,file)
                             <span style="font-style: italic;">"gpg -d"</span>
                           <span style="font-style: italic;">"cat"</span>)))
          (dir-name (file-name-base ,file))
          (dirname-html
           (expand-file-name
            dir-name
            my/open-file-dir))
          (filename-html
           (concat (file-name-as-directory dirname-html)
                   <span style="font-style: italic;">"index.html"</span>))
          (command ,convert-cmd))
     (<span style="font-weight: bold;">unless</span> (file-exists-p filename-html)
       (make-directory dirname-html t)
       (call-process-shell-command command))
     (browse-url filename-html)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/open-pdf-as-html</span> (pdf)
  <span style="font-style: italic;">"Open PDF in `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">eww</span><span style="font-style: italic;">' after the process of convertion into html."</span>
  (my/open-file-as-html
   (expand-file-name pdf)
   (format <span style="font-style: italic;">"%1$s %2$s 2&gt;/dev/null | pdftohtml -p -s -noframes -nomerge -nodrm - %3$s"</span>
           cap-command
           (shell-quote-argument (expand-file-name pdf))
           (shell-quote-argument filename-html))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/open-epub-as-html</span> (epub)
  <span style="font-style: italic;">"Open EPUB in `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">eww</span><span style="font-style: italic;">' after the process of convertion into html."</span>
  (<span style="font-weight: bold;">let</span> ((exp-epub (<span style="font-weight: bold;">if</span> (file-exists-p epub)
                      (expand-file-name epub)
                    epub)))
    (my/open-file-as-html
     exp-epub
     (format <span style="font-style: italic;">"%1$s %2$s 2&gt;/dev/null | pandoc --from=epub --to=html --extract-media=%3$s - | strip_ruby &gt; %4$s"</span>
             cap-command
             (shell-quote-argument exp-epub)
             (shell-quote-argument dirname-html)
             (shell-quote-argument filename-html)))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/open-media</span> (media <span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> query)
  <span style="font-style: italic;">"Open MEDIA file in media player with respecting QUERY.</span>

<span style="font-style: italic;">QUERY must comply to RFC 822 format, which holds attribute/value pairs."</span>
  (<span style="font-weight: bold;">let</span> ((ask-file (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">or</span> (file-directory-p media)
                            (string-match-p (eval `(<span style="font-weight: bold;">rx</span> (<span style="font-weight: bold;">or</span> ,@my/open-file-compressed-media-extensions)))
                                            media))
                    (file-name-nondirectory media))))
    (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">or</span> (not ask-file)
              (<span style="font-weight: bold;">and</span> ask-file
                   (y-or-n-p (format <span style="font-style: italic;">"Play %s?: "</span> ask-file))))
      (apply 'funcall-interactively
             'mpv-dispatch-dwim media nil
             (<span style="font-weight: bold;">and</span> (stringp query)
                  (<span style="font-weight: bold;">let</span> ((start) (end))
                    (mapc (<span style="font-weight: bold;">lambda</span> (cons-cell)
                            (<span style="font-weight: bold;">pcase</span> cons-cell
                              (`(,val <span style="font-style: italic;">""</span>) (<span style="font-weight: bold;">setq</span> start val))
                              (`(,(<span style="font-weight: bold;">or</span> <span style="font-style: italic;">"s"</span> <span style="font-style: italic;">"start"</span>) . (,val)) (<span style="font-weight: bold;">setq</span> start val))
                              (`(,(<span style="font-weight: bold;">or</span> <span style="font-style: italic;">"e"</span> <span style="font-style: italic;">"end"</span>) . (,val)) (<span style="font-weight: bold;">setq</span> end val))))
                          (url-parse-query-string query))
                    `(,start ,end))
                  )))))

<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">==============================================</span>
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">browse-url handling</span>

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">ghq-list</span> (query)
  <span style="font-style: italic;">"Return a list containing all ghq repositories matching QUERY."</span>
  (split-string (string-trim-right
                 (shell-command-to-string
                  (format <span style="font-style: italic;">"ghq list --full-path '</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">%s</span><span style="font-style: italic;">'"</span> query)))
                <span style="font-style: italic;">"\n"</span> t))

(<span style="font-weight: bold;">with-eval-after-load</span> 'browse-url
  (<span style="font-weight: bold;">setopt</span> browse-url-handlers
          `(((<span style="font-weight: bold;">lambda</span> (url) (equal current-prefix-arg '(16)))
             . browse-url-firefox)
            ((<span style="font-weight: bold;">lambda</span> (url) (equal current-prefix-arg '(4)))
             . browse-url-emacs)
            (ghq-list
             . (<span style="font-weight: bold;">lambda</span> (url <span style="font-weight: bold; text-decoration: underline;">&amp;rest</span> args)
                 (find-file (car (ghq-list url)))))
            (<span style="font-style: italic;">"\\.html\\'"</span>
             . (<span style="font-weight: bold;">lambda</span> (url <span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> same-window)
                 (<span style="font-weight: bold;">cond</span>
                  ((file-exists-p url) (eww-open-file url))
                  ((string-match-p url-handler-regexp url)
                   (browse-web url)))))
            (<span style="font-style: italic;">"\\.pdf</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">\\.gpg</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">?\\'"</span> . (<span style="font-weight: bold;">lambda</span> (url <span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> same-window)
                                          (my/open-pdf-as-html url)))
            (<span style="font-style: italic;">"\\.epub\\'"</span> . (<span style="font-weight: bold;">lambda</span> (url <span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> same-window)
                              (my/open-epub-as-html url)))
            (,(eval `(<span style="font-weight: bold;">rx</span> <span style="font-style: italic;">"."</span> (<span style="font-weight: bold;">or</span> ,@my/open-file-media-extensions
                                 ,@my/open-file-compressed-media-extensions)
                         (opt <span style="font-style: italic;">".gpg"</span>)))
             . my/open-media))))

<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">==============================================</span>
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">org-open handling</span>

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/org-open-html</span> (file-path link-string)
  <span style="font-style: italic;">"Open a html file at FILE-PATH via org-open command."</span>
  (browse-url file-path)
  (<span style="font-weight: bold;">when-let</span> ((search (my/org-link-search link-string)))
    (org-link-search search)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/org-open-pdf</span> (file-path link-string)
  <span style="font-style: italic;">"Open a pdf file at FILE-PATH via org-open command."</span>
  (my/open-pdf-as-html file-path)
  (<span style="font-weight: bold;">when-let</span> ((search (my/org-link-search link-string)))
    (org-link-search search)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/org-open-epub</span> (file-path link-string)
  <span style="font-style: italic;">"Open an epub file at FILE-PATH via org-open command."</span>
  (my/open-epub-as-html file-path)
  (<span style="font-weight: bold;">when-let</span> ((search (my/org-link-search link-string)))
    (org-link-search search)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/org-open-media</span> (file-path link-string)
  <span style="font-style: italic;">"Open a media file at FILE-PATH via org-open command."</span>
  (my/open-media file-path
                 (my/org-link-search link-string)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/org-link-search</span> (link-string)
  (<span style="font-weight: bold;">and</span> (stringp link-string)
       (string-match <span style="font-style: italic;">"::</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">.*</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">\\'"</span> link-string)
       (match-string 1 link-string)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/org-execute-file-search-line-number</span> (s)
  <span style="font-style: italic;">"A search function responsible for line number inside of S."</span>
  (<span style="font-weight: bold;">and</span> (string-match (<span style="font-weight: bold;">rx</span> bos
                         (opt <span style="font-style: italic;">"l="</span>)
                         (group-n 1
                           (opt (<span style="font-weight: bold;">or</span> ?- ?+))
                           (1+ digit))
                         eos)
                     s)
       (goto-line (string-to-number (match-string 1 s)))))

(add-hook 'org-execute-file-search-functions
          'my/org-execute-file-search-line-number)

(<span style="font-weight: bold;">with-eval-after-load</span> 'org
  (<span style="font-weight: bold;">setopt</span> org-file-apps
          `((<span style="font-style: italic;">"\\.html\\'"</span> . my/org-open-html)
            (<span style="font-style: italic;">"\\.pdf</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">\\.gpg</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">?\\'"</span> . my/org-open-pdf)
            (<span style="font-style: italic;">"\\.epub\\'"</span> . my/org-open-epub)
            (,(eval `(<span style="font-weight: bold;">rx</span> <span style="font-style: italic;">"."</span> (<span style="font-weight: bold;">or</span> ,@my/open-file-media-extensions
                                 ,@my/open-file-compressed-media-extensions)
                         (opt <span style="font-style: italic;">".gpg"</span>) string-end))
             . my/org-open-media)
            (auto-mode . emacs)
            (directory . my/org-open-media)
            (system . browse-url-default-browser))))

<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">==============================================</span>
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">dired-open handling</span>

(<span style="font-weight: bold;">with-eval-after-load</span> 'dired-open
  (<span style="font-weight: bold;">setq</span> dired-open-functions '(dired-open-call-function-by-extension
                               dired-open-by-extension
                               dired-open-subdir)
        dired-open-extensions-elisp `((<span style="font-style: italic;">"pdf"</span> . my/open-pdf-as-html)
                                      (<span style="font-style: italic;">"epub"</span> . my/open-epub-as-html)
                                      ,@(mapcar (<span style="font-weight: bold;">lambda</span> (ext)
                                                  (cons ext 'my/open-media))
                                                my/open-file-media-extensions))
        dired-open-find-file-function 'my/dired-find-file))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/dired-find-file</span> ()
  <span style="font-style: italic;">"A function for `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">dired-open-find-file-function</span><span style="font-style: italic;">' dealing with</span>
<span style="font-style: italic;">a `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">dired-open-file</span><span style="font-style: italic;">' call with `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">C-u</span><span style="font-style: italic;">' or `C-u C-u'."</span>
  (<span style="font-weight: bold;">let</span> ((file-for-visit (dired-get-file-for-visit)))
    (<span style="font-weight: bold;">cond</span>
     ((equal current-prefix-arg '(16))
      (browse-url-default-browser file-for-visit))
     ((equal current-prefix-arg '(4))
      (dired--find-possibly-alternative-file file-for-visit))
     ((string-match-p (eval `(<span style="font-weight: bold;">rx</span> (<span style="font-weight: bold;">or</span> ,@my/open-file-compressed-media-extensions)))
                      file-for-visit)
      (my/open-media file-for-visit))
     (t (dired-find-file)))))

(<span style="font-weight: bold;">provide</span> '<span style="font-weight: bold; text-decoration: underline;">open-file</span>)
</pre>
</div>

<ul class="org-ul">
<li><p>
get original file name from converted html file
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/open-file-original-file</span> (html)
  <span style="font-style: italic;">"Revert HTML file into original file name."</span>
  (<span style="font-weight: bold;">interactive</span> (list (<span style="font-weight: bold;">if</span> (use-region-p)
                         (buffer-substring (use-region-beginning)
                                           (use-region-end))
                       (read-string <span style="font-style: italic;">"HTML: "</span>))))
  (<span style="font-weight: bold;">when-let*</span> ((regex (<span style="font-weight: bold;">rx</span> (group-n 1 (opt (<span style="font-weight: bold;">or</span> <span style="font-style: italic;">"file://"</span> <span style="font-style: italic;">"file:~"</span>)))
                         (1+ (: <span style="font-style: italic;">"/"</span> (1+ nonl)))
                         (group-n 2 (1+ (: <span style="font-style: italic;">"!"</span> (1+ (: nonl)))))
                         <span style="font-style: italic;">"/index.html"</span>))
              (index (string-match regex html))
              (rep (concat (<span style="font-weight: bold;">and</span> (cl-some (<span style="font-weight: bold;">lambda</span> (cand)
                                           (string= cand (match-string 1 html)))
                                         '(<span style="font-style: italic;">"file://"</span> <span style="font-style: italic;">"file:~"</span>))
                                <span style="font-style: italic;">"lfile:"</span>)
                           (substring (match-string 2 html) 1))))
    (<span style="font-weight: bold;">if</span> (use-region-p)
        (replace-string-in-region html rep)
      (princ (replace-regexp-in-string regex rep html)))))
</pre>
</div></li>
</ul>
</div>
</li>

<li><a id="orgac94cbd"></a>Package: org-password-store<br />
<div class="outline-text-5" id="text-orgac94cbd">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">password-store</span>)

(<span style="font-weight: bold;">defcustom</span> <span style="font-weight: bold; font-style: italic;">my/org-password-store-property</span> <span style="font-style: italic;">"PASSWORD_STORE"</span>
  <span style="font-style: italic;">"Property used in my/password-store feature to get password-store entry name attached to current org entry."</span>)

(<span style="font-weight: bold;">defmacro</span> <span style="font-weight: bold;">with-password-store-entry</span> (entry <span style="font-weight: bold; text-decoration: underline;">&amp;rest</span> body)
  <span style="font-style: italic;">"Eval BODY that can refer password-store ENTRY."</span>
  (<span style="font-weight: bold;">declare</span> (indent defun))
  `(<span style="font-weight: bold;">let</span> ((entry (<span style="font-weight: bold;">or</span> ,entry
                    (<span style="font-weight: bold;">when</span> (derived-mode-p 'org-mode) (org-entry-get (point) my/org-password-store-property))
                    (password-store--completing-read t))))
     ,@body))

(<span style="font-weight: bold;">defmacro</span> <span style="font-weight: bold;">with-password-store-entry-field</span> (entry field <span style="font-weight: bold; text-decoration: underline;">&amp;rest</span> body)
  <span style="font-style: italic;">"Eval BODY which can refer password-store ENTRY and FIELD..</span>

<span style="font-style: italic;">Plus, OBDY can refer value of FIELD named field-value."</span>
  (<span style="font-weight: bold;">declare</span> (indent defun))
  `(<span style="font-weight: bold;">let*</span> ((entry (<span style="font-weight: bold;">or</span> ,entry
                     (<span style="font-weight: bold;">when</span> (derived-mode-p 'org-mode) (org-entry-get (point) my/org-password-store-property))
                     (password-store--completing-read t)))
          (field (<span style="font-weight: bold;">or</span> ,field
                     (password-store-read-field entry)))
          (field-value (password-store-get-field entry
                                                 (<span style="font-weight: bold;">or</span> (<span style="font-weight: bold;">and</span> (string= field <span style="font-style: italic;">"secret"</span>)
                                                          'secret)
                                                     (<span style="font-weight: bold;">and</span> (stringp field)
                                                          field)))))
     ,@body))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/password-store-copy</span> ()
  <span style="font-style: italic;">"Add the secret to system clipboard and the username to primary `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">x-selection</span><span style="font-style: italic;">'.</span>

<span style="font-style: italic;">`</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">password-store-copy</span><span style="font-style: italic;">' is responsible for managing the kill ring."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (with-password-store-entry-field nil <span style="font-style: italic;">"username"</span>
                                   (password-store-copy entry)
                                   (gui-set-selection 'PRIMARY
                                                      (<span style="font-weight: bold;">or</span> (password-store-get-field entry <span style="font-style: italic;">"username"</span>)
                                                          (password-store-get-field entry <span style="font-style: italic;">"email"</span>)
                                                          (nth 1 (password-store-parse-entry entry))))
                                   (message <span style="font-style: italic;">"USERNAME =&gt; X-SEL, SECRET =&gt; CLIPBOARD"</span>)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/password-store-copy-field</span> ()
  <span style="font-style: italic;">"Add field for entry into the kill ring.</span>

<span style="font-style: italic;">entry and field is determined by appropriate manner."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (with-password-store-entry-field nil nil
                                   (password-store-copy-field entry field)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/password-store-url</span> (<span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> arg)
  <span style="font-style: italic;">"Browse url stored in entry by appropriate manner determined by ARG."</span>
  (<span style="font-weight: bold;">interactive</span> <span style="font-style: italic;">"P"</span>)
  (with-password-store-entry-field nil <span style="font-style: italic;">"url"</span>
                                   (browse-url field-value)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/password-store-show-field</span> ()
  <span style="font-style: italic;">"Show a field value in the minibuffer.</span>

<span style="font-style: italic;">Password-store entry and field used to derive this value are from org property</span>
<span style="font-style: italic;">or selected by user."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (with-password-store-entry-field nil nil
                                   (message <span style="font-style: italic;">"%s: %s"</span> field field-value)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/password-store-create</span> ()
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">let*</span> ((input (read-string <span style="font-style: italic;">"Entry-name or URL: "</span>))
         (domain (<span style="font-weight: bold;">when</span> (string-match-p browse-url-button-regexp input)
                   (string-trim-right
                    (shell-command-to-string (format <span style="font-style: italic;">"echo %s | awk -F[/:] '{print $4}'"</span>
                                                     (shell-quote-argument input)))))))
    (with-password-store-entry (<span style="font-weight: bold;">cond</span>
                                ((&gt; (length domain) 0) domain)
                                (input))
                               (<span style="font-weight: bold;">when</span> (derived-mode-p 'org-mode)
                                 (org-entry-put (point) my/org-password-store-property entry))
                               (password-store-edit entry))))

<span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/password-store-edit</span> ()
  (<span style="font-weight: bold;">interactive</span>)
  (with-password-store-entry nil
                             (password-store-edit entry)))

<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">TODO: make my/password-store-insert as soon after</span>
<span style="font-weight: bold; font-style: italic;">;;     </span><span style="font-weight: bold; font-style: italic;">: password-store--run-insert has been implemented</span>

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/password-store-remove</span> ()
  (<span style="font-weight: bold;">interactive</span>)
  (with-password-store-entry nil
                             (password-store-remove entry)
                             (<span style="font-weight: bold;">when</span> (derived-mode-p 'org-mode)
                               (org-entry-delete (point) my/org-password-store-property))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/password-store-web-login</span> ()
  <span style="font-style: italic;">"Open url for the entry at point.</span>

<span style="font-style: italic;">Additionally the username and the secret are saved in X selection and clipboard respectively."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (my/password-store-copy)
  (funcall-interactively #'my/password-store-url '(16)))

(advice-add #'password-store-clear <span style="font-weight: bold;">:before</span> #'my/password-store-clear)

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/password-store-clear</span> (<span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> field)
  <span style="font-style: italic;">"Overwrite clipboard data so that password once saved in clipboard is deleted</span>
<span style="font-style: italic;"> for security risk.</span>

<span style="font-style: italic;">FIELD originally for messaging is ignored in this function."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">when</span> password-store-kill-ring-pointer
    (kill-new <span style="font-style: italic;">""</span>)
    (setcar kill-ring-yank-pointer <span style="font-style: italic;">""</span>)))

(<span style="font-weight: bold;">provide</span> '<span style="font-weight: bold; text-decoration: underline;">org-password-store</span>)
</pre>
</div>
</div>
</li>

<li><a id="org12ceb91"></a>text-mail&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span><br /></li>

<li><a id="org3c67662"></a>learning english words/phrases<br />
<div class="outline-text-5" id="text-org3c67662">
<p>
My workflow for acquiring English words is:
</p>
<ol class="org-ol">
<li>Capture a word which come across in the article I'm reading with my/org-english-capture
<ul class="org-ul">
<li>Captured words will be appended to my English word list</li>
</ul></li>
<li>Review my English word list with my/org-english-drill everyday
<ul class="org-ul">
<li>Org-drill ask questions to level up my vocabulary</li>
</ul></li>
</ol>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">define-word</span>)
(<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">org</span>)
(<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">org-drill</span>)
(<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">cl-lib</span>)
(<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">request</span>)
(<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">logos</span>)
(<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">org-tidy</span>)

(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my/org-english-file</span> <span style="font-style: italic;">"~/documents/english.org"</span>
  <span style="font-style: italic;">"A file where all english words to learn locate."</span>)

(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my/org-english-word</span> nil
  <span style="font-style: italic;">"An english word to capture."</span>)

(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my/org-english-match-entry</span> nil
  <span style="font-style: italic;">"An org entry which matches search word."</span>)

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/org-english-capture</span> (word)
  <span style="font-style: italic;">"Capture an english WORD as a `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">org-mode</span><span style="font-style: italic;">' entry suitable for org-drill.</span>

<span style="font-style: italic;">Capture URL or file currently visiting as well as a sentence at point."</span>
  (<span style="font-weight: bold;">interactive</span> (list (determine-search-word <span style="font-style: italic;">"Word to capture: "</span>)))
  (<span style="font-weight: bold;">setq</span> org-english-word (downcase word))
  (<span style="font-weight: bold;">setq</span> my/org-english-match-entry nil)
  (<span style="font-weight: bold;">let*</span> ((sentence-end-double-space nil)
         (my/org-english-match-entry (org-ql-select
                                      `(,my/org-english-file)
                                      `(<span style="font-weight: bold;">and</span> (heading-regexp
                                             ,(eval `(<span style="font-weight: bold;">rx</span> word-start
                                                         ,org-english-word
                                                         word-end)))
                                            (tags <span style="font-style: italic;">"drill"</span>))
                                      <span style="font-weight: bold;">:action</span> 'element-with-markers))
         (sentence (replace-regexp-in-string word
                                             (my/cloze-deletion word)
                                             (<span style="font-weight: bold;">or</span> (sentence-at-point) <span style="font-style: italic;">""</span>))))
    (kill-new (<span style="font-weight: bold;">if</span> (stringp sentence) sentence <span style="font-style: italic;">""</span>))
    (<span style="font-weight: bold;">cond</span>
     (my/org-english-match-entry (org-capture nil <span style="font-style: italic;">"!1"</span>))
     (t (org-capture nil <span style="font-style: italic;">"!0"</span>)))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/cloze-deletion</span> (word)
  <span style="font-style: italic;">"Build cloze deletion string from WORD."</span>
  (seq-reduce (<span style="font-weight: bold;">lambda</span> (string chunk)
                (replace-regexp-in-string chunk (format <span style="font-style: italic;">"[%s||%c]"</span> chunk (string-to-char chunk))
                                          string))
              (split-string word <span style="font-style: italic;">"[ -]+"</span>)
              word))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/cloze-deletion-replace</span> (word start end)
  <span style="font-style: italic;">"Convert WORD into cloze deletion.</span>
<span style="font-style: italic;">OWRD can be determined a string between START and END.</span>

<span style="font-style: italic;">When called Interactively, WORD is either a word at point or a string in region."</span>
  (<span style="font-weight: bold;">interactive</span> (<span style="font-weight: bold;">cond</span>
                ((region-active-p)
                 `(,(buffer-substring (region-beginning) (region-end))
                   ,(region-beginning)
                   ,(region-end)))
                (t
                 (<span style="font-weight: bold;">let</span> ((bounds (bounds-of-thing-at-point 'word)))
                   `(,(thing-at-point 'word)
                     ,(car bounds)
                     ,(cdr bounds))))))
  (replace-string word
                  (my/cloze-deletion word)
                  nil
                  start
                  end))

(<span style="font-weight: bold;">with-eval-after-load</span> 'org-ql-view
  (<span style="font-weight: bold;">push</span> `(<span style="font-style: italic;">"English words to learn"</span>
          <span style="font-weight: bold;">:buffers-files</span> ,(list my/org-english-file)
          <span style="font-weight: bold;">:query</span> (<span style="font-weight: bold;">and</span> (tags <span style="font-style: italic;">"drill"</span>)
                      (tags <span style="font-style: italic;">"fd_en"</span>))
          <span style="font-weight: bold;">:sort</span> (scheduled date))
        org-ql-views))

(<span style="font-weight: bold;">with-eval-after-load</span> 'org-capture
  (add-to-list 'org-capture-templates
               '(<span style="font-style: italic;">"!0"</span> <span style="font-style: italic;">"drill entry for english word"</span>
                 entry (id <span style="font-style: italic;">"de0983a7-9d1a-4ef8-b882-148c401e862d"</span>)
                 <span style="font-style: italic;">"* %i :drill:fd_en:</span>
<span style="font-style: italic;">[%(my/english-japanese-translate org-english-word t) %(my/english-pronunciation org-english-word t)]</span>
<span style="font-style: italic;">%(my/org-english-insert-english-translation)</span>
<span style="font-style: italic;">- %a</span>
<span style="font-style: italic;">  %c"</span>))
  (add-to-list 'org-capture-templates
               '(<span style="font-style: italic;">"!1"</span> <span style="font-style: italic;">"drill entry for english word"</span>
                 item (<span style="font-weight: bold;">function</span> my/org-english-goto-match)
                 <span style="font-style: italic;">"- %a</span>
<span style="font-style: italic;">  %c"</span>)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/org-english-goto-match</span> ()
  <span style="font-style: italic;">"Goto function for org-capture-template designed to insert an edditional example</span>
<span style="font-style: italic;">to existing english word entry."</span>
  (org-goto-marker-or-bmk
   (plist-get (cadar my/org-english-match-entry) <span style="font-weight: bold;">:org-marker</span>)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/org-english-insert-english-translation</span> ()
  <span style="font-style: italic;">"Insert English translation into org capture entry."</span>
  (<span style="font-weight: bold;">let*</span> ((url (format <span style="font-style: italic;">"http://wordnik.com/words/%s"</span> (downcase org-english-word)))
         (buffer (url-retrieve-synchronously url t t))
         (vertico-sort-function nil))
    (<span style="font-weight: bold;">with-temp-buffer</span>
      (url-insert-buffer-contents buffer url)
      (completing-read <span style="font-style: italic;">"match"</span> (split-string (funcall 'my/define-word--parse-wordnik) <span style="font-style: italic;">"\n"</span>)))))

(advice-add #'my/org-english-insert-english-translation <span style="font-weight: bold;">:around</span> #'my/define-word--fix-31)

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/english-japanese-translate</span> (word <span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> sync)
  <span style="font-style: italic;">"Search Japanese translation for WORD and add it to kill ring.</span>

<span style="font-style: italic;">SYNC handles whether network access procedure is synchronous.</span>
<span style="font-style: italic;">Return translation result as a string If SYNC is non-nil.</span>
<span style="font-style: italic;">If called interactively, display results and add them to kill ring."</span>
  (<span style="font-weight: bold;">let</span> (trans)
    (request
      (concat <span style="font-style: italic;">"https://ejje.weblio.jp/content/"</span> (downcase word))
      <span style="font-weight: bold;">:sync</span> sync
      <span style="font-weight: bold;">:timeout</span> 60
      <span style="font-weight: bold;">:parser</span>
      (<span style="font-weight: bold;">lambda</span> ()
        (<span style="font-weight: bold;">let</span> ((str (buffer-string)))
          (<span style="font-weight: bold;">with-temp-buffer</span>
            (insert str)
            (shr-render-region (point-min) (point-max))
            (buffer-substring-no-properties (point-min) (point-max)))))
      <span style="font-weight: bold;">:success</span>
      (<span style="font-weight: bold;">cl-function</span>
       (<span style="font-weight: bold;">lambda</span> (<span style="font-weight: bold; text-decoration: underline;">&amp;key</span> data <span style="font-weight: bold; text-decoration: underline;">&amp;allow-other-keys</span>)
         (<span style="font-weight: bold;">and</span> (string-match
               (<span style="font-weight: bold;">rx</span> (seq <span style="font-style: italic;">"&#24847;&#21619;&#12539;&#23550;&#35379; "</span>
                        (group-n 1 (+ (<span style="font-weight: bold;">or</span> (category base)
                                          (category combining-diacritic)
                                          (category latin)
                                          (category japanese-katakana-two-byte)
                                          (category korean)
                                          (category greek))))))
               data)
              (<span style="font-weight: bold;">setq</span> trans (string-trim (match-string 1 data)))))))
    trans))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/english-pronunciation</span> (word <span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> sync)
  <span style="font-style: italic;">"Search pronunciation information for WORD and add it to kill ring.</span>

<span style="font-style: italic;">SYNC handles whether network access procedure is synchronous.</span>
<span style="font-style: italic;">Return search infromation as a string If SYNC is non-nil.</span>
<span style="font-style: italic;">Display information and add it to kill ring if called interactively."</span>
  (<span style="font-weight: bold;">let</span> (pron)
    (request
      (concat <span style="font-style: italic;">"https://eow.alc.co.jp/search?q="</span> (string-replace <span style="font-style: italic;">" "</span> <span style="font-style: italic;">"+"</span> (downcase word)))
      <span style="font-weight: bold;">:sync</span> sync
      <span style="font-weight: bold;">:timeout</span> 10
      <span style="font-weight: bold;">:parser</span>
      (<span style="font-weight: bold;">lambda</span> ()
        (<span style="font-weight: bold;">let</span> ((str (buffer-string)))
          (<span style="font-weight: bold;">with-temp-buffer</span>
            (insert str)
            (shr-render-region (point-min) (point-max))
            (buffer-substring-no-properties (point-min) (point-max)))))
      <span style="font-weight: bold;">:success</span>
      (<span style="font-weight: bold;">cl-function</span>
       (<span style="font-weight: bold;">lambda</span> (<span style="font-weight: bold; text-decoration: underline;">&amp;key</span> data <span style="font-weight: bold; text-decoration: underline;">&amp;allow-other-keys</span>)
         (<span style="font-weight: bold;">and</span> (string-match
               (<span style="font-weight: bold;">rx</span> (seq (opt <span style="font-style: italic;">"&#12304;&#12524;&#12505;&#12523;&#12305;"</span> (** 1 2 digit) <span style="font-style: italic;">"&#12289;"</span>)
                        <span style="font-style: italic;">"&#12304;&#30330;&#38899;"</span> (opt <span style="font-style: italic;">"&#65281;"</span>) <span style="font-style: italic;">"&#12305;"</span>
                        (+ (<span style="font-weight: bold;">or</span> (category combining-diacritic)
                               (category latin)
                               (category japanese-katakana-two-byte)
                               (category korean)
                               (category greek)))
                        <span style="font-style: italic;">"&#12289;"</span>
                        (? (<span style="font-weight: bold;">or</span> (seq <span style="font-style: italic;">"&#12304;&#65312;&#12305;"</span> (opt <span style="font-style: italic;">"[US]"</span>)
                                    (+ (<span style="font-weight: bold;">or</span> (category japanese-katakana-two-byte)
                                           <span style="font-style: italic;">"&#65288;"</span> <span style="font-style: italic;">"&#65289;"</span>))
                                    (? <span style="font-style: italic;">"&#12289;"</span>))
                               (seq (+ any) <span style="font-style: italic;">"*"</span>)))))
               data)
              (<span style="font-weight: bold;">setq</span> pron (replace-regexp-in-string
                          <span style="font-style: italic;">"\\[</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">.\\{</span><span style="font-weight: bold; font-style: italic;">2\\</span><span style="font-style: italic;">}</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">\\]"</span> <span style="font-style: italic;">"&#12304;\\1&#12305;"</span>
                          (string-trim-right (match-string 0 data)
                                             <span style="font-style: italic;">"&#12289;"</span>)))))))
    pron))

(<span style="font-weight: bold;">defmacro</span> <span style="font-weight: bold;">with-org-drill-english-config</span> (<span style="font-weight: bold; text-decoration: underline;">&amp;rest</span> body)
  <span style="font-style: italic;">"Evaluate BODY with config for Org-Drill for english words review."</span>
  `(<span style="font-weight: bold;">progn</span>
     (org-id-goto <span style="font-style: italic;">"de0983a7-9d1a-4ef8-b882-148c401e862d"</span>)
     (<span style="font-weight: bold;">let</span> (<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">imperative settings</span>
           (org-drill-scope 'tree)
           (org-drill-question-tag <span style="font-style: italic;">"drill"</span>)
           (org-drill-hide-item-headings-p t)
           <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">drill session regulations</span>
           (org-drill-maximum-duration 25)
           (org-drill-maximum-items-per-session 50)
           <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Definition of old and overdue items</span>
           (org-drill-overdue-interval-factor 1.4) <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">more permissive for overdue than 1.2 (default)</span>
           (org-drill-days-before-old 15)
           <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Spaced repetition algorithm</span>
           (org-drill-spaced-repetition-algorithm 'sm5)
           (org-drill-sm5-initial-interval 7.0) <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">initial step is 7 day</span>
           <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Random variation of repetition intervals</span>
           (org-drill-add-random-noise-to-intervals-p t)
           <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Adjustment for early or late review of items</span>
           (org-drill-adjust-intervals-for-early-and-late-repetitions-p t)
           <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Adjusting item difficulty globally</span>
           (org-drill-learn-fraction 0.43) <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">intend not to reschedule drastically forward in 10th+ interval</span>
           (org-drill-leech-method nil)
           (org-startup-indented nil)
           (logos-hide-cursor t)
           (logos-hide-mode-line t)
           (logos-hide-buffer-boundaries t)
           (logos-buffer-read-only nil)
           (logos-olivetti nil)
           (logos-hide-fringe t))
       (org-indent-mode -1)
       (visual-line-mode 1)
       (text-scale-set -1)
       (logos-focus-mode 1)
       ,@body)
     (org-indent-mode 1)
     (text-scale-set 0)
     (visual-line-mode -1)
     (logos-focus-mode -1)))

<span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/org-english-drill</span> ()
  <span style="font-style: italic;">"Invoke Org-Drill for English word review."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (with-org-drill-english-config (org-drill)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/org-english-drill-resume</span> ()
  <span style="font-style: italic;">"Resume Org-Drill session for english word review."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (with-org-drill-english-config (org-drill-resume)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/org-english-link</span> ()
  <span style="font-style: italic;">"Make a link pointing the word with context."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">save-excursion</span>
    (<span style="font-weight: bold;">let</span> ((current-prefix-arg '(4)))
      (call-interactively #'org-refile ))
    (call-interactively #'org-store-link))
  (<span style="font-weight: bold;">let*</span> ((contexts '(<span style="font-style: italic;">"synonym"</span> <span style="font-style: italic;">"antonym"</span> <span style="font-style: italic;">"collocation"</span>
                     <span style="font-style: italic;">"distinct"</span> <span style="font-style: italic;">"similar"</span> <span style="font-style: italic;">"akin"</span> <span style="font-style: italic;">"relevant"</span>
                     <span style="font-style: italic;">"morphological"</span> <span style="font-style: italic;">"derivative"</span>))
         (context (completing-read <span style="font-style: italic;">"Context: "</span> contexts))
         (org-log-note-headings (append `((context . ,(format <span style="font-style: italic;">"&lt;%s&gt; %%s %%t"</span> context)))
                                        org-log-note-headings))
         (link-str (<span style="font-weight: bold;">with-temp-buffer</span>
                     (call-interactively #'org-insert-last-stored-link)
                     (concat <span style="font-style: italic;">" "</span> <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">workaround for org-ql failing to recognize org-link with preceding "</span>
                             (buffer-substring-no-properties (point-min) (1- (point-max)))
                             <span style="font-style: italic;">" "</span>))))
    (org-add-log-setup 'context link-str
                       nil 'state (format-time-string (org-time-stamp-format t t)))
    (run-hooks 'post-command-hook)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/org-english-list-undrilled</span> ()
  <span style="font-style: italic;">"List english words which haven't been tested before in level ascending order."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">with-current-buffer</span> (find-file-noselect my/org-english-file)
    (org-ql-search my/org-english-file
                   '(and (tags <span style="font-style: italic;">"drill"</span>)
                         (tags <span style="font-style: italic;">"fd_en"</span>)
                         (not (property <span style="font-style: italic;">"DRILL_LAST_REVIEWED"</span>)))
                   <span style="font-weight: bold;">:sort</span> 'my/org-ql--english-level&lt;)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/org-english-search</span> (word)
  <span style="font-style: italic;">"Look up WORD in my archive files using `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">org-ql-search</span><span style="font-style: italic;">'."</span>
  (<span style="font-weight: bold;">interactive</span> (list (<span style="font-weight: bold;">if</span> (use-region-p)
                         (buffer-substring (region-beginning) (region-end))
                       (read-string <span style="font-style: italic;">"Word: "</span>))))
  (org-ql-search
    my/org-english-file
    `(heading-regexp ,(eval `(<span style="font-weight: bold;">rx</span> word-start
                                 ,(downcase word)
                                 word-end)))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/org-english-level</span> (word)
  <span style="font-style: italic;">"Return difficulty level of `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">WORD</span><span style="font-style: italic;">' in number."</span>
  (<span style="font-weight: bold;">cl-labels</span> ((parse-level (text)
                (<span style="font-weight: bold;">if</span> (string-match
                     (<span style="font-weight: bold;">rx</span> (seq <span style="font-style: italic;">"&#12304;&#12524;&#12505;&#12523;&#12305;"</span>
                              (group-n 1 (repeat 1 2 digit))))
                     text)
                    (match-string 1 text)
                  nil)))
    (<span style="font-weight: bold;">let</span> ((local-str (<span style="font-weight: bold;">with-current-buffer</span> (find-file-noselect my/org-english-file)
                       (<span style="font-weight: bold;">let</span> ((headline (org-ql-select
                                         `(,my/org-english-file)
                                         `(<span style="font-weight: bold;">and</span> (heading-regexp ,(eval `(<span style="font-weight: bold;">rx</span> word-start
                                                                           ,(downcase word)
                                                                           word-end)))
                                               (tags <span style="font-style: italic;">"drill"</span>))
                                         <span style="font-weight: bold;">:action</span> 'element-with-markers)))
                         (<span style="font-weight: bold;">org-with-point-at</span> (plist-get (cadar headline) <span style="font-weight: bold;">:org-marker</span>)
                           (org-get-entry))))))
      (string-to-number (<span style="font-weight: bold;">or</span> (<span style="font-weight: bold;">and</span> local-str
                                 (parse-level local-str))
                            <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">CAVEAT: getting level from web costs a lot</span>
                            <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(when-let ((remote-str (my/english-pronunciation word)))</span>
                            <span style="font-weight: bold; font-style: italic;">;;   </span><span style="font-weight: bold; font-style: italic;">(parse-level remote-str))</span>
                            <span style="font-style: italic;">"99"</span>)))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/org-ql--english-level&lt;</span> (a b)
  <span style="font-style: italic;">"Return non-nil if A's difficulty level is higher than B's.</span>
<span style="font-style: italic;">A and B are Org headline elements."</span>
  (<span style="font-weight: bold;">cl-macrolet</span> ((level (item)
                  `(my/org-english-level
                    (org-element-property <span style="font-weight: bold;">:raw-value</span> ,item))))
    (<span style="font-weight: bold;">let</span> ((a-level (level a))
          (b-level (level b)))
      (<span style="font-weight: bold;">cond</span> ((<span style="font-weight: bold;">and</span> (numberp a-level) (numberp b-level))
             (&lt; a-level b-level))
            (a-level t)
            (b-level nil)))))

(<span style="font-weight: bold;">provide</span> '<span style="font-weight: bold; text-decoration: underline;">org-drill-english</span>)
</pre>
</div>

<p>
Call <a href="(call-interactively #'ert)">ERT</a> with test-org-english-pron to test this code.
</p>

<p>
test code
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">ert</span>)

(<span style="font-weight: bold;">ert-deftest</span> <span style="font-weight: bold;">test-org-english-pron</span> ()
  <span style="font-style: italic;">"Tests the output string of `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">my/org-english-insert-japanese-pronunciation</span><span style="font-style: italic;">'."</span>
  (should (string= (my/org-english-insert-japanese-pronunciation <span style="font-style: italic;">"rife"</span>)
                   <span style="font-style: italic;">"&#12304;&#12524;&#12505;&#12523;&#12305;11&#12289;&#12304;&#30330;&#38899;&#12305;ra&#769;if&#12289;&#12304;&#65312;&#12305;&#12521;&#12452;&#12501;"</span>))
  (should (string= (my/org-english-insert-japanese-pronunciation <span style="font-style: italic;">"congregate"</span>)
                   <span style="font-style: italic;">"&#12304;&#12524;&#12505;&#12523;&#12305;12&#12289;&#12304;&#30330;&#38899;&#65281;&#12305;&#12304;US&#12305;&#12298;&#21205;&#12299;k&#593;&#769;ngr&#601;ge&#768;it &#12298;&#24418;&#12299;k&#593;&#769;&#331;gr&#601;git &#65372; &#12304;UK&#12305;&#12298;&#21205;&#12299;k&#596;&#769;&#331;grige&#768;it &#12298;&#24418;&#12299;k&#596;&#769;&#331;grigit"</span>))
  (should (string= (my/org-english-insert-japanese-pronunciation <span style="font-style: italic;">"unleash"</span>)
                   <span style="font-style: italic;">"&#12304;&#12524;&#12505;&#12523;&#12305;9&#12289;&#12304;&#30330;&#38899;&#12305;&#652;&#768;nli&#769;&#720;&#643;&#12289;&#12304;&#65312;&#12305;&#12450;&#12531;&#12522;&#12540;&#12471;&#12517;"</span>))
  (should (string= (my/org-english-insert-japanese-pronunciation <span style="font-style: italic;">"homage"</span>)
                   <span style="font-style: italic;">"&#12304;&#12524;&#12505;&#12523;&#12305;11&#12289;&#12304;&#30330;&#38899;&#12305;&#12304;US&#12305; h&#593;&#769;mid&#658; &#65372; &#12304;UK&#12305; h&#596;&#769;mid&#658;&#12289;&#12304;&#65312;&#12305;&#12304;US&#12305;&#12495;&#12511;&#12472;&#12289;&#12304;UK&#12305;&#12507;&#12511;&#12472;"</span>))
  (should (string= (my/org-english-insert-japanese-pronunciation <span style="font-style: italic;">"interstitial"</span>)
                   <span style="font-style: italic;">"&#12304;&#30330;&#38899;&#12305;i&#768;nt&#601;rsti&#769;&#643;&#601;l&#12289;&#12304;&#65312;&#12305;&#12452;&#12531;&#12479;&#65288;&#12540;&#65289;&#12473;&#12486;&#12451;&#12471;&#12515;&#12523;"</span>))
  (should (string= (my/org-english-insert-japanese-pronunciation <span style="font-style: italic;">"veterinarian"</span>)
                   <span style="font-style: italic;">"&#12304;&#12524;&#12505;&#12523;&#12305;12&#12289;&#12304;&#30330;&#38899;&#12305;ve&#768;t&#601;r&#601;n&#8051;&#601;ri&#601;n&#12289;&#12304;&#65312;&#12305;&#12532;&#12455;&#12488;&#12521;&#12493;&#12450;&#12522;&#12450;&#12531;"</span>))
  (should (string= (my/org-english-insert-japanese-pronunciation <span style="font-style: italic;">"warehouse"</span>)
                   <span style="font-style: italic;">"&#12304;&#12524;&#12505;&#12523;&#12305;8&#12289;&#12304;&#30330;&#38899;&#65281;&#12305;&#12298;&#21205;&#12299;w&#8051;&#601;rha&#768;uz &#12298;&#21517;&#12299;w&#8051;&#601;rha&#768;us&#12289;&#12304;&#65312;&#12305;&#12454;&#12455;&#12450;&#12495;&#12454;&#12473;&#12289;&#12454;&#12456;&#12450;&#12495;&#12454;&#12473;"</span>))
  (should (string= (my/org-english-insert-japanese-pronunciation <span style="font-style: italic;">"lambaste"</span>)
                   <span style="font-style: italic;">""</span>))
  (should (string= (my/org-english-insert-japanese-pronunciation <span style="font-style: italic;">"in a nutshell"</span>)
                   <span style="font-style: italic;">""</span>))
  (should (string= (my/org-english-insert-japanese-pronunciation <span style="font-style: italic;">"traverse"</span>)
                   <span style="font-style: italic;">"&#12304;&#12524;&#12505;&#12523;&#12305;8&#12289;&#12304;&#30330;&#38899;&#65281;&#12305;&#12298;&#21517;&#12539;&#24418;&#12299;tr&#230;&#769;v&#601;&#720;rs &#12298;&#21205;&#12299;tr&#601;v&#652;&#769;rs&#12289;&#12304;&#65312;&#12305;&#12488;&#12453;&#12521;&#12532;&#12449;&#12540;&#12473;&#12289;&#12488;&#12521;&#12496;&#12540;&#12473;"</span>)))
</pre>
</div>
</div>
</li>

<li><a id="org140bf91"></a>org-relate&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span><br /></li>

<li><a id="org675134c"></a>org-clocktable-by-tag<br />
<div class="outline-text-5" id="text-org675134c">
<p>
Provide a function to Build a clock table summing up time by tag.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">with-eval-after-load</span> 'org
  (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">org-clocktable-by-tag</span>))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">org-table</span>)
(<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">org-clock</span>)

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">clocktable-by-tag/shift-cell</span> (n)
  (<span style="font-weight: bold;">let</span> ((str <span style="font-style: italic;">""</span>))
    (<span style="font-weight: bold;">dotimes</span> (i n)
      (<span style="font-weight: bold;">setq</span> str (concat str <span style="font-style: italic;">"| "</span>)))
    str))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">clocktable-by-tag/insert-tag</span> (params)
  (<span style="font-weight: bold;">let</span> ((match (plist-get params <span style="font-weight: bold;">:match</span>)))
    (insert <span style="font-style: italic;">"|--\n"</span>)
    (insert (format <span style="font-style: italic;">"| %s | *Tag time* |\n"</span> match))
    (<span style="font-weight: bold;">let</span> ((total 0))
      (mapcar
       (<span style="font-weight: bold;">lambda</span> (file)
         (<span style="font-weight: bold;">let</span> ((clock-data (<span style="font-weight: bold;">with-current-buffer</span> (find-file-noselect file)
                             (org-clock-get-table-data (buffer-name) params))))
           (<span style="font-weight: bold;">when</span> (&gt; (nth 1 clock-data) 0)
             (<span style="font-weight: bold;">setq</span> total (+ total (nth 1 clock-data)))
             (insert (format <span style="font-style: italic;">"| | File *%s* | %.2f |\n"</span>
                             (file-name-nondirectory file)
                             (/ (nth 1 clock-data) 60.0)))
             (<span style="font-weight: bold;">dolist</span> (entry (nth 2 clock-data))
               (insert (format <span style="font-style: italic;">"| | . %s%s | %s %.2f |\n"</span>
                               (org-clocktable-indent-string (nth 0 entry))
                               (replace-regexp-in-string <span style="font-style: italic;">"|"</span> <span style="font-style: italic;">"\\vert</span><span style="font-weight: bold; font-style: italic;">\</span><span style="font-style: italic;">{</span><span style="font-weight: bold; font-style: italic;">\</span><span style="font-style: italic;">}"</span> (nth 1 entry) nil t)
                               (clocktable-by-tag/shift-cell (nth 0 entry))
                               (/ (nth 4 entry) 60.0)))))))
       (org-agenda-files))
      (<span style="font-weight: bold;">if</span> (= total 0)
          (<span style="font-weight: bold;">save-excursion</span>
            (re-search-backward <span style="font-style: italic;">"*Tag time*"</span>)
            (forward-line -1)
            (<span style="font-weight: bold;">dotimes</span> (i 2)
              (org-table-kill-row)))
        (<span style="font-weight: bold;">save-excursion</span>
          (re-search-backward <span style="font-style: italic;">"*Tag time*"</span>)
          (org-table-next-field)
          (org-table-blank-field)
          (insert (format <span style="font-style: italic;">"*%.2f*"</span> (/ total 60.0))))))
    (org-table-align)))

<span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">org-dblock-write:clocktable-by-tag</span> (params)
  (funcall indent-line-function)
  (insert <span style="font-style: italic;">"| Tag | Headline | Time (h) |\n"</span>)
  (insert <span style="font-style: italic;">"|     |          | &lt;r&gt;  |\n"</span>)
  (<span style="font-weight: bold;">let</span> ((matches
         (org-global-tags-completion-table)))
    (mapcar (<span style="font-weight: bold;">lambda</span> (match)
              (<span style="font-weight: bold;">let</span> ((match-str (car match))
                    (case-fold-search nil))
                (<span style="font-weight: bold;">when</span> (string-match-p <span style="font-style: italic;">"^AC_"</span> match-str)
                  (<span style="font-weight: bold;">setq</span> params (plist-put params <span style="font-weight: bold;">:match</span> match-str))
                  (clocktable-by-tag/insert-tag params))))
            matches)))

(<span style="font-weight: bold;">provide</span> '<span style="font-weight: bold; text-decoration: underline;">org-clocktable-by-tag</span>)
</pre>
</div>
</div>
</li>

<li><a id="org1dd9c1a"></a>weather<br />
<div class="outline-text-5" id="text-org1dd9c1a">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#27671;&#35937;&#24193;&#37197;&#20449;&#12398;&#22825;&#27671;&#24773;&#22577;&#12434;&#21152;&#24037;&#12375;&#12390;&#34920;&#31034;</span>

(<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">request</span>)
(<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">cl-lib</span>)

(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">weather-areas</span>
  '(((url . <span style="font-style: italic;">"http://www.drk7.jp/weather/xml/14.xml"</span>)
     (pref . <span style="font-style: italic;">"&#31070;&#22856;&#24029;&#30476;"</span>)
     (area . <span style="font-style: italic;">"&#35199;&#37096;"</span>))
    ((url . <span style="font-style: italic;">"http://www.drk7.jp/weather/xml/22.xml"</span>)
     (pref . <span style="font-style: italic;">"&#38745;&#23713;&#30476;"</span>)
     (area . <span style="font-style: italic;">"&#20013;&#37096;"</span>))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">weather-area-show</span> (weather-area-alist weather-buffer)
  (lexical-let ((url (assoc-default 'url weather-area-alist))
                (pref (assoc-default 'pref weather-area-alist))
                (area (assoc-default 'area weather-area-alist))
                (buffer weather-buffer))
    (request
      url
      <span style="font-weight: bold;">:parser</span>
      (<span style="font-weight: bold;">lambda</span> ()
        (<span style="font-weight: bold;">let</span> ((xml-string (string-as-multibyte (string-as-unibyte (buffer-string)))))
          (<span style="font-weight: bold;">with-temp-buffer</span>
            (erase-buffer)
            (insert xml-string)
            (libxml-parse-xml-region (point-min) (point-max)))))
      <span style="font-weight: bold;">:success</span>
      (<span style="font-weight: bold;">cl-function</span>
       (<span style="font-weight: bold;">lambda</span> (<span style="font-weight: bold; text-decoration: underline;">&amp;key</span> data <span style="font-weight: bold; text-decoration: underline;">&amp;allow-other-keys</span>)
         (<span style="font-weight: bold;">when</span> data
           (<span style="font-weight: bold;">with-current-buffer</span> buffer
             (insert (format <span style="font-style: italic;">"%s %s\n"</span> pref area))
             (mapcar
              (<span style="font-weight: bold;">lambda</span> (info-node)
                (insert
                 (format <span style="font-style: italic;">"%s %s %s %s\n"</span>
                         (<span style="font-weight: bold;">dom-attr</span> info-node 'date)
                         (apply (<span style="font-weight: bold;">lambda</span> (max-temp-node min-temp-node)
                                  (format <span style="font-style: italic;">"%2d/%2d&#8451;"</span>
                                          (string-to-number (dom-text min-temp-node))
                                          (string-to-number (dom-text max-temp-node))))
                                (dom-by-tag (dom-child-by-tag info-node 'temperature) 'range))
                         (apply (<span style="font-weight: bold;">lambda</span> (node-1 node-2 node-3 node-4)
                                  (format <span style="font-style: italic;">"%2d-%2d-%2d-%2d&#65285;"</span>
                                          (string-to-number (dom-text node-1))
                                          (string-to-number (dom-text node-2))
                                          (string-to-number (dom-text node-3))
                                          (string-to-number (dom-text node-4))))
                                (dom-by-tag (dom-child-by-tag info-node 'rainfallchance) 'period))
                         (dom-text (dom-child-by-tag info-node 'weather)))))
              (dom-by-tag (dom-by-id data area) 'info))
             (insert <span style="font-style: italic;">"\n"</span>))))))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">weather</span> ()
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">let</span> ((buffer (get-buffer-create <span style="font-style: italic;">"weather"</span>)))
    (mapcar (<span style="font-weight: bold;">lambda</span> (weather-area)
              (weather-area-show weather-area buffer))
            weather-areas)
    (switch-to-buffer buffer)))

(<span style="font-weight: bold;">provide</span> '<span style="font-weight: bold; text-decoration: underline;">weather</span>)
</pre>
</div>
</div>
</li>

<li><a id="org9571ecf"></a>Package: dispatch-dwim<br />
<div class="outline-text-5" id="text-org9571ecf">
<div class="org-src-container">
<pre class="src src-emacs-lisp" id="orgac8807b">(<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">transient</span>)
(<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">detached</span>)

<span style="font-weight: bold; font-style: italic;">;;; </span><span style="font-weight: bold; font-style: italic;">Variables</span>

(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">dispatch-dwim--precedings-followings</span> nil)
(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">dispatch-dwim--overriding-method</span> nil)

(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">dispatch-dwim--default-method</span> 'detached-shell-command)

(add-hook 'transient-exit-hook
          (<span style="font-weight: bold;">lambda</span> () (<span style="font-weight: bold;">unless</span> transient--stack
                   (<span style="font-weight: bold;">setq</span> dispatch-dwim--precedings-followings nil
                         dispatch-dwim--overriding-method nil))))

<span style="font-weight: bold; font-style: italic;">;;; </span><span style="font-weight: bold; font-style: italic;">Classes &amp; Objects</span>

(<span style="font-weight: bold;">defclass</span> <span style="font-weight: bold; text-decoration: underline;">dispatch-shell-command</span> (transient-suffix)
  ((command-format <span style="font-weight: bold;">:initarg</span> <span style="font-weight: bold;">:command-format</span> <span style="font-weight: bold;">:initform</span> <span style="font-style: italic;">"%a"</span>)
   (command-format-spec <span style="font-weight: bold;">:initarg</span> <span style="font-weight: bold;">:command-format-spec</span> <span style="font-weight: bold;">:initform</span> nil)
   (dispatch-method <span style="font-weight: bold;">:initarg</span> <span style="font-weight: bold;">:dispatch-method</span>)))

(<span style="font-weight: bold;">cl-defmethod</span> <span style="font-weight: bold;">transient-init-value</span> ((obj dispatch-shell-command))
  (<span style="font-weight: bold;">unless</span> (slot-boundp obj <span style="font-weight: bold;">:command-format</span>)
    (<span style="font-weight: bold;">oset</span> obj command-format <span style="font-style: italic;">"%a"</span>))
  (<span style="font-weight: bold;">oset</span> obj dispatch-method
        (<span style="font-weight: bold;">cond</span>
         ((<span style="font-weight: bold;">and</span> transient--stack
               dispatch-dwim--overriding-method))
         ((member major-mode '(minibuffer-mode eshell-mode))
          'insert)
         (t dispatch-dwim--default-method))))

(transient-define-suffix dispatch-dwim-execute ()
  <span style="font-weight: bold;">:class</span> dispatch-shell-command
  <span style="font-weight: bold;">:transient</span> 'transient--do-return
  <span style="font-weight: bold;">:key</span> <span style="font-style: italic;">"RET"</span> <span style="font-weight: bold;">:description</span> <span style="font-style: italic;">"execute"</span>
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">let*</span> ((cur-obj (transient-suffix-object))
         (command-format-spec (<span style="font-weight: bold;">and</span> (slot-boundp cur-obj <span style="font-weight: bold;">:command-format-spec</span>)
                                   (<span style="font-weight: bold;">oref</span> cur-obj command-format-spec)))
         (main-comm (format-spec
                     (replace-regexp-in-string
                      <span style="font-style: italic;">"\\\\</span><span style="font-weight: bold; font-style: italic;">\</span><span style="font-style: italic;">%"</span> <span style="font-style: italic;">"\\\\</span><span style="font-weight: bold; font-style: italic;">\</span><span style="font-style: italic;">%</span><span style="font-weight: bold; font-style: italic;">\</span><span style="font-style: italic;">%"</span> <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">avoid replacing "\%" in shell argument</span>
                      (eval (<span style="font-weight: bold;">oref</span> cur-obj command-format)))
                     (append
                      `((?a . ,(string-join (transient-get-value) <span style="font-style: italic;">" "</span>)))
                      (<span style="font-weight: bold;">when</span> command-format-spec
                        (mapcar (<span style="font-weight: bold;">lambda</span> (key-val) (cons (car key-val) (eval (cdr key-val))))
                                command-format-spec)))))
         (comm (mapconcat (<span style="font-weight: bold;">lambda</span> (elm)
                            (<span style="font-weight: bold;">when</span> (length&gt; (cadr elm) 0)
                              (concat (cadr elm) <span style="font-style: italic;">"; "</span>)))
                          (sort (append dispatch-dwim--precedings-followings
                                        `((<span style="font-style: italic;">"@"</span> ,main-comm 50)))
                                (<span style="font-weight: bold;">lambda</span> (a b) (&lt; (nth 2 a) (nth 2 b)))))))
    (apply (<span style="font-weight: bold;">oref</span> cur-obj dispatch-method)
           `(,(<span style="font-weight: bold;">if</span> transient--stack
                  main-comm comm)))
    (<span style="font-weight: bold;">unless</span> transient--stack
      (<span style="font-weight: bold;">setq</span> dispatch-dwim--precedings-followings nil))))

(<span style="font-weight: bold;">defclass</span> <span style="font-weight: bold; text-decoration: underline;">dispatch-dwim-stack-suffix</span> (transient-suffix)
  ((prefix <span style="font-weight: bold;">:initarg</span> <span style="font-weight: bold;">:prefix</span>)
   (prefix-arg <span style="font-weight: bold;">:initarg</span> <span style="font-weight: bold;">:prefix-arg</span> <span style="font-weight: bold;">:initform</span> nil)
   (priority <span style="font-weight: bold;">:initarg</span> <span style="font-weight: bold;">:priority</span> <span style="font-weight: bold;">:initform</span> 0)
   (default <span style="font-weight: bold;">:initarg</span> <span style="font-weight: bold;">:default</span>)
   (format <span style="font-weight: bold;">:initform</span> <span style="font-style: italic;">" %k %d (%v)"</span>)))

(transient-define-suffix dispatch-dwim-fraction-command ()
  <span style="font-weight: bold;">:class</span> dispatch-dwim-stack-suffix
  <span style="font-weight: bold;">:transient</span> 'transient--do-recurse
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">let</span> ((cur-obj (transient-suffix-object)))
    (<span style="font-weight: bold;">setq</span> dispatch-dwim--overriding-method
          (<span style="font-weight: bold;">lambda</span> (shell-command)
            (<span style="font-weight: bold;">setf</span> (alist-get (<span style="font-weight: bold;">oref</span> cur-obj key) dispatch-dwim--precedings-followings)
                  (list shell-command
                        (<span style="font-weight: bold;">oref</span> cur-obj priority)))))
    (apply (<span style="font-weight: bold;">oref</span> cur-obj prefix)
           (<span style="font-weight: bold;">oref</span> cur-obj prefix-arg))))

(<span style="font-weight: bold;">cl-defmethod</span> <span style="font-weight: bold;">transient-init-value</span> ((obj dispatch-dwim-stack-suffix))
  (<span style="font-weight: bold;">when</span> (slot-boundp obj <span style="font-weight: bold;">:default</span>)
    (<span style="font-weight: bold;">setf</span> (alist-get (<span style="font-weight: bold;">oref</span> obj key) dispatch-dwim--precedings-followings)
          (list (<span style="font-weight: bold;">oref</span> obj default)
                (<span style="font-weight: bold;">oref</span> obj priority)))))

(<span style="font-weight: bold;">cl-defmethod</span> <span style="font-weight: bold;">transient-format-value</span> ((obj dispatch-dwim-stack-suffix))
  (<span style="font-weight: bold;">if-let</span> ((comm (assoc (<span style="font-weight: bold;">oref</span> obj key)
                        dispatch-dwim--precedings-followings)))
      (propertize (cadr comm)
                  'face 'transient-argument)
    <span style="font-style: italic;">""</span>))

(<span style="font-weight: bold;">cl-defmethod</span> <span style="font-weight: bold;">transient-format</span> ((obj dispatch-dwim-stack-suffix))
  (format-spec (<span style="font-weight: bold;">oref</span> obj format)
               `((?k . ,(transient-format-key obj))
                 (?d . ,(transient-format-description obj))
                 (?v . ,(transient-format-value obj)))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">dispatch-shell-command--key-vals</span> (keys)
  (mapconcat 'transient-infix-value
             (seq-filter (<span style="font-weight: bold;">lambda</span> (obj) (<span style="font-weight: bold;">and</span> (member (<span style="font-weight: bold;">oref</span> obj key) keys) obj))
                         (transient-suffixes (<span style="font-weight: bold;">oref</span> transient-current-prefix command)))
             <span style="font-style: italic;">" "</span>))

<span style="font-weight: bold; font-style: italic;">;;; </span><span style="font-weight: bold; font-style: italic;">Functions</span>

(<span style="font-weight: bold;">defmacro</span> <span style="font-weight: bold;">dispatch-dwim-determine-file-name</span> ()
  <span style="font-style: italic;">"Determine the available file name depending on the condition."</span>
  `(<span style="font-weight: bold;">cond</span>
    ((derived-mode-p 'dired-mode)
     (dired-get-marked-files))
    ((derived-mode-p 'minibuffer-mode)
     (<span style="font-weight: bold;">cond</span>
      ((equal minibuffer-history-variable 'dired-shell-command-history)
       <span style="font-style: italic;">" * "</span>)
      ((<span style="font-weight: bold;">or</span> (member minibuffer-history-variable
                   '(detached-shell-command-history
                     shell-command-history)))
       (<span style="font-weight: bold;">with-current-buffer</span> (other-buffer nil t)
         (<span style="font-weight: bold;">when</span> (derived-mode-p 'dired-mode)
           (dired-get-marked-files))))))
    (t (ffap-file-at-point))))

(<span style="font-weight: bold;">defmacro</span> <span style="font-weight: bold;">dispatch-dwim-determine-url</span> ()
  <span style="font-style: italic;">"Determine the URL for dispatch-dwim commands, respecting the conditions."</span>
  '(cond
    ((thing-at-point-url-at-point))
    ((derived-mode-p 'org-mode)
     (org-link-at-point-map #'car))
    ((derived-mode-p 'eww-mode)
     (<span style="font-weight: bold;">or</span> (shr-url-at-point nil)
         (plist-get eww-data <span style="font-weight: bold;">:url</span>)))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">dispatch-dwim-shell-argument</span> (arg)
  <span style="font-style: italic;">"Return a ARG's valid format for shell arguments."</span>
  (<span style="font-weight: bold;">pcase</span> arg
    ((<span style="font-weight: bold;">and</span> (pred (<span style="font-weight: bold;">lambda</span> (a) (member a `(<span style="font-style: italic;">" * "</span> <span style="font-style: italic;">"?"</span> <span style="font-style: italic;">"`?`"</span>)))) file-substitute)
     file-substitute)
    ((<span style="font-weight: bold;">and</span> (pred stringp) (pred file-exists-p) file)
     (shell-quote-argument (expand-file-name file)))
    ((<span style="font-weight: bold;">and</span> (pred stringp) (pred (string-match ffap-url-regexp)) url)
     (format <span style="font-style: italic;">"'</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">%s</span><span style="font-style: italic;">'"</span> url))
    ((<span style="font-weight: bold;">and</span> (pred listp) li) (mapconcat #'dispatch-dwim-shell-argument li <span style="font-style: italic;">" "</span>))))

(<span style="font-weight: bold;">provide</span> '<span style="font-weight: bold; text-decoration: underline;">dispatch-dwim</span>)
</pre>
</div>
</div>
</li>

<li><a id="org3f27c46"></a>Package: fingertip mode<br />
<div class="outline-text-5" id="text-org3f27c46">
<div class="org-src-container">
<pre class="src src-emacs-lisp" id="orgb14ca22"><span style="font-weight: bold; font-style: italic;">;;; </span><span style="font-weight: bold; font-style: italic;">fingertip.el --- one-handed buffer browsing -*- lexical-binding: t -*-</span>

<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Author: p-snow</span>
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Version: 0.0.1</span>
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Package-Requires: no</span>
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Homepage: homepage</span>
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Keywords: files</span>

<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">This file is not part of GNU Emacs</span>

<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">This program is free software: you can redistribute it and/or modify</span>
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">it under the terms of the GNU General Public License as published by</span>
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">the Free Software Foundation, either version 3 of the License, or</span>
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(at your option) any later version.</span>

<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">This program is distributed in the hope that it will be useful,</span>
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">GNU General Public License for more details.</span>

<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">You should have received a copy of the GNU General Public License</span>
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">along with this program.  If not, see <a href="https://www.gnu.org/licenses/">&lt;https://www.gnu.org/licenses/&gt;</a>.</span>

<span style="font-weight: bold; font-style: italic;">;;; </span><span style="font-weight: bold; font-style: italic;">Commentary:</span>

<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">commentary</span>

<span style="font-weight: bold; font-style: italic;">;;; </span><span style="font-weight: bold; font-style: italic;">Code:</span>

(<span style="font-weight: bold;">defgroup</span> <span style="font-weight: bold; text-decoration: underline;">fingertip</span> nil
  <span style="font-style: italic;">"Customization group for fingertip minor mode."</span>
  <span style="font-weight: bold;">:group</span> 'text)

(<span style="font-weight: bold;">defvar-keymap</span> fingertip-mode-map
  <span style="font-weight: bold;">:doc</span> <span style="font-style: italic;">"Keymap for `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">fingertip-mode</span><span style="font-style: italic;">'."</span>
  <span style="font-style: italic;">"f"</span> #'scroll-up-line
  <span style="font-style: italic;">"e"</span> #'scroll-down-line
  <span style="font-style: italic;">"SPC"</span> #'fingertip-forward-paragraph
  <span style="font-style: italic;">"E"</span> #'fingertip-backward-paragraph
  <span style="font-style: italic;">"&gt;"</span> #'fingertip-scroll-left-column
  <span style="font-style: italic;">"&lt;"</span> #'fingertip-scroll-right-column)

<span style="font-weight: bold; font-style: italic;">;;; </span><span style="font-weight: bold; font-style: italic;">Minor modes</span>
<span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">define-minor-mode</span> <span style="font-weight: bold;">fingertip-mode</span>
  <span style="font-style: italic;">"Buffer-local mode for one-handed file browsing."</span>
  <span style="font-weight: bold;">:init-value</span> nil
  <span style="font-weight: bold;">:global</span> nil
  <span style="font-weight: bold;">:lighter</span> <span style="font-style: italic;">" FGT"</span>
  <span style="font-weight: bold;">:keymap</span> fingertip-mode-map)

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">fingertip-forward-paragraph</span> ()
  (<span style="font-weight: bold;">interactive</span>)
  (forward-paragraph 2)
  (backward-paragraph 1)
  (forward-line 1)
  (recenter-top-bottom 0))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">fingertip-backward-paragraph</span> ()
  (<span style="font-weight: bold;">interactive</span>)
  (backward-paragraph 2)
  (forward-paragraph 1)
  (backward-paragraph 1)
  (forward-line 1)
  (recenter-top-bottom 0))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">fingertip-scroll-left-column</span> ()
  (<span style="font-weight: bold;">interactive</span>)
  (scroll-left 1))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">fingertip-scroll-right-column</span> ()
  (<span style="font-weight: bold;">interactive</span>)
  (scroll-right 1))

(<span style="font-weight: bold;">provide</span> '<span style="font-weight: bold; text-decoration: underline;">fingertip</span>)
<span style="font-weight: bold; font-style: italic;">;;; </span><span style="font-weight: bold; font-style: italic;">fingertip.el ends here</span>
</pre>
</div>
</div>
</li>
</ul>
</div>
</div>

<div id="outline-container-orgf3aca1f" class="outline-3">
<h3 id="orgf3aca1f">Findutils</h3>
<div class="outline-text-3" id="text-orgf3aca1f">
<p>
<a href="https://www.gnu.org/software/findutils/">GNU Findutils</a> offers following commands
</p>
<ul class="org-ul">
<li>find</li>
<li>locate</li>
<li>updatedb</li>
<li>xargs</li>
</ul>

<p>
'locate' is GNU implementation of mlocate. I prefer '<a href="#org739a68e">plocate</a>', which is fast than mlocate, for indexed file searching,
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"findutils"</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org739a68e" class="outline-3">
<h3 id="org739a68e">plocate</h3>
<div class="outline-text-3" id="text-org739a68e">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"plocate"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-sh" id="org07e0c5e"><span style="font-weight: bold;">echo</span> -n <span style="font-style: italic;">'&lt;&lt;share-dir()&gt;&gt;/plocate/plocate.db'</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-shell"><span style="font-weight: bold;">export</span> <span style="font-weight: bold; font-style: italic;">LOCATE_PATH</span>=&lt;&lt;plocate-db()&gt;&gt;
</pre>
</div>

<div class="org-src-container">
<pre class="src src-bash" id="orgfd5cf6b">$<span style="font-weight: bold; font-style: italic;">GUIX_EXTRA_PROFILES</span>/base/base/sbin/updatedb -l 0 -U &lt;&lt;home-dir()&gt;&gt; --prune-bind-mounts 0 <span style="font-style: italic;">\</span>
                                             -e &lt;&lt;htmlize-dir()&gt;&gt; <span style="font-style: italic;">\</span>
                                             -e &lt;&lt;trash-dir()&gt;&gt; <span style="font-style: italic;">\</span>
                                             -e &lt;&lt;data-dir()&gt;&gt; <span style="font-style: italic;">\</span>
                                             -o &lt;&lt;plocate-db()&gt;&gt;
</pre>
</div>

<div class="org-src-container">
<pre class="src src-conf">*/20 * * * * /usr/bin/bash -ci <span style="font-style: italic;">"updatedb-home"</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb678ff3" class="outline-3">
<h3 id="orgb678ff3">Git</h3>
<div class="outline-text-3" id="text-orgb678ff3">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"git"</span>
</pre>
</div>
</div>

<div id="outline-container-orge0a5284" class="outline-4">
<h4 id="orge0a5284">git ignore</h4>
<div class="outline-text-4" id="text-orge0a5284">
<div class="org-src-container">
<pre class="src src-conf"><span style="font-weight: bold; font-style: italic;">#</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">~/.gitignote</span>
<span style="font-weight: bold; font-style: italic;">#</span>
<span style="font-weight: bold; font-style: italic;">## </span><span style="font-weight: bold; font-style: italic;">Compiled object files ##</span>
*.slo
*.lo
*.o
*.obj

<span style="font-weight: bold; font-style: italic;">## </span><span style="font-weight: bold; font-style: italic;">Compiled Dynamic libraries ##</span>
*.so
*.dylib
*.dll

<span style="font-weight: bold; font-style: italic;">## </span><span style="font-weight: bold; font-style: italic;">Compiled Static libraries ##</span>
*.lai
*.la
*.a
*.lib

<span style="font-weight: bold; font-style: italic;">## </span><span style="font-weight: bold; font-style: italic;">Executables ##</span>
*.out
*.app

<span style="font-weight: bold; font-style: italic;">## </span><span style="font-weight: bold; font-style: italic;">Windows ##</span>
Thumbs.db
ehthumbs.db
Desktop.ini
$RECYCLE.BIN/
*.cab
*.msm
*.msp

<span style="font-weight: bold; font-style: italic;">## </span><span style="font-weight: bold; font-style: italic;">Mac ##</span>
.DS_Store
.AppleDouble
.LSOverride
.Spotlight-V100
.Trashes
._*

<span style="font-weight: bold; font-style: italic;">## </span><span style="font-weight: bold; font-style: italic;">Linux ##</span>
locate.db

<span style="font-weight: bold; font-style: italic;">## </span><span style="font-weight: bold; font-style: italic;">version control system ##</span>
.git/
.hg/
.svn/

<span style="font-weight: bold; font-style: italic;">## </span><span style="font-weight: bold; font-style: italic;">backup,log ##</span>
*~
~*
*.swp
.swp.*
*.tmp
*.bak
*.old
*.log
.cache/
*.autosave

<span style="font-weight: bold; font-style: italic;">## </span><span style="font-weight: bold; font-style: italic;">Emacs ##</span>
*.elc

<span style="font-weight: bold; font-style: italic;">## </span><span style="font-weight: bold; font-style: italic;">Vim ##</span>
*.un~
Session.vim
.netrwhist

<span style="font-weight: bold; font-style: italic;">## </span><span style="font-weight: bold; font-style: italic;">GNU GLOBAL ##</span>
GPATH
GRTAGS
GTAGS

<span style="font-weight: bold; font-style: italic;">## </span><span style="font-weight: bold; font-style: italic;">netbeans ##</span>
nbproject/
<span style="font-weight: bold; font-style: italic;">## </span><span style="font-weight: bold; font-style: italic;">intellij idea ##</span>
.idea/
<span style="font-weight: bold; font-style: italic;">## </span><span style="font-weight: bold; font-style: italic;">eclipse ##</span>
.settings/
.project
.classpath
.buildpath
<span style="font-weight: bold; font-style: italic;">## </span><span style="font-weight: bold; font-style: italic;">XCode ##</span>
*.xcodeproj/*

<span style="font-weight: bold; font-style: italic;">## </span><span style="font-weight: bold; font-style: italic;">Build dir ##</span>
build/
</pre>
</div>
</div>
</div>

<div id="outline-container-org12ab0cf" class="outline-4">
<h4 id="org12ab0cf">git config</h4>
<div class="outline-text-4" id="text-org12ab0cf">
<p>
<a href="https://magit.vc/manual/magit/How-to-show-diffs-for-gpg_002dencrypted-files_003f.html">This page</a> show you how to get diffs of gpg files in Magit.
</p>

<div class="org-src-container">
<pre class="src src-gitconfig">[core]
	excludesfile = &lt;&lt;home-dir()&gt;&gt;/.config/git/info/ignore
	attributesfile = &lt;&lt;home-dir()&gt;&gt;/.config/git/info/attributes
	editor = emacs
	symlinks = true
	# Unicode
	precomposeunicode = true
	quotepath = true
	autocrlf = false
[push]
	# simple,matching,upstream,current
	default = simple
[color]
	ui = auto
	status = auto
	diff = auto
	branch = auto
	interactive = auto
	grep = auto
[diff]
	patience = true
[diff "gpg"]
	textconv = gpg --no-tty --decrypt
[diff "common-lisp"]
	xfuncname="^\\((def\\S+\\s+\\S+)"
[diff "elisp"]
	xfuncname="^\\((((def\\S+)|use-package)\\s+\\S+)"
[diff "org"]
	xfuncname="^\\*+ +(.*)$"
[help]
	autocorrect = 0
[alias]
	co = checkout
	ca = commit -a -v
	ce = commit -v --amend
	st = status --branch --short
	si = status --ignored --short
	branches = branch -a
	remotes = remote -v
	tags = tag -l
	lg = log --graph --all --decorate --abbrev-commit --branches --date=short --pretty=format:\"%C(red)%h%C(reset) %C(green)[%ad]%C(reset) %s %C(cyan)@%an%C(reset) %C(yellow)%d%C(reset)\"
	fp = fetch --prune
	di = diff
	dh = diff --histogram
	dw = diff --word-diff
	dc = diff --cached
	wc = whatchanged
[user]
	email = 6841207+p-snow@users.noreply.github.com
	name = p-snow
	signingkey = BDAF62D24445EFD3
[commit]
	gpgsign = true
&lt;&lt;git-config&gt;&gt;
</pre>
</div>
</div>
</div>
<div id="outline-container-org420640f" class="outline-4">
<h4 id="org420640f">git attributes</h4>
<div class="outline-text-4" id="text-org420640f">
<div class="org-src-container">
<pre class="src src-gitattributes">*.c diff=cpp
*.h diff=cpp
*.cpp diff=cpp
*.hpp diff=cpp
*.cs diff=csharp
*.m diff=objc
*.java diff=java
*.html diff=html
*.xml diff=html
*.pl diff=perl
*.pm diff=perl
*.t diff=perl
*.php diff=php
*.ptml diff=php
*.py diff=python
*.rb diff=ruby
*.js diff=java
*.csv encoding=cp932
*.json diff=json
*.gpg filter=gpg diff=gpg
*.org diff=org
*.lisp diff=common-lisp
*.el diff=elisp
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orge3e92d6" class="outline-3">
<h3 id="orge3e92d6">pass-git-helper</h3>
<div class="outline-text-3" id="text-orge3e92d6">
<p>
<a href="https://github.com/languitar/pass-git-helper">pass-git-helper</a> is a utility program that allows users to use password-store's passwords for git credentials.
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"pass-git-helper"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-gitconfig">[credential]
	helper = !pass-git-helper -m &lt;&lt;home-dir()&gt;&gt;/.config/pass-git-helper/git-pass-mapping.ini $@
</pre>
</div>
</div>
</div>

<div id="outline-container-orged40449" class="outline-3">
<h3 id="orged40449">git-annex</h3>
<div class="outline-text-3" id="text-orged40449">
<p>
<a href="https://git-annex.branchable.com/git-annex/">git-annex</a> aims to manage large files based on git system. It is alse designed to manage copies of binary in distributed repositories. <a href="https://git-annex.branchable.com/walkthrough/">walkthrough</a> offers handy instruction.
</p>

<p>
<a href="https://git-lfs.github.com/">Git-LFS</a> is alse designed to manage large files. <a href="https://lwn.net/Articles/774125/">This article</a> compares Git-LFS and git-annex precisely.
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"git-annex"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-style: italic;">"https://git-annex.branchable.com/news/index.rss"</span> soft_update)
(<span style="font-style: italic;">"https://git-annex.branchable.com/devblog/index.rss"</span> soft_update)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-gitconfig">[annex]
	youtube-dl-command = yt-dlp
	synccontent = false
[annex.security]
	allowed-ip-addresses = all
[safe]
	directory = /mnt/ns01/doc
</pre>
</div>
</div>

<div id="outline-container-orgd6f27e2" class="outline-4">
<h4 id="orgd6f27e2">sync annex repos</h4>
<div class="outline-text-4" id="text-orgd6f27e2">
<div class="org-src-container">
<pre class="src src-conf">40 */4 * * * /usr/bin/bash -ci <span style="font-style: italic;">"sync-annex-doc 2&gt;&amp;1 | tee -a &lt;&lt;log-dir()&gt;&gt;/sync-git-annex.log"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-bash"><span style="font-weight: bold;">function</span> <span style="font-weight: bold;">sync_doc</span> {
  <span style="font-weight: bold;">if </span><span style="font-weight: bold;">cd</span> $<span style="font-weight: bold; font-style: italic;">1</span>; <span style="font-weight: bold;">then</span>
    <span style="font-weight: bold;">if</span> [ $<span style="font-weight: bold; font-style: italic;">2</span> -ne 0 ]; <span style="font-weight: bold;">then</span>
      (git rev-parse --is-inside-work-tree 2&gt;/dev/null &amp;&amp; git annex sync &amp;&amp; git annex get)
    <span style="font-weight: bold;">else</span>
      (git rev-parse --is-inside-work-tree 2&gt;/dev/null &amp;&amp; git annex sync)
    <span style="font-weight: bold;">fi</span>
  <span style="font-weight: bold;">fi</span>
}

sync_doc /mnt/exdoc/doc/ 1
sync_doc /mnt/vt-m/doc/ 1
sync_doc /mnt/vt-h/doc/ 1
sync_doc /mnt/vt-j/doc/ 1
sync_doc &lt;&lt;doc-dir()&gt;&gt; 0
<span style="font-weight: bold;">sync_doc /mnt/exdoc/doc/ 0</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org0815aa3" class="outline-3">
<h3 id="org0815aa3">ghq</h3>
<div class="outline-text-3" id="text-org0815aa3">
<p>
<a href="https://github.com/x-motemen/ghq">ghq</a> is management system for remote git repositories.
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"ghq"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-gitconfig">[ghq]
	root = &lt;&lt;ghq-root()&gt;&gt;
</pre>
</div>

<div class="org-src-container">
<pre class="src src-conf">[<span style="font-weight: bold; text-decoration: underline;">github.com*</span>]
<span style="font-weight: bold; font-style: italic;">username_extractor</span>=specific_line
<span style="font-weight: bold; font-style: italic;">line_username</span>=2
<span style="font-weight: bold; font-style: italic;">target</span>=github.com
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">username_extractor=entry_name</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-shell" id="org0cfdfcb">ghq list --full-path $<span style="font-weight: bold; font-style: italic;">name</span> | head -n 1 | sed <span style="font-style: italic;">"s:$HOME:~:"</span>
</pre>
</div>
</div>

<div id="outline-container-org16c8bbd" class="outline-4">
<h4 id="org16c8bbd">personal ghq environment</h4>
<div class="outline-text-4" id="text-org16c8bbd">
<div class="org-src-container">
<pre class="src src-sh" id="orgf186e44"><span style="font-weight: bold;">echo</span> -n <span style="font-style: italic;">'&lt;&lt;share-dir()&gt;&gt;/ghq'</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgf035fd3" class="outline-3">
<h3 id="orgf035fd3">Pass</h3>
<div class="outline-text-3" id="text-orgf035fd3">
<p>
<a href="https://www.passwordstore.org/">Pass</a> is a simple password manager.
</p>

<p>
I've chosen to use gpg/gpg-agent and pass on Ubuntu system since pass (password-store) spouts a warning saying there's gpg version mismatch persistently.
</p>
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">"password-store"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-conf">[<span style="font-weight: bold; text-decoration: underline;">github.com*</span>]
<span style="font-weight: bold; font-style: italic;">username_extractor</span>=specific_line
<span style="font-weight: bold; font-style: italic;">line_username</span>=2
<span style="font-weight: bold; font-style: italic;">target</span>=github.com
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">username_extractor=entry_name</span>
</pre>
</div>

<ul class="org-ul">
<li><p>
additional environment variables
</p>
<div class="org-src-container">
<pre class="src src-shell"><span style="font-weight: bold;">export</span> <span style="font-weight: bold; font-style: italic;">PASSWORD_STORE_CLIP_TIME</span>=25
</pre>
</div></li>
</ul>
</div>
</div>
<div id="outline-container-orga9c1a36" class="outline-3">
<h3 id="orga9c1a36">mpv</h3>
<div class="outline-text-3" id="text-orga9c1a36">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"mpv-libarchive"</span>
</pre>
</div>

<ul class="org-ul">
<li><p>
mpv.conf
</p>
<div class="org-src-container">
<pre class="src src-conf"><span style="font-weight: bold; font-style: italic;">##################</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">video settings #</span>
<span style="font-weight: bold; font-style: italic;">##################</span>

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Start in fullscreen mode by default.</span>
<span style="font-weight: bold; font-style: italic;">fs</span>=yes


<span style="font-weight: bold; font-style: italic;">###########</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">General #</span>
<span style="font-weight: bold; font-style: italic;">###########</span>

quiet
save-position-on-quit
no-border                               <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">no window title bar</span>
msg-module                              <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">prepend module name to log messages</span>
msg-color                               <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">color log messages on terminal</span>
term-osd-bar                            <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">display a progress bar on the terminal</span>
use-filedir-conf                        <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">look for additional config files in the directory of the opened file</span>
pause                                   <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">no autoplay</span>
<span style="font-weight: bold; font-style: italic;">force-window</span>=immediate
keep-open                               <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">keep the player open when a file's end is reached</span>
<span style="font-weight: bold; font-style: italic;">autofit-larger</span>=100%x95%                 <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">resize window in case it's larger than W%xH% of the screen</span>
cursor-autohide-fs-only                 <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">don't autohide the cursor in window mode, only fullscreen</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">input-media-keys=no                     # enable/disable OSX media keys</span>
<span style="font-weight: bold; font-style: italic;">cursor-autohide</span>=1000                    <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">autohide the curser after 1s</span>

<span style="font-weight: bold; font-style: italic;">screenshot-format</span>=png
<span style="font-weight: bold; font-style: italic;">screenshot-png-compression</span>=8
<span style="font-weight: bold; font-style: italic;">screenshot-template</span>=<span style="font-style: italic;">'~/Desktop/%F (%P) %n'</span>

<span style="font-weight: bold; font-style: italic;">hls-bitrate</span>=max                         <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">use max quality for HLS streams</span>


<span style="font-weight: bold; font-style: italic;">#########</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Cache #</span>
<span style="font-weight: bold; font-style: italic;">#########</span>

<span style="font-weight: bold; font-style: italic;">cache</span>=yes
<span style="font-weight: bold; font-style: italic;">cache-secs</span>=10                           <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">how many seconds of audio/video to prefetch if the cache is active</span>


<span style="font-weight: bold; font-style: italic;">#############</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">OSD / OSC #</span>
<span style="font-weight: bold; font-style: italic;">#############</span>

<span style="font-weight: bold; font-style: italic;">osd-level</span>=1                             <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">enable osd and display --osd-status-msg on interaction</span>
<span style="font-weight: bold; font-style: italic;">osd-duration</span>=2500                       <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">hide the osd after x ms</span>
<span style="font-weight: bold; font-style: italic;">osd-status-msg</span>=<span style="font-style: italic;">'${time-pos} / ${duration}${?percent-pos: (${percent-pos}%)}${?frame-drop-count:${!frame-drop-count==0: Dropped: ${frame-drop-count}}}\n${?chapter:Chapter: ${chapter}}'</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">osd-status-msg='${=time-pos}'         # show raw position</span>

<span style="font-weight: bold; font-style: italic;">osd-font</span>=<span style="font-style: italic;">'Source Sans Pro'</span>
<span style="font-weight: bold; font-style: italic;">osd-font-size</span>=96
<span style="font-weight: bold; font-style: italic;">osd-color</span>=<span style="font-style: italic;">'#CCFFFFFF'</span>                   <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">ARGB format</span>
<span style="font-weight: bold; font-style: italic;">osd-border-color</span>=<span style="font-style: italic;">'#DD322640'</span>            <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">ARGB format</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">osd-shadow-offset=1                    # pixel width for osd text and progress bar</span>
<span style="font-weight: bold; font-style: italic;">osd-bar-align-y</span>=0                       <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">progress bar y alignment (-1 top, 0 centered, 1 bottom)</span>
<span style="font-weight: bold; font-style: italic;">osd-border-size</span>=2                       <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">size for osd text and progress bar</span>
<span style="font-weight: bold; font-style: italic;">osd-bar-h</span>=2                             <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">height of osd bar as a fractional percentage of your screen height</span>
<span style="font-weight: bold; font-style: italic;">osd-bar-w</span>=60                            <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">width of " " "</span>


<span style="font-weight: bold; font-style: italic;">#############</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Subtitles #</span>
<span style="font-weight: bold; font-style: italic;">#############</span>

sub-use-margins
sub-ass-force-margins

demuxer-mkv-subtitle-preroll            <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">try to correctly show embedded subs when seeking</span>
<span style="font-weight: bold; font-style: italic;">sub-auto</span>=fuzzy                          <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">external subs don't have to match the file name exactly to autoload</span>
<span style="font-weight: bold; font-style: italic;">embeddedfonts</span>=yes                       <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">use embedded fonts for SSA/ASS subs</span>
<span style="font-weight: bold; font-style: italic;">sub-fix-timing</span>=no                       <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">do not try to fix gaps (which might make it worse in some cases)</span>
<span style="font-weight: bold; font-style: italic;">sub-ass-style-overrides</span>=Kerning=yes     <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">allows you to override style parameters of ASS scripts</span>

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">the following options only apply to subtitles without own styling (i.e. not ASS but e.g. SRT)</span>
<span style="font-weight: bold; font-style: italic;">sub-font</span>=<span style="font-style: italic;">"Source Sans Pro Semibold"</span>
<span style="font-weight: bold; font-style: italic;">sub-font-size</span>=36
<span style="font-weight: bold; font-style: italic;">sub-color</span>=<span style="font-style: italic;">"#FFFFFFFF"</span>
<span style="font-weight: bold; font-style: italic;">sub-border-color</span>=<span style="font-style: italic;">"#FF262626"</span>
<span style="font-weight: bold; font-style: italic;">sub-border-size</span>=3.2
<span style="font-weight: bold; font-style: italic;">sub-shadow-offset</span>=1
<span style="font-weight: bold; font-style: italic;">sub-shadow-color</span>=<span style="font-style: italic;">"#33000000"</span>
<span style="font-weight: bold; font-style: italic;">sub-spacing</span>=0.5


<span style="font-weight: bold; font-style: italic;">#############</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Languages #</span>
<span style="font-weight: bold; font-style: italic;">#############</span>

<span style="font-weight: bold; font-style: italic;">slang</span>=enm,en,eng,de,deu,ger             <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">automatically select these subtitles (decreasing priority)</span>
<span style="font-weight: bold; font-style: italic;">alang</span>=ja,jp,jpn,en,eng,de,deu,ger       <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">automatically select these audio tracks (decreasing priority)</span>

<span style="font-weight: bold; font-style: italic;">#########</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Image #</span>
<span style="font-weight: bold; font-style: italic;">#########</span>

<span style="font-weight: bold; font-style: italic;">image-display-duration</span>=4

<span style="font-weight: bold; font-style: italic;">#########</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Audio #</span>
<span style="font-weight: bold; font-style: italic;">#########</span>

<span style="font-weight: bold; font-style: italic;">audio-file-auto</span>=fuzzy                   <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">external audio doesn't has to match the file name exactly to autoload</span>
<span style="font-weight: bold; font-style: italic;">audio-pitch-correction</span>=yes              <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">automatically insert scaletempo when playing with higher speed</span>
<span style="font-weight: bold; font-style: italic;">volume-max</span>=200                          <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">maximum volume in %, everything above 100 results in amplification</span>
<span style="font-weight: bold; font-style: italic;">volume</span>=100                              <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">default volume, 100 = unchanged</span>


<span style="font-weight: bold; font-style: italic;">################</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Video Output #</span>
<span style="font-weight: bold; font-style: italic;">################</span>

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Active VOs (and some other options) are set conditionally</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">See here for more information: https://github.com/wm4/mpv-scripts/blob/master/auto-profiles.lua</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">The script was modified to import functions from scripts/auto-profiles-functions.lua</span>

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Defaults for all profiles</span>
<span style="font-weight: bold; font-style: italic;">tscale</span>=catmull_rom                      <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">sharp: oversample &lt;-&gt; linear (triangle) &lt;-&gt; catmull_rom &lt;-&gt; mitchell &lt;-&gt; gaussian &lt;-&gt; bicubic : smooth</span>
<span style="font-weight: bold; font-style: italic;">opengl-early-flush</span>=no
<span style="font-weight: bold; font-style: italic;">opengl-pbo</span>=yes


[<span style="font-weight: bold; text-decoration: underline;">high-quality</span>]
<span style="font-weight: bold; font-style: italic;">profile-desc</span>=cond:is_desktop() and get(<span style="font-style: italic;">'width'</span>, math.huge) &lt; 3840
<span style="font-weight: bold; font-style: italic;">scale</span>=ewa_lanczossharp
<span style="font-weight: bold; font-style: italic;">cscale</span>=ewa_lanczossoft
<span style="font-weight: bold; font-style: italic;">dscale</span>=mitchell
<span style="font-weight: bold; font-style: italic;">scale-antiring</span>=0.7
<span style="font-weight: bold; font-style: italic;">cscale-antiring</span>=0.7
<span style="font-weight: bold; font-style: italic;">dither-depth</span>=auto
<span style="font-weight: bold; font-style: italic;">correct-downscaling</span>=yes
<span style="font-weight: bold; font-style: italic;">sigmoid-upscaling</span>=yes
<span style="font-weight: bold; font-style: italic;">deband</span>=yes
<span style="font-weight: bold; font-style: italic;">hwdec</span>=no

[<span style="font-weight: bold; text-decoration: underline;">mid-quality</span>]
<span style="font-weight: bold; font-style: italic;">profile-desc</span>=cond:(is_laptop() and not on_battery() and get(<span style="font-style: italic;">'width'</span>, math.huge) &lt; 1920) or (is_desktop() and get(<span style="font-style: italic;">'width'</span>, math.huge) &gt;= 3840)
<span style="font-weight: bold; font-style: italic;">scale</span>=spline36
<span style="font-weight: bold; font-style: italic;">cscale</span>=bilinear
<span style="font-weight: bold; font-style: italic;">dscale</span>=mitchell
<span style="font-weight: bold; font-style: italic;">scale-antiring</span>=1.0
<span style="font-weight: bold; font-style: italic;">cscale-antiring</span>=1.0
<span style="font-weight: bold; font-style: italic;">dither-depth</span>=auto
<span style="font-weight: bold; font-style: italic;">correct-downscaling</span>=yes
<span style="font-weight: bold; font-style: italic;">sigmoid-upscaling</span>=yes
<span style="font-weight: bold; font-style: italic;">deband</span>=yes
<span style="font-weight: bold; font-style: italic;">hwdec</span>=no

[<span style="font-weight: bold; text-decoration: underline;">low-quality</span>]
<span style="font-weight: bold; font-style: italic;">profile-desc</span>=cond:is_laptop() and (on_battery() or get(<span style="font-style: italic;">'width'</span>, math.huge) &gt;= 1920)
<span style="font-weight: bold; font-style: italic;">scale</span>=bilinear
<span style="font-weight: bold; font-style: italic;">cscale</span>=bilinear
<span style="font-weight: bold; font-style: italic;">dscale</span>=bilinear
<span style="font-weight: bold; font-style: italic;">scale-antiring</span>=0.0
<span style="font-weight: bold; font-style: italic;">cscale-antiring</span>=0.0
<span style="font-weight: bold; font-style: italic;">dither-depth</span>=no
<span style="font-weight: bold; font-style: italic;">correct-downscaling</span>=no
<span style="font-weight: bold; font-style: italic;">sigmoid-upscaling</span>=no
<span style="font-weight: bold; font-style: italic;">deband</span>=no
<span style="font-weight: bold; font-style: italic;">hwdec</span>=auto

[<span style="font-weight: bold; text-decoration: underline;">60FPS</span>]
<span style="font-weight: bold; font-style: italic;">profile-desc</span>=cond:is_laptop() and get(<span style="font-style: italic;">'container-fps'</span>, 0) &gt;= 59
<span style="font-weight: bold; font-style: italic;">scale</span>=bilinear
<span style="font-weight: bold; font-style: italic;">cscale</span>=bilinear

[<span style="font-weight: bold; text-decoration: underline;">4K</span>]
<span style="font-weight: bold; font-style: italic;">profile-desc</span>=cond:get(<span style="font-style: italic;">'width'</span>, -math.huge) &gt;= 3840
<span style="font-weight: bold; font-style: italic;">vd-lavc-threads</span>=32

[<span style="font-weight: bold; text-decoration: underline;">4K-inverted</span>]
<span style="font-weight: bold; font-style: italic;">profile-desc</span>=cond:get(<span style="font-style: italic;">'width'</span>, -math.huge) &lt; 3840
<span style="font-weight: bold; font-style: italic;">vd-lavc-threads</span>=0


[<span style="font-weight: bold; text-decoration: underline;">default</span>]


<span style="font-weight: bold; font-style: italic;">###################################</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Protocol Specific Configuration #</span>
<span style="font-weight: bold; font-style: italic;">###################################</span>

[<span style="font-weight: bold; text-decoration: underline;">protocol.https</span>]
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">cache=yes</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">cache-default=500000                    # size in KB</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">cache-backbuffer=250000                 # size in KB</span>
<span style="font-weight: bold; font-style: italic;">cache-secs</span>=100                          <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">how many seconds of audio/video to prefetch</span>
<span style="font-weight: bold; font-style: italic;">user-agent</span>=<span style="font-style: italic;">'Mozilla/5.0 (Macintosh; Intel Mac OS X 10.11; rv:47.0) Gecko/20100101 Firefox/47.0'</span>

[<span style="font-weight: bold; text-decoration: underline;">protocol.http</span>]
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">cache=yes</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">cache-default=500000                    # size in KB</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">cache-backbuffer=250000                 # size in KB</span>
<span style="font-weight: bold; font-style: italic;">cache-secs</span>=100                          <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">how many seconds of audio/video to prefetch</span>
<span style="font-weight: bold; font-style: italic;">user-agent</span>=<span style="font-style: italic;">'Mozilla/5.0 (Macintosh; Intel Mac OS X 10.11; rv:47.0) Gecko/20100101 Firefox/47.0'</span>

[<span style="font-weight: bold; text-decoration: underline;">extension.gif</span>]
<span style="font-weight: bold; font-style: italic;">cache</span>=no
no-pause
<span style="font-weight: bold; font-style: italic;">loop-file</span>=yes

[<span style="font-weight: bold; text-decoration: underline;">extension.webm</span>]
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">cache=no</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">no-pause</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">loop-file=yes</span>
</pre>
</div></li>
<li><p>
input.conf
</p>
<div class="org-src-container">
<pre class="src src-conf"><span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">mpv keybindings</span>
<span style="font-weight: bold; font-style: italic;">#</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Location of user-defined bindings: ~/.config/mpv/input.conf</span>
<span style="font-weight: bold; font-style: italic;">#</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Lines starting with # are comments. Use SHARP to assign the # key.</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Copy this file and uncomment and edit the bindings you want to change.</span>
<span style="font-weight: bold; font-style: italic;">#</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">List of commands and further details: DOCS/man/input.rst</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">List of special keys: --input-keylist</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Keybindings testing mode: mpv --input-test --force-window --idle</span>
<span style="font-weight: bold; font-style: italic;">#</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Use 'ignore' to unbind a key fully (e.g. 'ctrl+a ignore').</span>
<span style="font-weight: bold; font-style: italic;">#</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Strings need to be quoted and escaped:</span>
<span style="font-weight: bold; font-style: italic;">#   </span><span style="font-weight: bold; font-style: italic;">KEY show-text "This is a single backslash: \\ and a quote: \" !"</span>
<span style="font-weight: bold; font-style: italic;">#</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">You can use modifier-key combinations like Shift+Left or Ctrl+Alt+x with</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">the modifiers Shift, Ctrl, Alt and Meta (may not work on the terminal).</span>
<span style="font-weight: bold; font-style: italic;">#</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">The default keybindings are hardcoded into the mpv binary.</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">You can disable them completely with: --no-input-default-bindings</span>

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Developer note:</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">On compilation, this file is baked into the mpv binary, and all lines are</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">uncommented (unless '#' is followed by a space) - thus this file defines the</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">default key bindings.</span>

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">If this is enabled, treat all the following bindings as default.</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">default-bindings start</span>

<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">MOUSE_BTN0 ignore                      # don't do anything</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">MOUSE_BTN0_DBL cycle fullscreen        # toggle fullscreen on/off</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">MOUSE_BTN2 cycle pause                 # toggle pause on/off</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">MOUSE_BTN3 seek 10</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">MOUSE_BTN4 seek -10</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">MOUSE_BTN5 add volume -2</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">MOUSE_BTN6 add volume 2</span>

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Mouse wheels, touchpad or other input devices that have axes</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">if the input devices supports precise scrolling it will also scale the</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">numeric value accordingly</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">AXIS_UP    seek 10</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">AXIS_DOWN  seek -10</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">AXIS_LEFT  seek 5</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">AXIS_RIGHT seek -5</span>

<span style="font-weight: bold; font-style: italic;">## </span><span style="font-weight: bold; font-style: italic;">Seek units are in seconds, but note that these are limited by keyframes</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">RIGHT seek  5</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">LEFT  seek -5</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">UP    seek  60</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">DOWN  seek -60</span>
RIGHT  seek  5
LEFT   seek -5
UP     seek -60
DOWN   seek  60
Ctrl+f seek  3
Ctrl+b seek -3
Ctrl+p seek -60
Ctrl+n seek  60
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Do smaller, always exact (non-keyframe-limited), seeks with shift.</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Don't show them on the OSD (no-osd).</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">Shift+RIGHT no-osd seek  1 exact</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">Shift+LEFT  no-osd seek -1 exact</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">Shift+UP    no-osd seek  5 exact</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">Shift+DOWN  no-osd seek -5 exact</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Skip to previous/next subtitle (subject to some restrictions; see manpage)</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">Ctrl+LEFT   no-osd sub-seek -1</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">Ctrl+RIGHT  no-osd sub-seek  1</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">PGUP add chapter 1                     # skip to next chapter</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">PGDWN add chapter -1                   # skip to previous chapter</span>
PGUP add chapter -1                     <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">skip to next chapter</span>
PGDWN add chapter 1                     <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">skip to previous chapter</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">Shift+PGUP seek 600</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">Shift+PGDWN seek -600</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">[ multiply speed 0.9091                # scale playback speed</span>
( multiply speed 0.9091                <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">scale playback speed</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">] multiply speed 1.1</span>
) multiply speed 1.1
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">{ multiply speed 0.5</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">} multiply speed 2.0</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">BS set speed 1.0                       # reset speed to normal</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">q quit</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">Q quit-watch-later</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">q {encode} quit 4</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">ESC set fullscreen no</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">ESC {encode} quit 4</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">p cycle pause                          # toggle pause/playback mode</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">. frame-step                           # advance one frame and pause</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">, frame-back-step                      # go back by one frame and pause</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">SPACE cycle pause</span>
? playlist-shuffle                      <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">skip to random file</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">&gt; playlist-next                        # skip to next file</span>
ENTER playlist-next                     <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">skip to next file</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">&lt; playlist-prev                        # skip to previous file</span>
Shift+ENTER playlist-prev               <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">skip to next file</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">O no-osd cycle-values osd-level 3 1    # cycle through OSD mode</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">o show-progress</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">P show-progress</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">I show-text "${filename}"              # display filename in osd</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">z add sub-delay -0.1                   # subtract 100 ms delay from subs</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">x add sub-delay +0.1                   # add</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">ctrl++ add audio-delay 0.100           # this changes audio/video sync</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">ctrl+- add audio-delay -0.100</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">9 add volume -2</span>
g add volume -2
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">/ add volume -2</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">0 add volume 2</span>
h add volume 2
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">* add volume 2</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">m cycle mute</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">1 add contrast -1</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">2 add contrast 1</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">3 add brightness -1</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">4 add brightness 1</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">5 add gamma -1</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">6 add gamma 1</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">7 add saturation -1</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">8 add saturation 1</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">Alt+0 set window-scale 0.5</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">Alt+1 set window-scale 1.0</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">Alt+2 set window-scale 2.0</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">toggle deinterlacer (automatically inserts or removes required filter)</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">d cycle deinterlace</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">r add sub-pos -1                       # move subtitles up</span>
r cycle_values video-rotate 90 180 270 0
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">t add sub-pos +1                       #                down</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">v cycle sub-visibility</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">stretch SSA/ASS subtitles with anamorphic videos to match historical</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">V cycle sub-ass-vsfilter-aspect-compat</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">switch between applying no style overrides to SSA/ASS subtitles, and</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">overriding them almost completely with the normal subtitle style</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">u cycle-values sub-ass-style-override "force" "no"</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">j cycle sub                            # cycle through subtitles</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">J cycle sub down                       # ...backwards</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">SHARP cycle audio                      # switch audio streams</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">_ cycle video</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">T cycle ontop                          # toggle video window ontop of other windows</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">f cycle fullscreen                     # toggle fullscreen</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">s async screenshot                     # take a screenshot</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">S async screenshot video               # ...without subtitles</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">Ctrl+s async screenshot window         # ...with subtitles and OSD, and scaled</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">Alt+s screenshot each-frame            # automatically screenshot every frame</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">w add panscan -0.1                     # zoom out with -panscan 0 -fs</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">e add panscan +0.1                     #      in</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">cycle video aspect ratios; "-1" is the container aspect</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">A cycle-values video-aspect "16:9" "4:3" "2.35:1" "-1"</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">POWER quit</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">PLAY cycle pause</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">PAUSE cycle pause</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">PLAYPAUSE cycle pause</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">STOP quit</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">FORWARD seek 60</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">REWIND seek -60</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">NEXT playlist-next</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">PREV playlist-prev</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">VOLUME_UP add volume 2</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">VOLUME_DOWN add volume -2</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">MUTE cycle mute</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">CLOSE_WIN quit</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">CLOSE_WIN {encode} quit 4</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">E cycle edition                        # next edition</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">l ab-loop                              # Set/clear A-B loop points</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">L cycle-values loop-file "inf" "no"    # toggle infinite looping</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">ctrl+c quit 4</span>

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Apple Remote section</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">AR_PLAY cycle pause</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">AR_PLAY_HOLD quit</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">AR_CENTER cycle pause</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">AR_CENTER_HOLD quit</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">AR_NEXT seek 10</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">AR_NEXT_HOLD seek 120</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">AR_PREV seek -10</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">AR_PREV_HOLD seek -120</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">AR_MENU show-progress</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">AR_MENU_HOLD cycle mute</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">AR_VUP add volume 2</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">AR_VUP_HOLD add chapter 1</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">AR_VDOWN add volume -2</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">AR_VDOWN_HOLD add chapter -1</span>

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">For tv://</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">h cycle tv-channel -1                  # previous channel</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">k cycle tv-channel +1                  # next channel</span>

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">For dvb://</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">H cycle dvb-channel-name -1            # previous channel</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">K cycle dvb-channel-name +1            # next channel</span>

<span style="font-weight: bold; font-style: italic;">#</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Legacy bindings (may or may not be removed in the future)</span>
<span style="font-weight: bold; font-style: italic;">#</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">! add chapter -1                       # skip to previous chapter</span>
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">@ add chapter 1                        #         next</span>

<span style="font-weight: bold; font-style: italic;">#</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Not assigned by default</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">(not an exhaustive list of unbound commands)</span>
<span style="font-weight: bold; font-style: italic;">#</span>

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">? add sub-scale +0.1                  # increase subtitle font size</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">? add sub-scale -0.1                  # decrease subtitle font size</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">? sub-step -1                         # immediately display next subtitle</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">? sub-step +1                         #                     previous</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">? cycle angle                         # switch DVD/Bluray angle</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">? add balance -0.1                    # adjust audio balance in favor of left</span>
Z add balance -0.1                    <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">adjust audio balance in favor of left</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">? add balance 0.1                     #                                  right</span>
X add balance 0.1                     <span style="font-weight: bold; font-style: italic;">#                                  </span><span style="font-weight: bold; font-style: italic;">right</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">? cycle sub-forced-only               # toggle DVD forced subs</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">? cycle program                       # cycle transport stream programs</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">? stop                                # stop playback (quit or enter idle mode)</span>
</pre>
</div></li>
<li><p>
scripts
</p>
<div class="org-src-container">
<pre class="src src-lua">local utils = require "mp.utils"

del_list = {}

function contains_item(l, i)
   for k, v in pairs(l) do
      if v == i then
         mp.osd_message("undeleting current file")
         l[k] = nil
         return true
      end
   end
   mp.osd_message("deleting current file")
   return false
end

function mark_delete()
   local work_dir = mp.get_property_native("working-directory")
   local file_path = mp.get_property_native("path")
   local s = file_path:find(work_dir, 0, true)
   local final_path
   if s and s == 0 then
      final_path = file_path
   else
      final_path = utils.join_path(work_dir, file_path)
   end
   if not contains_item(del_list, final_path) then
      table.insert(del_list, final_path)
   end
end

function delete(e)
   if e.reason == "quit" then
      for i, v in pairs(del_list) do
         print("deleting: "..v)
         os.remove(v)
      end
   end
end

mp.add_key_binding("ctrl+DEL", "delete_file", mark_delete)
mp.register_event("end-file", delete)
</pre>
</div></li>
</ul>
</div>
</div>

<div id="outline-container-org0effe0a" class="outline-3">
<h3 id="org0effe0a">unison</h3>
<div class="outline-text-3" id="text-org0effe0a">
<ul class="org-ul">
<li><p>
music directory syncing
</p>
<div class="org-src-container">
<pre class="src src-conf"><span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Roots of the synchronization</span>
<span style="font-weight: bold; font-style: italic;">root</span> = &lt;&lt;home-dir()&gt;&gt;/mnt/ruizu/Music
<span style="font-weight: bold; font-style: italic;">root</span> = &lt;&lt;home-dir()&gt;&gt;/Audio

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Paths to synchronize</span>
<span style="font-weight: bold; font-style: italic;">path</span> = .

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Ruizu's file system is FAT</span>
<span style="font-weight: bold; font-style: italic;">fat</span> = true

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Overwrite by newer file on confliction</span>
<span style="font-weight: bold; font-style: italic;">prefer</span> = newer

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Show nothing</span>
<span style="font-weight: bold; font-style: italic;">silent</span> = true
<span style="font-weight: bold; font-style: italic;">confirmbigdel</span> = false

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Do fast checking</span>
<span style="font-weight: bold; font-style: italic;">fastcheck</span> = true

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Log settings</span>
<span style="font-weight: bold; font-style: italic;">log</span> = true
<span style="font-weight: bold; font-style: italic;">logfile</span> = &lt;&lt;home-dir()&gt;&gt;/.local/state/log/log/unison/music.log

</pre>
</div></li>
<li><p>
doc directory backup
</p>
<div class="org-src-container">
<pre class="src src-conf"><span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Roots of the synchronization</span>
<span style="font-weight: bold; font-style: italic;">root</span> = &lt;&lt;home-dir()&gt;&gt;/mnt/ns01
<span style="font-weight: bold; font-style: italic;">root</span> = &lt;&lt;home-dir()&gt;&gt;

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Paths to synchronize</span>
<span style="font-weight: bold; font-style: italic;">path</span> = doc

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Overwrite by newer file on confliction</span>
<span style="font-weight: bold; font-style: italic;">prefer</span> = newer

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Use this command for displaying diffs</span>
<span style="font-weight: bold; font-style: italic;">diff</span> = diff -y -W 79 --suppress-common-lines

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Write down synchronization activity on log file rather than show in stdout</span>
<span style="font-weight: bold; font-style: italic;">auto</span> = true
<span style="font-weight: bold; font-style: italic;">confirmbigdel</span> = false
<span style="font-weight: bold; font-style: italic;">silent</span> = true
<span style="font-weight: bold; font-style: italic;">log</span> = true
<span style="font-weight: bold; font-style: italic;">logfile</span> = &lt;&lt;home-dir()&gt;&gt;/.local/state/log/unison/doc.log

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Use inode number to verify identity rather than ckeck whole byte sequence</span>
<span style="font-weight: bold; font-style: italic;">fastcheck</span> = true

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Abort if device is not mounted</span>
<span style="font-weight: bold; font-style: italic;">mountpoint</span> = doc
</pre>
</div></li>
</ul>
</div>
</div>
<div id="outline-container-org3f17d05" class="outline-3">
<h3 id="org3f17d05">Aspell</h3>
<div class="outline-text-3" id="text-org3f17d05">
<p>
aspell - interactive spell checker
</p>
<div class="org-src-container">
<pre class="src src-conf">lang en_US
</pre>
</div>
</div>
</div>
<div id="outline-container-org7e18628" class="outline-3">
<h3 id="org7e18628">textlint</h3>
<div class="outline-text-3" id="text-org7e18628">
<div class="org-src-container">
<pre class="src src-conf">install-textlint
</pre>
</div>

<div class="org-src-container">
<pre class="src src-shell">textlint @textlint/ast-node-types textlint-rule-preset-ja-spacing textlint-rule-preset-ja-technical-writing textlint-rule-spellcheck-tech-word textlint-rule-ginger textlint-rule-write-good textlint-rule-prh textlint-filter-rule-node-types textlint-plugin-org traverse
</pre>
</div>

<ul class="org-ul">
<li><p>
config for English
</p>
<div class="org-src-container">
<pre class="src src-json">{
  "rules": {
    "ginger": true,
    "write-good": true,
  }
}
</pre>
</div></li>

<li><p>
config for Japanese
</p>
<div class="org-src-container">
<pre class="src src-json">{
  "rules": {
    "preset-ja-technical-writing": {
      "no-exclamation-question-mark": false,
      "sentence-length": {
        "max": 200
      }
    },
    "spellcheck-tech-word": true,
    "textlint-rule-ginger": {
      "skipPatterns": [
        "`(.*)`"
      ]
    },
    "textlint-rule-write-good": true,
    "preset-ja-spacing": true
  }
}
</pre>
</div></li>
</ul>
</div>
</div>

<div id="outline-container-org6a2b7ed" class="outline-3">
<h3 id="org6a2b7ed">xkeysnail&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span></h3>
</div>

<div id="outline-container-org394485f" class="outline-3">
<h3 id="org394485f">SKK</h3>
<div class="outline-text-3" id="text-org394485f">
<p>
SKK is Simple Kana to Kanji conversion program, an input method of Japanese.
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"skk-jisyo"</span>
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">"skktools"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-shell" id="org569622d"><span style="font-weight: bold;">echo</span> -n <span style="font-style: italic;">'&lt;&lt;guix/ex-prof()&gt;&gt;/base/base/share/skk/'</span>
</pre>
</div>

<ul class="org-ul">
<li>TODO: following programs have no guix package.
It is better to write my own one for my reproducible system.
<ul class="org-ul">
<li class="on"><code>[X]</code> <a href="https://github.com/skk-dev/skktools">skktools</a></li>
<li class="off"><code>[&#xa0;]</code> ibus-skk</li>
</ul></li>
</ul>
</div>

<div id="outline-container-org27a2142" class="outline-4">
<h4 id="org27a2142">derive unique entries in user-jisyo&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span></h4>
</div>
</div>
<div id="outline-container-org292d28a" class="outline-3">
<h3 id="org292d28a">Festival</h3>
<div class="outline-text-3" id="text-org292d28a">
<p>
<a href="http://festvox.org/festival/">Festival</a> is a framework for building and manipulating speech synthesis engine.
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"festival"</span>
</pre>
</div>

<ul class="org-ul">
<li><p>
configuration
</p>
<div class="org-src-container">
<pre class="src src-scheme">(Parameter.set 'Audio_Required_Format 'aiff)
(Parameter.set 'Audio_Method 'Audio_Command)
(Parameter.set 'Audio_Command <span style="font-style: italic;">"paplay $FILE --client-name=Festival --stream-name=Speech"</span>)

<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">add SLT voice and use it as a default one</span>
(voice-location 'cmu_us_slt_cg
                (path-as-directory
                 (<span style="font-weight: bold;">let</span> ((path <span style="font-style: italic;">"~/.local/share/festival/lib/voices/us/cmu_us_slt_cg"</span>))
                   (<span style="font-weight: bold;">if</span> (string-equal (substring path 0 1) <span style="font-style: italic;">"~"</span>)
                       (string-append (getenv <span style="font-style: italic;">"HOME"</span>) (substring path 1 (length path)))
                       path)))
                <span style="font-style: italic;">"English American Female"</span>)
(set! voice_default voice_cmu_us_slt_cg)
</pre>
</div></li>
<li><p>
a script to download voices
</p>

<div class="org-src-container">
<pre class="src src-conf">download-festival-voices
</pre>
</div>

<div class="org-src-container">
<pre class="src src-bash"><span style="font-weight: bold; font-style: italic;">work_dir</span>=~/.local/share/festival
<span style="font-weight: bold; font-style: italic;">voices</span>=(
  cmu_us_aew_cg
  cmu_us_rxr_cg
  cmu_us_slt_cg
)

<span style="font-weight: bold;">if</span> [ ! -d <span style="font-style: italic;">"${work_dir}"</span> ]; <span style="font-weight: bold;">then</span>
  mkdir -p <span style="font-style: italic;">"${work_dir}"</span>
<span style="font-weight: bold;">fi</span>

<span style="font-weight: bold;">cd</span> <span style="font-style: italic;">"${work_dir}"</span>
<span style="font-weight: bold;">for</span> voice<span style="font-weight: bold;"> in</span> <span style="font-style: italic;">"${voices[@]}"</span>; <span style="font-weight: bold;">do</span>
  <span style="font-weight: bold; font-style: italic;">voice_pack_file</span>=festvox_${<span style="font-weight: bold; font-style: italic;">voice</span>}.tar.gz
  <span style="font-weight: bold;">if</span> [ ! -e ${<span style="font-weight: bold; font-style: italic;">voice_pack_file</span>} ]; <span style="font-weight: bold;">then</span>
    wget -c http://festvox.org/packed/festival/2.5/voices/${<span style="font-weight: bold; font-style: italic;">voice_pack_file</span>}
    tar zxf <span style="font-style: italic;">"${voice_pack_file}"</span> -C ../../share
  <span style="font-weight: bold;">fi</span>
<span style="font-weight: bold;">done</span>

<span style="font-weight: bold;">echo</span> <span style="font-style: italic;">"${work_dir}"</span>
</pre>
</div></li>
<li><p>
festival.el
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> festival
  <span style="font-weight: bold;">:defer</span> t
  <span style="font-weight: bold;">:config</span>
  (say-minor-mode 1)
  (<span style="font-weight: bold;">setq</span> festival-tmp-file (make-temp-file <span style="font-style: italic;">"festival-"</span>)))
</pre>
</div></li>
</ul>
</div>
</div>

<div id="outline-container-orgccd8442" class="outline-3">
<h3 id="orgccd8442">Open JTalk</h3>
<div class="outline-text-3" id="text-orgccd8442">
<div class="org-src-container">
<pre class="src src-emacs-lisp" id="org1106be4">(file-name-concat <span style="font-style: italic;">"&lt;&lt;share-dir()&gt;&gt;"</span> <span style="font-style: italic;">"hts-voice"</span>)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-shell">&lt;&lt;hts-voice-dir()&gt;&gt;
</pre>
</div>

<ul class="org-ul">
<li><p>
install on Ubuntu
</p>
<div class="org-src-container">
<pre class="src src-shell">open-jtalk open-jtalk-mecab-naist-jdic hts-voice-nitech-jp-atr503-m001
</pre>
</div></li>
<li><p>
download hts voices
</p>

<div class="org-src-container">
<pre class="src src-conf">download-hts-voices
</pre>
</div>

<div class="org-src-container">
<pre class="src src-bash"><span style="font-weight: bold; font-style: italic;">data_dir</span>=&lt;&lt;hts-voice-dir()&gt;&gt;
<span style="font-weight: bold;">hts_workdir=/tmp</span>
<span style="font-weight: bold;">hts_fname=MMDAgent_Example-1.8.zip</span>

<span style="font-weight: bold;">if [ ! -d "${data_dir}" ]; then</span>
<span style="font-weight: bold;">  mkdir -p "${data_dir}"</span>
<span style="font-weight: bold;">fi</span>

<span style="font-weight: bold;">cd "${hts_workdir}" \</span>
<span style="font-weight: bold;">  &amp;&amp; curl -sLO http://sourceforge.net/projects/mmdagent/files/MMDAgent_Example/${hts_fname%.zip}/${hts_fname} \</span>
<span style="font-weight: bold;">  &amp;&amp; unzip -o -d ${data_dir} ${hts_fname} \</span>
<span style="font-weight: bold;">  &amp;&amp; ln -sfv ${data_dir}/${hts_fname%.zip}/Voice ${data_dir}/</span>
</pre>
</div></li>
</ul>
</div>
</div>

<div id="outline-container-orgb5c8101" class="outline-3">
<h3 id="orgb5c8101">Jack&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span></h3>
</div>

<div id="outline-container-org428449a" class="outline-3">
<h3 id="org428449a">XRandR</h3>
<div class="outline-text-3" id="text-org428449a">
<p>
XRandR is a command line utility for changing display options without restarting X server.
</p>

<p>
<a href="https://wiki.archlinux.org/title/xrandr">xrandr - ArchWiki</a>
</p>

<ul class="org-ul">
<li><p>
show avaulable modes for all displays
</p>
<div class="org-src-container">
<pre class="src src-shell">xrandr
</pre>
</div></li>

<li><p>
change mode (resolution) to 1920x1080 for a display identified as "HDMI-2"
</p>
<div class="org-src-container">
<pre class="src src-shell">xrandr --output HDMI-2 --mode 1920x1080
</pre>
</div></li>

<li><p>
change mode back to preferred (maximum)
</p>
<div class="org-src-container">
<pre class="src src-shell">xrandr --output HDMI-2 --auto
</pre>
</div></li>
</ul>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"xrandr"</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-orgc25f4c1" class="outline-3">
<h3 id="orgc25f4c1">C/Migemo</h3>
<div class="outline-text-3" id="text-orgc25f4c1">
<p>
<a href="https://github.com/koron/cmigemo">C/Migemo</a> allows us to search Japanese with incremental ASCII charactor input.
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"cmigemo"</span>
<span style="font-style: italic;">"migemo-dict-azik"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-style: italic;">"https://github.com/koron/cmigemo/releases.atom"</span> soft_update)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-shell" id="orga5da5d4"><span style="font-weight: bold;">echo</span> -n <span style="font-style: italic;">'&lt;&lt;guix/ex-prof()&gt;&gt;/emacs/emacs/share/migemo/'</span>
</pre>
</div>
</div>

<div id="outline-container-orgd15d592" class="outline-4">
<h4 id="orgd15d592">C/Migemo in apt&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span></h4>
</div>

<div id="outline-container-org08ca172" class="outline-4">
<h4 id="org08ca172">AZIK-compliant C/Migemo&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span></h4>
</div>
</div>

<div id="outline-container-org4a22ddc" class="outline-3">
<h3 id="org4a22ddc">LilyPond</h3>
<div class="outline-text-3" id="text-org4a22ddc">
<p>
<a href="https://lilypond.org/unix.html">LilyPond</a> elisp package is included in source tarball available at <a href="https://lilypond.org/download/source">here</a>,
you are required to locate that package where emacs can search.
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"lilypond"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> lilypond-mode
  <span style="font-weight: bold;">:delight</span> (LilyPond-mode <span style="font-style: italic;">" LP"</span>)
  <span style="font-weight: bold;">:mode</span> (<span style="font-style: italic;">"\\.ly$"</span> . LilyPond-mode)
  <span style="font-weight: bold;">:custom</span>
  (LilyPond-pdf-command <span style="font-style: italic;">"firefox"</span>)
  (LilyPond-midi-command <span style="font-style: italic;">"fluidsynth -a alsa -m alsa_seq -l"</span>))
</pre>
</div>
</div>
</div>

<div id="outline-container-org188c75d" class="outline-3">
<h3 id="org188c75d">Graphviz</h3>
<div class="outline-text-3" id="text-org188c75d">
<p>
Documentation is available at <a href="https://graphviz.org/documentation/">here</a> and <a href="https://graphviz.org/gallery/">gallery</a> is also useful.
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"graphviz"</span>
<span style="font-style: italic;">"xdot"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"emacs-graphviz-dot-mode"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">use-package</span> graphviz-dot-mode
  <span style="font-weight: bold;">:after</span> eglot
  <span style="font-weight: bold;">:custom</span>
  (graphviz-dot-indent-width 2)
  <span style="font-weight: bold;">:config</span>
  (add-to-list 'eglot-server-programs
               '(graphviz-dot-mode <span style="font-style: italic;">"dot-language-server"</span> <span style="font-style: italic;">"--stdio"</span>)))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-shell">dot-language-server
</pre>
</div>
</div>
</div>

<div id="outline-container-org7e2606a" class="outline-3">
<h3 id="org7e2606a">Rsync</h3>
<div class="outline-text-3" id="text-org7e2606a">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"rsync"</span>
</pre>
</div>
</div>

<div id="outline-container-orge008dae" class="outline-4">
<h4 id="orge008dae">sync server data&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span></h4>
</div>

<div id="outline-container-orgf76b0d6" class="outline-4">
<h4 id="orgf76b0d6">backup script&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span></h4>
</div>
</div>
<div id="outline-container-orgdb158e9" class="outline-3">
<h3 id="orgdb158e9">libvirt</h3>
<div class="outline-text-3" id="text-orgdb158e9">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"libvirt"</span>
<span style="font-style: italic;">"virt-manager"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-shell">qemu-kvm libvirt-clients libvirt-daemon libvirt-daemon-system virtinst virt-manager virt-top bridge-utils
</pre>
</div>

<div class="org-src-container">
<pre class="src src-conf">systemctl enable libvirtd
systemctl start libvirtd
</pre>
</div>

<div class="org-src-container">
<pre class="src src-conf"><span style="font-weight: bold; font-style: italic;">uri_default</span> = <span style="font-style: italic;">"qemu:///system"</span>
</pre>
</div>

<ul class="org-ul">
<li><p>
how to set up local storage pool (named 'local')
</p>
<pre class="example">
$ virsh pool-define ~/.config/libvirt/pool.xml
$ virsh pool-autostart local
$ virsh pool-start local
</pre>


<div class="org-src-container">
<pre class="src src-xml">&lt;<span style="font-weight: bold;">pool</span> <span style="font-weight: bold; font-style: italic;">type</span>=<span style="font-style: italic;">'dir'</span>&gt;
  &lt;<span style="font-weight: bold;">name</span>&gt;local&lt;/<span style="font-weight: bold;">name</span>&gt;
  &lt;<span style="font-weight: bold;">source</span>&gt;
  &lt;/<span style="font-weight: bold;">source</span>&gt;
  &lt;<span style="font-weight: bold;">target</span>&gt;
    &lt;<span style="font-weight: bold;">path</span>&gt;/home/&lt;&lt;<span style="font-weight: bold;">login-name</span>()&gt;&gt;/&lt;&lt;<span style="font-weight: bold;">laptop-node</span>()&gt;&gt;/virt&lt;/<span style="font-weight: bold;">path</span>&gt;
    &lt;<span style="font-weight: bold;">permissions</span>&gt;
      &lt;<span style="font-weight: bold;">mode</span>&gt;0711&lt;/<span style="font-weight: bold;">mode</span>&gt;
      &lt;<span style="font-weight: bold;">owner</span>&gt;0&lt;/<span style="font-weight: bold;">owner</span>&gt;
      &lt;<span style="font-weight: bold;">group</span>&gt;0&lt;/<span style="font-weight: bold;">group</span>&gt;
    &lt;/<span style="font-weight: bold;">permissions</span>&gt;
  &lt;/<span style="font-weight: bold;">target</span>&gt;
&lt;/<span style="font-weight: bold;">pool</span>&gt;
</pre>
</div></li>
</ul>
</div>
</div>

<div id="outline-container-org956ba1e" class="outline-3">
<h3 id="org956ba1e">Calibre</h3>
<div class="outline-text-3" id="text-org956ba1e">
<p>
<a href="https://calibre-ebook.com/download_linux">Calibre for linux</a> is a e-book reader. I use it in the mood of reading epub in GUI app.
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"calibre"</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org4fcca14" class="outline-3">
<h3 id="org4fcca14">yt-dlp</h3>
<div class="outline-text-3" id="text-org4fcca14">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"yt-dlp"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-conf">--output %(title)s.%(ext)s
--trim-filenames 70
</pre>
</div>
</div>
</div>

<div id="outline-container-orgcebd626" class="outline-3">
<h3 id="orgcebd626">rTorrent&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span></h3>
</div>

<div id="outline-container-org54c24a0" class="outline-3">
<h3 id="org54c24a0">Ledger</h3>
<div class="outline-text-3" id="text-org54c24a0">
<p>
<a href="https://www.ledger-cli.org/3.0/doc/ledger-mode.html">Ledger</a> is double-entry accounting cli tool. <a href="https://hledger.org/">hledger</a> is feature rich reimplementation of ledger in Haskell. User data in ledger is interoperable for hledger and vice versa.
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"ledger"</span>
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">"hledger"</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd9c5acf" class="outline-3">
<h3 id="orgd9c5acf">ripgrep-all</h3>
<div class="outline-text-3" id="text-orgd9c5acf">
<p>
<a href="https://github.com/phiresky/ripgrep-all">ripgrep-all</a> or rga command enables to search media files such as pdf documents or epub files in grep-like way.
</p>

<div class="org-src-container">
<pre class="src src-shell"><span style="font-weight: bold; font-style: italic;">rga_url</span>=https://github.com/phiresky/ripgrep-all/releases/download/v0.9.6
<span style="font-weight: bold; font-style: italic;">rga_fname</span>=ripgrep_all-v0.9.6-x86_64-unknown-linux-musl.tar.gz
<span style="font-weight: bold; font-style: italic;">rga_workdir</span>=/tmp
<span style="font-weight: bold; font-style: italic;">rga_lbinpath</span>=&lt;&lt;home-dir()&gt;&gt;/.local/bin

<span style="font-weight: bold;">curl -sL "${rga_url}/${rga_fname}" | tar zxf - -C ${rga_workdir} \</span>
<span style="font-weight: bold;">  &amp;&amp; cp -fv ${rga_workdir}/${rga_fname%.tar.gz}/{rga,rga-preproc} ${rga_lbinpath}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org98a3372" class="outline-3">
<h3 id="org98a3372">Recoll</h3>
<div class="outline-text-3" id="text-org98a3372">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"recoll"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-shell">recollcmd
</pre>
</div>

<div class="org-src-container">
<pre class="src src-conf"><span style="font-weight: bold; font-style: italic;">topdirs</span> = &lt;&lt;doc-dir()&gt;&gt; ~/data

[<span style="font-weight: bold; text-decoration: underline;">&lt;&lt;doc-dir()&gt;&gt;</span>]
<span style="font-weight: bold; font-style: italic;">followLinks</span> = 1

<span style="font-weight: bold; font-style: italic;">skippedNames</span> = .git

<span style="font-weight: bold; font-style: italic;">skippedPaths</span> = &lt;&lt;share-dir()&gt;&gt;/emacs/open-file &lt;&lt;share-dir()&gt;&gt;/emacs/org-subtree-view

<span style="font-weight: bold; font-style: italic;">indexstemminglanguages</span> = english
</pre>
</div>
</div>

<div id="outline-container-org4e51fc7" class="outline-4">
<h4 id="org4e51fc7">systemd setting&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span></h4>
</div>
</div>

<div id="outline-container-orgfa615de" class="outline-3">
<h3 id="orgfa615de">Enchant</h3>
<div class="outline-text-3" id="text-orgfa615de">
<p>
<a href="https://abiword.github.io/enchant/src/enchant.html">ENCHANT</a> offers efficient spell checking mechanism by using checker in order.
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"enchant"</span>
<span style="font-style: italic;">"hunspell"</span>
<span style="font-style: italic;">"hunspell-dict-en"</span>
<span style="font-style: italic;">"hunspell-dict-en-us"</span>
<span style="font-style: italic;">"nuspell"</span>
<span style="font-style: italic;">"aspell"</span>
<span style="font-style: italic;">"aspell-dict-en"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-shell"><span style="font-weight: bold;">export</span> <span style="font-weight: bold; font-style: italic;">ENCHANT_CONFIG_DIR</span>=&lt;&lt;home-dir()&gt;&gt;/.config/enchant
</pre>
</div>

<div class="org-src-container">
<pre class="src src-conf">*:hunspell,nuspell,aspell
en:hunspell,nuspell,aspell
en_US:hunspell,nuspell,aspell
</pre>
</div>

<div class="org-src-container">
<pre class="src src-text">TempEL
</pre>
</div>
</div>
</div>

<div id="outline-container-org8c77f4d" class="outline-3">
<h3 id="org8c77f4d">Modern alternative command line tools</h3>
<div class="outline-text-3" id="text-org8c77f4d">
<p>
They are mostly written in Rust. <a href="https://github.com/mhoye/moderntools/">moderntools</a> offers updated info for this category.
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"bat"</span>
<span style="font-style: italic;">"du-dust"</span>
<span style="font-style: italic;">"eza"</span>
<span style="font-style: italic;">"fd"</span>
<span style="font-style: italic;">"zoxide"</span>
<span style="font-style: italic;">"just"</span>
<span style="font-style: italic;">"tmux"</span>
<span style="font-style: italic;">"moreutils"</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgdcae8b6" class="outline-3">
<h3 id="orgdcae8b6">Haunt</h3>
<div class="outline-text-3" id="text-orgdcae8b6">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"haunt"</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd5424f9" class="outline-3">
<h3 id="orgd5424f9">Wine</h3>
<div class="outline-text-3" id="text-orgd5424f9">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"wine64"</span>
<span style="font-style: italic;">"winetricks"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-shell"><span style="font-weight: bold;">export</span> <span style="font-weight: bold; font-style: italic;">WINEARCH</span>=win64
<span style="font-weight: bold;">export</span> <span style="font-weight: bold; font-style: italic;">WINEPREFIX</span>=~/.wine
</pre>
</div>
</div>
</div>

<div id="outline-container-orga6377ca" class="outline-3">
<h3 id="orga6377ca">Font Viewer</h3>
<div class="outline-text-3" id="text-orga6377ca">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"gnome-font-viewer"</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgcfac69f" class="outline-2">
<h2 id="orgcfac69f">Development Infrastructures</h2>
<div class="outline-text-2" id="text-orgcfac69f">
</div>

<div id="outline-container-org8cff5b4" class="outline-3">
<h3 id="org8cff5b4">C/C++</h3>
<div class="outline-text-3" id="text-org8cff5b4">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"tree-sitter-c"</span>
<span style="font-style: italic;">"tree-sitter-cpp"</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org7a1a6ee" class="outline-3">
<h3 id="org7a1a6ee">Python</h3>
<div class="outline-text-3" id="text-org7a1a6ee">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"python"</span>
<span style="font-style: italic;">"python-pip"</span>
<span style="font-style: italic;">"python-sphinx"</span>
<span style="font-style: italic;">"python-lxml"</span>
<span style="font-style: italic;">"python-lsp-server"</span>
<span style="font-style: italic;">"python-jedi"</span>
<span style="font-style: italic;">"python-send2trash"</span>
<span style="font-style: italic;">"python-matplotlib"</span>
<span style="font-style: italic;">"python-numpy"</span>
<span style="font-style: italic;">"python-pandas"</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org70a48ba" class="outline-3">
<h3 id="org70a48ba">Ruby</h3>
<div class="outline-text-3" id="text-org70a48ba">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"ruby"</span>
<span style="font-style: italic;">"ruby-pry"</span>
<span style="font-style: italic;">"ruby-rubocop"</span>
<span style="font-style: italic;">"ruby-thor"</span>
<span style="font-style: italic;">"tree-sitter-ruby"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-shell"><span style="font-weight: bold;">export</span> <span style="font-weight: bold; font-style: italic;">RUBYLIB</span>=${<span style="font-weight: bold; font-style: italic;">HOME</span>}/.local/lib

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">set path for ruby gems in local</span>
<span style="font-weight: bold;">if</span> which ruby &gt;/dev/null &amp;&amp; which gem &gt;/dev/null; <span style="font-weight: bold;">then</span>
  <span style="font-weight: bold; font-style: italic;">PATH</span>=<span style="font-style: italic;">"$(ruby -r rubygems -e 'puts Gem.user_dir')/bin:$PATH"</span>
<span style="font-weight: bold;">fi</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org8f3632a" class="outline-3">
<h3 id="org8f3632a">Lua</h3>
<div class="outline-text-3" id="text-org8f3632a">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"tree-sitter-lua"</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org98df55e" class="outline-3">
<h3 id="org98df55e">Common Lisp</h3>
<div class="outline-text-3" id="text-org98df55e">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"sbcl"</span>
<span style="font-style: italic;">"sbcl-slynk"</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgeeff7d2" class="outline-3">
<h3 id="orgeeff7d2">Node.js</h3>
<div class="outline-text-3" id="text-orgeeff7d2">
<div class="org-src-container">
<pre class="src src-shell" id="org5fd801c"><span style="font-weight: bold;">echo</span> -n <span style="font-style: italic;">'~/.npm-global'</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"node"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-shell"><span style="font-weight: bold; font-style: italic;">NODE_PATH</span>=<span style="font-style: italic;">"&lt;&lt;npm-prefix()&gt;&gt;/lib/node_modules:${NODE_PATH}"</span>
<span style="font-weight: bold; font-style: italic;">PATH</span>=<span style="font-style: italic;">"&lt;&lt;npm-prefix()&gt;&gt;/bin:${PATH}"</span>
<span style="font-weight: bold; font-style: italic;">MANPATH</span>=<span style="font-style: italic;">"&lt;&lt;npm-prefix()&gt;&gt;/share/man:${MANPATH}"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-shell"><span style="font-weight: bold; font-style: italic;">prefix</span>=&lt;&lt;npm-prefix()&gt;&gt;
</pre>
</div>

<ul class="org-ul">
<li><p>
make a directory for global npm packages
</p>
<div class="org-src-container">
<pre class="src src-shell">mkdir -pv &lt;&lt;npm-prefix()&gt;&gt;
</pre>
</div></li>
<li><p>
install npm packages
</p>
<div class="org-src-container">
<pre class="src src-shell">npm install -g &lt;&lt;npm-pkg&gt;&gt;
</pre>
</div></li>
</ul>
</div>
</div>

<div id="outline-container-org9c6d77a" class="outline-3">
<h3 id="org9c6d77a">asdf-vm&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span></h3>
</div>
<div id="outline-container-org0e2e280" class="outline-3">
<h3 id="org0e2e280">Language Servers</h3>
<div class="outline-text-3" id="text-org0e2e280">
</div>
<div id="outline-container-org52bcdb3" class="outline-4">
<h4 id="org52bcdb3">Bash Language Server</h4>
<div class="outline-text-4" id="text-org52bcdb3">
<p>
<a href="https://github.com/bash-lsp/bash-language-server">Bash Language Server</a>
</p>

<div class="org-src-container">
<pre class="src src-shell">bash-language-server
</pre>
</div>
</div>
</div>

<div id="outline-container-org3379817" class="outline-4">
<h4 id="org3379817">Solargraph</h4>
<div class="outline-text-4" id="text-org3379817">
<p>
<a href="https://github.com/castwide/solargraph">Solargraph</a> is Ruby Language Server.
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"ruby-solargraph"</span>
</pre>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-orgd1dae9a" class="outline-2">
<h2 id="orgd1dae9a">Stuffs for Dedicated Tasks</h2>
<div class="outline-text-2" id="text-orgd1dae9a">
</div>
<div id="outline-container-orgb09a6a8" class="outline-3">
<h3 id="orgb09a6a8">Batch Processing</h3>
<div class="outline-text-3" id="text-orgb09a6a8">
</div>

<div id="outline-container-org045abe8" class="outline-4">
<h4 id="org045abe8">Morning Batch</h4>
<div class="outline-text-4" id="text-org045abe8">
<div class="org-src-container">
<pre class="src src-bash" id="orgf32f37b">&lt;&lt;morning-batch&gt;&gt;
</pre>
</div>
</div>
</div>

<div id="outline-container-org2009efa" class="outline-4">
<h4 id="org2009efa">Midnight Batch</h4>
<div class="outline-text-4" id="text-org2009efa">
<div class="org-src-container">
<pre class="src src-bash">&lt;&lt;midnight-batch&gt;&gt;
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org8039a8e" class="outline-3">
<h3 id="org8039a8e">Transcode Video Files</h3>
<div class="outline-text-3" id="text-org8039a8e">
<p>
Transcoding my local video files with open codec, like VP9 and AV1, is effective for disc space usage.
</p>

<div class="org-src-container">
<pre class="src src-shell"><span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">!/usr/bin/</span><span style="font-weight: bold;">env</span><span style="font-weight: bold; font-style: italic;"> bash</span>
<span style="font-weight: bold;">set</span> -euo pipefail

<span style="font-weight: bold; font-style: italic;">CRF</span>=28
<span style="font-weight: bold; font-style: italic;">KBITRATE_AUDIO</span>=128

<span style="font-weight: bold;">function</span> <span style="font-weight: bold;">usage</span>() {
  cat &lt;&lt;_EOT_
<span style="font-weight: bold;">Usage:</span>
<span style="font-weight: bold;">  $(basename $0) [OPTIONS] &lt;video_in&gt; [&lt;video_out&gt;]</span>

<span style="font-weight: bold;">Description:</span>
<span style="font-weight: bold;">  $(basename $0) encodes &lt;video_in&gt; to &lt;video_out&gt; in specified codec.</span>

<span style="font-weight: bold;">Options:</span>
<span style="font-weight: bold;">  -c &lt;CRF&gt;      CRF value instead of ${CRF} (DEFAULT)</span>
<span style="font-weight: bold;">  -B &lt;AUDIO_BR&gt; Audio Bitrate in kbps</span>

<span style="font-weight: bold;">_EOT_</span>
}

<span style="font-weight: bold;">if</span> [ <span style="font-style: italic;">"${OPTIND}"</span> = 1 ]; <span style="font-weight: bold;">then</span>
  <span style="font-weight: bold;">while </span><span style="font-weight: bold;">getopts</span> c:B:h OPT
  <span style="font-weight: bold;">do</span>
    <span style="font-weight: bold;">case</span> ${<span style="font-weight: bold; font-style: italic;">OPT</span>} <span style="font-weight: bold;">in</span>
    c)
      <span style="font-weight: bold; font-style: italic;">CRF</span>=${<span style="font-weight: bold; font-style: italic;">OPTARG</span>}
      ;;
    B)
      <span style="font-weight: bold; font-style: italic;">CRF</span>=${<span style="font-weight: bold; font-style: italic;">OPTARG</span>}
      ;;
    h)
      usage
      ;;
    <span style="font-style: italic;">\?</span>)
      <span style="font-weight: bold;">echo</span> <span style="font-style: italic;">"Try to enter the h option."</span> 1&gt;&amp;2
      ;;
    <span style="font-weight: bold;">esac</span>
  <span style="font-weight: bold;">done</span>
<span style="font-weight: bold;">else</span>
  <span style="font-weight: bold;">echo</span> <span style="font-style: italic;">"No installed getopts-command."</span> 1&gt;&amp;2
  <span style="font-weight: bold;">exit</span> 1
<span style="font-weight: bold;">fi</span>

<span style="font-weight: bold;">shift</span> $((OPTIND - 1))

<span style="font-weight: bold;">if</span> [ $<span style="font-weight: bold; font-style: italic;">#</span> -lt 1 ] || [ $<span style="font-weight: bold; font-style: italic;">#</span> -gt 2 ]; <span style="font-weight: bold;">then</span>
  usage
  <span style="font-weight: bold;">exit</span> -1
<span style="font-weight: bold;">fi</span>

<span style="font-weight: bold; font-style: italic;">INPUT_VIDEO</span>=$<span style="font-weight: bold; font-style: italic;">1</span>
<span style="font-weight: bold;">if</span> [ ! -e <span style="font-style: italic;">"${INPUT_VIDEO}"</span> ]; <span style="font-weight: bold;">then</span>
  <span style="font-weight: bold;">echo</span> <span style="font-style: italic;">"${INPUT_VIDEO} does not exist."</span> 1&gt;&amp;2
  <span style="font-weight: bold;">exit</span> -1
<span style="font-weight: bold;">fi</span>

<span style="font-weight: bold;">if</span> [[ $<span style="font-weight: bold; font-style: italic;">#</span> -eq 2 ]]; <span style="font-weight: bold;">then</span>
  <span style="font-weight: bold; font-style: italic;">output_cand</span>=$<span style="font-weight: bold; font-style: italic;">2</span>
<span style="font-weight: bold;">else</span>
  <span style="font-weight: bold; font-style: italic;">output_cand</span>=$(basename <span style="font-style: italic;">"${INPUT_VIDEO}"</span>).webm
<span style="font-weight: bold;">fi</span>
<span style="font-weight: bold;">if</span> [ -e <span style="font-style: italic;">"${output_cand}"</span> ]; <span style="font-weight: bold;">then</span>
  <span style="font-weight: bold; font-style: italic;">OUTPUT_VIDEO</span>=${<span style="font-weight: bold; font-style: italic;">output_cand</span>%.*}_$(date +%Y%m%d_%H%M).webm
<span style="font-weight: bold;">else</span>
  <span style="font-weight: bold; font-style: italic;">OUTPUT_VIDEO</span>=<span style="font-style: italic;">"${output_cand}"</span>
<span style="font-weight: bold;">fi</span>

<span style="font-weight: bold; font-style: italic;">WORK_DIR</span>=<span style="font-style: italic;">"${INPUT_VIDEO%.*}"</span>
</pre>
</div>
</div>

<div id="outline-container-org3a9a091" class="outline-4">
<h4 id="org3a9a091">vp9 transcoding</h4>
<div class="outline-text-4" id="text-org3a9a091">
<ul class="org-ul">
<li><p>
transcode video to vp9
</p>
<pre class="example">
$ vp9transc -c 32 video_orig.mkv video_vp9.webm
</pre></li>
</ul>

<div class="org-src-container">
<pre class="src src-shell">&lt;&lt;transc-shared&gt;&gt;

<span style="font-weight: bold; font-style: italic;">vp9_opts_pass1</span>=<span style="font-style: italic;">"-c:v libvpx-vp9 -cpu-used 4 -threads 3 -row-mt 1 -speed 1 -b:v 0 -crf ${CRF} -pass 1 -an -f null"</span>
<span style="font-weight: bold; font-style: italic;">vp9_opts_pass2</span>=<span style="font-style: italic;">"-c:v libvpx-vp9 -cpu-used 4 -threads 3 -row-mt 1 -speed 1 -b:v 0 -crf ${CRF} -pass 2 -map_metadata 0"</span>
<span style="font-weight: bold; font-style: italic;">opus_opts</span>=<span style="font-style: italic;">"-c:a libopus -b:a ${KBITRATE_AUDIO}k -ac 2"</span>

mkdir -p <span style="font-style: italic;">"${WORK_DIR}"</span> &amp;&amp; <span style="font-weight: bold;">cd</span> <span style="font-style: italic;">"${WORK_DIR}"</span> <span style="font-style: italic;">\</span>
  &amp;&amp; ffmpeg -i <span style="font-style: italic;">"../${INPUT_VIDEO}"</span> ${<span style="font-weight: bold; font-style: italic;">vp9_opts_pass1</span>} /dev/null <span style="font-style: italic;">\</span>
  &amp;&amp; ffmpeg -i <span style="font-style: italic;">"../${INPUT_VIDEO}"</span> ${<span style="font-weight: bold; font-style: italic;">vp9_opts_pass2</span>} ${<span style="font-weight: bold; font-style: italic;">opus_opts</span>} <span style="font-style: italic;">"../${OUTPUT_VIDEO}"</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-orga6e2fb6" class="outline-4">
<h4 id="orga6e2fb6">av1 transcoding</h4>
<div class="outline-text-4" id="text-orga6e2fb6">
<ul class="org-ul">
<li><p>
transcode video to av1
</p>
<pre class="example">
$ av1transc video_orig.mkv video_av1.webm
</pre></li>
</ul>

<div class="org-src-container">
<pre class="src src-shell">&lt;&lt;transc-shared&gt;&gt;

<span style="font-weight: bold; font-style: italic;">av1_opts_common</span>=<span style="font-style: italic;">"-c:v libaom-av1 -cpu-used 2 -row-mt 1 -threads $(nproc) -b:v 0 -crf ${CRF}"</span>
<span style="font-weight: bold; font-style: italic;">av1_opts_pass1</span>=<span style="font-style: italic;">"${av1_opts_common} -pass 1 -an -f null"</span>
<span style="font-weight: bold; font-style: italic;">av1_opts_pass2</span>=<span style="font-style: italic;">"${av1_opts_common} -pass 2 -map_metadata 0"</span>
<span style="font-weight: bold; font-style: italic;">opus_opts</span>=<span style="font-style: italic;">"-c:a libopus -b:a ${KBITRATE_AUDIO}k -ac 2"</span>

mkdir -p <span style="font-style: italic;">"${WORK_DIR}"</span> &amp;&amp; <span style="font-weight: bold;">cd</span> <span style="font-style: italic;">"${WORK_DIR}"</span> <span style="font-style: italic;">\</span>
  &amp;&amp; ffmpeg -i <span style="font-style: italic;">"../${INPUT_VIDEO}"</span> ${<span style="font-weight: bold; font-style: italic;">av1_opts_pass1</span>} /dev/null <span style="font-style: italic;">\</span>
  &amp;&amp; ffmpeg -i <span style="font-style: italic;">"../${INPUT_VIDEO}"</span> ${<span style="font-weight: bold; font-style: italic;">av1_opts_pass2</span>} ${<span style="font-weight: bold; font-style: italic;">opus_opts</span>} <span style="font-style: italic;">"../${OUTPUT_VIDEO}"</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org75dab74" class="outline-3">
<h3 id="org75dab74">Transcode Audio Files&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span></h3>
</div>

<div id="outline-container-orgd3608e5" class="outline-3">
<h3 id="orgd3608e5">DVD Packing</h3>
<div class="outline-text-3" id="text-orgd3608e5">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"dvdbackup"</span>
<span style="font-style: italic;">"libdvdnav"</span>
<span style="font-style: italic;">"libdvdcss"</span>
<span style="font-style: italic;">"libdvdread"</span>
<span style="font-style: italic;">"handbrake"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-bash"><span style="font-weight: bold;">set</span> -euo pipefail

<span style="font-weight: bold;">if</span> [ <span style="font-style: italic;">"${OPTIND}"</span> = 1 ]; <span style="font-weight: bold;">then</span>
  <span style="font-weight: bold;">while </span><span style="font-weight: bold;">getopts</span> t: OPT
  <span style="font-weight: bold;">do</span>
    <span style="font-weight: bold;">case</span> ${<span style="font-weight: bold; font-style: italic;">OPT</span>} <span style="font-weight: bold;">in</span>
    t)
      <span style="font-weight: bold; font-style: italic;">TITLE</span>=${<span style="font-weight: bold; font-style: italic;">OPTARG</span>}
      ;;
    <span style="font-weight: bold;">esac</span>
  <span style="font-weight: bold;">done</span>
<span style="font-weight: bold;">else</span>
  <span style="font-weight: bold;">echo</span> <span style="font-style: italic;">"No installed getopts-command."</span> 1&gt;&amp;2
  <span style="font-weight: bold;">exit</span> 1
<span style="font-weight: bold;">fi</span>
<span style="font-weight: bold;">shift</span> $((OPTIND - 1))

<span style="font-weight: bold;">if</span> [[ $<span style="font-weight: bold; font-style: italic;">#</span> -ge 1 ]]; <span style="font-weight: bold;">then</span>
  <span style="font-weight: bold; font-style: italic;">DVD_DIR</span>=$<span style="font-weight: bold; font-style: italic;">1</span>
  <span style="font-weight: bold;">if</span> [[ $<span style="font-weight: bold; font-style: italic;">#</span> -eq 2 ]]; <span style="font-weight: bold;">then</span>
    <span style="font-weight: bold; font-style: italic;">DVD_PACK_VIDEO</span>=$<span style="font-weight: bold; font-style: italic;">2</span>
  <span style="font-weight: bold;">else</span>
    <span style="font-weight: bold; font-style: italic;">DVD_PACK_VIDEO</span>=$(basename <span style="font-style: italic;">"${DVD_DIR}"</span>).mkv
  <span style="font-weight: bold;">fi</span>
<span style="font-weight: bold;">fi</span>

<span style="font-weight: bold;">if</span> [ -v TITLE ]; <span style="font-weight: bold;">then</span>
  <span style="font-weight: bold; font-style: italic;">title_opt</span>=<span style="font-style: italic;">"--title ${TITLE}"</span>
<span style="font-weight: bold;">else</span>
  <span style="font-weight: bold; font-style: italic;">title_opt</span>=<span style="font-style: italic;">'--main-feature'</span>
<span style="font-weight: bold;">fi</span>

<span style="font-weight: bold; font-style: italic;">hb_opts</span>=<span style="font-style: italic;">"--x264-preset veryslow --quality 18 --aencoder copy ${title_opt} --markers --all-audio --all-subtitles"</span>

HandBrakeCLI --input <span style="font-style: italic;">"${DVD_DIR}"</span> --output <span style="font-style: italic;">"${DVD_PACK_VIDEO}"</span> ${<span style="font-weight: bold; font-style: italic;">hb_opts</span>}
</pre>
</div>
</div>
</div>
<div id="outline-container-org7be2ccd" class="outline-3">
<h3 id="org7be2ccd">CD Ripping</h3>
<div class="outline-text-3" id="text-org7be2ccd">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"abcde"</span>
<span style="font-style: italic;">"eyed3"</span>
<span style="font-style: italic;">"lame"</span>
<span style="font-style: italic;">"opus-tools"</span>
<span style="font-style: italic;">"cdrtools"</span>
<span style="font-style: italic;">"easytag"</span>
</pre>
</div>
</div>

<div id="outline-container-orgd3660c2" class="outline-4">
<h4 id="orgd3660c2">abcde</h4>
<div class="outline-text-4" id="text-orgd3660c2">
<div class="org-src-container">
<pre class="src src-conf"><span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">.flac is only desired output format</span>
<span style="font-weight: bold; font-style: italic;">OUTPUTTYPE</span>=<span style="font-style: italic;">"flac"</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">or .flac and .opus (bitrate is 256 kbps) will be generated at the same time</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">OUTPUTTYPE="flac,opus"</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">OPUSENCOPTS='--bitrate 256'</span>

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">.flac files will be utterly compressed with verification</span>
<span style="font-weight: bold; font-style: italic;">FLACOPTS</span>=<span style="font-style: italic;">"-V8"</span>

<span style="font-weight: bold; font-style: italic;">MAXPROCS</span>=4

<span style="font-weight: bold; font-style: italic;">OUTPUTFORMAT</span>=<span style="font-style: italic;">'${ARTISTFILE}/${ALBUMFILE}/${TRACKNUM}.${TRACKFILE}'</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgecf2be3" class="outline-3">
<h3 id="orgecf2be3">Tutorial Video Creation</h3>
<div class="outline-text-3" id="text-orgecf2be3">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"slop"</span>
<span style="font-style: italic;">"gimp"</span>
<span style="font-style: italic;">"obs"</span>
<span style="font-style: italic;">"kdenlive"</span>
<span style="font-style: italic;">"audacity"</span>
</pre>
</div>
</div>

<div id="outline-container-orgc8e4573" class="outline-4">
<h4 id="orgc8e4573">Screenkey</h4>
<div class="outline-text-4" id="text-orgc8e4573">
<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"python-screenkey"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-json">{
  "timeout": 0.8,
  "key_mode": "composed",
  "bak_mode": "normal",
  "mods_mode": "emacs",
  "opacity": 0.3,
  "screen": 0
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org2e9868f" class="outline-3">
<h3 id="org2e9868f">Sync Git Repos Automatically</h3>
<div class="outline-text-3" id="text-org2e9868f">
<div class="org-src-container">
<pre class="src src-conf">0 */2 * * * /usr/bin/bash -ci <span style="font-style: italic;">"ghq-sync &gt;&gt; $LOG_DIR/ghq-sync.log 2&gt;&amp;1"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-bash" id="org349662d"><span style="font-weight: bold;">function</span> <span style="font-weight: bold;">git-one-go</span> {
  local <span style="font-weight: bold; font-style: italic;">_branch</span>=$(git symbolic-ref -q HEAD | sed <span style="font-style: italic;">'s/refs\/heads\///'</span>)
  local <span style="font-weight: bold; font-style: italic;">_remote</span>=$(git config --get branch.$<span style="font-weight: bold; font-style: italic;">_branch</span>.pushRemote)
  local <span style="font-weight: bold; font-style: italic;">_commit_msg</span>=<span style="font-style: italic;">"auto-commit by $(whoami) on $(uname -n) at $(date +"%H:%M %b %d")"</span>

  <span style="font-weight: bold;">echo</span> -e <span style="font-style: italic;">"\nStarting git syncing at $(pwd)"</span>

  <span style="font-weight: bold;">if</span> [[ <span style="font-style: italic;">"true"</span> = <span style="font-style: italic;">"$(git config --get --bool branch.$_branch.sync)"</span> ]] ; <span style="font-weight: bold;">then</span>
    git add -u
    <span style="font-weight: bold;">if</span> [ -n <span style="font-style: italic;">"$(git status --porcelain)"</span> ]; <span style="font-weight: bold;">then</span>
      git commit --allow-empty -m <span style="font-style: italic;">"${_commit_msg}"</span>
    <span style="font-weight: bold;">fi</span>

    <span style="font-weight: bold;">if</span> [ -n <span style="font-style: italic;">"$(git log origin/main..HEAD)"</span> ]; <span style="font-weight: bold;">then</span>
      git push $<span style="font-weight: bold; font-style: italic;">_remote</span> $<span style="font-weight: bold; font-style: italic;">_branch</span>
      <span style="font-weight: bold;">if</span> [ $<span style="font-weight: bold; font-style: italic;">?</span> != 0 ]; <span style="font-weight: bold;">then</span>
        <span style="font-weight: bold;">echo</span> <span style="font-style: italic;">"ghq-sync: git push returned non-zero. Likely a connection failure."</span> &gt;&amp;2
        <span style="font-weight: bold;">exit</span> 1
      <span style="font-weight: bold;">fi</span>
    <span style="font-weight: bold;">else</span>
      <span style="font-weight: bold;">echo</span> <span style="font-style: italic;">"No unpushed commits found. Nothing to push."</span>
    <span style="font-weight: bold;">fi</span>
  <span style="font-weight: bold;">fi</span>
}

<span style="font-weight: bold; font-style: italic;">ghq_repos</span>=$(ghq list --full-path github.com/p-snow)
<span style="font-weight: bold;">for</span> repo_path<span style="font-weight: bold;"> in</span> ${<span style="font-weight: bold; font-style: italic;">ghq_repos</span>[@]}; <span style="font-weight: bold;">do</span>
  (<span style="font-weight: bold;">cd</span> ${<span style="font-weight: bold; font-style: italic;">repo_path</span>} &amp;&amp; git-one-go)
<span style="font-weight: bold;">done</span>
</pre>
</div>
</div>

<div id="outline-container-org5030d01" class="outline-4">
<h4 id="org5030d01">git-sync&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span></h4>
</div>
</div>

<div id="outline-container-org4a37107" class="outline-3">
<h3 id="org4a37107">Controlling Emacs from Desktop</h3>
<div class="outline-text-3" id="text-org4a37107">
<p>
Using the Emacs server capability, the following actions can be executed from a Linux desktop:
</p>
<ul class="org-ul">
<li>Download media files</li>
<li>Browse URLs in EWW</li>
</ul>

<div class="org-src-container">
<pre class="src src-bash" id="org5be5838"><span style="font-weight: bold; font-style: italic;">command</span>=$<span style="font-weight: bold; font-style: italic;">1</span>
<span style="font-weight: bold; font-style: italic;">opt</span>=$(xclip -out)

emacsclient -s server-&lt;&lt;hash-string(<span style="font-weight: bold; font-style: italic;">seed</span>=<span style="font-style: italic;">"server"</span>, <span style="font-weight: bold; font-style: italic;">len</span>=6)&gt;&gt; <span style="font-style: italic;">\</span>
            --eval <span style="font-style: italic;">"(my/emacs-batch \"${command}\" \"${opt}\")"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp" id="org365679a">(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my/emacs-batch</span> (command <span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> args)
  <span style="font-style: italic;">""</span>
  (<span style="font-weight: bold;">pcase</span> command
    (<span style="font-style: italic;">"download"</span>
     (yt-dlp-dispatch-dwim args)
     (dispatch-execute-macro))
    (<span style="font-style: italic;">"browse"</span>
     (eww args))))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org578ba65" class="outline-2">
<h2 id="org578ba65">Babel Utility Functions</h2>
<div class="outline-text-2" id="text-org578ba65">
</div>
<div id="outline-container-orgcb6fae1" class="outline-3">
<h3 id="orgcb6fae1">which path</h3>
<div class="outline-text-3" id="text-orgcb6fae1">
<p>
Return the absolute path for the 'filename' without expansion, allowing for user-agnostic configuration.
</p>

<div class="org-src-container">
<pre class="src src-bash" id="org5e310b0">which ${<span style="font-weight: bold; font-style: italic;">filename</span>} | sed <span style="font-style: italic;">"s:$HOME:~:"</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org2958cd4" class="outline-3">
<h3 id="org2958cd4">Generate hash string</h3>
<div class="outline-text-3" id="text-org2958cd4">
<p>
Return hash string from 'seed'. You can cull the output to desired length by 'len'.
</p>

<div class="org-src-container">
<pre class="src src-python" id="org77b9e5f"><span style="font-weight: bold;">import</span> hashlib

<span style="font-weight: bold; font-style: italic;">sha256_hash</span> = hashlib.sha256(seed.encode(<span style="font-style: italic;">"utf-8"</span>))
<span style="font-weight: bold;">return</span> sha256_hash.hexdigest()[:<span style="font-weight: bold;">len</span>]
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf637e04" class="outline-3">
<h3 id="orgf637e04">random number</h3>
<div class="outline-text-3" id="text-orgf637e04">
<p>
return random number between 0 and max
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp" id="orgd71e39e">(calc-eval (format <span style="font-style: italic;">"random(%d)"</span> (1+ max)))
</pre>
</div>
</div>
</div>

<div id="outline-container-orga3e91b9" class="outline-3">
<h3 id="orga3e91b9">Hours in seconds</h3>
<div class="outline-text-3" id="text-orga3e91b9">
<div class="org-src-container">
<pre class="src src-emacs-lisp" id="org8e57a02">(* h 60 60)
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org32e8bd9" class="outline-2">
<h2 id="org32e8bd9">Specialized Scripts</h2>
<div class="outline-text-2" id="text-org32e8bd9">
</div>

<div id="outline-container-org3d0688a" class="outline-3">
<h3 id="org3d0688a">Declutters&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span></h3>
</div>

<div id="outline-container-org9e67752" class="outline-3">
<h3 id="org9e67752">Database back-up scripts</h3>
<div class="outline-text-3" id="text-org9e67752">
<ul class="org-ul">
<li><p>
PostgreSQL
</p>
<div class="org-src-container">
<pre class="src src-bash"><span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">!/usr/bin/</span><span style="font-weight: bold;">env</span><span style="font-weight: bold; font-style: italic;"> bash</span>

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Usage: $ postgres_backup &lt;db_name&gt; &lt;backup_dir&gt;</span>

<span style="font-weight: bold; font-style: italic;">POSTGRES_DBNAME</span>=$<span style="font-weight: bold; font-style: italic;">1</span>
<span style="font-weight: bold; font-style: italic;">BACKUP_DIR</span>=$<span style="font-weight: bold; font-style: italic;">2</span>
<span style="font-weight: bold; font-style: italic;">DATE</span>=<span style="font-style: italic;">"$(date +%Y%m%d_%H%M)"</span>

pg_dump --format=custom ${<span style="font-weight: bold; font-style: italic;">POSTGRES_DBNAME</span>} &gt; ${<span style="font-weight: bold; font-style: italic;">BACKUP_DIR</span>}/${<span style="font-weight: bold; font-style: italic;">DATE</span>}_${<span style="font-weight: bold; font-style: italic;">POSTGRES_DBNAME</span>}.custom || <span style="font-weight: bold;">exit</span> 1

<span style="font-weight: bold;">exit</span> 0
</pre>
</div></li>

<li><p>
MySQL
</p>
<div class="org-src-container">
<pre class="src src-shell"><span style="font-weight: bold; font-style: italic;">BACKUP_DIR</span>=~/data/share/backups/mysql
<span style="font-weight: bold; font-style: italic;">RAW_SQL</span>=<span style="font-style: italic;">"$(date +%Y%m%d_%H%M)_backup.sql"</span>
<span style="font-weight: bold; font-style: italic;">TAR_SQL</span>=<span style="font-style: italic;">"${RAW_SQL}.txz"</span>

(
  <span style="font-weight: bold;">cd</span> <span style="font-style: italic;">"${BACKUP_DIR}"</span> || <span style="font-weight: bold;">exit</span> 1
  mysqldump --opt --all-databases --events --default-character-set=binary -u root &gt; <span style="font-style: italic;">"${RAW_SQL}"</span>
  tar cfJ <span style="font-style: italic;">"${TAR_SQL}"</span> <span style="font-style: italic;">"${RAW_SQL}"</span>
  rm -f <span style="font-style: italic;">"${RAW_SQL}"</span>
) || <span style="font-weight: bold;">exit</span> 1

<span style="font-weight: bold;">exit</span> 0
</pre>
</div></li>
</ul>
</div>
</div>

<div id="outline-container-orgf9e8a84" class="outline-3">
<h3 id="orgf9e8a84">filetype</h3>
<div class="outline-text-3" id="text-orgf9e8a84">
<p>
This program determine type of the file.
</p>

<div class="org-src-container">
<pre class="src src-ruby"><span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">!/usr/bin/env ruby</span>

<span style="font-weight: bold;">require</span> <span style="font-style: italic;">'pathname'</span>
<span style="font-weight: bold;">require</span> <span style="font-style: italic;">'uri'</span>
<span style="font-weight: bold;">require</span> <span style="font-style: italic;">'shellwords'</span>

<span style="font-weight: bold;">class</span> <span style="font-weight: bold; text-decoration: underline;">FileType</span>
  <span style="font-weight: bold; text-decoration: underline;">ZIP_PREFIXES</span> = [<span style="font-style: italic;">'Zip archive data'</span>]

  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">self</span>.<span style="font-weight: bold;">type</span>(filename, file_cmd_opt = <span style="font-style: italic;">""</span>)
    <span style="font-weight: bold;">if</span>  <span style="font-weight: bold; text-decoration: underline;">File</span>.exist?(filename)
      local_opt = <span style="font-style: italic;">""</span>
      <span style="font-weight: bold;">if</span> <span style="font-weight: bold; text-decoration: underline;">File</span>.symlink?(filename)
        local_opt += <span style="font-style: italic;">"--dereference"</span>
      <span style="font-weight: bold;">end</span>
      <span style="font-style: italic;">`file --brief </span><span style="font-weight: bold; font-style: italic;">#{file_cmd_opt}</span><span style="font-style: italic;"> </span><span style="font-weight: bold; font-style: italic;">#{local_opt}</span><span style="font-style: italic;"> </span><span style="font-weight: bold; font-style: italic;">#{Shellwords.shellescape(filename)}</span><span style="font-style: italic;">`</span>.strip
    <span style="font-weight: bold;">elsif</span> filename =~ <span style="font-style: italic;">/https?:\/\/www\.youtube\.com.*/</span>
      <span style="font-style: italic;">`yt-dlp -f worst -q </span><span style="font-weight: bold; font-style: italic;">#{Shellwords.shellescape(filename)}</span><span style="font-style: italic;"> -o - 2&gt;/dev/null | file --brief </span><span style="font-weight: bold; font-style: italic;">#{file_cmd_opt}</span><span style="font-style: italic;"> -`</span>.strip
    <span style="font-weight: bold;">elsif</span> filename =~ <span style="font-weight: bold; text-decoration: underline;">URI</span>::<span style="font-weight: bold; text-decoration: underline;">DEFAULT_PARSER</span>.make_regexp
      <span style="font-style: italic;">`curl --location --range 0-9999 </span><span style="font-weight: bold; font-style: italic;">#{Shellwords.shellescape(filename)}</span><span style="font-style: italic;"> 2&gt;/dev/null | file --brief </span><span style="font-weight: bold; font-style: italic;">#{file_cmd_opt}</span><span style="font-style: italic;"> -`</span>.strip
    <span style="font-weight: bold;">else</span>
      <span style="font-style: italic;">''</span>
    <span style="font-weight: bold;">end</span>
  <span style="font-weight: bold;">end</span>

  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">self</span>.<span style="font-weight: bold;">mime_type</span>(filename)
    type(filename, <span style="font-style: italic;">"--mime-type"</span>)
  <span style="font-weight: bold;">end</span>

  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">self</span>.<span style="font-weight: bold;">block_device?</span>(file)
    type(file).start_with?(<span style="font-style: italic;">'block special'</span>) &amp;&amp;
      mime_type(file) == <span style="font-style: italic;">'inode/blockdevice'</span>
  <span style="font-weight: bold;">end</span>

  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">self</span>.<span style="font-weight: bold;">iso9660?</span>(file)
    mime_type(file) == <span style="font-style: italic;">'application/x-iso9660-image'</span>
  <span style="font-weight: bold;">end</span>

  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">self</span>.<span style="font-weight: bold;">video_dvd_image?</span>(file)
    iso9660?(file) &amp;&amp; type(file).start_with?(<span style="font-style: italic;">'UDF filesystem data'</span>)
  <span style="font-weight: bold;">end</span>

  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">self</span>.<span style="font-weight: bold;">html?</span>(file)
    type(file).start_with?(<span style="font-style: italic;">"HTML document"</span>)
  <span style="font-weight: bold;">end</span>

  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">self</span>.<span style="font-weight: bold;">pdf?</span>(file)
    type(file).start_with?(<span style="font-style: italic;">"PDF document"</span>)
  <span style="font-weight: bold;">end</span>

  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">self</span>.<span style="font-weight: bold;">epub?</span>(file)
    type(file) == <span style="font-style: italic;">"EPUB document"</span>
  <span style="font-weight: bold;">end</span>

  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">self</span>.<span style="font-weight: bold;">mobi?</span>(file)
    type(file).start_with?(<span style="font-style: italic;">"Mobipocket E-book"</span>)
  <span style="font-weight: bold;">end</span>

  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">self</span>.<span style="font-weight: bold;">pgp?</span>(file)
    type(file).start_with?(<span style="font-style: italic;">"PGP"</span>)
  <span style="font-weight: bold;">end</span>

  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">self</span>.<span style="font-weight: bold;">tarpgp?</span>(file)
    pgp?(file) &amp;&amp; file.end_with?(<span style="font-style: italic;">'.tar.gpg'</span>)
  <span style="font-weight: bold;">end</span>

  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">self</span>.<span style="font-weight: bold;">zip?</span>(file)
    type(file).start_with?(*<span style="font-weight: bold; text-decoration: underline;">ZIP_PREFIXES</span>)
  <span style="font-weight: bold;">end</span>

  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">self</span>.<span style="font-weight: bold;">video?</span>(file)
    mime_type(file).start_with?(<span style="font-style: italic;">"video/"</span>)
  <span style="font-weight: bold;">end</span>

  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">self</span>.<span style="font-weight: bold;">audio?</span>(file)
    mime_type(file).start_with?(<span style="font-style: italic;">'audio/'</span>)
  <span style="font-weight: bold;">end</span>

  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">self</span>.<span style="font-weight: bold;">image?</span>(file)
    mime_type(file).start_with?(<span style="font-style: italic;">"image/"</span>)
  <span style="font-weight: bold;">end</span>

  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">self</span>.<span style="font-weight: bold;">playable?</span>(file)
    <span style="font-weight: bold;">if</span> <span style="font-weight: bold; text-decoration: underline;">File</span>.directory?(file)
      <span style="font-weight: bold; text-decoration: underline;">Dir</span>.foreach(file) <span style="font-weight: bold;">do</span> |fname|
        <span style="font-weight: bold;">next</span> <span style="font-weight: bold;">if</span> [<span style="font-style: italic;">"."</span>, <span style="font-style: italic;">".."</span>].include?(fname)
        <span style="font-weight: bold;">return</span> <span style="font-weight: bold; text-decoration: underline;">false</span> <span style="font-weight: bold;">unless</span> playable?(<span style="font-style: italic;">"</span><span style="font-weight: bold; font-style: italic;">#{file}</span><span style="font-style: italic;">/</span><span style="font-weight: bold; font-style: italic;">#{fname}</span><span style="font-style: italic;">"</span>)
      <span style="font-weight: bold;">end</span>
      <span style="font-weight: bold; text-decoration: underline;">true</span>
    <span style="font-weight: bold;">elsif</span> file =~ <span style="font-style: italic;">/https?:\/\/www\.youtube\.com.*/</span>
      <span style="font-weight: bold; text-decoration: underline;">true</span>
    <span style="font-weight: bold;">else</span>
      type(file).start_with?(<span style="font-style: italic;">"ISO Media"</span>, <span style="font-style: italic;">"Audio file"</span>) ||
        mime_type(file).start_with?(<span style="font-style: italic;">"video"</span>, <span style="font-style: italic;">"audio"</span>, <span style="font-style: italic;">"image"</span>)
    <span style="font-weight: bold;">end</span>
  <span style="font-weight: bold;">end</span>

  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">self</span>.<span style="font-weight: bold;">dvd_dir?</span>(file)
    <span style="font-weight: bold; text-decoration: underline;">false</span> <span style="font-weight: bold;">unless</span> mime_type(file) == <span style="font-style: italic;">'inode/directory'</span>
    <span style="font-weight: bold; text-decoration: underline;">File</span>.exist?(<span style="font-weight: bold; text-decoration: underline;">Pathname</span>.new(file).join(<span style="font-style: italic;">"VIDEO_TS"</span>)) ||
      <span style="font-weight: bold; text-decoration: underline;">File</span>.exist?(<span style="font-weight: bold; text-decoration: underline;">Pathname</span>.new(file).join(<span style="font-style: italic;">"video_ts"</span>))
  <span style="font-weight: bold;">end</span>
<span style="font-weight: bold;">end</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org8998313" class="outline-3">
<h3 id="org8998313">mediautil</h3>
<div class="outline-text-3" id="text-org8998313">
<p>
Utility ruby program for manipulating image, audio and video file.
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="font-style: italic;">"dvd+rw-tools"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-ruby"><span style="font-weight: bold;">require</span> <span style="font-style: italic;">'thor'</span>
<span style="font-weight: bold;">require</span> <span style="font-style: italic;">'open3'</span>
<span style="font-weight: bold;">require</span> <span style="font-style: italic;">'fileutils'</span>
<span style="font-weight: bold;">require</span> <span style="font-style: italic;">'tempfile'</span>
<span style="font-weight: bold;">require</span> <span style="font-style: italic;">'tmpdir'</span>

<span style="font-weight: bold;">require</span> <span style="font-style: italic;">'filetype'</span>

<span style="font-weight: bold;">class</span> <span style="font-weight: bold; text-decoration: underline;">MediaUtil</span> &lt; <span style="font-weight: bold; text-decoration: underline;">Thor</span>
  <span style="font-weight: bold; text-decoration: underline;">OUTFILE_SUFFIX</span> = <span style="font-style: italic;">"_out"</span>
  <span style="font-weight: bold; text-decoration: underline;">DEFAULT_VIDEO_EXT</span> = <span style="font-style: italic;">".mkv"</span>

  <span style="font-weight: bold;">class</span> <span style="font-weight: bold; text-decoration: underline;">Names</span> &lt; <span style="font-weight: bold; text-decoration: underline;">Struct</span>.new(<span style="font-weight: bold; text-decoration: underline;">:in_f</span>, <span style="font-weight: bold; text-decoration: underline;">:out_f</span>)
    <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">in_file</span>()
      in_f
    <span style="font-weight: bold;">end</span>
    <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">out_file</span>(extension = <span style="font-weight: bold; text-decoration: underline;">nil</span>)
      <span style="font-weight: bold;">if</span> out_f
        out_f
      <span style="font-weight: bold;">else</span>
        bn = <span style="font-weight: bold; text-decoration: underline;">File</span>.basename(in_f, <span style="font-style: italic;">".*"</span>).gsub(<span style="font-style: italic;">/ /</span>, <span style="font-style: italic;">'_'</span>)
        ext = ((extension) ? extension : <span style="font-weight: bold; text-decoration: underline;">File</span>.extname(in_file))
        default_out = bn + ext
        <span style="font-weight: bold;">if</span> <span style="font-weight: bold; text-decoration: underline;">File</span>.file?(default_out)
          10.times <span style="font-weight: bold;">do</span> |i|
            try_name = bn + <span style="font-style: italic;">"_"</span> + (i+1).to_s + ext
            <span style="font-weight: bold;">unless</span> <span style="font-weight: bold; text-decoration: underline;">File</span>.file?(try_name)
              <span style="font-weight: bold;">return</span> try_name
            <span style="font-weight: bold;">end</span>
          <span style="font-weight: bold;">end</span>
        <span style="font-weight: bold;">end</span>
        default_out
      <span style="font-weight: bold;">end</span>
    <span style="font-weight: bold;">end</span>
    <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">title</span>()
      <span style="font-weight: bold; text-decoration: underline;">File</span>.basename(out_file, <span style="font-style: italic;">".*"</span>)
    <span style="font-weight: bold;">end</span>
  <span style="font-weight: bold;">end</span>
  <span style="font-weight: bold;">class</span> <span style="font-weight: bold; text-decoration: underline;">Commander</span> &lt; <span style="font-weight: bold; text-decoration: underline;">Struct</span>.new(<span style="font-weight: bold; text-decoration: underline;">:log</span>, <span style="font-weight: bold; text-decoration: underline;">:dry</span>)
    <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">execute</span>(command)
      <span style="font-weight: bold;">if</span> dry
        <span style="font-weight: bold;">puts</span> command
      <span style="font-weight: bold;">else</span>
        log_str, s_code = <span style="font-weight: bold; text-decoration: underline;">Open3</span>.capture2e(command)
        <span style="font-weight: bold;">if</span> log
          user_cmd = <span style="font-weight: bold;">caller</span>.first.scan(<span style="font-style: italic;">/`(.*)'/</span>).flatten.first.to_s
          log_fname = <span style="font-weight: bold; text-decoration: underline;">Time</span>.now.strftime(<span style="font-style: italic;">"%Y%m%d_%H%M%S_"</span>) + user_cmd + <span style="font-style: italic;">".log"</span>
          <span style="font-weight: bold; text-decoration: underline;">File</span>.open(log_fname, <span style="font-style: italic;">"w"</span>) <span style="font-weight: bold;">do</span> |f|
            f.puts(log_str)
          <span style="font-weight: bold;">end</span>
        <span style="font-weight: bold;">else</span>
          <span style="font-weight: bold;">puts</span> log_str
        <span style="font-weight: bold;">end</span>
        <span style="font-weight: bold;">exit</span> <span style="font-weight: bold; text-decoration: underline;">false</span> <span style="font-weight: bold;">unless</span> s_code.success?
        <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">exit false</span>
      <span style="font-weight: bold;">end</span>
    <span style="font-weight: bold;">end</span>
  <span style="font-weight: bold;">end</span>

  class_option <span style="font-weight: bold; text-decoration: underline;">:log</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"L"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:boolean</span>,
               <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">"log stdout and stderr instead they reveal in terminal"</span>
  class_option <span style="font-weight: bold; text-decoration: underline;">:dryrun</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"D"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:boolean</span>

  desc <span style="font-style: italic;">"info &lt;file&gt;"</span>, <span style="font-style: italic;">"show information about the video file or DVD directory"</span>
  option <span style="font-weight: bold; text-decoration: underline;">:short</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"s"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:boolean</span>
  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">info</span>(target)
    commander = <span style="font-weight: bold; text-decoration: underline;">Commander</span>.new(options[<span style="font-weight: bold; text-decoration: underline;">:log</span>], options[<span style="font-weight: bold; text-decoration: underline;">:dryrun</span>])

    <span style="font-weight: bold;">if</span> <span style="font-weight: bold; text-decoration: underline;">FileType</span>.video?(target) || <span style="font-weight: bold; text-decoration: underline;">FileType</span>.audio?(target)
      commander.execute(<span style="font-style: italic;">"ffprobe \"</span><span style="font-weight: bold; font-style: italic;">#{target}</span><span style="font-style: italic;">\" -hide_banner -show_entries format"</span>)
    <span style="font-weight: bold;">elsif</span> <span style="font-weight: bold; text-decoration: underline;">FileType</span>.image?(target)
      <span style="font-weight: bold;">if</span> options[<span style="font-weight: bold; text-decoration: underline;">:short</span>]
        commander.execute(<span style="font-style: italic;">"identify </span><span style="font-weight: bold; font-style: italic;">#{target}</span><span style="font-style: italic;">"</span>)
      <span style="font-weight: bold;">else</span>
        commander.execute(<span style="font-style: italic;">"identify -verbose </span><span style="font-weight: bold; font-style: italic;">#{target}</span><span style="font-style: italic;">"</span>)
      <span style="font-weight: bold;">end</span>
    <span style="font-weight: bold;">elsif</span> <span style="font-weight: bold; text-decoration: underline;">FileType</span>.block_device?(target) ||
          <span style="font-weight: bold; text-decoration: underline;">FileType</span>.video_dvd_image?(target) ||
          <span style="font-weight: bold; text-decoration: underline;">FileType</span>.dvd_dir?(target)
      commander.execute(<span style="font-style: italic;">"HandBrakeCLI -i \"</span><span style="font-weight: bold; font-style: italic;">#{target}</span><span style="font-style: italic;">\" --title 0"</span>)
    <span style="font-weight: bold;">else</span>
      <span style="font-weight: bold; text-decoration: underline;">STDERR</span>.puts <span style="font-style: italic;">"Unknown Media Format"</span>
      <span style="font-weight: bold;">exit</span> <span style="font-weight: bold; text-decoration: underline;">false</span>
    <span style="font-weight: bold;">end</span>
  <span style="font-weight: bold;">end</span>

  default_command <span style="font-weight: bold; text-decoration: underline;">:encode</span>
  desc <span style="font-style: italic;">"encode"</span>, <span style="font-style: italic;">"encode video file"</span>
  option <span style="font-weight: bold; text-decoration: underline;">:in</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"i"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>, <span style="font-weight: bold; text-decoration: underline;">:required</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">true</span>
  option <span style="font-weight: bold; text-decoration: underline;">:out</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"o"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>
  option <span style="font-weight: bold; text-decoration: underline;">:vencoder</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"e"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:banner</span> =&gt; <span style="font-style: italic;">"libx265|libx264"</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">"video encoder"</span>
  option <span style="font-weight: bold; text-decoration: underline;">:vquality</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"q"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:banner</span> =&gt; <span style="font-style: italic;">"24.0"</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">"video encoding quality"</span>
  option <span style="font-weight: bold; text-decoration: underline;">:vbitrate</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"b"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:banner</span> =&gt; <span style="font-style: italic;">"1000"</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">"video encoding bitrate in kbps"</span>
  option <span style="font-weight: bold; text-decoration: underline;">:aencoder</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"E"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:banner</span> =&gt; <span style="font-style: italic;">"fdk_aac"</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">"audio encoder"</span>
  option <span style="font-weight: bold; text-decoration: underline;">:aquality</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"Q"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:banner</span> =&gt; <span style="font-style: italic;">"100.0"</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">"audio encoding quality"</span>
  option <span style="font-weight: bold; text-decoration: underline;">:abitrate</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"B"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:banner</span> =&gt; <span style="font-style: italic;">"128"</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">"audio encoding bitrate in kbps"</span>
  option <span style="font-weight: bold; text-decoration: underline;">:display</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"d"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:banner</span> =&gt; <span style="font-style: italic;">"1920:1080"</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">'display (width:height) in which encoded video fit'</span>
  option <span style="font-weight: bold; text-decoration: underline;">:fps</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"f"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:banner</span> =&gt; <span style="font-style: italic;">"30"</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">'max frame rate'</span>
  option <span style="font-weight: bold; text-decoration: underline;">:ffmpeg</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>
  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">encode</span>()
    equip = <span style="font-weight: bold; text-decoration: underline;">Names</span>.new(options[<span style="font-weight: bold; text-decoration: underline;">:in</span>], options[<span style="font-weight: bold; text-decoration: underline;">:out</span>])
    commander = <span style="font-weight: bold; text-decoration: underline;">Commander</span>.new(options[<span style="font-weight: bold; text-decoration: underline;">:log</span>], options[<span style="font-weight: bold; text-decoration: underline;">:dryrun</span>])

    vconf = aconf = pconf = <span style="font-weight: bold; text-decoration: underline;">nil</span>
    <span style="font-weight: bold;">if</span> options[<span style="font-weight: bold; text-decoration: underline;">:vencoder</span>] || options[<span style="font-weight: bold; text-decoration: underline;">:vquality</span>]
      vconf = <span style="font-weight: bold; text-decoration: underline;">VideoConfig</span>.new(options[<span style="font-weight: bold; text-decoration: underline;">:vencoder</span>], options[<span style="font-weight: bold; text-decoration: underline;">:vquality</span>], options[<span style="font-weight: bold; text-decoration: underline;">:vbitrate</span>])
    <span style="font-weight: bold;">end</span>
    <span style="font-weight: bold;">if</span> options[<span style="font-weight: bold; text-decoration: underline;">:aencoder</span>] || options[<span style="font-weight: bold; text-decoration: underline;">:aquality</span>]
      aconf = <span style="font-weight: bold; text-decoration: underline;">AudioConfig</span>.new(options[<span style="font-weight: bold; text-decoration: underline;">:aencoder</span>], options[<span style="font-weight: bold; text-decoration: underline;">:aquality</span>], options[<span style="font-weight: bold; text-decoration: underline;">:abitrate</span>])
    <span style="font-weight: bold;">end</span>
    <span style="font-weight: bold;">if</span> options[<span style="font-weight: bold; text-decoration: underline;">:display</span>] || options[<span style="font-weight: bold; text-decoration: underline;">:fps</span>]
      pconf = <span style="font-weight: bold; text-decoration: underline;">PictureConfig</span>.new
      pconf.fit_size(options[<span style="font-weight: bold; text-decoration: underline;">:display</span>]) <span style="font-weight: bold;">if</span> options[<span style="font-weight: bold; text-decoration: underline;">:display</span>]
      pconf.decrease_framerate(options[<span style="font-weight: bold; text-decoration: underline;">:fps</span>]) <span style="font-weight: bold;">if</span> options[<span style="font-weight: bold; text-decoration: underline;">:fps</span>]
    <span style="font-weight: bold;">end</span>

    <span style="font-weight: bold;">if</span> <span style="font-weight: bold; text-decoration: underline;">FileType</span>.video?(equip.in_file) <span style="font-weight: bold;">then</span>
      commander.execute(<span style="font-weight: bold; text-decoration: underline;">FFMPEG</span>.command([<span style="font-weight: bold; text-decoration: underline;">FFMPEGOptSet</span>.new(equip.in_file, [])],
                                       [<span style="font-weight: bold; text-decoration: underline;">FFMPEGOptSet</span>.new(equip.out_file, [vconf, aconf, pconf, <span style="font-style: italic;">"-map_metadata 0"</span>, options[<span style="font-weight: bold; text-decoration: underline;">:ffmpeg</span>]])]))
    <span style="font-weight: bold;">elsif</span> <span style="font-weight: bold; text-decoration: underline;">FileType</span>.audio?(equip.in_file) <span style="font-weight: bold;">then</span>
      commander.execute(<span style="font-weight: bold; text-decoration: underline;">FFMPEG</span>.command([<span style="font-weight: bold; text-decoration: underline;">FFMPEGOptSet</span>.new(equip.in_file, [])],
                                       [<span style="font-weight: bold; text-decoration: underline;">FFMPEGOptSet</span>.new(equip.out_file, [aconf])]))
    <span style="font-weight: bold;">elsif</span> <span style="font-weight: bold; text-decoration: underline;">FileType</span>.image?(equip.in_file) <span style="font-weight: bold;">then</span>
      pconf = <span style="font-weight: bold; text-decoration: underline;">ImageConfig</span>.new
      commander.execute(<span style="font-weight: bold; text-decoration: underline;">ImageMagick</span>.command(equip.in_file,
                                            equip.out_file,
                                            pconf))
    <span style="font-weight: bold;">else</span>
      <span style="font-weight: bold; text-decoration: underline;">STDERR</span>.puts <span style="font-style: italic;">"Unknown Media Format"</span>
      <span style="font-weight: bold;">exit</span> <span style="font-weight: bold; text-decoration: underline;">false</span>
    <span style="font-weight: bold;">end</span>
  <span style="font-weight: bold;">end</span>

  desc <span style="font-style: italic;">'cdencode'</span>, <span style="font-style: italic;">'rip and encode CD contents'</span>
  option <span style="font-weight: bold; text-decoration: underline;">:device</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">'d'</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">'Device file'</span>
  option <span style="font-weight: bold; text-decoration: underline;">:format</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">'f'</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:banner</span> =&gt; <span style="font-style: italic;">'flac,ogg,m4a'</span>, <span style="font-weight: bold; text-decoration: underline;">:default</span> =&gt; <span style="font-style: italic;">'flac:-8'</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">'formats with additinal argument like compression level'</span>
  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">cdencode</span>()
    commander = <span style="font-weight: bold; text-decoration: underline;">Commander</span>.new(options[<span style="font-weight: bold; text-decoration: underline;">:log</span>], options[<span style="font-weight: bold; text-decoration: underline;">:dryrun</span>])

    abcde_args = []
    abcde_args &lt;&lt; <span style="font-style: italic;">"-d </span><span style="font-weight: bold; font-style: italic;">#{options[:device]}</span><span style="font-style: italic;">"</span> <span style="font-weight: bold;">if</span> options[<span style="font-weight: bold; text-decoration: underline;">:device</span>]
    abcde_args &lt;&lt; <span style="font-style: italic;">'-a default'</span>
    <span style="font-weight: bold;">if</span> options[<span style="font-weight: bold; text-decoration: underline;">:format</span>] <span style="font-weight: bold;">then</span>
      abcde_args &lt;&lt; <span style="font-style: italic;">"-o '</span><span style="font-weight: bold; font-style: italic;">#{options[:format]}</span><span style="font-style: italic;">'"</span>
    <span style="font-weight: bold;">end</span>
    abcde_args &lt;&lt; <span style="font-style: italic;">'-G'</span> <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">getalbumart</span>
    abcde_args &lt;&lt; <span style="font-style: italic;">'-x'</span> <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Eject CD</span>

    commander.execute(<span style="font-style: italic;">"abcde </span><span style="font-weight: bold; font-style: italic;">#{abcde_args.join(' ')}</span><span style="font-style: italic;">"</span>)
  <span style="font-weight: bold;">end</span>

  desc <span style="font-style: italic;">'dvdrip'</span>, <span style="font-style: italic;">'rip(backup) DVD contents'</span>
  option <span style="font-weight: bold; text-decoration: underline;">:device</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">'d'</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">'DVD device file'</span>
  option <span style="font-weight: bold; text-decoration: underline;">:out</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">'o'</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">'output directory name'</span>
  option <span style="font-weight: bold; text-decoration: underline;">:name</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">'n'</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">'root directory name of backup data'</span>
  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">dvdrip</span>()
    commander = <span style="font-weight: bold; text-decoration: underline;">Commander</span>.new(options[<span style="font-weight: bold; text-decoration: underline;">:log</span>], options[<span style="font-weight: bold; text-decoration: underline;">:dryrun</span>])

    dvdbackup_opts = [<span style="font-style: italic;">'dvdbackup'</span>]
    dvdbackup_opts &lt;&lt; <span style="font-style: italic;">'--input=%s'</span> % options[<span style="font-weight: bold; text-decoration: underline;">:device</span>] <span style="font-weight: bold;">if</span> options[<span style="font-weight: bold; text-decoration: underline;">:device</span>]
    dvdbackup_opts &lt;&lt; <span style="font-style: italic;">'--output=%s'</span> % options[<span style="font-weight: bold; text-decoration: underline;">:out</span>] <span style="font-weight: bold;">if</span> options[<span style="font-weight: bold; text-decoration: underline;">:out</span>]
    dvdbackup_opts &lt;&lt; <span style="font-style: italic;">'--name=%s'</span> % options[<span style="font-weight: bold; text-decoration: underline;">:name</span>] <span style="font-weight: bold;">if</span> options[<span style="font-weight: bold; text-decoration: underline;">:name</span>]
    dvdbackup_opts &lt;&lt; <span style="font-style: italic;">'--mirror'</span>
    dvdbackup_opts &lt;&lt; <span style="font-style: italic;">'--progress'</span>
    dvdbackup_opts &lt;&lt; <span style="font-style: italic;">'--verbose'</span>

    commander.execute(dvdbackup_opts.join(<span style="font-style: italic;">' '</span>))
  <span style="font-weight: bold;">end</span>

  desc <span style="font-style: italic;">'dvdencode'</span>, <span style="font-style: italic;">'encode DVD contents'</span>
  option <span style="font-weight: bold; text-decoration: underline;">:in</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">'i'</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>, <span style="font-weight: bold; text-decoration: underline;">:required</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">true</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">'input source, DVD device file or backuped DVD file'</span>
  option <span style="font-weight: bold; text-decoration: underline;">:out</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">'o'</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">'output directory name'</span>
  option <span style="font-weight: bold; text-decoration: underline;">:vencoder</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"e"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:banner</span> =&gt; <span style="font-style: italic;">"x265|x264"</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">"video encoder"</span>
  option <span style="font-weight: bold; text-decoration: underline;">:vquality</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"q"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:banner</span> =&gt; <span style="font-style: italic;">"24.0"</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">"video encoding quality"</span>
  option <span style="font-weight: bold; text-decoration: underline;">:vbitrate</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"b"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:banner</span> =&gt; <span style="font-style: italic;">"1000"</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">"video bitrate in kbps"</span>
  option <span style="font-weight: bold; text-decoration: underline;">:aencoder</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"E"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:banner</span> =&gt; <span style="font-style: italic;">"fdk_aac"</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">"audio encoder"</span>
  option <span style="font-weight: bold; text-decoration: underline;">:aquality</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"Q"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:banner</span> =&gt; <span style="font-style: italic;">"100.0"</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">"audio encoding quality"</span>
  option <span style="font-weight: bold; text-decoration: underline;">:abitrate</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"B"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:banner</span> =&gt; <span style="font-style: italic;">"128"</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">"audio bitrate in kbps"</span>
  option <span style="font-weight: bold; text-decoration: underline;">:title</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">'t'</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:banner</span> =&gt; <span style="font-style: italic;">'1|2|3|...'</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">'title number'</span>
  option <span style="font-weight: bold; text-decoration: underline;">:chapters</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">'c'</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:banner</span> =&gt; <span style="font-style: italic;">'1|1-3|1,3,5|...'</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">'chapter numbers'</span>
  option <span style="font-weight: bold; text-decoration: underline;">:audio</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">'a'</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:banner</span> =&gt; <span style="font-style: italic;">'1,2,3'</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">'audio channel'</span>
  option <span style="font-weight: bold; text-decoration: underline;">:subtitle</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">'s'</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:banner</span> =&gt; <span style="font-style: italic;">'1,2'</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">'subtitle channel'</span>
  option <span style="font-weight: bold; text-decoration: underline;">:handbrake</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:banner</span> =&gt; <span style="font-style: italic;">'--handbrake \"--mixdown 5point1,stereo\"'</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">'HandBrakeCLI options'</span>
  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">dvdencode</span>()
    equip = <span style="font-weight: bold; text-decoration: underline;">Names</span>.new(options[<span style="font-weight: bold; text-decoration: underline;">:in</span>], options[<span style="font-weight: bold; text-decoration: underline;">:out</span>])
    commander = <span style="font-weight: bold; text-decoration: underline;">Commander</span>.new(options[<span style="font-weight: bold; text-decoration: underline;">:log</span>], options[<span style="font-weight: bold; text-decoration: underline;">:dryrun</span>])

    <span style="font-weight: bold;">if</span> <span style="font-weight: bold; text-decoration: underline;">FileType</span>.block_device?(equip.in_file) ||
       <span style="font-weight: bold; text-decoration: underline;">FileType</span>.video_dvd_image?(equip.in_file) ||
       <span style="font-weight: bold; text-decoration: underline;">FileType</span>.dvd_dir?(equip.in_file)
      configs = []
      configs &lt;&lt; <span style="font-weight: bold; text-decoration: underline;">VideoConfig</span>.new(options[<span style="font-weight: bold; text-decoration: underline;">:vencoder</span>], options[<span style="font-weight: bold; text-decoration: underline;">:vquality</span>], options[<span style="font-weight: bold; text-decoration: underline;">:vbitrate</span>])
      configs &lt;&lt; <span style="font-weight: bold; text-decoration: underline;">AudioConfig</span>.new(options[<span style="font-weight: bold; text-decoration: underline;">:aencoder</span>], options[<span style="font-weight: bold; text-decoration: underline;">:aquality</span>], options[<span style="font-weight: bold; text-decoration: underline;">:abitrate</span>])
      dconf = <span style="font-weight: bold; text-decoration: underline;">DVDConfig</span>.new
      dconf.title = options[<span style="font-weight: bold; text-decoration: underline;">:title</span>] <span style="font-weight: bold;">if</span> options[<span style="font-weight: bold; text-decoration: underline;">:title</span>]
      dconf.chapters = options[<span style="font-weight: bold; text-decoration: underline;">:chapters</span>] <span style="font-weight: bold;">if</span> options[<span style="font-weight: bold; text-decoration: underline;">:chapters</span>]
      dconf.audio = options[<span style="font-weight: bold; text-decoration: underline;">:audio</span>] <span style="font-weight: bold;">if</span> options[<span style="font-weight: bold; text-decoration: underline;">:audio</span>]
      dconf.subtitle = options[<span style="font-weight: bold; text-decoration: underline;">:subtitle</span>] <span style="font-weight: bold;">if</span> options[<span style="font-weight: bold; text-decoration: underline;">:subtitle</span>]
      configs &lt;&lt; dconf
      commander.execute(<span style="font-weight: bold; text-decoration: underline;">HandBrakeCLI</span>.command(equip.in_file,
                                             equip.out_file(<span style="font-weight: bold; text-decoration: underline;">DEFAULT_VIDEO_EXT</span>),
                                             configs,
                                             options[<span style="font-weight: bold; text-decoration: underline;">:handbrake</span>]))
    <span style="font-weight: bold;">end</span>
  <span style="font-weight: bold;">end</span>

  desc <span style="font-style: italic;">'mount &lt;dir&gt;'</span>, <span style="font-style: italic;">'Mount CD/DVD media to dir.'</span>
  option <span style="font-weight: bold; text-decoration: underline;">:device</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"d"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>, <span style="font-weight: bold; text-decoration: underline;">:required</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">true</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">'device or iso file to mount'</span>,
         <span style="font-weight: bold; text-decoration: underline;">:banner</span> =&gt; <span style="font-style: italic;">'--mount /dev/dvd|image.iso'</span>
  option <span style="font-weight: bold; text-decoration: underline;">:type</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">'t'</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">'mount DVD-Video'</span>,
         <span style="font-weight: bold; text-decoration: underline;">:banner</span> =&gt; <span style="font-style: italic;">'--type data|video'</span>
  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">mount</span>(dir)
    commander = <span style="font-weight: bold; text-decoration: underline;">Commander</span>.new(options[<span style="font-weight: bold; text-decoration: underline;">:log</span>], options[<span style="font-weight: bold; text-decoration: underline;">:dryrun</span>])

    cmd_opts = [<span style="font-style: italic;">'mount'</span>]
    <span style="font-weight: bold;">if</span> options[<span style="font-weight: bold; text-decoration: underline;">:type</span>] == <span style="font-style: italic;">'video'</span> || <span style="font-weight: bold; text-decoration: underline;">FileType</span>.video_dvd_image?(options[<span style="font-weight: bold; text-decoration: underline;">:device</span>])
      cmd_opts &lt;&lt; [<span style="font-style: italic;">'-t'</span>, <span style="font-style: italic;">'iso9660'</span>, <span style="font-style: italic;">'-o'</span>, <span style="font-style: italic;">'loop'</span>]
    <span style="font-weight: bold;">end</span>
    cmd_opts &lt;&lt; options[<span style="font-weight: bold; text-decoration: underline;">:device</span>]
    cmd_opts &lt;&lt; dir

    <span style="font-weight: bold; text-decoration: underline;">Dir</span>.mkdir(dir) <span style="font-weight: bold;">if</span> !<span style="font-weight: bold; text-decoration: underline;">Dir</span>.exist?(dir) &amp;&amp; !options[<span style="font-weight: bold; text-decoration: underline;">:dryrun</span>]
    commander.execute(<span style="font-style: italic;">"sudo </span><span style="font-weight: bold; font-style: italic;">#{cmd_opts.join(' ')}</span><span style="font-style: italic;">"</span>)
  <span style="font-weight: bold;">end</span>

  desc <span style="font-style: italic;">'umount'</span>, <span style="font-style: italic;">'unmount dir'</span>
  option <span style="font-weight: bold; text-decoration: underline;">:remove</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">'r'</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:boolean</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">'remove dir after unmounting'</span>
  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">umount</span>(dir)
    commander = <span style="font-weight: bold; text-decoration: underline;">Commander</span>.new(options[<span style="font-weight: bold; text-decoration: underline;">:log</span>], options[<span style="font-weight: bold; text-decoration: underline;">:dryrun</span>])

    cmd_opts = [<span style="font-style: italic;">'umount'</span>]
    cmd_opts &lt;&lt; dir

    commander.execute(<span style="font-style: italic;">"sudo </span><span style="font-weight: bold; font-style: italic;">#{cmd_opts.join(' ')}</span><span style="font-style: italic;">"</span>)

    <span style="font-weight: bold;">if</span> options[<span style="font-weight: bold; text-decoration: underline;">:remove</span>]
      <span style="font-weight: bold; text-decoration: underline;">FileUtils</span>.rmdir(dir)
    <span style="font-weight: bold;">end</span>
  <span style="font-weight: bold;">end</span>

  desc <span style="font-style: italic;">'mkiso'</span>, <span style="font-style: italic;">'make ISO image file.'</span>
  option <span style="font-weight: bold; text-decoration: underline;">:type</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">'t'</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>, <span style="font-weight: bold; text-decoration: underline;">:required</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">true</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">'DVD image type. Data or Video DVD.'</span>,
         <span style="font-weight: bold; text-decoration: underline;">:banner</span> =&gt; <span style="font-style: italic;">'--type data|video'</span>
  option <span style="font-weight: bold; text-decoration: underline;">:volume</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">'V'</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">'Volume Label'</span>
  option <span style="font-weight: bold; text-decoration: underline;">:out</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">'o'</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">'ISO image file name.'</span>,
         <span style="font-weight: bold; text-decoration: underline;">:banner</span> =&gt; <span style="font-style: italic;">'--out movie.iso'</span>
  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">mkiso</span>(file)
    names = <span style="font-weight: bold; text-decoration: underline;">Names</span>.new(file, options[<span style="font-weight: bold; text-decoration: underline;">:out</span>])
    commander = <span style="font-weight: bold; text-decoration: underline;">Commander</span>.new(options[<span style="font-weight: bold; text-decoration: underline;">:log</span>], options[<span style="font-weight: bold; text-decoration: underline;">:dryrun</span>])

    mkisofs_opts = [<span style="font-style: italic;">'mkisofs'</span>]
    mkisofs_opts &lt;&lt; [<span style="font-style: italic;">"-V"</span>, <span style="font-style: italic;">"\"</span><span style="font-weight: bold; font-style: italic;">#{options[:volume]}</span><span style="font-style: italic;">\""</span>] <span style="font-weight: bold;">if</span> options[<span style="font-weight: bold; text-decoration: underline;">:volume</span>]
    <span style="font-weight: bold;">if</span> options[<span style="font-weight: bold; text-decoration: underline;">:type</span>] == <span style="font-style: italic;">"data"</span>
      mkisofs_opts &lt;&lt; [<span style="font-style: italic;">"-r"</span>, <span style="font-style: italic;">"-l"</span>, <span style="font-style: italic;">"-J"</span>]
    <span style="font-weight: bold;">elsif</span> options[<span style="font-weight: bold; text-decoration: underline;">:type</span>]
      mkisofs_opts &lt;&lt; <span style="font-style: italic;">"-dvd-video"</span>
    <span style="font-weight: bold;">else</span>
      <span style="font-weight: bold;">exit</span> 1
    <span style="font-weight: bold;">end</span>
    mkisofs_opts &lt;&lt; [<span style="font-style: italic;">"-o"</span>, <span style="font-style: italic;">"\"</span><span style="font-weight: bold; font-style: italic;">#{names.out_file('.iso')}</span><span style="font-style: italic;">\""</span>]
    mkisofs_opts &lt;&lt; <span style="font-style: italic;">"\"</span><span style="font-weight: bold; font-style: italic;">#{file}</span><span style="font-style: italic;">\""</span>

    commander.execute(mkisofs_opts.join(<span style="font-style: italic;">" "</span>))
  <span style="font-weight: bold;">end</span>

  desc <span style="font-style: italic;">'dvdburn &lt;file&gt;'</span>, <span style="font-style: italic;">'Burn file to DVD.'</span>
  option <span style="font-weight: bold; text-decoration: underline;">:iso</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">'I'</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:boolean</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">'Set this option if &lt;file&gt; is ISO 9660 compliant.'</span>
  option <span style="font-weight: bold; text-decoration: underline;">:volume</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">'V'</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>, <span style="font-weight: bold; text-decoration: underline;">:default</span> =&gt; <span style="font-style: italic;">'DVD_VIDEO'</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">'Volume Label'</span>
  option <span style="font-weight: bold; text-decoration: underline;">:video</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">'v'</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:boolean</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">'Create DVD video image file to burn.'</span>
  option <span style="font-weight: bold; text-decoration: underline;">:speed</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">'s'</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>, <span style="font-weight: bold; text-decoration: underline;">:default</span> =&gt; <span style="font-style: italic;">'4'</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">'Burning Speed'</span>,
         <span style="font-weight: bold; text-decoration: underline;">:banner</span> =&gt; <span style="font-style: italic;">'n'</span>
  option <span style="font-weight: bold; text-decoration: underline;">:device</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">'d'</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">'Device file'</span>, <span style="font-weight: bold; text-decoration: underline;">:default</span> =&gt; <span style="font-style: italic;">'/dev/sr0'</span>
  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">dvdburn</span>(file)
    commander = <span style="font-weight: bold; text-decoration: underline;">Commander</span>.new(options[<span style="font-weight: bold; text-decoration: underline;">:log</span>], options[<span style="font-weight: bold; text-decoration: underline;">:dryrun</span>])

    cmd_opts = [<span style="font-style: italic;">'growisofs'</span>]
    cmd_opts &lt;&lt; <span style="font-style: italic;">'-dvd-compat'</span>
    cmd_opts &lt;&lt; <span style="font-style: italic;">'-speed=%s'</span> % options[<span style="font-weight: bold; text-decoration: underline;">:speed</span>]
    <span style="font-weight: bold;">if</span> <span style="font-weight: bold; text-decoration: underline;">FileType</span>.iso9660?(file) || options[<span style="font-weight: bold; text-decoration: underline;">:iso</span>]
      cmd_opts &lt;&lt; <span style="font-style: italic;">'-Z %s=%s'</span> % [options[<span style="font-weight: bold; text-decoration: underline;">:device</span>], file]
    <span style="font-weight: bold;">else</span>
      cmd_opts &lt;&lt; <span style="font-style: italic;">'-Z %s'</span> % options[<span style="font-weight: bold; text-decoration: underline;">:device</span>]
      mkisofs_opts = []
      mkisofs_opts &lt;&lt; [<span style="font-style: italic;">'-V'</span>, <span style="font-style: italic;">"\"</span><span style="font-weight: bold; font-style: italic;">#{options[:volume]}</span><span style="font-style: italic;">\""</span>] <span style="font-weight: bold;">if</span> options[<span style="font-weight: bold; text-decoration: underline;">:volume</span>]
      <span style="font-weight: bold;">if</span> options[<span style="font-weight: bold; text-decoration: underline;">:video</span>]
        mkisofs_opts &lt;&lt; <span style="font-style: italic;">'-dvd-video'</span>
      <span style="font-weight: bold;">else</span> <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Data-DVD</span>
        mkisofs_opts &lt;&lt; [<span style="font-style: italic;">'-r'</span>, <span style="font-style: italic;">'-l'</span>, <span style="font-style: italic;">'-R'</span>]
      <span style="font-weight: bold;">end</span>
      mkisofs_opts &lt;&lt; file
      cmd_opts &lt;&lt; mkisofs_opts
    <span style="font-weight: bold;">end</span>

    commander.execute(cmd_opts.join(<span style="font-style: italic;">' '</span>))
  <span style="font-weight: bold;">end</span>

  desc <span style="font-style: italic;">"cdburn"</span>, <span style="font-style: italic;">"burn files to CD device"</span>
  option <span style="font-weight: bold; text-decoration: underline;">:in</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"i"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>, <span style="font-weight: bold; text-decoration: underline;">:required</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">true</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">"Root Directory for image file"</span>
  option <span style="font-weight: bold; text-decoration: underline;">:volume</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"v"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>, <span style="font-weight: bold; text-decoration: underline;">:required</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">true</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">"Volume ID"</span>
  option <span style="font-weight: bold; text-decoration: underline;">:device</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"d"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">"Device file"</span>, <span style="font-weight: bold; text-decoration: underline;">:default</span> =&gt; <span style="font-style: italic;">"/dev/sr0"</span>
  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">cdburn</span>()
    commander = <span style="font-weight: bold; text-decoration: underline;">Commander</span>.new(options[<span style="font-weight: bold; text-decoration: underline;">:log</span>], options[<span style="font-weight: bold; text-decoration: underline;">:dryrun</span>])

    commander.execute(<span style="font-style: italic;">"mkisofs -V \"</span><span style="font-weight: bold; font-style: italic;">#{options[:volume]}</span><span style="font-style: italic;">\" -J -r </span><span style="font-weight: bold; font-style: italic;">#{options[:in]}</span><span style="font-style: italic;"> | cdrecord -v dev=</span><span style="font-weight: bold; font-style: italic;">#{options[:device]}</span><span style="font-style: italic;"> -waiti -"</span>)
  <span style="font-weight: bold;">end</span>

  desc <span style="font-style: italic;">"screenshot"</span>, <span style="font-style: italic;">"take a screenshot of a video at a time"</span>
  option <span style="font-weight: bold; text-decoration: underline;">:in</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"i"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>, <span style="font-weight: bold; text-decoration: underline;">:required</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">true</span>
  option <span style="font-weight: bold; text-decoration: underline;">:out</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"o"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>
  option <span style="font-weight: bold; text-decoration: underline;">:time</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"t"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">"ex. 00:10:22.300"</span>
  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">screenshot</span>()
    equip = <span style="font-weight: bold; text-decoration: underline;">Names</span>.new(options[<span style="font-weight: bold; text-decoration: underline;">:in</span>], options[<span style="font-weight: bold; text-decoration: underline;">:out</span>])
    commander = <span style="font-weight: bold; text-decoration: underline;">Commander</span>.new(options[<span style="font-weight: bold; text-decoration: underline;">:log</span>], options[<span style="font-weight: bold; text-decoration: underline;">:dryrun</span>])
    <span style="font-weight: bold;">if</span> <span style="font-weight: bold; text-decoration: underline;">FileType</span>.video?(equip.in_file) <span style="font-weight: bold;">then</span>
      args = [<span style="font-style: italic;">'ffmpeg'</span>]
      args &lt;&lt; (<span style="font-style: italic;">'-ss %s'</span> % options[<span style="font-weight: bold; text-decoration: underline;">:time</span>]) <span style="font-weight: bold;">if</span> options[<span style="font-weight: bold; text-decoration: underline;">:time</span>]
      args &lt;&lt; <span style="font-style: italic;">'-i %s'</span> % equip.in_file
      args &lt;&lt; <span style="font-style: italic;">'-vframes 1'</span>
      args &lt;&lt; <span style="font-style: italic;">'-q:v 2'</span>
      args &lt;&lt; equip.out_file(<span style="font-style: italic;">'.jpg'</span>)
      commander.execute(args.join(<span style="font-style: italic;">' '</span>))
    <span style="font-weight: bold;">end</span>
  <span style="font-weight: bold;">end</span>

  desc <span style="font-style: italic;">"clip"</span>, <span style="font-style: italic;">"clip a video with specific time span"</span>
  option <span style="font-weight: bold; text-decoration: underline;">:in</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"i"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>, <span style="font-weight: bold; text-decoration: underline;">:required</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">true</span>
  option <span style="font-weight: bold; text-decoration: underline;">:out</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"o"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>
  option <span style="font-weight: bold; text-decoration: underline;">:time_begin</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"b"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">"ex. 00:10:22.300"</span>
  option <span style="font-weight: bold; text-decoration: underline;">:time_end</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"e"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>
  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">clip</span>()
    equip = <span style="font-weight: bold; text-decoration: underline;">Names</span>.new(options[<span style="font-weight: bold; text-decoration: underline;">:in</span>], options[<span style="font-weight: bold; text-decoration: underline;">:out</span>])
    commander = <span style="font-weight: bold; text-decoration: underline;">Commander</span>.new(options[<span style="font-weight: bold; text-decoration: underline;">:log</span>], options[<span style="font-weight: bold; text-decoration: underline;">:dryrun</span>])

    <span style="font-weight: bold;">if</span> <span style="font-weight: bold; text-decoration: underline;">FileType</span>.video?(equip.in_file) <span style="font-weight: bold;">then</span>
      <span style="font-weight: bold;">if</span> options[<span style="font-weight: bold; text-decoration: underline;">:time_begin</span>] <span style="font-weight: bold;">or</span> options[<span style="font-weight: bold; text-decoration: underline;">:time_end</span>] <span style="font-weight: bold;">then</span>
        in_opts = []
        in_opts &lt;&lt; <span style="font-style: italic;">"-ss </span><span style="font-weight: bold; font-style: italic;">#{options[:time_begin]}</span><span style="font-style: italic;">"</span> <span style="font-weight: bold;">if</span> options[<span style="font-weight: bold; text-decoration: underline;">:time_begin</span>]
        in_opts &lt;&lt; <span style="font-style: italic;">"-to </span><span style="font-weight: bold; font-style: italic;">#{options[:time_end]}</span><span style="font-style: italic;">"</span> <span style="font-weight: bold;">if</span> options[<span style="font-weight: bold; text-decoration: underline;">:time_end</span>]
        out_opts = []
        out_opts &lt;&lt; <span style="font-style: italic;">"-vcodec copy"</span>
        out_opts &lt;&lt; <span style="font-style: italic;">"-acodec copy"</span>
        out_opts &lt;&lt; <span style="font-style: italic;">"-map_metadata 0"</span>
        commander.execute(<span style="font-weight: bold; text-decoration: underline;">FFMPEG</span>.command([<span style="font-weight: bold; text-decoration: underline;">FFMPEGOptSet</span>.new(equip.in_file, in_opts)],
                                         [<span style="font-weight: bold; text-decoration: underline;">FFMPEGOptSet</span>.new(equip.out_file, out_opts)]))
      <span style="font-weight: bold;">end</span>
    <span style="font-weight: bold;">else</span>
      <span style="font-weight: bold; text-decoration: underline;">STDERR</span>.puts <span style="font-style: italic;">"This Media Format is not supported on this function"</span>
      <span style="font-weight: bold;">exit</span> <span style="font-weight: bold; text-decoration: underline;">false</span>
    <span style="font-weight: bold;">end</span>
  <span style="font-weight: bold;">end</span>

  desc <span style="font-style: italic;">"crop"</span>, <span style="font-style: italic;">"extract a specific rectangle of a image/video"</span>
  option <span style="font-weight: bold; text-decoration: underline;">:in</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"i"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>, <span style="font-weight: bold; text-decoration: underline;">:required</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">true</span>
  option <span style="font-weight: bold; text-decoration: underline;">:out</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"o"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>
  option <span style="font-weight: bold; text-decoration: underline;">:width</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"w"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:numeric</span>, <span style="font-weight: bold; text-decoration: underline;">:required</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">true</span>
  option <span style="font-weight: bold; text-decoration: underline;">:height</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"h"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:numeric</span>, <span style="font-weight: bold; text-decoration: underline;">:required</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">true</span>
  option <span style="font-weight: bold; text-decoration: underline;">:xpos</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"x"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:numeric</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">"x coordinate of an original image where cropped image of top-left corner overlaps"</span>
  option <span style="font-weight: bold; text-decoration: underline;">:ypos</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"y"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:numeric</span>
  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">crop</span>()
    names = <span style="font-weight: bold; text-decoration: underline;">Names</span>.new(options[<span style="font-weight: bold; text-decoration: underline;">:in</span>], options[<span style="font-weight: bold; text-decoration: underline;">:out</span>])
    commander = <span style="font-weight: bold; text-decoration: underline;">Commander</span>.new(options[<span style="font-weight: bold; text-decoration: underline;">:log</span>], options[<span style="font-weight: bold; text-decoration: underline;">:dryrun</span>])

    width = options[<span style="font-weight: bold; text-decoration: underline;">:width</span>]
    height = options[<span style="font-weight: bold; text-decoration: underline;">:height</span>]
    xpos = options[<span style="font-weight: bold; text-decoration: underline;">:xpos</span>] ? options[<span style="font-weight: bold; text-decoration: underline;">:xpos</span>] : 0
    ypos = options[<span style="font-weight: bold; text-decoration: underline;">:ypos</span>] ? options[<span style="font-weight: bold; text-decoration: underline;">:ypos</span>] : 0
    <span style="font-weight: bold;">if</span> <span style="font-weight: bold; text-decoration: underline;">FileType</span>.image?(names.in_file) <span style="font-weight: bold;">then</span>
      opt = <span style="font-style: italic;">'-crop %dx%d+%dx%d'</span> % [width, height, xpos, ypos]
      commander.execute(<span style="font-style: italic;">"convert </span><span style="font-weight: bold; font-style: italic;">#{opt}</span><span style="font-style: italic;"> </span><span style="font-weight: bold; font-style: italic;">#{names.in_file}</span><span style="font-style: italic;"> </span><span style="font-weight: bold; font-style: italic;">#{names.out_file}</span><span style="font-style: italic;">"</span>)
    <span style="font-weight: bold;">elsif</span> <span style="font-weight: bold; text-decoration: underline;">FileType</span>.video?(names.in_file) <span style="font-weight: bold;">then</span>
      args = [<span style="font-style: italic;">'ffmpeg'</span>]
      args &lt;&lt; <span style="font-style: italic;">'-i %s'</span> % names.in_file
      args &lt;&lt; <span style="font-style: italic;">'-vf crop=%d:%d:%d:%d'</span> % [width, height, xpos, ypos]
      args &lt;&lt; <span style="font-style: italic;">"-map_metadata 0"</span>
      args &lt;&lt; names.out_file
      commander.execute(args.join(<span style="font-style: italic;">' '</span>))
    <span style="font-weight: bold;">else</span>
      <span style="font-weight: bold; text-decoration: underline;">STDERR</span>.puts <span style="font-style: italic;">"This Media Format is not supported on this function"</span>
      <span style="font-weight: bold;">exit</span> <span style="font-weight: bold; text-decoration: underline;">false</span>
    <span style="font-weight: bold;">end</span>
  <span style="font-weight: bold;">end</span>

  desc <span style="font-style: italic;">"trim"</span>, <span style="font-style: italic;">"trim a image/video with automated detection"</span>
  option <span style="font-weight: bold; text-decoration: underline;">:in</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"i"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>, <span style="font-weight: bold; text-decoration: underline;">:required</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">true</span>
  option <span style="font-weight: bold; text-decoration: underline;">:out</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"o"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>
  option <span style="font-weight: bold; text-decoration: underline;">:threshold</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"t"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">"threshold where trimming begin and end"</span>
  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">trim</span>()
    names = <span style="font-weight: bold; text-decoration: underline;">Names</span>.new(options[<span style="font-weight: bold; text-decoration: underline;">:in</span>], options[<span style="font-weight: bold; text-decoration: underline;">:out</span>])
    commander = <span style="font-weight: bold; text-decoration: underline;">Commander</span>.new(options[<span style="font-weight: bold; text-decoration: underline;">:log</span>], options[<span style="font-weight: bold; text-decoration: underline;">:dryrun</span>])

    <span style="font-weight: bold;">if</span> <span style="font-weight: bold; text-decoration: underline;">FileType</span>.image?(names.in_file) <span style="font-weight: bold;">then</span>
      commander.execute(<span style="font-style: italic;">"convert -trim </span><span style="font-weight: bold; font-style: italic;">#{names.in_file}</span><span style="font-style: italic;"> </span><span style="font-weight: bold; font-style: italic;">#{names.out_file}</span><span style="font-style: italic;">"</span>)
    <span style="font-weight: bold;">elsif</span> <span style="font-weight: bold; text-decoration: underline;">FileType</span>.audio?(names.in_file) <span style="font-weight: bold;">then</span>
      threshold = (options[<span style="font-weight: bold; text-decoration: underline;">:threshold</span>]) ? options[<span style="font-weight: bold; text-decoration: underline;">:threshold</span>] : <span style="font-style: italic;">"-40dB"</span>
      commander.execute(<span style="font-style: italic;">"ffmpeg -i </span><span style="font-weight: bold; font-style: italic;">#{names.in_file}</span><span style="font-style: italic;"> -af \"silenceremove=start_periods=1:start_duration=0:start_threshold=</span><span style="font-weight: bold; font-style: italic;">#{threshold}</span><span style="font-style: italic;">:detection=peak\" </span><span style="font-weight: bold; font-style: italic;">#{names.out_file}</span><span style="font-style: italic;">"</span>)
    <span style="font-weight: bold;">end</span>
  <span style="font-weight: bold;">end</span>

  desc <span style="font-style: italic;">"resize"</span>, <span style="font-style: italic;">"resize the image"</span>
  option <span style="font-weight: bold; text-decoration: underline;">:in</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"i"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>, <span style="font-weight: bold; text-decoration: underline;">:required</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">true</span>
  option <span style="font-weight: bold; text-decoration: underline;">:out</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"o"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>
  option <span style="font-weight: bold; text-decoration: underline;">:width</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"w"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:banner</span> =&gt; <span style="font-style: italic;">"e.g. 300"</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">"resized image width"</span>
  option <span style="font-weight: bold; text-decoration: underline;">:height</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"h"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:banner</span> =&gt; <span style="font-style: italic;">"e.g. 200"</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">"resized image height"</span>
  option <span style="font-weight: bold; text-decoration: underline;">:operation</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"p"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>,
         <span style="font-weight: bold; text-decoration: underline;">:banner</span> =&gt; <span style="font-style: italic;">"enlarge|shrink"</span>,
         <span style="font-weight: bold; text-decoration: underline;">:desc</span> =&gt; <span style="font-style: italic;">"permitted operation for resizing"</span>
  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">resize</span>()
    names = <span style="font-weight: bold; text-decoration: underline;">Names</span>.new(options[<span style="font-weight: bold; text-decoration: underline;">:in</span>], options[<span style="font-weight: bold; text-decoration: underline;">:out</span>])
    commander = <span style="font-weight: bold; text-decoration: underline;">Commander</span>.new(options[<span style="font-weight: bold; text-decoration: underline;">:log</span>], options[<span style="font-weight: bold; text-decoration: underline;">:dryrun</span>])

    <span style="font-weight: bold;">if</span> <span style="font-weight: bold; text-decoration: underline;">FileType</span>.video?(names.in_file) <span style="font-weight: bold;">then</span>
      <span style="font-weight: bold;">if</span> options[<span style="font-weight: bold; text-decoration: underline;">:width</span>] <span style="font-weight: bold;">and</span> options[<span style="font-weight: bold; text-decoration: underline;">:height</span>]
        out_opts = []
        out_opts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"-vf scale=%s:%s,setsar=1:1"</span>, options[<span style="font-weight: bold; text-decoration: underline;">:width</span>], options[<span style="font-weight: bold; text-decoration: underline;">:height</span>])
        commander.execute(<span style="font-weight: bold; text-decoration: underline;">FFMPEG</span>.command([<span style="font-weight: bold; text-decoration: underline;">FFMPEGOptSet</span>.new(names.in_file, [])],
                                         [<span style="font-weight: bold; text-decoration: underline;">FFMPEGOptSet</span>.new(names.out_file, out_opts)]))
      <span style="font-weight: bold;">end</span>
    <span style="font-weight: bold;">elsif</span> <span style="font-weight: bold; text-decoration: underline;">FileType</span>.image?(names.in_file) <span style="font-weight: bold;">then</span>
      <span style="font-weight: bold;">return</span> <span style="font-weight: bold;">if</span> options[<span style="font-weight: bold; text-decoration: underline;">:width</span>] == <span style="font-weight: bold; text-decoration: underline;">nil</span> &amp;&amp; options[<span style="font-weight: bold; text-decoration: underline;">:height</span>] == <span style="font-weight: bold; text-decoration: underline;">nil</span>
      <span style="font-weight: bold;">if</span> options[<span style="font-weight: bold; text-decoration: underline;">:operation</span>] == <span style="font-style: italic;">"enlarge"</span>
        op = <span style="font-style: italic;">"&lt;"</span>
      <span style="font-weight: bold;">elsif</span> options[<span style="font-weight: bold; text-decoration: underline;">:operation</span>] == <span style="font-style: italic;">"shrink"</span>
        op = <span style="font-style: italic;">"&gt;"</span>
      <span style="font-weight: bold;">else</span>
        op = <span style="font-style: italic;">""</span>
      <span style="font-weight: bold;">end</span>
      geometry = <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"%sx%s%s"</span>, options[<span style="font-weight: bold; text-decoration: underline;">:width</span>], options[<span style="font-weight: bold; text-decoration: underline;">:height</span>], op)
      commander.execute(<span style="font-style: italic;">"convert -resize </span><span style="font-weight: bold; font-style: italic;">#{geometry}</span><span style="font-style: italic;"> </span><span style="font-weight: bold; font-style: italic;">#{names.in_file}</span><span style="font-style: italic;"> </span><span style="font-weight: bold; font-style: italic;">#{names.out_file}</span><span style="font-style: italic;">"</span>)
    <span style="font-weight: bold;">end</span>
  <span style="font-weight: bold;">end</span>

  desc <span style="font-style: italic;">"concat"</span>, <span style="font-style: italic;">"concat multiple files"</span>
  option <span style="font-weight: bold; text-decoration: underline;">:in</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"i"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:array</span>, <span style="font-weight: bold; text-decoration: underline;">:required</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">true</span>
  option <span style="font-weight: bold; text-decoration: underline;">:out</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"o"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>
  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">concat</span>()
    names = <span style="font-weight: bold; text-decoration: underline;">Names</span>.new(options[<span style="font-weight: bold; text-decoration: underline;">:in</span>][0], options[<span style="font-weight: bold; text-decoration: underline;">:out</span>])
    commander = <span style="font-weight: bold; text-decoration: underline;">Commander</span>.new(options[<span style="font-weight: bold; text-decoration: underline;">:log</span>], options[<span style="font-weight: bold; text-decoration: underline;">:dryrun</span>])

    srcs = options[<span style="font-weight: bold; text-decoration: underline;">:in</span>]
    output = names.out_file

    <span style="font-weight: bold;">if</span> srcs.all? { |src| <span style="font-weight: bold; text-decoration: underline;">FileType</span>.video?(src) }
      src_list = <span style="font-style: italic;">""</span>
      src_file = <span style="font-weight: bold; text-decoration: underline;">Tempfile</span>.open()
      chap_file = <span style="font-weight: bold; text-decoration: underline;">Tempfile</span>.open()
      chap_file.write(<span style="font-style: italic;">"### Create Chapterfile ###\n"</span>)
      files_to_remove = []
      time_accumulated = <span style="font-weight: bold; text-decoration: underline;">Time</span>.new(0)
      srcs.each_with_index <span style="font-weight: bold;">do</span> |src, index|
        valid_src =
          <span style="font-weight: bold;">if</span> src =~ <span style="font-style: italic;">/^\p{Ascii}+$/</span>
            src
          <span style="font-weight: bold;">else</span>
            <span style="font-weight: bold; text-decoration: underline;">Dir</span>::<span style="font-weight: bold; text-decoration: underline;">Tmpname</span>.create(<span style="font-style: italic;">'base'</span>) <span style="font-weight: bold;">do</span> |src_dup|
              <span style="font-weight: bold; text-decoration: underline;">FileUtils</span>.cp(src, src_dup)
              files_to_remove &lt;&lt; src_dup
              src_dup
            <span style="font-weight: bold;">end</span>
          <span style="font-weight: bold;">end</span>
        src_file.write(<span style="font-style: italic;">"file '</span><span style="font-weight: bold; font-style: italic;">#{File.expand_path(valid_src)}</span><span style="font-style: italic;">'\n"</span>)
        chap_file.write(<span style="font-style: italic;">"CHAPTER</span><span style="font-weight: bold; font-style: italic;">#{index + 1}</span><span style="font-style: italic;">=</span><span style="font-weight: bold; font-style: italic;">#{time_accumulated.strftime('%H:%M:%S.%L')}</span><span style="font-style: italic;">\n"</span>)
        chap_file.write(<span style="font-style: italic;">"CHAPTER</span><span style="font-weight: bold; font-style: italic;">#{index + 1}</span><span style="font-style: italic;">NAME=</span><span style="font-weight: bold; font-style: italic;">#{File.basename(src, File.extname(src))}</span><span style="font-style: italic;">\n"</span>)
        duration = <span style="font-style: italic;">`ffprobe -v error -show_entries format=duration -of default=noprint_wrappers=1:nokey=1 "</span><span style="font-weight: bold; font-style: italic;">#{src}</span><span style="font-style: italic;">"`</span>.strip().to_f()
        time_accumulated += duration
      <span style="font-weight: bold;">end</span>
      src_file.flush
      commander.execute(<span style="font-style: italic;">"ffmpeg -n -f concat -safe 0 -i </span><span style="font-weight: bold; font-style: italic;">#{src_file.path}</span><span style="font-style: italic;"> -c:v copy -c:a copy -c:s copy -map 0:v -map 0:a -map 0:s? </span><span style="font-weight: bold; font-style: italic;">#{output}</span><span style="font-style: italic;">"</span>)
      src_file.close
      chap_file.flush
      commander.execute(<span style="font-style: italic;">"MP4Box -chap </span><span style="font-weight: bold; font-style: italic;">#{chap_file.path}</span><span style="font-style: italic;"> </span><span style="font-weight: bold; font-style: italic;">#{output}</span><span style="font-style: italic;">"</span>)
      chap_file.close
      src_file.unlink
      chap_file.unlink
      <span style="font-weight: bold; text-decoration: underline;">FileUtils</span>.rm_f(files_to_remove)
    <span style="font-weight: bold;">elsif</span> srcs.all? { |src| <span style="font-weight: bold; text-decoration: underline;">FileType</span>.image?(src) }
      commander.execute <span style="font-style: italic;">"convert </span><span style="font-weight: bold; font-style: italic;">#{srcs.join(' ')}</span><span style="font-style: italic;"> </span><span style="font-weight: bold; font-style: italic;">#{output}</span><span style="font-style: italic;">"</span>
    <span style="font-weight: bold;">else</span>
      <span style="font-weight: bold; text-decoration: underline;">STDERR</span>.puts <span style="font-style: italic;">"This Media Format is not supported on this function"</span>
      <span style="font-weight: bold;">exit</span> <span style="font-weight: bold; text-decoration: underline;">false</span>
    <span style="font-weight: bold;">end</span>
  <span style="font-weight: bold;">end</span>

  desc <span style="font-style: italic;">"diff"</span>, <span style="font-style: italic;">"measure the difference by providing SSIM value"</span>
  option <span style="font-weight: bold; text-decoration: underline;">:out</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"o"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>
  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">diff</span>(file1, file2)
    commander = <span style="font-weight: bold; text-decoration: underline;">Commander</span>.new(options[<span style="font-weight: bold; text-decoration: underline;">:log</span>], options[<span style="font-weight: bold; text-decoration: underline;">:dryrun</span>])

    <span style="font-weight: bold;">if</span> ((<span style="font-weight: bold; text-decoration: underline;">FileType</span>.video?(file1) <span style="font-weight: bold;">and</span> <span style="font-weight: bold; text-decoration: underline;">FileType</span>.video?(file2)) <span style="font-weight: bold;">or</span>
        (<span style="font-weight: bold; text-decoration: underline;">FileType</span>.image?(file1) <span style="font-weight: bold;">and</span> <span style="font-weight: bold; text-decoration: underline;">FileType</span>.image?(file2))) <span style="font-weight: bold;">then</span>
      <span style="font-weight: bold;">if</span> options[<span style="font-weight: bold; text-decoration: underline;">:out</span>] <span style="font-weight: bold;">then</span>
        commander.execute(<span style="font-style: italic;">"ffmpeg -i </span><span style="font-weight: bold; font-style: italic;">#{file1}</span><span style="font-style: italic;"> -i </span><span style="font-weight: bold; font-style: italic;">#{file2}</span><span style="font-style: italic;"> -filter_complex ssim=</span><span style="font-weight: bold; font-style: italic;">#{options[:out]}</span><span style="font-style: italic;"> -an -f null -"</span>)
      <span style="font-weight: bold;">else</span>
        commander.execute(<span style="font-style: italic;">"ffmpeg -i </span><span style="font-weight: bold; font-style: italic;">#{file1}</span><span style="font-style: italic;"> -i </span><span style="font-weight: bold; font-style: italic;">#{file2}</span><span style="font-style: italic;"> -filter_complex ssim -an -f null -"</span>)
      <span style="font-weight: bold;">end</span>
    <span style="font-weight: bold;">end</span>
  <span style="font-weight: bold;">end</span>

  desc <span style="font-style: italic;">"mux"</span>, <span style="font-style: italic;">"mux to one file which has streams correspond with input files"</span>
  option <span style="font-weight: bold; text-decoration: underline;">:video</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"v"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>, <span style="font-weight: bold; text-decoration: underline;">:required</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">true</span>
  option <span style="font-weight: bold; text-decoration: underline;">:audio</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"a"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>, <span style="font-weight: bold; text-decoration: underline;">:required</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">true</span>
  option <span style="font-weight: bold; text-decoration: underline;">:audio_delay</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"d"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>
  option <span style="font-weight: bold; text-decoration: underline;">:out</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"o"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>
  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">mux</span>()
    names = <span style="font-weight: bold; text-decoration: underline;">Names</span>.new(options[<span style="font-weight: bold; text-decoration: underline;">:video</span>], options[<span style="font-weight: bold; text-decoration: underline;">:out</span>])
    commander = <span style="font-weight: bold; text-decoration: underline;">Commander</span>.new(options[<span style="font-weight: bold; text-decoration: underline;">:log</span>], options[<span style="font-weight: bold; text-decoration: underline;">:dryrun</span>])

    in_optsets = []
    in_optsets &lt;&lt; <span style="font-weight: bold; text-decoration: underline;">FFMPEGOptSet</span>.new(options[<span style="font-weight: bold; text-decoration: underline;">:video</span>], [])
    aconf = []
    aconf &lt;&lt; <span style="font-style: italic;">"-itsoffset </span><span style="font-weight: bold; font-style: italic;">#{options[:audio_delay]}</span><span style="font-style: italic;">"</span> <span style="font-weight: bold;">if</span> options[<span style="font-weight: bold; text-decoration: underline;">:audio_delay</span>]
    in_optsets &lt;&lt; <span style="font-weight: bold; text-decoration: underline;">FFMPEGOptSet</span>.new(options[<span style="font-weight: bold; text-decoration: underline;">:audio</span>], aconf)
    commander.execute(<span style="font-weight: bold; text-decoration: underline;">FFMPEG</span>.command(in_optsets,
                                     [<span style="font-weight: bold; text-decoration: underline;">FFMPEGOptSet</span>.new(names.out_file, [])]))
  <span style="font-weight: bold;">end</span>
<span style="font-weight: bold;">end</span>

<span style="font-weight: bold;">class</span> <span style="font-weight: bold; text-decoration: underline;">MainConfig</span>
  <span style="font-weight: bold;">attr_accessor</span> <span style="font-weight: bold; text-decoration: underline;">:start</span>, <span style="font-weight: bold; text-decoration: underline;">:end</span>
<span style="font-weight: bold;">end</span>

<span style="font-weight: bold;">class</span> <span style="font-weight: bold; text-decoration: underline;">VideoConfig</span>
  <span style="font-weight: bold;">attr_accessor</span> <span style="font-weight: bold; text-decoration: underline;">:encode</span>, <span style="font-weight: bold; text-decoration: underline;">:quality</span>, <span style="font-weight: bold; text-decoration: underline;">:bitrate</span>, <span style="font-weight: bold; text-decoration: underline;">:preset</span>, <span style="font-weight: bold; text-decoration: underline;">:tune</span>, <span style="font-weight: bold; text-decoration: underline;">:profile</span>, <span style="font-weight: bold; text-decoration: underline;">:level</span>

  <span style="font-weight: bold; text-decoration: underline;">DEFAULT_ENCODE</span> = <span style="font-style: italic;">'vp9'</span>
  <span style="font-weight: bold; text-decoration: underline;">DEFAULT_QUALITY</span> = <span style="font-style: italic;">'26'</span>
  <span style="font-weight: bold; text-decoration: underline;">DEFAULT_BITRATE</span> = <span style="font-style: italic;">'1000'</span>

  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">initialize</span>(encode, quality=<span style="font-weight: bold; text-decoration: underline;">nil</span>, bitrate=<span style="font-weight: bold; text-decoration: underline;">nil</span>)
    <span style="font-weight: bold; font-style: italic;">@encode</span> = encode
    <span style="font-weight: bold; font-style: italic;">@quality</span> = quality
    <span style="font-weight: bold; font-style: italic;">@bitrate</span> = bitrate

    <span style="font-weight: bold;">case</span> <span style="font-weight: bold; font-style: italic;">@encode</span>
    <span style="font-weight: bold;">when</span> <span style="font-style: italic;">"x265"</span>
      <span style="font-weight: bold; font-style: italic;">@preset</span> = <span style="font-style: italic;">"veryslow"</span>
      <span style="font-weight: bold; font-style: italic;">@tune</span> = <span style="font-style: italic;">"ssim"</span>
      <span style="font-weight: bold; font-style: italic;">@profile</span> = <span style="font-style: italic;">"main"</span>
      <span style="font-weight: bold; font-style: italic;">@level</span> = <span style="font-weight: bold; text-decoration: underline;">nil</span>
    <span style="font-weight: bold;">when</span> <span style="font-style: italic;">"x264"</span>
      <span style="font-weight: bold; font-style: italic;">@preset</span> = <span style="font-style: italic;">"veryslow"</span>
      <span style="font-weight: bold; font-style: italic;">@tune</span> = <span style="font-style: italic;">"film"</span>
      <span style="font-weight: bold; font-style: italic;">@profile</span> = <span style="font-style: italic;">"main"</span>
      <span style="font-weight: bold; font-style: italic;">@level</span> = <span style="font-style: italic;">"4.1"</span>
    <span style="font-weight: bold;">end</span>
  <span style="font-weight: bold;">end</span>
<span style="font-weight: bold;">end</span>

<span style="font-weight: bold;">class</span> <span style="font-weight: bold; text-decoration: underline;">PictureConfig</span>
  <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">conversion options</span>
  <span style="font-weight: bold;">attr_accessor</span> <span style="font-weight: bold; text-decoration: underline;">:vf_opts</span>, <span style="font-weight: bold; text-decoration: underline;">:fps</span>

  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">initialize</span>()
    <span style="font-weight: bold; font-style: italic;">@vf_opts</span> = []
    <span style="font-weight: bold; font-style: italic;">@vf_opts</span> &lt;&lt; <span style="font-style: italic;">"format=yuv420p"</span>
  <span style="font-weight: bold;">end</span>

  <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">down-size to fit to display (width:heigh) in keeping aspect ratio</span>
  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">fit_size</span>(display_size)
    <span style="font-weight: bold; font-style: italic;">@vf_opts</span> &lt;&lt; <span style="font-style: italic;">"scale=</span><span style="font-weight: bold; font-style: italic;">#{display_size}</span><span style="font-style: italic;">:force_original_aspect_ratio=decrease"</span>
    <span style="font-weight: bold; font-style: italic;">@vf_opts</span> &lt;&lt; <span style="font-style: italic;">"pad=((iw+1)/2)*2:((ih+1)/2)*2"</span> <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">avoid width/height to odd</span>
  <span style="font-weight: bold;">end</span>

  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">decrease_framerate</span>(fps)
    <span style="font-weight: bold; font-style: italic;">@fps</span> = fps
  <span style="font-weight: bold;">end</span>
<span style="font-weight: bold;">end</span>

<span style="font-weight: bold;">class</span> <span style="font-weight: bold; text-decoration: underline;">AudioConfig</span>
  <span style="font-weight: bold;">attr_accessor</span> <span style="font-weight: bold; text-decoration: underline;">:encode</span>, <span style="font-weight: bold; text-decoration: underline;">:quality</span>, <span style="font-weight: bold; text-decoration: underline;">:bitrate</span>

  <span style="font-weight: bold; text-decoration: underline;">DEFAULT_ENCODE</span> = <span style="font-style: italic;">'opus'</span>
  <span style="font-weight: bold; text-decoration: underline;">DEFAULT_QUALITY</span> = <span style="font-style: italic;">'100'</span>
  <span style="font-weight: bold; text-decoration: underline;">DEFAULT_BITRATE</span> = <span style="font-style: italic;">'128'</span>

  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">initialize</span>(encode, quality=<span style="font-weight: bold; text-decoration: underline;">nil</span>, bitrate=<span style="font-weight: bold; text-decoration: underline;">nil</span>)
    <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">@encode = (encode ? encode : DEFAULT_ENCODE)</span>
    <span style="font-weight: bold; font-style: italic;">@encode</span> = encode
    <span style="font-weight: bold; font-style: italic;">@quality</span> = quality
    <span style="font-weight: bold; font-style: italic;">@bitrate</span> = bitrate
  <span style="font-weight: bold;">end</span>

  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">quality</span>
    <span style="font-weight: bold;">case</span> <span style="font-weight: bold; font-style: italic;">@encode</span>
    <span style="font-weight: bold;">when</span> <span style="font-style: italic;">'opus'</span>
    <span style="font-weight: bold;">else</span>
      <span style="font-weight: bold; font-style: italic;">@quality</span>
    <span style="font-weight: bold;">end</span>
  <span style="font-weight: bold;">end</span>

  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">bitrate</span>
    <span style="font-weight: bold;">case</span> <span style="font-weight: bold; font-style: italic;">@encode</span>
    <span style="font-weight: bold;">when</span> <span style="font-style: italic;">'opus'</span>
      (<span style="font-weight: bold; font-style: italic;">@bitrate</span> ? <span style="font-weight: bold; font-style: italic;">@bitrate</span> : <span style="font-weight: bold; text-decoration: underline;">DEFAULT_BITRATE</span>)
    <span style="font-weight: bold;">else</span>
      <span style="font-weight: bold; font-style: italic;">@bitrate</span>
    <span style="font-weight: bold;">end</span>
  <span style="font-weight: bold;">end</span>
<span style="font-weight: bold;">end</span>

<span style="font-weight: bold;">class</span> <span style="font-weight: bold; text-decoration: underline;">DVDConfig</span>
  <span style="font-weight: bold;">attr_accessor</span> <span style="font-weight: bold; text-decoration: underline;">:title</span>, <span style="font-weight: bold; text-decoration: underline;">:chapters</span>, <span style="font-weight: bold; text-decoration: underline;">:audio</span>, <span style="font-weight: bold; text-decoration: underline;">:subtitle</span>, <span style="font-weight: bold; text-decoration: underline;">:options</span>
  <span style="font-weight: bold;">attr_accessor</span> <span style="font-weight: bold; text-decoration: underline;">:chapter_marker</span>

  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">initialize</span>
    <span style="font-weight: bold; font-style: italic;">@chapter_marker</span> = <span style="font-weight: bold; text-decoration: underline;">true</span>
  <span style="font-weight: bold;">end</span>
<span style="font-weight: bold;">end</span>

<span style="font-weight: bold;">class</span> <span style="font-weight: bold; text-decoration: underline;">ImageConfig</span>
  <span style="font-weight: bold;">attr_reader</span> <span style="font-weight: bold; text-decoration: underline;">:quality</span> <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">1~100</span>
<span style="font-weight: bold;">end</span>

<span style="font-weight: bold;">class</span> <span style="font-weight: bold; text-decoration: underline;">FFMPEGOptSet</span> &lt; <span style="font-weight: bold; text-decoration: underline;">Struct</span>.new(<span style="font-weight: bold; text-decoration: underline;">:fname</span>, <span style="font-weight: bold; text-decoration: underline;">:optset</span>)
<span style="font-weight: bold;">end</span>

<span style="font-weight: bold;">class</span> <span style="font-weight: bold; text-decoration: underline;">FFMPEG</span>
  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">self</span>.<span style="font-weight: bold;">command</span>(in_optsets, out_optsets)
    opts = [<span style="font-style: italic;">"ffmpeg"</span>]

    infilep = <span style="font-weight: bold;">proc</span> <span style="font-weight: bold;">do</span> |fname, optset|
      opt_arr = []
      optset.each <span style="font-weight: bold;">do</span> |opt|
        <span style="font-weight: bold;">if</span> opt.instance_of?(<span style="font-weight: bold; text-decoration: underline;">String</span>)
          opt_arr &lt;&lt; opt
        <span style="font-weight: bold;">end</span>
      <span style="font-weight: bold;">end</span>
      opt_arr &lt;&lt; [<span style="font-style: italic;">"-i"</span>, <span style="font-style: italic;">"\"</span><span style="font-weight: bold; font-style: italic;">#{fname}</span><span style="font-style: italic;">\""</span>]
      <span style="font-weight: bold;">next</span> opt_arr
    <span style="font-weight: bold;">end</span>
    in_optsets.each <span style="font-weight: bold;">do</span> |in_optset|
      opts &lt;&lt; infilep.call(in_optset.fname, in_optset.optset)
    <span style="font-weight: bold;">end</span>

    outfilep = <span style="font-weight: bold;">proc</span> <span style="font-weight: bold;">do</span> |fname, optset|
      oopts = []
      optset.each <span style="font-weight: bold;">do</span> |opt|
        <span style="font-weight: bold;">if</span> opt.instance_of?(<span style="font-weight: bold; text-decoration: underline;">VideoConfig</span>)
          <span style="font-weight: bold;">case</span> opt.encode
          <span style="font-weight: bold;">when</span> <span style="font-style: italic;">'av1'</span>
            oopts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"-c:v librav1e"</span>)
            <span style="font-weight: bold;">if</span> opt.bitrate
              oopts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"-b:v %sk"</span>, opt.bitrate)
            <span style="font-weight: bold;">end</span>
          <span style="font-weight: bold;">when</span> <span style="font-style: italic;">'vp9'</span>
            oopts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"-c:v libvpx-vp9"</span>)
            <span style="font-weight: bold;">if</span> opt.quality
              oopts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"-crf %s"</span>, opt.quality)
              oopts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"-b:v 0"</span>)
            <span style="font-weight: bold;">elsif</span> opt.bitrate
              oopts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"-b:v %s"</span>, opt.bitrate)
            <span style="font-weight: bold;">end</span>
          <span style="font-weight: bold;">when</span> <span style="font-style: italic;">'h265'</span>
            oopts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"-c:v libx265"</span>)
            oopts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"-crf %s"</span>, opt.quality)
            oopts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"-preset %s"</span>, opt.preset) <span style="font-weight: bold;">if</span> opt.preset
            oopts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"-tune %s"</span>, opt.tune) <span style="font-weight: bold;">if</span> opt.tune
            <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Currently, ffmpeg &#8203;does not support setting profiles on x265</span>
            oopts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"-profile:v %s"</span>, opt.profile) <span style="font-weight: bold;">if</span> opt.profile &amp;&amp; opt.encoder == <span style="font-style: italic;">'x264'</span>
            oopts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"-level %s"</span>, opt.level) <span style="font-weight: bold;">if</span> opt.level
          <span style="font-weight: bold;">else</span>
            oopts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"-c:v copy"</span>)
          <span style="font-weight: bold;">end</span>
        <span style="font-weight: bold;">elsif</span> opt.instance_of?(<span style="font-weight: bold; text-decoration: underline;">AudioConfig</span>)
          <span style="font-weight: bold;">case</span> opt.encode
          <span style="font-weight: bold;">when</span> <span style="font-style: italic;">'opus'</span>
            oopts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"-c:a lib%s"</span>, opt.encode)
            oopts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"-b:a %sk"</span>, opt.bitrate) <span style="font-weight: bold;">if</span> opt.bitrate
          <span style="font-weight: bold;">when</span> <span style="font-style: italic;">'aac'</span>
            oopts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"-c:a libfdk_aac"</span>)
            <span style="font-weight: bold;">if</span> opt.quality
              oopts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"-aq %s"</span>, opt.quality)
              oopts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"-b:a 0"</span>)
            <span style="font-weight: bold;">elsif</span> opt.bitrate
              oopts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"-b:a %s"</span>, opt.bitrate)
            <span style="font-weight: bold;">end</span>
          <span style="font-weight: bold;">else</span>
            oopts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"-c:a copy"</span>)
          <span style="font-weight: bold;">end</span>
        <span style="font-weight: bold;">elsif</span> opt.instance_of?(<span style="font-weight: bold; text-decoration: underline;">PictureConfig</span>)
          oopts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"-vf \"%s\""</span>, opt.vf_opts.join(<span style="font-style: italic;">","</span>)) <span style="font-weight: bold;">if</span> opt.vf_opts &amp;&amp; opt.vf_opts.any?
          oopts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"-r %s"</span>, opt.fps) <span style="font-weight: bold;">if</span> opt.fps
        <span style="font-weight: bold;">elsif</span> opt.instance_of?(<span style="font-weight: bold; text-decoration: underline;">String</span>)
          oopts &lt;&lt; opt
        <span style="font-weight: bold;">end</span>
      <span style="font-weight: bold;">end</span>
      oopts &lt;&lt; <span style="font-style: italic;">"\"</span><span style="font-weight: bold; font-style: italic;">#{fname}</span><span style="font-style: italic;">\""</span>
      <span style="font-weight: bold;">next</span> oopts
    <span style="font-weight: bold;">end</span>
    out_optsets.each <span style="font-weight: bold;">do</span> |out_optset|
      opts &lt;&lt; outfilep.call(out_optset.fname, out_optset.optset)
    <span style="font-weight: bold;">end</span>

    opts.join(<span style="font-style: italic;">" "</span>)
  <span style="font-weight: bold;">end</span>
<span style="font-weight: bold;">end</span>

<span style="font-weight: bold;">class</span> <span style="font-weight: bold; text-decoration: underline;">HandBrakeCLI</span>
  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">self</span>.<span style="font-weight: bold;">command</span>(input, output, configs, raw_option)
    cmd_opts = [<span style="font-style: italic;">"HandBrakeCLI"</span>]
    cmd_opts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"--input \"%s\""</span>, input)
    cmd_opts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"--output \"%s\""</span>, output)
    configs.each <span style="font-weight: bold;">do</span> |config|
      <span style="font-weight: bold;">if</span> config.instance_of?(<span style="font-weight: bold; text-decoration: underline;">VideoConfig</span>)
        <span style="font-weight: bold;">case</span> config.encode
        <span style="font-weight: bold;">when</span> <span style="font-style: italic;">'vp9'</span>
          cmd_opts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"--encoder VP9"</span>)
          <span style="font-weight: bold;">if</span> config.quality
            cmd_opts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"--quality %s"</span>, config.quality)
            cmd_opts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"--vb 0"</span>)
          <span style="font-weight: bold;">elsif</span> config.bitrate
            cmd_opts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"--vb %s"</span>, config.bitrate)
          <span style="font-weight: bold;">end</span>
          cmd_opts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"--encoder-preset veryslow"</span>)
        <span style="font-weight: bold;">when</span> <span style="font-style: italic;">'h265'</span> || <span style="font-style: italic;">'hevc'</span>
          cmd_opts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"--encoder x265"</span>)
          <span style="font-weight: bold;">if</span> config.quality
            cmd_opts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"--quality %s"</span>, config.quality)
            cmd_opts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"--vb 0"</span>)
          <span style="font-weight: bold;">elsif</span> config.bitrate
            cmd_opts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"--vb %s"</span>, config.bitrate)
          <span style="font-weight: bold;">end</span>
          cmd_opts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"--encoder-preset %s"</span>, config.preset) <span style="font-weight: bold;">if</span> config.preset
          cmd_opts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"--encoder-tune %s"</span>, config.tune) <span style="font-weight: bold;">if</span> config.tune
          cmd_opts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"--encoder-profile %s"</span>, config.profile) <span style="font-weight: bold;">if</span> config.profile
          cmd_opts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"--encoder-level %s"</span>, config.level) <span style="font-weight: bold;">if</span> config.level
        <span style="font-weight: bold;">else</span>
          cmd_opts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"--encoder %s"</span>, config.encode) <span style="font-weight: bold;">if</span> config.encode
          cmd_opts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"--quality %s"</span>, config.quality) <span style="font-weight: bold;">if</span> config.quality
          cmd_opts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"--vb %s"</span>, config.bitrate) <span style="font-weight: bold;">if</span> config.bitrate
        <span style="font-weight: bold;">end</span>
      <span style="font-weight: bold;">elsif</span> config.instance_of?(<span style="font-weight: bold; text-decoration: underline;">AudioConfig</span>)
        <span style="font-weight: bold;">case</span> config.encode
        <span style="font-weight: bold;">when</span> <span style="font-style: italic;">'opus'</span>
          cmd_opts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"--aencoder %s"</span>, config.encode)
          cmd_opts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"--aq %s"</span>, config.quality) <span style="font-weight: bold;">if</span> config.quality
          cmd_opts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"--ab %s"</span>, config.bitrate) <span style="font-weight: bold;">if</span> config.bitrate
        <span style="font-weight: bold;">when</span> <span style="font-style: italic;">'aac'</span>
          cmd_opts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"--aencoder ca_haac"</span>)
          <span style="font-weight: bold;">if</span> config.quality
            cmd_opts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"--aq %s"</span>, config.quality)
            cmd_opts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"--ab 0"</span>)
          <span style="font-weight: bold;">elsif</span> config.bitrate
            cmd_opts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"--ab %s"</span>, config.bitrate)
          <span style="font-weight: bold;">end</span>
        <span style="font-weight: bold;">else</span>
          cmd_opts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"--aencoder copy"</span>)
        <span style="font-weight: bold;">end</span>
      <span style="font-weight: bold;">elsif</span> config.instance_of?(<span style="font-weight: bold; text-decoration: underline;">DVDConfig</span>)
        cmd_opts &lt;&lt; (config.title ? <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"--title %s"</span>, config.title) : <span style="font-style: italic;">"--main-feature"</span>)
        cmd_opts &lt;&lt; <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"--chapters %s"</span>, config.chapters) <span style="font-weight: bold;">if</span> config.chapters
        cmd_opts &lt;&lt; <span style="font-style: italic;">"--markers"</span> <span style="font-weight: bold;">if</span> config.chapter_marker
        cmd_opts &lt;&lt; (config.audio ? <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"--audio %s"</span>, config.audio) : <span style="font-style: italic;">"--all-audio"</span> )
        cmd_opts &lt;&lt; (config.subtitle ? <span style="font-weight: bold;">format</span>(<span style="font-style: italic;">"--subtitle %s"</span>, config.subtitle) : <span style="font-style: italic;">"--all-subtitles"</span> )
      <span style="font-weight: bold;">end</span>
    <span style="font-weight: bold;">end</span>

    cmd_opts &lt;&lt; raw_option <span style="font-weight: bold;">if</span> raw_option

    cmd_opts.join(<span style="font-style: italic;">" "</span>)
  <span style="font-weight: bold;">end</span>
<span style="font-weight: bold;">end</span>

<span style="font-weight: bold;">class</span> <span style="font-weight: bold; text-decoration: underline;">ImageMagick</span>
  <span style="font-weight: bold; text-decoration: underline;">COMMAND</span> = <span style="font-style: italic;">"convert %s %s %s %s "</span>

  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">self</span>.<span style="font-weight: bold;">command</span>(input, output, pconfig, raw_option=<span style="font-style: italic;">""</span>)
    input_opt = <span style="font-style: italic;">""</span>
    output_opt = <span style="font-style: italic;">""</span>
    <span style="font-weight: bold;">if</span> pconfig.instance_of?(<span style="font-weight: bold; text-decoration: underline;">ImageConfig</span>) <span style="font-weight: bold;">then</span>
      input_opt += <span style="font-style: italic;">"-quality %s"</span> % pconfig.quality <span style="font-weight: bold;">if</span> pconfig.quality
      s = <span style="font-weight: bold; text-decoration: underline;">COMMAND</span> % [input, input_opt, output, output_opt]
      s
    <span style="font-weight: bold;">end</span>
  <span style="font-weight: bold;">end</span>
<span style="font-weight: bold;">end</span>

<span style="font-weight: bold; text-decoration: underline;">MediaUtil</span>.start(<span style="font-weight: bold; text-decoration: underline;">ARGV</span>)
</pre>
</div>
</div>
</div>
<div id="outline-container-org2a516be" class="outline-3">
<h3 id="org2a516be">genalbum</h3>
<div class="outline-text-3" id="text-org2a516be">
<p>
Personal script for encoding family pictures and movies.
</p>

<div class="org-src-container">
<pre class="src src-ruby"><span style="font-weight: bold;">require</span> <span style="font-style: italic;">'fileutils'</span>
<span style="font-weight: bold;">require</span> <span style="font-style: italic;">'time'</span>
<span style="font-weight: bold;">require</span> <span style="font-style: italic;">'exifr'</span>
<span style="font-weight: bold;">require</span> <span style="font-style: italic;">'streamio-ffmpeg'</span>
<span style="font-weight: bold;">require</span> <span style="font-style: italic;">'pathname'</span>
<span style="font-weight: bold;">require</span> <span style="font-style: italic;">'thor'</span>

<span style="font-weight: bold; text-decoration: underline;">PICTURE_FILE_EXTS</span> = [<span style="font-style: italic;">".jpg"</span>]
<span style="font-weight: bold; text-decoration: underline;">MOVIE_FILE_EXTS</span> = [<span style="font-style: italic;">".mp4"</span>]
<span style="font-weight: bold; text-decoration: underline;">ALBUM_DIR_NAME</span> = <span style="font-style: italic;">"album/"</span>
<span style="font-weight: bold; text-decoration: underline;">RENAME_DIR_NAME</span> = <span style="font-style: italic;">"rename/"</span>
<span style="font-weight: bold; text-decoration: underline;">WEB_DIR_NAME</span> = <span style="font-style: italic;">"album_web/"</span>
<span style="font-weight: bold; text-decoration: underline;">IMG_PREFIX</span> = <span style="font-style: italic;">"img_"</span>

<span style="font-weight: bold;">class</span> <span style="font-weight: bold; text-decoration: underline;">GenAlbum</span> &lt; <span style="font-weight: bold; text-decoration: underline;">Thor</span>
  default_command <span style="font-weight: bold; text-decoration: underline;">:album</span>
  desc <span style="font-style: italic;">"[album] -i &lt;img_dir&gt;"</span>, <span style="font-style: italic;">"generate album"</span>
  option <span style="font-weight: bold; text-decoration: underline;">:in</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"i"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>, <span style="font-weight: bold; text-decoration: underline;">:required</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">true</span>
  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">album</span>
    src_path = <span style="font-weight: bold; text-decoration: underline;">File</span>.expand_path(options[<span style="font-weight: bold; text-decoration: underline;">:in</span>], <span style="font-weight: bold; text-decoration: underline;">Dir</span>.pwd)
    dest_path = <span style="font-weight: bold; text-decoration: underline;">ALBUM_DIR_NAME</span>

    <span style="font-weight: bold; text-decoration: underline;">FileUtils</span>.mkdir_p(dest_path) <span style="font-weight: bold;">unless</span> <span style="font-weight: bold; text-decoration: underline;">FileTest</span>.exist?(dest_path)

    <span style="font-weight: bold; text-decoration: underline;">Dir</span>.glob(src_path + <span style="font-style: italic;">"/*"</span>).each <span style="font-weight: bold;">do</span> |img_file|
      basename = <span style="font-weight: bold; text-decoration: underline;">File</span>::basename(img_file)
      src_file = src_path + <span style="font-style: italic;">"/"</span> + basename
      dest_file = dest_path + <span style="font-style: italic;">"/"</span> + basename
      ext = <span style="font-weight: bold; text-decoration: underline;">File</span>.extname(img_file)
      <span style="font-weight: bold;">if</span> <span style="font-weight: bold; text-decoration: underline;">PICTURE_FILE_EXTS</span>.index(ext.downcase) != <span style="font-weight: bold; text-decoration: underline;">nil</span> <span style="font-weight: bold;">then</span>
        <span style="font-weight: bold;">system</span>(<span style="font-style: italic;">"convert -resize \"4096x&gt;\" -quality 92 </span><span style="font-weight: bold; font-style: italic;">#{src_file}</span><span style="font-style: italic;"> </span><span style="font-weight: bold; font-style: italic;">#{dest_file}</span><span style="font-style: italic;">"</span>)
      <span style="font-weight: bold;">elsif</span> <span style="font-weight: bold; text-decoration: underline;">MOVIE_FILE_EXTS</span>.index(ext.downcase) != <span style="font-weight: bold; text-decoration: underline;">nil</span> <span style="font-weight: bold;">then</span>
        <span style="font-weight: bold;">system</span>(<span style="font-style: italic;">"mediautil encode -i </span><span style="font-weight: bold; font-style: italic;">#{src_file}</span><span style="font-style: italic;"> -o </span><span style="font-weight: bold; font-style: italic;">#{dest_file}</span><span style="font-style: italic;"> -q 22.0 -Q 100.0"</span>)
      <span style="font-weight: bold;">end</span>
    <span style="font-weight: bold;">end</span>
  <span style="font-weight: bold;">end</span>

  desc <span style="font-style: italic;">"web -i &lt;img_dir&gt;"</span>, <span style="font-style: italic;">"generate lightweight album for web"</span>
  option <span style="font-weight: bold; text-decoration: underline;">:in</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"i"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>, <span style="font-weight: bold; text-decoration: underline;">:required</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">true</span>
  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">web</span>
    src_path = <span style="font-weight: bold; text-decoration: underline;">File</span>.expand_path(options[<span style="font-weight: bold; text-decoration: underline;">:in</span>], <span style="font-weight: bold; text-decoration: underline;">Dir</span>.pwd)
    dest_path = <span style="font-weight: bold; text-decoration: underline;">WEB_DIR_NAME</span>

    <span style="font-weight: bold; text-decoration: underline;">FileUtils</span>.mkdir_p(dest_path) <span style="font-weight: bold;">unless</span> <span style="font-weight: bold; text-decoration: underline;">FileTest</span>.exist?(dest_path)

    <span style="font-weight: bold; text-decoration: underline;">Dir</span>.glob(src_path + <span style="font-style: italic;">"/*"</span>).each <span style="font-weight: bold;">do</span> |img_file|
      basename = <span style="font-weight: bold; text-decoration: underline;">File</span>::basename(img_file)
      src_file = src_path + <span style="font-style: italic;">"/"</span> + basename
      dest_file = dest_path + <span style="font-style: italic;">"/"</span> + basename
      ext = <span style="font-weight: bold; text-decoration: underline;">File</span>.extname(img_file)
      <span style="font-weight: bold;">if</span> <span style="font-weight: bold; text-decoration: underline;">PICTURE_FILE_EXTS</span>.index(ext.downcase) != <span style="font-weight: bold; text-decoration: underline;">nil</span> <span style="font-weight: bold;">then</span>
        <span style="font-weight: bold;">system</span>(<span style="font-style: italic;">"convert -resize \"1024x&gt;\" -quality 80 </span><span style="font-weight: bold; font-style: italic;">#{src_file}</span><span style="font-style: italic;"> </span><span style="font-weight: bold; font-style: italic;">#{dest_file}</span><span style="font-style: italic;">"</span>)
      <span style="font-weight: bold;">elsif</span> <span style="font-weight: bold; text-decoration: underline;">MOVIE_FILE_EXTS</span>.index(ext.downcase) != <span style="font-weight: bold; text-decoration: underline;">nil</span> <span style="font-weight: bold;">then</span>
        <span style="font-weight: bold;">system</span>(<span style="font-style: italic;">"mediautil encode -i </span><span style="font-weight: bold; font-style: italic;">#{src_file}</span><span style="font-style: italic;"> -o </span><span style="font-weight: bold; font-style: italic;">#{dest_file}</span><span style="font-style: italic;"> -q 26.0 -Q 100.0"</span>)
      <span style="font-weight: bold;">end</span>
    <span style="font-weight: bold;">end</span>
  <span style="font-weight: bold;">end</span>

  desc <span style="font-style: italic;">"renmae -i &lt;img_dir&gt;"</span>, <span style="font-style: italic;">"rename image files in chlonological order"</span>
  option <span style="font-weight: bold; text-decoration: underline;">:in</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"i"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>, <span style="font-weight: bold; text-decoration: underline;">:required</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">true</span>
  option <span style="font-weight: bold; text-decoration: underline;">:out</span>, <span style="font-weight: bold; text-decoration: underline;">aliases:</span> <span style="font-style: italic;">"o"</span>, <span style="font-weight: bold; text-decoration: underline;">:type</span> =&gt; <span style="font-weight: bold; text-decoration: underline;">:string</span>
  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">rename</span>
    src_path = <span style="font-weight: bold; text-decoration: underline;">File</span>.expand_path(options[<span style="font-weight: bold; text-decoration: underline;">:in</span>], <span style="font-weight: bold; text-decoration: underline;">Dir</span>.pwd)
    dest_path = ((options[<span style="font-weight: bold; text-decoration: underline;">:out</span>]) ? options[<span style="font-weight: bold; text-decoration: underline;">:out</span>] : <span style="font-weight: bold; text-decoration: underline;">RENAME_DIR_NAME</span>)

    <span style="font-weight: bold; text-decoration: underline;">FileUtils</span>.mkdir_p(dest_path) <span style="font-weight: bold;">unless</span> <span style="font-weight: bold; text-decoration: underline;">FileTest</span>.exist?(dest_path)

    img_time = {}
    <span style="font-weight: bold; text-decoration: underline;">Dir</span>.glob(src_path + <span style="font-style: italic;">"/*"</span>).each <span style="font-weight: bold;">do</span> |img_file|
      ext = <span style="font-weight: bold; text-decoration: underline;">File</span>.extname(img_file)
      <span style="font-weight: bold;">if</span> <span style="font-weight: bold; text-decoration: underline;">PICTURE_FILE_EXTS</span>.index(ext.downcase) != <span style="font-weight: bold; text-decoration: underline;">nil</span> <span style="font-weight: bold;">then</span>
        pic = <span style="font-weight: bold; text-decoration: underline;">EXIFR</span>::<span style="font-weight: bold; text-decoration: underline;">JPEG</span>.new(img_file)
        <span style="font-weight: bold;">if</span> pic.exif? &amp;&amp; pic.date_time_original <span style="font-weight: bold;">then</span>
          img_time[img_file] = pic.date_time_original
        <span style="font-weight: bold;">else</span>
          img_time[img_file] = <span style="font-weight: bold; text-decoration: underline;">Time</span>.now
        <span style="font-weight: bold;">end</span>
      <span style="font-weight: bold;">elsif</span> <span style="font-weight: bold; text-decoration: underline;">MOVIE_FILE_EXTS</span>.index(ext.downcase) != <span style="font-weight: bold; text-decoration: underline;">nil</span> <span style="font-weight: bold;">then</span>
        movie = <span style="font-weight: bold; text-decoration: underline;">FFMPEG</span>::<span style="font-weight: bold; text-decoration: underline;">Movie</span>.new(img_file)
        time = movie.creation_time
        <span style="font-weight: bold;">if</span> time <span style="font-weight: bold;">then</span>
          img_time[img_file] = time
        <span style="font-weight: bold;">else</span>
          img_time[img_file] = <span style="font-weight: bold; text-decoration: underline;">Time</span>.now
        <span style="font-weight: bold;">end</span>
      <span style="font-weight: bold;">end</span>
    <span style="font-weight: bold;">end</span>
    img_time = img_time.sort_by{ |_, v| v }

    digit = img_time.length.to_s.length
    digit = 2 <span style="font-weight: bold;">if</span> digit &lt; 2
    img_time.each_with_index <span style="font-weight: bold;">do</span> |(img, time), i|
      ext = <span style="font-weight: bold; text-decoration: underline;">File</span>.extname(img).downcase
      base = <span style="font-weight: bold; text-decoration: underline;">IMG_PREFIX</span> + <span style="font-style: italic;">"%0</span><span style="font-weight: bold; font-style: italic;">#{digit}</span><span style="font-style: italic;">d"</span> % (i + 1) + ext
      src_file = img
      dest_file = dest_path + <span style="font-style: italic;">"/"</span> + base
      <span style="font-weight: bold;">system</span>(<span style="font-style: italic;">"cp </span><span style="font-weight: bold; font-style: italic;">#{src_file}</span><span style="font-style: italic;"> </span><span style="font-weight: bold; font-style: italic;">#{dest_file}</span><span style="font-style: italic;">"</span>)
    <span style="font-weight: bold;">end</span>
  <span style="font-weight: bold;">end</span>
<span style="font-weight: bold;">end</span>

<span style="font-weight: bold; text-decoration: underline;">GenAlbum</span>.start(<span style="font-weight: bold; text-decoration: underline;">ARGV</span>)
</pre>
</div>
</div>
</div>

<div id="outline-container-org86a776f" class="outline-3">
<h3 id="org86a776f">nhp&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span></h3>
</div>

<div id="outline-container-orgd6b7941" class="outline-3">
<h3 id="orgd6b7941">sendmail.py</h3>
<div class="outline-text-3" id="text-orgd6b7941">
<p>
Utility for sendind email programatically
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="font-weight: bold;">import</span> sys
<span style="font-weight: bold;">import</span> argparse
<span style="font-weight: bold;">import</span> subprocess
<span style="font-weight: bold;">import</span> smtplib
<span style="font-weight: bold;">import</span> ssl
<span style="font-weight: bold;">from</span> email.mime.text <span style="font-weight: bold;">import</span> MIMEText
<span style="font-weight: bold;">from</span> email.utils <span style="font-weight: bold;">import</span> formatdate

<span style="font-weight: bold;">def</span> <span style="font-weight: bold;">sendmail</span>(mail_to, mail_from, subject, message):
    <span style="font-weight: bold; font-style: italic;">smtp_host</span> = <span style="font-style: italic;">'smtp.&lt;&lt;my-domain()&gt;&gt;'</span>
    <span style="font-weight: bold; font-style: italic;">smtp_port</span> = <span style="font-style: italic;">'465'</span>
    <span style="font-weight: bold; font-style: italic;">smtp_user</span> = <span style="font-style: italic;">'&lt;&lt;email&gt;&gt;'</span>.split(sep=<span style="font-style: italic;">'@'</span>)[0]
    <span style="font-weight: bold; font-style: italic;">smtp_pass</span> = subprocess.run([<span style="font-style: italic;">"pass {}:{}/{} | head -1"</span>.<span style="font-weight: bold;">format</span>(smtp_host, smtp_port, smtp_user)], stdout=subprocess.PIPE, shell=<span style="font-weight: bold; text-decoration: underline;">True</span>).stdout.decode().strip()

    <span style="font-weight: bold; font-style: italic;">mime_msg</span> = MIMEText(message)
    <span style="font-weight: bold; font-style: italic;">mime_msg</span>[<span style="font-style: italic;">'Subject'</span>] = subject
    <span style="font-weight: bold; font-style: italic;">mime_msg</span>[<span style="font-style: italic;">'From'</span>] = mail_from
    <span style="font-weight: bold; font-style: italic;">mime_msg</span>[<span style="font-style: italic;">'To'</span>] = mail_to
    <span style="font-weight: bold; font-style: italic;">mime_msg</span>[<span style="font-style: italic;">"Date"</span>] = formatdate(<span style="font-weight: bold; text-decoration: underline;">None</span>, <span style="font-weight: bold; text-decoration: underline;">True</span>)

    <span style="font-weight: bold;">if</span> smtp_port == <span style="font-style: italic;">'465'</span>:
        <span style="font-weight: bold; font-style: italic;">context</span> = ssl.create_default_context()
        <span style="font-weight: bold; font-style: italic;">smtp</span> = smtplib.SMTP_SSL(smtp_host, smtp_port, context=context)

    <span style="font-weight: bold;">if</span> smtp <span style="font-weight: bold;">is</span> <span style="font-weight: bold;">not</span> <span style="font-weight: bold; text-decoration: underline;">None</span>:
        smtp.login(smtp_user, smtp_pass)
        smtp.sendmail(mail_from, mail_to, mime_msg.as_string())
        smtp.<span style="font-weight: bold; text-decoration: underline;">quit</span>()


<span style="font-weight: bold; font-style: italic;">DESC</span> = <span style="font-style: italic;">'sendmail.py sends mail'</span>
<span style="font-weight: bold; font-style: italic;">parser</span> = argparse.ArgumentParser(description=DESC)
parser.add_argument(<span style="font-style: italic;">'-s'</span>, <span style="font-style: italic;">'--subject'</span>)
parser.add_argument(<span style="font-style: italic;">'-f'</span>, <span style="font-style: italic;">'--mailfrom'</span>)
parser.add_argument(<span style="font-style: italic;">'to'</span>)
<span style="font-weight: bold; font-style: italic;">args</span> = parser.parse_args()

<span style="font-weight: bold; font-style: italic;">message</span> = sys.stdin.read()
sendmail(args.to, args.mailfrom, args.subject, message)
</pre>
</div>
</div>
</div>

<div id="outline-container-org5fca85a" class="outline-3">
<h3 id="org5fca85a">pwsudo</h3>
<div class="outline-text-3" id="text-org5fca85a">
<p>
Nifty script that executes command with elevating privilege using password from pass command.
</p>

<div class="org-src-container">
<pre class="src src-shell"><span style="font-weight: bold; font-style: italic;">_userid</span>=$(whoami)
<span style="font-weight: bold; font-style: italic;">_hostname</span>=$(hostname)

<span style="font-weight: bold; font-style: italic;">pas</span>=$(pass show <span style="font-style: italic;">"${_hostname}/${_userid}"</span> 2&gt;/dev/null) <span style="font-style: italic;">\</span>
  &amp;&amp; ( <span style="font-weight: bold;">echo</span> <span style="font-style: italic;">"${pas}"</span> | head -1 | sudo -S -p <span style="font-style: italic;">""</span> <span style="font-style: italic;">"$@"</span> ) <span style="font-style: italic;">\</span>
  || sudo -S <span style="font-style: italic;">"$@"</span>

<span style="font-weight: bold;">exit</span> $<span style="font-weight: bold; font-style: italic;">?</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgbaa97de" class="outline-3">
<h3 id="orgbaa97de">gitsync&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span></h3>
</div>

<div id="outline-container-org167769d" class="outline-3">
<h3 id="org167769d">filetype-cli&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ARCHIVE">ARCHIVE</span></span></h3>
</div>
<div id="outline-container-orgcf78454" class="outline-3">
<h3 id="orgcf78454">strip ruby</h3>
<div class="outline-text-3" id="text-orgcf78454">
<p>
A program strips all ruby tags in a HTML stream. All HTML contents are expected to be from STDIN and go out as STDOUT. This procedure is mainly for html files converted from pdf and epub files.
Stripping rules are:
</p>
<ul class="org-ul">
<li>&lt;ruby&gt; tag will be stripped</li>
<li>&lt;rt&gt; tree for furigana tree will be removed</li>
<li>&lt;rp&gt; tree contains parenthes for non-ruby-support brouwser will be removed</li>
<li>&lt;rb&gt; tag for delimiter will be stripped</li>
<li>&lt;rtc&gt; tree for semantic word will be removed</li>
</ul>

<div class="org-src-container">
<pre class="src src-python"><span style="font-weight: bold;">import</span> sys
<span style="font-weight: bold;">import</span> lxml.html <span style="font-weight: bold;">as</span> html

<span style="font-weight: bold; font-style: italic;">INPUT_STR</span> = sys.stdin.read()
<span style="font-weight: bold; font-style: italic;">ROOT</span> = html.fromstring(INPUT_STR).getroottree()

<span style="font-weight: bold;">for</span> ruby <span style="font-weight: bold;">in</span> ROOT.xpath(<span style="font-style: italic;">'//ruby'</span>):
    <span style="font-weight: bold;">for</span> rt <span style="font-weight: bold;">in</span> ruby.xpath(<span style="font-style: italic;">'//rt'</span>):
        rt.drop_tree()
    <span style="font-weight: bold;">for</span> rp <span style="font-weight: bold;">in</span> ruby.xpath(<span style="font-style: italic;">'//rp'</span>):
        rp.drop_tree()
    <span style="font-weight: bold;">for</span> rb <span style="font-weight: bold;">in</span> ruby.xpath(<span style="font-style: italic;">'//rb'</span>):
        rb.drop_tag()
    <span style="font-weight: bold;">for</span> rtc <span style="font-weight: bold;">in</span> ruby.xpath(<span style="font-style: italic;">'//rtc'</span>):
        rtc.drop_tree()
        ruby.drop_tag()

<span style="font-weight: bold; font-style: italic;">CONTENT</span> = html.tostring(ROOT, encoding=<span style="font-style: italic;">"utf-8"</span>, method=<span style="font-style: italic;">'html'</span>, pretty_print=<span style="font-weight: bold; text-decoration: underline;">True</span>)
<span style="font-weight: bold;">print</span>(CONTENT.decode())
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orgc8801d7" class="outline-2">
<h2 id="orgc8801d7">Local Variables</h2>
<div class="outline-text-2" id="text-orgc8801d7">
</div>
</div>
</div>
</body>
</html>
